"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5510],{75081:function(e,t,n){n.d(t,{Z:function(){return b}});var l=n(94184),i=n.n(l),o=n(98423),a=n(67294),s=n(96159),d=n(53124),r=n(23183),c=n(14747),u=n(67968),v=n(45503);let m=new r.E4("antSpinMove",{to:{opacity:1}}),h=new r.E4("antRotate",{to:{transform:"rotate(405deg)"}}),p=e=>({[`${e.componentCls}`]:Object.assign(Object.assign({},(0,c.Wf)(e)),{position:"absolute",display:"none",color:e.colorPrimary,fontSize:0,textAlign:"center",verticalAlign:"middle",opacity:0,transition:`transform ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`,"&-spinning":{position:"static",display:"inline-block",opacity:1},"&-nested-loading":{position:"relative",[`> div > ${e.componentCls}`]:{position:"absolute",top:0,insetInlineStart:0,zIndex:4,display:"block",width:"100%",height:"100%",maxHeight:e.contentHeight,[`${e.componentCls}-dot`]:{position:"absolute",top:"50%",insetInlineStart:"50%",margin:-e.spinDotSize/2},[`${e.componentCls}-text`]:{position:"absolute",top:"50%",width:"100%",paddingTop:(e.spinDotSize-e.fontSize)/2+2,textShadow:`0 1px 2px ${e.colorBgContainer}`,fontSize:e.fontSize},[`&${e.componentCls}-show-text ${e.componentCls}-dot`]:{marginTop:-(e.spinDotSize/2)-10},"&-sm":{[`${e.componentCls}-dot`]:{margin:-e.spinDotSizeSM/2},[`${e.componentCls}-text`]:{paddingTop:(e.spinDotSizeSM-e.fontSize)/2+2},[`&${e.componentCls}-show-text ${e.componentCls}-dot`]:{marginTop:-(e.spinDotSizeSM/2)-10}},"&-lg":{[`${e.componentCls}-dot`]:{margin:-(e.spinDotSizeLG/2)},[`${e.componentCls}-text`]:{paddingTop:(e.spinDotSizeLG-e.fontSize)/2+2},[`&${e.componentCls}-show-text ${e.componentCls}-dot`]:{marginTop:-(e.spinDotSizeLG/2)-10}}},[`${e.componentCls}-container`]:{position:"relative",transition:`opacity ${e.motionDurationSlow}`,"&::after":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:10,width:"100%",height:"100%",background:e.colorBgContainer,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'""',pointerEvents:"none"}},[`${e.componentCls}-blur`]:{clear:"both",opacity:.5,userSelect:"none",pointerEvents:"none","&::after":{opacity:.4,pointerEvents:"auto"}}},"&-tip":{color:e.spinDotDefault},[`${e.componentCls}-dot`]:{position:"relative",display:"inline-block",fontSize:e.spinDotSize,width:"1em",height:"1em","&-item":{position:"absolute",display:"block",width:(e.spinDotSize-e.marginXXS/2)/2,height:(e.spinDotSize-e.marginXXS/2)/2,backgroundColor:e.colorPrimary,borderRadius:"100%",transform:"scale(0.75)",transformOrigin:"50% 50%",opacity:.3,animationName:m,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"alternate","&:nth-child(1)":{top:0,insetInlineStart:0},"&:nth-child(2)":{top:0,insetInlineEnd:0,animationDelay:"0.4s"},"&:nth-child(3)":{insetInlineEnd:0,bottom:0,animationDelay:"0.8s"},"&:nth-child(4)":{bottom:0,insetInlineStart:0,animationDelay:"1.2s"}},"&-spin":{transform:"rotate(45deg)",animationName:h,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&-sm ${e.componentCls}-dot`]:{fontSize:e.spinDotSizeSM,i:{width:(e.spinDotSizeSM-e.marginXXS/2)/2,height:(e.spinDotSizeSM-e.marginXXS/2)/2}},[`&-lg ${e.componentCls}-dot`]:{fontSize:e.spinDotSizeLG,i:{width:(e.spinDotSizeLG-e.marginXXS)/2,height:(e.spinDotSizeLG-e.marginXXS)/2}},[`&${e.componentCls}-show-text ${e.componentCls}-text`]:{display:"block"}})});var f=(0,u.Z)("Spin",e=>{let t=(0,v.TS)(e,{spinDotDefault:e.colorTextDescription,spinDotSize:e.controlHeightLG/2,spinDotSizeSM:.35*e.controlHeightLG,spinDotSizeLG:e.controlHeight});return[p(t)]},{contentHeight:400}),x=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&0>t.indexOf(l)&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,l=Object.getOwnPropertySymbols(e);i<l.length;i++)0>t.indexOf(l[i])&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(n[l[i]]=e[l[i]]);return n};let g=null,y=e=>{let{spinPrefixCls:t,spinning:n=!0,delay:l=0,className:r,rootClassName:c,size:u="default",tip:v,wrapperClassName:m,style:h,children:p,hashId:f}=e,y=x(e,["spinPrefixCls","spinning","delay","className","rootClassName","size","tip","wrapperClassName","style","children","hashId"]),[w,b]=a.useState(()=>n&&(!n||!l||!!isNaN(Number(l))));a.useEffect(()=>{if(n){var e;let t=function(e,t,n){var l,i=n||{},o=i.noTrailing,a=void 0!==o&&o,s=i.noLeading,d=void 0!==s&&s,r=i.debounceMode,c=void 0===r?void 0:r,u=!1,v=0;function m(){l&&clearTimeout(l)}function h(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=this,r=Date.now()-v;function h(){v=Date.now(),t.apply(s,i)}function p(){l=void 0}!u&&(d||!c||l||h(),m(),void 0===c&&r>e?d?(v=Date.now(),a||(l=setTimeout(c?p:h,e))):h():!0!==a&&(l=setTimeout(c?p:h,void 0===c?e-r:e)))}return h.cancel=function(e){var t=(e||{}).upcomingOnly;m(),u=!(void 0!==t&&t)},h}(l,()=>{b(!0)},{debounceMode:!1!==(void 0!==(e=({}).atBegin)&&e)});return t(),()=>{var e;null===(e=null==t?void 0:t.cancel)||void 0===e||e.call(t)}}b(!1)},[l,n]);let S=a.useMemo(()=>void 0!==p,[p]),{direction:j,spin:N}=a.useContext(d.E_),C=i()(t,null==N?void 0:N.className,{[`${t}-sm`]:"small"===u,[`${t}-lg`]:"large"===u,[`${t}-spinning`]:w,[`${t}-show-text`]:!!v,[`${t}-rtl`]:"rtl"===j},r,c,f),z=i()(`${t}-container`,{[`${t}-blur`]:w}),k=(0,o.Z)(y,["indicator","prefixCls"]),_=Object.assign(Object.assign({},null==N?void 0:N.style),h),D=a.createElement("div",Object.assign({},k,{style:_,className:C,"aria-live":"polite","aria-busy":w}),function(e,t){let{indicator:n}=t,l=`${e}-dot`;return null===n?null:(0,s.l$)(n)?(0,s.Tm)(n,{className:i()(n.props.className,l)}):(0,s.l$)(g)?(0,s.Tm)(g,{className:i()(g.props.className,l)}):a.createElement("span",{className:i()(l,`${e}-dot-spin`)},a.createElement("i",{className:`${e}-dot-item`,key:1}),a.createElement("i",{className:`${e}-dot-item`,key:2}),a.createElement("i",{className:`${e}-dot-item`,key:3}),a.createElement("i",{className:`${e}-dot-item`,key:4}))}(t,e),v&&S?a.createElement("div",{className:`${t}-text`},v):null);return S?a.createElement("div",Object.assign({},k,{className:i()(`${t}-nested-loading`,m,f)}),w&&a.createElement("div",{key:"loading"},D),a.createElement("div",{className:z,key:"container"},p)):D},w=e=>{let{prefixCls:t}=e,{getPrefixCls:n}=a.useContext(d.E_),l=n("spin",t),[i,o]=f(l),s=Object.assign(Object.assign({},e),{spinPrefixCls:l,hashId:o});return i(a.createElement(y,Object.assign({},s)))};w.setDefaultIndicator=e=>{g=e};var b=w},32027:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var l=n(85893),i=n(67294),o=n(56155),a=n(45396),s=n(83062),d=n(51009),r=n(71577),c=n(79531),u=n(57346),v=n(16165),m=n(74434),h=n(30119),p=n(39332),f=n(67772),x=n(39156),g=n(6171),y=n(18073),w=n(14313),b=n(87462),S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},j=n(84089),N=i.forwardRef(function(e,t){return i.createElement(j.Z,(0,b.Z)({},e,{ref:t,icon:S}))});function C(){return(0,l.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"49817",width:"1em",height:"1em",children:[(0,l.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF","p-id":"49818"}),(0,l.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32","p-id":"49819"})]})}function z(){return(0,l.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"59847",width:"1em",height:"1em",children:[(0,l.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93","p-id":"59848"}),(0,l.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93","fill-opacity":".5","p-id":"59849"}),(0,l.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","p-id":"59850","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,l.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93","fill-opacity":".5","p-id":"59851"}),(0,l.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","p-id":"59852","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}function k(){return(0,l.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"67616",width:"1em",height:"1em",children:(0,l.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db","p-id":"67617"})})}var _=n(94184),D=n.n(_),$=n(91085),E=function(){return(0,l.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,l.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z","p-id":"14553"})})},M=function(){return(0,l.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,l.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z","p-id":"13913"})})};let{Search:T}=c.default;function Z(e){let{layout:t="LR",editorValue:n,chartData:o,tableData:s,tables:d,handleChange:r}=e,c=(0,i.useMemo)(()=>o?(0,l.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,l.jsx)(x.ZP,{chartsData:[o]})}):null,[o]),{columns:u,dataSource:v}=(0,i.useMemo)(()=>{let{columns:e=[],values:t=[]}=null!=s?s:{},n=e.map(e=>({key:e,dataIndex:e,title:e})),l=t.map(t=>t.reduce((t,n,l)=>(t[e[l]]=n,t),{}));return{columns:n,dataSource:l}},[s]),h=(0,i.useMemo)(()=>{let e={},t=null==d?void 0:d.data,n=null==t?void 0:t.children;return null==n||n.forEach(t=>{e[t.title]=t.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==t?void 0:t.title)?[]:(null==n?void 0:n.map(e=>e.title))||[],getTableColumns:async t=>e[t]||[],getSchemaList:async()=>(null==t?void 0:t.title)?[null==t?void 0:t.title]:[]}},[d]);return(0,l.jsxs)("div",{className:D()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===t,"flex-row":"LR"===t}),children:[(0,l.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,l.jsx)(m.Z,{value:(null==n?void 0:n.sql)||"",language:"mysql",onChange:r,thoughts:(null==n?void 0:n.thoughts)||"",session:h})}),(0,l.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==s?void 0:s.values.length)?(0,l.jsx)(a.Z,{bordered:!0,scroll:{x:"auto"},rowKey:u[0].key,columns:u,dataSource:v}):(0,l.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,l.jsx)($.Z,{})}),c]})]})}var O=function(){var e,t,n,a,c;let[m,x]=(0,i.useState)([]),[b,S]=(0,i.useState)(""),[j,_]=(0,i.useState)(),[$,O]=(0,i.useState)(!0),[q,H]=(0,i.useState)(),[L,I]=(0,i.useState)(),[P,V]=(0,i.useState)(),[B,A]=(0,i.useState)(),[R,X]=(0,i.useState)(),[G,F]=(0,i.useState)(!1),[K,U]=(0,i.useState)("TB"),W=(0,p.useSearchParams)(),Y=null==W?void 0:W.get("id"),J=null==W?void 0:W.get("scene"),{data:Q,loading:ee}=(0,o.Z)(async()=>await (0,h.Tk)("/v1/editor/sql/rounds",{con_uid:Y}),{onSuccess:e=>{var t,n;let l=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t[(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.length)-1];l&&_(null==l?void 0:l.round)}}),{run:et,loading:en}=(0,o.Z)(async()=>{var e,t;let n=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name;return await (0,h.PR)("/api/v1/editor/sql/run",{db_name:n,sql:null==P?void 0:P.sql})},{manual:!0,onSuccess:e=>{var t,n;A({columns:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.colunms,values:null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.values})}}),{run:el,loading:ei}=(0,o.Z)(async()=>{var e,t;let n=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name,l={db_name:n,sql:null==P?void 0:P.sql};return"chat_dashboard"===J&&(l.chart_type=null==P?void 0:P.showcase),await (0,h.PR)("/api/v1/editor/chart/run",l)},{manual:!0,ready:!!(null==P?void 0:P.sql),onSuccess:e=>{if(null==e?void 0:e.success){var t,n,l,i,o,a,s;A({columns:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(n=t.sql_data)||void 0===n?void 0:n.colunms)||[],values:(null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(i=l.sql_data)||void 0===i?void 0:i.values)||[]}),(null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.chart_values)?H({type:null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.chart_type,values:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.chart_values,title:null==P?void 0:P.title,description:null==P?void 0:P.thoughts}):H(void 0)}}}),{run:eo,loading:ea}=(0,o.Z)(async()=>{var e,t,n,l,i;let o=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name;return await (0,h.PR)("/api/v1/sql/editor/submit",{conv_uid:Y,db_name:o,conv_round:j,old_sql:null==L?void 0:L.sql,old_speak:null==L?void 0:L.thoughts,new_sql:null==P?void 0:P.sql,new_speak:(null===(n=null==P?void 0:null===(l=P.thoughts)||void 0===l?void 0:l.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(i=n[1])||void 0===i?void 0:i.trim())||(null==P?void 0:P.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&et()}}),{run:es,loading:ed}=(0,o.Z)(async()=>{var e,t,n,l,i,o;let a=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name;return await (0,h.PR)("/api/v1/chart/editor/submit",{conv_uid:Y,chart_title:null==P?void 0:P.title,db_name:a,old_sql:null==L?void 0:null===(n=L[R])||void 0===n?void 0:n.sql,new_chart_type:null==P?void 0:P.showcase,new_sql:null==P?void 0:P.sql,new_comment:(null===(l=null==P?void 0:null===(i=P.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===l?void 0:null===(o=l[1])||void 0===o?void 0:o.trim())||(null==P?void 0:P.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&el()}}),{data:er}=(0,o.Z)(async()=>{var e,t;let n=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name;return await (0,h.Tk)("/v1/editor/db/tables",{db_name:n,page_index:1,page_size:200})},{ready:!!(null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===j))||void 0===e?void 0:e.db_name),refreshDeps:[null===(n=null==Q?void 0:null===(a=Q.data)||void 0===a?void 0:a.find(e=>e.round===j))||void 0===n?void 0:n.db_name]}),{run:ec}=(0,o.Z)(async e=>await (0,h.Tk)("/v1/editor/sql",{con_uid:Y,round:e}),{manual:!0,onSuccess:e=>{let t;try{if(Array.isArray(null==e?void 0:e.data))t=null==e?void 0:e.data,X(0);else if("string"==typeof(null==e?void 0:e.data)){let n=JSON.parse(null==e?void 0:e.data);t=n}else t=null==e?void 0:e.data}catch(e){console.log(e)}finally{I(t),Array.isArray(t)?V(null==t?void 0:t[Number(R||0)]):V(t)}}}),eu=(0,i.useMemo)(()=>{let e=(t,n)=>t.map(t=>{let i=t.title,o=i.indexOf(b),a=i.substring(0,o),d=i.slice(o+b.length),r=e=>{switch(e){case"db":return(0,l.jsx)(C,{});case"table":return(0,l.jsx)(z,{});default:return(0,l.jsx)(k,{})}},c=o>-1?(0,l.jsx)(s.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[r(t.type),"\xa0\xa0\xa0",a,(0,l.jsx)("span",{className:"text-[#1677ff]",children:b}),d,"\xa0",(null==t?void 0:t.type)&&(0,l.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})}):(0,l.jsx)(s.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[r(t.type),"\xa0\xa0\xa0",i,"\xa0",(null==t?void 0:t.type)&&(0,l.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})});if(t.children){let l=n?String(n)+"_"+t.key:t.key;return{title:i,showTitle:c,key:l,children:e(t.children,l)}}return{title:i,showTitle:c,key:t.key}});return(null==er?void 0:er.data)?(x([null==er?void 0:er.data.key]),e([null==er?void 0:er.data])):[]},[b,er]),ev=(0,i.useMemo)(()=>{let e=[],t=(n,l)=>{if(n&&!((null==n?void 0:n.length)<=0))for(let i=0;i<n.length;i++){let o=n[i],{key:a,title:s}=o;e.push({key:a,title:s,parentKey:l}),o.children&&t(o.children,a)}};return eu&&t(eu),e},[eu]),em=(e,t)=>{let n;for(let l=0;l<t.length;l++){let i=t[l];i.children&&(i.children.some(t=>t.key===e)?n=i.key:em(e,i.children)&&(n=em(e,i.children)))}return n};function eh(e){let t;if(!e)return{sql:"",thoughts:""};let n=e&&e.match(/(--.*)\n([\s\S]*)/),l="";return n&&n.length>=3&&(l=n[1],t=n[2]),{sql:t,thoughts:l}}return(0,i.useEffect)(()=>{j&&ec(j)},[ec,j]),(0,i.useEffect)(()=>{L&&"chat_dashboard"===J&&R&&el()},[R,J,L,el]),(0,i.useEffect)(()=>{L&&"chat_dashboard"!==J&&et()},[J,L,et]),(0,l.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,l.jsx)(f.Z,{}),(0,l.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,l.jsxs)("div",{className:"group/side relative mr-4",children:[(0,l.jsx)("div",{className:D()("h-full relative transition-[width] overflow-hidden",{"w-0":G,"w-64":!G}),children:(0,l.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,l.jsx)(d.default,{size:"middle",className:"w-full mb-2",value:j,options:null==Q?void 0:null===(c=Q.data)||void 0===c?void 0:c.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{_(e)}}),(0,l.jsx)(T,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:t}=e.target;if(null==er?void 0:er.data){if(t){let e=ev.map(e=>e.title.indexOf(t)>-1?em(e.key,eu):null).filter((e,t,n)=>e&&n.indexOf(e)===t);x(e)}else x([]);S(t),O(!0)}}}),eu&&eu.length>0&&(0,l.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,l.jsx)(u.Z,{onExpand:e=>{x(e),O(!1)},expandedKeys:m,autoExpandParent:$,treeData:eu,fieldNames:{title:"showTitle"}})})]})}),(0,l.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,l.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{F(!G)},children:G?(0,l.jsx)(y.Z,{}):(0,l.jsx)(g.Z,{})})})]}),(0,l.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(r.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,l.jsx)(w.Z,{}),loading:en||ei,onClick:async()=>{"chat_dashboard"===J?el():et()},children:"Run"}),(0,l.jsx)(r.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:ea||ed,icon:(0,l.jsx)(N,{}),onClick:async()=>{"chat_dashboard"===J?await es():await eo()},children:"Save"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(v.Z,{className:D()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===K}),component:E,onClick:()=>{U("TB")}}),(0,l.jsx)(v.Z,{className:D()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===K}),component:M,onClick:()=>{U("LR")}})]})]}),Array.isArray(L)?(0,l.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,l.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:L.map((e,t)=>(0,l.jsx)(s.Z,{className:"inline-block",title:e.title,children:(0,l.jsx)("div",{className:D()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":R===t}),onClick:()=>{X(t),V(null==L?void 0:L[t])},children:e.title})},e.title))}),(0,l.jsx)("div",{className:"flex flex-1 overflow-hidden",children:L.map((e,t)=>(0,l.jsx)("div",{className:D()("w-full overflow-hidden",{hidden:t!==R,"block flex-1":t===R}),children:(0,l.jsx)(Z,{layout:K,editorValue:e,handleChange:e=>{let{sql:t,thoughts:n}=eh(e);V(e=>Object.assign({},e,{sql:t,thoughts:n}))},tableData:B,chartData:q})},e.title))})]}):(0,l.jsx)(Z,{layout:K,editorValue:L,handleChange:e=>{let{sql:t,thoughts:n}=eh(e);V(e=>Object.assign({},e,{sql:t,thoughts:n}))},tableData:B,chartData:void 0,tables:er})]})]})]})}}}]);