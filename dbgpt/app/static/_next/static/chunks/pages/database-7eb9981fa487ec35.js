(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{55286:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/database",function(){return a(78466)}])},98978:function(e,s,a){"use strict";var l=a(85893),t=a(25675),r=a.n(t);s.Z=function(e){let{src:s,label:a,width:t,height:n,className:i}=e;return(0,l.jsx)(r(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:t||44,height:n||44,src:s,alt:a||"db-icon"})}},45247:function(e,s,a){"use strict";var l=a(85893),t=a(50888);s.Z=function(e){let{visible:s}=e;return s?(0,l.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,l.jsx)(t.Z,{})}):null}},78466:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return F},isFileDb:function(){return P}});var l=a(85893),t=a(67294),r=a(2093),n=a(12069),i=a(2453),c=a(71577),d=a(40411),o=a(85265),m=a(85813),u=a(32983),b=a(39479),p=a(51009),x=a(59566),h=a(48928),f=a(50489),j=a(67421),y=function(e){let{open:s,choiceDBType:a,dbTypeList:r,editValue:d,dbNames:o,onClose:m,onSuccess:u}=e,[y,_]=(0,t.useState)(!1),{t:Z}=(0,j.$G)(),[v]=b.Z.useForm(),w=b.Z.useWatch("db_type",v),N=(0,t.useMemo)(()=>P(r,w),[r,w]);(0,t.useEffect)(()=>{a&&v.setFieldValue("db_type",a)},[a]),(0,t.useEffect)(()=>{d&&v.setFieldsValue({...d})},[d]),(0,t.useEffect)(()=>{s||v.resetFields()},[s]);let g=async e=>{let{db_host:s,db_path:a,db_port:l,...t}=e;if(!d&&o.some(e=>e===t.db_name)){i.ZP.error("The database already exists!");return}let r={db_host:N?void 0:s,db_port:N?void 0:l,file_path:N?a:void 0,...t};_(!0);try{let[e]=await (0,f.Vx)((0,f.KS)(r));if(e)return;let[s]=await (0,f.Vx)((d?f.mR:f.b_)(r));if(s){i.ZP.error(s.message);return}i.ZP.success("success"),null==u||u()}catch(e){i.ZP.error(e.message)}finally{_(!1)}},k=(0,t.useMemo)(()=>!!d||!!a,[d,a]);return(0,l.jsx)(n.default,{open:s,width:400,title:Z(d?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:m,children:(0,l.jsxs)(b.Z,{form:v,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:g,children:[(0,l.jsx)(b.Z.Item,{name:"db_type",label:"DB Type",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(p.default,{"aria-readonly":k,disabled:k,options:r})}),(0,l.jsx)(b.Z.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(x.default,{readOnly:!!d,disabled:!!d})}),!0===N&&(0,l.jsx)(b.Z.Item,{name:"db_path",label:"Path",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(x.default,{})}),!1===N&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.Z.Item,{name:"db_user",label:"Username",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(x.default,{})}),(0,l.jsx)(b.Z.Item,{name:"db_pwd",label:"Password",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(x.default,{type:"password"})}),(0,l.jsx)(b.Z.Item,{name:"db_host",label:"Host",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(x.default,{})}),(0,l.jsx)(b.Z.Item,{name:"db_port",label:"Port",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(h.Z,{min:1,step:1,max:65535})})]}),(0,l.jsx)(b.Z.Item,{name:"comment",label:"Remark",className:"mb-3",children:(0,l.jsx)(x.default,{})}),(0,l.jsxs)(b.Z.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,l.jsx)(c.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:y,children:"Save"}),(0,l.jsx)(c.ZP,{size:"middle",onClick:m,children:"Cancel"})]})]})})},_=a(83062),Z=a(98978),v=function(e){let{info:s,onClick:a}=e,r=(0,t.useCallback)(()=>{s.disabled||null==a||a()},[s.disabled,a]);return(0,l.jsxs)("div",{className:"relative flex flex-col p-4 w-72 h-32 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 ".concat(s.disabled?"grayscale cursor-no-drop":"cursor-pointer"),onClick:r,children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(Z.Z,{src:s.icon,label:s.label}),(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("h2",{className:"text-sm font-semibold",children:s.label})})]}),(0,l.jsx)(_.Z,{title:s.desc,children:(0,l.jsx)("p",{className:"text-sm text-gray-500 font-normal line-clamp-2",children:s.desc})})]})},w=a(24969),N=a(36531),g=a(27704),k=a(45247),C=a(98399);function P(e,s){var a;return null===(a=e.find(e=>e.value===s))||void 0===a?void 0:a.isFileDb}var F=function(){let[e,s]=(0,t.useState)([]),[a,b]=(0,t.useState)([]),[p,x]=(0,t.useState)(!1),[h,j]=(0,t.useState)({open:!1}),[_,Z]=(0,t.useState)({open:!1}),P=async()=>{let[e,s]=await (0,f.Vx)((0,f.Jm)());b(null!=s?s:[])},F=async()=>{x(!0);let[e,a]=await (0,f.Vx)((0,f.Bw)());s(null!=a?a:[]),x(!1)},E=(0,t.useMemo)(()=>{let e=a.map(e=>{let{db_type:s,is_file_db:a}=e;return{...C.S$[s],value:s,isFileDb:a}}),s=Object.keys(C.S$).filter(s=>!e.some(e=>e.value===s)).map(e=>({...C.S$[e],value:C.S$[e].label,disabled:!0}));return[...e,...s]},[a]),S=e=>{j({open:!0,info:e})},T=e=>{n.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(s,a)=>{try{let[l]=await (0,f.Vx)((0,f.J5)(e.db_name));if(l){i.ZP.error(l.message),a();return}i.ZP.success("success"),F(),s()}catch(e){a()}})})},I=(0,t.useMemo)(()=>{let s=E.reduce((s,a)=>(s[a.value]=e.filter(e=>e.db_type===a.value),s),{});return s},[e,E]);(0,r.Z)(async()=>{await F(),await P()},[]);let D=s=>{let a=e.filter(e=>e.db_type===s.value);Z({open:!0,dbList:a,name:s.label,type:s.value})};return(0,l.jsxs)("div",{className:"relative p-4 md:p-6 bg-[#FAFAFA] dark:bg-transparent min-h-full overflow-y-auto",children:[(0,l.jsx)(k.Z,{visible:p}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(c.ZP,{type:"primary",className:"flex items-center",icon:(0,l.jsx)(w.Z,{}),onClick:()=>{j({open:!0})},children:"Create"})}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 md:gap-4",children:E.map(e=>(0,l.jsx)(d.Z,{count:I[e.value].length,children:(0,l.jsx)(v,{info:e,onClick:()=>{D(e)}})},e.value))}),(0,l.jsx)(y,{open:h.open,dbTypeList:E,choiceDBType:h.dbType,editValue:h.info,dbNames:e.map(e=>e.db_name),onSuccess:()=>{j({open:!1}),F()},onClose:()=>{j({open:!1})}}),(0,l.jsx)(o.Z,{title:_.name,placement:"right",onClose:()=>{Z({open:!1})},open:_.open,children:_.type&&I[_.type]&&I[_.type].length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,l.jsx)(w.Z,{}),onClick:()=>{j({open:!0,dbType:_.type})},children:"Create"}),I[_.type].map(e=>(0,l.jsxs)(m.Z,{title:e.db_name,extra:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{S(e)}}),(0,l.jsx)(g.Z,{style:{color:"#ff1b2e"},onClick:()=>{T(e)}})]}),className:"mb-4",children:[e.db_path?(0,l.jsxs)("p",{children:["path: ",e.db_path]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["host: ",e.db_host]}),(0,l.jsxs)("p",{children:["username: ",e.db_user]}),(0,l.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,l.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,l.jsx)(u.Z,{image:u.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(c.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(w.Z,{}),onClick:()=>{j({open:!0,dbType:_.type})},children:"Create Now"})})})]})}}},function(e){e.O(0,[113,17,9,479,442,813,411,928,643,774,888,179],function(){return e(e.s=55286)}),_N_E=e.O()}]);