(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{54681:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/knowledge",function(){return t(18671)}])},47207:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var s=t(85893),l=t(27595),n=t(27329),i=t(68346);function r(e){let{type:a}=e;return"TEXT"===a?(0,s.jsx)(l.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===a?(0,s.jsx)(n.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,s.jsx)(i.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"})}},18671:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return eu}});var s=t(85893),l=t(67294),n=t(24969),i=t(71577),r=t(12069),c=t(3363),o=t(46735),d=t(74627),m=t(40411),u=t(11163),x=t(25675),p=t.n(x),h=t(28058),_=t(31484),j=t(78346),f=t(83062),g=t(66309),N=t(85813),b=t(96074),y=t(32983),Z=t(42075),v=t(75081),w=t(31326),k=t(88008),T=t(27704),P=t(18754),S=t(50489),C=t(30381),I=t.n(C),D=t(59566),E=t(71230),F=t(15746),A=t(39479),U=t(44442),O=t(67421),V=t(31545),M=t(6321),z=t(90389);let{TextArea:R}=D.default;function q(e){let{space:a,argumentsShow:t,setArgumentsShow:n}=e,{t:c}=(0,O.$G)(),[o,d]=(0,l.useState)(),[m,u]=(0,l.useState)(!1),x=async()=>{let[e,t]=await (0,S.Vx)((0,S.Tu)(a.name));d(t)};(0,l.useEffect)(()=>{x()},[a.name]);let p=[{key:"Embedding",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(V.Z,{}),c("Embedding")]}),children:(0,s.jsxs)(E.Z,{gutter:24,children:[(0,s.jsx)(F.Z,{span:12,offset:0,children:(0,s.jsx)(A.Z.Item,{tooltip:c("the_top_k_vectors"),rules:[{required:!0}],label:c("topk"),name:["embedding","topk"],children:(0,s.jsx)(D.default,{className:"mb-5 h-12"})})}),(0,s.jsx)(F.Z,{span:12,children:(0,s.jsx)(A.Z.Item,{tooltip:c("Set_a_threshold_score"),rules:[{required:!0}],label:c("recall_score"),name:["embedding","recall_score"],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_owner")})})}),(0,s.jsx)(F.Z,{span:12,children:(0,s.jsx)(A.Z.Item,{tooltip:c("Recall_Type"),rules:[{required:!0}],label:c("recall_type"),name:["embedding","recall_type"],children:(0,s.jsx)(D.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(F.Z,{span:12,children:(0,s.jsx)(A.Z.Item,{tooltip:c("A_model_used"),rules:[{required:!0}],label:c("model"),name:["embedding","model"],children:(0,s.jsx)(D.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(F.Z,{span:12,children:(0,s.jsx)(A.Z.Item,{tooltip:c("The_size_of_the_data_chunks"),rules:[{required:!0}],label:c("chunk_size"),name:["embedding","chunk_size"],children:(0,s.jsx)(D.default,{className:"mb-5  h-12"})})}),(0,s.jsx)(F.Z,{span:12,children:(0,s.jsx)(A.Z.Item,{tooltip:c("The_amount_of_overlap"),rules:[{required:!0}],label:c("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:c("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(M.Z,{}),c("Prompt")]}),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Z.Item,{tooltip:c("A_contextual_parameter"),label:c("scene"),name:["prompt","scene"],children:(0,s.jsx)(R,{rows:4,className:"mb-2"})}),(0,s.jsx)(A.Z.Item,{tooltip:c("structure_or_format"),label:c("template"),name:["prompt","template"],children:(0,s.jsx)(R,{rows:7,className:"mb-2"})}),(0,s.jsx)(A.Z.Item,{tooltip:c("The_maximum_number_of_tokens"),label:c("max_token"),name:["prompt","max_token"],children:(0,s.jsx)(D.default,{className:"mb-2"})})]})},{key:"Summary",label:(0,s.jsxs)("div",{children:[(0,s.jsx)(z.Z,{}),c("Summary")]}),children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Z.Item,{rules:[{required:!0}],label:c("max_iteration"),name:["summary","max_iteration"],children:(0,s.jsx)(D.default,{className:"mb-2"})}),(0,s.jsx)(A.Z.Item,{rules:[{required:!0}],label:c("concurrency_limit"),name:["summary","concurrency_limit"],children:(0,s.jsx)(D.default,{className:"mb-2"})})]})}],h=async e=>{u(!0);let[t,s,l]=await (0,S.Vx)((0,S.iH)(a.name,{argument:JSON.stringify(e)}));u(!1),(null==l?void 0:l.success)&&n(!1)};return(0,s.jsx)(r.default,{width:850,open:t,onCancel:()=>{n(!1)},footer:null,children:(0,s.jsx)(v.Z,{spinning:m,children:(0,s.jsxs)(A.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...o},autoComplete:"off",onFinish:h,children:[(0,s.jsx)(U.Z,{items:p}),(0,s.jsxs)("div",{className:"mt-3 mb-3",children:[(0,s.jsx)(i.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:c("Submit")}),(0,s.jsx)(i.ZP,{onClick:()=>{n(!1)},children:c("close")})]})]})})})}var G=t(47207);let{confirm:L}=r.default;function H(e){let{space:a}=e,{t}=(0,O.$G)(),r=(0,u.useRouter)(),[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)([]),[x,p]=(0,l.useState)(!1),[_,j]=(0,l.useState)(0),C=(0,l.useRef)(1),D=(0,l.useMemo)(()=>d.length<_,[d.length,_]),E=e=>{L({title:t("Tips"),icon:(0,s.jsx)(h.Z,{}),content:"".concat(t("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await V(e)}})};async function F(){o(!0);let[e,t]=await (0,S.Vx)((0,S._Q)(a.name,{page:C.current,page_size:18}));m(null==t?void 0:t.data),j((null==t?void 0:t.total)||0),o(!1)}let A=async()=>{if(!D)return;o(!0),C.current+=1;let[e,t]=await (0,S.Vx)((0,S._Q)(a.name,{page:C.current,page_size:18}));m([...d,...t.data]),o(!1)},U=async(e,a)=>{await (0,S.Vx)((0,S.Hx)(e,{doc_ids:[a]}))},V=async t=>{await (0,S.Vx)((0,S.n3)(a.name,{doc_name:t.doc_name})),F(),e.onDeleteDoc()},M=()=>{e.onAddDoc(a.name)},z=(e,a)=>{let t;switch(e){case"TODO":t="gold";break;case"RUNNING":t="#2db7f5";break;case"FINISHED":t="#87d068";break;default:t="f50"}return(0,s.jsx)(f.Z,{title:a,children:(0,s.jsx)(g.Z,{color:t,children:e})})};return(0,l.useEffect)(()=>{F()},[a]),(0,s.jsxs)("div",{className:"collapse-container pt-2 px-4",children:[(0,s.jsxs)(Z.Z,{children:[(0,s.jsx)(i.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,s.jsx)(n.Z,{}),onClick:M,children:t("Add_Datasource")}),(0,s.jsx)(i.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,s.jsx)(P.Z,{}),onClick:()=>{p(!0)},children:"Arguments"})]}),(0,s.jsx)(b.Z,{}),(0,s.jsx)(v.Z,{spinning:c,children:(null==d?void 0:d.length)>0?(0,s.jsxs)("div",{className:"max-h-96 overflow-auto max-w-3/4",children:[(0,s.jsx)("div",{className:"mt-3 grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-5",children:d.map(e=>(0,s.jsxs)(N.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full",title:(0,s.jsx)(f.Z,{title:e.doc_name,children:(0,s.jsxs)("div",{className:"truncate ",children:[(0,s.jsx)(G.Z,{type:e.doc_type}),(0,s.jsx)("span",{children:e.doc_name})]})}),extra:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(f.Z,{title:"detail",children:(0,s.jsx)(w.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{r.push("/knowledge/chunk/?spaceName=".concat(a.name,"&id=").concat(e.id))}})}),(0,s.jsx)(f.Z,{title:"Sync",children:(0,s.jsx)(k.Z,{className:"mr-2 !text-lg",style:{color:"#1b7eff",fontSize:"20px"},onClick:()=>{U(a.name,e.id)}})}),(0,s.jsx)(f.Z,{title:"Delete",children:(0,s.jsx)(T.Z,{className:"text-[#ff1b2e] !text-lg",onClick:()=>{E(e)}})})]}),children:[(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Size"),":"]}),(0,s.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,s.jsxs)("p",{className:"mt-2 font-semibold ",children:[t("Last_Sync"),":"]}),(0,s.jsx)("p",{children:I()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,s.jsx)("p",{className:"mt-2 mb-2",children:z(e.status,e.result)})]},e.id))}),D&&(0,s.jsx)(b.Z,{children:(0,s.jsx)("span",{className:"cursor-pointer",onClick:A,children:t("Load_More")})})]}):(0,s.jsx)(y.Z,{image:y.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(i.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(n.Z,{}),onClick:M,children:"Create Now"})})}),(0,s.jsx)(q,{space:a,argumentsShow:x,setArgumentsShow:p})]})}var Y=t(19284);let{confirm:X}=r.default;function $(e){var a;let t=(0,u.useRouter)(),{t:l}=(0,O.$G)(),{space:n,getSpaces:r}=e,c=()=>{X({title:l("Tips"),icon:(0,s.jsx)(h.Z,{}),content:"".concat(l("Del_Knowledge_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await (0,S.Vx)((0,S.XK)({name:null==n?void 0:n.name})),r()}})},x=async e=>{e.stopPropagation();let[a,s]=await (0,S.Vx)((0,S.sW)({chat_mode:"chat_knowledge"}));(null==s?void 0:s.conv_uid)&&t.push("/chat?scene=chat_knowledge&id=".concat(null==s?void 0:s.conv_uid,"&db_param=").concat(n.name))};return(0,s.jsx)(o.ZP,{theme:{components:{Popover:{zIndexPopup:90}}},children:(0,s.jsx)(d.Z,{className:"dark:hover:border-white transition-all hover:shadow-md bg-[#FFFFFF] dark:bg-[#484848] cursor-pointer rounded-[10px] border border-gray-200 border-solid",placement:"bottom",trigger:"click",content:(0,s.jsx)(H,{space:n,onAddDoc:e.onAddDoc,onDeleteDoc:function(){r()}}),children:(0,s.jsxs)(m.Z,{className:"mr-4 mb-4 min-w-[200px] sm:w-60 lg:w-72",count:n.docs||0,children:[(0,s.jsxs)("div",{className:"flex justify-between mx-6 mt-3",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-black truncate",children:[(a=n.vector_type,(0,s.jsx)(p(),{className:"rounded-full w-8 h-8 border border-gray-200 object-contain bg-white inline-block",width:36,height:136,src:Y.l3[a]||"/models/knowledge-default.jpg",alt:"llm"})),(0,s.jsx)("span",{className:"dark:text-white ml-2",children:null==n?void 0:n.name})]}),(0,s.jsx)(_.Z,{onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),c()},twoToneColor:"#CD2029",className:"!text-2xl"})]}),(0,s.jsxs)("div",{className:"text-sm mt-2  p-6 pt-2 h-40",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[l("Owner"),":"]}),(0,s.jsx)("p",{className:" truncate",children:null==n?void 0:n.owner}),(0,s.jsxs)("p",{className:"font-semibold mt-2",children:[l("Description"),":"]}),(0,s.jsx)("p",{className:" line-clamp-2",children:null==n?void 0:n.desc}),(0,s.jsx)("p",{className:"font-semibold mt-2",children:"Last modify:"}),(0,s.jsx)("p",{className:" truncate",children:I()(n.gmt_modified).format("YYYY-MM-DD HH:MM:SS")})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(i.ZP,{size:"middle",onClick:x,className:"mr-4 dark:text-white mb-2",shape:"round",icon:(0,s.jsx)(j.Z,{}),children:l("Chat")})})]})})})}var K=t(84553),W=t(2453),B=t(64082);let{Dragger:Q}=K.default,{TextArea:J}=D.default;function ee(e){let{handleStepChange:a,spaceName:t,docType:n}=e,{t:r}=(0,O.$G)(),[c]=A.Z.useForm(),[o,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)([]),x=async e=>{let s;let{docName:l,textSource:i,text:r,webPageUrl:c}=e;switch(d(!0),n){case"URL":[,s]=await (0,S.Vx)((0,S.H_)(t,{doc_name:l,content:c,doc_type:"URL"}));break;case"TEXT":[,s]=await (0,S.Vx)((0,S.H_)(t,{doc_name:l,source:i,content:r,doc_type:"TEXT"}))}return(d(!1),"DOCUMENT"===n&&m.length<1)?W.ZP.error("Upload failed, please re-upload."):"DOCUMENT"===n||s?void a({label:"forward",files:"DOCUMENT"===n?m:[{name:l,doc_id:s||-1}]}):W.ZP.error("Upload failed, please re-upload.")},p=e=>{let{file:a,fileList:t}=e;0===t.length&&c.setFieldValue("originFileObj",null)},h=async e=>{let{onSuccess:a,onError:s,file:l}=e,n=new FormData,i=null==l?void 0:l.name;n.append("doc_name",i),n.append("doc_file",l),n.append("doc_type","DOCUMENT");let[,r]=await (0,S.Vx)((0,S.iG)(t,n));Number.isInteger(r)?(a&&a(r||0),u(e=>(e.push({name:i,doc_id:r||-1}),e))):s&&s({name:"",message:""})},_=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Z.Item,{label:"".concat(r("Name"),":"),name:"docName",rules:[{required:!0,message:r("Please_input_the_name")}],children:(0,s.jsx)(D.default,{className:"mb-5 h-12",placeholder:r("Please_input_the_name")})}),(0,s.jsx)(A.Z.Item,{label:"".concat(r("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:r("Please_input_the_text_source")}],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_text_source")})}),(0,s.jsx)(A.Z.Item,{label:"".concat(r("Text"),":"),name:"text",rules:[{required:!0,message:r("Please_input_the_description")}],children:(0,s.jsx)(J,{rows:4})})]}),j=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Z.Item,{label:"".concat(r("Name"),":"),name:"docName",rules:[{required:!0,message:r("Please_input_the_name")}],children:(0,s.jsx)(D.default,{className:"mb-5 h-12",placeholder:r("Please_input_the_name")})}),(0,s.jsx)(A.Z.Item,{label:"".concat(r("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:r("Please_input_the_Web_Page_URL")}],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_Web_Page_URL")})})]}),f=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(A.Z.Item,{name:"originFileObj",rules:[{required:!0,message:r("Please_select_file")}],children:(0,s.jsxs)(Q,{multiple:!0,onChange:p,maxCount:10,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",customRequest:h,children:[(0,s.jsx)("p",{className:"ant-upload-drag-icon",children:(0,s.jsx)(B.Z,{})}),(0,s.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:r("Select_or_Drop_file")}),(0,s.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})})});return(0,s.jsx)(v.Z,{spinning:o,children:(0,s.jsxs)(A.Z,{form:c,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:x,children:[(()=>{switch(n){case"URL":return j();case"DOCUMENT":return f();default:return _()}})(),(0,s.jsxs)(A.Z.Item,{children:[(0,s.jsx)(i.ZP,{onClick:()=>{a({label:"back"})},className:"mr-4",children:"".concat(r("Back"))}),(0,s.jsx)(i.ZP,{type:"primary",loading:o,htmlType:"submit",children:r("Next")})]})]})})}function ea(e){let{t:a}=(0,O.$G)(),{handleStepChange:t}=e,[n,r]=(0,l.useState)(!1),c=async e=>{let{spaceName:a,owner:s,description:l}=e;r(!0);let[n,i,c]=await (0,S.Vx)((0,S.be)({name:a,vector_type:"Chroma",owner:s,desc:l}));r(!1),(null==c?void 0:c.success)&&t({label:"forward",spaceName:a})};return(0,s.jsx)(v.Z,{spinning:n,children:(0,s.jsxs)(A.Z,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:c,children:[(0,s.jsx)(A.Z.Item,{label:a("Knowledge_Space_Name"),name:"spaceName",rules:[{required:!0,message:a("Please_input_the_name")},()=>({validator:(e,t)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(t)?Promise.reject(Error(a("the_name_can_only_contain"))):Promise.resolve()})],children:(0,s.jsx)(D.default,{className:"mb-5 h-12",placeholder:a("Please_input_the_name")})}),(0,s.jsx)(A.Z.Item,{label:a("Owner"),name:"owner",rules:[{required:!0,message:a("Please_input_the_owner")}],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:a("Please_input_the_owner")})}),(0,s.jsx)(A.Z.Item,{label:a("Description"),name:"description",rules:[{required:!0,message:a("Please_input_the_description")}],children:(0,s.jsx)(D.default,{className:"mb-5  h-12",placeholder:a("Please_input_the_description")})}),(0,s.jsx)(A.Z.Item,{children:(0,s.jsx)(i.ZP,{type:"primary",htmlType:"submit",children:a("Next")})})]})})}function et(e){let{t:a}=(0,O.$G)(),{handleStepChange:t}=e,l=[{type:"TEXT",title:a("Text"),subTitle:a("Fill your raw text"),iconType:"TEXT"},{type:"URL",title:a("URL"),subTitle:a("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"DOCUMENT",title:a("Document"),subTitle:a("Upload_a_document"),iconType:"DOCUMENT"}];return(0,s.jsx)(s.Fragment,{children:l.map((e,a)=>(0,s.jsxs)(N.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{t({label:"forward",docType:e.type})},children:[(0,s.jsxs)("div",{className:"font-semibold",children:[(0,s.jsx)(G.Z,{type:e.iconType}),e.title]}),(0,s.jsx)("div",{children:e.subTitle})]},a))})}var es=t(38925),el=t(47221),en=t(16165),ei=t(48928),er=t(78045);let{TextArea:ec}=D.default;function eo(e){let{strategies:a,docType:t,fileName:n,field:i}=e,r="";if("DOCUMENT"===t){let e=n.split(".");r=e[e.length-1]}let c=r?a.filter(e=>e.suffix.indexOf(r)>-1):a,[o,d]=(0,l.useState)(),{t:m}=(0,O.$G)(),u={strategy:m("Automatic"),name:m("Automatic"),desc:m("Automatic_desc")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.Z.Item,{name:[i.name,"chunk_parameters","chunk_strategy"],initialValue:u.strategy,children:(0,s.jsxs)(er.ZP.Group,{style:{marginTop:16},onChange:function(e){d(e.target.value)},children:[(0,s.jsx)(er.ZP,{value:u.strategy,children:u.name}),c.map(e=>(0,s.jsx)(er.ZP,{value:e.strategy,children:e.name},"strategy_radio_".concat(e.strategy)))]})}),function(){if(!o)return null;if(o===u.name)return(0,s.jsx)("p",{className:"my-4",children:u.desc});let e=null==c?void 0:c.filter(e=>e.strategy===o)[0].parameters;return e&&e.length?(0,s.jsx)("div",{className:"mt-2",children:null==e?void 0:e.map(e=>(0,s.jsx)(A.Z.Item,{label:"".concat(e.param_name,": ").concat(e.param_type),name:[i.name,"chunk_parameters",e.param_name],rules:[{required:!0,message:m("Please_input_the_name")}],initialValue:e.default_value,children:"int"===e.param_type?(0,s.jsx)(ei.Z,{className:"w-full",min:1}):(0,s.jsx)(ec,{className:"w-full",rows:2,maxLength:6})},"param_".concat(e.param_name)))}):(0,s.jsx)(es.Z,{className:"my-2",type:"warning",message:m("No_parameter")})}()]})}var ed=t(5455);function em(e){let{spaceName:a,docType:t,uploadFiles:n,handleStepChange:r}=e,{t:c}=(0,O.$G)(),[o]=A.Z.useForm(),[d,m]=(0,l.useState)(n),[u,x]=(0,l.useState)(),[p,h]=(0,l.useState)([]),[_,j]=(0,l.useState)("");async function f(){var e;x(!0);let[,a]=await (0,S.Vx)((0,S.iZ)());x(!1),h(null===(e=a||[])||void 0===e?void 0:e.filter(e=>e.type.indexOf(t)>-1))}(0,l.useEffect)(()=>{f()},[]);let g=async e=>{if(function(e){let a=!0;"RUNNING"===_&&(a=!1,W.ZP.warning("The task is still running, do not submit it again."));let{fileStrategies:t}=e;return t.map(e=>{var t;(null==e?void 0:null===(t=e.chunk_parameters)||void 0===t?void 0:t.chunk_strategy)||(W.ZP.error("Please select chunk strategy for ".concat(e.name,".")),a=!1)}),a}(e)){var t;x(!0);let[,s]=await (0,S.Vx)((0,S.KL)(a,e.fileStrategies));if(x(!1),(null==s?void 0:s.tasks)&&(null==s?void 0:null===(t=s.tasks)||void 0===t?void 0:t.length)>0){W.ZP.success("Segemation task start successfully. task id: ".concat(null==s?void 0:s.tasks.join(","))),j("RUNNING");let a=e.fileStrategies.map(e=>e.doc_id),t=setInterval(async()=>{let e=await N(a);"FINISHED"===e&&(clearInterval(t),j("FINISHED"),W.ZP.success("Congratulation, All files sync successfully."),r({label:"finish"}))},3e3)}}};async function N(e){let[,t]=await (0,S.Vx)((0,S._Q)(a,{doc_ids:e}));if((null==t?void 0:t.data)&&(null==t?void 0:t.data.length)>0){let e=[...d];if(null==t||t.data.map(a=>{var t;let s=null===(t=null==e?void 0:e.filter(e=>e.doc_id===a.id))||void 0===t?void 0:t[0];s&&(s.status=a.status)}),m(e),null==t?void 0:t.data.every(e=>"FINISHED"===e.status))return"FINISHED"}}return(0,s.jsx)(v.Z,{spinning:u,children:(0,s.jsxs)(A.Z,{labelCol:{span:6},wrapperCol:{span:18},labelAlign:"right",form:o,size:"large",className:"mt-4",layout:"horizontal",name:"basic",autoComplete:"off",initialValues:{fileStrategies:d},onFinish:g,children:[p&&p.length?(0,s.jsx)(A.Z.List,{name:"fileStrategies",children:e=>{switch(t){case"TEXT":case"URL":return null==e?void 0:e.map(e=>(0,s.jsx)(eo,{strategies:p,docType:t,fileName:d[e.name].name,field:e}));case"DOCUMENT":return(0,s.jsx)(el.Z,{defaultActiveKey:0,size:d.length>5?"small":"middle",children:null==e?void 0:e.map(e=>(0,s.jsx)(el.Z.Panel,{header:"".concat(e.name+1,". ").concat(d[e.name].name),extra:function(e){let a=d[e].status;switch(a){case"FINISHED":return(0,s.jsx)(en.Z,{component:ed.qw});case"RUNNING":return(0,s.jsx)(en.Z,{className:"rotate-animation",component:ed.bn});default:return(0,s.jsx)(en.Z,{component:ed.tu})}}(e.name),children:(0,s.jsx)(eo,{strategies:p,docType:t,fileName:d[e.name].name,field:e})},e.key))})}}}):(0,s.jsx)(es.Z,{message:"Cannot find one strategy for ".concat(t," type knowledge."),type:"warning"}),(0,s.jsxs)(A.Z.Item,{className:"mt-4",children:[(0,s.jsx)(i.ZP,{onClick:()=>{r({label:"back"})},className:"mr-4",children:"".concat(c("Back"))}),(0,s.jsx)(i.ZP,{type:"primary",htmlType:"submit",loading:u||"RUNNING"===_,children:c("Process")})]})]})})}var eu=()=>{let[e,a]=(0,l.useState)([]),[t,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(0),[u,x]=(0,l.useState)(""),[p,h]=(0,l.useState)([]),[_,j]=(0,l.useState)(""),{t:f}=(0,O.$G)(),g=[{title:f("Knowledge_Space_Config")},{title:f("Choose_a_Datasource_type")},{title:f("Upload")},{title:f("Segmentation")}];async function N(){let[e,t]=await (0,S.Vx)((0,S.Vm)());a(t)}(0,l.useEffect)(()=>{N()},[]);let b=e=>{let{label:a,spaceName:t,docType:s,files:l}=e;"finish"===a?(o(!1),N(),x(""),j(""),N()):"forward"===a?(0===d&&N(),m(e=>e+1)):m(e=>e-1),l&&h(l),t&&x(t),s&&j(s)};function y(e){x(e),m(1),o(!0)}return(0,s.jsxs)("div",{className:"bg-[#FAFAFA] dark:bg-[#212121] w-full h-full",children:[(0,s.jsxs)("div",{className:"page-body p-4 md:p-6 h-full overflow-auto",children:[(0,s.jsx)(i.ZP,{type:"primary",className:"flex items-center",icon:(0,s.jsx)(n.Z,{}),onClick:()=>{o(!0)},children:"Create"}),(0,s.jsx)("div",{className:"flex flex-wrap mt-4",children:null==e?void 0:e.map(e=>(0,s.jsx)($,{space:e,onAddDoc:y,getSpaces:N},e.id))})]}),(0,s.jsxs)(r.default,{title:"Add Knowledge",centered:!0,open:t,destroyOnClose:!0,onCancel:()=>{o(!1)},width:1e3,afterClose:()=>{m(0)},footer:null,children:[(0,s.jsx)(c.Z,{current:d,items:g}),0===d&&(0,s.jsx)(ea,{handleStepChange:b}),1===d&&(0,s.jsx)(et,{handleStepChange:b}),2===d&&(0,s.jsx)(ee,{spaceName:u,docType:_,handleStepChange:b}),3===d&&(0,s.jsx)(em,{spaceName:u,docType:_,uploadFiles:p,handleStepChange:b})]})]})}}},function(e){e.O(0,[885,64,479,442,553,813,924,411,45,928,464,774,888,179],function(){return e(e.s=54681)}),_N_E=e.O()}]);