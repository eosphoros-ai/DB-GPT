(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{55286:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/database",function(){return l(78466)}])},98978:function(e,s,l){"use strict";var a=l(85893),t=l(25675),r=l.n(t);s.Z=function(e){let{src:s,label:l,width:t,height:n,className:i}=e;return(0,a.jsx)(r(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:t||44,height:n||44,src:s,alt:l||"db-icon"})}},45247:function(e,s,l){"use strict";var a=l(85893),t=l(50888);s.Z=function(e){let{visible:s}=e;return s?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(t.Z,{})}):null}},78466:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return F},isFileDb:function(){return P}});var a=l(85893),t=l(67294),r=l(2093),n=l(12069),i=l(2453),c=l(71577),d=l(40411),o=l(85265),m=l(85813),u=l(32983),b=l(39479),p=l(51009),x=l(59566),h=l(48928),f=l(50489),j=l(67421),y=function(e){let{open:s,choiceDBType:l,dbTypeList:r,editValue:d,dbNames:o,onClose:m,onSuccess:u}=e,[y,Z]=(0,t.useState)(!1),{t:_}=(0,j.$G)(),[v]=b.Z.useForm(),N=b.Z.useWatch("db_type",v),w=(0,t.useMemo)(()=>P(r,N),[r,N]);(0,t.useEffect)(()=>{l&&v.setFieldValue("db_type",l)},[l]),(0,t.useEffect)(()=>{d&&v.setFieldsValue({...d})},[d]),(0,t.useEffect)(()=>{s||v.resetFields()},[s]);let g=async e=>{let{db_host:s,db_path:l,db_port:a,...t}=e;if(!d&&o.some(e=>e===t.db_name)){i.ZP.error("The database already exists!");return}let r={db_host:w?void 0:s,db_port:w?void 0:a,file_path:w?l:void 0,...t};Z(!0);try{let[e]=await (0,f.Vx)((0,f.KS)(r));if(e)return;let[s]=await (0,f.Vx)((d?f.mR:f.b_)(r));if(s){i.ZP.error(s.message);return}i.ZP.success("success"),null==u||u()}catch(e){i.ZP.error(e.message)}finally{Z(!1)}},k=(0,t.useMemo)(()=>!!d||!!l,[d,l]);return(0,a.jsx)(n.default,{open:s,width:400,title:_(d?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:m,children:(0,a.jsxs)(b.Z,{form:v,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:g,children:[(0,a.jsx)(b.Z.Item,{name:"db_type",label:"DB Type",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(p.default,{"aria-readonly":k,disabled:k,options:r})}),(0,a.jsx)(b.Z.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(x.default,{readOnly:!!d,disabled:!!d})}),!0===w&&(0,a.jsx)(b.Z.Item,{name:"db_path",label:"Path",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(x.default,{})}),!1===w&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z.Item,{name:"db_user",label:"Username",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(x.default,{})}),(0,a.jsx)(b.Z.Item,{name:"db_pwd",label:"Password",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(x.default,{type:"password"})}),(0,a.jsx)(b.Z.Item,{name:"db_host",label:"Host",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(x.default,{})}),(0,a.jsx)(b.Z.Item,{name:"db_port",label:"Port",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(h.Z,{min:1,step:1,max:65535})})]}),(0,a.jsx)(b.Z.Item,{name:"comment",label:"Remark",className:"mb-3",children:(0,a.jsx)(x.default,{})}),(0,a.jsxs)(b.Z.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,a.jsx)(c.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:y,children:"Save"}),(0,a.jsx)(c.ZP,{size:"middle",onClick:m,children:"Cancel"})]})]})})},Z=l(83062),_=l(98978),v=function(e){let{info:s,onClick:l}=e,r=(0,t.useCallback)(()=>{s.disabled||null==l||l()},[s.disabled,l]);return(0,a.jsxs)("div",{className:"relative flex flex-col py-4 px-4 w-72 h-32 cursor-pointer rounded-lg justify-between text-black bg-white border-gray-200 border hover:shadow-md dark:border-gray-600 dark:bg-black dark:text-white dark:hover:border-white transition-all ".concat(s.disabled?"grayscale cursor-no-drop":""),onClick:r,children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(_.Z,{src:s.icon,label:s.label}),(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)("h2",{className:"text-sm font-semibold",children:s.label})})]}),(0,a.jsx)(Z.Z,{title:s.desc,children:(0,a.jsx)("p",{className:"text-sm text-gray-500 font-normal line-clamp-2",children:s.desc})})]})},N=l(24969),w=l(36531),g=l(27704),k=l(45247),C=l(98399);function P(e,s){var l;return null===(l=e.find(e=>e.value===s))||void 0===l?void 0:l.isFileDb}var F=function(){let[e,s]=(0,t.useState)([]),[l,b]=(0,t.useState)([]),[p,x]=(0,t.useState)(!1),[h,j]=(0,t.useState)({open:!1}),[Z,_]=(0,t.useState)({open:!1}),P=async()=>{let[e,s]=await (0,f.Vx)((0,f.Jm)());b(null!=s?s:[])},F=async()=>{x(!0);let[e,l]=await (0,f.Vx)((0,f.Bw)());s(null!=l?l:[]),x(!1)},E=(0,t.useMemo)(()=>{let e=l.map(e=>{let{db_type:s,is_file_db:l}=e;return{...C.S$[s],value:s,isFileDb:l}}),s=Object.keys(C.S$).filter(s=>!e.some(e=>e.value===s)).map(e=>({...C.S$[e],value:C.S$[e].label,disabled:!0}));return[...e,...s]},[l]),S=e=>{j({open:!0,info:e})},T=e=>{n.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(s,l)=>{try{let[a]=await (0,f.Vx)((0,f.J5)(e.db_name));if(a){i.ZP.error(a.message),l();return}i.ZP.success("success"),F(),s()}catch(e){l()}})})},I=(0,t.useMemo)(()=>{let s=E.reduce((s,l)=>(s[l.value]=e.filter(e=>e.db_type===l.value),s),{});return s},[e,E]);(0,r.Z)(async()=>{await F(),await P()},[]);let D=s=>{let l=e.filter(e=>e.db_type===s.value);_({open:!0,dbList:l,name:s.label,type:s.value})};return(0,a.jsxs)("div",{className:"relative p-4 md:p-6 bg-[#FAFAFA] dark:bg-transparent min-h-full overflow-y-auto",children:[(0,a.jsx)(k.Z,{visible:p}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(c.ZP,{type:"primary",className:"flex items-center",icon:(0,a.jsx)(N.Z,{}),onClick:()=>{j({open:!0})},children:"Create"})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 md:gap-4",children:E.map(e=>(0,a.jsx)(d.Z,{count:I[e.value].length,children:(0,a.jsx)(v,{info:e,onClick:()=>{D(e)}})},e.value))}),(0,a.jsx)(y,{open:h.open,dbTypeList:E,choiceDBType:h.dbType,editValue:h.info,dbNames:e.map(e=>e.db_name),onSuccess:()=>{j({open:!1}),F()},onClose:()=>{j({open:!1})}}),(0,a.jsx)(o.Z,{title:Z.name,placement:"right",onClose:()=>{_({open:!1})},open:Z.open,children:Z.type&&I[Z.type]&&I[Z.type].length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,a.jsx)(N.Z,{}),onClick:()=>{j({open:!0,dbType:Z.type})},children:"Create"}),I[Z.type].map(e=>(0,a.jsxs)(m.Z,{title:e.db_name,extra:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{S(e)}}),(0,a.jsx)(g.Z,{style:{color:"#ff1b2e"},onClick:()=>{T(e)}})]}),className:"mb-4",children:[e.db_path?(0,a.jsxs)("p",{children:["path: ",e.db_path]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["host: ",e.db_host]}),(0,a.jsxs)("p",{children:["username: ",e.db_user]}),(0,a.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,a.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,a.jsx)(u.Z,{image:u.Z.PRESENTED_IMAGE_DEFAULT,children:(0,a.jsx)(c.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,a.jsx)(N.Z,{}),onClick:()=>{j({open:!0,dbType:Z.type})},children:"Create Now"})})})]})}}},function(e){e.O(0,[64,479,9,442,813,411,928,643,774,888,179],function(){return e(e.s=55286)}),_N_E=e.O()}]);