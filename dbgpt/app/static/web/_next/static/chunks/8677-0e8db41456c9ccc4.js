(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8677],{79870:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var i=n(34548),r=n(38497),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},o=n(66956),a=r.forwardRef(function(t,e){return r.createElement(o.Z,(0,i.Z)({},t,{ref:e,icon:s}))})},49212:function(t){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports={assign:Object.assign,getHeight:function(t,e,n,i){return void 0===i&&(i="height"),"center"===n?(t[i]+e[i])/2:t.height}}},function(t,e,n){var i=n(3),r=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.rootNode=i(t,e)}return t.prototype.execute=function(){throw Error("please override this method")},t}();t.exports=r},function(t,e,n){var i=n(4),r=["LR","RL","TB","BT","H","V"],s=["LR","RL","H"],o=r[0];t.exports=function(t,e,n){var a=e.direction||o;if(e.isHorizontal=s.indexOf(a)>-1,a&&-1===r.indexOf(a))throw TypeError("Invalid direction: "+a);if(a===r[0])n(t,e);else if(a===r[1])n(t,e),t.right2left();else if(a===r[2])n(t,e);else if(a===r[3])n(t,e),t.bottom2top();else if(a===r[4]||a===r[5]){var l=i(t,e),h=l.left,d=l.right;n(h,e),n(d,e),e.isHorizontal?h.right2left():h.bottom2top(),d.translate(h.x-d.x,h.y-d.y),t.x=h.x,t.y=d.y;var c=t.getBoundingBox();e.isHorizontal?c.top<0&&t.translate(0,-c.top):c.left<0&&t.translate(-c.left,0)}var u=e.fixedRoot;return void 0===u&&(u=!0),u&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),function(t,e){if(e.radial){var n=e.isHorizontal?["x","y"]:["y","x"],i=n[0],r=n[1],s={x:1/0,y:1/0},o={x:-1/0,y:-1/0},a=0;t.DFTraverse(function(t){a++;var e=t.x,n=t.y;s.x=Math.min(s.x,e),s.y=Math.min(s.y,n),o.x=Math.max(o.x,e),o.y=Math.max(o.y,n)});var l=o[r]-s[r];if(0!==l){var h=2*Math.PI/a;t.DFTraverse(function(e){var n=(e[r]-s[r])/l*(2*Math.PI-h)+h,o=e[i]-t[i];e.x=Math.cos(n)*o,e.y=Math.sin(n)*o})}}}(t,e),t}},function(t,e,n){var i=n(0),r={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function s(t,e){if(this.vgap=this.hgap=0,t instanceof s)return t;this.data=t;var n=e.getHGap(t),i=e.getVGap(t);return this.preH=e.getPreH(t),this.preV=e.getPreV(t),this.width=e.getWidth(t),this.height=e.getHeight(t),this.width+=this.preH,this.height+=this.preV,this.id=e.getId(t),this.x=this.y=0,this.depth=0,this.children||(this.children=[]),this.addGap(n,i),this}i.assign(s.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode(function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)}),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode(function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV})},right2left:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.x=e.x-(e.x-t.left)*2-e.width}),this.translate(t.width,0)},bottom2top:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.y=e.y-(e.y-t.top)*2-e.height}),this.translate(0,t.height)}}),t.exports=function(t,e,n){void 0===e&&(e={}),e=i.assign({},r,e);var o,a=new s(t,e),l=[a];if(!n&&!t.collapsed){for(;o=l.shift();)if(!o.data.collapsed){var h=e.getChildren(o.data),d=h?h.length:0;if(o.children=Array(d),h&&d)for(var c=0;c<d;c++){var u=new s(h[c],e);o.children[c]=u,l.push(u),u.parent=o,u.depth=o.depth+1}}}return a}},function(t,e,n){var i=n(3);t.exports=function(t,e){for(var n=i(t.data,e,!0),r=i(t.data,e,!0),s=t.children.length,o=Math.round(s/2),a=e.getSide||function(t,e){return e<o?"right":"left"},l=0;l<s;l++){var h=t.children[l];"right"===a(h,l)?r.children.push(h):n.children.push(h)}return n.eachNode(function(t){t.isRoot()||(t.side="left")}),r.eachNode(function(t){t.isRoot()||(t.side="right")}),{left:n,right:r}}},function(t,e,n){var i={compactBox:n(6),dendrogram:n(8),indented:n(10),mindmap:n(12)};t.exports=i},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),s=n(7),o=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return o(this.rootNode,this.options,s)},e}(r),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e){function n(t,e,n,i){void 0===i&&(i=[]),this.w=t||0,this.h=e||0,this.y=n||0,this.x=0,this.c=i||[],this.cs=i.length,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}n.fromNode=function(t,e){if(!t)return null;var i=[];return(t.children.forEach(function(t){i.push(n.fromNode(t,e))}),e)?new n(t.height,t.width,t.x,i):new n(t.width,t.height,t.y,i)},t.exports=function(t,e){void 0===e&&(e={});var i,r=e.isHorizontal;function s(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function o(t){return t.y+t.h}function a(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}!function t(e,n,i){void 0===i&&(i=0),n?(e.x=i,i+=e.width):(e.y=i,i+=e.height),e.children.forEach(function(e){t(e,n,i)})}(t,r);var l=n.fromNode(t,r);return function t(e){if(0===e.cs){s(e);return}t(e.c[0]);for(var n=a(o(e.c[0].el),0,null),i=1;i<e.cs;++i){t(e.c[i]);var r=o(e.c[i].er);(function(t,e,n){for(var i=t.c[e-1],r=i.mod,s=t.c[e],a=s.mod;null!==i&&null!==s;){o(i)>n.low&&(n=n.nxt);var l,h,d,c=r+i.prelim+i.w-(a+s.prelim);c>0&&(a+=c,l=n.index,t.c[e].mod+=c,t.c[e].msel+=c,t.c[e].mser+=c,function(t,e,n,i){if(n!==e-1){var r=e-n;t.c[n+1].shift+=i/r,t.c[e].shift-=i/r,t.c[e].change-=i-i/r}}(t,e,l,c));var u=o(i),p=o(s);u<=p&&null!==(i=0===(h=i).cs?h.tr:h.c[h.cs-1])&&(r+=i.mod),u>=p&&null!==(s=0===(d=s).cs?d.tl:d.c[0])&&(a+=s.mod)}!i&&s?function(t,e,n,i){var r=t.c[0].el;r.tl=n;var s=i-n.mod-t.c[0].msel;r.mod+=s,r.prelim-=s,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,s,a):i&&!s&&function(t,e,n,i){var r=t.c[e].er;r.tr=n;var s=i-n.mod-t.c[e].mser;r.mod+=s,r.prelim-=s,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,i,r)})(e,i,n),n=a(r,i,n)}e.prelim=(e.c[0].prelim+e.c[0].mod+e.c[e.cs-1].mod+e.c[e.cs-1].prelim+e.c[e.cs-1].w)/2-e.w/2,s(e)}(l),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,i=0;i<t.cs;i++)e+=t.c[i].shift,n+=e+t.c[i].change,t.c[i].mod+=n}(e);for(var i=0;i<e.cs;i++)t(e.c[i],n)}(l,0),function t(e,n,i){i?n.y=e.x:n.x=e.x,e.c.forEach(function(e,r){t(e,n.children[r],i)})}(l,t,r),i=function t(e,n){var i=n?e.y:e.x;return e.children.forEach(function(e){i=Math.min(t(e,n),i)}),i}(t,r),function t(e,n,i){i?e.y+=n:e.x+=n,e.children.forEach(function(e){t(e,n,i)})}(t,-i,r),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),s=n(9),o=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return this.rootNode.width=0,o(this.rootNode,this.options,s)},e}(r),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0);function r(t,e){void 0===t&&(t=0),void 0===e&&(e=[]),this.x=this.y=0,this.leftChild=this.rightChild=null,this.height=0,this.children=e}var s={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},s,e);var n,o=0,a=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>o&&(o=e.depth);var n=e.children,i=n.length,s=new r(e.height,[]);return n.forEach(function(e,n){var r=t(e);s.children.push(r),0===n&&(s.leftChild=r),n===i-1&&(s.rightChild=r)}),s.originNode=e,s.isLeaf=e.isLeaf(),s}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=o;else{var n=e.children.map(function(e){return t(e)}),i=Math.min.apply(null,n);e.drawingDepth=i-1}return e.drawingDepth}(a),function t(i){i.x=i.drawingDepth*e.rankSep,i.isLeaf?(i.y=0,n&&(i.y=n.y+n.height+e.nodeSep,i.originNode.parent!==n.originNode.parent&&(i.y+=e.subTreeSep)),n=i):(i.children.forEach(function(e){t(e)}),i.y=(i.leftChild.y+i.rightChild.y)/2)}(a),function t(e,n,i){i?(n.x=e.x,n.y=e.y):(n.x=e.y,n.y=e.x),e.children.forEach(function(e,r){t(e,n.children[r],i)})}(a,t,e.isHorizontal),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),s=n(11),o=n(4),a=n(0),l=["LR","RL","H"],h=l[0],d=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,i=void 0===n?20:n,r=t.dropCap,a=void 0===r||r,d=t.direction,c=void 0===d?h:d,u=t.align;if(c&&-1===l.indexOf(c))throw TypeError("Invalid direction: "+c);if(c===l[0])s(e,i,a,u);else if(c===l[1])s(e,i,a,u),e.right2left();else if(c===l[2]){var p=o(e,t),g=p.left,f=p.right;s(g,i,a,u),g.right2left(),s(f,i,a,u);var y=g.getBoundingBox();f.translate(y.width,0),e.x=f.x-e.width/2}return e},e}(r),c={};t.exports=function(t,e){return e=a.assign({},c,e),new d(t,e).execute()}},function(t,e,n){var i=n(0);t.exports=function(t,e,n,r){var s=null;t.eachNode(function(t){(function(t,e,n,r,s){var o=("function"==typeof n?n(t):n)*t.depth;if(!r)try{if(t.id===t.parent.children[0].id){t.x+=o,t.y=e?e.y:0;return}}catch(t){}if(t.x+=o,e){if(t.y=e.y+i.getHeight(e,t,s),e.parent&&t.parent.id!==e.parent.id){var a=e.parent,l=a.y+i.getHeight(a,t,s);t.y=l>t.y?l:t.y}}else t.y=0})(t,s,e,n,r),s=t})}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),s=n(13),o=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return o(this.rootNode,this.options,s)},e}(r),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0),r={getSubTreeSep:function(){return 0}};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},r,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse(function(t){t.x=t.parent.x+t.parent.width}),t.parent=null,function t(e,n){var i=0;return e.children.length?e.children.forEach(function(e){i+=t(e,n)}):i=e.height,e._subTreeSep=n.getSubTreeSep(e.data),e.totalHeight=Math.max(e.height,i)+2*e._subTreeSep,e.totalHeight}(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode(function(t){var e=t.children,n=e.length;if(n){var i=e[0];if(i.startY=t.startY+t._subTreeSep,1===n)i.y=t.y+t.height/2-i.height/2;else{i.y=i.startY+i.totalHeight/2-i.height/2;for(var r=1;r<n;r++){var s=e[r];s.startY=e[r-1].startY+e[r-1].totalHeight,s.y=s.startY+s.totalHeight/2-s.height/2}}}}),function t(e){var n=e.children,i=n.length;if(i){n.forEach(function(e){t(e)});var r=n[0],s=n[i-1],o=s.y-r.y+s.height,a=0;if(n.forEach(function(t){a+=t.totalHeight}),o>e.height)e.y=r.y+o/2-e.height/2;else if(1!==n.length||e.height>a){var l=e.y+(e.height-o)/2-r.y;n.forEach(function(t){t.translate(0,l)})}else e.y=(r.y+r.height/2+s.y+s.height/2)/2-e.height/2}}(t)}}])},27800:function(t){function e(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}t.exports=function(t){let n=function(t){let n=[];for(let i=0;i<t.length;i++){for(;n.length>=2&&0>=e(n[n.length-2],n[n.length-1],t[i]);)n.pop();n.push(t[i])}return n.pop(),n}(t),i=function(t){let n=t.reverse(),i=[];for(let t=0;t<n.length;t++){for(;i.length>=2&&0>=e(i[i.length-2],i[i.length-1],n[t]);)i.pop();i.push(n[t])}return i.pop(),i}(t),r=i.concat(n);return r.push(t[0]),r}},15925:function(t){t.exports={toXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","return [pt"+e[0]+",pt"+e[1]+"];");return n(t)})},fromXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","const o = {}; o"+e[0]+"= pt[0]; o"+e[1]+"= pt[1]; return o;");return n(t)})}}},70285:function(t){function e(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(let e=0;e<t.length;e++){let n=t[e],i=this.coordToCellNum(n[0]),r=this.coordToCellNum(n[1]);if(this._cells[i])this._cells[i][r]?this._cells[i][r].push(n):this._cells[i][r]=[n];else{let t=[];t[r]=[n],this._cells[i]=t}}}e.prototype={cellPoints:function(t,e){return void 0!==this._cells[t]&&void 0!==this._cells[t][e]?this._cells[t][e]:[]},rangePoints:function(t){let e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),i=this.coordToCellNum(t[2]),r=this.coordToCellNum(t[3]),s=[];for(let t=e;t<=i;t++)for(let e=n;e<=r;e++)for(let n=0;n<this.cellPoints(t,e).length;n++)s.push(this.cellPoints(t,e)[n]);return s},removePoint:function(t){let e;let n=this.coordToCellNum(t[0]),i=this.coordToCellNum(t[1]),r=this._cells[n][i];for(let n=0;n<r.length;n++)if(r[n][0]===t[0]&&r[n][1]===t[1]){e=n;break}return r.splice(e,1),r},trunc:Math.trunc||function(t){return t-t%1},coordToCellNum:function(t){return this.trunc(t*this._reverseCellSize)},extendBbox:function(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}},t.exports=function(t,n){return new e(t,n)}},47032:function(t,e,n){"use strict";let i=n(67921),r=n(70285),s=n(15925),o=n(27800);function a(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function l(t,e,n){let i=[e[0]-t[0],e[1]-t[1]],r=[n[0]-t[0],n[1]-t[1]],s=a(t,e),o=a(t,n),l=i[0]*r[0]+i[1]*r[1];return l/Math.sqrt(s*o)}function h(t,e){for(let n=0;n<e.length-1;n++){let r=[e[n],e[n+1]];if((t[0][0]!==r[0][0]||t[0][1]!==r[0][1])&&(t[0][0]!==r[1][0]||t[0][1]!==r[1][1])&&i(t,r))return!0}return!1}let d=Math.cos(90/(180/Math.PI));t.exports=function(t,e,n){let i=function(t){let e=[t[0]],n=t[0];for(let i=1;i<t.length;i++){let r=t[i];(n[0]!==r[0]||n[1]!==r[1])&&e.push(r),n=r}return e}(s.toXy(t,n).sort(function(t,e){return t[0]-e[0]||t[1]-e[1]}));if(i.length<4){let t=i.concat([i[0]]);return n?s.fromXy(t,n):t}let c=function(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(let s=t.length-1;s>=0;s--)t[s][0]<e&&(e=t[s][0]),t[s][1]<n&&(n=t[s][1]),t[s][0]>i&&(i=t[s][0]),t[s][1]>r&&(r=t[s][1]);return[i-e,r-n]}(i),u=[.6*c[0],.6*c[1]],p=o(i),g=i.filter(function(t){return 0>p.indexOf(t)}),f=Math.ceil(1/(i.length/(c[0]*c[1]))),y=function t(e,n,i,r,s){let o=!1;for(let t=0;t<e.length-1;t++){let c,u,p;let g=[e[t],e[t+1]],f=g[0][0]+","+g[0][1]+","+g[1][0]+","+g[1][1];if(a(g[0],g[1])<n||s.has(f))continue;let y=0,m=[Math.min(g[0][0],g[1][0]),Math.min(g[0][1],g[1][1]),Math.max(g[0][0],g[1][0]),Math.max(g[0][1],g[1][1])];do c=(m=r.extendBbox(m,y))[2]-m[0],u=m[3]-m[1],p=function(t,e,n){let i=null,r=d,s=d,o,a;for(let d=0;d<e.length;d++)o=l(t[0],t[1],e[d]),a=l(t[1],t[0],e[d]),o>r&&a>s&&!h([t[0],e[d]],n)&&!h([t[1],e[d]],n)&&(r=o,s=a,i=e[d]);return i}(g,r.rangePoints(m),e),y++;while(null===p&&(i[0]>c||i[1]>u));c>=i[0]&&u>=i[1]&&s.add(f),null!==p&&(e.splice(t+1,0,p),r.removePoint(p),o=!0)}return o?t(e,n,i,r,s):e}(p,Math.pow(e||20,2),u,r(g,f),new Set);return n?s.fromXy(y,n):y}},67921:function(t){function e(t,e,n,i,r,s){let o=(s-e)*(n-t)-(i-e)*(r-t);return o>0||!(o<0)}t.exports=function(t,n){let i=t[0][0],r=t[0][1],s=t[1][0],o=t[1][1],a=n[0][0],l=n[0][1],h=n[1][0],d=n[1][1];return e(i,r,a,l,h,d)!==e(s,o,a,l,h,d)&&e(i,r,s,o,a,l)!==e(i,r,s,o,h,d)}},6089:function(t,e,n){"use strict";let i;n.d(e,{kJ:function(){return aM},jD:function(){return t6}});var r,s,o,a,l,h,d,c,u,p,g,f,y,m,v,b,E,x,O,w,S,D,C,M,T,A,L,R,P,k,N={};n.r(N),n.d(N,{circle:function(){return ia},diamond:function(){return ih},rect:function(){return ic},simple:function(){return ip},triangle:function(){return il},triangleRect:function(){return iu},vee:function(){return id}});var j=n(48458),I=n(40163),B=n(38822),F=n(60307),_=n(84101);let z={duration:500},Z={duration:1e3,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"};(r=v||(v={})).NodeAdded="NodeAdded",r.NodeUpdated="NodeUpdated",r.NodeRemoved="NodeRemoved",r.EdgeAdded="EdgeAdded",r.EdgeUpdated="EdgeUpdated",r.EdgeRemoved="EdgeRemoved",r.ComboAdded="ComboAdded",r.ComboUpdated="ComboUpdated",r.ComboRemoved="ComboRemoved",(s=b||(b={})).DRAW="draw",s.COLLAPSE="collapse",s.EXPAND="expand",s.TRANSFORM="transform",(o=E||(E={})).CLICK="canvas:click",o.DBLCLICK="canvas:dblclick",o.POINTER_OVER="canvas:pointerover",o.POINTER_LEAVE="canvas:pointerleave",o.POINTER_ENTER="canvas:pointerenter",o.POINTER_MOVE="canvas:pointermove",o.POINTER_OUT="canvas:pointerout",o.POINTER_DOWN="canvas:pointerdown",o.POINTER_UP="canvas:pointerup",o.CONTEXT_MENU="canvas:contextmenu",o.DRAG_START="canvas:dragstart",o.DRAG="canvas:drag",o.DRAG_END="canvas:dragend",o.DRAG_ENTER="canvas:dragenter",o.DRAG_OVER="canvas:dragover",o.DRAG_LEAVE="canvas:dragleave",o.DROP="canvas:drop",o.WHEEL="canvas:wheel",(a=x||(x={})).CLICK="combo:click",a.DBLCLICK="combo:dblclick",a.POINTER_OVER="combo:pointerover",a.POINTER_LEAVE="combo:pointerleave",a.POINTER_ENTER="combo:pointerenter",a.POINTER_MOVE="combo:pointermove",a.POINTER_OUT="combo:pointerout",a.POINTER_DOWN="combo:pointerdown",a.POINTER_UP="combo:pointerup",a.CONTEXT_MENU="combo:contextmenu",a.DRAG_START="combo:dragstart",a.DRAG="combo:drag",a.DRAG_END="combo:dragend",a.DRAG_ENTER="combo:dragenter",a.DRAG_OVER="combo:dragover",a.DRAG_LEAVE="combo:dragleave",a.DROP="combo:drop",(l=O||(O={})).CLICK="click",l.DBLCLICK="dblclick",l.POINTER_OVER="pointerover",l.POINTER_LEAVE="pointerleave",l.POINTER_ENTER="pointerenter",l.POINTER_MOVE="pointermove",l.POINTER_OUT="pointerout",l.POINTER_DOWN="pointerdown",l.POINTER_UP="pointerup",l.CONTEXT_MENU="contextmenu",l.DRAG_START="dragstart",l.DRAG="drag",l.DRAG_END="dragend",l.DRAG_ENTER="dragenter",l.DRAG_OVER="dragover",l.DRAG_LEAVE="dragleave",l.DROP="drop",l.KEY_DOWN="keydown",l.KEY_UP="keyup",l.WHEEL="wheel",(h=w||(w={})).KEY_DOWN="keydown",h.KEY_UP="keyup",(d=S||(S={})).CLICK="edge:click",d.DBLCLICK="edge:dblclick",d.POINTER_OVER="edge:pointerover",d.POINTER_LEAVE="edge:pointerleave",d.POINTER_ENTER="edge:pointerenter",d.POINTER_MOVE="edge:pointermove",d.POINTER_OUT="edge:pointerout",d.POINTER_DOWN="edge:pointerdown",d.POINTER_UP="edge:pointerup",d.CONTEXT_MENU="edge:contextmenu",d.DRAG_ENTER="edge:dragenter",d.DRAG_OVER="edge:dragover",d.DRAG_LEAVE="edge:dragleave",d.DROP="edge:drop",(c=D||(D={})).BEFORE_CANVAS_INIT="beforecanvasinit",c.AFTER_CANVAS_INIT="aftercanvasinit",c.BEFORE_SIZE_CHANGE="beforesizechange",c.AFTER_SIZE_CHANGE="aftersizechange",c.BEFORE_ELEMENT_CREATE="beforeelementcreate",c.AFTER_ELEMENT_CREATE="afterelementcreate",c.BEFORE_ELEMENT_UPDATE="beforeelementupdate",c.AFTER_ELEMENT_UPDATE="afterelementupdate",c.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",c.AFTER_ELEMENT_DESTROY="afterelementdestroy",c.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",c.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",c.BEFORE_DRAW="beforedraw",c.AFTER_DRAW="afterdraw",c.BEFORE_RENDER="beforerender",c.AFTER_RENDER="afterrender",c.BEFORE_ANIMATE="beforeanimate",c.AFTER_ANIMATE="afteranimate",c.BEFORE_LAYOUT="beforelayout",c.AFTER_LAYOUT="afterlayout",c.BEFORE_STAGE_LAYOUT="beforestagelayout",c.AFTER_STAGE_LAYOUT="afterstagelayout",c.BEFORE_TRANSFORM="beforetransform",c.AFTER_TRANSFORM="aftertransform",c.BATCH_START="batchstart",c.BATCH_END="batchend",c.BEFORE_DESTROY="beforedestroy",c.AFTER_DESTROY="afterdestroy",c.BEFORE_RENDERER_CHANGE="beforerendererchange",c.AFTER_RENDERER_CHANGE="afterrendererchange",(u=C||(C={})).UNDO="undo",u.REDO="redo",u.CANCEL="cancel",u.ADD="add",u.CLEAR="clear",u.CHANGE="change",(p=M||(M={})).CLICK="node:click",p.DBLCLICK="node:dblclick",p.POINTER_OVER="node:pointerover",p.POINTER_LEAVE="node:pointerleave",p.POINTER_ENTER="node:pointerenter",p.POINTER_MOVE="node:pointermove",p.POINTER_OUT="node:pointerout",p.POINTER_DOWN="node:pointerdown",p.POINTER_UP="node:pointerup",p.CONTEXT_MENU="node:contextmenu",p.DRAG_START="node:dragstart",p.DRAG="node:drag",p.DRAG_END="node:dragend",p.DRAG_ENTER="node:dragenter",p.DRAG_OVER="node:dragover",p.DRAG_LEAVE="node:dragleave",p.DROP="node:drop";let V="combo",W="tree";(g=T||(T={})).NODE="node",g.EDGE="edge",g.COMBO="combo",g.THEME="theme",g.PALETTE="palette",g.LAYOUT="layout",g.BEHAVIOR="behavior",g.PLUGIN="plugin",g.ANIMATION="animation",g.TRANSFORM="transform",g.SHAPE="shape";let H={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{},shape:{}};function G(t,e){var n;let i=null===(n=H[t])||void 0===n?void 0:n[e];if(i)return i}function Y(t){return"[".concat("G6"," v").concat("5.0.42","] ").concat(t)}let U={mute:!1,debug:t=>{U.mute||console.debug(Y(t))},info:t=>{U.mute||console.info(Y(t))},warn:t=>{U.mute||console.warn(Y(t))},error:t=>{U.mute||console.error(Y(t))}};function K(t){let{theme:e}=t;if(!e)return{};let n=G(T.THEME,e);return n||(U.warn("The theme of ".concat(e," is not registered.")),{})}function X(t,e){if(Array.isArray(t)&&0===t.length)return null;let n=Array.isArray(t)?t[0]:t,i=Array.isArray(t)?t.slice(1):e||[];return new Proxy(n,{get:(t,e)=>"function"!=typeof t[e]||["onframe","onfinish"].includes(e)?"finished"===e?Promise.all([n.finished,...i.map(t=>t.finished)]):Reflect.get(t,e):function(){for(var n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];t[e](...r),i.forEach(t=>{var n;return null===(n=t[e])||void 0===n?void 0:n.call(t,...r)})},set:(t,e,n)=>(["onframe","onfinish"].includes(e)||i.forEach(t=>{t[e]=n}),Reflect.set(t,e,n))})}function $(t){let e=t.reduce((t,e)=>(Object.entries(e).forEach(e=>{let[n,i]=e;void 0===t[n]?t[n]=[i]:t[n].push(i)}),t),{});Object.entries(e).forEach(n=>{let[i,r]=n;(r.length!==t.length||r.some(t=>(0,B.Z)(t))||r.every(t=>!["sourceNode","targetNode","childrenNode"].includes(i)&&(0,F.Z)(t,r[0])))&&delete e[i]});let n=Object.entries(e).reduce((t,e)=>{let[n,i]=e;return i.forEach((e,i)=>{t[i]?t[i][n]=e:t[i]={[n]:e}}),t},[]);return 0!==t.length&&0===n.length&&n.push(...[{_:0},{_:0}]),n}function q(t){switch(t){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function J(t,e){let{animation:n}=t;if(!1===n||!1===e)return!1;let i=Object.assign({},z);return(0,_.Z)(n)&&Object.assign(i,n),(0,_.Z)(e)&&Object.assign(i,e),i}var Q=n(93493);function tt(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!i&&0===t&&0===e&&0===n)return null;if(Array.isArray(i)){let r=-1,s=[];for(let o=0;o<i.length;o++){let a=i[o];if("translate"===a[0]){if(a[1]===t&&a[2]===e)return null;r=o,s.push(["translate",t,e])}else if("translate3d"===a[0]){if(a[1]===t&&a[2]===e&&a[3]===n)return null;r=o,s.push(["translate3d",t,e,null!=n?n:0])}else s.push(a)}return(-1===r&&s.splice(0,0,(0,Q.Z)(n)?["translate3d",t,e,null!=n?n:0]:["translate",t,e]),0===s.length)?null:s}let r=i?i.replace(/translate(3d)?\([^)]*\)/g,""):"";return 0===n?"translate(".concat(t,", ").concat(e,")").concat(r):"translate3d(".concat(t,", ").concat(e,", ").concat(n,")").concat(r)}var te=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};let tn=(t,e,n)=>{let i;if(!n.length)return null;let[r,s]=e,o=e=>{var n;if(!e)return{shape:t,fromStyle:r,toStyle:s};{let i=t.getShape(e);if(!i)return null;let o="get".concat((0,I.Z)(e),"Style"),a=(null===(n=null==t?void 0:t[o])||void 0===n?void 0:n.bind(t))||(t=>t),l=(null==a?void 0:a(r))||{},h=(null==a?void 0:a(s))||{};return{shape:i,fromStyle:l,toStyle:h}}},a=n.map(t=>{var{fields:e,shape:n,states:r}=t,s=te(t,["fields","shape","states"]);let a=o(n);if(!a)return null;let{shape:l,fromStyle:h,toStyle:d}=a,c=[{},{}];if(e.forEach(t=>{var e,n;Object.assign(c[0],{[t]:null!==(e=h[t])&&void 0!==e?e:q(t)}),Object.assign(c[1],{[t]:null!==(n=d[t])&&void 0!==n?n:q(t)})}),c.some(t=>Object.keys(t).some(t=>["x","y","z"].includes(t)))){let{x:t=0,y:e=0,z:n,transform:i=""}=l.attributes||{};c.forEach(r=>{var s,o,a;r.transform=tt(null!==(s=r.x)&&void 0!==s?s:t,null!==(o=r.y)&&void 0!==o?o:e,null!==(a=r.z)&&void 0!==a?a:n,i)})}let u=l.animate($(c),s);return void 0===n&&(i=u),u}).filter(Boolean),l=i||(null==a?void 0:a[0]);return l?X(l,a.filter(t=>t!=t)):null},ti=[{fields:["x","y"]}],tr=[{fields:["sourceNode","targetNode"]}],ts=[{fields:["childrenNode","x","y"]}];var to=n(8581),ta=n(43898),tl=Object.prototype.hasOwnProperty,th=function(t,e){if(!e||!(0,ta.Z)(t))return{};for(var n,i={},r=(0,to.Z)(e)?e:function(t){return t[e]},s=0;s<t.length;s++){var o=t[s];n=r(o),tl.call(i,n)?i[n].push(o):i[n]=[o]}return i},td=n(73209),tc=n(24932);function tu(t){return t instanceof Float32Array||!!Array.isArray(t)&&(2===t.length||3===t.length)&&t.every(t=>"number"==typeof t)}function tp(t,e,n){return t>=e&&t<=n}function tg(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(Array.isArray(t)){let[e=0,n=e,i=e,r=n]=t;return[e,n,i,r]}return[t,t,t,t]}function tf(t){return t.max[0]-t.min[0]}function ty(t){return t.max[1]-t.min[1]}function tm(t){return[tf(t),ty(t)]}function tv(t,e){let n=tu(t)?tb(t):t.getShape("key").getBounds();return e?tE(n,e):n}function tb(t){let[e,n,i=0]=t,r=new j.mN;return r.setMinMax([e,n,i],[e,n,i]),r}function tE(t,e){let[n,i,r,s]=tg(e),[o,a,l]=t.min,[h,d,c]=t.max,u=new j.mN;return u.setMinMax([o-s,a-n,l],[h+i,d+r,c]),u}function tx(t){if(0===t.length)return new j.mN;if(1===t.length)return t[0];let e=new j.mN;e.setMinMax(t[0].min,t[0].max);for(let n=1;n<t.length;n++){let i=t[n];e.setMinMax([Math.min(e.min[0],i.min[0]),Math.min(e.min[1],i.min[1]),Math.min(e.min[2],i.min[2])],[Math.max(e.max[0],i.max[0]),Math.max(e.max[1],i.max[1]),Math.max(e.max[2],i.max[2])])}return e}function tO(t,e){return tp(t[0],e.min[0],e.max[0])&&tp(t[1],e.min[1],e.max[1])}function tw(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:[i,r],max:[s,o]}=e,a=(t[1]===r||t[1]===o)&&(n||tp(t[0],i,s)),l=(t[0]===i||t[0]===s)&&(n||tp(t[1],r,o));return a||l}function tS(t,e){let{center:n}=e;return t[0]===n[0]&&t[1]===n[1]}function tD(t,e){let[n,i]=t,[r,s]=e.min,[o,a]=e.max,l=n-r,h=o-n,d=i-s,c=a-i,u=Math.min(l,h,d,c);return u===l?"left":u===h?"right":u===d?"top":u===c?"bottom":"left"}function tC(t,e){let n=(0,tc.Z)(t);if(tO(t,e)){let i=tD(t,e);switch(i){case"left":n[0]=e.min[0];break;case"right":n[0]=e.max[0];break;case"top":n[1]=e.min[1];break;case"bottom":n[1]=e.max[1]}}else{let[i,r]=t,[s,o]=e.min,[a,l]=e.max;n[0]=tp(i,s,a)?i:i<s?s:a,n[1]=tp(r,o,l)?r:r<o?o:l}return n}var tM=function(t,e){return t===e},tT=function(){function t(t,e){void 0===e&&(e=null),this.value=t,this.next=e}return t.prototype.toString=function(t){return t?t(this.value):"".concat(this.value)},t}(),tA=function(){function t(t){void 0===t&&(t=tM),this.head=null,this.tail=null,this.compare=t}return t.prototype.prepend=function(t){var e=new tT(t,this.head);return this.head=e,this.tail||(this.tail=e),this},t.prototype.append=function(t){var e=new tT(t);return this.head?(this.tail.next=e,this.tail=e,this):(this.head=e,this.tail=e,this)},t.prototype.delete=function(t){if(!this.head)return null;for(var e=null;this.head&&this.compare(this.head.value,t);)e=this.head,this.head=this.head.next;var n=this.head;if(null!==n)for(;n.next;)this.compare(n.next.value,t)?(e=n.next,n.next=n.next.next):n=n.next;return this.compare(this.tail.value,t)&&(this.tail=n),e},t.prototype.find=function(t){var e=t.value,n=void 0===e?void 0:e,i=t.callback,r=void 0===i?void 0:i;if(!this.head)return null;for(var s=this.head;s;){if(r&&r(s.value)||void 0!==n&&this.compare(s.value,n))return s;s=s.next}return null},t.prototype.deleteTail=function(){var t=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,t;for(var e=this.head;e.next;)e.next.next?e=e.next:e.next=null;return this.tail=e,t},t.prototype.deleteHead=function(){if(!this.head)return null;var t=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),t},t.prototype.fromArray=function(t){var e=this;return t.forEach(function(t){return e.append(t)}),this},t.prototype.toArray=function(){for(var t=[],e=this.head;e;)t.push(e),e=e.next;return t},t.prototype.reverse=function(){for(var t=this.head,e=null,n=null;t;)n=t.next,t.next=e,e=t,t=n;this.tail=this.head,this.head=e},t.prototype.toString=function(t){return void 0===t&&(t=void 0),this.toArray().map(function(e){return e.toString(t)}).toString()},t}();!function(){function t(){this.linkedList=new tA}t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},t.prototype.enqueue=function(t){this.linkedList.append(t)},t.prototype.dequeue=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toString=function(t){return this.linkedList.toString(t)}}();var tL=function(t,e,n){void 0===e&&(e=[]);var i=e.filter(function(e){return e.source===t||e.target===t});return"target"===n?i.filter(function(e){return e.source===t}).map(function(t){return t.target}):"source"===n?i.filter(function(e){return e.target===t}).map(function(t){return t.source}):i.map(function(e){return e.source===t?e.target:e.source})},tR=function(t){var e={},n=t.nodes,i=t.edges;return(void 0===n?[]:n).forEach(function(t){e[t.id]={degree:0,inDegree:0,outDegree:0}}),(void 0===i?[]:i).forEach(function(t){e[t.source].degree++,e[t.source].outDegree++,e[t.target].degree++,e[t.target].inDegree++}),e},tP=n(69336),tk={}.toString,tN=function(t,e){return tk.call(t)==="[object "+e+"]"},tj=function(t){return tN(t,"Function")},tI=function(t){return Array.isArray?Array.isArray(t):tN(t,"Array")},tB=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e},tF=function(t,e){if(t){if(tI(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(tB(t)){for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break}}},t_=function(t,e){if(void 0===e&&(e=[]),isArray(t))for(var n=0;n<t.length;n+=1)t_(t[n],e);else e.push(t);return e},tz=Array.prototype;tz.splice,tz.indexOf,Array.prototype.splice;var tZ=function(t){return tN(t,"String")};Object.prototype.hasOwnProperty;var tV=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return tF(t,function(n,i){tj(t)&&"prototype"===i||e.push(n)}),e},tW=function(t){if("object"!=typeof t||null===t)return t;if(tI(t)){e=[];for(var e,n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=tW(t[n]):e[n]=t[n]}else for(var r in e={},t)"object"==typeof t[r]&&null!=t[r]?e[r]=tW(t[r]):e[r]=t[r];return e};Object.prototype.hasOwnProperty;var tH=function(t){return"object"==typeof t&&null!==t},tG=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},tY=function(t,e){if(t===e)return!0;if(!t||!e||tZ(t)||tZ(e))return!1;if(tG(t)||tG(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=tY(t[i],e[i]));i++);return n}if(tH(t)||tH(e)){var r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(var n=!0,i=0;i<r.length&&(n=tY(t[r[i]],e[r[i]]));i++);return n}return!1};Object.prototype.hasOwnProperty,function(t,e){if(!tj(t))throw TypeError("Expected a function");var n=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var s=e?e.apply(this,i):i[0],o=n.cache;if(o.has(s))return o.get(s);var a=t.apply(this,i);return o.set(s,a),a};n.cache=new Map}(function(t,e){void 0===e&&(e={});var n=e.fontSize,i=e.fontFamily,r=e.fontWeight,s=e.fontStyle,o=e.fontVariant;return A||(A=document.createElement("canvas").getContext("2d")),A.font=[s,o,r,n+"px",i].join(" "),A.measureText(tZ(t)?t:"").width},function(t,e){return void 0===e&&(e={}),(0,tP.pr)([t],tV(e)).join("")}),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}();var tU=function(t,e,n){for(var i,r=1/0,s=0;s<e.length;s++){var o=e[s].id;!n[o]&&t[o]<=r&&(r=t[o],i=e[s])}return i},tK=function(t,e,n,i){var r=t.nodes,s=void 0===r?[]:r,o=t.edges,a=void 0===o?[]:o,l=[],h={},d={},c={};s.forEach(function(t,n){var i=t.id;l.push(i),d[i]=1/0,i===e&&(d[i]=0)});for(var u=s.length,p=0;p<u;p++)!function(t){var e=tU(d,s,h),r=e.id;if(h[r]=!0,d[r]!==1/0){var o=[];(n?a.filter(function(t){return t.source===r}):a.filter(function(t){return t.source===r||t.target===r})).forEach(function(t){var n=t.target,s=t.source,o=n===r?s:n,a=i&&t[i]?t[i]:1;d[o]>d[e.id]+a?(d[o]=d[e.id]+a,c[o]=[e.id]):d[o]===d[e.id]+a&&c[o].push(e.id)})}}(0);c[e]=[e];var g={};for(var f in d)d[f]!==1/0&&function t(e,n,i,r){if(e===n)return[e];if(r[n])return r[n];for(var s=[],o=0,a=i[n];o<a.length;o++){var l=t(e,a[o],i,r);if(!l)return;for(var h=0;h<l.length;h++){var d=l[h];tI(d)?s.push((0,tP.ev)((0,tP.ev)([],d,!0),[n],!1)):s.push([d,n])}}return r[n]=s,r[n]}(e,f,c,g);var y={};for(var f in g)y[f]=g[f][0];return{length:d,path:y,allPath:g}},tX=function(t,e,n,i,r){var s=tK(t,e,i,r),o=s.length,a=s.path,l=s.allPath;return{length:o[n],path:a[n],allPath:l[n]}};!function(){function t(t){this.arr=t}t.prototype.getArr=function(){return this.arr||[]},t.prototype.add=function(e){var n,i=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(i);if(!(null==i?void 0:i.length))return new t(this.arr);if(this.arr.length===i.length){var r=[];for(var s in this.arr)r[s]=this.arr[s]+i[s];return new t(r)}},t.prototype.subtract=function(e){var n,i=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(i);if(!(null==i?void 0:i.length))return new t(this.arr);if(this.arr.length===i.length){var r=[];for(var s in this.arr)r[s]=this.arr[s]-i[s];return new t(r)}},t.prototype.avg=function(e){var n=[];if(0!==e)for(var i in this.arr)n[i]=this.arr[i]/e;return new t(n)},t.prototype.negate=function(){var e=[];for(var n in this.arr)e[n]=-this.arr[n];return new t(e)},t.prototype.squareEuclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var r in this.arr)i+=Math.pow(this.arr[r]-t.arr[r],2);return i}},t.prototype.euclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var r in this.arr)i+=Math.pow(this.arr[r]-t.arr[r],2);return Math.sqrt(i)}console.error("The two vectors are unequal in length.")},t.prototype.normalize=function(){var e=[],n=tW(this.arr);n.sort(function(t,e){return t-e});var i=n[n.length-1],r=n[0];for(var s in this.arr)e[s]=(this.arr[s]-r)/(i-r);return new t(e)},t.prototype.norm2=function(){if(!(null===(t=this.arr)||void 0===t?void 0:t.length))return 0;var t,e=0;for(var n in this.arr)e+=Math.pow(this.arr[n],2);return Math.sqrt(e)},t.prototype.dot=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var r in this.arr)i+=this.arr[r]*t.arr[r];return i}console.error("The two vectors are unequal in length.")},t.prototype.equal=function(t){var e,n=t.arr;if((null===(e=this.arr)||void 0===e?void 0:e.length)!==(null==n?void 0:n.length))return!1;for(var i in this.arr)if(this.arr[i]!==n[i])return!1;return!0}}(),(L||(L={})).EuclideanDistance="euclideanDistance",function(){function t(t){this.count=t.length,this.parent={};for(var e=0;e<t.length;e++){var n=t[e];this.parent[n]=n}}t.prototype.find=function(t){for(;this.parent[t]!==t;)t=this.parent[t];return t},t.prototype.union=function(t,e){var n=this.find(t),i=this.find(e);n!==i&&(n<i?(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]):(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]))},t.prototype.connected=function(t,e){return this.find(t)===this.find(e)}}();var t$=function(t,e){return t-e};!function(){function t(t){void 0===t&&(t=t$),this.compareFn=t,this.list=[]}t.prototype.getLeft=function(t){return 2*t+1},t.prototype.getRight=function(t){return 2*t+2},t.prototype.getParent=function(t){return 0===t?null:Math.floor((t-1)/2)},t.prototype.isEmpty=function(){return this.list.length<=0},t.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},t.prototype.delMin=function(){var t=this.top(),e=this.list.pop();return this.list.length>0&&(this.list[0]=e,this.moveDown(0)),t},t.prototype.insert=function(t){if(null!==t){this.list.push(t);var e=this.list.length-1;return this.moveUp(e),!0}return!1},t.prototype.moveUp=function(t){for(var e=this.getParent(t);t&&t>0&&this.compareFn(this.list[e],this.list[t])>0;){var n=this.list[e];this.list[e]=this.list[t],this.list[t]=n,t=e,e=this.getParent(t)}},t.prototype.moveDown=function(t){var e,n=t,i=this.getLeft(t),r=this.getRight(t),s=this.list.length;null!==i&&i<s&&this.compareFn(this.list[n],this.list[i])>0?n=i:null!==r&&r<s&&this.compareFn(this.list[n],this.list[r])>0&&(n=r),t!==n&&(e=[this.list[n],this.list[t]],this.list[t]=e[0],this.list[n]=e[1],this.moveDown(n))}}();var tq=function(t,e,n){"number"!=typeof e&&(e=1e-6),"number"!=typeof n&&(n=.85);for(var i,r=1,s=0,o=1e3,a=t.nodes,l=void 0===a?[]:a,h=t.edges,d=void 0===h?[]:h,c=l.length,u={},p={},g=0;g<c;++g){var f=l[g],y=f.id;u[y]=1/c,p[y]=1/c}for(var m=tR(t);o>0&&r>e;){s=0;for(var g=0;g<c;++g){var f=l[g],y=f.id;if(i=0,0===m[f.id].inDegree)u[y]=0;else{for(var v=tL(y,d,"source"),b=0;b<v.length;++b){var E=v[b],x=m[E].outDegree;x>0&&(i+=p[E]/x)}u[y]=n*i,s+=u[y]}}s=(1-s)/c,r=0;for(var g=0;g<c;++g){var f=l[g],y=f.id;r+=Math.abs((i=u[y]+s)-p[y]),p[y]=i}o-=1}return p},tJ=function(t,e,n,i){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i="-1"),this.id=t,this.from=e,this.to=n,this.label=i},tQ=function(){function t(t,e){void 0===t&&(t=-1),void 0===e&&(e="-1"),this.id=t,this.label=e,this.edges=[],this.edgeMap={}}return t.prototype.addEdge=function(t){this.edges.push(t),this.edgeMap[t.id]=t},t}(),t0=function(){function t(t,e,n){void 0===t&&(t=-1),void 0===e&&(e=!0),void 0===n&&(n=!1),this.id=t,this.edgeIdAutoIncrease=e,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=n}return t.prototype.getNodeNum=function(){return this.nodes.length},t.prototype.addNode=function(t,e){if(!this.nodeMap[t]){var n=new tQ(t,e);this.nodes.push(n),this.nodeMap[t]=n,this.nodeLabelMap[e]||(this.nodeLabelMap[e]=[]),this.nodeLabelMap[e].push(t)}},t.prototype.addEdge=function(t,e,n,i){if((this.edgeIdAutoIncrease||void 0===t)&&(t=this.counter++),!this.nodeMap[e]||!this.nodeMap[n]||!this.nodeMap[n].edgeMap[t]){var r=new tJ(t,e,n,i);if(this.edges.push(r),this.edgeMap[t]=r,this.nodeMap[e].addEdge(r),this.edgeLabelMap[i]||(this.edgeLabelMap[i]=[]),this.edgeLabelMap[i].push(r),!this.directed){var s=new tJ(t,n,e,i);this.nodeMap[n].addEdge(s),this.edgeLabelMap[i].push(s)}}},t}(),t1=function(){function t(t,e,n,i,r){this.fromNode=t,this.toNode=e,this.nodeEdgeNodeLabel={nodeLabel1:n||"-1",edgeLabel:i||"-1",nodeLabel2:r||"-1"}}return t.prototype.equalTo=function(t){return this.fromNode===t.formNode&&this.toNode===t.toNode&&this.nodeEdgeNodeLabel===t.nodeEdgeNodeLabel},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t}(),t2=function(){function t(){this.rmpath=[],this.dfsEdgeList=[]}return t.prototype.equalTo=function(t){var e=this.dfsEdgeList.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(this.dfsEdgeList[n]!==t[n])return!1;return!0},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t.prototype.pushBack=function(t,e,n,i,r){return this.dfsEdgeList.push(new t1(t,e,n,i,r)),this.dfsEdgeList},t.prototype.toGraph=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=!1);var n=new t0(t,!0,e);return this.dfsEdgeList.forEach(function(t){var e=t.fromNode,i=t.toNode,r=t.nodeEdgeNodeLabel,s=r.nodeLabel1,o=r.edgeLabel,a=r.nodeLabel2;"-1"!==s&&n.addNode(e,s),"-1"!==a&&n.addNode(i,a),"-1"!==s&&a!==s&&n.addEdge(void 0,e,i,o)}),n},t.prototype.buildRmpath=function(){this.rmpath=[];for(var t=void 0,e=this.dfsEdgeList.length,n=e-1;n>=0;n--){var i=this.dfsEdgeList[n],r=i.fromNode,s=i.toNode;r<s&&(void 0===t||s===t)&&(this.rmpath.push(n),t=r)}return this.rmpath},t.prototype.getNodeNum=function(){var t={};return this.dfsEdgeList.forEach(function(e){t[e.fromNode]||(t[e.fromNode]=!0),t[e.toNode]||(t[e.toNode]=!0)}),Object.keys(t).length},t}(),t3=function(){function t(t){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],t){for(;t;){var e=t.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,t=t.preNode}this.edges=this.edges.reverse()}}return t.prototype.hasNode=function(t){return 1===this.nodesUsed[t.id]},t.prototype.hasEdge=function(t){return 1===this.edgesUsed[t.id]},t}();function t6(t){if(void 0!==t.id)return t.id;if(void 0!==t.source&&void 0!==t.target)return"".concat(t.source,"-").concat(t.target);throw Error(Y("The datum does not have available id."))}function t4(t,e){let n={nodes:(t.nodes||[]).map(t6),edges:(t.edges||[]).map(t6),combos:(t.combos||[]).map(t6)};return e?Object.values(n).flat():n}!function(){function t(t){var e=t.graphs,n=t.minSupport,i=t.minNodeNum,r=t.maxNodeNum,s=t.top,o=t.directed,a=t.verbose;this.graphs=e,this.dfsCode=new t2,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=void 0===n?2:n,this.top=void 0===s?10:s,this.directed=void 0!==o&&o,this.counter=0,this.maxNodeNum=void 0===r?4:r,this.minNodeNum=void 0===i?1:i,this.verbose=void 0!==a&&a,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}t.prototype.findForwardRootEdges=function(t,e){var n=this,i=[],r=t.nodeMap;return e.edges.forEach(function(t){(n.directed||e.label<=r[t.to].label)&&i.push(t)}),i},t.prototype.findBackwardEdge=function(t,e,n,i){if(!this.directed&&e===n)return null;for(var r=t.nodeMap,s=r[n.to].edges,o=s.length,a=0;a<o;a++){var l=s[a];if(!i.hasEdge(l)&&l.to===e.from){if(this.directed){if(r[e.from].label<r[n.to].label||r[e.from].label===r[n.to].label&&e.label<=l.label)return l}else if(e.label<l.label||e.label===l.label&&r[e.to].label<=r[n.to].label)return l}}return null},t.prototype.findForwardPureEdges=function(t,e,n,i){for(var r=[],s=e.to,o=t.nodeMap[s].edges,a=o.length,l=0;l<a;l++){var h=o[l],d=t.nodeMap[h.to];n<=d.label&&!i.hasNode(d)&&r.push(h)}return r},t.prototype.findForwardRmpathEdges=function(t,e,n,i){for(var r=[],s=t.nodeMap,o=s[e.to].label,a=s[e.from].edges,l=a.length,h=0;h<l;h++){var d=a[h],c=s[d.to].label;!(e.to===d.to||n>c||i.hasNode(s[d.to]))&&(e.label<d.label||e.label===d.label&&o<=c)&&r.push(d)}return r},t.prototype.getSupport=function(t){var e={};return t.forEach(function(t){e[t.graphId]||(e[t.graphId]=!0)}),Object.keys(e).length},t.prototype.findMinLabel=function(t){var e=void 0;return Object.keys(t).forEach(function(n){var i=t[n],r=i.nodeLabel1,s=i.edgeLabel,o=i.nodeLabel2;if(!e){e={nodeLabel1:r,edgeLabel:s,nodeLabel2:o};return}(r<e.nodeLabel1||r===e.nodeLabel1&&s<e.edgeLabel||r===e.nodeLabel1&&s===e.edgeLabel&&o<e.nodeLabel2)&&(e={nodeLabel1:r,edgeLabel:s,nodeLabel2:o})}),e},t.prototype.isMin=function(){var t=this,e=this.dfsCode;if(this.verbose&&console.log("isMin checking",e),1===e.dfsEdgeList.length)return!0;var n=this.directed,i=e.toGraph(-1,n),r=i.nodeMap,s=new t2,o={};i.nodes.forEach(function(e){t.findForwardRootEdges(i,e).forEach(function(t){var n=r[t.to],s="".concat(e.label,"-").concat(t.label,"-").concat(n.label);o[s]||(o[s]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:n.label});var a={graphId:i.id,edge:t,preNode:null};o[s].projected.push(a)})});var a=this.findMinLabel(o);if(a)return s.dfsEdgeList.push(new t1(0,1,a.nodeLabel1,a.edgeLabel,a.nodeLabel2)),function o(a){for(var l=s.buildRmpath(),h=s.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,d=s.dfsEdgeList[l[0]].toNode,c={},u=!1,p=0,g=n?-1:0,f=function(e){if(u)return"break";a.forEach(function(n){var r=new t3(n),o=t.findBackwardEdge(i,r.edges[l[e]],r.edges[l[0]],r);o&&(c[o.label]||(c[o.label]={projected:[],edgeLabel:o.label}),c[o.label].projected.push({graphId:i.id,edge:c,preNode:n}),p=s.dfsEdgeList[l[e]].fromNode,u=!0)})},y=l.length-1;y>g&&"break"!==f(y);y--);if(u){var m=t.findMinLabel(c);s.dfsEdgeList.push(new t1(d,p,"-1",m.edgeLabel,"-1"));var v=s.dfsEdgeList.length-1;return t.dfsCode.dfsEdgeList[v]===s.dfsEdgeList[v]&&o(c[m.edgeLabel].projected)}var b={};u=!1;var E=0;a.forEach(function(e){var n=new t3(e),s=t.findForwardPureEdges(i,n.edges[l[0]],h,n);s.length>0&&(u=!0,E=d,s.forEach(function(t){var n="".concat(t.label,"-").concat(r[t.to].label);b[n]||(b[n]={projected:[],edgeLabel:t.label,nodeLabel2:r[t.to].label}),b[n].projected.push({graphId:i.id,edge:t,preNode:e})}))});for(var x=l.length,y=0;y<x&&"break"!==function(e){if(u)return"break";var n=l[e];a.forEach(function(e){var o=new t3(e),a=t.findForwardRmpathEdges(i,o.edges[n],h,o);a.length>0&&(u=!0,E=s.dfsEdgeList[n].fromNode,a.forEach(function(t){var n="".concat(t.label,"-").concat(r[t.to].label);b[n]||(b[n]={projected:[],edgeLabel:t.label,nodeLabel2:r[t.to].label}),b[n].projected.push({graphId:i.id,edge:t,preNode:e})}))})}(y);y++);if(!u)return!0;var O=t.findMinLabel(b);s.dfsEdgeList.push(new t1(E,d+1,"-1",O.edgeLabel,O.nodeLabel2));var w=s.dfsEdgeList.length-1;return e.dfsEdgeList[w]===s.dfsEdgeList[w]&&o(b["".concat(O.edgeLabel,"-").concat(O.nodeLabel2)].projected)}(o["".concat(a.nodeLabel1,"-").concat(a.edgeLabel,"-").concat(a.nodeLabel2)].projected)},t.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var t=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push(tW(t))}},t.prototype.subGraphMining=function(t){var e=this;if(!(this.getSupport(t)<this.minSupport)&&this.isMin()){this.report();var n=this.dfsCode.getNodeNum(),i=this.dfsCode.buildRmpath(),r=this.dfsCode.dfsEdgeList[i[0]].toNode,s=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,o={},a={};t.forEach(function(t){for(var l=e.graphs[t.graphId],h=l.nodeMap,d=new t3(t),c=i.length-1;c>=0;c--){var u=e.findBackwardEdge(l,d.edges[i[c]],d.edges[i[0]],d);if(u){var p="".concat(e.dfsCode.dfsEdgeList[i[c]].fromNode,"-").concat(u.label);a[p]||(a[p]={projected:[],toNodeId:e.dfsCode.dfsEdgeList[i[c]].fromNode,edgeLabel:u.label}),a[p].projected.push({graphId:t.graphId,edge:u,preNode:t})}}if(!(n>=e.maxNodeNum)){e.findForwardPureEdges(l,d.edges[i[0]],s,d).forEach(function(e){var n="".concat(r,"-").concat(e.label,"-").concat(h[e.to].label);o[n]||(o[n]={projected:[],fromNodeId:r,edgeLabel:e.label,nodeLabel2:h[e.to].label}),o[n].projected.push({graphId:t.graphId,edge:e,preNode:t})});for(var g=function(n){e.findForwardRmpathEdges(l,d.edges[i[n]],s,d).forEach(function(r){var s="".concat(e.dfsCode.dfsEdgeList[i[n]].fromNode,"-").concat(r.label,"-").concat(h[r.to].label);o[s]||(o[s]={projected:[],fromNodeId:e.dfsCode.dfsEdgeList[i[n]].fromNode,edgeLabel:r.label,nodeLabel2:h[r.to].label}),o[s].projected.push({graphId:t.graphId,edge:r,preNode:t})})},c=0;c<i.length;c++)g(c)}}),Object.keys(a).forEach(function(t){var n=a[t],i=n.toNodeId,s=n.edgeLabel;e.dfsCode.dfsEdgeList.push(new t1(r,i,"-1",s,"-1")),e.subGraphMining(a[t].projected),e.dfsCode.dfsEdgeList.pop()}),Object.keys(o).forEach(function(t){var n=o[t],i=n.fromNodeId,s=n.edgeLabel,a=n.nodeLabel2;e.dfsCode.dfsEdgeList.push(new t1(i,r+1,"-1",s,a)),e.subGraphMining(o[t].projected),e.dfsCode.dfsEdgeList.pop()})}},t.prototype.generate1EdgeFrequentSubGraphs=function(){var t=this.graphs,e=this.directed,n=this.minSupport,i=this.frequentSize1Subgraphs,r={},s={},o={},a={};return Object.keys(t).forEach(function(n){var i=t[n],l=i.nodeMap;i.nodes.forEach(function(t,i){var h=t.label,d="".concat(n,"-").concat(h);if(!o[d]){var c=r[h]||0;c++,r[h]=c}o[d]={graphKey:n,label:h},t.edges.forEach(function(t){var i=h,r=l[t.to].label;if(!e&&i>r){var o=r;r=i,i=o}var d=t.label,c="".concat(n,"-").concat(i,"-").concat(d,"-").concat(r),u="".concat(i,"-").concat(d,"-").concat(r);if(!s[u]){var p=s[u]||0;p++,s[u]=p}a[c]={graphId:n,nodeLabel1:i,edgeLabel:d,nodeLabel2:r}})})}),Object.keys(r).forEach(function(t){if(!(r[t]<n)){var e={nodes:[],edges:[]};e.nodes.push({id:"0",label:t}),i.push(e)}}),i},t.prototype.run=function(){var t=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var e=this.graphs;this.directed;var n={};Object.keys(e).forEach(function(i){var r=e[i],s=r.nodeMap;r.nodes.forEach(function(e){t.findForwardRootEdges(r,e).forEach(function(t){var r=s[t.to],o="".concat(e.label,"-").concat(t.label,"-").concat(r.label);n[o]||(n[o]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:r.label}),n[o].projected.push({graphId:i,edge:t,preNode:null})})})}),Object.keys(n).forEach(function(e){var i=n[e],r=i.projected,s=i.nodeLabel1,o=i.edgeLabel,a=i.nodeLabel2;t.dfsCode.dfsEdgeList.push(new t1(0,1,s,o,a)),t.subGraphMining(r),t.dfsCode.dfsEdgeList.pop()})}}}(),function(){function t(t){void 0===t&&(t=10),this.linkedList=new tA,this.maxStep=t}Object.defineProperty(t.prototype,"length",{get:function(){return this.linkedList.toArray().length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.isMaxStack=function(){return this.toArray().length>=this.maxStep},t.prototype.peek=function(){return this.isEmpty()?null:this.linkedList.head.value},t.prototype.push=function(t){this.linkedList.prepend(t),this.length>this.maxStep&&this.linkedList.deleteTail()},t.prototype.pop=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toArray=function(){return this.linkedList.toArray().map(function(t){return t.value})},t.prototype.clear=function(){for(;!this.isEmpty();)this.pop()}}();let t8=(t,e,n)=>{var i;switch(n.type){case"degree":{let r=new Map;return null===(i=t.nodes)||void 0===i||i.forEach(t=>{let i=e(t6(t),n.direction).length;r.set(t6(t),i)}),r}case"betweenness":return t5(t,n.directed,n.weightPropertyName);case"closeness":return t7(t,n.directed,n.weightPropertyName);case"eigenvector":return ee(t,n.directed);case"pagerank":return et(t,n.epsilon,n.linkProb);default:return t9(t)}},t9=t=>{var e;let n=new Map;return null===(e=t.nodes)||void 0===e||e.forEach(t=>{n.set(t6(t),0)}),n},t5=(t,e,n)=>{let i=t9(t),{nodes:r=[]}=t;return r.forEach(s=>{r.forEach(r=>{if(s!==r){let{allPath:o}=tX(t,t6(s),t6(r),e,n),a=o.length;o.flat().forEach(t=>{t!==t6(s)&&t!==t6(r)&&i.set(t,i.get(t)+1/a)})}})}),i},t7=(t,e,n)=>{let i=new Map,{nodes:r=[]}=t;return r.forEach(s=>{let o=r.reduce((i,r)=>{if(s!==r){let{length:o}=tX(t,t6(s),t6(r),e,n);i+=o}return i},0);i.set(t6(s),1/o)}),i},et=(t,e,n)=>{var i;let r=new Map,s=tq(t,e,n);return null===(i=t.nodes)||void 0===i||i.forEach(t=>{r.set(t6(t),s[t6(t)])}),r},ee=(t,e)=>{let{nodes:n=[]}=t,i=en(t,e),r=ei(i,n.length),s=new Map;return n.forEach((t,e)=>{s.set(t6(t),r[e])}),s},en=(t,e)=>{let{nodes:n=[],edges:i=[]}=t,r=Array(n.length).fill(null).map(()=>Array(n.length).fill(0));return i.forEach(t=>{let{source:i,target:s}=t,o=n.findIndex(t=>t6(t)===i),a=n.findIndex(t=>t6(t)===s);e?r[o][a]=1:(r[o][a]=1,r[a][o]=1)}),r},ei=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6,r=Array(e).fill(1),s=1/0;for(let o=0;o<n&&s>i;o++){let n=Array(e).fill(0);for(let i=0;i<e;i++)for(let s=0;s<e;s++)n[i]+=t[i][s]*r[s];let i=Math.sqrt(n.reduce((t,e)=>t+e*e,0));for(let t=0;t<e;t++)n[t]/=i;s=Math.sqrt(n.reduce((t,e,n)=>t+(e-r[n])*e,0)),r=n}return r};function er(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.Z,r=new Map(t.map(t=>[n(t),t])),s=new Map(e.map(t=>[n(t),t])),o=new Set(r.keys()),a=new Set(s.keys()),l=[],h=[],d=[],c=[];return a.forEach(t=>{o.has(t)?i(r.get(t),s.get(t))?c.push(s.get(t)):h.push(s.get(t)):l.push(s.get(t))}),o.forEach(t=>{a.has(t)||d.push(r.get(t))}),{enter:l,exit:d,keep:c,update:h}}function es(t,e,n){let i=t=>{(!n||n(t))&&(t.style.visibility=e)};t.forEach(t=>{i(t)})}class eo{setExtensions(t){let e=function(t,e,n){let i={},r=t=>(t in i||(i[t]=0),"".concat(e,"-").concat(t,"-").concat(i[t]++));return n.map(e=>"string"==typeof e?{type:e,key:r(e)}:"function"==typeof e?e.call(t):e.key?e:Object.assign(Object.assign({},e),{key:r(e.type)}))}(this.context.graph,this.category,t),{enter:n,update:i,exit:r,keep:s}=er(this.extensions,e,t=>t.key);this.createExtensions(n),this.updateExtensions([...i,...s]),this.destroyExtensions(r),this.extensions=e}createExtension(t){let{category:e}=this,{key:n,type:i}=t,r=G(e,i);if(!r)return U.warn("The extension ".concat(i," of ").concat(e," is not registered."));let s=new r(this.context,t);this.extensionMap[n]=s}createExtensions(t){t.forEach(t=>this.createExtension(t))}updateExtension(t){let{key:e}=t,n=this.extensionMap[e];n&&n.update(t)}updateExtensions(t){t.forEach(t=>this.updateExtension(t))}destroyExtension(t){let e=this.extensionMap[t];e&&(e.destroy(),delete this.extensionMap[t])}destroyExtensions(t){t.forEach(t=>{let{key:e}=t;return this.destroyExtension(e)})}destroy(){Object.values(this.extensionMap).forEach(t=>t.destroy()),this.context={},this.extensions=[],this.extensionMap={}}constructor(t){this.extensions=[],this.extensionMap={},this.context=t}}class ea{update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}constructor(t,e){this.events=[],this.destroyed=!1,this.context=t,this.options=e}}class el extends ea{}class eh extends el{update(t){this.unbindEvents(),super.update(t),this.bindEvents(),this.onToggleVisibility({})}getLabelElements(){let{elementMap:t}=this.context.element,e=[];for(let n in t){let i=t[n];i.isVisible()&&i.getShape("label")&&e.push(i)}return e}getLabelElementsInView(){let t=this.context.viewport;return this.getLabelElements().filter(e=>t.isInViewport(e.getShape("key").getRenderBounds()))}bindEvents(){let{graph:t}=this.context;t.on(D.BEFORE_RENDER,this.onBeforeRender),t.on(D.AFTER_RENDER,this.onAfterRender),t.on(D.AFTER_DRAW,this.toggle),t.on(D.AFTER_LAYOUT,this.toggle),t.on(D.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){let{graph:t}=this.context;t.off(D.BEFORE_RENDER,this.onBeforeRender),t.off(D.AFTER_RENDER,this.onAfterRender),t.off(D.AFTER_DRAW,this.toggle),t.off(D.AFTER_LAYOUT,this.toggle),t.off(D.AFTER_TRANSFORM,this.onTransform)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},eh.defaultOptions,e)),this.isOverlapping=(t,e)=>e.some(e=>t.intersects(e)),this.occupiedBounds=[],this.detectLabelCollision=t=>{let e=this.context.viewport,n={show:[],hide:[]};return this.occupiedBounds=[],t.forEach(t=>{let i=t.getShape("label").getRenderBounds();e.isInViewport(i,!0)&&!this.isOverlapping(i,this.occupiedBounds)?(n.show.push(t),this.occupiedBounds.push(tE(i,this.options.padding))):n.hide.push(t)}),n},this.hideLabelIfExceedViewport=(t,e)=>{let{exit:n}=er(t,e,t=>t.id);null==n||n.forEach(this.hideLabel)},this.nodeCentralities=new Map,this.sortNodesByCentrality=(t,e)=>{let{model:n}=this.context,i=n.getData(),r=n.getRelatedEdgesData.bind(n),s=t.map(t=>(this.nodeCentralities.has(t.id)||(this.nodeCentralities=t8(i,r,e)),{node:t,centrality:this.nodeCentralities.get(t.id)}));return s.sort((t,e)=>e.centrality-t.centrality).map(t=>t.node)},this.sortLabelElementsInView=t=>{let{sort:e,sortNode:n,sortCombo:i,sortEdge:r}=this.options,{model:s}=this.context;if((0,to.Z)(e))return t.sort((t,n)=>e(s.getElementDataById(t.id),s.getElementDataById(n.id)));let{node:o=[],edge:a=[],combo:l=[]}=th(t,t=>t.type),h=(0,to.Z)(i)?l.sort((t,e)=>i(...s.getComboData([t.id,e.id]))):l,d=(0,to.Z)(n)?o.sort((t,e)=>n(...s.getNodeData([t.id,e.id]))):this.sortNodesByCentrality(o,n),c=(0,to.Z)(r)?a.sort((t,e)=>r(...s.getEdgeData([t.id,e.id]))):a;return[...h,...d,...c]},this.labelElementsInView=[],this.isFirstRender=!0,this.onToggleVisibility=t=>{var e;if((null===(e=t.data)||void 0===e?void 0:e.stage)==="zIndex")return;if(!this.validate(t)){this.hiddenElements.size>0&&(this.hiddenElements.forEach(this.showLabel),this.hiddenElements.clear());return}let n=this.isFirstRender?this.getLabelElements():this.getLabelElementsInView();this.hideLabelIfExceedViewport(this.labelElementsInView,n),this.labelElementsInView=n;let i=this.sortLabelElementsInView(this.labelElementsInView),{show:r,hide:s}=this.detectLabelCollision(i);for(let t=r.length-1;t>=0;t--)this.showLabel(r[t]);s.forEach(this.hideLabel)},this.hiddenElements=new Map,this.hideLabel=t=>{let e=t.getShape("label");e&&es(e,"hidden"),this.hiddenElements.set(t.id,t)},this.showLabel=t=>{let e=t.getShape("label");e&&es(e,"visible"),t.toFront(),this.hiddenElements.delete(t.id)},this.onTransform=(0,td.Z)(this.onToggleVisibility,this.options.throttle,{leading:!0}),this.enableToggle=!0,this.toggle=t=>{this.enableToggle&&this.onToggleVisibility(t)},this.onBeforeRender=()=>{this.enableToggle=!1},this.onAfterRender=t=>{this.onToggleVisibility(t),this.enableToggle=!0},this.bindEvents()}}eh.defaultOptions={enable:!0,throttle:100,padding:0,sortNode:{type:"degree"}};var ed=n(82439);let ec=[0,0,0];function eu(t,e){return t.map((t,n)=>t+e[n])}function ep(t,e){return t.map((t,n)=>t-e[n])}function eg(t,e){return"number"==typeof e?t.map(t=>t*e):t.map((t,n)=>t*e[n])}function ef(t,e){return"number"==typeof e?t.map(t=>t/e):t.map((t,n)=>t/e[n])}function ey(t,e){return t.map(t=>t*e)}function em(t,e){return Math.sqrt(t.reduce((t,n,i)=>t+Math.pow(n-e[i]||0,2),0))}function ev(t,e){return t.reduce((t,n,i)=>t+Math.abs(n-e[i]),0)}function eb(t){let e=t.reduce((t,e)=>t+Math.pow(e,2),0);return t.map(t=>t/Math.sqrt(e))}function eE(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0]*e[1]-t[1]*e[0],r=Math.acos(eg(t,e).reduce((t,e)=>t+e,0)/(em(t,ec)*em(e,ec)));return n&&i<0&&(r=2*Math.PI-r),r}function ex(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e?[-t[1],t[0]]:[t[1],-t[0]]}function eO(t){return[t[0],t[1]]}function ew(t){return 2===t.length?[t[0],t[1],0]:t}function eS(t){let[e,n]=t;return e||n?Math.atan2(n,e):0}function eD(t,e){let[n,i]=t,[r,s]=e,o=ep(n,i),a=ep(r,s);return(function(t,e){let n=ew(t),i=ew(e);return[n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0]]})(o,a).every(t=>0===t)}function eC(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(eD(t,e))return;let[i,r]=t,[s,o]=e,a=((i[0]-s[0])*(s[1]-o[1])-(i[1]-s[1])*(s[0]-o[0]))/((i[0]-r[0])*(s[1]-o[1])-(i[1]-r[1])*(s[0]-o[0])),l=o[0]-s[0]?(i[0]-s[0]+a*(r[0]-i[0]))/(o[0]-s[0]):(i[1]-s[1]+a*(r[1]-i[1]))/(o[1]-s[1]);if(n||tp(a,0,1)&&tp(l,0,1))return[i[0]+a*(r[0]-i[0]),i[1]+a*(r[1]-i[1])]}function eM(t){if(Array.isArray(t))return tp(t[0],0,1)&&tp(t[1],0,1)?t:[.5,.5];let e=t.split("-"),n=e.includes("left")?0:e.includes("right")?1:.5,i=e.includes("top")?0:e.includes("bottom")?1:.5;return[n,i]}function eT(t){let{x:e=0,y:n=0,z:i=0}=t.style||{};return[+e,+n,+i]}function eA(t){let{x:e,y:n,z:i}=t.style||{};return void 0!==e||void 0!==n||void 0!==i}function eL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=eM(e);return function(t,e){let[n,i]=e,{min:r,max:s}=t;return[r[0]+n*(s[0]-r[0]),r[1]+i*(s[1]-r[1])]}(t,n)}function eR(t){var e;return[t.x,t.y,null!==(e=t.z)&&void 0!==e?e:0]}function eP(t){var e;return{x:t[0],y:t[1],z:null!==(e=t[2])&&void 0!==e?e:0}}function ek(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.map(t=>parseFloat(t.toFixed(e)))}function eN(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,F.Z)(t,e))return t;let r=i?ep(t,e):ep(e,t),s=eb(r),o=[s[0]*n,s[1]*n];return eu(eO(t),o)}function ej(t,e){return[2*e[0]-t[0],2*e[1]-t[1]]}function eI(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(let s=0;s<n.length;s++){let o=n[s],a=n[(s+1)%n.length];i&&(o=eu(e,o),a=eu(e,a));let l=r?ej(t,e):t,h=eC([e,l],[o,a]);if(h)return{point:h,line:[o,a]}}return{point:e,line:void 0}}function eB(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.center,r=n?ej(t,i):t,s=ep(r,e.center),o=Math.atan2(s[1],s[0]);if(isNaN(o))return i;let a=tf(e)/2,l=ty(e)/2,h=i[0]+a*Math.cos(o),d=i[1]+l*Math.sin(o);return[h,d]}function eF(t,e){let[n,i]=e[0],[r,s]=e[1],[o,a]=t,l=r-n,h=s-i;if(0===l&&0===h)return[n,i];let d=((o-n)*l+(a-i)*h)/(l*l+h*h);d>1?d=1:d<0&&(d=0);let c=n+d*l,u=i+d*h;return[c,u]}function e_(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=function(t){let e=t.reduce((t,e)=>eu(t,e),[0,0]);return ef(e,t.length)}(t);return t.sort((t,i)=>{let[r,s]=t,[o,a]=i,l=Math.atan2(s-n[1],r-n[0]),h=Math.atan2(a-n[1],o-n[0]);return e?h-l:l-h})}function ez(t,e){return[t,[t[0],e[1]],e,[e[0],t[1]]]}var eZ=n(7608);let eV=t=>t.map(t=>(0,eZ.Z)(t)?t.toLocaleLowerCase():t);class eW{bind(t,e){0!==t.length&&this.map.set(t,e)}unbind(t,e){this.map.forEach((n,i)=>{(0,F.Z)(i,t)&&(!e||e===n)&&this.map.delete(i)})}unbindAll(){this.map.clear()}match(t){let e=eV(Array.from(this.recordKey)).sort(),n=eV(t).sort();return(0,F.Z)(e,n)}bindEvents(){var t;let{emitter:e}=this;e.on(O.KEY_DOWN,this.onKeyDown),e.on(O.KEY_UP,this.onKeyUp),e.on(O.WHEEL,this.onWheel),e.on(O.DRAG,this.onDrag),null===(t=globalThis.addEventListener)||void 0===t||t.call(globalThis,"focus",this.onFocus)}trigger(t){this.map.forEach((e,n)=>{this.match(n)&&e(t)})}triggerExtendKey(t,e){this.map.forEach((n,i)=>{i.includes(t)&&(0,F.Z)(Array.from(this.recordKey),i.filter(e=>e!==t))&&n(e)})}destroy(){var t;this.unbindAll(),this.emitter.off(O.KEY_DOWN,this.onKeyDown),this.emitter.off(O.KEY_UP,this.onKeyUp),this.emitter.off(O.WHEEL,this.onWheel),this.emitter.off(O.DRAG,this.onDrag),null===(t=globalThis.removeEventListener)||void 0===t||t.call(globalThis,"blur",this.onFocus)}constructor(t){this.map=new Map,this.recordKey=new Set,this.onKeyDown=t=>{(null==t?void 0:t.key)&&(this.recordKey.add(t.key),this.trigger(t))},this.onKeyUp=t=>{(null==t?void 0:t.key)&&this.recordKey.delete(t.key)},this.onWheel=t=>{this.triggerExtendKey(O.WHEEL,t)},this.onDrag=t=>{this.triggerExtendKey(O.DRAG,t)},this.onFocus=()=>{this.recordKey.clear()},this.emitter=t,this.bindEvents()}}class eH extends el{onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;let{canvas:e,graph:n}=this.context,i=Object.assign({},this.options.style);this.options.style.lineWidth&&(i.lineWidth=+this.options.style.lineWidth/n.getZoom()),this.rectShape=new j.UL({id:"g6-brush-select",style:i}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){var e;if(!this.startPoint)return;let{immediately:n,mode:i}=this.options;this.endPoint=eG(t),null===(e=this.rectShape)||void 0===e||e.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),n&&"default"===i&&this.updateElementsStates(ez(this.startPoint,this.endPoint))}onPointerUp(t){if(this.startPoint){if(!this.endPoint){this.clearBrush();return}this.endPoint=eG(t),this.updateElementsStates(ez(this.startPoint,this.endPoint)),this.clearBrush()}}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){let{graph:t}=this.context,e=Object.values(t.getData()).reduce((t,e)=>Object.assign({},t,e.reduce((t,e)=>(t[t6(e)]=[],t),{})),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){let{graph:e}=this.context,{enableElements:n,state:i,mode:r,onSelect:s}=this.options,o=this.selector(e,t,n),a={};switch(r){case"union":o.forEach(t=>{a[t]=[...e.getElementState(t),i]});break;case"diff":o.forEach(t=>{let n=e.getElementState(t);a[t]=n.includes(i)?n.filter(t=>t!==i):[...n,i]});break;case"intersect":o.forEach(t=>{let n=e.getElementState(t);a[t]=n.includes(i)?[i]:[]});break;default:o.forEach(t=>{a[t]=[i]})}(0,to.Z)(s)&&(a=s(a)),e.setElementState(a,this.options.animation)}selector(t,e,n){if(!n||0===n.length)return[];let i=[],r=t.getData();if(n.forEach(n=>{r["".concat(n,"s")].forEach(n=>{let r=t6(n);"hidden"!==t.getElementVisibility(r)&&function(t,e,n,i){let r=t[0],s=t[1],o=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);let a=i-n;for(let t=0,i=a-1;t<a;i=t++){let a=e[t+n][0],l=e[t+n][1],h=e[i+n][0],d=e[i+n][1],c=l>s!=d>s&&r<(h-a)*(s-l)/(d-l)+a;c&&(o=!o)}return o}(t.getElementPosition(r),e)&&i.push(r)})}),n.includes("edge")){let t=r.edges;null==t||t.forEach(t=>{let{source:e,target:n}=t;i.includes(e)&&i.includes(n)&&i.push(t6(t))})}return i}clearBrush(){var t;null===(t=this.rectShape)||void 0===t||t.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){let{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return this.shortcut.match(e.filter(t=>"drag"!==t))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}bindEvents(){let{graph:t}=this.context;t.on(O.POINTER_DOWN,this.onPointerDown),t.on(O.POINTER_MOVE,this.onPointerMove),t.on(O.POINTER_UP,this.onPointerUp),t.on(E.CLICK,this.clearStates)}unbindEvents(){let{graph:t}=this.context;t.off(O.POINTER_DOWN,this.onPointerDown),t.off(O.POINTER_MOVE,this.onPointerMove),t.off(O.POINTER_UP,this.onPointerUp),t.off(E.CLICK,this.clearStates)}update(t){this.unbindEvents(),this.options=(0,ed.Z)(this.options,t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,(0,ed.Z)({},eH.defaultOptions,e)),this.shortcut=new eW(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}}eH.defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#1677FF",stroke:"#1677FF",fillOpacity:.1,zIndex:2,pointerEvents:"none"}};let eG=t=>[t.canvas.x,t.canvas.y],eY=["node","edge","combo"];function eU(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;"TB"===i&&e(t,r);let s=n(t);if(s)for(let t of s)eU(t,e,n,i,r+1);"BT"===i&&e(t,r)}function eK(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"both";if("combo"===e||"node"===e)return eX(t,n,i,r);let s=t.getEdgeData(n);if(!s)return[];let o=eX(t,s.source,i-1,r),a=eX(t,s.target,i-1,r);return Array.from(new Set([...o,...a,n]))}function eX(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"both",r=new Set,s=new Set,o=new Set;return!function(t,e,n){let i=[[t,0]];for(;i.length;){let[t,r]=i.shift();e(t,r);let s=n(t);if(s)for(let t of s)i.push([t,r+1])}}(e,(e,r)=>{r>n||(o.add(e),t.getRelatedEdgesData(e,i).forEach(t=>{let e=t6(t);!s.has(e)&&r<n&&(o.add(e),s.add(e))}))},e=>t.getRelatedEdgesData(e,i).map(t=>t.source===e?t.target:t.source).filter(t=>!r.has(t)&&(r.add(t),!0))),Array.from(o)}function e$(t){return t.states||[]}var eq=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class eJ extends el{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),eY.forEach(e=>{t.on("".concat(e,":").concat(O.CLICK),this.onClickSelect)}),t.on(E.CLICK,this.onClickCanvas)}get isMultipleSelect(){let{multiple:t,trigger:e}=this.options;return t&&this.shortcut.match(e)}getNeighborIds(t){let{target:e,targetType:n}=t,{graph:i}=this.context,{degree:r}=this.options;return eK(i,n,e.id,"function"==typeof r?r(t):r).filter(t=>t!==e.id)}updateState(t){return eq(this,void 0,void 0,function*(){let{state:e,unselectedState:n,neighborState:i,animation:r}=this.options;if(!e&&!i&&!n)return;let{target:s}=t,{graph:o}=this.context,a=o.getElementData(s.id),l=e$(a).includes(e)?"unselect":"select",h={},d=this.isMultipleSelect,c=[s.id],u=this.getNeighborIds(t);if(d){if(Object.assign(h,this.getDataStates()),"select"===l){let t=(t,e)=>{t.forEach(t=>{let i=new Set(o.getElementState(t));i.add(e),i.delete(n),h[t]=Array.from(i)})};t(c,e),t(u,i),n&&Object.keys(h).forEach(t=>{let r=h[t];r.includes(e)||r.includes(i)||r.includes(n)||h[t].push(n)})}else{let t=h[s.id];h[s.id]=t.filter(t=>t!==e&&t!==i),t.includes(n)||h[s.id].push(n),u.forEach(t=>{h[t]=h[t].filter(t=>t!==i),h[t].includes(e)||h[t].push(n)})}}else if("select"===l){Object.assign(h,this.getClearStates(!!n));let t=(t,e)=>{t.forEach(t=>{h[t]||(h[t]=o.getElementState(t)),h[t].push(e)})};t(c,e),t(u,i),n&&Object.keys(h).forEach(t=>{c.includes(t)||u.includes(t)||h[t].push(n)})}else Object.assign(h,this.getClearStates());yield o.setElementState(h,r)})}getDataStates(){let{graph:t}=this.context,{nodes:e,edges:n,combos:i}=t.getData(),r={};return[...e,...n,...i].forEach(t=>{r[t6(t)]=e$(t)}),r}getClearStates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=this.context,{state:n,unselectedState:i,neighborState:r}=this.options,s=new Set([n,i,r]),{nodes:o,edges:a,combos:l}=e.getData(),h={};return[...o,...a,...l].forEach(e=>{let n=e$(e),i=n.filter(t=>!s.has(t));t?h[t6(e)]=i:i.length!==n.length&&(h[t6(e)]=i)}),h}clearState(){return eq(this,void 0,void 0,function*(){let{graph:t}=this.context;yield t.setElementState(this.getClearStates(),this.options.animation)})}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;eY.forEach(e=>{t.off("".concat(e,":").concat(O.CLICK),this.onClickSelect)}),t.off(E.CLICK,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},eJ.defaultOptions,e)),this.onClickSelect=t=>eq(this,void 0,void 0,function*(){var e,n;this.validate(t)&&(yield this.updateState(t),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))}),this.onClickCanvas=t=>eq(this,void 0,void 0,function*(){var e,n;this.validate(t)&&(yield this.clearState(),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))}),this.shortcut=new eW(t.graph),this.bindEvents()}}function eQ(t){var e;return!!(null===(e=t.style)||void 0===e?void 0:e.collapsed)}eJ.defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};var e0=n(3451),e1=n(24260),e2=n(84315);function e3(t,e){if(!t.startsWith(e))return!1;let n=t[e.length];return n>="A"&&n<="Z"}function e6(t,e){let n=Object.entries(t).reduce((t,n)=>{let[i,r]=n;return"className"===i||"class"===i||e3(i,e)&&Object.assign(t,{[function(t,e){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e||!e3(t,e))return t;let i=t.slice(e.length);return n?(0,e2.Z)(i):i}(i,e)]:r}),t},{});if("opacity"in t){let i="".concat(e).concat((0,I.Z)("opacity")),r=t.opacity;if(i in t){let e=t[i];Object.assign(n,{opacity:r*e})}else Object.assign(n,{opacity:r})}return n}function e4(t,e){let n=e.length;return Object.keys(t).reduce((i,r)=>{if(r.startsWith(e)){let e=r.slice(n);i[e]=t[r]}return i},{})}function e8(t,e){let n="string"==typeof e?[e]:e,i={};return Object.keys(t).forEach(e=>{n.find(t=>e.startsWith(t))||(i[e]=t[e])}),i}function e9(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"==typeof t)return[t,t,t];let[e,n=e,i=e]=t;return[e,n,i]}var e5=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function e7(t,e){let{datum:n,graph:i}=e;return"function"==typeof t?t.call(i,n):Object.fromEntries(Object.entries(t).map(t=>{let[e,r]=t;return"function"==typeof r?[e,r.call(i,n)]:[e,r]}))}function nt(t,e){let n=(null==t?void 0:t.style)||{},i=(null==e?void 0:e.style)||{};for(let t in n)t in i||(i[t]=n[t]);return Object.assign({},t,e,{style:i})}function ne(t){if(t)return"string"==typeof t||"function"==typeof t||Array.isArray(t)?{type:"group",field:t=>t.id,color:t,invert:!1}:t}function nn(t){let e="string"==typeof t?G("palette",t):t;if("function"!=typeof e)return e}function ni(t,e){let n=2*t;return"string"==typeof e?n=t*Number(e.replace("%",""))/100:"number"==typeof e&&(n=e),isNaN(n)&&(n=2*t),n}function nr(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=(t.max[0]-t.min[0])*(i?n:1);return ni(r,e)}var ns=n(66042),no={}.toString,na=Object.prototype,nl=function(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||na;return t===n},nh=Object.prototype.hasOwnProperty,nd=function(t){if((0,B.Z)(t))return!0;if((0,ns.Z)(t))return!t.length;var e=no.call(t).replace(/^\[object /,"").replace(/]$/,"");if("Map"===e||"Set"===e)return!t.size;if(nl(t))return!Object.keys(t).length;for(var n in t)if(nh.call(t,n))return!1;return!0};class nc extends j.b_{get parsedAttributes(){return this.attributes}upsert(t,e,n,i,r){var s,o,a,l,h,d,c,u;let p=this.shapeMap[t];if(!1===n){p&&(null===(s=null==r?void 0:r.beforeDestroy)||void 0===s||s.call(r,p),i.removeChild(p),delete this.shapeMap[t],null===(o=null==r?void 0:r.afterDestroy)||void 0===o||o.call(r,p));return}let g="string"==typeof e?G(T.SHAPE,e):e;if(!g)throw Error(Y("Shape ".concat(e," not found")));if(!p||p.destroyed||!(p instanceof g)){p&&(null===(a=null==r?void 0:r.beforeDestroy)||void 0===a||a.call(r,p),null==p||p.destroy(),null===(l=null==r?void 0:r.afterDestroy)||void 0===l||l.call(r,p)),null===(h=null==r?void 0:r.beforeCreate)||void 0===h||h.call(r);let e=new g({className:t,style:n});return i.appendChild(e),this.shapeMap[t]=e,null===(d=null==r?void 0:r.afterCreate)||void 0===d||d.call(r,e),e}return null===(c=null==r?void 0:r.beforeUpdate)||void 0===c||c.call(r,p),iK(p,n),null===(u=null==r?void 0:r.afterUpdate)||void 0===u||u.call(r,p),p}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this.attributes,t);np(e),function(t,e){let{zIndex:n,transform:i,transformOrigin:r,visibility:s,cursor:o,clipPath:a,component:l}=e,h=iN(e,["zIndex","transform","transformOrigin","visibility","cursor","clipPath","component"]);Object.assign(t.attributes,h),i&&t.setAttribute("transform",i),(0,Q.Z)(n)&&t.setAttribute("zIndex",n),r&&t.setAttribute("transformOrigin",r),s&&t.setAttribute("visibility",s),o&&t.setAttribute("cursor",o),a&&t.setAttribute("clipPath",a),l&&t.setAttribute("component",l)}(this,e),this.render(e,this),this.setVisibility()}bindEvents(){}getGraphicStyle(t){return function(t){let{x:e,y:n,z:i,class:r,className:s,transform:o,transformOrigin:a,zIndex:l,visibility:h}=t,d=e5(t,["x","y","z","class","className","transform","transformOrigin","zIndex","visibility"]);return d}(t)}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}animate(t,e){if(0===t.length)return null;let n=[];if(void 0!==t[0].x||void 0!==t[0].y||void 0!==t[0].z){let{x:e=0,y:n=0,z:i=0}=this.attributes;t.forEach(t=>{let{x:r=e,y:s=n,z:o=i}=t;Object.assign(t,{transform:o?[["translate3d",r,s,o]]:[["translate",r,s]]})})}let i=super.animate(t,e);if(i&&(nu(this,i),n.push(i)),Array.isArray(t)&&t.length>0){let i=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some(t=>!i.includes(t))){Object.entries(this.shapeMap).forEach(i=>{let[r,s]=i,o="get".concat((0,I.Z)(r),"Style"),a=this[o];if((0,to.Z)(a)){let i=t.map(t=>a.call(this,Object.assign(Object.assign({},this.attributes),t))),r=s.animate($(i),e);r&&(nu(s,r),n.push(r))}});let i=(i,r)=>{if(!nd(i)){let s="get".concat((0,I.Z)(r),"Style"),o=this[s];if((0,to.Z)(o)){let r=t.map(t=>o.call(this,Object.assign(Object.assign({},this.attributes),t)));Object.entries(r[0]).map(t=>{let[s]=t,o=r.map(t=>t[s]),a=i[s];if(a){let t=a.animate($(o),e);t&&(nu(a,t),n.push(t))}})}}};this.compositeShapes.forEach(t=>{let[e,n]=t,r=e4(this.shapeMap,n);i(r,e)})}}return X(n)}getShape(t){return this.shapeMap[t]}setVisibility(){let{visibility:t}=this.attributes;es(this,t)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}constructor(t){np(t.style),super(t),this.shapeMap={},this.animateMap={},this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}}function nu(t,e){null==e||e.finished.then(()=>{let n=t.activeAnimations.findIndex(t=>t===e);n>-1&&t.activeAnimations.splice(n,1)})}function np(t){if(!t)return{};if("x"in t||"y"in t||"z"in t){let{x:e=0,y:n=0,z:i,transform:r}=t,s=tt(e,n,i,r);s&&(t.transform=s)}return t}var ng=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nf extends nc{isTextStyle(t){return e3(t,"label")}isBackgroundStyle(t){return e3(t,"background")}getTextStyle(t){let e=this.getGraphicStyle(t),{padding:n}=e,i=ng(e,["padding"]);return e8(i,"background")}getBackgroundStyle(t){if(!1===t.background)return!1;let e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:i,padding:r}=e,s=e6(e,"background"),{min:[o,a],center:[l,h],halfExtents:[d,c]}=this.shapeMap.text.getGeometryBounds(),[u,p,g,f]=tg(r),y=2*d+f+p,{width:m,height:v}=s;m&&v?Object.assign(s,{x:l-Number(m)/2,y:h-Number(v)/2}):Object.assign(s,{x:o-f,y:a-u,width:n?Math.min(y,i+f+p):y,height:2*c+u+g});let{radius:b}=s;if("string"==typeof b&&b.endsWith("%")){let t=Number(b.replace("%",""))/100;s.radius=Math.min(+s.width,+s.height)*t}return s}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("text",j.xv,this.getTextStyle(t),e),this.upsert("background",j.UL,this.getBackgroundStyle(t),e)}getGeometryBounds(){let t=this.getShape("background")||this.getShape("text");return t.getGeometryBounds()}constructor(t){super(nt({style:nf.defaultStyleProps},t))}}nf.defaultStyleProps={padding:0,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};class ny extends nc{getBadgeStyle(t){return this.getGraphicStyle(t)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("label",nf,this.getBadgeStyle(t),e)}getGeometryBounds(){let t=this.getShape("label"),e=t.getShape("background")||t.getShape("text");return e.getGeometryBounds()}constructor(t){super(nt({style:ny.defaultStyleProps},t))}}ny.defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};let nm={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]},nv=t=>{if(t.length<2)return[["M",0,0],["L",0,0]];let e=t[0],n=t[1],i=t[t.length-1],r=t[t.length-2];t.unshift(r,i),t.push(e,n);let s=[["M",i[0],i[1]]];for(let e=1;e<t.length-2;e+=1){let[n,i]=t[e-1],[r,o]=t[e],[a,l]=t[e+1],[h,d]=e!==t.length-2?t[e+2]:[a,l],c=r+(a-n)/6,u=o+(l-i)/6,p=a-(h-r)/6,g=l-(d-o)/6;s.push(["C",c,u,p,g,a,l])}return s};var nb=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nE extends nc{getLabelStyle(t){if(!t.label||!t.d||0===t.d.length)return!1;let e=e6(this.getGraphicStyle(t),"label"),{maxWidth:n,offsetX:i,offsetY:r,autoRotate:s,placement:o,closeToPath:a}=e,l=nb(e,["maxWidth","offsetX","offsetY","autoRotate","placement","closeToPath"]),h=this.shapeMap.key,d=null==h?void 0:h.getRenderBounds();return Object.assign(function(t,e,n,i,r,s,o){var a;let l,h;let[d,c]=eL(t,e),u={textAlign:"left"===e?"right":"right"===e?"left":"center",textBaseline:"top"===e?"bottom":"bottom"===e?"top":"middle",transform:[["translate",d+n,c+i]]};if("center"===e||!r)return u;let p=function(t){let e=[],n="string"==typeof t?function(t){let e=t.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),n=[],i="",r={};for(;e.length>0;){let t=e.shift();t in nm?i=t:e.unshift(t),r={type:i},nm[i].forEach(n=>{t=e.shift(),r[n]=t}),"M"===i?i="L":"m"===i&&(i="l");let[s,...o]=Object.values(r);n.push([s,...o.map(Number)])}return n}(t):t;return n.forEach(t=>{let n=t[0];if("Z"===n){e.push(e[0]);return}if("A"!==n)for(let n=1;n<t.length;n+=2)e.push([t[n],t[n+1],0]);else{let n=t.length;e.push([t[n-2],t[n-1],0])}}),e}(s);if(!p||p.length<=3)return u;let g=p.map((t,e)=>{let n=p[(e+1)%p.length];return(0,F.Z)(t,n)?null:[t,n]}).filter(Boolean),f=(a=[d,c],l=1/0,h=[[0,0],[0,0]],g.forEach(t=>{let e=function(t,e){let n=eF(t,e);return em(t,n)}(a,t);e<l&&(l=e,h=t)}),h),y=eF([d,c],f);if(y&&f&&(u.transform=[["translate",y[0]+n,y[1]+i]],o)){let t=Math.atan((f[0][1]-f[1][1])/(f[0][0]-f[1][0]));u.transform.push(["rotate",t/Math.PI*180]),u.textAlign="center",("right"===e||"left"===e)&&(t>0?u.textBaseline="right"===e?"bottom":"top":u.textBaseline="right"===e?"top":"bottom")}return u}(d,o,i,r,a,t.d,s),{wordWrapWidth:nr(d,n)},l)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",j.y$,this.getKeyStyle(t),e),this.upsert("label",nf,this.getLabelStyle(t),e)}constructor(t){super(nt({style:nE.defaultStyleProps},t))}}nE.defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};class nx extends j.Ee{handleRadius(){let{radius:t,clipPath:e,width:n=0,height:i=0}=this.attributes;if(t&&n&&i){let[r,s]=this.getBounds().min,o={x:r,y:s,radius:t,width:n,height:i};if(e)Object.assign(this.parsedStyle.clipPath.style,o);else{let t=new j.UL({style:o});this.style.clipPath=t}}else e&&(this.style.clipPath=null)}constructor(t){super(t),this.onMounted=()=>{this.handleRadius()},this.onAttrModified=()=>{this.handleRadius()},nw=this,this.isMutationObserved=!0,this.addEventListener(j.Dk.MOUNTED,this.onMounted),this.addEventListener(j.Dk.ATTR_MODIFIED,this.onAttrModified)}}let nO=new WeakMap,nw=null,nS=t=>{if(nw&&(function(t){let e=[],n=t.parentNode;for(;n;)e.push(n),n=n.parentNode;return e})(nw).includes(t)){let e=nO.get(t);e?e.includes(nw)||e.push(nw):nO.set(t,[nw])}},nD=t=>{let e=nO.get(t);e&&e.forEach(t=>t.handleRadius())};class nC extends nc{isImage(){let{src:t}=this.attributes;return!!t}getIconStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{width:e=0,height:n=0}=t,i=this.getGraphicStyle(t);return this.isImage()?Object.assign({x:-e/2,y:-n/2},i):Object.assign({textBaseline:"middle",textAlign:"center"},i)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("icon",this.isImage()?nx:j.xv,this.getIconStyle(t),e)}constructor(t){super(t)}}class nM extends nc{get context(){return this.config.context}get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){let n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then(()=>this.onframe())),n}}var nT=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nA extends nM{getSize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{size:e}=t;return e9(e)}getKeyStyle(t){let e=this.getGraphicStyle(t);return Object.assign(e8(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let e=e6(this.getGraphicStyle(t),"label"),{placement:n,maxWidth:i,offsetX:r,offsetY:s}=e,o=nT(e,["placement","maxWidth","offsetX","offsetY"]),a=this.getShape("key").getLocalBounds();return Object.assign(iU(a,n,r,s),{wordWrapWidth:nr(a,i)},o)}getHaloStyle(t){if(!1===t.halo)return!1;let e=this.getKeyStyle(t),{fill:n}=e,i=nT(e,["fill"]),r=e6(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign(Object.assign({},i),{stroke:n}),r)}getIconStyle(t){if(!1===t.icon||!t.iconText&&!t.iconSrc)return!1;let e=e6(this.getGraphicStyle(t),"icon");return Object.assign(function(t,e){let n=e9(t),i={};return e.text&&!e.fontSize&&(i={fontSize:.5*Math.min(...n)}),!e.src||e.width&&e.height||(i={width:.5*n[0],height:.5*n[1]}),i}(t.size,e),e)}getBadgesStyle(t){var e;let n=e4(this.shapeMap,"badge-"),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.badge||!(null===(e=t.badges)||void 0===e?void 0:e.length))return i;let{badges:r=[],badgePalette:s,opacity:o=1}=t,a=nT(t,["badges","badgePalette","opacity"]),l=nn(s),h=e6(this.getGraphicStyle(a),"badge");return r.forEach((t,e)=>{i[e]=Object.assign(Object.assign({backgroundFill:l?l[e%(null==l?void 0:l.length)]:void 0,opacity:o},h),this.getBadgeStyle(t))}),i}getBadgeStyle(t){let e=this.getShape("key"),{placement:n="top",offsetX:i,offsetY:r}=t,s=nT(t,["placement","offsetX","offsetY"]),o=iU(e.getLocalBounds(),n,i,r,!0);return Object.assign(Object.assign({},o),s)}getPortsStyle(t){var e;let n=this.getPorts(),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.port||!(null===(e=t.ports)||void 0===e?void 0:e.length))return i;let r=e6(this.getGraphicStyle(t),"port"),{ports:s=[]}=t;return s.forEach((e,n)=>{let s=e.key||n,o=Object.assign(Object.assign({},r),e);if(iZ(o))i[s]=!1;else{let[n,r]=this.getPortXY(t,e);i[s]=Object.assign({transform:[["translate",n,r]]},o)}}),i}getPortXY(t,e){let{placement:n="left"}=e,i=this.getShape("key");return i_(function(t,e){if(!t)return e.getLocalBounds();let n=t.canvas.getLayer(),i=e.cloneNode();es(i,"hidden"),n.appendChild(i);let r=i.getLocalBounds();return i.destroy(),r}(this.context,i),n)}getPorts(){return e4(this.shapeMap,"port-")}getCenter(){return this.getShape("key").getBounds().center}getIntersectPoint(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getShape("key").getBounds();return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=eL(e,"center"),r=[eL(e,"left-top"),eL(e,"right-top"),eL(e,"right-bottom"),eL(e,"left-bottom")];return eI(t,i,r,!1,n).point}(t,n,e)}drawHaloShape(t,e){let n=this.getHaloStyle(t),i=this.getShape("key");this.upsert("halo",i.constructor,n,e)}drawIconShape(t,e){let n=this.getIconStyle(t);this.upsert("icon",nC,n,e),nS(this)}drawBadgeShapes(t,e){let n=this.getBadgesStyle(t);Object.keys(n).forEach(t=>{let i=n[t];this.upsert("badge-".concat(t),ny,i,e)})}drawPortShapes(t,e){let n=this.getPortsStyle(t);Object.keys(n).forEach(t=>{let i=n[t],r="port-".concat(t);this.upsert(r,j.Cd,i,e)})}drawLabelShape(t,e){let n=this.getLabelStyle(t);this.upsert("label",nf,n,e)}_drawKeyShape(t,e){return this.drawKeyShape(t,e)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this._drawKeyShape(t,e),this.getShape("key")&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&nD(this)}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}constructor(t){super(nt({style:nA.defaultStyleProps},t)),this.type="node"}}nA.defaultStyleProps={x:0,y:0,size:32,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0};class nL extends nA{drawKeyShape(t,e){return this.upsert("key",j.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{r:Math.min(...this.getSize(t))/2})}getIconStyle(t){let e=super.getIconStyle(t),{r:n}=this.getShape("key").attributes,i=2*n*.8;return!!e&&Object.assign({width:i,height:i},e)}getIntersectPoint(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getShape("key").getBounds();return eB(t,n,e)}constructor(t){super(nt({style:nL.defaultStyleProps},t))}}nL.defaultStyleProps={size:32};class nR extends nA{get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",j.mg,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{points:this.getPoints(t)})}getIntersectPoint(t){var e,n;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{points:r}=this.getShape("key").attributes,s=[+((null===(e=this.attributes)||void 0===e?void 0:e.x)||0),+((null===(n=this.attributes)||void 0===n?void 0:n.y)||0)];return eI(t,s,r,!0,i).point}constructor(t){super(t)}}var nP=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nk extends nL{parseOuterR(){let{size:t}=this.parsedAttributes;return Math.min(...e9(t))/2}parseInnerR(){let{innerR:t}=this.parsedAttributes;return(0,eZ.Z)(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){let{donuts:n}=t;if(!(null==n?void 0:n.length))return;let i=n.map(t=>(0,Q.Z)(t)?{value:t}:t),r=e6(this.getGraphicStyle(t),"donut"),s=nn(t.donutPalette);if(!s)return;let o=i.reduce((t,e)=>{var n;return t+(null!==(n=e.value)&&void 0!==n?n:0)},0),a=this.parseOuterR(),l=this.parseInnerR(),h=0;i.forEach((t,n)=>{let{value:d=0,color:c=s[n%s.length]}=t,u=nP(t,["value","color"]),p=(0===o?1/i.length:d/o)*360;this.upsert("round".concat(n),j.y$,Object.assign(Object.assign(Object.assign({},r),{d:nB(a,l,h,h+p),fill:c}),u),e),h+=p})}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawDonutShape(t,e)}constructor(t){super(nt({style:nk.defaultStyleProps},t))}}nk.defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};let nN=(t,e,n,i)=>[t+Math.sin(i)*n,e-Math.cos(i)*n],nj=(t,e,n,i)=>i<=0||n<=i?[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"]]:[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"],["M",t+i,e],["A",i,i,0,1,0,t-i,e],["A",i,i,0,1,0,t+i,e],["Z"]],nI=(t,e,n,i,r,s)=>{let[o,a]=[r/360*2*Math.PI,s/360*2*Math.PI],l=[nN(t,e,i,o),nN(t,e,n,o),nN(t,e,n,a),nN(t,e,i,a)],h=a-o>Math.PI?1:0;return[["M",l[0][0],l[0][1]],["L",l[1][0],l[1][1]],["A",n,n,0,h,1,l[2][0],l[2][1]],["L",l[3][0],l[3][1]],["A",i,i,0,h,0,l[0][0],l[0][1]],["Z"]]},nB=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,[r,s]=[0,0];return Math.abs(n-i)%360<1e-6?nj(r,s,t,e):nI(r,s,t,e,n,i)};class nF extends nA{drawKeyShape(t,e){return this.upsert("key",j.Pj,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getSize(t);return Object.assign(Object.assign({},e),{rx:n/2,ry:i/2})}getIconStyle(t){let e=super.getIconStyle(t),{rx:n,ry:i}=this.getShape("key").attributes,r=2*Math.min(+n,+i)*.8;return!!e&&Object.assign({width:r,height:r},e)}getIntersectPoint(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getShape("key").getBounds();return eB(t,n,e)}constructor(t){super(nt({style:nF.defaultStyleProps},t))}}nF.defaultStyleProps={size:[45,35]};var n_=n(3510),nz=n(94825),nZ=n(3581),nV=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nW extends nA{get eventService(){return this.context.canvas.context.eventService}get events(){return[O.CLICK,O.POINTER_DOWN,O.POINTER_MOVE,O.POINTER_UP,O.POINTER_OVER,O.POINTER_LEAVE]}getDomElement(){return this.getShape("key").getDomElement()}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.drawKeyShape(t,e),this.drawPortShapes(t,e)}getKeyStyle(t){let e=(0,nz.Z)(t,["dx","dy","innerHTML","pointerEvents","cursor"]),{dx:n=0,dy:i=0}=e,r=nV(e,["dx","dy"]),[s,o]=this.getSize(t);return Object.assign(Object.assign({x:n,y:i},r),{width:s,height:o})}drawKeyShape(t,e){let n=this.getKeyStyle(t),{x:i,y:r,width:s=0,height:o=0}=n,a=this.upsert("key-container",j.UL,{x:i,y:r,width:s,height:o,opacity:0},e);return this.upsert("key",j.k9,n,a)}connectedCallback(){let t=this.context.canvas.getRenderer("main"),e=t instanceof n_.Th;if(!e)return;let n=this.getDomElement();this.events.forEach(t=>{n.addEventListener(t,this.forwardEvents)})}attributeChangedCallback(t,e,n){"zIndex"===t&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){let t=this.getDomElement();this.events.forEach(e=>{t.removeEventListener(e,this.forwardEvents)}),super.destroy()}normalizeToPointerEvent(t,e){let n=[];if(e.isTouchEvent(t))for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e];(0,nZ.Z)(i.button)&&(i.button=0),(0,nZ.Z)(i.buttons)&&(i.buttons=1),(0,nZ.Z)(i.isPrimary)&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),(0,nZ.Z)(i.width)&&(i.width=i.radiusX||1),(0,nZ.Z)(i.height)&&(i.height=i.radiusY||1),(0,nZ.Z)(i.tiltX)&&(i.tiltX=0),(0,nZ.Z)(i.tiltY)&&(i.tiltY=0),(0,nZ.Z)(i.pointerType)&&(i.pointerType="touch"),(0,nZ.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,nZ.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,nZ.Z)(i.twist)&&(i.twist=0),(0,nZ.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=t.type,n.push(i)}else e.isMouseEvent(t)&&((0,nZ.Z)(t.isPrimary)&&(t.isPrimary=!0),(0,nZ.Z)(t.width)&&(t.width=1),(0,nZ.Z)(t.height)&&(t.height=1),(0,nZ.Z)(t.tiltX)&&(t.tiltX=0),(0,nZ.Z)(t.tiltY)&&(t.tiltY=0),(0,nZ.Z)(t.pointerType)&&(t.pointerType="mouse"),(0,nZ.Z)(t.pointerId)&&(t.pointerId=1),(0,nZ.Z)(t.pressure)&&(t.pressure=.5),(0,nZ.Z)(t.twist)&&(t.twist=0),(0,nZ.Z)(t.tangentialPressure)&&(t.tangentialPressure=0),t.isNormalized=!0),n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,i){t.view=n,t.originalEvent=null,t.nativeEvent=i,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);let{x:r,y:s}=this.getViewportXY(e);t.viewport.x=r,t.viewport.y=s;let[o,a]=this.context.canvas.getCanvasByViewport([r,s]);return t.canvas.x=o,t.canvas.y=a,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=i.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t}getViewportXY(t){let e,n;let{offsetX:i,offsetY:r,clientX:s,clientY:o}=t;if((0,B.Z)(i)||(0,B.Z)(r)){let t=this.eventService.client2Viewport({x:s,y:o});e=t.x,n=t.y}else e=i,n=r;return{x:e,y:n}}onframe(){super.onframe();let{opacity:t}=this.attributes;this.getDomElement().style.opacity="".concat(t)}constructor(t){super(Object.assign(Object.assign({},t),{style:Object.assign({},nW.defaultStyleProps,t.style)})),this.rootPointerEvent=new j.nR(null),this.forwardEvents=t=>{let e=this.context.canvas,n=e.context.renderingContext.root.ownerDocument.defaultView,i=this.normalizeToPointerEvent(t,n);i.forEach(i=>{let r=this.bootstrapEvent(this.rootPointerEvent,i,n,t);(0,e1.Z)(e.context.eventService,"mappingTable.pointerupoutside",[]),e.context.eventService.mapEvent(r)})}}}nW.defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};var nH=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nG extends nA{getKeyStyle(t){let[e,n]=this.getSize(t),i=super.getKeyStyle(t),{fillOpacity:r,opacity:s=r}=i,o=nH(i,["fillOpacity","opacity"]);return Object.assign(Object.assign({opacity:s},o),{width:e,height:n,x:-e/2,y:-n/2})}getHaloStyle(t){if(!1===t.halo)return!1;let e=this.getShape("key").attributes,{fill:n,stroke:i}=e;nH(e,["fill","stroke"]);let r=e6(this.getGraphicStyle(t),"halo"),s=Number(r.lineWidth),[o,a]=eu(this.getSize(t),[s,s]);return Object.assign(Object.assign({},r),{width:o,height:a,fill:"transparent",x:-o/2,y:-a/2})}getIconStyle(t){let e=super.getIconStyle(t),[n,i]=this.getSize(t);return!!e&&Object.assign({width:.8*n,height:.8*i},e)}drawKeyShape(t,e){let n=this.upsert("key",nx,this.getKeyStyle(t),e);return nS(this),n}drawHaloShape(t,e){this.upsert("halo",j.UL,this.getHaloStyle(t),e)}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&nD(this)}constructor(t){super(nt({style:nG.defaultStyleProps},t))}}nG.defaultStyleProps={size:32};class nY extends nR{getPoints(t){let{direction:e}=t,[n,i]=this.getSize(t);return function(t,e,n){let i=e/2,r=t/2,s={up:[[-r,i],[r,i],[0,-i]],left:[[-r,0],[r,i],[r,-i]],right:[[-r,i],[-r,-i],[r,0]],down:[[-r,-i],[r,-i],[0,i]]};return s[n]||s.up}(n,i,e)}getPortXY(t,e){let{direction:n}=t,{placement:i="top"}=e,r=this.getShape("key").getLocalBounds(),[s,o]=this.getSize(t),a=function(t,e,n){let i=e/2,r=t/2,s={};return"down"===n?(s.bottom=s.default=[0,i],s.right=[r,-i],s.left=[-r,-i]):"left"===n?(s.top=[r,-i],s.bottom=[r,i],s.left=s.default=[-r,0]):"right"===n?(s.top=[-r,-i],s.bottom=[-r,i],s.right=s.default=[r,0]):(s.left=[-r,i],s.top=s.default=[0,-i],s.right=[r,i]),s}(s,o,n);return i_(r,i,a,!1)}getIconStyle(t){let{icon:e,iconText:n,iconSrc:i,direction:r}=t;if(!1===e||nd(n||i))return!1;let s=e6(this.getGraphicStyle(t),"icon"),o=this.getShape("key").getLocalBounds(),[a,l]=function(t,e){let{center:n}=t,[i,r]=tm(t),s="up"===e||"down"===e?n[0]:"right"===e?n[0]-i/6:n[0]+i/6,o="left"===e||"right"===e?n[1]:"down"===e?n[1]-r/6:n[1]+r/6;return[s,o]}(o,r),h=2*function(t,e){let[n,i]=tm(t);return[n,i]="up"===e||"down"===e?[n,i]:[i,n],(Math.pow(i,2)-Math.pow(Math.sqrt(Math.pow(n/2,2)+Math.pow(i,2))-n/2,2))/(2*i)}(o,r)*.8;return Object.assign({x:a,y:l,width:h,height:h},s)}constructor(t){super(nt({style:nY.defaultStyleProps},t))}}nY.defaultStyleProps={size:40,direction:"up"};var nU=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class nK extends nA{getKeySize(t){let{collapsed:e,childrenNode:n=[]}=t;return 0===n.length?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){let{padding:e,collapsedSize:n}=t,[i,r,s,o]=tg(e);return eu(e9(n),[o+r,i+s,0])}getCollapsedKeySize(t){return e9(t.collapsedSize)}getExpandedKeySize(t){let e=this.getContentBBox(t);return[tf(e),ty(e),0]}getContentBBox(t){let{childrenNode:e=[],padding:n}=t,i=e.map(t=>this.context.element.getElement(t)).filter(Boolean);if(0===i.length){let e=new j.mN,{x:n=0,y:i=0,size:r}=t,[s,o]=e9(r);return e.setMinMax([n-s/2,i-o/2,0],[n+s/2,i+o/2,0]),e}let r=tx(i.map(t=>t.getBounds()));return n?tE(r,n):r}drawCollapsedMarkerShape(t,e){let n=this.getCollapsedMarkerStyle(t);this.upsert("collapsed-marker",nC,n,e),nS(this)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;let e=e6(this.getGraphicStyle(t),"collapsedMarker"),{type:n}=e,i=nU(e,["type"]),r=this.getShape("key"),[s,o]=eL(r.getLocalBounds(),"center"),a=Object.assign(Object.assign({},i),{x:s,y:o});if(n){let e=this.getCollapsedMarkerText(n,t);Object.assign(a,{text:e})}return a}getCollapsedMarkerText(t,e){let{childrenData:n=[]}=e,{model:i}=this.context;return"descendant-count"===t?i.getDescendantsData(this.id).length.toString():"child-count"===t?n.length.toString():"node-count"===t?i.getDescendantsData(this.id).filter(t=>"node"===i.getElementType(t6(t))).length.toString():(0,to.Z)(t)?t(n):""}getComboPosition(t){let{x:e=0,y:n=0,collapsed:i,childrenData:r=[]}=t;if(0===r.length)return[+e,+n,0];if(i){let{model:t}=this.context,i=t.getDescendantsData(this.id).filter(e=>!t.isCombo(t6(e)));if(i.length>0&&i.some(eA)){let t=i.reduce((t,e)=>eu(t,eT(e)),[0,0,0]);return ef(t,i.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){let[e,n]=this.getComboPosition(t);return{x:e,y:n,transform:[["translate",e,n]]}}updateComboPosition(t){let e=this.getComboStyle(t);Object.assign(this.style,e);let{x:n,y:i}=e;this.context.model.syncNodeLikeDatum({id:this.id,style:{x:n,y:i}}),nD(this)}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawCollapsedMarkerShape(t,e)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.update(t),this.updateComboPosition(this.parsedAttributes)}onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(this.attributes.collapsed?t:t.map(t=>{var{x:e,y:n,z:i,transform:r}=t;return nU(t,["x","y","z","transform"])}),e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(nt({style:nK.defaultStyleProps},t)),this.type="combo",this.updateComboPosition(this.parsedAttributes)}}nK.defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"};var nX=n(69599);let n$={padding:10};function nq(t,e,n,i,r,s){let{padding:o}=Object.assign(n$,s),a=tv(n,o),l=tv(i,o),h=[t,...r,e],d=null,c=[];for(let t=0,e=h.length;t<e-1;t++){var u,p;let n=t+1,i=h[t],r=h[n],s=(u=i,p=r,u[1]===p[1]||u[0]===p[0]),g=null;if(0===t){if(n===e-1){if(a.intersects(l))g=n4(i,r,a,l);else if(tS(i,a)||tS(r,l))s||(g=function(t,e,n,i){let r=n3(t,e,n),s=ew(r.points[0]);if(tO(s,i)){r=n3(e,t,i);let o=ew(r.points[0]);if(tO(o,n)){let a=eN(t,s,n1(n,n0(t,s))/2),l=eN(e,o,n1(i,n0(e,o))/2),h=[(a[0]+l[0])/2,(a[1]+l[1])/2],d=n3(t,h,n),c=n6(h,e,i,d.direction);r.points=[d.points[0],c.points[0]],r.direction=c.direction}}return r}(i,r,a,l));else{let t=tC(i,a),e=tC(r,l);(g=n2(t,e,n0(t,e))).points.unshift(t),g.points.push(e)}}else tO(r,a)?g=n4(i,r,a,tv(r,o),d):s||(g=n3(i,r,a))}else n===e-1?tO(i,l)?g=n4(i,r,tv(i,o),l,d):s||(g=n6(i,r,l,d)):s||(g=n2(i,r,d));g?(c.push(...g.points),d=g.direction):d=n0(i,r),n<e-1&&c.push(r)}return c.map(eO)}let nJ={N:"S",S:"N",W:"E",E:"W"},nQ={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function n0(t,e){let[n,i]=t,[r,s]=e;return n===r?i>s?"N":"S":i===s?n>r?"W":"E":null}function n1(t,e){return"N"===e||"S"===e?ty(t):tf(t)}function n2(t,e,n){let i=[t[0],e[1]],r=[e[0],t[1]],s=n0(t,i),o=n0(t,r),a=n?nJ[n]:null,l=s===n||s!==a&&o!==n?i:r;return{points:[l],direction:n0(l,e)}}function n3(t,e,n){if(tS(t,n)){let i=n8(t,e,n);return{points:[i],direction:n0(i,e)}}{let i=tC(t,n),r=["left","right"].includes(tD(t,n)),s=r?[e[0],i[1]]:[i[0],e[1]];return{points:[s],direction:n0(s,e)}}}function n6(t,e,n,i){let r=tS(e,n)?e:tC(e,n),s=[[r[0],t[1]],[t[0],r[1]]],o=s.filter(t=>!tO(t,n)&&!tw(t,n,!0)),a=o.filter(e=>n0(e,t)!==i);if(a.length>0){let n=a.find(e=>n0(t,e)===i)||a[0];return{points:[n],direction:n0(n,e)}}{var l;let r=(void 0===(l=o)&&(l=[]),(0,nX.Z)(s,function(t){var e;return e=l,!((0,ns.Z)(e)&&e.indexOf(t)>-1)}))[0],a=eN(e,r,n1(n,i)/2),h=n8(a,t,n);return{points:[h,a],direction:n0(a,e)}}}function n4(t,e,n,i,r){let s;let o=tx([n,i]),a=em(e,o.center)>em(t,o.center),[l,h]=a?[e,t]:[t,e],d=ty(o)+tf(o);if(r){let t=[l[0]+d*Math.cos(nQ[r]),l[1]+d*Math.sin(nQ[r])];s=eN(tC(t,o),t,.01)}else s=eN(tC(l,o),l,-.01);let c=n8(s,h,o),u=[ek(s,2),ek(c,2)];if((0,F.Z)(ek(s),ek(c))){let t=eE(ep(s,l),[1,0,0])+Math.PI/2;c=ek(eN(tC(c=[h[0]+d*Math.cos(t),h[1]+d*Math.sin(t),0],o),h,-.01),2);let e=n8(s,c,o);u=[s,e,c]}return{points:a?u.reverse():u,direction:a?n0(s,e):n0(c,e)}}function n8(t,e,n){let i=[t[0],e[1]];return tO(i,n)&&(i=[e[0],t[1]]),i}function n9(t,e,n,i,r){let s="number"==typeof e?e:.5;"start"===e&&(s=0),"end"===e&&(s=.99);let o=eR(t.getPoint(s)),a=eR(t.getPoint(s+.01)),l="start"===e?"left":"end"===e?"right":"center";if(o[1]===a[1]||!n){let[e,n]=n5(t,s,i,r);return{transform:[["translate",e,n]],textAlign:l}}let h=Math.atan2(a[1]-o[1],a[0]-o[0]),d=a[0]<o[0];d&&(l="center"===l?l:"left"===l?"right":"left",i*=-1,h+=Math.PI);let[c,u]=n5(t,s,i,r,h),p=[["translate",c,u],["rotate",h/Math.PI*180]];return{textAlign:l,transform:p}}function n5(t,e,n,i,r){let[s,o]=eR(t.getPoint(e)),a=n,l=i;return r&&(a=n*Math.cos(r)-i*Math.sin(r),l=n*Math.sin(r)+i*Math.cos(r)),[s+a,o+l]}function n7(t,e,n,i){if((0,F.Z)(t,e))return t;let r=ep(e,t),s=[t[0]+n*r[0],t[1]+n*r[1]],o=eb(ex(r,!1));return s[0]+=i*o[0],s[1]+=i*o[1],s}function it(t,e,n){return[["M",t[0],t[1]],["C",n[0][0],n[0][1],n[1][0],n[1][1],e[0],e[1]]]}function ie(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0],r=t[t.length-1],s=t.slice(1,t.length-1),o=[["M",i[0],i[1]]];return s.forEach((t,n)=>{let a=s[n-1]||i,l=s[n+1]||r;if(!eD([a,t],[t,l])&&e){let[n,i]=function(t,e,n,i){let r=ev(t,e),s=ev(n,e),o=Math.min(i,Math.min(r,s)/2),a=[e[0]-o/r*(e[0]-t[0]),e[1]-o/r*(e[1]-t[1])],l=[e[0]-o/s*(e[0]-n[0]),e[1]-o/s*(e[1]-n[1])];return[a,l]}(a,t,l,e);o.push(["L",n[0],n[1]],["Q",t[0],t[1],i[0],i[1]],["L",i[0],i[1]])}else o.push(["L",t[0],t[1]])}),o.push(["L",r[0],r[1]]),n&&o.push(["Z"]),o}let ii=t=>{let e=Math.PI/2,n=ty(t)/2,i=tf(t)/2,r=Math.atan2(n,i)/2,s=Math.atan2(i,n)/2;return{top:[-e-s,-e+s],"top-right":[-e+s,-r],"right-top":[-e+s,-r],right:[-r,r],"bottom-right":[r,e-s],"right-bottom":[r,e-s],bottom:[e-s,e+s],"bottom-left":[e+s,Math.PI-r],"left-bottom":[e+s,Math.PI-r],left:[Math.PI-r,Math.PI+r],"top-left":[Math.PI+r,-e-s],"left-top":[Math.PI+r,-e-s]}};function ir(t,e,n,i,r){let s=tv(t),o=t.getCenter(),a=i&&iV(i),l=r&&iV(r);if(!a||!l){let i=ii(s),r=i[e][0],h=i[e][1],[d,c]=tm(s),u=Math.max(d,c),p=eu(o,[u*Math.cos(r),u*Math.sin(r),0]),g=eu(o,[u*Math.cos(h),u*Math.sin(h),0]);a=iY(t,p),l=iY(t,g),n||([a,l]=[l,a])}return[a,l]}function is(t,e){let n=new Set,i=new Set,r=new Set;return t.forEach(s=>{let o=e(s);o.forEach(e=>{n.add(e),t.includes(e.source)&&t.includes(e.target)?i.add(e):r.add(e)})}),{edges:Array.from(n),internal:Array.from(i),external:Array.from(r)}}function io(t,e){let n=[],i=t;for(;i;){n.push(i);let t=e(t6(i));if(t)i=t;else break}if(n.some(t=>{var e;return null===(e=t.style)||void 0===e?void 0:e.collapsed})){let t=n.reverse().findIndex(eQ);return n[t]||n.at(-1)}return t}let ia=(t,e)=>{let n=Math.max(t,e)/2;return[["M",-t/2,0],["A",n,n,0,1,0,2*n-t/2,0],["A",n,n,0,1,0,-t/2,0],["Z"]]},il=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",t/2,e/2],["Z"]],ih=(t,e)=>[["M",-t/2,0],["L",0,-e/2],["L",t/2,0],["L",0,e/2],["Z"]],id=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",4*t/5-t/2,0],["L",t/2,e/2],["Z"]],ic=(t,e)=>[["M",-t/2,-e/2],["L",t/2,-e/2],["L",t/2,e/2],["L",-t/2,e/2],["Z"]],iu=(t,e)=>{let n=t/2,i=t/7,r=t-i;return[["M",-n,0],["L",0,-e/2],["L",0,e/2],["Z"],["M",r-n,-e/2],["L",r+i-n,-e/2],["L",r+i-n,e/2],["L",r-n,e/2],["Z"]]},ip=(t,e)=>[["M",t/2,-e/2],["L",-t/2,0],["L",t/2,0],["L",-t/2,0],["L",t/2,e/2]];var ig=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class iy extends nM{get sourceNode(){let{sourceNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}get targetNode(){let{targetNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}getKeyStyle(t){let e=this.getGraphicStyle(t),{loop:n}=e,i=ig(e,["loop"]),{sourceNode:r,targetNode:s}=this,o=n&&r&&s&&r===s?this.getLoopPath(t):this.getKeyPath(t),a={d:o};return j.y$.PARSED_STYLE_LIST.forEach(t=>{t in i&&(a[t]=i[t])}),a}getLoopPath(t){let{sourcePort:e,targetPort:n}=t,i=this.sourceNode,r=tv(i),s=Math.max(tf(r),ty(r)),{placement:o,clockwise:a,dist:l=s}=e6(this.getGraphicStyle(t),"loop");return function(t,e,n,i,r,s){let o=t.getPorts()[r||s],a=t.getPorts()[s||r],[l,h]=ir(t,e,n,o,a),d=function(t,e,n,i){let r=t.getCenter();if((0,F.Z)(e,n)){let t=ep(e,r),s=[i*Math.sign(t[0])||i/2,i*Math.sign(t[1])||-i/2,0];return[eu(e,s),eu(n,eg(s,[1,-1,1]))]}return[eN(r,e,em(r,e)+i),eN(r,n,em(r,n)+i)]}(t,l,h,i);return o&&(l=iG(o,d[0])),a&&(h=iG(a,d[d.length-1])),it(l,h,d)}(i,o,a,l,e,n)}getEndpoints(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{sourcePort:i,targetPort:r}=t,{sourceNode:s,targetNode:o}=this,[a,l]=function(t,e,n,i){let r=iW(t,e,n,i),s=iW(e,t,i,n);return[r,s]}(s,o,i,r);if(!e){let t=a?iV(a):s.getCenter(),e=l?iV(l):o.getCenter();return[t,e]}let h="function"==typeof n?n():n,d=iH(a||s,h[0]||l||o),c=iH(l||o,h[h.length-1]||a||s);return[d,c]}getHaloStyle(t){if(!1===t.halo)return!1;let e=this.getKeyStyle(t),n=e6(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign({},e),n)}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let e=e6(this.getGraphicStyle(t),"label"),{placement:n,offsetX:i,offsetY:r,autoRotate:s,maxWidth:o}=e,a=ig(e,["placement","offsetX","offsetY","autoRotate","maxWidth"]),l=n9(this.shapeMap.key,n,s,i,r),h=this.shapeMap.key.getLocalBounds(),d=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=em(t[0],t[1])*n;return ni(i,e)}([h.min,h.max],o);return Object.assign({wordWrapWidth:d},l,a)}getBadgeStyle(t){if(!1===t.badge||!t.badgeText)return!1;let e=e6(t,"badge"),{offsetX:n,offsetY:i,placement:r}=e,s=ig(e,["offsetX","offsetY","placement"]);return Object.assign(s,function(t,e,n,i,r){var s,o;let a=(null===(s=t.badge)||void 0===s?void 0:s.getGeometryBounds().halfExtents[0])*2||0,l=(null===(o=t.label)||void 0===o?void 0:o.getGeometryBounds().halfExtents[0])*2||0;return n9(t.key,n,!0,(l?(l/2+a/2)*("suffix"===e?1:-1):0)+i,r)}(this.shapeMap,r,t.labelPlacement,n,i))}drawArrow(t,e){var n;let i="start"===e,r=t["start"===e?"startArrow":"endArrow"],s=this.shapeMap.key;if(r){let e=this.getArrowStyle(t,i),[n,r,o]=i?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],a=s.parsedStyle[n];if(a)a.attr(e);else{let t=e.src?j.Ee:j.y$,i=new t({style:e});s.style[n]=i}s.style[r]=t[o]||e.width/2+ +e.lineWidth}else{let t=i?"markerStart":"markerEnd";null===(n=s.style[t])||void 0===n||n.destroy(),s.style[t]=null}}getArrowStyle(t,e){var n;let i=this.getShape("key").attributes,r=e6(this.getGraphicStyle(t),e?"startArrow":"endArrow"),{size:s,type:o}=r,a=ig(r,["size","type"]),[l,h]=e9((n=i.lineWidth,s||(n<4?10:4===n?12:2.5*n))),d=(0,to.Z)(o)?o:N[o]||il,c=d(l,h);return Object.assign((0,nz.Z)(i,["stroke","strokeOpacity","fillOpacity"]),{width:l,height:h},Object.assign({},c&&{d:c,fill:"simple"===o?"":i.stroke}),a)}drawLabelShape(t,e){let n=this.getLabelStyle(t);this.upsert("label",nf,n,e)}drawHaloShape(t,e){let n=this.getHaloStyle(t);this.upsert("halo",j.y$,n,e)}drawBadgeShape(t,e){let n=this.getBadgeStyle(t);this.upsert("badge",ny,n,e)}drawSourceArrow(t){this.drawArrow(t,"start")}drawTargetArrow(t){this.drawArrow(t,"end")}drawKeyShape(t,e){let n=this.getKeyStyle(t);return this.upsert("key",j.y$,n,e)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.drawKeyShape(t,e),this.getShape("key")&&(this.drawSourceArrow(t),this.drawTargetArrow(t),this.drawLabelShape(t,e),this.drawHaloShape(t,e),this.drawBadgeShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawSourceArrow(this.parsedAttributes),this.drawTargetArrow(this.parsedAttributes),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this),this.drawBadgeShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(t,e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(nt({style:iy.defaultStyleProps},t)),this.type="edge"}}iy.defaultStyleProps={badge:!0,badgeOffsetX:0,badgeOffsetY:0,badgePlacement:"suffix",isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowLineDash:0,startArrowLineJoin:"round",startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"vee",endArrow:!1,endArrowLineDash:0,endArrowLineJoin:"round",endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"vee",loopPlacement:"top",loopClockwise:!0};class im extends iy{getKeyPath(t){let[e,n]=this.getEndpoints(t),{controlPoints:i,curvePosition:r,curveOffset:s}=t,o=this.getControlPoints(e,n,(0,Q.Z)(r)?[r,1-r]:r,(0,Q.Z)(s)?[s,-s]:s,i);return it(e,n,o)}getControlPoints(t,e,n,i,r){return(null==r?void 0:r.length)===2?r:[n7(t,e,n[0],i[0]),n7(t,e,n[1],i[1])]}constructor(t){super(nt({style:im.defaultStyleProps},t))}}im.defaultStyleProps={curvePosition:.5,curveOffset:20};class iv extends im{getControlPoints(t,e,n,i){let r=e[0]-t[0];return[[t[0]+r*n[0]+i[0],t[1]],[e[0]-r*n[1]+i[1],e[1]]]}constructor(t){super(nt({style:iv.defaultStyleProps},t))}}iv.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class ib extends im{get ref(){return this.context.model.getRootsData()[0]}getEndpoints(t){if(this.sourceNode.id===this.ref.id)return super.getEndpoints(t);let e=eT(this.ref),n=this.sourceNode.getIntersectPoint(e,!0),i=this.targetNode.getIntersectPoint(e);return[n,i]}toRadialCoordinate(t){let e=eT(this.ref),n=em(t,e),i=eS(ep(t,e));return[n,i]}getControlPoints(t,e,n,i){let[r,s]=this.toRadialCoordinate(t),[o]=this.toRadialCoordinate(e),a=o-r;return[[t[0]+(a*n[0]+i[0])*Math.cos(s),t[1]+(a*n[0]+i[0])*Math.sin(s)],[e[0]-(a*n[1]-i[0])*Math.cos(s),e[1]-(a*n[1]-i[0])*Math.sin(s)]]}constructor(t){super(nt({style:ib.defaultStyleProps},t))}}ib.defaultStyleProps={curvePosition:.5,curveOffset:20};class iE extends im{getControlPoints(t,e,n,i){let r=e[1]-t[1];return[[t[0],t[1]+r*n[0]+i[0]],[e[0],e[1]-r*n[1]+i[1]]]}constructor(t){super(nt({style:iE.defaultStyleProps},t))}}iE.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class ix extends iy{getKeyPath(t){let[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}constructor(t){super(nt({style:ix.defaultStyleProps},t))}}ix.defaultStyleProps={};let iO={enableObstacleAvoidance:!1,offset:10,maxAllowedDirectionChange:Math.PI/2,maximumLoops:3e3,gridSize:5,startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{right:{stepX:1,stepY:0},left:{stepX:-1,stepY:0},bottom:{stepX:0,stepY:1},top:{stepX:0,stepY:-1}},penalties:{0:0,90:0},distFunc:ev},iw=t=>"".concat(Math.round(t[0]),"|||").concat(Math.round(t[1]));function iS(t,e){let n=t=>Math.round(t/e);return(0,Q.Z)(t)?n(t):t.map(n)}function iD(t,e){let n=e[0]-t[0],i=e[1]-t[1];return n||i?Math.atan2(i,n):0}function iC(t,e,n,i){let r=iD(t,e),s=n[iw(t)],o=iD(s||i,t);return function(t,e){let n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n}(o,r)}let iM=(t,e)=>{let{offset:n,gridSize:i}=e,r={};return t.forEach(t=>{if(!t||t.destroyed||!t.isVisible())return;let e=tE(t.getRenderBounds(),n);for(let t=iS(e.min[0],i);t<=iS(e.max[0],i);t+=1)for(let n=iS(e.min[1],i);n<=iS(e.max[1],i);n+=1)r["".concat(t,"|||").concat(n)]=!0}),r};function iT(t,e,n){return Math.min(...e.map(e=>n(t,e)))}let iA=(t,e,n,i)=>{if(!e)return[t];let{directionMap:r,offset:s}=i,o=tE(e.getRenderBounds(),s),a=Object.keys(r).reduce((e,i)=>{if(n.includes(i)){let n=r[i],[s,a]=tm(o),l=[t[0]+n.stepX*s,t[1]+n.stepY*a],h=function(t){let{min:[e,n],max:[i,r]}=t,s=[e,r],o=[i,r],a=[i,n],l=[e,n];return[[s,o],[o,a],[a,l],[l,s]]}(o);for(let n=0;n<h.length;n++){let i=eC([t,l],h[n]);i&&tw(i,o)&&e.push(i)}}return e},[]);return tO(t,o)||a.push(t),a.map(t=>iS(t,i.gridSize))},iL=(t,e,n,i,r,s,o)=>{let a=[],l=[s[0]===i[0]?i[0]:t[0]*o,s[1]===i[1]?i[1]:t[1]*o];a.unshift(l);let h=t,d=e[iw(h)];for(;d;){let t=d,i=h,r=iC(t,i,e,n);r&&(l=[t[0]===i[0]?l[0]:t[0]*o,t[1]===i[1]?l[1]:t[1]*o],a.unshift(l)),d=e[iw(t)],h=t}let c=r.map(t=>[t[0]*o,t[1]*o]),u=function(t,e,n){let i=t[0],r=n(t[0],e);for(let s=0;s<t.length;s++){let o=t[s],a=n(o,e);a<r&&(i=o,r=a)}return i}(c,l,ev);return a.unshift(u),a};class iR{_innerAdd(t,e){let n=0,i=e-1;for(;i-n>1;){let e=Math.floor((n+i)/2);if(this.arr[e].value>t.value)i=e;else if(this.arr[e].value<t.value)n=e;else{this.arr.splice(e,0,t),this.map[t.id]=!0;return}}this.arr.splice(i,0,t),this.map[t.id]=!0}add(t){delete this.map[t.id];let e=this.arr.length;if(!e||this.arr[e-1].value<t.value){this.arr.push(t),this.map[t.id]=!0;return}this._innerAdd(t,e)}remove(t){this.map[t]&&delete this.map[t]}_clearAndGetMinId(){let t;for(let e=this.arr.length-1;e>=0;e--)this.map[this.arr[e].id]?t=this.arr[e].id:this.arr.splice(e,1);return t}_findFirstId(){for(;this.arr.length;){let t=this.arr.shift();if(this.map[t.id])return t.id}}minId(t){return t?this._clearAndGetMinId():this._findFirstId()}constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}}class iP extends iy{getControlPoints(t){let{router:e}=t,{sourceNode:n,targetNode:i}=this,[r,s]=this.getEndpoints(t,!1),o=[];if(e){if("shortest-path"===e.type){let a=this.context.element.getNodes();(o=function(t,e,n,i){let r;let s=eO(t.getCenter()),o=eO(e.getCenter()),a=Object.assign(iO,i),{gridSize:l}=a,h=a.enableObstacleAvoidance?n:[t,e],d=iM(h,a),c=iS(s,l),u=iS(o,l),p=iA(s,t,a.startDirections,a),g=iA(o,e,a.endDirections,a);p.forEach(t=>delete d[iw(t)]),g.forEach(t=>delete d[iw(t)]);let f={},y={},m={},v={},b={},E=new iR;for(let t=0;t<p.length;t++){let e=p[t],n=iw(e);f[n]=e,v[n]=0,b[n]=iT(e,g,a.distFunc),E.add({id:n,value:b[n]})}let x=g.map(t=>iw(t)),O=a.maximumLoops,w=1/0;for(let[t,e]of Object.entries(f))b[t]<=w&&(w=b[t],r=e);for(;Object.keys(f).length>0&&O>0;){let t=E.minId(!1);if(t)r=f[t];else break;let e=iw(r);if(x.includes(e))return iL(r,m,c,o,p,u,l);for(let t of(delete f[e],E.remove(e),y[e]=!0,Object.values(a.directionMap))){let n=eu(r,[t.stepX,t.stepY]),i=iw(n);if(y[i])continue;let s=iC(r,n,m,c);if(s>a.maxAllowedDirectionChange||d[i])continue;f[i]||(f[i]=n);let o=a.penalties[s],h=a.distFunc(r,n)+(isNaN(o)?l:o),u=v[e]+h,p=v[i];p&&u>=p||(m[i]=r,v[i]=u,b[i]=u+iT(n,g,a.distFunc),E.add({id:i,value:b[i]}))}O-=1}return[]}(n,i,a,e)).length||(o=nq(r,s,n,i,t.controlPoints,{padding:e.offset}))}else"orth"===e.type&&(o=nq(r,s,n,i,t.controlPoints,e))}else o=t.controlPoints;return o}getPoints(t){let e=this.getControlPoints(t),[n,i]=this.getEndpoints(t,!0,e);return[n,...e,i]}getKeyPath(t){let e=this.getPoints(t);return ie(e,t.radius)}getLoopPath(t){let{sourcePort:e,targetPort:n,radius:i}=t,r=this.sourceNode,s=tv(r),o=Math.max(tf(s),ty(s))/4,{placement:a,clockwise:l,dist:h=o}=e6(this.getGraphicStyle(t),"loop");return function(t,e,n,i,r,s,o){let a=iz(t),l=a[s||o],h=a[o||s],[d,c]=ir(t,n,i,l,h),u=function(t,e,n,i){let r=[],s=tv(t);if((0,F.Z)(e,n)){let t=tD(e,s);switch(t){case"left":r.push([e[0]-i,e[1]]),r.push([e[0]-i,e[1]+i]),r.push([e[0],e[1]+i]);break;case"right":r.push([e[0]+i,e[1]]),r.push([e[0]+i,e[1]+i]),r.push([e[0],e[1]+i]);break;case"top":r.push([e[0],e[1]-i]),r.push([e[0]+i,e[1]-i]),r.push([e[0]+i,e[1]]);break;case"bottom":r.push([e[0],e[1]+i]),r.push([e[0]+i,e[1]+i]),r.push([e[0]+i,e[1]])}}else{let t=tD(e,s),o=tD(n,s);if(t===o){let s,o;switch(t){case"left":s=Math.min(e[0],n[0])-i,r.push([s,e[1]]),r.push([s,n[1]]);break;case"right":s=Math.max(e[0],n[0])+i,r.push([s,e[1]]),r.push([s,n[1]]);break;case"top":o=Math.min(e[1],n[1])-i,r.push([e[0],o]),r.push([n[0],o]);break;case"bottom":o=Math.max(e[1],n[1])+i,r.push([e[0],o]),r.push([n[0],o])}}else{let a=(t,e)=>({left:[e[0]-i,e[1]],right:[e[0]+i,e[1]],top:[e[0],e[1]-i],bottom:[e[0],e[1]+i]})[t],l=a(t,e),h=a(o,n),d=n8(l,h,s);r.push(l,d,h)}}return r}(t,d,c,r);return l&&(d=iG(l,u[0])),h&&(c=iG(h,u[u.length-1])),ie([d,...u,c],e)}(r,i,a,l,h,e,n)}constructor(t){super(nt({style:iP.defaultStyleProps},t))}}iP.defaultStyleProps={radius:0,controlPoints:[],router:!1};class ik extends iy{getKeyPath(t){let{curvePosition:e,curveOffset:n}=t,[i,r]=this.getEndpoints(t),s=t.controlPoint||n7(i,r,e,n);return[["M",i[0],i[1]],["Q",s[0],s[1],r[0],r[1]]]}constructor(t){super(nt({style:ik.defaultStyleProps},t))}}ik.defaultStyleProps={curvePosition:.5,curveOffset:30};var iN=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function ij(t){return t instanceof nA&&"node"===t.type}function iI(t){return t instanceof iy}function iB(t){return t instanceof nK}let iF={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],default:[.5,.5]};function i_(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:iF,i=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=[.5,.5],s=(0,eZ.Z)(e)?(0,e0.Z)(n,e.toLocaleLowerCase(),r):e;if(!i&&(0,eZ.Z)(e))return s;let[o,a]=s||r;return[t.min[0]+tf(t)*o,t.min[1]+ty(t)*a]}function iz(t){if(!t)return{};let e=t.getPorts(),n=t.attributes.ports||[];return n.forEach((n,i)=>{var r;let{key:s,placement:o}=n;iZ(n)&&(e[r=s||i]||(e[r]=eL(t.getShape("key").getBounds(),o)))}),e}function iZ(t){let{r:e}=t;return!e||0===Number(e)}function iV(t){return tu(t)?t:t.getPosition()}function iW(t,e,n,i){let r,s;let o=iz(t);if(n)return o[n];let a=Object.values(o);if(0===a.length)return;let l=a.map(t=>iV(t)),h=function(t,e){let n=iz(t);if(e)return[iV(n[e])];let i=Object.values(n);return i.length>0?i.map(t=>iV(t)):[t.getCenter()]}(e,i),[d]=(r=1/0,s=[l[0],h[0]],l.forEach(t=>{h.forEach(e=>{let n=em(t,e);n<r&&(r=n,s=[t,e])})}),s);return a.find(t=>iV(t)===d)}function iH(t,e){return iB(t)||ij(t)?iY(t,e):iG(t,e)}function iG(t,e){if(!t||!e)return[0,0,0];if(tu(t))return t;if(t.attributes.linkToCenter)return t.getPosition();let n=tu(e)?e:ij(e)?e.getCenter():e.getPosition();return eB(n,t.getBounds())}function iY(t,e){if(!t||!e)return[0,0,0];let n=tu(e)?e:ij(e)?e.getCenter():e.getPosition();return t.getIntersectPoint(n)||t.getCenter()}function iU(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=e.split("-"),[o,a]=eL(t,e),l=s.includes("left")?"right":s.includes("right")?"left":"center",h=s.includes("top")?"bottom":s.includes("bottom")?"top":"middle";return r&&(h="top"===h?"bottom":"bottom"===h?"top":h),{transform:[["translate",o+n,a+i]],textBaseline:h,textAlign:l}}function iK(t,e){"update"in t?t.update(e):t.attr(e)}function iX(t){return(0,e0.Z)(t,"__to_be_destroyed__",!1)}class i$ extends el{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("node:".concat(e),this.onCollapseExpand),t.on("combo:".concat(e),this.onCollapseExpand)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("node:".concat(e),this.onCollapseExpand),t.off("combo:".concat(e),this.onCollapseExpand)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},i$.defaultOptions,e)),this.onCollapseExpand=t=>{var e,n,i,r;return e=this,n=void 0,i=void 0,r=function*(){if(!this.validate(t))return;let{target:e}=t;if(!(ij(e)||iI(e)||iB(e)))return;let n=e.id,{model:i,graph:r}=this.context,s=i.getElementDataById(n);if(!s)return!1;let{onCollapse:o,onExpand:a,animation:l,align:h}=this.options;eQ(s)?(yield r.expandElement(n,{animation:l,align:h}),null==a||a(n)):(yield r.collapseElement(n,{animation:l,align:h}),null==o||o(n))},new(i||(i=Promise))(function(t,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(t){t(n)})).then(o,a)}l((r=r.apply(e,n||[])).next())})},this.bindEvents()}}i$.defaultOptions={enable:!0,animation:!0,trigger:O.DBLCLICK,align:!0};var iq={},iJ=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};let iQ="g6-create-edge-assist-node-id";class i0 extends el{update(t){super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),"click"===e?(t.on(M.CLICK,this.handleCreateEdge),t.on(x.CLICK,this.handleCreateEdge),t.on(E.CLICK,this.cancelEdge),t.on(S.CLICK,this.cancelEdge)):(t.on(M.DRAG_START,this.handleCreateEdge),t.on(x.DRAG_START,this.handleCreateEdge),t.on(O.POINTER_UP,this.drop)),t.on(O.POINTER_MOVE,this.updateAssistEdge)}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;t.off(M.CLICK,this.handleCreateEdge),t.off(x.CLICK,this.handleCreateEdge),t.off(E.CLICK,this.cancelEdge),t.off(S.CLICK,this.cancelEdge),t.off(M.DRAG_START,this.handleCreateEdge),t.off(x.DRAG_START,this.handleCreateEdge),t.off(O.POINTER_UP,this.drop),t.off(O.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},i0.defaultOptions,e)),this.drop=t=>iJ(this,void 0,void 0,function*(){let{targetType:e}=t;["combo","node"].includes(e)&&this.source?yield this.handleCreateEdge(t):yield this.cancelEdge()}),this.handleCreateEdge=t=>iJ(this,void 0,void 0,function*(){var e,n,i;if(!this.validate(t))return;let{graph:r,canvas:s,batch:o,element:a}=this.context,{style:l}=this.options;if(this.source){this.createEdge(t),yield this.cancelEdge();return}o.startBatch(),s.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([t.target.id])[0];let h=r.getElementData(this.source);r.addNodeData([{id:iQ,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}],x:null===(e=h.style)||void 0===e?void 0:e.x,y:null===(n=h.style)||void 0===n?void 0:n.y}}]),r.addEdgeData([{id:"g6-create-edge-assist-edge-id",source:this.source,target:iQ,style:Object.assign({pointerEvents:"none"},l)}]),yield null===(i=a.draw({animation:!1}))||void 0===i?void 0:i.finished}),this.updateAssistEdge=t=>iJ(this,void 0,void 0,function*(){var e;if(!this.source)return;let{model:n,element:i}=this.context;n.translateNodeTo(iQ,[t.canvas.x,t.canvas.y]),yield null===(e=i.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished}),this.createEdge=t=>{var e,n,i;let{graph:r}=this.context,{style:s,onFinish:o,onCreate:a}=this.options,l=null===(e=t.target)||void 0===e?void 0:e.id;if(void 0===l||void 0===this.source)return;let h=null===(n=this.getSelectedNodeIDs([t.target.id]))||void 0===n?void 0:n[0],d="".concat(this.source,"-").concat(h,"-").concat((iq[i=i||"g"]?iq[i]+=1:iq[i]=1,i+iq[i])),c=a({id:d,source:this.source,target:h,style:s});r.addEdgeData([c]),o(c)},this.cancelEdge=()=>iJ(this,void 0,void 0,function*(){var t;if(!this.source)return;let{graph:e,element:n,batch:i}=this.context;e.removeNodeData([iQ]),this.source=void 0,yield null===(t=n.draw({animation:!1}))||void 0===t?void 0:t.finished,i.endBatch()}),this.bindEvents()}}i0.defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:t=>t,onFinish:()=>{}};var i1=n(29807),i2=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class i3 extends el{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{trigger:t}=this.options;if((0,_.Z)(t)){let{up:e=[],down:n=[],left:i=[],right:r=[]}=t;this.shortcut.bind(e,t=>this.onTranslate([0,1],t)),this.shortcut.bind(n,t=>this.onTranslate([0,-1],t)),this.shortcut.bind(i,t=>this.onTranslate([1,0],t)),this.shortcut.bind(r,t=>this.onTranslate([-1,0],t))}else{let{graph:t}=this.context;t.on(O.DRAG_START,this.onDragStart),t.on(O.DRAG,this.onDrag),t.on(O.DRAG_END,this.onDragEnd)}}onTranslate(t,e){return i2(this,void 0,void 0,function*(){if(!this.validate(e))return;let{sensitivity:n}=this.options;yield this.translate(eg(t,-1*n),this.options.animation),this.invokeOnFinish()})}translate(t,e){return i2(this,void 0,void 0,function*(){t=this.clampByDirection(t),t=this.clampByRange(t),yield this.context.graph.translateBy(t,e)})}clampByDirection(t){let[e,n]=t,{direction:i}=this.options;return"x"===i?n=0:"y"===i&&(e=0),[e,n]}clampByRange(t){let[e,n]=t,{viewport:i,canvas:r}=this.context,[s,o]=r.getSize(),[a,l,h,d]=tg(this.options.range),c=tE(tb(i.getCanvasCenter()),[o*a,s*l,o*h,s*d]),u=ep(i.getViewportCenter(),[e,n,0]);if(!tO(u,c)){let{min:[t,i],max:[r,s]}=c;(u[0]<t&&e>0||u[0]>r&&e<0)&&(e=0),(u[1]<i&&n>0||u[1]>s&&n<0)&&(n=0)}return[e,n]}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return"function"==typeof e?e(t):!!e}unbindEvents(){this.shortcut.unbindAll();let{graph:t}=this.context;t.off(O.DRAG_START,this.onDragStart),t.off(O.DRAG,this.onDrag),t.off(O.DRAG_END,this.onDragEnd)}destroy(){this.shortcut.destroy(),this.unbindEvents(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}constructor(t,e){super(t,Object.assign({},i3.defaultOptions,e)),this.isDragging=!1,this.onDragStart=t=>{this.validate(t)&&(this.isDragging=!0,this.context.canvas.setCursor("grabbing"))},this.onDrag=t=>{if(!this.isDragging)return;let{x:e,y:n}=t.movement;(e|n)!=0&&this.translate([e,n],!1)},this.onDragEnd=()=>{var t,e;this.isDragging=!1,this.context.canvas.setCursor(this.defaultCursor),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},this.invokeOnFinish=(0,i1.Z)(()=>{var t,e;null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},300),this.shortcut=new eW(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default"}}i3.defaultOptions={enable:t=>!("targetType"in t)||"canvas"===t.targetType,sensitivity:10,direction:"both",range:1/0};var i6=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class i4 extends el{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.addEventListener("blur",this.onDragEnd),n.addEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach(e=>{t.on("".concat(e,":").concat(O.DRAG_START),this.onDragStart),t.on("".concat(e,":").concat(O.DRAG),this.onDrag),t.on("".concat(e,":").concat(O.DRAG_END),this.onDragEnd),t.on("".concat(e,":").concat(O.POINTER_ENTER),this.setCursor),t.on("".concat(e,":").concat(O.POINTER_LEAVE),this.setCursor)}),["link"].includes(this.options.dropEffect)&&(t.on(x.DROP,this.onDrop),t.on(E.DROP,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}getDelta(t){let e=this.context.graph.getZoom();return ef([t.dx,t.dy],e)}onDragStart(t){var e;if(this.enable=this.validate(t),!this.enable)return;let{batch:n,canvas:i,graph:r}=this.context;i.setCursor((null===(e=this.options.cursor)||void 0===e?void 0:e.grabbing)||"grabbing"),this.isDragging=!0,n.startBatch();let s=t.target.id,o=r.getElementState(s);o.includes(this.options.state)?this.target=this.getSelectedNodeIDs([s]):this.target=[s],this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target)}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){var t,e,n;if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";let{x:t=0,y:e=0}=this.shadow.attributes,[n,i]=ep([+t,+e],this.shadowOrigin);this.moveElement(this.target,[n,i])}this.showEdges(),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t,this.target);let{batch:i,canvas:r}=this.context;i.endBatch(),r.setCursor((null===(n=this.options.cursor)||void 0===n?void 0:n.grab)||"grab"),this.isDragging=!1,this.target=[]}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}moveElement(t,e){return i6(this,void 0,void 0,function*(){let{graph:n,model:i}=this.context,{dropEffect:r}=this.options;"move"===r&&t.forEach(t=>i.refreshComboData(t)),n.translateElementBy(Object.fromEntries(t.map(t=>[t,e])),!1)})}moveShadow(t){if(!this.shadow)return;let{x:e=0,y:n=0}=this.shadow.attributes,[i,r]=t;this.shadow.attr({x:+e+i,y:+n+r})}createShadow(t){let e=e6(this.options,"shadow"),n=tx(t.map(t=>this.context.element.getElement(t).getBounds())),[i,r]=n.min;this.shadowOrigin=[i,r];let[s,o]=tm(n),a={width:s,height:o,x:i,y:r};this.shadow?this.shadow.attr(Object.assign(Object.assign(Object.assign({},e),a),{visibility:"visible"})):(this.shadow=new j.UL({style:Object.assign(Object.assign(Object.assign({$layer:"transient"},e),a),{pointerEvents:"none"})}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||0===this.hiddenEdges.length||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){let{hideEdge:t,shadow:e}=this.options;if("none"===t||e)return;let{graph:n}=this.context;"all"===t?this.hiddenEdges=n.getEdgeData().map(t6):this.hiddenEdges=Array.from(new Set(this.target.map(e=>n.getRelatedEdgesData(e,t).map(t6)).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){let{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.removeEventListener("blur",this.onDragEnd),n.removeEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach(e=>{t.off("".concat(e,":").concat(O.DRAG_START),this.onDragStart),t.off("".concat(e,":").concat(O.DRAG),this.onDrag),t.off("".concat(e,":").concat(O.DRAG_END),this.onDragEnd),t.off("".concat(e,":").concat(O.POINTER_ENTER),this.setCursor),t.off("".concat(e,":").concat(O.POINTER_LEAVE),this.setCursor)}),t.off("combo:".concat(O.DROP),this.onDrop),t.off("canvas:".concat(O.DROP),this.onDrop)}destroy(){var t;this.unbindEvents(),null===(t=this.shadow)||void 0===t||t.destroy(),super.destroy()}constructor(t,e){super(t,Object.assign({},i4.defaultOptions,e)),this.enable=!1,this.enableElements=["node","combo"],this.target=[],this.shadowOrigin=[0,0],this.hiddenEdges=[],this.isDragging=!1,this.onDrop=t=>i6(this,void 0,void 0,function*(){var e;if("link"!==this.options.dropEffect)return;let{model:n,element:i}=this.context,r=t.target.id;this.target.forEach(t=>{let e=n.getParentData(t,V);e&&t6(e)===r&&n.refreshComboData(r),n.setParent(t,r,V)}),yield null===(e=null==i?void 0:i.draw({animation:!0}))||void 0===e?void 0:e.finished}),this.setCursor=t=>{if(this.isDragging)return;let{type:e}=t,{canvas:n}=this.context,{cursor:i}=this.options;e===O.POINTER_ENTER?n.setCursor((null==i?void 0:i.grab)||"grab"):n.setCursor((null==i?void 0:i.default)||"default")},this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}}i4.defaultOptions={animation:!0,enable:t=>["node","combo"].includes(t.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5],cursor:{default:"default",grab:"grab",grabbing:"grabbing"}};var i8=n(5893);class i9{constructor(t,e){this.context=t,this.options=e||{}}}var i5=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function i7(t){let{nodes:e,edges:n}=t,i={nodes:[],edges:[],combos:[]};return e.forEach(t=>{let e=t.data._isCombo?i.combos:i.nodes,{x:n,y:r,z:s=0}=t.data;null==e||e.push({id:t.id,style:{x:n,y:r,z:s}})}),n.forEach(t=>{let{id:e,source:n,target:r,data:{points:s=[],controlPoints:o=s.slice(1,s.length-1)}}=t;i.edges.push({id:e,source:n,target:r,style:Object.assign({},(null==o?void 0:o.length)?{controlPoints:o.map(eR)}:{})})}),i}function rt(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if(e in t)return t[e](...i);if("instance"in t){let n=t.instance;if(e in n)return n[e](...i)}return null}function re(t,e){if(e in t)return t[e];if("instance"in t){let n=t.instance;if(e in n)return n[e]}return null}var rn=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class ri extends el{restoreCachedStyles(){if(this.cachedStyles.size>0){this.cachedStyles.forEach(t=>{t.forEach(t=>{let{shape:e,style:n}=t;if(nd(n))e.setLocalScale(1);else{if(this.options.state)return;Object.entries(n).forEach(t=>{let[n,i]=t;return e.style[n]=i})}})});let{graph:t,element:e}=this.context,n=Object.keys(Object.fromEntries(this.cachedStyles)).filter(e=>e&&"node"===t.getElementType(e));if(n.length>0){let i=new Set;n.forEach(e=>{t.getRelatedEdgesData(e).forEach(t=>i.add(t6(t)))}),i.forEach(t=>{let n=null==e?void 0:e.getElement(t);null==n||n.update({})})}}}bindEvents(){let{graph:t}=this.context;t.on(D.AFTER_DRAW,this.resetTransform),t.on(D.AFTER_TRANSFORM,this.fixElementSize)}unbindEvents(){let{graph:t}=this.context;t.off(D.AFTER_DRAW,this.resetTransform),t.off(D.AFTER_TRANSFORM,this.fixElementSize)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ri.defaultOptions,e)),this.isZoomEvent=t=>!!(t.data&&"scale"in t.data),this.relatedEdgeToUpdate=new Set,this.zoom=this.context.graph.getZoom(),this.fixElementSize=t=>rn(this,void 0,void 0,function*(){if(!this.validate(t))return;let{graph:e}=this.context,{state:n,nodeFilter:i,edgeFilter:r,comboFilter:s}=this.options,o=(n?e.getElementDataByState("node",n):e.getNodeData()).filter(i),a=(n?e.getElementDataByState("edge",n):e.getEdgeData()).filter(r),l=(n?e.getElementDataByState("combo",n):e.getComboData()).filter(s),h=this.isZoomEvent(t)?this.zoom=Math.max(.01,Math.min(t.data.scale,10)):this.zoom,d=[...o,...l];d.length>0&&d.forEach(t=>this.fixNodeLike(t,h)),this.updateRelatedEdges(),a.length>0&&a.forEach(t=>this.fixEdge(t,h))}),this.cachedStyles=new Map,this.getOriginalFieldValue=(t,e,n)=>{var i;let r=this.cachedStyles.get(t)||[],s=(null===(i=r.find(t=>t.shape===e))||void 0===i?void 0:i.style)||{};return n in s||(s[n]=e.attributes[n],this.cachedStyles.set(t,[...r.filter(t=>t.shape!==e),{shape:e,style:s}])),s[n]},this.scaleEntireElement=(t,e,n)=>{e.setLocalScale(1/n);let i=this.cachedStyles.get(t)||[];i.push({shape:e}),this.cachedStyles.set(t,i)},this.scaleSpecificShapes=(t,e,n)=>{let i=function(t){let e=[],n=t=>{(null==t?void 0:t.children.length)&&t.children.forEach(t=>{e.push(t),n(t)})};return n(t),e}(t),r=Array.isArray(n)?n:[n];r.forEach(n=>{let{shape:r,fields:s}=n,o="function"==typeof r?r(i):t.getShape(r);if(o){if(!s){this.scaleEntireElement(t.id,o,e);return}s.forEach(n=>{let i=this.getOriginalFieldValue(t.id,o,n);(0,Q.Z)(i)&&(o.style[n]=i/e)})}})},this.skipIfExceedViewport=t=>{let{viewport:e}=this.context;return!(null==e?void 0:e.isInViewport(t.getRenderBounds(),!1,30))},this.fixNodeLike=(t,e)=>{let n=t6(t),{element:i,model:r}=this.context,s=i.getElement(n);if(!s||this.skipIfExceedViewport(s))return;let o=r.getRelatedEdgesData(n);o.forEach(t=>this.relatedEdgeToUpdate.add(t6(t)));let a=this.options[s.type];if(!a){this.scaleEntireElement(n,s,e);return}this.scaleSpecificShapes(s,e,a)},this.fixEdge=(t,e)=>{let n=t6(t),i=this.context.element.getElement(n);if(!i||this.skipIfExceedViewport(i))return;let r=this.options.edge;if(!r){i.style.transformOrigin="center",this.scaleEntireElement(n,i,e);return}this.scaleSpecificShapes(i,e,r)},this.updateRelatedEdges=()=>{let{element:t}=this.context;this.relatedEdgeToUpdate.size>0&&this.relatedEdgeToUpdate.forEach(e=>{let n=t.getElement(e);null==n||n.update({})}),this.relatedEdgeToUpdate.clear()},this.resetTransform=t=>rn(this,void 0,void 0,function*(){var e;null!==(e=t.data)&&void 0!==e&&e.firstRender||(this.options.reset?this.restoreCachedStyles():this.fixElementSize({data:{scale:this.zoom}}))}),this.bindEvents()}}ri.defaultOptions={enable:t=>t.data.scale<1,nodeFilter:()=>!0,edgeFilter:()=>!0,comboFilter:()=>!0,edge:[{shape:"key",fields:["lineWidth"]},{shape:"halo",fields:["lineWidth"]},{shape:"label"}],reset:!1};class rr extends el{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),eY.forEach(e=>{t.on("".concat(e,":").concat(O.CLICK),this.focus)})}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;eY.forEach(e=>{t.off("".concat(e,":").concat(O.CLICK),this.focus)})}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},rr.defaultOptions,e)),this.focus=t=>{var e,n,i,r;return e=this,n=void 0,i=void 0,r=function*(){if(!this.validate(t))return;let{graph:e}=this.context;yield e.focusElement(t.target.id,this.options.animation)},new(i||(i=Promise))(function(t,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(t){t(n)})).then(o,a)}l((r=r.apply(e,n||[])).next())})},this.bindEvents()}}rr.defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};class rs extends el{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),eY.forEach(e=>{t.on("".concat(e,":").concat(O.POINTER_ENTER),this.hoverElement),t.on("".concat(e,":").concat(O.POINTER_LEAVE),this.hoverElement)});let e=this.context.canvas.document;e.addEventListener("".concat(O.DRAG_START),this.toggleFrozen),e.addEventListener("".concat(O.DRAG_END),this.toggleFrozen)}getActiveIds(t){let{graph:e}=this.context,{degree:n,direction:i}=this.options,r=t.target.id;return n?eK(e,t.targetType,r,"function"==typeof n?n(t):n,i):[r]}validate(t){if(this.destroyed||this.isFrozen||iX(t.target)||this.context.graph.isCollapsingExpanding)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;eY.forEach(e=>{t.off("".concat(e,":").concat(O.POINTER_ENTER),this.hoverElement),t.off("".concat(e,":").concat(O.POINTER_LEAVE),this.hoverElement)});let e=this.context.canvas.document;e.removeEventListener("".concat(O.DRAG_START),this.toggleFrozen),e.removeEventListener("".concat(O.DRAG_END),this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},rs.defaultOptions,e)),this.isFrozen=!1,this.toggleFrozen=t=>{this.isFrozen="dragstart"===t.type},this.hoverElement=t=>{if(!this.validate(t))return;let e=t.type===O.POINTER_ENTER;this.updateElementsState(t,e);let{onHover:n,onHoverEnd:i}=this.options;e?null==n||n(t):null==i||i(t)},this.updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.inactiveState)return;let{graph:n}=this.context,{state:i,animation:r,inactiveState:s}=this.options,o=this.getActiveIds(t),a={};if(i&&Object.assign(a,this.getElementsState(o,i,e)),s){let t=t4(n.getData(),!0).filter(t=>!o.includes(t));Object.assign(a,this.getElementsState(t,s,e))}n.setElementState(a,r)},this.getElementsState=(t,e,n)=>{let{graph:i}=this.context,r={};return t.forEach(t=>{let s=i.getElementState(t);n?r[t]=s.includes(e)?s:[...s,e]:r[t]=s.filter(t=>t!==e)}),r},this.bindEvents()}}rs.defaultOptions={animation:!1,enable:!0,degree:0,direction:"both",state:"active",inactiveState:void 0};class ro extends el{bindEvents(){let{graph:t}=this.context;t.on(D.BEFORE_TRANSFORM,this.hideShapes),t.on(D.AFTER_TRANSFORM,this.showShapes)}unbindEvents(){let{graph:t}=this.context;t.off(D.BEFORE_TRANSFORM,this.hideShapes),t.off(D.AFTER_TRANSFORM,this.showShapes)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ro.defaultOptions,e)),this.hiddenShapes=[],this.isVisible=!0,this.setElementsVisibility=(t,e,n)=>{t.filter(Boolean).forEach(t=>{"hidden"!==e||t.isVisible()?"visible"===e&&this.hiddenShapes.includes(t)?this.hiddenShapes.splice(this.hiddenShapes.indexOf(t),1):es(t,e,n):this.hiddenShapes.push(t)})},this.filterShapes=(t,e)=>{if((0,to.Z)(e))return n=>!e(t,n);let n=null==e?void 0:e[t];return t=>!t.className||!(null==n?void 0:n.includes(t.className))},this.hideShapes=t=>{if(!this.validate(t)||!this.isVisible)return;let{element:e}=this.context,{shapes:n={}}=this.options;this.setElementsVisibility(e.getNodes(),"hidden",this.filterShapes("node",n)),this.setElementsVisibility(e.getEdges(),"hidden",this.filterShapes("edge",n)),this.setElementsVisibility(e.getCombos(),"hidden",this.filterShapes("combo",n)),this.isVisible=!1},this.showShapes=(0,i1.Z)(t=>{if(!this.validate(t)||this.isVisible)return;let{element:e}=this.context;this.setElementsVisibility(e.getNodes(),"visible"),this.setElementsVisibility(e.getEdges(),"visible"),this.setElementsVisibility(e.getCombos(),"visible"),this.isVisible=!0},this.options.debounce),this.bindEvents()}}ro.defaultOptions={enable:!0,debounce:200,shapes:t=>"node"===t};var ra=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class rl extends el{update(t){super.update(t),this.bindEvents()}bindEvents(){var t,e;let{trigger:n}=this.options;if(this.shortcut.unbindAll(),(0,_.Z)(n)){null===(t=this.graphDom)||void 0===t||t.removeEventListener(O.WHEEL,this.onWheel);let{up:e=[],down:i=[],left:r=[],right:s=[]}=n;this.shortcut.bind(e,t=>this.scroll([0,-10],t)),this.shortcut.bind(i,t=>this.scroll([0,10],t)),this.shortcut.bind(r,t=>this.scroll([-10,0],t)),this.shortcut.bind(s,t=>this.scroll([10,0],t))}else null===(e=this.graphDom)||void 0===e||e.addEventListener(O.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}formatDisplacement(t){let{sensitivity:e}=this.options;return t=eg(t,e),t=this.clampByDirection(t),t=this.clampByRange(t)}clampByDirection(t){let[e,n]=t,{direction:i}=this.options;return"x"===i?n=0:"y"===i&&(e=0),[e,n]}clampByRange(t){let[e,n]=t,{viewport:i,canvas:r}=this.context,[s,o]=r.getSize(),[a,l,h,d]=tg(this.options.range),c=tE(tb(i.getCanvasCenter()),[o*a,s*l,o*h,s*d]),u=ep(i.getViewportCenter(),[e,n,0]);if(!tO(u,c)){let{min:[t,i],max:[r,s]}=c;(u[0]<t&&e>0||u[0]>r&&e<0)&&(e=0),(u[1]<i&&n>0||u[1]>s&&n<0)&&(n=0)}return[e,n]}scroll(t,e){return ra(this,void 0,void 0,function*(){if(!this.validate(e))return;let{onFinish:n}=this.options,i=this.context.graph,r=this.formatDisplacement(t);yield i.translateBy(r,!1),null==n||n()})}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.graphDom)||void 0===t||t.removeEventListener(O.WHEEL,this.onWheel),super.destroy()}constructor(t,e){super(t,Object.assign({},rl.defaultOptions,e)),this.onWheel=t=>ra(this,void 0,void 0,function*(){this.options.preventDefault&&t.preventDefault();let e=t.deltaX,n=t.deltaY;yield this.scroll([-e,-n],t)}),this.shortcut=new eW(t.graph),this.bindEvents()}}rl.defaultOptions={enable:!0,sensitivity:1,preventDefault:!0,range:1/0};var rh=n(97734),rd=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class rc extends el{update(t){super.update(t),this.bindEvents()}bindEvents(){var t;let{trigger:e}=this.options;if(this.shortcut.unbindAll(),Array.isArray(e)&&(null===(t=this.context.canvas.getContainer())||void 0===t||t.addEventListener(O.WHEEL,this.preventDefault),this.shortcut.bind([...e,O.WHEEL],t=>{let{deltaX:e,deltaY:n}=t;this.zoom(-(null!=n?n:e),t,!1)})),"object"==typeof e){let{zoomIn:t=[],zoomOut:n=[],reset:i=[]}=e;this.shortcut.bind(t,t=>this.zoom(10,t,this.options.animation)),this.shortcut.bind(n,t=>this.zoom(-10,t,this.options.animation)),this.shortcut.bind(i,this.onReset)}}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return(0,to.Z)(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.context.canvas.getContainer())||void 0===t||t.removeEventListener(O.WHEEL,this.preventDefault),super.destroy()}constructor(t,e){super(t,Object.assign({},rc.defaultOptions,e)),this.zoom=(t,e,n)=>rd(this,void 0,void 0,function*(){let i;if(!this.validate(e))return;let{graph:r}=this.context;"viewport"in e&&(i=eR(e.viewport));let{sensitivity:s,onFinish:o}=this.options,a=1+(0,rh.Z)(t,-50,50)*s/100,l=r.getZoom();yield r.zoomTo(l*a,n,i),null==o||o()}),this.onReset=()=>rd(this,void 0,void 0,function*(){yield this.context.graph.zoomTo(1,this.options.animation)}),this.preventDefault=t=>{this.options.preventDefault&&t.preventDefault()},this.shortcut=new eW(t.graph),this.bindEvents()}}rc.defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[],preventDefault:!0};var ru=n(49212),rp=n(28607),rg=n(6895),rf=n(9554),ry=n(68448),rm=n(12666),rv=n(75381),rb=n(2590),rE=n(98434),rx=n(88256),rO=n(27830),rw=n(4125),rS=n(78557),rD=n(78405),rC=n(40803);class rM extends i9{getRoot(){let t=this.context.model.getRootsData();if(!nd(t)&&!(t.length>2))return t[0]}formatSize(t){let e="function"==typeof t?t:()=>t;return t=>e9(e(t))}doLayout(t,e){let{hGap:n,getRibSep:i,vGap:r,nodeSize:s,height:o}=e,{model:a}=this.context,l=this.formatSize(s),h=l(t)[0]+i(t),d=function(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i+=n*((t.children||[]).length+1),null===(e=t.children)||void 0===e||e.forEach(t=>{var e;let n=a.getNodeLikeDatum(t);null===(e=n.children)||void 0===e||e.forEach(t=>{let e=a.getNodeLikeDatum(t);i=d(e,i)})}),i},c=t=>{if(1===t.depth)return h;let e=a.getParentData(t.id,"tree");if(rL(t)){let i=a.getParentData(e.id,"tree"),s=g(t)-g(i);return c(e)+s*n/r}{let n=(e.children||[]).indexOf(t.id),i=a.getNodeData((e.children||[]).slice(n));return u(e)-i.reduce((t,e)=>t+d(e),0)-l(e)[0]/2}},u=(0,rC.Z)(t=>{if(rA(t))return l(t)[0]/2;let e=a.getParentData(t.id,"tree");if(rL(t))return c(t)+d(t)+l(t)[0]/2;{let i=g(t)-g(e);return c(t)+i*(n/r)}},t=>t.id),p=t=>g(a.getParentData(t,"tree")),g=(0,rC.Z)(t=>{if(rA(t))return o/2;if(rL(t)){let e=a.getParentData(t.id,"tree"),n=e.children.indexOf(t.id);if(0===n)return p(e.id)+r;let i=a.getNodeLikeDatum(e.children[n-1]);if(nd(i.children))return g(i)+r;let s=a.getDescendantsData(i.id);return Math.max(...s.map(t=>rL(t)?p(t.id):g(t)))+r}{if(nd(t.children))return p(t.id)+r;let e=a.getNodeLikeDatum(t.children.slice(-1)[0]);if(nd(e.children))return g(e)+r;let n=a.getDescendantsData(t.id).slice(-1)[0];return(rL(n)?p(n.id):g(n))+r}},t=>t.id),f=0,y={nodes:[],edges:[]},m=t=>{var e;null===(e=t.children)||void 0===e||e.forEach(t=>m(a.getNodeLikeDatum(t)));let n=g(t),r=u(t);if(y.nodes.push({id:t.id,x:r,y:n}),rA(t))return;let s=a.getRelatedEdgesData(t.id,"in")[0],o=[c(t),rL(t)?n:p(t.id)];y.edges.push({id:t6(s),controlPoints:[o],relatedNodeId:t.id}),f=Math.max(f,r+i(t)),1===t.depth&&(h=f)};return m(t),y}placeAlterative(t,e){let n=(e.children||[]).filter((t,e)=>e%2!=0);if(0===n.length)return t;let{model:i}=this.context,r=t.nodes.find(t=>t.id===e.id).y,s=t=>{let e=i.getAncestorsData(t,"tree");if(nd(e))return!1;let r=1===e.length?t:e[e.length-2].id;return n.includes(r)};t.nodes.forEach(t=>{s(t.id)&&(t.y=2*r-t.y)}),t.edges.forEach(t=>{s(t.relatedNodeId)&&(t.controlPoints=t.controlPoints.map(t=>[t[0],2*r-t[1]]))})}rightToLeft(t,e){return t.nodes.forEach(t=>t.x=e.width-t.x),t.edges.forEach(t=>{t.controlPoints=t.controlPoints.map(t=>[e.width-t[0],t[1]])}),t}execute(t,e){var n,i,r,s;return n=this,i=void 0,r=void 0,s=function*(){let n=Object.assign(Object.assign(Object.assign({},rM.defaultOptions),this.options),e),{direction:i,nodeSize:r}=n,s=this.getRoot();if(!s)return t;let o=this.formatSize(r);n.vGap||(n.vGap=Math.max(...(t.nodes||[]).map(t=>o(t)[1]))),n.hGap||(n.hGap=Math.max(...(t.nodes||[]).map(t=>o(t)[0])));let a=this.doLayout(s,n);this.placeAlterative(a,s),"RL"===i&&(a=this.rightToLeft(a,n));let{model:l}=this.context,h=[],d=[];return a.nodes.forEach(t=>{let{id:e,x:n,y:i}=t,r=l.getNodeLikeDatum(e);h.push(rT(r,{x:n,y:i}))}),a.edges.forEach(t=>{let{id:e,controlPoints:n}=t,i=l.getEdgeDatum(e);d.push(rT(i,{controlPoints:n}))}),{nodes:h,edges:d}},new(r||(r=Promise))(function(t,e){function o(t){try{l(s.next(t))}catch(t){e(t)}}function a(t){try{l(s.throw(t))}catch(t){e(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(t){t(n)})).then(o,a)}l((s=s.apply(n,i||[])).next())})}constructor(){super(...arguments),this.id="fishbone"}}rM.defaultOptions={direction:"RL",getRibSep:()=>60};let rT=(t,e)=>Object.assign(Object.assign({},t),{style:Object.assign(Object.assign({},t.style||{}),e)}),rA=t=>0===t.depth,rL=t=>(t.depth||(t.depth=0))%2==0;class rR extends i9{formatSize(t,e){let n="function"==typeof e?e:()=>e;return t.reduce((t,e)=>{let[i,r]=e9(n(e))||[0,0];return[Math.max(t[0],i),Math.max(t[1],r)]},[0,0])}validate(t){let{nodes:e=[],edges:n=[]}=t,i={},r={},s={};e.forEach(t=>{i[t.id]=0,r[t.id]=0,s[t.id]=[]}),n.forEach(t=>{i[t.target]++,r[t.source]++,s[t.source].push(t.target)});let o=new Set,a=t=>{o.has(t)||(o.add(t),s[t].forEach(a))};if(a(e[0].id),o.size!==e.length)return!1;let l=e.filter(t=>0===i[t.id]),h=e.filter(t=>0===r[t.id]);if(1!==l.length||1!==h.length)return!1;let d=e.filter(t=>1===i[t.id]&&1===r[t.id]);return d.length===e.length-2}execute(t,e){var n,i,r,s;return n=this,i=void 0,r=void 0,s=function*(){var n;if(!this.validate(t))return t;let{nodeSize:i,padding:r,sortBy:s,cols:o,colGap:a,rowGap:l,clockwise:h,width:d,height:c}=Object.assign({},rR.defaultOptions,this.options,e),[u,p,g,f]=tg(r),y=this.formatSize(t.nodes||[],i),m=Math.ceil((t.nodes||[]).length/o),v=a||(d-f-p-o*y[0])/(o-1),b=l||(c-u-g-m*y[1])/(m-1);(b===1/0||b<0)&&(b=0),(v===1/0||v<0)&&(v=0);let E=s?null===(n=t.nodes)||void 0===n?void 0:n.sort(s):function(t){let{nodes:e=[],edges:n=[]}=t,i={},r={};e.forEach(t=>{i[t.id]=0,r[t.id]=[]}),n.forEach(t=>{i[t.target]++,r[t.source].push(t.target)});let s=[],o=[];for(e.forEach(t=>{0===i[t.id]&&s.push(t.id)});s.length>0;){let t=s.shift(),n=e.find(e=>e.id===t);o.push(n),r[t].forEach(t=>{i[t]--,0===i[t]&&s.push(t)})}return o}(t),x=(E||[]).map((t,e)=>{let n=Math.floor(e/o),i=e%o,r=f+(h?n%2==0?i:o-1-i:n%2==0?o-1-i:i)*(y[0]+v)+y[0]/2,s=u+n*(y[1]+b)+y[1]/2;return{id:t.id,style:{x:r,y:s}}});return{nodes:x}},new(r||(r=Promise))(function(t,e){function o(t){try{l(s.next(t))}catch(t){e(t)}}function a(t){try{l(s.throw(t))}catch(t){e(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(t){t(n)})).then(o,a)}l((s=s.apply(n,i||[])).next())})}constructor(){super(...arguments),this.id="snake"}}rR.defaultOptions={padding:0,cols:5,clockwise:!0};var rP=n(86869);class rk extends ea{}function rN(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=document.createElement("div");return i.setAttribute("class","g6-".concat(t)),Object.assign(i.style,{position:"absolute",display:"block"}),e&&Object.assign(i.style,{position:"unset",gridArea:"1 / 1 / 2 / 2",inset:"0px",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none"}),n&&Object.assign(i.style,n),i}function rj(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body,s=document.getElementById(t);s&&s.remove();let o=document.createElement(e);return o.innerHTML=i,o.id=t,Object.assign(o.style,n),r.appendChild(o),o}class rI extends rk{update(t){var e,n,i,r;let s=Object.create(null,{update:{get:()=>super.update}});return e=this,n=void 0,i=void 0,r=function*(){s.update.call(this,t),Object.assign(this.$element.style,(0,rP.Z)(this.options,["key","type"]))},new(i||(i=Promise))(function(t,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(t){t(n)})).then(o,a)}l((r=r.apply(e,n||[])).next())})}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},rI.defaultOptions,e)),this.$element=rN("background");let n=this.context.canvas.getContainer();n.prepend(this.$element),this.update(e)}}function rB(t,e,n,i,r,s){let o=n-t,a=i-e,l=r-t,h=s-e,d=l*o+h*a,c=0;c=d<=0?0:(d=(l=o-l)*o+(h=a-h)*a)<=0?0:d*d/(o*o+a*a);let u=l*l+h*h-c;return u<0?0:u}function rF(t,e,n,i){return(t-n)*(t-n)+(e-i)*(e-i)}function r_(t){let e=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),r=Math.max(t.y1,t.y2);return{x:e,y:i,x2:n,y2:r,width:n-e,height:r-i}}rI.defaultOptions={transition:"background 0.5s",backgroundSize:"cover",zIndex:"-1"};class rz{constructor(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new rz(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2||e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2||t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;let n=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1);return t<=n}distSquare(t,e){return rB(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,n){if(this.x1<this.x2){if(t<this.x1-n||t>this.x2+n)return!1}else if(t<this.x2-n||t>this.x1+n)return!1;if(this.y1<this.y2){if(e<this.y1-n||e>this.y2+n)return!1}else if(e<this.y2-n||e>this.y1+n)return!1;return!0}}(f=R||(R={}))[f.POINT=1]="POINT",f[f.PARALLEL=2]="PARALLEL",f[f.COINCIDENT=3]="COINCIDENT",f[f.NONE=4]="NONE";class rZ{constructor(t,e=0,n=0){this.state=t,this.x=e,this.y=n}}function rV(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),r=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(r){let e=n/r,s=i/r;return 0<=e&&e<=1&&0<=s&&s<=1?new rZ(R.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new rZ(R.NONE)}return new rZ(0===n||0===i?R.COINCIDENT:R.PARALLEL)}function rW(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),r=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(r){let t=n/r,e=i/r;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function rH(t,e,n){let i=new Set;return t.width<=0?(i.add(P.LEFT),i.add(P.RIGHT)):e<t.x?i.add(P.LEFT):e>t.x+t.width&&i.add(P.RIGHT),t.height<=0?(i.add(P.TOP),i.add(P.BOTTOM)):n<t.y?i.add(P.TOP):n>t.y+t.height&&i.add(P.BOTTOM),i}function rG(t,e){let n=e.x1,i=e.y1,r=e.x2,s=e.y2,o=Array.from(rH(t,r,s));if(0===o.length)return!0;let a=rH(t,n,i);for(;0!==a.size;){for(let t of o)if(a.has(t))return!1;if(a.has(P.RIGHT)||a.has(P.LEFT)){let e=t.x;a.has(P.RIGHT)&&(e+=t.width),i+=(e-n)*(s-i)/(r-n),n=e}else{let e=t.y;a.has(P.BOTTOM)&&(e+=t.height),n+=(e-i)*(r-n)/(s-i),i=e}a=rH(t,n,i)}return!0}(y=P||(P={}))[y.LEFT=0]="LEFT",y[y.TOP=1]="TOP",y[y.RIGHT=2]="RIGHT",y[y.BOTTOM=3]="BOTTOM";class rY{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new rY(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new rY(this.x,this.y,this.width,this.height)}add(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x+t.width),r=Math.max(this.y2,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=r-n}addPoint(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x),r=Math.max(this.y2,t.y);this.x=e,this.y=n,this.width=i-e,this.height=r-n}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0)&&!(t.width<=0)&&!(t.height<=0)&&t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2}distSquare(t,e){if(this.containsPt(t,e))return 0;let n=rH(this,t,e);return n.has(P.TOP)?n.has(P.LEFT)?rF(t,e,this.x,this.y):n.has(P.RIGHT)?rF(t,e,this.x2,this.y):(this.y-e)*(this.y-e):n.has(P.BOTTOM)?n.has(P.LEFT)?rF(t,e,this.x,this.y2):n.has(P.RIGHT)?rF(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):n.has(P.LEFT)?(this.x-t)*(this.x-t):n.has(P.RIGHT)?(t-this.x2)*(t-this.x2):0}}class rU{constructor(t,e,n){this.cx=t,this.cy=e,this.radius=n}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new rU(t.cx,t.cy,t.radius)}containsPt(t,e){return rF(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){let n=rF(this.cx,this.cy,t,e);if(n<this.radius*this.radius)return 0;let i=Math.sqrt(n)-this.radius;return i*i}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class rK{constructor(t,e=0,n=0,i=0,r=0,s=10,o=10,a=new Float32Array(Math.max(0,s*o)).fill(0)){this.pixelGroup=t,this.i=e,this.j=n,this.pixelX=i,this.pixelY=r,this.width=s,this.height=o,this.area=a}createSub(t,e){return new rK(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new rK(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new rK(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){let e=this.scaleX(t.x),n=this.scaleY(t.y),i=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),r=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup)),s=i-e,o=r-n;return new rY(e,n,s,o)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){let n=Math.ceil(e/this.pixelGroup),i=this.boundX(t.x-n),r=this.boundY(t.y-n),s=this.boundX(t.x2+n),o=this.boundY(t.y2+n),a=s-i,l=o-r;return new rY(i,r,a,l)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=n)}set(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=n)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;let n=this.width,i=t.width,r=Math.max(0,t.i),s=Math.max(0,t.j),o=Math.min(t.i+t.width,n),a=Math.min(t.j+t.height,this.height);if(!(a<=0)&&!(o<=0)&&!(r>=n)&&!(a>=this.height))for(let l=s;l<a;l++){let s=(l-t.j)*i,a=l*n;for(let n=r;n<o;n++){let i=t.area[n-t.i+s];0!==i&&(this.area[n+a]+=e*i)}}}fill(t){this.area.fill(t)}fillArea(t,e){let n=t.x+t.y*this.width;for(let i=0;i<t.height;i++){let r=n+i*this.width;this.area.fill(e,r,r+t.width)}}fillHorizontalLine(t,e,n,i){let r=t+e*this.width;this.area.fill(i,r,r+n)}fillVerticalLine(t,e,n,i){let r=t+e*this.width;for(let t=0;t<n;t++)this.area[r+t*this.width]=i}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){let n=e*this.width;for(let e=0;e<this.width;e++){let i=this.area[n+e];t+=i.toFixed(1).padStart(6)+" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);let n=this.area.reduce((t,e)=>Math.min(t,e),Number.POSITIVE_INFINITY),i=this.area.reduce((t,e)=>Math.max(t,e),Number.NEGATIVE_INFINITY),r=t=>(t-n)/(i-n);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let i=this.area[e+n*this.width];t.fillStyle=`rgba(0, 0, 0, ${r(i)})`,t.fillRect(e,n,1,1)}t.restore()}drawThreshold(t,e,n=!0){if(!(this.width<=0)&&!(this.height<=0)){t.save(),n&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){let r=this.area[n+i*this.width];t.fillStyle=r>e?"black":"white",t.fillRect(n,i,1,1)}t.restore()}}}function rX(t,e){let n=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(n):n(t)}function r$(t,e,n){return rq(Object.assign(r_(t),{distSquare:(e,n)=>rB(t.x1,t.y1,t.x2,t.y2,e,n)}),e,n)}function rq(t,e,n){let i=rX(t,n),r=e.scale(i),s=e.createSub(r,i);return function(t,e,n,i){let r=n*n;for(let s=0;s<t.height;s++)for(let o=0;o<t.width;o++){let a=e.invertScaleX(t.i+o),l=e.invertScaleY(t.j+s),h=i(a,l);if(0===h){t.set(o,s,r);continue}if(h<r){let e=n-Math.sqrt(h);t.set(o,s,e*e)}}}(s,e,n,(e,n)=>t.distSquare(e,n)),s}function rJ(t,e){return e.some(e=>e.containsPt(t.x,t.y))}function rQ(t,e){return e.some(e=>{var n,i,r,s;return n=e.x1,i=e.y1,1e-6>rF(n,i,t.x,t.y)||(r=e.x2,s=e.y2,1e-6>rF(r,s,t.x,t.y))})}function r0(t,e){let n=Number.POSITIVE_INFINITY,i=null;for(let r of t){if(!rG(r,e))continue;let t=function(t,e){let n=Number.POSITIVE_INFINITY,i=0;function r(t,r,s,o){let a=rW(e,new rz(t,r,s,o));(a=Math.abs(a-.5))>=0&&a<=1&&(i++,a<n&&(n=a))}return(r(t.x,t.y,t.x2,t.y),r(t.x,t.y,t.x,t.y2),i>1)?n:(r(t.x,t.y2,t.x2,t.y2),i>1)?n:(r(t.x2,t.y,t.x2,t.y2),0===i)?-1:n}(r,e);t>=0&&t<n&&(i=r,n=t)}return i}function r1(t,e,n,i){let r=n.top,s=n.left,o=n.bottom,a=n.right;if(i){if(s.state===R.POINT){if(r.state===R.POINT)return{x:t.x-e,y:t.y-e};if(o.state===R.POINT)return{x:t.x-e,y:t.y2+e};let n=t.width*t.height,i=t.width*((s.y-t.y+(a.y-t.y))*.5);return i<.5*n?s.y>a.y?{x:t.x-e,y:t.y-e}:{x:t.x2+e,y:t.y-e}:s.y<a.y?{x:t.x-e,y:t.y2+e}:{x:t.x2+e,y:t.y2+e}}if(a.state===R.POINT){if(r.state===R.POINT)return{x:t.x2+e,y:t.y-e};if(o.state===R.POINT)return{x:t.x2+e,y:t.y2+e}}let n=t.height*t.width,i=t.height*((r.x-t.x+(a.x-t.x))*.5);return i<.5*n?r.x>o.x?{x:t.x-e,y:t.y-e}:{x:t.x-e,y:t.y2+e}:r.x<o.x?{x:t.x2+e,y:t.y-e}:{x:t.x2+e,y:t.y2+e}}if(s.state===R.POINT){if(r.state===R.POINT)return{x:t.x2+e,y:t.y2+e};if(o.state===R.POINT)return{x:t.x2+e,y:t.y-e};let n=t.height*t.width,i=t.width*((s.y-t.y+(a.y-t.y))*.5);return i<.5*n?s.y>a.y?{x:t.x2+e,y:t.y2+e}:{x:t.x-e,y:t.y2+e}:s.y<a.y?{x:t.x2+e,y:t.y-e}:{x:t.x-e,y:t.y-e}}if(a.state===R.POINT){if(r.state===R.POINT)return{x:t.x-e,y:t.y2+e};if(o.state===R.POINT)return{x:t.x-e,y:t.y-e}}let l=t.height*t.width,h=t.height*((r.x-t.x+(a.x-t.x))*.5);return h<.5*l?r.x>o.x?{x:t.x2+e,y:t.y2+e}:{x:t.x2+e,y:t.y-e}:r.x<o.x?{x:t.x-e,y:t.y2+e}:{x:t.x-e,y:t.y-e}}class r2{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){let e=this.points.length;return t<0?this.closed?this.get(t+e):this.points[0]:t>=e?this.closed?this.get(t-e):this.points[e-1]:this.points[t]}get length(){return this.points.length}toString(t=1/0){let e=this.points;if(0===e.length)return"";let n="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;let e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t),i="M";for(let t of e)i+=`${n(t.x)},${n(t.y)} L`;return i=i.slice(0,-1),this.closed&&(i+=" Z"),i}draw(t){let e=this.points;if(0!==e.length){for(let n of(t.beginPath(),t.moveTo(e[0].x,e[0].y),e))t.lineTo(n.x,n.y);this.closed&&t.closePath()}}sample(t){return(function(t=8){return e=>{let n=t,i=e.length;if(n>1)for(i=Math.floor(e.length/n);i<3&&n>1;)n-=1,i=Math.floor(e.length/n);let r=[];for(let t=0,s=0;s<i;s++,t+=n)r.push(e.get(t));return new r2(r)}})(t)(this)}simplify(t){return(function(t=0){return e=>{if(t<0||e.length<3)return e;let n=[],i=0,r=t*t;for(;i<e.length;){let t=i+1;for(;function(t,e,n,i){let r=t.closed?n<t.length:n<t.length-1;if(!r)return!1;let s=t.get(e),o=t.get(n+1);for(let r=e+1;r<=n;r++){let e=t.get(r),n=rB(s.x,s.y,o.x,o.y,e.x,e.y);if(n>i)return!1}return!0}(e,i,t,r);)t++;n.push(e.get(i)),i=t}return new r2(n)}})(t)(this)}bSplines(t){return(function(t=6){function e(t,e,n){let i=0,r=0;for(let s=-2;s<=1;s++){let o=t.get(e+s),a=function(t,e){switch(t){case -2:return(((-e+3)*e-3)*e+1)/6;case -1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw Error("unknown error")}}(s,n);i+=a*o.x,r+=a*o.y}return{x:i,y:r}}return n=>{if(n.length<3)return n;let i=[],r=n.closed,s=n.length+3-1+(r?0:2);i.push(e(n,2-(r?0:2),0));for(let o=2-(r?0:2);o<s;o++)for(let r=1;r<=t;r++)i.push(e(n,o,r/t));return new r2(i)}})(t)(this)}apply(t){return t(this)}containsElements(t){let e=function(t){if(0===t.length)return null;let e=t[0],n=new rY(e.x,e.y,0,0);for(let e of t)n.addPoint(e);return n}(this.points);return!!e&&t.every(t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy))}withinArea(t,e){if(0===this.length)return!1;let n=0,i=this.points[0],r=new rz(i.x,i.y,i.x,i.y);for(let i=1;i<this.points.length;i++){let s=this.points[i];r.x1=r.x2,r.y1=r.y2,r.x2=s.x,r.y2=s.y,r.cuts(t,e)&&n++}return r.x1=r.x2,r.y1=r.y2,r.x2=i.x,r.y2=i.y,r.cuts(t,e)&&n++,n%2==1}}class r3{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;let e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new r2(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}let r6={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};function r4(t){return null!=t&&"number"==typeof t.radius}function r8(t,e){return r4(t)===r4(e)&&(r4(t)?t.cx===e.cx&&t.cy===e.cy&&t.radius===e.radius:t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height)}(m=k||(k={}))[m.MEMBERS=0]="MEMBERS",m[m.NON_MEMBERS=1]="NON_MEMBERS",m[m.EDGES=2]="EDGES";class r9{constructor(t={}){this.dirty=new Set,this.members=[],this.nonMembers=[],this.virtualEdges=[],this.edges=[],this.activeRegion=new rY(0,0,0,0),this.potentialArea=new rK(1,0,0,0,0,0,0),this.o=Object.assign({},r6,t)}pushMember(...t){if(0!==t.length)for(let e of(this.dirty.add(k.MEMBERS),t))this.members.push({raw:e,obj:r4(e)?rU.from(e):rY.from(e),area:null})}removeMember(t){let e=this.members.findIndex(e=>r8(e.raw,t));return!(e<0)&&(this.members.splice(e,1),this.dirty.add(k.MEMBERS),!0)}removeNonMember(t){let e=this.nonMembers.findIndex(e=>r8(e.raw,t));return!(e<0)&&(this.nonMembers.splice(e,1),this.dirty.add(k.NON_MEMBERS),!0)}removeEdge(t){let e=this.edges.findIndex(e=>e.obj.equals(t));return!(e<0)&&(this.edges.splice(e,1),this.dirty.add(k.NON_MEMBERS),!0)}pushNonMember(...t){if(0!==t.length)for(let e of(this.dirty.add(k.NON_MEMBERS),t))this.nonMembers.push({raw:e,obj:r4(e)?rU.from(e):rY.from(e),area:null})}pushEdge(...t){if(0!==t.length)for(let e of(this.dirty.add(k.EDGES),t))this.edges.push({raw:e,obj:rz.from(e),area:null})}update(){let t=this.dirty.has(k.MEMBERS),e=this.dirty.has(k.NON_MEMBERS),n=this.dirty.has(k.EDGES);this.dirty.clear();let i=this.members.map(t=>t.obj);if(this.o.virtualEdges&&(t||e)){let t=this.nonMembers.map(t=>t.obj),e=function(t,e,n,i){if(0===t.length)return[];let r=function(t){if(t.length<2)return t;let e=0,n=0;return t.forEach(t=>{e+=t.cx,n+=t.cy}),e/=t.length,n/=t.length,t.map(t=>{let i=e-t.cx,r=n-t.cy;return[t,i*i+r*r]}).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}(t);return r.map((t,s)=>{let o=r.slice(0,s);return function(t,e,n,i,r){let s;let o={x:e.cx,y:e.cy},a=(s=Number.POSITIVE_INFINITY,n.reduce((e,n)=>{let i=rF(o.x,o.y,n.cx,n.cy);if(i>s)return e;let r=new rz(o.x,o.y,n.cx,n.cy),a=t.reduce((t,e)=>rG(e,r)&&function(t,e){function n(t,n,i,r){let s=rW(e,new rz(t,n,i,r));return(s=Math.abs(s-.5))>=0&&s<=1?1:0}let i=n(t.x,t.y,t.x2,t.y);return!!((i+=n(t.x,t.y,t.x,t.y2))>1||(i+=n(t.x,t.y2,t.x2,t.y2))>1)||(i+=n(t.x2,t.y,t.x2,t.y2))>0}(e,r)?t+1:t,0);return i*(a+1)*(a+1)<s&&(e=n,s=i*(a+1)*(a+1)),e},null));if(null==a)return[];let l=new rz(o.x,o.y,a.cx,a.cy),h=function(t,e,n,i){let r=[],s=[];s.push(t);let o=!0;for(let t=0;t<n&&o;t++)for(o=!1;!o&&s.length>0;){let t=s.pop(),n=r0(e,t),a=n?function(t,e){let n=0,i=rV(t,new rz(e.x,e.y,e.x2,e.y));n+=i.state===R.POINT?1:0;let r=rV(t,new rz(e.x,e.y,e.x,e.y2));n+=r.state===R.POINT?1:0;let s=rV(t,new rz(e.x,e.y2,e.x2,e.y2));n+=s.state===R.POINT?1:0;let o=rV(t,new rz(e.x2,e.y,e.x2,e.y2));return{top:i,left:r,bottom:s,right:o,count:n+=o.state===R.POINT?1:0}}(t,n):null;if(!n||!a||2!==a.count){o||r.push(t);continue}let l=i,h=r1(n,l,a,!0),d=rQ(h,s)||rQ(h,r),c=rJ(h,e);for(;!d&&c&&l>=1;)l/=1.5,d=rQ(h=r1(n,l,a,!0),s)||rQ(h,r),c=rJ(h,e);if(!h||d||c||(s.push(new rz(t.x1,t.y1,h.x,h.y)),s.push(new rz(h.x,h.y,t.x2,t.y2)),o=!0),o)continue;let u=rQ(h=r1(n,l=i,a,!1),s)||rQ(h,r);for(c=rJ(h,e);!u&&c&&l>=1;)l/=1.5,u=rQ(h=r1(n,l,a,!1),s)||rQ(h,r),c=rJ(h,e);h&&!u&&(s.push(new rz(t.x1,t.y1,h.x,h.y)),s.push(new rz(h.x,h.y,t.x2,t.y2)),o=!0),o||r.push(t)}for(;s.length>0;)r.push(s.pop());return r}(l,t,i,r);return function(t,e){let n=[];for(;t.length>0;){let i=t.pop();if(0===t.length){n.push(i);break}let r=t.pop(),s=new rz(i.x1,i.y1,r.x2,r.y2),o=r0(e,s);o?(n.push(i),t.push(r)):t.push(s)}return n}(h,t)}(e,t,o,n,i)}).flat()}(i,t,this.o.maxRoutingIterations,this.o.morphBuffer),r=new Map(this.virtualEdges.map(t=>[t.obj.toString(),t.area]));this.virtualEdges=e.map(t=>{var e;return{raw:t,obj:t,area:null!==(e=r.get(t.toString()))&&void 0!==e?e:null}}),n=!0}let r=!1;if(t||n){let t=this.virtualEdges.concat(this.edges).map(t=>t.obj),e=function(t,e){if(0===t.length)return new rY(0,0,0,0);let n=rY.from(t[0]);for(let e of t)n.add(e);for(let t of e)n.add(r_(t));return n}(i,t),n=Math.max(this.o.edgeR1,this.o.nodeR1)+this.o.morphBuffer,s=rY.from(rX(e,n));s.equals(this.activeRegion)||(r=!0,this.activeRegion=s)}if(r){let t=Math.ceil(this.activeRegion.width/this.o.pixelGroup),e=Math.ceil(this.activeRegion.height/this.o.pixelGroup);this.activeRegion.x!==this.potentialArea.pixelX||this.activeRegion.y!==this.potentialArea.pixelY?(this.potentialArea=rK.fromPixelRegion(this.activeRegion,this.o.pixelGroup),this.members.forEach(t=>t.area=null),this.nonMembers.forEach(t=>t.area=null),this.edges.forEach(t=>t.area=null),this.virtualEdges.forEach(t=>t.area=null)):(t!==this.potentialArea.width||e!==this.potentialArea.height)&&(this.potentialArea=rK.fromPixelRegion(this.activeRegion,this.o.pixelGroup))}let s=new Map,o=t=>{if(t.area){let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof rY?"R":"C"}`;s.set(e,t.area)}},a=t=>{if(t.area)return;let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof rY?"R":"C"}`;if(s.has(e)){let n=s.get(e);t.area=this.potentialArea.copy(n,{x:t.obj.x-this.o.nodeR1,y:t.obj.y-this.o.nodeR1});return}let n=t.obj instanceof rY?function(t,e,n){let i=e.scale(t),r=e.addPadding(i,n),s=e.createSub(r,{x:t.x-n,y:t.y-n}),o=i.x-r.x,a=i.y-r.y,l=r.x2-i.x2,h=r.y2-i.y2,d=r.width-o-l,c=r.height-a-h,u=n*n;s.fillArea({x:o,y:a,width:d+1,height:c+1},u);let p=[0],g=Math.max(a,o,l,h);{let r=e.invertScaleX(i.x+i.width/2);for(let s=1;s<g;s++){let o=e.invertScaleY(i.y-s),a=t.distSquare(r,o);if(a<u){let t=n-Math.sqrt(a);p.push(t*t)}else break}}let f=[],y=Math.max(o,l),m=Math.max(a,l);for(let r=1;r<y;r++){let s=e.invertScaleX(i.x-r),o=[];for(let r=1;r<m;r++){let a=e.invertScaleY(i.y-r),l=t.distSquare(s,a);if(l<u){let t=n-Math.sqrt(l);o.push(t*t)}else o.push(0)}f.push(o)}for(let t=1;t<Math.min(a,p.length);t++){let e=p[t];s.fillHorizontalLine(o,a-t,d+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];s.fillHorizontalLine(o,a+c+t,d+1,e)}for(let t=1;t<Math.min(o,p.length);t++){let e=p[t];s.fillVerticalLine(o-t,a,c+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];s.fillVerticalLine(o+d+t,a,c+1,e)}for(let t=1;t<o;t++){let e=f[t-1],n=o-t;for(let t=1;t<a;t++)s.set(n,a-t,e[t-1]);for(let t=1;t<h;t++)s.set(n,a+c+t,e[t-1])}for(let t=1;t<l;t++){let e=f[t-1],n=o+d+t;for(let t=1;t<a;t++)s.set(n,a-t,e[t-1]);for(let t=1;t<h;t++)s.set(n,a+c+t,e[t-1])}return s}(t.obj,this.potentialArea,this.o.nodeR1):rq(t.obj,this.potentialArea,this.o.nodeR1);t.area=n,s.set(e,n)};this.members.forEach(o),this.nonMembers.forEach(o),this.members.forEach(a),this.nonMembers.forEach(t=>{this.activeRegion.intersects(t.obj)?a(t):t.area=null}),this.edges.forEach(t=>{t.area||(t.area=r$(t.obj,this.potentialArea,this.o.edgeR1))}),this.virtualEdges.forEach(t=>{t.area||(t.area=r$(t.obj,this.potentialArea,this.o.edgeR1))})}drawMembers(t){for(let e of this.members)e.obj.draw(t)}drawNonMembers(t){for(let e of this.nonMembers)e.obj.draw(t)}drawEdges(t){for(let e of this.edges)e.obj.draw(t)}drawPotentialArea(t,e=!0){this.potentialArea.draw(t,e)}compute(){if(0===this.members.length)return new r2([]);this.dirty.size>0&&this.update();let{o:t,potentialArea:e}=this,n=this.members.map(t=>t.area),i=this.virtualEdges.concat(this.edges).map(t=>t.area),r=this.nonMembers.filter(t=>null!=t.area).map(t=>t.area),s=this.members.map(t=>t.obj);return function(t,e,n,i,r,s={}){let o=Object.assign({},r6,s),a=o.threshold,l=o.memberInfluenceFactor,h=o.edgeInfluenceFactor,d=o.nonMemberInfluenceFactor,c=(o.nodeR0-o.nodeR1)*(o.nodeR0-o.nodeR1),u=(o.edgeR0-o.edgeR1)*(o.edgeR0-o.edgeR1);for(let s=0;s<o.maxMarchingIterations;s++){if(t.clear(),0!==l){let n=l/c;for(let i of e)t.incArea(i,n)}if(0!==h){let e=h/u;for(let i of n)t.incArea(i,e)}if(0!==d){let e=d/c;for(let n of i)t.incArea(n,e)}let p=function(t,e){let n=(Math.floor(t.width)+Math.floor(t.height))*2,i=new r3(n);function r(n,i,r,s){let o=t.get(n,i);return Number.isNaN(o)?Number.NaN:o>e?r+s:r}function s(t,e){let n=0;return(n=r(t,e,0,1),n=r(t+1,e,n,2),n=r(t,e+1,n,4),Number.isNaN(n=r(t+1,e+1,n,8)))?-1:n}let o=1;for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++){if(t.get(n,r)<=e)continue;let a=s(n,r);if(!(a<0)&&15!==a&&function(e,n){let r=e,a=n,l=t.invertScaleX(r),h=t.invertScaleY(a);for(let e=0;e<t.width*t.height;e++){let e={x:l,y:h};if(i.contains(e)){if(i.isFirst(e))break}else i.add(e);let n=s(r,a);switch(n){case -1:return!0;case 0:case 3:case 2:case 7:o=2;break;case 12:case 14:case 4:o=3;break;case 6:o=0===o?3:2;break;case 1:case 13:case 5:o=0;break;case 9:o=2===o?0:1;break;case 10:case 8:case 11:o=1;break;default:return console.warn("Marching squares invalid state: "+n),!0}switch(o){case 0:a--,h-=t.pixelGroup;break;case 1:a++,h+=t.pixelGroup;break;case 3:r--,l-=t.pixelGroup;break;case 2:r++,l+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+n),!0}}return!0}(n,r))return i.path()}return null}(t,a);if(p&&r(p))return p;if(a*=.95,s<=.5*o.maxMarchingIterations)l*=1.2,h*=1.2;else if(0!==d&&i.length>0)d*=.8;else break}return new r2([])}(e,n,i,r,t=>t.containsElements(s),t)}}var r5=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class r7 extends rk{bindEvents(){this.context.graph.on(D.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(D.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new r9(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){let t=this.options,{type:e,key:n,members:i,avoidMembers:r}=t,s=r5(t,["type","key","members","avoidMembers"]),o=Object.keys(s).reduce((t,e)=>(e in r6?t.bubbleSetOptions[e]=s[e]:t.style[e]=s[e],t),{style:{},bubbleSetOptions:{}});return Object.assign({type:e,key:n,members:i,avoidMembers:r},o)}addMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.avoidMembers.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),this.drawBubbleSets()}updateMember(t){this.options.members=(0,to.Z)(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.members.includes(t))&&(this.options.members=this.options.members.filter(t=>!e.includes(t))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){let e=Array.isArray(t)?t:[t];this.options.avoidMembers.some(t=>e.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t)),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(D.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(D.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}constructor(t,e){super(t,(0,ed.Z)({},r7.defaultOptions,e)),this.members=new Map,this.avoidMembers=new Map,this.bubbleSetOptions={},this.drawBubbleSets=()=>{let{style:t,bubbleSetOptions:e}=this.parseOptions();(0,F.Z)(this.bubbleSetOptions,e)||this.init(),this.bubbleSetOptions=Object.assign({},e);let n=Object.assign(Object.assign({},t),{d:this.getPath()});this.shape?this.shape.update(n):(this.shape=new nE({style:n}),this.context.canvas.appendChild(this.shape))},this.updateBubbleSetsPath=t=>{if(!this.shape)return;let e=t6(t.data);[...this.options.members,...this.options.avoidMembers].includes(e)&&this.shape.update(Object.assign(Object.assign({},this.parseOptions().style),{d:this.getPath(e)}))},this.getPath=t=>{let{graph:e}=this.context,n=this.options.members,i=[...this.members.keys()],r=this.options.avoidMembers,s=[...this.avoidMembers.keys()];if(!t&&(0,F.Z)(n,i)&&(0,F.Z)(r,s))return this.path;let{enter:o=[],exit:a=[]}=er(i,n,t=>t),{enter:l=[],exit:h=[]}=er(s,r,t=>t);t&&(a.push(t),o.push(t));let d=(t,n,i)=>{t.forEach(t=>{let r=i?this.members:this.avoidMembers;if(n){let n;"edge"===e.getElementType(t)?([n]=se(e,t),this.bubbleSets.pushEdge(n)):([n]=st(e,t),this.bubbleSets[i?"pushMember":"pushNonMember"](n)),r.set(t,n)}else{let n=r.get(t);n&&("edge"===e.getElementType(t)?this.bubbleSets.removeEdge(n):this.bubbleSets[i?"removeMember":"removeNonMember"](n),r.delete(t))}})};d(a,!1,!0),d(o,!0,!0),d(h,!1,!1),d(l,!0,!1);let c=this.bubbleSets.compute(),u=c.sample(8).simplify(0).bSplines().simplify(0);return this.path=nv(u.points.map(eR)),this.path},this.bindEvents(),this.bubbleSets=new r9(this.options)}}r7.defaultOptions=Object.assign({members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2},r6);let st=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getElementRenderBounds(e);return new rY(n.min[0],n.min[1],tf(n),ty(n))})},se=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getEdgeData(e),i=t.getElementPosition(n.source),r=t.getElementPosition(n.target);return rz.from({x1:i[0],y1:i[1],x2:r[0],y2:r[1]})})};var sn=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class si extends rk{initElement(){this.$element=rN("contextmenu",!1,{zIndex:"99"});let{className:t}=this.options;t&&this.$element.classList.add(t);let e=this.context.canvas.getContainer();e.appendChild(this.$element),rj("g6-contextmenu-css","style",{},"\n  .g6-contextmenu {\n    font-size: 12px;\n    background-color: rgba(255, 255, 255, 0.96);\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;\n    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;\n  }\n\n  .g6-contextmenu-ul {\n    max-width: 256px;\n    min-width: 96px;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n\n  .g6-contextmenu-li {\n    padding: 8px 12px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .g6-contextmenu-li:hover {\n    background-color: #f5f5f5;\n    cursor: pointer;\n  }\n",document.head)}show(t){return sn(this,void 0,void 0,function*(){let{enable:e,offset:n}=this.options;if("function"==typeof e&&!e(t)||!e){this.hide();return}let i=yield this.getDOMContent(t);i instanceof HTMLElement?(this.$element.innerHTML="",this.$element.appendChild(i)):this.$element.innerHTML=i;let r=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left="".concat(t.client.x-r.left+n[0],"px"),this.$element.style.top="".concat(t.client.y-r.top+n[1],"px"),this.$element.style.display="block",this.targetElement=t.target})}hide(){this.$element.style.display="none",this.targetElement=null}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}getDOMContent(t){return sn(this,void 0,void 0,function*(){let{getContent:e,getItems:n}=this.options;if(n){var i;return i=yield n(t),'\n    <ul class="g6-contextmenu-ul">\n      '.concat(i.map(t=>'<li  class="g6-contextmenu-li" value="'.concat(t.value,'">').concat(t.name,"</li>")).join(""),"\n    </ul>\n  ")}return yield e(t)})}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("canvas:".concat(e),this.onTriggerEvent),t.on("node:".concat(e),this.onTriggerEvent),t.on("edge:".concat(e),this.onTriggerEvent),t.on("combo:".concat(e),this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("canvas:".concat(e),this.onTriggerEvent),t.off("node:".concat(e),this.onTriggerEvent),t.off("edge:".concat(e),this.onTriggerEvent),t.off("combo:".concat(e),this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}constructor(t,e){super(t,Object.assign({},si.defaultOptions,e)),this.targetElement=null,this.onTriggerEvent=t=>{var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.show(t)},this.onMenuItemClick=t=>{let{onClick:e,trigger:n}=this.options;if(t.target instanceof HTMLElement&&t.target.className.includes("g6-contextmenu-li")){let n=t.target.getAttribute("value");null==e||e(n,t.target,this.targetElement),this.hide()}"click"!==n&&this.hide()},this.initElement(),this.update(e)}}si.defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};class sr extends rk{get nodeMap(){let t=this.context.model.getNodeData();return Object.fromEntries(t.map(t=>[t6(t),eO(eT(t))]))}divideEdges(t){let e=this.context.model.getEdgeData();e.forEach(e=>{var n;let i=t6(e);(n=this.edgePoints)[i]||(n[i]=[]);let r=this.nodeMap[e.source],s=this.nodeMap[e.target];if(1===t)this.edgePoints[i].push(r),this.edgePoints[i].push(ef(eu(r,s),2)),this.edgePoints[i].push(s);else{let e=0===this.edgePoints[i].length?em(r,s):sc(this.edgePoints[i]),n=e/(t+1),o=n,a=[r];for(let t=1;t<this.edgePoints[i].length;t++){let e=this.edgePoints[i][t-1],r=this.edgePoints[i][t],s=em(r,e);for(;s>o;){let t=o/s,i=eu(e,eg(ep(r,e),t));a.push(i),s-=o,o=n}o-=s}a.push(s),this.edgePoints[i]=a}})}getVectorPosition(t){let e=this.nodeMap[t.source],n=this.nodeMap[t.target],[i,r]=ep(n,e),s=em(e,n);return{source:e,target:n,vx:i,vy:r,length:s}}measureEdgeCompatibility(t,e){let n=this.getVectorPosition(t),i=this.getVectorPosition(e),r=ss(n,i),s=so(n,i),o=sa(n,i),a=sd(n,i);return r*s*o*a}getEdgeBundles(){let t={},e=this.options.bundleThreshold,n=this.context.model.getEdgeData();return n.forEach((i,r)=>{n.forEach((n,s)=>{var o,a;if(s<=r)return;let l=this.measureEdgeCompatibility(i,n);l>=e&&(t[o=t6(i)]||(t[o]=[]),t[t6(i)].push(n),t[a=t6(n)]||(t[a]=[]),t[t6(n)].push(i))})}),t}getSpringForce(t,e){let{pre:n,cur:i,next:r}=t;return eg(ep(eu(n,r),eg(i,2)),e)}getElectrostaticForce(t,e){nd(this.edgeBundles)&&(this.edgeBundles=this.getEdgeBundles());let n=this.edgeBundles[t6(e)],i=[0,0];return null==n||n.forEach(n=>{let r=this.edgePoints[t6(n)][t],s=this.edgePoints[t6(e)][t],o=ep(r,s),a=em(r,s);i=eu(i,eg(o,1/a))}),i}getEdgeForces(t,e,n){let i=this.nodeMap[t.source],r=this.nodeMap[t.target],s=this.options.K/(em(i,r)*(e+1)),o=[[0,0]],a=t6(t);for(let i=1;i<e;i++){let e=this.getSpringForce({pre:this.edgePoints[a][i-1],cur:this.edgePoints[a][i],next:this.edgePoints[a][i+1]||[0,0]},s),r=this.getElectrostaticForce(i,t);o.push(eg(eu(e,r),n))}return o.push([0,0]),o}bindEvents(){let{graph:t}=this.context;t.on(D.AFTER_RENDER,this.onBundle)}unbindEvents(){let{graph:t}=this.context;t.off(D.AFTER_RENDER,this.onBundle)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},sr.defaultOptions,e)),this.edgeBundles={},this.edgePoints={},this.onBundle=()=>{let{model:t,element:e}=this.context,n=t.getEdgeData();this.divideEdges(this.options.divisions);let{cycles:i,iterRate:r,divRate:s}=this.options,{lambda:o,divisions:a,iterations:l}=this.options;for(let t=0;t<i;t++){for(let t=0;t<l;t++){let t={};n.forEach(e=>{var n;if(e.source===e.target)return;let i=t6(e);t[i]=this.getEdgeForces(e,a,o);for(let e=0;e<a+1;e++)(n=this.edgePoints)[i]||(n[i]=[]),this.edgePoints[i][e]=eu(this.edgePoints[i][e],t[i][e])})}o/=2,a*=s,l*=r,this.divideEdges(a)}n.forEach(t=>{let n=t6(t),i=e.getElement(n);null==i||i.update({d:ie(this.edgePoints[n])})})},this.bindEvents()}}sr.defaultOptions={K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:2/3,bundleThreshold:.6};let ss=(t,e)=>{var n,i;return Math.abs((n=[t.vx,t.vy],i=[e.vx,e.vy],n.reduce((t,e,n)=>t+e*i[n],0)/(t.length*e.length)))},so=(t,e)=>{let n=(t.length+e.length)/2;return 2/(n/Math.min(t.length,e.length)+Math.max(t.length,e.length)/n)},sa=(t,e)=>{let n=(t.length+e.length)/2,i=ef(eu(t.source,t.target),2),r=ef(eu(e.source,e.target),2);return n/(n+em(i,r))},sl=(t,e)=>{if(e.source[0]===e.target[0])return[e.source[0],t[1]];if(e.source[1]===e.target[1])return[t[0],e.source[1]];let n=(e.source[1]-e.target[1])/(e.source[0]-e.target[0]),i=(n*n*e.source[0]+n*(t[1]-e.source[1])+t[0])/(n*n+1),r=n*(i-e.source[0])+e.source[1];return[i,r]},sh=(t,e)=>{let n=sl(e.source,t),i=sl(e.target,t),r=ef(eu(n,i),2),s=ef(eu(t.source,t.target),2);return 0===em(n,i)?0:Math.max(0,1-2*em(s,r)/em(n,i))},sd=(t,e)=>Math.min(sh(t,e),sh(e,t)),sc=t=>{let e=0;for(let n=1;n<t.length;n++)e+=em(t[n],t[n-1]);return e},su={fill:"#fff",fillOpacity:1,lineWidth:1,stroke:"#000",strokeOpacity:.8,zIndex:-1/0};class sp extends rk{get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}getElementStyle(t,e){let n="node"===t?this.options.nodeStyle:this.options.edgeStyle;return"function"==typeof n?n(e):n}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;let{graph:e}=this.context,{trigger:n,scaleRBy:i}=this.options,r=e.getCanvas().getLayer();["click","drag"].includes(n)&&r.addEventListener(O.CLICK,this.onEdgeFilter),"pointermove"===n?r.addEventListener(O.POINTER_MOVE,this.onEdgeFilter):"drag"===n&&(r.addEventListener(O.DRAG_START,this.onDragStart),r.addEventListener(O.DRAG,this.onDrag),r.addEventListener(O.DRAG_END,this.onDragEnd)),"wheel"===i&&(null===(t=this.graphDom)||void 0===t||t.addEventListener(O.WHEEL,this.scaleRByWheel,{passive:!1}))}unbindEvents(){var t;let{graph:e}=this.context,{trigger:n,scaleRBy:i}=this.options,r=e.getCanvas().getLayer();["click","drag"].includes(n)&&r.removeEventListener(O.CLICK,this.onEdgeFilter),"pointermove"===n?r.removeEventListener(O.POINTER_MOVE,this.onEdgeFilter):"drag"===n&&(r.removeEventListener(O.DRAG_START,this.onDragStart),r.removeEventListener(O.DRAG,this.onDrag),r.removeEventListener(O.DRAG_END,this.onDragEnd)),"wheel"===i&&(null===(t=this.graphDom)||void 0===t||t.removeEventListener(O.WHEEL,this.scaleRByWheel))}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),this.isLensOn&&this.lens.destroy(),this.shapes.forEach((t,e)=>{t.destroy(),this.shapes.delete(e)}),super.destroy()}constructor(t,e){super(t,Object.assign({},sp.defaultOptions,e)),this.shapes=new Map,this.r=this.options.r,this.onEdgeFilter=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;let e=eR(t.canvas);this.renderLens(e),this.renderFocusElements()},this.renderLens=t=>{let e=Object.assign({},su,this.options.style);this.isLensOn||(this.lens=new nL({style:e}),this.canvas.appendChild(this.lens)),Object.assign(e,eP(t),{size:2*this.r}),this.lens.update(e)},this.getFilterData=()=>{let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:r,combos:s}=n;return{nodes:i.filter(e=>t(t6(e),"node")),edges:r.filter(e=>t(t6(e),"edge")),combos:s.filter(e=>t(t6(e),"combo"))}},this.getFocusElements=t=>{let{nodes:e,edges:n}=this.getFilterData(),i=e.filter(e=>em(eT(e),t)<this.r),r=i.map(t=>t6(t)),s=n.filter(t=>{let{source:e,target:n}=t,i=r.includes(e),s=r.includes(n);switch(this.options.nodeType){case"both":return i&&s;case"either":return i!==s;case"source":return i&&!s;case"target":return!i&&s;default:return!1}});return{nodes:i,edges:s}},this.renderFocusElements=()=>{let{element:t,graph:e}=this.context;if(!this.isLensOn)return;let n=this.lens.getCenter(),{nodes:i,edges:r}=this.getFocusElements(n),s=new Set,o=n=>{let i=t6(n);s.add(i);let r=t.getElement(i);if(!r)return;let o=this.shapes.get(i)||r.cloneNode();o.setPosition(r.getPosition()),o.id=r.id,this.shapes.has(i)?Object.entries(r.attributes).forEach(t=>{let[e,n]=t;o.style[e]!==n&&(o.style[e]=n)}):(this.canvas.appendChild(o),this.shapes.set(i,o));let a=e.getElementType(i),l=this.getElementStyle(a,n);o.update(l)};i.forEach(o),r.forEach(o),this.shapes.forEach((t,e)=>{s.has(e)||(t.destroy(),this.shapes.delete(e))})},this.scaleRByWheel=t=>{var e;this.options.preventDefault&&t.preventDefault();let{clientX:n,clientY:i,deltaX:r,deltaY:s}=t,{graph:o,canvas:a}=this.context,l=o.getCanvasByClient([n,i]),h=null===(e=this.lens)||void 0===e?void 0:e.getCenter();if(!this.isLensOn||em(l,h)>this.r)return;let{maxR:d,minR:c}=this.options,u=Math.min(...a.getSize())/2;this.r=Math.max(c||0,Math.min(d||u,this.r*(r+s>0?1/.95:.95))),this.renderLens(h),this.renderFocusElements()},this.isLensDragging=!1,this.onDragStart=t=>{var e;let n=eR(t.canvas),i=null===(e=this.lens)||void 0===e?void 0:e.getCenter();!this.isLensOn||em(n,i)>this.r||(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;let e=eR(t.canvas);this.renderLens(e),this.renderFocusElements()},this.onDragEnd=()=>{this.isLensDragging=!1},this.bindEvents()}}sp.defaultOptions={trigger:"pointermove",r:60,nodeType:"both",filter:()=>!0,style:{lineWidth:2},nodeStyle:{label:!1},edgeStyle:{label:!0},scaleRBy:"wheel",preventDefault:!0};let sg={fill:"#ccc",fillOpacity:.1,lineWidth:2,stroke:"#000",strokeOpacity:.8,labelFontSize:12};class sf extends rk{get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;let{graph:e}=this.context,{trigger:n,scaleRBy:i,scaleDBy:r}=this.options,s=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&s.addEventListener(O.CLICK,this.onCreateFisheye),"pointermove"===n&&s.addEventListener(O.POINTER_MOVE,this.onCreateFisheye),"drag"===n||"drag"===i||"drag"===r){s.addEventListener(O.DRAG_START,this.onDragStart),s.addEventListener(O.DRAG_END,this.onDragEnd);let t="drag"===n?this.onDrag:"drag"===i?this.scaleRByDrag:this.scaleDByDrag;s.addEventListener(O.DRAG,t)}if("wheel"===i||"wheel"===r){let e="wheel"===i?this.scaleRByWheel:this.scaleDByWheel;null===(t=this.graphDom)||void 0===t||t.addEventListener(O.WHEEL,e,{passive:!1})}}unbindEvents(){var t;let{graph:e}=this.context,{trigger:n,scaleRBy:i,scaleDBy:r}=this.options,s=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&s.removeEventListener(O.CLICK,this.onCreateFisheye),"pointermove"===n&&s.removeEventListener(O.POINTER_MOVE,this.onCreateFisheye),"drag"===n||"drag"===i||"drag"===r){s.removeEventListener(O.DRAG_START,this.onDragStart),s.removeEventListener(O.DRAG_END,this.onDragEnd);let t="drag"===n?this.onDrag:"drag"===i?this.scaleRByDrag:this.scaleDByDrag;s.removeEventListener(O.DRAG,t)}if("wheel"===i||"wheel"===r){let e="wheel"===i?this.scaleRByWheel:this.scaleDByWheel;null===(t=this.graphDom)||void 0===t||t.removeEventListener(O.WHEEL,e)}}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){var t;this.unbindEvents(),this.isLensOn&&(null===(t=this.lens)||void 0===t||t.destroy()),this.prevMagnifiedStyleMap.clear(),this.prevOriginStyleMap.clear(),super.destroy()}constructor(t,e){super(t,Object.assign({},sf.defaultOptions,e)),this.r=this.options.r,this.d=this.options.d,this.onCreateFisheye=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;let e=eR(t.canvas);this.onMagnify(e)},this.onMagnify=t=>{t.some(isNaN)||(this.renderLens(t),this.renderFocusElements())},this.renderLens=t=>{let e=Object.assign({},sg,this.options.style);this.isLensOn||(this.lens=new nL({style:e}),this.canvas.appendChild(this.lens)),Object.assign(e,eP(t),{size:2*this.r,label:this.options.showDPercent,labelText:this.getDPercent()}),this.lens.update(e)},this.getDPercent=()=>{let{minD:t,maxD:e}=this.options,n=Math.round((this.d-t)/(e-t)*100);return"".concat(n,"%")},this.prevMagnifiedStyleMap=new Map,this.prevOriginStyleMap=new Map,this.renderFocusElements=()=>{if(!this.isLensOn)return;let{graph:t}=this.context,e=this.lens.getCenter(),n=(this.d+1)*this.r,i=new Map,r=new Map,s=t.getNodeData();s.forEach(s=>{let o=eT(s),a=em(o,e);if(a>this.r)return;let l=n*a/(this.d*a+this.r),[h,d]=o,[c,u]=e,p=t6(s),g=this.getNodeStyle(s),f=(0,nz.Z)(t.getElementRenderStyle(p),Object.keys(g));i.set(p,Object.assign(Object.assign({},eP([c+l*((h-c)/a),u+l*((d-u)/a)])),g)),r.set(p,Object.assign(Object.assign({},eP(o)),f))}),this.updateStyle(i,r)},this.getNodeStyle=t=>{let{nodeStyle:e}=this.options;return"function"==typeof e?e(t):e},this.updateStyle=(t,e)=>{let{graph:n,element:i}=this.context,{enter:r,exit:s,keep:o}=er(Array.from(this.prevMagnifiedStyleMap.keys()),Array.from(t.keys()),t=>t),a=new Set,l=(t,e)=>{let r=i.getElement(t);null==r||r.update(e),n.getRelatedEdgesData(t).forEach(t=>{a.add(t6(t))})};[...r,...o].forEach(e=>{l(e,t.get(e))}),s.forEach(t=>{l(t,this.prevOriginStyleMap.get(t)),this.prevOriginStyleMap.delete(t)}),a.forEach(t=>{let e=i.getElement(t);null==e||e.update({})}),this.prevMagnifiedStyleMap=t,e.forEach((t,e)=>{this.prevOriginStyleMap.has(e)||this.prevOriginStyleMap.set(e,t)})},this.isWheelValid=t=>{if(this.options.preventDefault&&t.preventDefault(),!this.isLensOn)return!1;let{clientX:e,clientY:n}=t,i=this.context.graph.getCanvasByClient([e,n]),r=this.lens.getCenter();return!(em(i,r)>this.r)},this.scaleR=t=>{let{maxR:e,minR:n}=this.options,i=Math.min(...this.context.canvas.getSize())/2;this.r=Math.max(n||0,Math.min(e||i,this.r*(t?1/.95:.95)))},this.scaleD=t=>{let{maxD:e,minD:n}=this.options,i=t?this.d+.1:this.d-.1;this.d=Math.max(n,Math.min(e,i))},this.scaleRByWheel=t=>{if(!this.isWheelValid(t))return;let{deltaX:e,deltaY:n}=t;this.scaleR(e+n>0);let i=this.lens.getCenter();this.onMagnify(i)},this.scaleDByWheel=t=>{if(!this.isWheelValid(t))return;let{deltaX:e,deltaY:n}=t;this.scaleD(e+n>0);let i=this.lens.getCenter();this.onMagnify(i)},this.isDragValid=t=>{if(this.options.preventDefault&&t.preventDefault(),!this.isLensOn)return!1;let e=eR(t.canvas),n=this.lens.getCenter();return!(em(e,n)>this.r)},this.isLensDragging=!1,this.onDragStart=t=>{this.isDragValid(t)&&(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;let e=eR(t.canvas);this.onMagnify(e)},this.onDragEnd=()=>{this.isLensDragging=!1},this.scaleRByDrag=t=>{if(!this.isLensDragging)return;let{dx:e,dy:n}=t;this.scaleR(e-n>0);let i=this.lens.getCenter();this.onMagnify(i)},this.scaleDByDrag=t=>{if(!this.isLensDragging)return;let{dx:e,dy:n}=t;this.scaleD(e-n>0);let i=this.lens.getCenter();this.onMagnify(i)},this.bindEvents()}}sf.defaultOptions={trigger:"pointermove",r:120,d:1.5,maxD:5,minD:0,showDPercent:!0,style:{},nodeStyle:{label:!0},preventDefault:!0};class sy extends rk{bindEvents(){this.unbindEvents(),this.shortcut.unbindAll();let{request:t=[],exit:e=[]}=this.options.trigger;this.shortcut.bind(t,this.request),this.shortcut.bind(e,this.exit),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.addEventListener(t,this.onFullscreenChange,!1)})}unbindEvents(){this.shortcut.unbindAll(),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.removeEventListener(t,this.onFullscreenChange,!1)})}setGraphSize(){var t,e;let n,i,r=!(arguments.length>0)||void 0===arguments[0]||arguments[0];r?(n=(null===(t=globalThis.screen)||void 0===t?void 0:t.width)||0,i=(null===(e=globalThis.screen)||void 0===e?void 0:e.height)||0,this.graphSize=this.context.graph.getSize()):[n,i]=this.graphSize,this.context.graph.setSize(n,i),this.context.graph.render()}request(){!document.fullscreenElement&&(document.fullscreenEnabled||Reflect.get(document,"webkitFullscreenEnabled")||Reflect.get(document,"mozFullscreenEnabled")||Reflect.get(document,"msFullscreenEnabled"))&&this.$el.requestFullscreen().catch(t=>{U.warn("Error attempting to enable full-screen: ".concat(t.message," (").concat(t.name,")"))})}exit(){document.fullscreenElement&&document.exitFullscreen()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.exit(),this.style.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},sy.defaultOptions,e)),this.$el=this.context.canvas.getContainer(),this.graphSize=[0,0],this.onFullscreenChange=()=>{var t,e,n,i;let r=!!document.fullscreenElement;this.options.autoFit&&this.setGraphSize(r),r?null===(e=(t=this.options).onEnter)||void 0===e||e.call(t):null===(i=(n=this.options).onExit)||void 0===i||i.call(n)},this.shortcut=new eW(t.graph),this.bindEvents(),this.style=document.createElement("style"),document.head.appendChild(this.style),this.style.innerHTML="\n      :not(:root):fullscreen::backdrop {\n        background: transparent;\n      }\n    "}}sy.defaultOptions={trigger:{},autoFit:!0};class sm extends rk{update(t){super.update(t),this.updateStyle()}bindEvents(){let{graph:t}=this.context;t.on(D.AFTER_TRANSFORM,this.onTransform)}updateStyle(){let{size:t,stroke:e,lineWidth:n,border:i,borderLineWidth:r,borderStroke:s,borderStyle:o}=this.options;Object.assign(this.$element.style,{border:i?"".concat(r,"px ").concat(o," ").concat(s):"none",backgroundImage:"linear-gradient(".concat(e," ").concat(n,"px, transparent ").concat(n,"px), linear-gradient(90deg, ").concat(e," ").concat(n,"px, transparent ").concat(n,"px)"),backgroundSize:"".concat(t,"px ").concat(t,"px"),backgroundRepeat:"repeat"})}updateOffset(t){var e,n;this.offset=(e=eu(this.offset,t),n=this.options.size,e.map(t=>t%n)),this.$element.style.backgroundPosition="".concat(this.offset[0],"px ").concat(this.offset[1],"px")}destroy(){this.context.graph.off(D.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},sm.defaultOptions,e)),this.$element=rN("grid-line",!0),this.offset=[0,0],this.onTransform=t=>{if(!this.options.follow)return;let{data:{translate:e}}=t;e&&this.updateOffset(e)};let n=this.context.canvas.getContainer();n.prepend(this.$element),this.updateStyle(),this.bindEvents()}}sm.defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};var sv=n(13697);function sb(t){let e={Added:new Map,Updated:new Map,Removed:new Map};return t.forEach(t=>{let{type:n,value:i}=t,r=t6(i);if("NodeAdded"===n||"EdgeAdded"===n||"ComboAdded"===n)e.Added.set(r,t);else if("NodeUpdated"===n||"EdgeUpdated"===n||"ComboUpdated"===n){if(e.Added.has(r))e.Added.set(r,{type:n.replace("Updated","Added"),value:i});else if(e.Updated.has(r)){let{original:t}=e.Updated.get(r);e.Updated.set(r,{type:n,value:i,original:t})}else e.Removed.has(r)||e.Updated.set(r,t)}else("NodeRemoved"===n||"EdgeRemoved"===n||"ComboRemoved"===n)&&(e.Added.has(r)?e.Added.delete(r):(e.Updated.has(r)&&e.Updated.delete(r),e.Removed.set(r,t)))}),[...Array.from(e.Added.values()),...Array.from(e.Updated.values()),...Array.from(e.Removed.values())]}function sE(t){let{NodeAdded:e=[],NodeUpdated:n=[],NodeRemoved:i=[],EdgeAdded:r=[],EdgeUpdated:s=[],EdgeRemoved:o=[],ComboAdded:a=[],ComboUpdated:l=[],ComboRemoved:h=[]}=th(t,t=>t.type);return{add:{nodes:e,edges:r,combos:a},update:{nodes:n,edges:s,combos:l},remove:{nodes:i,edges:o,combos:h}}}class sx extends rk{canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){var t,e,n,i;let r=this.undoStack.pop();if(r){this.executeCommand(r);let s=null===(e=(t=this.options).beforeAddCommand)||void 0===e?void 0:e.call(t,r,!1);if(!1===s)return;this.redoStack.push(r),null===(i=(n=this.options).afterAddCommand)||void 0===i||i.call(n,r,!1),this.notify(C.UNDO,r)}return this}redo(){let t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(C.REDO,t)),this}undoAndCancel(){let t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(C.CANCEL,t)),this}undoStackPush(t){var e,n,i,r;let{stackSize:s}=this.options;0!==s&&this.undoStack.length>=s&&this.undoStack.shift();let o=null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!0);!1!==o&&(this.undoStack.push(t),null===(r=(i=this.options).afterAddCommand)||void 0===r||r.call(i,t,!0))}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(C.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(C.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){let{graph:t}=this.context;t.off(D.AFTER_DRAW,this.addCommand),t.off(D.BATCH_START,this.initBatchCommand),t.off(D.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}constructor(t,e){var n;super(t,Object.assign({},sx.defaultOptions,e)),n=this,this.batchChanges=null,this.batchAnimation=!1,this.undoStack=[],this.redoStack=[],this.freezed=!1,this.executeCommand=function(t){var e,i,r;let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];n.freezed=!0,null===(i=(e=n.options).executeCommand)||void 0===i||i.call(e,t);let o=s?t.original:t.current;n.context.graph.addData(o.add),n.context.graph.updateData(o.update),n.context.graph.removeData(t4(o.remove,!1)),null===(r=n.context.element)||void 0===r||r.draw({silence:!0,animation:t.animation}),n.freezed=!1},this.addCommand=t=>{var e;if(!this.freezed){if(t.type===D.AFTER_DRAW){let{dataChanges:n=[],animation:i=!0}=t.data;if(null===(e=this.context.batch)||void 0===e?void 0:e.isBatching){if(!this.batchChanges)return;this.batchChanges.push(n),this.batchAnimation&&(this.batchAnimation=i);return}this.batchChanges=[n],this.batchAnimation=i}this.undoStackPush(function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i={animation:e,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:r,update:s,remove:o}=sE(sb(t));return["nodes","edges","combos"].forEach(t=>{s[t]&&s[t].forEach(e=>{var r,s;let o=Object.assign({},e.value),a=Object.assign({},e.original);if(n){let t=n.graph.getElementType(t6(e.original)),i="edge"===t?"stroke":"fill",r=n.element.getElementComputedStyle(t,e.original);a=Object.assign(Object.assign({},e.original),{style:Object.assign({[i]:r[i]},e.original.style)})}(function t(e,n){for(let i in e)(0,_.Z)(e[i])&&!Array.isArray(e[i])&&null!==e[i]?(n[i]||(n[i]={}),t(e[i],n[i])):void 0===n[i]&&(n[i]=q(i))})(o,a),(r=i.current.update)[t]||(r[t]=[]),i.current.update[t].push(o),(s=i.original.update)[t]||(s[t]=[]),i.original.update[t].push(a)}),r[t]&&r[t].forEach(e=>{var n,r;let s=Object.assign({},e.value);(n=i.current.add)[t]||(n[t]=[]),i.current.add[t].push(s),(r=i.original.remove)[t]||(r[t]=[]),i.original.remove[t].push(s)}),o[t]&&o[t].forEach(e=>{var n,r;let s=Object.assign({},e.value);(n=i.current.remove)[t]||(n[t]=[]),i.current.remove[t].push(s),(r=i.original.add)[t]||(r[t]=[]),i.original.add[t].push(s)})}),i}(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(C.ADD,this.undoStack[this.undoStack.length-1])}},this.initBatchCommand=t=>{let{initiate:e}=t.data;if(this.batchAnimation=!1,e)this.batchChanges=[];else{let t=this.undoStack.pop();t||(this.batchChanges=null)}},this.emitter=new sv.Z;let{graph:i}=this.context;i.on(D.AFTER_DRAW,this.addCommand),i.on(D.BATCH_START,this.initBatchCommand),i.on(D.BATCH_END,this.addCommand)}}sx.defaultOptions={stackSize:0};var sO=n(47032),sw=n.n(sO);let sS=(t,e,n)=>{if("sharp"===n)return[["M",t[0]-e,t[1]-e],["L",t[0]+e,t[1]-e],["L",t[0]+e,t[1]+e],["L",t[0]-e,t[1]+e],["Z"]];let i=[e,e,0,0,0];return[["M",t[0],t[1]-e],["A",...i,t[0],t[1]+e],["A",...i,t[0],t[1]-e]]},sD=(t,e,n)=>{let i=[e,e,0,0,0],r="sharp"===n?eu(t[0],ey(eb(ep(t[0],t[1])),e)):t[0],s="sharp"===n?eu(t[1],ey(eb(ep(t[1],t[0])),e)):t[1],o=ey(eb(ex(ep(r,s),!1)),e),a=ey(o,-1),l=eu(r,o),h=eu(s,o),d=eu(s,a),c=eu(r,a);return"sharp"===n?[["M",l[0],l[1]],["L",h[0],h[1]],["L",d[0],d[1]],["L",c[0],c[1]],["Z"]]:[["M",l[0],l[1]],["L",h[0],h[1]],["A",...i,d[0],d[1]],["L",c[0],c[1]],["A",...i,l[0],l[1]]]},sC=(t,e)=>{let n=e_(t).map((n,i)=>{let r=(i-2+t.length)%t.length,s=(i-1+t.length)%t.length,o=(i+1)%t.length,a=t[r],l=t[s],h=t[o],d=ep(a,l),c=ep(l,n),u=ep(n,h),p=(t,e)=>eE(t,e,!0)<Math.PI,g=p(d,c),f=p(c,u),y=t=>ey(eb(ex(t,!1)),e),m=y(c);return[{p:eO(g?eu(l,y(d)):eu(l,m)),concave:g&&l},{p:eO(f?eu(n,y(u)):eu(n,m)),concave:f&&n}]}),i=[e,e,0,0,0],r=n.findIndex((t,e)=>!n[(e-1+n.length)%n.length][0].concave&&!n[(e-1+n.length)%n.length][1].concave&&!t[0].concave&&!t[0].concave&&!t[1].concave),s=n.slice(r).concat(n.slice(0,r)),o=[];return s.flatMap((t,e)=>{let r=[],a=s[n.length-1];return 0===e&&r.push(["M",...a[1].p]),t[0].concave?o.push(t[0].p,t[1].p):r.push(["A",...i,...t[0].p]),t[1].concave?o.unshift(t[1].p):r.push(["L",...t[1].p]),3===o.length&&(r.pop(),r.push(["C",...o.flat()]),o=[]),r})},sM=(t,e)=>{let n=e_(t).map((e,n)=>{let i=t[(n+1)%t.length];return{p:e,v:eb(ep(i,e))}});return n.forEach((i,r)=>{let s=r>0?r-1:t.length-1,o=n[s].v,a=eb(eu(o,ey(i.v,eE(o,i.v,!0)<Math.PI?1:-1)));i.p=eu(i.p,ey(a,e))}),nv(n.map(t=>t.p))},sT=(t,e)=>{let n=t.map((n,i)=>{let r=t[0===i?t.length-1:i-1],s=ew(ey(eb(ex(ep(r,n),!1)),e));return[eu(r,s),eu(n,s)]}),i=n.flat(),r=i.map((t,e)=>{if(e%2==0)return null;let n=[i[(e-1)%i.length],i[e%i.length]],r=[i[(e+1)%i.length],i[(e+2)%i.length]];return eC(n,r,!0)}).filter(Boolean);return r.map((t,e)=>[0===e?"M":"L",t[0],t[1]]).concat([["Z"]])};var sA=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class sL extends rk{bindEvents(){this.context.graph.on(D.AFTER_RENDER,this.drawHull),this.context.graph.on(D.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){let e=this.options,{members:n,padding:i,corner:r}=e,s=sA(e,["members","padding","corner"]);return Object.assign(Object.assign({},s),{d:this.getHullPath(t)})}getPadding(){let{graph:t}=this.context,e=this.hullMemberIds.reduce((e,n)=>{let{halfExtents:i}=t.getElementRenderBounds(n),r=Math.max(i[0],i[1]);return Math.max(e,r)},0);return e+this.options.padding}addMember(t){let e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),e.some(t=>this.hullMemberIds.includes(t))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=(0,to.Z)(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(D.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}constructor(t,e){var n;super(t,Object.assign({},sL.defaultOptions,e)),n=this,this.hullMemberIds=[],this.drawHull=()=>{if(this.shape){let t=!(0,F.Z)(this.optionsCache,this.options);this.shape.update(this.getHullStyle(t))}else this.shape=new nE({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);this.optionsCache=Object.assign({},this.options)},this.updateHullPath=t=>{this.shape&&this.options.members.includes(t6(t.data))&&this.shape.update({d:this.getHullPath(!0)})},this.getHullPath=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=n.context,i=n.getMember();if(0===i.length)return"";let r=i.map(t=>e.getNodeData(t)),s=sw()(r.map(eT),n.options.concavity).slice(1).reverse(),o=s.flatMap(t=>r.filter(e=>(0,F.Z)(eT(e),t)).map(t6));return(0,F.Z)(o,n.hullMemberIds)&&!t||(n.hullMemberIds=o,n.path=function(t,e,n){if(1===t.length)return sS(t[0],e,n);if(2===t.length)return sD(t,e,n);if(3===t.length){let[i,r,s]=e_(t);if(eD([i,r],[r,s]))return sD([i,s],e,n)}switch(n){case"smooth":return sM(t,e);case"sharp":return sT(t,e);default:return sC(t,e)}}(s,n.getPadding(),n.options.corner)),n.path},this.bindEvents()}}sL.defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};var sR=n(94854);function sP(t){let{width:e,height:n,renderer:i}=t,r=function(t){var e;let{container:n,className:i,graphCanvas:r}=t;if(n)return"string"==typeof n?document.getElementById(n):n;let s=rN(i,!1),{width:o,height:a,containerStyle:l}=t,[h,d]=function(t){let{width:e,height:n,placement:i,graphCanvas:r}=t,[s,o]=r.getSize(),[a,l]=eM(i);return[a*(s-e),l*(o-n)]}(t);return Object.assign(s.style,Object.assign({position:"absolute",left:h+"px",top:d+"px",width:o+"px",height:a+"px"},l)),null===(e=r.getContainer())||void 0===e||e.appendChild(s),s}(t),s=new j.Xz({width:e,height:n,container:r,renderer:i||new n_.Th});return[r,s]}var sk=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class sN extends rk{update(t){super.update(t),this.clear(),this.createElement()}clear(){var t,e;null===(t=this.canvas)||void 0===t||t.destroy(),null===(e=this.container)||void 0===e||e.remove(),this.canvas=void 0,this.container=void 0,this.draw=!1}updateElement(){this.category&&this.category.update({itemMarkerOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5},itemLabelOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5}})}upsertCanvas(){if(this.canvas)return this.canvas;let t=this.context.canvas,[e,n]=t.getSize(),{width:i=e,height:r=n,position:s,container:o,containerStyle:a,className:l}=this.options,[h,d]=sP({width:i,height:r,graphCanvas:t,container:o,containerStyle:a,placement:s,className:"legend"});return this.container=h,l&&h.classList.add(l),this.canvas=d,this.canvas}destroy(){this.clear(),this.context.graph.off(D.AFTER_DRAW,this.createElement),super.destroy()}constructor(t,e){super(t,Object.assign({},sN.defaultOptions,e)),this.typePrefix="__data__",this.draw=!1,this.fieldMap={node:new Map,edge:new Map,combo:new Map},this.selectedItems=[],this.bindEvents=()=>{let{graph:t}=this.context;t.on(D.AFTER_DRAW,this.createElement)},this.changeState=(t,e)=>{let{graph:n}=this.context,{typePrefix:i}=this,r=(0,e0.Z)(t,[i,"id"]),s=(0,e0.Z)(t,[i,"style","labelText"]),[o]=r.split("__"),a=this.fieldMap[o].get(s)||[];n.setElementState(Object.fromEntries(null==a?void 0:a.map(t=>[t,e])))},this.click=t=>{if("hover"===this.options.trigger)return;let e=(0,e0.Z)(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?(this.selectedItems=this.selectedItems.filter(t=>t!==e),this.changeState(t,[])):(this.selectedItems.push(e),this.changeState(t,"selected"))},this.mouseleave=t=>{"click"!==this.options.trigger&&(this.selectedItems=[],this.changeState(t,[]))},this.mouseenter=t=>{if("click"===this.options.trigger)return;let e=(0,e0.Z)(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?this.selectedItems=this.selectedItems.filter(t=>t!==e):(this.selectedItems.push(e),this.changeState(t,"active"))},this.setFieldMap=(t,e,n)=>{if(!t)return;let i=this.fieldMap[n];if(i){if(i.has(t)){let n=i.get(t);n&&(n.push(e),i.set(t,n))}else i.set(t,[e])}},this.getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click}),this.getMarkerData=(t,e)=>{if(!t)return[];let{model:n,element:i}=this.context,{nodes:r,edges:s,combos:o}=n.getData(),a={},l=e=>(0,to.Z)(t)?t(e):t,h={node:"circle",edge:"line",combo:"rect"},d={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},c=(t,e)=>{let n=null==i?void 0:i.getElementComputedStyle(t,e);return n},u=(t,e)=>{t.forEach(t=>{let{id:n}=t,r=(0,e0.Z)(t,["data",l(t)]),s=(null==i?void 0:i.getElementType(e,t))||"circle",o=c(e,t),u=("edge"===e?null==o?void 0:o.stroke:null==o?void 0:o.fill)||"#1783ff";n&&r&&r.replace(/\s+/g,"")&&(this.setFieldMap(r,n,e),a[r]||(a[r]={id:"".concat(e,"__").concat(n),label:r,marker:d[s]||h[e],elementType:e,lineWidth:1,stroke:u,fill:u}))})};switch(e){case"node":u(r,"node");break;case"edge":u(s,"edge");break;case"combo":u(o,"combo");break;default:return[]}return Object.values(a)},this.createElement=()=>{if(this.draw){this.updateElement();return}let t=this.options,{width:e,height:n,nodeField:i,edgeField:r,comboField:s,trigger:o,position:a,container:l,containerStyle:h,className:d}=t,c=sk(t,["width","height","nodeField","edgeField","comboField","trigger","position","container","containerStyle","className"]),u=this.getMarkerData(i,"node"),p=this.getMarkerData(r,"edge"),g=this.getMarkerData(s,"combo"),f=[...u,...g,...p],y=Object.assign({width:e,height:n,data:f,itemMarkerLineWidth:t=>{let{lineWidth:e}=t;return e},itemMarker:t=>{let{marker:e}=t;return e},itemMarkerStroke:t=>{let{stroke:e}=t;return e},itemMarkerFill:t=>{let{fill:e}=t;return e},gridCol:u.length},c,this.getEvents()),m=new sR.W({className:"legend",style:y});this.category=m;let v=this.upsertCanvas();v.appendChild(m),this.draw=!0},this.bindEvents()}}sN.defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16,width:240,height:160};class sj extends rk{update(t){this.unbindEvents(),super.update(t),"delay"in t&&this.setOnRender(),this.bindEvents()}setOnRender(){this.onRender=(0,i1.Z)(()=>{this.renderMinimap(),this.renderMask()},this.options.delay,!0)}bindEvents(){let{graph:t}=this.context;t.on(D.AFTER_DRAW,this.onDraw),t.on(D.AFTER_RENDER,this.onRender),t.on(D.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){let{graph:t}=this.context;t.off(D.AFTER_DRAW,this.onDraw),t.off(D.AFTER_RENDER,this.onRender),t.off(D.AFTER_TRANSFORM,this.onTransform)}renderMinimap(){let t=this.getElements(),e=this.initCanvas();this.setShapes(e,t)}getElements(){let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:r,combos:s}=n;return{nodes:i.filter(e=>t(t6(e),"node")),edges:r.filter(e=>t(t6(e),"edge")),combos:s.filter(e=>t(t6(e),"combo"))}}setShapes(t,e){let{nodes:n,edges:i,combos:r}=e,{shape:s}=this.options,{element:o}=this.context;if("key"===s){let e=new Set,s=n=>{let i=t6(n);e.add(i);let r=o.getElement(i);if(!r)return;let s=r.getShape("key"),a=this.shapes.get(i)||s.cloneNode();a.setPosition(s.getPosition()),r.style.zIndex&&(a.style.zIndex=r.style.zIndex),a.id=r.id,this.shapes.has(i)?Object.entries(s.attributes).forEach(t=>{let[e,n]=t;a.style[e]!==n&&(a.style[e]=n)}):(t.appendChild(a),this.shapes.set(i,a))};i.forEach(s),r.forEach(s),n.forEach(s),this.shapes.forEach((n,i)=>{e.has(i)||(t.removeChild(n),this.shapes.delete(i))});return}let a=(t,e)=>{let n=o.getElement(t),i=n.getPosition();return e.setPosition(i),e};t.removeChildren(),i.forEach(e=>t.appendChild(s(t6(e),"edge"))),r.forEach(e=>{t.appendChild(a(t6(e),s(t6(e),"combo")))}),n.forEach(e=>{t.appendChild(a(t6(e),s(t6(e),"node")))})}initCanvas(){let{renderer:t,size:[e,n]}=this.options;if(this.canvas){let{width:i,height:r}=this.canvas.getConfig();(e!==i||n!==r)&&this.canvas.resize(e,n),t&&this.canvas.setRenderer(t)}else{let{className:i,position:r,container:s,containerStyle:o}=this.options,[a,l]=sP({renderer:t,width:e,height:n,placement:r,className:"minimap",container:s,containerStyle:o,graphCanvas:this.context.canvas});i&&a.classList.add(i),this.container=a,this.canvas=l}return this.setCamera(),this.canvas}createLandmark(t,e,n){let i="".concat(t.join(","),"-").concat(e.join(","),"-").concat(n);if(this.landmarkMap.has(i))return this.landmarkMap.get(i);let r=this.canvas.getCamera(),s=r.createLandmark(i,{position:t,focalPoint:e,zoom:n});return this.landmarkMap.set(i,s),s}setCamera(){var t;let{canvas:e}=this.context,n=null===(t=this.canvas)||void 0===t?void 0:t.getCamera();if(!n)return;let{size:[i,r],padding:s}=this.options,[o,a,l,h]=tg(s),{min:d,max:c,center:u}=e.getBounds("elements"),p=c[0]-d[0],g=c[1]-d[1],f=this.createLandmark(u,u,Math.min((i-h-a)/p,(r-o-l)/g));n.gotoLandmark(f,0)}get maskBBox(){let{canvas:t}=this.context,e=t.getSize(),n=t.getCanvasByViewport([0,0]),i=t.getCanvasByViewport(e),r=this.canvas.canvas2Viewport(eP(n)),s=this.canvas.canvas2Viewport(eP(i)),o=s.x-r.x,a=s.y-r.y;return[r.x,r.y,o,a]}calculateMaskBBox(){let{size:[t,e]}=this.options,[n,i,r,s]=this.maskBBox;return n<0&&(r=sI(r+n,t),n=0),i<0&&(s=sI(s+i,e),i=0),n+r>t&&(r=sB(t-n,0)),i+s>e&&(s=sB(e-i,0)),[sI(n,t),sI(i,e),sB(r,0),sB(s,0)]}renderMask(){let{maskStyle:t}=this.options;this.mask||(this.mask=document.createElement("div"),this.mask.addEventListener("pointerdown",this.onMaskDragStart)),this.container.appendChild(this.mask),Object.assign(this.mask.style,Object.assign(Object.assign({},t),{cursor:"move",position:"absolute",pointerEvents:"auto"})),this.updateMask()}updateMask(){if(!this.mask)return;let[t,e,n,i]=this.calculateMaskBBox();Object.assign(this.mask.style,{top:e+"px",left:t+"px",width:n+"px",height:i+"px"})}destroy(){var t;this.unbindEvents(),this.canvas.destroy(),null===(t=this.mask)||void 0===t||t.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},sj.defaultOptions,e)),this.onDraw=t=>{var e;null!==(e=null==t?void 0:t.data)&&void 0!==e&&e.render||this.onRender()},this.shapes=new Map,this.landmarkMap=new Map,this.mask=null,this.isMaskDragging=!1,this.onMaskDragStart=t=>{this.mask&&(this.isMaskDragging=!0,this.mask.setPointerCapture(t.pointerId),this.mask.addEventListener("pointermove",this.onMaskDrag),this.mask.addEventListener("pointerup",this.onMaskDragEnd),this.mask.addEventListener("pointercancel",this.onMaskDragEnd))},this.onMaskDrag=t=>{if(!this.mask||!this.isMaskDragging)return;let{size:[e,n]}=this.options,{movementX:i,movementY:r}=t,{left:s,top:o,width:a,height:l}=this.mask.style,[,,h,d]=this.maskBBox,c=parseInt(s)+i,u=parseInt(o)+r,p=parseInt(a),g=parseInt(l);c<0&&(c=0),u<0&&(u=0),c+p>e&&(c=sB(e-p,0)),u+g>n&&(u=sB(n-g,0)),p<h&&(i>0?(c=sB(c-i,0),p=sI(p+i,e)):i<0&&(p=sI(p-i,e))),g<d&&(r>0?(u=sB(u-r,0),g=sI(g+r,n)):r<0&&(g=sI(g-r,n))),Object.assign(this.mask.style,{left:c+"px",top:u+"px",width:p+"px",height:g+"px"});let f=parseInt(s)-c,y=parseInt(o)-u;if(0===f&&0===y)return;let m=this.context.canvas.getCamera().getZoom(),v=this.canvas.getCamera().getZoom(),b=m/v;this.context.graph.translateBy([f*b,y*b],!1)},this.onMaskDragEnd=t=>{this.mask&&(this.isMaskDragging=!1,this.mask.releasePointerCapture(t.pointerId),this.mask.removeEventListener("pointermove",this.onMaskDrag),this.mask.removeEventListener("pointerup",this.onMaskDragEnd),this.mask.removeEventListener("pointercancel",this.onMaskDragEnd))},this.onTransform=(0,td.Z)(()=>{this.isMaskDragging||(this.updateMask(),this.setCamera())},32,{leading:!0}),this.setOnRender(),this.bindEvents()}}sj.defaultOptions={size:[240,160],shape:"key",padding:10,position:"right-bottom",maskStyle:{border:"1px solid #ddd",background:"rgba(0, 0, 0, 0.1)"},containerStyle:{border:"1px solid #ddd",background:"#fff"},delay:128};let sI=(t,e)=>Math.min(t,e),sB=(t,e)=>Math.max(t,e);var sF=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};let s_={x1:0,y1:0,x2:0,y2:0,visibility:"hidden"};class sz extends rk{getNodes(){var t;let{filter:e}=this.options,n=(null===(t=this.context.element)||void 0===t?void 0:t.getNodes())||[],i=n.filter(t=>{var e;return"hidden"!==(0,e0.Z)(t,["style","visibility"])&&(null===(e=this.context.viewport)||void 0===e?void 0:e.isInViewport(t.getRenderBounds()))});return e?i.filter(t=>e(t)):i}hideSnapline(){this.horizontalLine.style.visibility="hidden",this.verticalLine.style.visibility="hidden"}getLineWidth(t){let{lineWidth:e}=this.options["".concat(t,"LineStyle")];return+(e||s_.lineWidth||1)/this.context.graph.getZoom()}updateSnapline(t){let{verticalX:e,verticalMinY:n,verticalMaxY:i,horizontalY:r,horizontalMinX:s,horizontalMaxX:o}=t,[a,l]=this.context.canvas.getSize(),{offset:h}=this.options;null!==r?Object.assign(this.horizontalLine.style,{x1:h===1/0?0:s-h,y1:r,x2:h===1/0?a:o+h,y2:r,visibility:"visible",lineWidth:this.getLineWidth("horizontal")}):this.horizontalLine.style.visibility="hidden",null!==e?Object.assign(this.verticalLine.style,{x1:e,y1:h===1/0?0:n-h,x2:e,y2:h===1/0?l:i+h,visibility:"visible",lineWidth:this.getLineWidth("vertical")}):this.verticalLine.style.visibility="hidden"}getDelta(t){let e=this.context.graph.getZoom();return ef([t.dx,t.dy],e)}bindEvents(){return sF(this,void 0,void 0,function*(){let{graph:t}=this.context;t.on(M.DRAG_START,this.onDragStart),t.on(M.DRAG,this.onDrag),t.on(M.DRAG_END,this.onDragEnd)})}unbindEvents(){let{graph:t}=this.context;t.off(M.DRAG_START,this.onDragStart),t.off(M.DRAG,this.onDrag),t.off(M.DRAG_END,this.onDragEnd)}destroyElements(){var t,e;null===(t=this.horizontalLine)||void 0===t||t.destroy(),null===(e=this.verticalLine)||void 0===e||e.destroy()}destroy(){this.destroyElements(),this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},sz.defaultOptions,e)),this.initSnapline=()=>{let t=this.context.canvas.getLayer("transient");this.horizontalLine||(this.horizontalLine=t.appendChild(new j.x1({style:Object.assign(Object.assign({},s_),this.options.horizontalLineStyle)}))),this.verticalLine||(this.verticalLine=t.appendChild(new j.x1({style:Object.assign(Object.assign({},s_),this.options.verticalLineStyle)})))},this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!0,this.autoSnapToLine=(t,e,n)=>sF(this,void 0,void 0,function*(){let{verticalX:i,horizontalY:r}=n,{tolerance:s}=this.options,{min:[o,a],max:[l,h],center:[d,c]}=e,u=0,p=0;null!==i&&(sZ(l,i)<s&&(u=i-l),sZ(o,i)<s&&(u=i-o),sZ(d,i)<s&&(u=i-d),0!==u&&(this.isVerticalSticking=!0)),null!==r&&(sZ(h,r)<s&&(p=r-h),sZ(a,r)<s&&(p=r-a),sZ(c,r)<s&&(p=r-c),0!==p&&(this.isHorizontalSticking=!0)),(0!==u||0!==p)&&(yield this.context.graph.translateElementBy({[t]:[u,p]},!1))}),this.enableSnap=t=>{let{target:e}=t;if(this.isHorizontalSticking||this.isVerticalSticking){let[n,i]=this.getDelta(t);if(this.isHorizontalSticking&&this.isVerticalSticking&&.5>=Math.abs(n)&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[-n,-i]},!1),!1;if(this.isHorizontalSticking&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[0,-i]},!1),!1;if(this.isVerticalSticking&&.5>=Math.abs(n))return this.context.graph.translateElementBy({[e.id]:[-n,0]},!1),!1;this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!1,setTimeout(()=>{this.enableStick=!0},200)}return this.enableStick},this.calcSnaplineMetadata=(t,e)=>{let{tolerance:n,shape:i}=this.options,{min:[r,s],max:[o,a],center:[l,h]}=e,d=null,c=null,u=null,p=null,g=null,f=null;return this.getNodes().some(e=>{if((0,F.Z)(t.id,e.id))return!1;let y=sV(e,i).getRenderBounds(),{min:[m,v],max:[b,E],center:[x,O]}=y;return null===d&&(sZ(x,l)<n?d=x:sZ(m,r)<n?d=m:sZ(m,o)<n?d=m:sZ(b,o)<n?d=b:sZ(b,r)<n&&(d=b),null!==d&&(c=Math.min(v,s),u=Math.max(E,a))),null===p&&(sZ(O,h)<n?p=O:sZ(v,s)<n?p=v:sZ(v,a)<n?p=v:sZ(E,a)<n?p=E:sZ(E,s)<n&&(p=E),null!==p&&(g=Math.min(m,r),f=Math.max(b,o))),null!==d&&null!==p}),{verticalX:d,verticalMinY:c,verticalMaxY:u,horizontalY:p,horizontalMinX:g,horizontalMaxX:f}},this.onDragStart=()=>{this.initSnapline()},this.onDrag=t=>sF(this,void 0,void 0,function*(){let{target:e}=t;if(this.options.autoSnap){let e=this.enableSnap(t);if(!e)return}let n=sV(e,this.options.shape).getRenderBounds(),i=this.calcSnaplineMetadata(e,n);this.hideSnapline(),(null!==i.verticalX||null!==i.horizontalY)&&this.updateSnapline(i),this.options.autoSnap&&(yield this.autoSnapToLine(e.id,n,i))}),this.onDragEnd=()=>{this.hideSnapline()},this.bindEvents()}}sz.defaultOptions={tolerance:5,offset:20,autoSnap:!0,shape:"key",verticalLineStyle:{stroke:"#1783FF"},horizontalLineStyle:{stroke:"#1783FF"},filter:()=>!0};let sZ=(t,e)=>Math.abs(t-e),sV=(t,e)=>"function"==typeof e?e(t):t.getShape(e);var sW=n(8216),sH=n(86310),sG=n(25950),sY=n(90370);function sU(t,e){var n={YYYY:t.getFullYear(),MM:t.getMonth()+1,DD:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds()},i=e;return Object.keys(n).forEach(function(t){var e=n[t];i=i.replace(t,"YYYY"===t?"".concat(e):"".concat(e).padStart(2,"0"))}),i}var sK=n(56944),sX=n(36308),s$=n(31809),sq=n(25378),sJ=n(10252),sQ=n(13984),s0=n(72020),s1=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.hoverColor="#f5f5f5",i.selectedColor="#e6f7ff",i.background=i.appendChild(new j.UL({})),i.label=i.background.appendChild(new j.ZA({})),i}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,s$.j)(this.style.padding)},enumerable:!1,configurable:!0}),e.prototype.renderLabel=function(){var t=this.style,e=t.label,n=t.value,i=(0,sY.zs)(this.attributes,"label");(0,sq.Ys)(this.label).maybeAppend(".label",function(){return(0,sQ.S)(e)}).attr("className","label").styles(i),this.label.attr("__data__",n)},e.prototype.renderBackground=function(){var t=this.label.getBBox(),e=(0,tP.CR)(this.padding,4),n=e[0],i=e[1],r=e[2],s=e[3],o=t.width,a=t.height,l=a+n+r,h=(0,sY.zs)(this.attributes,"background"),d=this.style,c=d.width,u=d.height,p=d.selected;this.background.attr((0,tP.pi)((0,tP.pi)({},h),{width:Math.max(o+s+i,void 0===c?0:c),height:Math.max(l,void 0===u?0:u),fill:p?this.selectedColor:"#fff"})),this.label.attr({transform:"translate(".concat(s,", ").concat((l-a)/2,")")})},e.prototype.render=function(){this.renderLabel(),this.renderBackground()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("pointerenter",function(){t.style.selected||t.background.attr("fill",t.hoverColor)}),this.addEventListener("pointerleave",function(){t.style.selected||t.background.attr("fill",t.style.backgroundFill)});var e=this;this.addEventListener("click",function(){var n=t.style,i=n.label,r=n.value,s=n.onClick;null==s||s(r,{label:i,value:r},e)})},e.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},e}(sW.w),s2=function(t){function e(n){var i,r,s=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;s.currentValue=null===(i=e.defaultOptions.style)||void 0===i?void 0:i.defaultValue,s.isPointerInSelect=!1,s.select=s.appendChild(new j.UL({className:"select",style:{cursor:"pointer",width:0,height:0}})),s.dropdown=s.appendChild(new j.UL({className:"dropdown"}));var o=s.style.defaultValue;return o&&(null===(r=s.style.options)||void 0===r?void 0:r.some(function(t){return t.value===o}))&&(s.currentValue=o),s}return(0,tP.ZT)(e,t),e.prototype.setValue=function(t){this.currentValue=t,this.render()},e.prototype.getValue=function(){return this.currentValue},Object.defineProperty(e.prototype,"dropdownPadding",{get:function(){return(0,s$.j)(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),e.prototype.renderSelect=function(){var t,e=this,n=this.style,i=n.x,r=n.y,s=n.width,o=n.height,a=n.bordered,l=n.showDropdownIcon,h=(0,sY.zs)(this.attributes,"select"),d=(0,sY.zs)(this.attributes,"placeholder");this.select.attr((0,tP.pi)((0,tP.pi)({x:i,y:r,width:s,height:o},h),{fill:"#fff",strokeWidth:a?1:0}));var c=this.dropdownPadding;l&&(0,sq.Ys)(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(i+s-10-c[1]-c[3],", ").concat(r+o/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var u=null===(t=this.style.options)||void 0===t?void 0:t.find(function(t){return t.value===e.currentValue}),p=(0,tP.pi)({x:i+c[3]},d);(0,sq.Ys)(this.select).selectAll(".placeholder").data(u?[]:[1]).join(function(t){return t.append("text").attr("className","placeholder").styles(p).style("y",function(){return r+(o-this.getBBox().height)/2})},function(t){return t.styles(p)},function(t){return t.remove()});var g=(0,sY.zs)(this.attributes,"optionLabel"),f=(0,tP.pi)({x:i+c[3]},g);(0,sq.Ys)(this.select).selectAll(".value").data(u?[u]:[]).join(function(t){return t.append(function(t){return(0,sQ.S)(t.label)}).attr("className","value").styles(f).style("y",function(){return r+(o-this.getBBox().height)/2})},function(t){return t.styles(f)},function(t){return t.remove()})},e.prototype.renderDropdown=function(){var t,e,n=this,i=this.style,r=i.x,s=i.y,o=i.width,a=i.height,l=i.options,h=i.onSelect,d=i.open,c=(0,sY.zs)(this.attributes,"dropdown"),u=(0,sY.zs)(this.attributes,"option"),p=this.dropdownPadding;(0,sq.Ys)(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(l,function(t){return t.value}).join(function(t){return t.append(function(t){return new s1({className:"dropdown-item",style:(0,tP.pi)((0,tP.pi)((0,tP.pi)({},t),u),{width:o-p[1]-p[3],selected:t.value===n.currentValue,onClick:function(t,e,i){n.setValue(t),null==h||h(t,e,i),n.dispatchEvent(new j.Aw("change",{detail:{value:t,option:e,item:i}})),(0,s0.Cp)(n.dropdown)}})})}).each(function(t,e){var n,i=(null===(n=this.parentNode)||void 0===n?void 0:n.children).reduce(function(t,n,i){return i<e&&(t+=n.getBBox().height),t},0);this.attr("transform","translate(".concat(p[3],", ").concat(p[0]+i,")"))})},function(t){return t.update(function(t){return{selected:t.value===n.currentValue}})},function(t){return t.remove()});var g=null===(e=null===(t=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===t?void 0:t[0])||void 0===e?void 0:e.getBBox(),f=c.spacing;this.dropdown.attr((0,tP.pi)({transform:"translate(".concat(r,", ").concat(s+a+f,")"),width:g.width+p[1]+p[3],height:g.height+p[0]+p[2]},c)),d||(0,s0.Cp)(this.dropdown)},e.prototype.render=function(){this.renderSelect(),this.renderDropdown()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("click",function(t){t.stopPropagation()}),this.select.addEventListener("click",function(){"visible"===t.dropdown.style.visibility?(0,s0.Cp)(t.dropdown):(0,s0.$Z)(t.dropdown)}),this.addEventListener("pointerenter",function(){t.isPointerInSelect=!0}),this.addEventListener("pointerleave",function(){t.isPointerInSelect=!1}),null==document||document.addEventListener("click",function(){t.isPointerInSelect||(0,s0.Cp)(t.dropdown)})},e.defaultOptions={style:{x:0,y:0,width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},e}(sW.w),s3=function(t){function e(n){var i=t.call(this,(0,sH.n)({},{style:{backgroundOpacity:e.backgroundOpacities.default}},e.defaultOptions,n))||this;return i.showBackground=!0,i.background=i.appendChild(new j.UL({})),i.icon=i.appendChild(new j.ZA({})),i}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,s$.j)(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconSize",{get:function(){var t=this.attributes.size,e=(0,tP.CR)(this.padding,4),n=e[0],i=e[1],r=e[2];return Math.max(t-Math.max(e[3]+i,n+r),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.size,r=i/2,s=(0,sY.zs)(this.attributes,"background");this.background.attr((0,tP.pi)({x:e-r,y:n-r,width:i,height:i},s))},e.prototype.showIndicator=function(){if(this.label){var t=this.attributes.size,e=this.background.getBBox(),n=e.x,i=e.y;this.indicator.update({x:n+t/2,y:i-5,labelText:this.label,visibility:"visible"})}},e.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},e.prototype.connectedCallback=function(){t.prototype.connectedCallback.call(this);var e,n=this.attributes.size,i=this.background.getBBox(),r=i.x,s=i.y,o=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView;o&&(this.indicator=o.appendChild(new sJ.z({style:{x:r+n/2,y:s-n/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},e.prototype.disconnectedCallback=function(){this.indicator.destroy()},e.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},e.prototype.bindEvents=function(){var t=this,n=this.attributes.onClick;if(this.addEventListener("click",function(){null==n||n(t)}),this.showBackground){var i=function(){return t.background.attr({opacity:e.backgroundOpacities.default})};this.addEventListener("pointerenter",function(){t.background.attr({opacity:e.backgroundOpacities.hover}),t.showIndicator()}),this.addEventListener("pointerleave",function(){i(),t.hideIndicator()}),this.addEventListener("pointerdown",function(){t.background.attr({opacity:e.backgroundOpacities.active})}),this.addEventListener("pointerup",function(){i()})}},e.tag="IconBase",e.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},e.backgroundOpacities={default:0,hover:.8,active:1},e}(sW.w),s6=function(t,e){return void 0===e&&(e="#565758"),new j.y$({style:{fill:e,d:"M ".concat(t,",").concat(t," L -").concat(t,",0 L ").concat(t,",-").concat(t," Z"),transformOrigin:"center"}})},s4=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),e.prototype.arcPath=function(t,e,n){var i=(0,tP.CR)([n,n],2),r=i[0],s=i[1],o=function(i){return[t+n*Math.cos(i),e+n*Math.sin(i)]},a=(0,tP.CR)(o(-5/4*Math.PI),2),l=a[0],h=a[1],d=(0,tP.CR)(o(1/4*Math.PI),2),c=d[0],u=d[1];return"M".concat(l,",").concat(h,",A").concat(r,",").concat(s,",0,1,1,").concat(c,",").concat(u)},Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=this.lineWidth,o=s+.5;(0,sq.Ys)(this.icon).maybeAppend(".reset","path").styles({stroke:i,lineWidth:s,d:this.arcPath(e,n,r/2-s),markerStart:s6(o,i)})},e}(s3),s8=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=r/2,o=r/2/1.7320508075688772;(0,sq.Ys)(this.icon).maybeAppend(".backward","polygon").styles({points:[[e,n],[e,n-o],[e-s,n],[e,n+o],[e,n],[e+s,n-o],[e+s,n+o],[e,n]],fill:i})},e}(s3),s9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=r/2,o=r/2/1.7320508075688772;(0,sq.Ys)(this.icon).maybeAppend(".forward","polygon").styles({points:[[e,n],[e,n-o],[e+s,n],[e,n+o],[e,n],[e-s,n-o],[e-s,n+o],[e,n]],fill:i})},e}(s3),s5=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=r/3*1.3856406460551018;(0,sq.Ys)(this.icon).maybeAppend(".play","polygon").styles({points:[[e+s,n],[e-s/2,n-r/2*.8],[e-s/2,n+r/2*.8],[e+s,n]],fill:i})},e}(s3),s7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=r/3;(0,sq.Ys)(this.icon).maybeAppend(".pause","polygon").styles({points:[[e-s,n-r/2],[e-s,n+r/2],[e-s/2,n+r/2],[e-s/2,n-r/2],[e-s,n-r/2],[e+s/2,n-r/2],[e+s/2,n+r/2],[e+s,n+r/2],[e+s,n-r/2]],fill:i})},e}(s3),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=this.lineWidth;(0,sq.Ys)(this.icon).maybeAppend(".left-line","line").styles({x1:e-r/2,y1:n-r/2,x2:e-r/2,y2:n+r/2,stroke:i,lineWidth:s}),(0,sq.Ys)(this.icon).maybeAppend(".right-line","line").styles({x1:e+r/2,y1:n-r/2,x2:e+r/2,y2:n+r/2,stroke:i,lineWidth:s}),(0,sq.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e,y1:n,x2:e-r/2+2*s,y2:n,stroke:i,lineWidth:s,markerEnd:s6(2*s,i)}),(0,sq.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e,y1:n,x2:e+r/2-2*s,y2:n,stroke:i,lineWidth:s,markerEnd:s6(2*s,i)})},e}(s3),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=this.lineWidth;(0,sq.Ys)(this.icon).maybeAppend(".line","line").styles({x1:e,y1:n-r/2,x2:e,y2:n+r/2,stroke:i,lineWidth:s}),(0,sq.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e-r/2-2*s,y1:n,x2:e-2*s,y2:n,stroke:i,lineWidth:s,markerEnd:s6(2*s,i)}),(0,sq.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e+r/2+2*s,y1:n,x2:e+2*s,y2:n,stroke:i,lineWidth:s,markerEnd:s6(2*s,i)})},e}(s3),on=function(t){return[[-t/2,-t/2],[-t/2,t/2],[t/2,t/2]]},oi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=this.lineWidth,o=(r-2*s-s)/4,a=(r-2*s-s)/2,l=(0,tP.CR)([e-r/2+s,n+r/2-2*s],2),h=l[0],d=l[1];(0,sq.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:on(r).map(function(t){var i=(0,tP.CR)(t,2);return[i[0]+e,i[1]+n]}),stroke:i,lineWidth:s}),(0,sq.Ys)(this.icon).maybeAppend(".line","polyline").styles({points:[[h,d],[h+o,d-a],[h+2*o,d],[h+4*o,d-2*a]],stroke:i,lineWidth:s})},e}(s3),or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.data,e=this.attributes,n=e.x,i=e.y,r=e.color,s=this.iconSize,o=this.lineWidth,a=(s-o)/t.length,l=(s-2*o)/4,h=(0,tP.CR)([n-s/2+2*o,i+s/2-o],2),d=h[0],c=h[1];(0,sq.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:on(s).map(function(t){var e=(0,tP.CR)(t,2);return[e[0]+n,e[1]+i]}),stroke:r,lineWidth:o}),(0,sq.Ys)(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map(function(t,e){return{value:t,index:e}})).join(function(t){return t.append("line").attr("className","column").style("x1",function(t){return d+a*t.index}).style("y1",c).style("x2",function(t){return d+a*t.index}).style("y2",function(t){return c-l*t.value}).styles({y1:c,stroke:r,lineWidth:o})})},e}(s3),os=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{color:"#d8d9d9"}},e))||this;return n.showBackground=!1,n}return(0,tP.ZT)(e,t),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,s=this.lineWidth;(0,sq.Ys)(this.icon).maybeAppend(".split","line").styles({x1:e,y1:n-r/2,x2:e,y2:n+r/2,stroke:i,lineWidth:s})},e}(s3),oo=function(t){function e(){var e=t.apply(this,(0,tP.ev)([],(0,tP.CR)(arguments),!1))||this;return e.showBackground=!1,e}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,s$.j)(0)},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.iconSize,e=this.attributes,n=e.x,i=e.y,r=e.speed,s=(0,rP.Z)(this.attributes,["x","y","transform","transformOrigin","width","height","size","color","speed"]),o=(0,rh.Z)(t,20,1/0),a=(0,tP.pi)((0,tP.pi)({},s),{x:n-o/2,y:i-10,width:o,height:20,defaultValue:void 0===r?1:r,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:t/5,placeholderFontSize:t/2,optionPadding:0,optionLabelFontSize:t/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});(0,sq.Ys)(this.icon).maybeAppend(".speed",function(){return new s2({style:a})}).attr("className","speed").each(function(){this.update(a)})},e.tag="SpeedSelect",e}(s3),oa=function(t){function e(e){var n=t.call(this,e)||this;return n.icon=n.appendChild(new j.ZA({})),n.currentType=n.attributes.type,n}return(0,tP.ZT)(e,t),e.prototype.getType=function(){return this.currentType},e.prototype.render=function(){var t=this,e=this.attributes,n=(e.onChange,(0,tP._T)(e,["onChange"]));(0,sq.Ys)(this.icon).selectAll(".icon").data([this.currentType]).join(function(e){return e.append(function(e){var n,i=null===(n=t.toggles.find(function(t){return(0,tP.CR)(t,1)[0]===e}))||void 0===n?void 0:n[1];if(!i)throw Error("Invalid type: ".concat(e));return new i({})}).attr("className","icon").styles(n,!1).update({})},function(t){return t.styles({restStyles:n}).update({})},function(t){return t.remove()})},e.prototype.bindEvents=function(){var t=this,e=this.attributes.onChange;this.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var i=(t.toggles.findIndex(function(e){return(0,tP.CR)(e,1)[0]===t.currentType})+1)%t.toggles.length,r=t.toggles[i][0];null==e||e(t.currentType),t.currentType=r,t.render()})},e.tag="ToggleIcon",e}(sW.w),ol=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"play"}},e))||this;return n.toggles=[["play",s5],["pause",s7]],n}return(0,tP.ZT)(e,t),e}(oa),oh=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"range"}},e))||this;return n.toggles=[["range",ot],["value",oe]],n}return(0,tP.ZT)(e,t),e}(oa),od=function(t){function e(e){var n=t.call(this,(0,sH.n)({},{style:{type:"column"}},e))||this;return n.toggles=[["line",oi],["column",or]],n}return(0,tP.ZT)(e,t),e}(oa),oc={reset:s4,speed:oo,backward:s8,playPause:ol,forward:s9,selectionType:oh,chartType:od,split:os},ou=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.background=i.appendChild(new j.UL({})),i.functions=i.appendChild(new j.ZA({})),i}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,s$.j)(this.attributes.padding)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.style,e=t.x,n=t.y,i=t.width,r=t.height,s=(0,sY.zs)(this.attributes,"background");this.background.attr((0,tP.pi)({x:e,y:n,width:i,height:r},s))},e.prototype.renderFunctions=function(){var t,e=this,n=this.attributes,i=n.functions,r=n.iconSize,s=n.iconSpacing,o=n.x,a=n.y,l=n.width,h=n.height,d=n.align,c=(0,tP.CR)(this.padding,4),u=c[1],p=c[3],g=i.reduce(function(t,e){return t.length&&e.length?t.concat.apply(t,(0,tP.ev)(["split"],(0,tP.CR)(e),!1)):t.concat.apply(t,(0,tP.ev)([],(0,tP.CR)(e),!1))},[]),f=g.length*(r+s)-s,y={left:p+r/2,center:(l-f)/2+r/2,right:l-f-p-u+r/2}[d]||0;null===(t=this.speedSelect)||void 0===t||t.destroy(),this.functions.removeChildren(),g.forEach(function(t,n){var i,l=oc[t],d={x:o+n*(r+s)+y,y:a+h/2,size:r};if(l===oo?(d.speed=e.attributes.speed,d.onSelect=function(n){return e.handleFunctionChange(t,{value:n})}):[ol,oh,od].includes(l)?(d.onChange=function(n){return e.handleFunctionChange(t,{value:n})},l===ol&&(d.type="play"===e.attributes.state?"pause":"play"),l===oh&&(d.type="range"===e.attributes.selectionType?"value":"range"),l===od&&(d.type="line"===e.attributes.chartType?"column":"line")):d.onClick=function(){return e.handleFunctionChange(t,{value:t})},l===oo){var c=null===(i=e.ownerDocument)||void 0===i?void 0:i.defaultView;c&&(e.speedSelect=new l({style:(0,tP.pi)((0,tP.pi)({},d),{zIndex:100})}),c.appendChild(e.speedSelect))}else e.functions.appendChild(new l({style:d}))})},e.prototype.disconnectedCallback=function(){var e;t.prototype.disconnectedCallback.call(this),null===(e=this.speedSelect)||void 0===e||e.destroy()},e.prototype.render=function(){this.renderBackground(),this.renderFunctions()},e.prototype.handleFunctionChange=function(t,e){var n=this.attributes.onChange;null==n||n(t,e)},e.defaultOptions={style:{x:0,y:0,width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},e}(sW.w),op=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;return i.bindEvents(),i}return(0,tP.ZT)(e,t),e.prototype.bindEvents=function(){var t=this;this.addEventListener("mouseenter",function(){t.attr("lineWidth",Math.ceil(+(t.style.r||0)/2))}),this.addEventListener("mouseleave",function(){t.attr("lineWidth",0)})},e.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},e}(j.Cd),og=function(t){function e(n){return t.call(this,(0,sH.n)({},e.defaultOptions,n))||this}return(0,tP.ZT)(e,t),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,r=t.height,s=(0,sY.zs)(this.attributes,"background");(0,sq.Ys)(this).maybeAppend("background","rect").attr("className","background").styles((0,tP.pi)({x:e-i/2,y:n-r/2,width:i,height:r},s))},e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.iconSize,r=(0,sY.zs)(this.attributes,"icon"),s=i/2;(0,sq.Ys)(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles((0,tP.pi)({x1:e-1,y1:n-s,x2:e-1,y2:n+s},r)),(0,sq.Ys)(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles((0,tP.pi)({x1:e+1,y1:n-s,x2:e+1,y2:n+s},r))},e.prototype.renderBorder=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,r=t.height,s=t.type,o=(0,sY.zs)(this.attributes,"border"),a="start"===s?+i/2:-i/2;(0,sq.Ys)(this).maybeAppend("border","line").attr("className","border").styles((0,tP.pi)({x1:a+e,y1:n-r/2,x2:a+e,y2:n+r/2},o))},e.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},e.defaultOptions={style:{x:0,y:0,width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},e}(sW.w);function of(t){var e=String(Math.floor(t/3600)).padStart(2,"0"),n=String(Math.floor(t%3600/60)).padStart(2,"0"),i=String(Math.floor(t%60)).padStart(2,"0");return t<3600?"".concat(n,":").concat(i):"".concat(e,":").concat(n,":").concat(i)}var oy=function(t){function e(n){var i=t.call(this,(0,sH.n)({},e.defaultOptions,n))||this;i.axis=i.appendChild(new sK.R({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),i.timeline=i.appendChild(new sX.i({style:{onChange:function(t){i.handleSliderChange(t)}}})),i.controller=i.appendChild(new ou({})),i.states={},i.handleSliderChange=function(t){var e,n=Array.isArray(e=i.states.values)?(0,tP.ev)([],(0,tP.CR)(e),!1):e;i.setBySliderValues(t),i.dispatchOnChange(n)};var r=i.attributes,s=r.selectionType,o=r.chartType,a=r.speed,l=r.state,h=r.playMode,d=r.values;return i.states={chartType:o,playMode:h,selectionType:s,speed:a,state:l},i.setByTimebarValues(d),i}return(0,tP.ZT)(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.data.sort(function(t,e){return t.time<e.time?-1:t.time>e.time?1:0})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"space",{get:function(){var t,e=this.attributes,n=e.x,i=e.y,r=e.width,s=e.height,o=e.type,a=e.controllerHeight,l=(0,rh.Z)(+s-a,0,+s),h=new sG.b(n,i+ +s-a,+r,a),d=0;"chart"===o?(d=35,t=new sG.b(n,i+l-d,+r,d)):t=new sG.b;var c="time"===o?10:l;return{axisBBox:t,controllerBBox:h,timelineBBox:new sG.b(n,i+("time"===o?l:l-c),+r,c-d)}},enumerable:!1,configurable:!0}),e.prototype.setBySliderValues=function(t){var e,n,i=this.data,r=(0,tP.CR)(Array.isArray(t)?t:[0,t],2),s=r[0],o=r[1],a=i.length,l=i[Math.floor(s*a)],h=i[Math.ceil(o*a)-(Array.isArray(t)?0:1)];this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:i[0].time,null!==(n=null==h?void 0:h.time)&&void 0!==n?n:1/0]},e.prototype.setByTimebarValues=function(t){var e,n,i,r=this.data,s=(0,tP.CR)(Array.isArray(t)?t:[void 0,t],2),o=s[0],a=s[1],l=r.find(function(t){return t.time===o}),h=r.find(function(t){return t.time===a});this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:null===(n=r[0])||void 0===n?void 0:n.time,null!==(i=null==h?void 0:h.time)&&void 0!==i?i:1/0]},e.prototype.setByIndex=function(t){var e,n,i,r,s=this.data,o=(0,tP.CR)(t,2),a=o[0],l=o[1];this.states.values=[null!==(n=null===(e=s[a])||void 0===e?void 0:e.time)&&void 0!==n?n:s[0].time,null!==(r=null===(i=this.data[l])||void 0===i?void 0:i.time)&&void 0!==r?r:1/0]},Object.defineProperty(e.prototype,"sliderValues",{get:function(){var t,e=this.states,n=e.values,i=e.selectionType,r=(0,tP.CR)(Array.isArray(n)?n:[void 0,n],2),s=r[0],o=r[1],a=this.data,l=a.length,h="value"===i;return[(t=a.findIndex(function(t){return t.time===s}),h?0:t>-1?t/l:0),function(){if(o===1/0)return 1;var t=a.findIndex(function(t){return t.time===o});return t>-1?t/l:h?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){var t=this.states,e=t.values,n=t.selectionType,i=(0,tP.CR)(Array.isArray(e)?e:[this.data[0].time,e],2),r=i[0],s=i[1];return"value"===n?s:[r,s]},enumerable:!1,configurable:!0}),e.prototype.getDatumByRatio=function(t){var e=this.data,n=e.length;return e[Math.floor(t*(n-1))]},Object.defineProperty(e.prototype,"chartHandleIconShape",{get:function(){var t=this.states.selectionType,e=this.space.timelineBBox.height;return"range"===t?function(t){return new og({style:{type:t,height:e,iconSize:e/6}})}:function(){return new j.x1({style:{x1:0,y1:-e/2,x2:0,y2:e/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),e.prototype.getChartStyle=function(t){var e=this,n=t.x,i=t.y,r=t.width,s=t.height,o=this.states,a=o.selectionType,l=o.chartType,h=this.data,d=this.attributes,c=d.type,u=d.labelFormatter,p=(0,sY.zs)(this.attributes,"chart"),g=(p.type,(0,tP._T)(p,["type"])),f="range"===a;if("time"===c)return(0,tP.pi)({handleIconShape:function(){return new op({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:f?-15:0,autoFitLabel:f,handleSpacing:f?-15:0,trackFill:"#edeeef",trackLength:r,trackOpacity:.5,trackRadius:s/2,trackSize:s/2,type:a,values:this.sliderValues,formatter:function(t){if(u)return u(t);var n=e.getDatumByRatio(t).time;return"number"==typeof n?of(n):sU(n,"YYYY-MM-DD HH:mm:ss")},transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g);var y=h.map(function(t){return t.value});return(0,tP.pi)({handleIconOffset:"range"===a?5:0,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData:y,sparklineType:l,sparklineScale:.8,trackLength:r,trackSize:s,type:a,values:this.sliderValues,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g)},e.prototype.renderChart=function(t){void 0===t&&(t=this.space.timelineBBox),this.timeline.update(this.getChartStyle(t))},e.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},e.prototype.getAxisStyle=function(t){var e=this.data,n=this.attributes,i=n.interval,r=n.labelFormatter,s=(0,sY.zs)(this.attributes,"axis"),o=t.x,a=t.y,l=t.width,h=(0,tP.ev)((0,tP.ev)([],(0,tP.CR)(e),!1),[{time:0}],!1).map(function(t,e,n){var i=t.time;return{label:"".concat(i),value:e/(n.length-1),time:i}});return(0,tP.pi)({startPos:[o,a],endPos:[o+l,a],data:h,labelFilter:function(t,e){return e<h.length-1},labelFormatter:function(t){var e=t.time;return r?r(e):"number"==typeof e?of(e):function(t,e){var n=new Date(t);switch(e){case"half-hour":case"hour":case"four-hour":if([0,6,12,18].includes(n.getHours())&&0===n.getMinutes())return sU(n,"HH:mm\nYYYY-MM-DD");return sU(n,"HH:mm");case"half-day":if(12>n.getHours())return"AM\n".concat(sU(n,"YYYY-MM-DD"));return"PM";case"day":if([1,10,20].includes(n.getDate()))return sU(n,"DD\nYYYY-MM");return sU(n,"DD");case"week":if(7>=n.getDate())return sU(n,"DD\nYYYY-MM");return sU(n,"DD");case"month":if([0,6].includes(n.getMonth()))return sU(n,"MM\nYYYY");return sU(n,"MM");case"season":if([0].includes(n.getMonth()))return sU(n,"MM\nYYYY");return sU(n,"MM");case"year":return sU(n,"YYYY");default:return sU(n,"YYYY-MM-DD HH:mm")}}(e,i)}},s)},e.prototype.renderAxis=function(t){void 0===t&&(t=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(t))},e.prototype.renderController=function(t){void 0===t&&(t=this.space.controllerBBox);var e=this.attributes.type,n=this.states,i=n.state,r=n.speed,s=n.selectionType,o=n.chartType,a=(0,sY.zs)(this.attributes,"controller"),l=this,h=(0,tP.pi)((0,tP.pi)((0,tP.pi)({},t),{iconSize:20,speed:r,state:i,selectionType:s,chartType:o,onChange:function(t,e){var n=e.value;switch(t){case"reset":l.internalReset();break;case"speed":l.handleSpeedChange(n);break;case"backward":l.internalBackward();break;case"playPause":"play"===n?l.internalPlay():l.internalPause();break;case"forward":l.internalForward();break;case"selectionType":l.handleSelectionTypeChange(n);break;case"chartType":l.handleChartTypeChange(n)}}}),a);"time"===e&&(h.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(h)},e.prototype.dispatchOnChange=function(t){var e=this.data,n=this.attributes.onChange,i=this.states,r=i.values,s=i.selectionType,o=(0,tP.CR)(r,2),a=o[0],l=o[1],h=l===1/0?e.at(-1).time:l,d="range"===s?[a,h]:h;(!t||(Array.isArray(t)?!Array.isArray(d)||t[0]!==d[0]||t[1]!==d[1]&&t[1]!==1/0&&d[1]!==1/0:Array.isArray(d)||t!==d))&&null!=n&&n("range"===s?[a,h]:h)},e.prototype.internalReset=function(t){var e,n,i=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===i?[0,1]:[0,0]),this.renderController(),this.updateSelection(),t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onReset)||void 0===n||n.call(e),this.dispatchOnChange())},e.prototype.reset=function(){this.internalReset()},e.prototype.moveSelection=function(t,e){var n,i,r,s,o,a,l=this.data,h=l.length,d=this.states,c=d.values,u=d.selectionType,p=d.playMode,g=(0,tP.CR)(c,2),f=g[0],y=g[1],m=l.findIndex(function(t){return t.time===f}),v=l.findIndex(function(t){return t.time===y});-1===v&&(v=h);var b="backward"===t?-1:1;"range"===u?"acc"===p?(a=[m,v+b],-1===b&&m===v&&(a=[m,h])):a=[m+b,v+b]:a=[m,v+b];var E=(n=a,r=(i=(0,tP.CR)(n.sort(function(t,e){return t-e}),2))[0],s=i[1],o=function(t){return(0,rh.Z)(t,0,h)},s>h?"value"===u?[0,0]:"acc"===p?[o(r),o(r)]:[0,o(s-r)]:r<0?"acc"===p?[0,o(s)]:[o(r+h-s),h]:[o(r),o(s)]);return this.setByIndex(E),this.updateSelection(),E},e.prototype.internalBackward=function(t){var e,n,i=this.moveSelection("backward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onBackward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.backward=function(){this.internalBackward()},e.prototype.internalPlay=function(t){var e,n,i=this,r=this.data,s=this.attributes.loop,o=this.states.speed,a=void 0===o?1:o;this.playInterval=window.setInterval(function(){i.internalForward()[1]!==r.length||s||(i.internalPause(),i.renderController())},1e3/a),this.states.state="play",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPlay)||void 0===n||n.call(e)},e.prototype.play=function(){this.internalPlay()},e.prototype.internalPause=function(t){var e,n;clearInterval(this.playInterval),this.states.state="pause",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPause)||void 0===n||n.call(e)},e.prototype.pause=function(){this.internalPause()},e.prototype.internalForward=function(t){var e,n,i=this.moveSelection("forward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onForward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.forward=function(){this.internalForward()},e.prototype.handleSpeedChange=function(t){var e,n;this.states.speed=t,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSpeedChange)||void 0===n||n.call(e,t)},e.prototype.handleSelectionTypeChange=function(t){var e,n;this.states.selectionType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSelectionTypeChange)||void 0===n||n.call(e,t)},e.prototype.handleChartTypeChange=function(t){var e,n;this.states.chartType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onChartTypeChange)||void 0===n||n.call(e,t)},e.prototype.render=function(){var t=this.space,e=t.axisBBox,n=t.controllerBBox,i=t.timelineBBox;this.renderController(n),this.renderAxis(e),this.renderChart(i),"play"===this.states.state&&this.internalPlay()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.internalPause(!0)},e.defaultOptions={style:{x:0,y:0,axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},e}(sW.w),om=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};let ov=["timestamp","time","date","datetime"];class ob extends rk{get padding(){return tg(this.options.padding)}play(){var t;null===(t=this.timebar)||void 0===t||t.play()}pause(){var t;null===(t=this.timebar)||void 0===t||t.pause()}forward(){var t;null===(t=this.timebar)||void 0===t||t.forward()}backward(){var t;null===(t=this.timebar)||void 0===t||t.backward()}reset(){var t;null===(t=this.timebar)||void 0===t||t.reset()}update(t){super.update(t),this.backup(),this.upsertTimebar()}backup(){this.originalData=oE(this.context.graph.getData())}upsertTimebar(){let{canvas:t}=this.context,e=this.options,{onChange:n,timebarType:i,data:r,x:s,y:o,width:a,height:l,mode:h}=e,d=om(e,["onChange","timebarType","data","x","y","width","height","mode"]),c=t.getSize(),[u]=this.padding;this.upsertCanvas().ready.then(()=>{var t;let e=Object.assign(Object.assign({x:c[0]/2-a/2,y:u,onChange:t=>{let e=((0,ta.Z)(t)?t:[t,t]).map(t=>t instanceof Date?t.getTime():t);"modify"===this.options.mode?this.filterElements(e):this.hiddenElements(e),null==n||n(e)}},d),{data:r.map(t=>(0,Q.Z)(t)?{time:t,value:0}:t),width:a,height:l,type:i});this.timebar?this.timebar.update(e):(this.timebar=new oy({style:e}),null===(t=this.canvas)||void 0===t||t.appendChild(this.timebar))})}upsertCanvas(){if(this.canvas)return this.canvas;let{className:t,height:e,position:n}=this.options,i=this.context.canvas,[r]=i.getSize(),[s,,o]=this.padding,[a,l]=sP({width:r,height:e+s+o,graphCanvas:i,className:"timebar",placement:n});return this.container=a,t&&a.classList.add(t),this.canvas=l,this.canvas}filterElements(t){var e,n,i,r;return e=this,n=void 0,i=void 0,r=function*(){var e;if(!this.originalData)return;let{elementTypes:n,getTime:i}=this.options,{graph:r,element:s}=this.context,o=oE(this.originalData);n.forEach(e=>{let n="".concat(e,"s");o[n]=(this.originalData[n]||[]).filter(e=>{let n=i(e);return!!ox(n,t)})});let a=[...o.nodes,...o.combos].map(t=>t6(t));o.edges=o.edges.filter(t=>{let e=t.source,n=t.target;return a.includes(e)&&a.includes(n)}),r.setData(o),yield null===(e=s.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished},new(i||(i=Promise))(function(t,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(t){t(n)})).then(o,a)}l((r=r.apply(e,n||[])).next())})}hiddenElements(t){let{graph:e}=this.context,{elementTypes:n,getTime:i}=this.options,r=[],s=[];n.forEach(e=>{var n;let o=(null===(n=this.originalData)||void 0===n?void 0:n["".concat(e,"s")])||[];o.forEach(e=>{let n=t6(e),o=i(e);ox(o,t)?s.push(n):r.push(n)})}),e.hideElement(r,!1),e.showElement(s,!1)}destroy(){var t,e,n;let{graph:i}=this.context;this.originalData&&i.setData(Object.assign({},this.originalData)),null===(t=this.timebar)||void 0===t||t.destroy(),null===(e=this.canvas)||void 0===e||e.destroy(),null===(n=this.container)||void 0===n||n.remove(),this.originalData=void 0,this.container=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}constructor(t,e){super(t,Object.assign({},ob.defaultOptions,e)),this.backup(),this.upsertTimebar()}}ob.defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],padding:10,mode:"modify",getTime:t=>oO(t,ov,void 0),loop:!1};let oE=t=>{let{nodes:e=[],edges:n=[],combos:i=[]}=t;return{nodes:[...e],edges:[...n],combos:[...i]}},ox=(t,e)=>{if((0,Q.Z)(e))return t===e;let[n,i]=e;return t>=n&&t<=i},oO=(t,e,n)=>{var i;for(let n=0;n<e.length;n++){let r=e[n],s=null===(i=t.data)||void 0===i?void 0:i[r];if(s)return s}return n};var ow=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class oS extends rk{update(t){let e=Object.create(null,{update:{get:()=>super.update}});return ow(this,void 0,void 0,function*(){e.update.call(this,t);let{className:n,position:i,style:r}=this.options;this.$element.className="g6-toolbar ".concat(n||""),Object.assign(this.$element.style,r,function(t){let e={top:"unset",right:"unset",bottom:"unset",left:"unset"},n=t.split("-");return n.forEach(t=>{e[t]="8px"}),e.flexDirection=t.startsWith("top")||t.startsWith("bottom")?"row":"column",e}(i)),this.$element.innerHTML=yield this.getDOMContent()})}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}getDOMContent(){return ow(this,void 0,void 0,function*(){let t=yield this.options.getItems();return t.map(t=>'\n          <div class="g6-toolbar-item" value="'.concat(t.value,'">\n            <svg aria-hidden="true" focusable="false">\n              <use xlink:href="#').concat(t.id,'"></use>\n            </svg>\n          </div>')).join("")})}constructor(t,e){super(t,Object.assign({},oS.defaultOptions,e)),this.$element=rN("toolbar",!1),this.onToolbarItemClick=t=>{let{onClick:e}=this.options;if(t.target instanceof Element&&t.target.className.includes("g6-toolbar-item")){let n=t.target.getAttribute("value");null==e||e(n,t.target)}};let n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),rj("g6-toolbar-css","style",{},"\n  .g6-toolbar {\n    position: absolute;\n    z-index: 100;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);\n    opacity: 0.65;\n  }\n  .g6-toolbar .g6-toolbar-item {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    padding: 4px;\n    cursor: pointer;\n    box-sizing: content-box;\n  }\n\n  .g6-toolbar .g6-toolbar-item:hover {\n    background-color: #f0f0f0;\n  }\n\n  .g6-toolbar .g6-toolbar-item svg {\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n",document.head),rj("g6-toolbar-svgicon","div",{display:"none"},'\n  <svg>\n    <symbol id="zoom-in" viewBox="64 64 896 896">\n      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="zoom-out" viewBox="64 64 896 896">\n      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="edit" viewBox="64 64 896 896">\n      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>\n    </symbol>\n    <symbol id="delete" viewBox="64 64 896 896">\n      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>\n    </symbol>\n    <symbol id="redo" viewBox="64 64 896 896">\n      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>\n    </symbol>\n    <symbol id="undo" viewBox="64 64 896 896">\n      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>\n    </symbol>\n    <symbol id="export" viewBox="64 64 896 896">\n      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>\n    </symbol>\n    <symbol id="auto-fit" viewBox="64 64 896 896">\n      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>\n      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>\n    </symbol>\n    <symbol id="reset" viewBox="64 64 896 896">\n      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>\n    </symbol>\n    <symbol id="exit-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M418.13333333 361.43786666c0 0.2048-0.13653333 0.4096-0.13653334 0.68266667C417.99679999 362.32533333 418.13333333 362.53013333 418.13333333 362.73493333 418.13333333 371.54133333 414.44693333 379.392 408.78079999 385.39946666 408.43946666 385.7408 408.30293333 386.21866666 408.02986666 386.49173333c-1.09226667 1.09226667-2.59413333 1.77493333-3.82293333 2.73066667C398.40426666 393.65973333 391.64586666 396.8 383.93173333 396.8 383.72693333 396.8 383.59039999 396.73173333 383.38559999 396.73173333S382.97599999 396.8 382.77119999 396.8L112.29866666 396.8C92.50133333 396.8 76.79999999 381.50826666 76.79999999 362.66666666 76.66346666 343.89333333 92.63786666 328.53333333 112.16213333 328.53333333l189.44 0L87.44959999 114.51733333C73.59146666 100.59093333 73.25013333 78.5408 86.63039999 65.29706666c13.17546667-13.44853333 35.36213333-12.97066667 49.152 0.88746667l214.08426667 214.08426667L349.86666666 90.89706666C349.79839999 71.23626666 365.22666666 55.46666666 383.99999999 55.46666666 402.77333333 55.33013333 418.13333333 71.30453333 418.13333333 90.8288L418.13333333 361.43786666zM928.90453333 328.53333333l-189.44 0 214.15253333-214.08426667c13.85813333-13.9264 14.19946667-35.90826667 0.88746667-49.22026666-13.17546667-13.44853333-35.36213333-12.97066667-49.152 0.88746666l-214.08426667 214.08426667L691.26826666 90.89706666C691.26826666 71.23626666 675.83999999 55.46666666 657.06666666 55.46666666 638.29333333 55.33013333 622.93333333 71.30453333 622.93333333 90.8288l0 270.60906666c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 362.32533333 622.93333333 362.53013333 622.93333333 362.73493333 622.93333333 371.54133333 626.61973333 379.392 632.28586666 385.39946666c0.34133333 0.34133333 0.47786667 0.8192 0.8192 1.09226667 1.09226667 1.09226667 2.59413333 1.77493333 3.8912 2.73066667C642.66239999 393.65973333 649.42079999 396.8 657.13493333 396.8c0.2048 0 0.34133333-0.06826667 0.54613333-0.06826667S658.09066666 396.8 658.29546666 396.8l270.5408 0C948.56533333 396.8 964.26666666 381.50826666 964.26666666 362.66666666 964.40319999 343.89333333 948.42879999 328.53333333 928.90453333 328.53333333zM418.13333333 635.73333333c0-8.8064-3.6864-16.5888-9.35253334-22.66453333C408.43946666 612.72746666 408.30293333 612.2496 408.02986666 611.90826666 406.86933333 610.88426666 405.43573333 610.2016 404.20693333 609.24586666 398.47253333 604.80853333 391.64586666 601.6 383.93173333 601.6 383.72693333 601.6 383.59039999 601.73653333 383.38559999 601.73653333S382.97599999 601.6 382.77119999 601.6L112.29866666 601.6C92.50133333 601.6 76.79999999 616.96 76.79999999 635.73333333 76.66346666 654.50666666 92.63786666 669.86666666 112.16213333 669.86666666l189.44 0-214.15253334 214.15253334c-13.85813333 13.85813333-14.19946667 35.84-0.88746666 49.22026666 13.17546667 13.44853333 35.36213333 12.9024 49.152-0.95573333l214.08426666-214.08426667 0 189.37173334c0 19.59253333 15.42826667 35.49866667 34.2016 35.36213333C402.77333333 943.2064 418.13333333 927.232 418.13333333 907.5712L418.13333333 637.09866666c0-0.27306667-0.13653333-0.47786667-0.13653334-0.68266666C417.99679999 636.14293333 418.13333333 635.93813333 418.13333333 635.73333333zM739.46453333 669.86666666l189.44 0c19.456 0 35.49866667-15.36 35.36213333-34.13333333C964.26666666 616.96 948.56533333 601.6 928.76799999 601.6L658.29546666 601.6C658.09066666 601.6 657.88586666 601.73653333 657.68106666 601.73653333S657.33973333 601.6 657.13493333 601.6C649.42079999 601.6 642.59413333 604.80853333 636.85973333 609.24586666 635.63093333 610.2016 634.19733333 610.88426666 633.03679999 611.90826666 632.76373333 612.2496 632.62719999 612.72746666 632.28586666 613.0688 626.61973333 619.14453333 622.93333333 626.92693333 622.93333333 635.73333333c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 636.6208 622.93333333 636.8256 622.93333333 637.09866666l0 270.5408C622.93333333 927.232 638.29333333 943.2064 657.06666666 942.93333333c18.77333333 0.13653333 34.2016-15.70133333 34.2016-35.36213333l0-189.37173334 214.08426667 214.08426667c13.78986667 13.85813333 35.90826667 14.40426667 49.152 0.95573333 13.312-13.312 12.97066667-35.36213333-0.88746667-49.22026666L739.46453333 669.86666666z"  ></path></symbol>\n    <symbol id="request-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M69.818182 87.598545v273.128728a34.909091 34.909091 0 0 0 69.818182 0V163.653818l221.928727 222.021818a33.512727 33.512727 0 0 0 47.383273-47.383272L186.926545 116.363636h197.073455a34.909091 34.909091 0 0 0 0-69.818181H110.871273C85.364364 46.545455 69.818182 59.671273 69.818182 87.598545zM938.542545 46.545455H665.413818a34.909091 34.909091 0 0 0 0 69.818181h197.073455L640.465455 338.292364a33.512727 33.512727 0 0 0 47.383272 47.383272l221.928728-222.021818v197.073455a34.909091 34.909091 0 0 0 69.818181 0V87.598545c0-27.927273-15.453091-41.053091-40.96-41.05309z m-827.671272 907.636363h273.128727a34.909091 34.909091 0 0 0 0-69.818182H186.926545l222.021819-221.928727a33.512727 33.512727 0 0 0-47.383273-47.383273L139.636364 837.073455V640a34.909091 34.909091 0 0 0-69.818182 0v273.128727c0 27.927273 15.546182 41.053091 41.053091 41.053091z m868.724363-41.053091V640a34.909091 34.909091 0 0 0-69.818181 0v197.073455L687.941818 615.051636a33.512727 33.512727 0 0 0-47.383273 47.383273L862.487273 884.363636H665.413818a34.909091 34.909091 0 0 0 0 69.818182h273.128727c25.6 0 41.053091-13.125818 41.053091-41.053091z"  ></path></symbol>\n  </svg>\n'),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}}oS.defaultOptions={position:"top-left"};var oD=n(72101),oC=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class oM extends rk{getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){var e;this.unbindEvents(),super.update(t),this.tooltipElement&&(null===(e=this.container)||void 0===e||e.removeChild(this.tooltipElement.HTMLTooltipElement)),this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){let{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.off(n,e[n])})}bindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.on(n,e[n])})}get tooltipStyleProps(){let{canvas:t}=this.context,{center:e}=t.getBounds(),n=t.getContainer(),{top:i,left:r}=n.getBoundingClientRect(),{style:s,position:o,enterable:a,container:l={x:-r,y:-i},title:h,offset:d}=this.options,[c,u]=e,[p,g]=t.getSize();return{x:c,y:u,container:l,title:h,bounding:{x:0,y:0,width:p,height:g},position:o,enterable:a,offset:d,style:s}}destroy(){var t;this.unbindEvents(),this.tooltipElement&&(null===(t=this.container)||void 0===t||t.removeChild(this.tooltipElement.HTMLTooltipElement)),super.destroy()}constructor(t,e){super(t,Object.assign({},oM.defaultOptions,e)),this.currentTarget=null,this.tooltipElement=null,this.container=null,this.isEnable=(t,e)=>{let{enable:n}=this.options;return"function"==typeof n?n(t,e):n},this.onClick=t=>{let{target:{id:e}}=t;this.currentTarget===e?this.hide(t):this.show(t)},this.onPointerMove=t=>{let{target:e}=t;this.currentTarget&&e.id!==this.currentTarget&&this.show(t)},this.onPointerLeave=t=>{this.hide(t)},this.onCanvasMove=t=>{this.hide(t)},this.onPointerEnter=t=>{this.show(t)},this.showById=t=>oC(this,void 0,void 0,function*(){yield this.show({target:{id:t}})}),this.getElementData=(t,e)=>{let{model:n}=this.context;switch(e){case"node":return n.getNodeData([t]);case"edge":return n.getEdgeData([t]);case"combo":return n.getComboData([t]);default:return[]}},this.show=t=>oC(this,void 0,void 0,function*(){var e,n;let i,r;let{client:s,target:{id:o}}=t;if(iX(t.target))return;let a=this.context.graph.getElementType(o),{getContent:l,title:h}=this.options,d=this.getElementData(o,a);if(!this.tooltipElement||!this.isEnable(t,d))return;let c={};if(l){if(c.content=yield l(t,d),!c.content)return}else{let t=this.context.graph.getElementRenderStyle(o),e="node"===a?t.fill:t.stroke;c={title:h||a,data:d.map(t=>({name:"ID",value:t.id||"".concat(t.source," -> ").concat(t.target),color:e}))}}if(this.currentTarget=o,s)i=s.x,r=s.y;else{let t=(0,e0.Z)(d,"0.style",{x:0,y:0});i=t.x,r=t.y}null===(n=(e=this.options).onOpenChange)||void 0===n||n.call(e,!0),this.tooltipElement.update(Object.assign(Object.assign(Object.assign({},this.tooltipStyleProps),{x:i,y:r,style:{".tooltip":{visibility:"visible"}}}),c))}),this.hide=t=>{var e,n,i,r,s;if(!t){null===(n=(e=this.options).onOpenChange)||void 0===n||n.call(e,!1),null===(i=this.tooltipElement)||void 0===i||i.hide(),this.currentTarget=null;return}if(!this.tooltipElement||!this.currentTarget)return;let{client:{x:o,y:a}}=t;null===(s=(r=this.options).onOpenChange)||void 0===s||s.call(r,!1),this.tooltipElement.hide(o,a),this.currentTarget=null},this.initTooltip=()=>{var t;let e=new oD.u({className:"tooltip",style:this.tooltipStyleProps});return null===(t=this.container)||void 0===t||t.appendChild(e.HTMLTooltipElement),e},this.render(),this.bindEvents()}}oM.defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};var oT=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};function oA(t,e){i||(i=document.createElement("canvas")),i.width=t,i.height=e;let n=i.getContext("2d");return n.clearRect(0,0,t,e),i}var oL=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class oR extends rk{update(t){var e,n,i,r;let s=Object.create(null,{update:{get:()=>super.update}});return e=this,n=void 0,i=void 0,r=function*(){s.update.call(this,t);let e=this.options,{width:n,height:i,text:r,imageURL:o}=e,a=oL(e,["width","height","text","imageURL"]);Object.keys(a).forEach(e=>{e.startsWith("background")&&(this.$element.style[e]=t[e])});let l=o?yield function(t,e,n,i){return oT(this,void 0,void 0,function*(){let r=oA(t,e),s=r.getContext("2d"),{rotate:o,opacity:a}=i;o&&s.rotate(o),a&&(s.globalAlpha=a);let l=new Image;return l.crossOrigin="anonymous",l.src=n,new Promise(n=>{l.onload=function(){let i=t>l.width?(t-l.width)/2:0,o=e>l.height?(e-l.height)/2:0;s.drawImage(l,0,0,l.width,l.height,i,o,t-2*i,e-2*o),n(r.toDataURL())}})})}(n,i,o,a):yield function(t,e,n,i){return oT(this,void 0,void 0,function*(){let r=oA(t,e),s=r.getContext("2d"),{rotate:o,opacity:a,textFill:l,textFontSize:h,textFontFamily:d,textFontVariant:c,textFontWeight:u,textAlign:p,textBaseline:g}=i;return s.textAlign=p,s.textBaseline=g,s.translate(t/2,e/2),s.font="".concat(h,"px ").concat(d," ").concat(c," ").concat(u),o&&s.rotate(o),a&&(s.globalAlpha=a),l&&(s.fillStyle=l,s.fillText("".concat(n),0,0)),r.toDataURL()})}(n,i,r,a);this.$element.style.backgroundImage="url(".concat(l,")")},new(i||(i=Promise))(function(t,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(t){t(n)})).then(o,a)}l((r=r.apply(e,n||[])).next())})}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},oR.defaultOptions,e)),this.$element=rN("watermark");let n=this.context.canvas.getContainer();n.appendChild(this.$element),this.update(e)}}oR.defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};let oP=["#7E92B5","#F4664A","#FFBE3A"],ok={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},oN={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function oj(t){let{bgColor:e,textColor:n,nodeColor:i,nodeColorDisabled:r,nodeStroke:s,nodeHaloStrokeOpacityActive:o=.15,nodeHaloStrokeOpacitySelected:a=.25,nodeOpacityDisabled:l=.06,nodeIconOpacityInactive:h=.85,nodeOpacityInactive:d=.25,nodeBadgePalette:c=oP,nodePaletteOptions:u=ok,edgeColor:p,edgeColorDisabled:g,edgePaletteOptions:f=oN,comboColor:y,comboColorDisabled:m,comboStroke:v,comboStrokeDisabled:b,edgeColorInactive:E}=t;return{background:e,node:{palette:u,style:{donutOpacity:1,badgeBackgroundOpacity:1,badgeFill:"#fff",badgeFontSize:8,badgePadding:[0,4],badgePalette:c,fill:i,fillOpacity:1,halo:!1,iconFill:"#fff",iconOpacity:1,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelFill:n,labelFillOpacity:.85,labelLineHeight:16,labelPadding:[0,2],labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelOffsetY:2,lineWidth:0,portFill:i,portLineWidth:1,portStroke:s,portStrokeOpacity:.65,size:32,stroke:s,strokeOpacity:1,zIndex:2},state:{selected:{halo:!0,haloLineWidth:24,haloStrokeOpacity:a,labelFontSize:12,labelFontWeight:"bold",lineWidth:4,stroke:s},active:{halo:!0,haloLineWidth:12,haloStrokeOpacity:o},highlight:{labelFontWeight:"bold",lineWidth:4,stroke:s,strokeOpacity:.85},inactive:{badgeBackgroundOpacity:d,donutOpacity:d,fillOpacity:d,iconOpacity:h,labelFill:n,labelFillOpacity:d,strokeOpacity:d},disabled:{badgeBackgroundOpacity:.25,donutOpacity:l,fill:r,fillOpacity:l,iconFill:r,iconOpacity:.25,labelFill:n,labelFillOpacity:.25,strokeOpacity:l}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}],translate:[{fields:["x","y"]}]}},edge:{palette:f,style:{badgeBackgroundFill:p,badgeFill:"#fff",badgeFontSize:8,badgeOffsetX:10,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:1,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:p,strokeOpacity:1,zIndex:1},state:{selected:{halo:!0,haloStrokeOpacity:.25,labelFontSize:14,labelFontWeight:"bold",lineWidth:3},active:{halo:!0,haloStrokeOpacity:.15},highlight:{labelFontWeight:"bold",lineWidth:3},inactive:{stroke:E,fillOpacity:.08,labelOpacity:.25,strokeOpacity:.08,badgeBackgroundOpacity:.25},disabled:{stroke:g,fillOpacity:.45,strokeOpacity:.45,labelOpacity:.25,badgeBackgroundOpacity:.45}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}],translate:[{fields:["sourceNode","targetNode"]}]}},combo:{style:{collapsedMarkerFill:e,collapsedMarkerFontSize:12,collapsedMarkerFillOpacity:1,collapsedSize:32,collapsedFillOpacity:1,fill:y,halo:!1,haloLineWidth:12,haloStroke:v,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:.04,strokeOpacity:1,padding:10,stroke:v},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:m,fillOpacity:.25,labelOpacity:.25,stroke:b,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}],translate:[{fields:["x","y"]}]}}}}let oI=oj({bgColor:"#000000",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696",edgeColor:"#637088",edgeColorDisabled:"#637088",edgeColorInactive:"#D0E4FF",edgePaletteOptions:{type:"group",color:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"]},nodeColor:"#1783ff",nodeColorDisabled:"#D0E4FF",nodeHaloStrokeOpacityActive:.25,nodeHaloStrokeOpacitySelected:.45,nodeIconOpacityInactive:.45,nodeOpacityDisabled:.25,nodeOpacityInactive:.45,nodeStroke:"#d0e4ff",textColor:"#ffffff"}),oB=oj({bgColor:"#ffffff",comboColor:"#99ADD1",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",edgeColorInactive:"#1B324F",nodeColor:"#1783ff",nodeColorDisabled:"#1B324F",nodeHaloStrokeOpacityActive:.15,nodeHaloStrokeOpacitySelected:.25,nodeIconOpacityInactive:.85,nodeOpacityDisabled:.06,nodeOpacityInactive:.25,nodeStroke:"#000000",textColor:"#000000"});class oF extends ea{beforeDraw(t,e){return t}afterLayout(t,e){}}function o_(t,e,n,i,r){let s=t6(i),o="".concat(n,"s"),a=r?i:t.add[o].get(s)||t.update[o].get(s)||t.remove[o].get(s)||i;Object.entries(t).forEach(t=>{let[n,i]=t;e===n?i[o].set(s,a):i[o].delete(s)})}function oz(t,e){return Object.keys(t).every(n=>t[n]===e[n])}let oZ=(t,e,n,i)=>{let r="".concat(n,"s"),s=t6(i);t.add[r].has(s)||t.update[r].has(s)||t[e][r].set(t6(i),i)};new WeakMap;let oV=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if("object"!=typeof t||"object"!=typeof e)return t===e;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let r of i){let i=t[r],s=e[r];if(n>1&&"object"==typeof i&&"object"==typeof s){if(!oV(i,s,n-1))return!1}else if(i!==s)return!1}return!0};var oW=n(82985),oH=n(7881),oG=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})},oY=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};let oU=["main"],oK=["background","main","label","transient"];class oX{getConfig(){return this.config}getLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.extends.layers[t]||this.getLayers().main}getLayers(){return this.extends.layers}getRenderer(t){return this.extends.renderers[t]}getCamera(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getCamera()}getRoot(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getRoot()}getContextService(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getContextService()}setCursor(t){this.config.cursor=t,this.getLayer().setCursor(t)}get document(){return this.getLayer().document}get context(){return this.getLayer().context}get ready(){return Promise.all(Object.entries(this.getLayers()).map(t=>{let[,e]=t;return e.ready}))}resize(t,e){Object.assign(this.extends.config,{width:t,height:e}),Object.values(this.getLayers()).forEach(n=>{let i=n.getCamera(),r=i.getPosition(),s=i.getFocalPoint();n.resize(t,e),i.setPosition(r),i.setFocalPoint(s)})}getBounds(t){return tx(Object.values(this.getLayers()).map(e=>{let n=t?e.getRoot().childNodes.find(e=>e.classList.includes(t)):e.getRoot();return n}).filter(t=>(null==t?void 0:t.childNodes.length)>0).map(t=>t.getBounds()))}getContainer(){let t=this.extends.config.container;return"string"==typeof t?document.getElementById(t):t}getSize(){return[this.extends.config.width||0,this.extends.config.height||0]}appendChild(t,e){var n;let i=(null===(n=t.style)||void 0===n?void 0:n.$layer)||"main";return this.getLayer(i).appendChild(t,e)}setRenderer(t){if(t===this.extends.renderer)return;let e=o$(t,this.config.enableMultiLayer?oK:oU);this.extends.renderers=e,Object.entries(e).forEach(t=>{let[e,n]=t;return this.getLayer(e).setRenderer(n)}),oq(this.getLayers())}getCanvasByViewport(t){return eR(this.getLayer().viewport2Canvas(eP(t)))}getViewportByCanvas(t){return eR(this.getLayer().canvas2Viewport(eP(t)))}getViewportByClient(t){return eR(this.getLayer().client2Viewport(eP(t)))}getClientByViewport(t){return eR(this.getLayer().viewport2Client(eP(t)))}getClientByCanvas(t){return this.getClientByViewport(this.getViewportByCanvas(t))}getCanvasByClient(t){let e=this.getLayer(),n=e.client2Viewport(eP(t));return eR(e.viewport2Canvas(n))}toDataURL(){return oG(this,arguments,void 0,function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=globalThis.devicePixelRatio||1,{mode:n="viewport"}=t,i=oY(t,["mode"]),[r,s,o,a]=[0,0,0,0];if("viewport"===n)[o,a]=this.getSize();else if("overall"===n){let t=this.getBounds(),e=tm(t);[r,s]=t.min,[o,a]=e}let l=(0,oH.L)('<div id="virtual-image"></div>'),h=new j.Xz({width:o,height:a,renderer:new n_.Th,devicePixelRatio:e,container:l,background:this.extends.config.background});yield h.ready,h.appendChild(this.getLayer("background").getRoot().cloneNode(!0)),h.appendChild(this.getRoot().cloneNode(!0));let d=this.getLayer("label").getRoot().cloneNode(!0),c=h.viewport2Canvas({x:0,y:0}),u=this.getCanvasByViewport([0,0]);d.translate([u[0]-c.x,u[1]-c.y]),d.scale(1/this.getCamera().getZoom()),h.appendChild(d),h.appendChild(this.getLayer("transient").getRoot().cloneNode(!0));let p=this.getCamera(),g=h.getCamera();if("viewport"===n)g.setZoom(p.getZoom()),g.setPosition(p.getPosition()),g.setFocalPoint(p.getFocalPoint());else if("overall"===n){let[t,e,n]=g.getPosition(),[i,o,a]=g.getFocalPoint();g.setPosition([t+r,e+s,n]),g.setFocalPoint([i+r,o+s,a])}let f=h.getContextService();return new Promise(t=>{h.addEventListener(j.$6.RERENDER,()=>oG(this,void 0,void 0,function*(){yield new Promise(t=>setTimeout(t,300));let e=yield f.toDataURL(i);t(e)}))})})}destroy(){Object.values(this.getLayers()).forEach(t=>{let e=t.getCamera();e.cancelLandmarkAnimation(),t.destroy()})}constructor(t){this.config={enableMultiLayer:!0},Object.assign(this.config,t);let e=this.config,{renderer:n,background:i,cursor:r,enableMultiLayer:s}=e,o=oY(e,["renderer","background","cursor","enableMultiLayer"]),a=s?oK:oU,l=o$(n,a),h=Object.fromEntries(a.map(t=>{let e=new j.Xz(Object.assign(Object.assign({},o),{supportsMutipleCanvasesInOneContainer:s,renderer:l[t],background:s?"background"===t?i:void 0:i}));return[t,e]}));oq(h),this.extends={config:this.config,renderer:n,renderers:l,layers:h}}}function o$(t,e){return Object.fromEntries(e.map(e=>{let n=(null==t?void 0:t(e))||new n_.Th;return"main"===e?n.registerPlugin(new oW.S({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})):n.unregisterPlugin(n.getPlugin("dom-interaction")),[e,n]}))}function oq(t){Object.entries(t).forEach(t=>{let[e,n]=t,i=n.getContextService().getDomElement();(null==i?void 0:i.style)&&(i.style.gridArea="1 / 1 / 2 / 2",i.style.outline="none",i.tabIndex=1,"main"!==e&&(i.style.pointerEvents="none")),(null==i?void 0:i.parentElement)&&(i.parentElement.style.display="grid")})}let oJ=t=>t?parseInt(t):0;function oQ(t){if(!t)return[0,0];let e=640,n=480,[i,r]=function(t){let e=getComputedStyle(t),n=t.clientWidth||oJ(e.width),i=t.clientHeight||oJ(e.height),r=oJ(e.paddingLeft)+oJ(e.paddingRight),s=oJ(e.paddingTop)+oJ(e.paddingBottom);return[n-r,i-s]}(t);return e=i||e,n=r||n,[Math.max((0,Q.Z)(e)?e:1,1),Math.max((0,Q.Z)(n)?n:1,1)]}class o0{constructor(t){this.type=t}}class o1 extends o0{constructor(t,e){super(t),this.data=e}}class o2 extends o0{constructor(t,e,n,i){super(t),this.animationType=e,this.animation=n,this.data=i}}class o3 extends o0{constructor(t,e,n){super(t),this.elementType=e,this.data=n}}class o6 extends o0{constructor(t,e){super(t),this.data=e}}function o4(t,e){t.emit(e.type,e)}function o8(t){var e;return(null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.zIndex)||0}let o9="cachedStyle",o5=t=>"__".concat(t,"__");function o7(t,e){return(0,e0.Z)(t,[o9,o5(e)])}class at{getTasks(){let t=[...this.tasks];return this.tasks=[],t}add(t,e){this.tasks.push([t,e])}animate(t,e,n){var i,r,s;null===(i=null==e?void 0:e.before)||void 0===i||i.call(e);let o=this.getTasks().map(e=>{var i,r,s;let[o,a]=e,{element:l,elementType:h,stage:d}=o,c=function(t,e,n,i){var r,s;let{animation:o}=t;if(!1===o||!1===i)return[];let a=null===(r=null==t?void 0:t[e])||void 0===r?void 0:r.animation;if(!1===a)return[];let l=null==a?void 0:a[n];if(!1===l)return[];let h=null===(s=K(t)[e])||void 0===s?void 0:s.animation,d=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(function(t){if("string"==typeof t){let e=G(T.ANIMATION,t);return e||(U.warn("The animation of ".concat(t," is not registered.")),[])}return t})(t).map(t=>Object.assign(Object.assign(Object.assign(Object.assign({},Z),(0,_.Z)(o)&&o),t),(0,_.Z)(i)&&i))};if(l)return d(l);if(!h)return[];let c=h[n];return!1===c?[]:d(c)}(this.context.options,h,d,t);null===(i=null==a?void 0:a.before)||void 0===i||i.call(a);let u=c.length?tn(l,this.inferStyle(o,n),c):null;return u?(null===(r=null==a?void 0:a.beforeAnimate)||void 0===r||r.call(a,u),u.finished.then(()=>{var t,e;null===(t=null==a?void 0:a.afterAnimate)||void 0===t||t.call(a,u),null===(e=null==a?void 0:a.after)||void 0===e||e.call(a),this.animations.delete(u)})):null===(s=null==a?void 0:a.after)||void 0===s||s.call(a),u}).filter(Boolean);o.forEach(t=>this.animations.add(t));let a=X(o);return a?(null===(r=null==e?void 0:e.beforeAnimate)||void 0===r||r.call(e,a),a.finished.then(()=>{var t,n;null===(t=null==e?void 0:e.afterAnimate)||void 0===t||t.call(e,a),null===(n=null==e?void 0:e.after)||void 0===n||n.call(e),this.release()})):null===(s=null==e?void 0:e.after)||void 0===s||s.call(e),a}inferStyle(t,e){var n,i;let{element:r,elementType:s,stage:o,originalStyle:a,updatedStyle:l={}}=t;t.modifiedStyle||(t.modifiedStyle=Object.assign(Object.assign({},a),l));let{modifiedStyle:h}=t,d={},c={};if("enter"===o)Object.assign(d,{opacity:0});else if("exit"===o)Object.assign(c,{opacity:0});else if("show"===o)Object.assign(d,{opacity:0}),Object.assign(c,{opacity:null!==(n=o7(r,"opacity"))&&void 0!==n?n:q("opacity")});else if("hide"===o)Object.assign(d,{opacity:null!==(i=o7(r,"opacity"))&&void 0!==i?i:q("opacity")}),Object.assign(c,{opacity:0});else if("collapse"===o){let{collapse:t}=e||{},{target:n,descendants:i,position:o}=t;if("node"===s){if(i.includes(r.id)){let[t,e,n]=o;Object.assign(c,{x:t,y:e,z:n})}}else if("combo"===s){if(r.id===n||i.includes(r.id)){let[t,e]=o;Object.assign(c,{x:t,y:e,childrenNode:a.childrenNode})}}else"edge"===s&&Object.assign(c,{sourceNode:h.sourceNode,targetNode:h.targetNode})}else if("expand"===o){let{expand:t}=e||{},{target:n,descendants:i,position:o}=t;if("node"===s){if(r.id===n||i.includes(r.id)){let[t,e,n]=o;Object.assign(d,{x:t,y:e,z:n})}}else if("combo"===s){if(r.id===n||i.includes(r.id)){let[t,e,n]=o;Object.assign(d,{x:t,y:e,z:n,childrenNode:h.childrenNode})}}else"edge"===s&&Object.assign(d,{sourceNode:h.sourceNode,targetNode:h.targetNode})}return[Object.keys(d).length>0?Object.assign({},a,d):a,Object.keys(c).length>0?Object.assign({},h,c):h]}stop(){this.animations.forEach(t=>t.cancel())}clear(){this.tasks=[]}release(){var t,e;let{canvas:n}=this.context,i=null===(e=null===(t=n.document)||void 0===t?void 0:t.timeline)||void 0===e?void 0:e.animationsWithPromises;i&&(n.document.timeline.animationsWithPromises=i.filter(t=>"finished"!==t.playState))}destroy(){this.stop(),this.animations.clear(),this.tasks=[]}constructor(t){this.tasks=[],this.animations=new Set,this.context=t}}class ae{emit(t){let{graph:e}=this.context;e.emit(t.type,t)}startBatch(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.batchCount++,1===this.batchCount&&this.emit(new o1(D.BATCH_START,{initiate:t}))}endBatch(){this.batchCount--,0===this.batchCount&&this.emit(new o1(D.BATCH_END))}get isBatching(){return this.batchCount>0}destroy(){this.context=null}constructor(t){this.batchCount=0,this.context=t}}class an extends eo{setBehaviors(t){this.setExtensions(t)}forwardEvents(){let t=this.context.canvas.getContainer();t&&[w.KEY_DOWN,w.KEY_UP].forEach(e=>{t.addEventListener(e,this.forwardContainerEvents)});let e=this.context.canvas.document;e&&[O.CLICK,O.DBLCLICK,O.POINTER_OVER,O.POINTER_LEAVE,O.POINTER_ENTER,O.POINTER_MOVE,O.POINTER_OUT,O.POINTER_DOWN,O.POINTER_UP,O.CONTEXT_MENU,O.DRAG_START,O.DRAG,O.DRAG_END,O.DRAG_ENTER,O.DRAG_OVER,O.DRAG_LEAVE,O.DROP,O.WHEEL].forEach(t=>{e.addEventListener(t,this.forwardCanvasEvents)})}destroy(){let t=this.context.canvas.getContainer();t&&[w.KEY_DOWN,w.KEY_UP].forEach(e=>{t.removeEventListener(e,this.forwardContainerEvents)}),this.context.canvas.document.removeAllEventListeners(),super.destroy()}constructor(t){super(t),this.currentTarget=null,this.currentTargetType=null,this.category="behavior",this.forwardCanvasEvents=t=>{let{target:e}=t,n=function(t){if(!t)return null;if(t instanceof j.BB)return{type:"canvas",element:t};let e=t;for(;e;){if(ij(e))return{type:"node",element:e};if(iI(e))return{type:"edge",element:e};if(iB(e))return{type:"combo",element:e};e=e.parentElement}return null}(e);if(!n)return;let{graph:i,canvas:r}=this.context,{type:s,element:o}=n;if("destroyed"in o&&(iX(o)||o.destroyed))return;let{type:a,detail:l,button:h}=t,d=Object.assign(Object.assign({},t),{target:o,targetType:s,originalTarget:e});a===O.POINTER_MOVE&&(this.currentTarget!==o&&(this.currentTarget&&i.emit("".concat(this.currentTargetType,":").concat(O.POINTER_LEAVE),Object.assign(Object.assign({},d),{type:O.POINTER_LEAVE,target:this.currentTarget,targetType:this.currentTargetType})),o&&(Object.assign(d,{type:O.POINTER_ENTER}),i.emit("".concat(s,":").concat(O.POINTER_ENTER),d))),this.currentTarget=o,this.currentTargetType=s),a===O.CLICK&&2===h||(i.emit("".concat(s,":").concat(a),d),i.emit(a,d)),a===O.CLICK&&2===l&&(Object.assign(d,{type:O.DBLCLICK}),i.emit("".concat(s,":").concat(O.DBLCLICK),d),i.emit(O.DBLCLICK,d)),a===O.POINTER_DOWN&&2===h&&(Object.assign(d,{type:O.CONTEXT_MENU,preventDefault:()=>{var t;null===(t=r.getContainer())||void 0===t||t.addEventListener(O.CONTEXT_MENU,t=>t.preventDefault(),{once:!0})}}),i.emit("".concat(s,":").concat(O.CONTEXT_MENU),d),i.emit(O.CONTEXT_MENU,d))},this.forwardContainerEvents=t=>{this.context.graph.emit(t.type,t)},this.forwardEvents(),this.setBehaviors(this.context.options.behaviors||[])}}var ai=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function ar(t,e){let{data:n,style:i}=t,r=ai(t,["data","style"]),{data:s,style:o}=e,a=ai(e,["data","style"]),l=Object.assign(Object.assign({},r),a);return(n||s)&&Object.assign(l,{data:Object.assign(Object.assign({},n),s)}),(i||o)&&Object.assign(l,{style:Object.assign(Object.assign({},i),o)}),l}function as(t){let{data:e,style:n}=t,i=ai(t,["data","style"]);return e&&(i.data=Object.assign({},e)),n&&(i.style=Object.assign({},n)),i}function ao(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{states:n=[],data:i={},style:r={},children:s=[]}=t,o=ai(t,["states","data","style","children"]),{states:a=[],data:l={},style:h={},children:d=[]}=e,c=ai(e,["states","data","style","children"]),u=(t,e)=>t.length===e.length&&t.every((t,n)=>t===e[n]),p=(t,e)=>{let n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&n.every(n=>t[n]===e[n])};return!!(p(o,c)&&u(s,d)&&u(n,a)&&p(i,l)&&p(r,h))}var aa=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};function al(t){let{id:e=t6(t),style:n,data:i}=t,r=aa(t,["id","style","data"]),s=Object.assign(Object.assign({},t),{style:Object.assign({},n),data:Object.assign({},i)});return"source"in t&&"target"in t?Object.assign({id:e,data:s},r):{id:e,data:s}}function ah(t){return t.data}class ad{pushChange(t){if(this.isTraceless)return;let{type:e}=t;if(e===v.NodeUpdated||e===v.EdgeUpdated||e===v.ComboUpdated){let{value:n,original:i}=t;this.changes.push({value:as(n),original:as(i),type:e})}else this.changes.push({value:as(t.value),type:e})}getChanges(){return this.changes}clearChanges(){this.changes=[]}batch(t){this.batchCount++,this.model.batch(t),this.batchCount--}isBatching(){return this.batchCount>0}silence(t){this.isTraceless=!0,t(),this.isTraceless=!1}isCombo(t){return this.comboIds.has(t)||this.latestRemovedComboIds.has(t)}getData(){return{nodes:this.getNodeData(),edges:this.getEdgeData(),combos:this.getComboData()}}getNodeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=ah(n);return this.isCombo(t6(i))||(void 0===t?e.push(i):t.includes(t6(i))&&e.push(i)),e},[])}getEdgeDatum(t){return ah(this.model.getEdge(t))}getEdgeData(t){return this.model.getAllEdges().reduce((e,n)=>{let i=ah(n);return void 0===t?e.push(i):t.includes(t6(i))&&e.push(i),e},[])}getComboData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=ah(n);return this.isCombo(t6(i))&&(void 0===t?e.push(i):t.includes(t6(i))&&e.push(i)),e},[])}getRootsData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;return this.model.getRoots(t).map(ah)}getAncestorsData(t,e){let{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getAncestors(t,e).map(ah):[]}getDescendantsData(t){let e=this.getElementDataById(t),n=[];return eU(e,t=>{t!==e&&n.push(t)},t=>this.getChildrenData(t6(t)),"TB"),n}getParentData(t,e){let{model:n}=this;if(!e){U.warn("The hierarchy structure key is not specified");return}if(!n.hasNode(t)||!n.hasTreeStructure(e))return;let i=n.getParent(t,e);return i?ah(i):void 0}getChildrenData(t){let e="node"===this.getElementType(t)?W:V,{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getChildren(t,e).map(ah):[]}getElementsDataByType(t){return"node"===t?this.getNodeData():"edge"===t?this.getEdgeData():"combo"===t?this.getComboData():[]}getElementDataById(t){let e=this.getElementType(t);return"edge"===e?this.getEdgeDatum(t):this.getNodeLikeDatum(t)}getNodeLikeDatum(t){let e=this.model.getNode(t);return ah(e)}getNodeLikeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=ah(n);return t?t.includes(t6(i))&&e.push(i):e.push(i),e},[])}getElementDataByState(t,e){let n=this.getElementsDataByType(t);return n.filter(t=>{var n;return null===(n=t.states)||void 0===n?void 0:n.includes(e)})}getElementState(t){var e;return(null===(e=this.getElementDataById(t))||void 0===e?void 0:e.states)||[]}hasNode(t){return this.model.hasNode(t)&&!this.isCombo(t)}hasEdge(t){return this.model.hasEdge(t)}hasCombo(t){return this.model.hasNode(t)&&this.isCombo(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.model.getRelatedEdges(t,e).map(ah)}getNeighborNodesData(t){return this.model.getNeighbors(t).map(ah)}setData(t){let{nodes:e=[],edges:n=[],combos:i=[]}=t,{nodes:r,edges:s,combos:o}=this.getData(),a=er(r,e,t=>t6(t),ao),l=er(s,n,t=>t6(t),ao),h=er(o,i,t=>t6(t),ao);this.batch(()=>{let t={nodes:a.enter,edges:l.enter,combos:h.enter};this.addData(t),this.computeZIndex(t,"add",!0);let e={nodes:a.update,edges:l.update,combos:h.update};this.updateData(e),this.computeZIndex(e,"update",!0);let n={nodes:a.exit.map(t6),edges:l.exit.map(t6),combos:h.exit.map(t6)};this.removeData(n)})}addData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.addComboData(i),this.addNodeData(e),this.addEdgeData(n)}),this.computeZIndex(t,"add")}addNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(this.model.addNodes(t.map(t=>(this.pushChange({value:t,type:v.NodeAdded}),al(t)))),this.updateNodeLikeHierarchy(t),this.computeZIndex({nodes:t},"add"))}addEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(this.model.addEdges(t.map(t=>(this.pushChange({value:t,type:v.EdgeAdded}),al(t)))),this.computeZIndex({edges:t},"add"))}addComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.hasTreeStructure(V)||e.attachTreeStructure(V),e.addNodes(t.map(t=>(this.comboIds.add(t6(t)),this.pushChange({value:t,type:v.ComboAdded}),al(t)))),this.updateNodeLikeHierarchy(t),this.computeZIndex({combos:t},"add")}addChildrenData(t,e){let n=this.getNodeLikeDatum(t),i=e.map(t6);this.addNodeData(e),this.updateNodeData([{id:t,children:[...n.children||[],...i]}]),this.addEdgeData(i.map(e=>({source:t,target:e})))}computeZIndex(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!n&&this.isBatching()||this.batch(()=>{let{nodes:n=[],edges:i=[],combos:r=[]}=t;r.forEach(t=>{var n,i,r;let s=t6(t);if("add"===e&&(0,Q.Z)(null===(n=t.style)||void 0===n?void 0:n.zIndex)||"update"===e&&!("combo"in t))return;let o=this.getParentData(s,V),a=o?(null!==(r=null===(i=o.style)||void 0===i?void 0:i.zIndex)&&void 0!==r?r:0)+1:0;this.preventUpdateNodeLikeHierarchy(()=>{this.updateComboData([{id:s,style:{zIndex:a}}])})}),n.forEach(t=>{var n,i,r;let s=t6(t);if("add"===e&&(0,Q.Z)(null===(n=t.style)||void 0===n?void 0:n.zIndex)||"update"===e&&!("combo"in t)&&!("children"in t))return;let o=0,a=this.getParentData(s,V);if(a)o=((null===(i=a.style)||void 0===i?void 0:i.zIndex)||0)+1;else{let t=this.getParentData(s,W);t&&(o=(null===(r=null==t?void 0:t.style)||void 0===r?void 0:r.zIndex)||0)}this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:s,style:{zIndex:o}}])})}),i.forEach(t=>{var e,n,i,r,s;if((0,Q.Z)(null===(e=t.style)||void 0===e?void 0:e.zIndex))return;let{id:o,source:a,target:l}=t;if(o){let t=this.getEdgeDatum(o);a=t.source,l=t.target}else o=t6(t);if(!a||!l)return;let h=(null===(i=null===(n=this.getNodeLikeDatum(a))||void 0===n?void 0:n.style)||void 0===i?void 0:i.zIndex)||0,d=(null===(s=null===(r=this.getNodeLikeDatum(l))||void 0===r?void 0:r.style)||void 0===s?void 0:s.zIndex)||0;this.updateEdgeData([{id:t6(t),style:{zIndex:Math.max(h,d)-1}}])})})}getFrontZIndex(t){var e;let n=this.getElementType(t),i=this.getElementDataById(t),r=this.getData();if(Object.assign(r,{["".concat(n,"s")]:r["".concat(n,"s")].filter(e=>t6(e)!==t)}),"combo"===n&&!eQ(i)){let e=new Set(this.getAncestorsData(t,V).map(t6));r.nodes=r.nodes.filter(t=>!e.has(t6(t))),r.combos=r.combos.filter(t=>!e.has(t6(t))),r.edges=r.edges.filter(t=>{let{source:n,target:i}=t;return!e.has(n)&&!e.has(i)})}return Math.max((null===(e=i.style)||void 0===e?void 0:e.zIndex)||0,0,...Object.values(r).flat().map(t=>{var e;return((null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.zIndex)||0)+1}))}updateNodeLikeHierarchy(t){if(!this.enableUpdateNodeLikeHierarchy)return;let{model:e}=this;t.forEach(t=>{let n=t6(t),i=t.combo;void 0!==i&&(e.hasTreeStructure(V)||e.attachTreeStructure(V),null===i&&this.refreshComboData(n),this.setParent(n,t.combo,V));let r=t.children||[];if(r.length){e.hasTreeStructure(W)||e.attachTreeStructure(W);let t=r.filter(t=>e.hasNode(t));t.forEach(t=>this.setParent(t,n,W)),t.length!==r.length&&this.updateNodeData([{id:n,children:t}])}})}preventUpdateNodeLikeHierarchy(t){this.enableUpdateNodeLikeHierarchy=!1,t(),this.enableUpdateNodeLikeHierarchy=!0}updateData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.updateNodeData(e),this.updateComboData(i),this.updateEdgeData(n)}),this.computeZIndex(t,"update")}updateNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{let n=[];t.forEach(t=>{let i=t6(t),r=ah(e.getNode(i));if(ao(r,t))return;let s=ar(r,t);this.pushChange({value:s,original:r,type:v.NodeUpdated}),e.mergeNodeData(i,s),n.push(s)}),this.updateNodeLikeHierarchy(n)}),this.computeZIndex({nodes:t},"update")}refreshData(){let{nodes:t,edges:e,combos:n}=this.getData();t.forEach(t=>{this.pushChange({value:t,original:t,type:v.NodeUpdated})}),e.forEach(t=>{this.pushChange({value:t,original:t,type:v.EdgeUpdated})}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}syncNodeLikeDatum(t){let{model:e}=this,n=t6(t);if(!e.hasNode(n))return;let i=ah(e.getNode(n)),r=ar(i,t);e.mergeNodeData(n,r)}syncEdgeDatum(t){let{model:e}=this,n=t6(t);if(!e.hasEdge(n))return;let i=ah(e.getEdge(n)),r=ar(i,t);e.mergeEdgeData(n,r)}updateEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{t.forEach(t=>{let n=t6(t),i=ah(e.getEdge(n));if(ao(i,t))return;t.source&&i.source!==t.source&&e.updateEdgeSource(n,t.source),t.target&&i.target!==t.target&&e.updateEdgeTarget(n,t.target);let r=ar(i,t);this.pushChange({value:r,original:i,type:v.EdgeUpdated}),e.mergeEdgeData(n,r)})}),this.computeZIndex({edges:t},"update")}updateComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.batch(()=>{let n=[];t.forEach(t=>{let i=t6(t),r=ah(e.getNode(i));if(ao(r,t))return;let s=ar(r,t);this.pushChange({value:s,original:r,type:v.ComboUpdated}),e.mergeNodeData(i,s),n.push(s)}),this.updateNodeLikeHierarchy(n)}),this.computeZIndex({combos:t},"update")}setParent(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t===e)return;let r=this.getNodeLikeDatum(t),s=r.combo;s!==e&&n===V&&(this.isCombo(t),this.syncNodeLikeDatum({id:t,combo:e})),this.model.setParent(t,e,n),i&&n===V&&(function(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var i=0,r=t.length;i<r;i++){var s=t[i];e.has(s)||(n.push(s),e.set(s,!0))}return n})([s,e]).forEach(t=>{void 0!==t&&this.refreshComboData(t)})}refreshComboData(t){let e=this.getComboData([t])[0],n=this.getAncestorsData(t,V);e&&this.pushChange({value:e,original:e,type:v.ComboUpdated}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}getElementPosition(t){let e=this.getElementDataById(t);return eT(e)}translateNodeLikeBy(t,e){this.isCombo(t)?this.translateComboBy(t,e):this.translateNodeBy(t,e)}translateNodeLikeTo(t,e){this.isCombo(t)?this.translateComboTo(t,e):this.translateNodeTo(t,e)}translateNodeBy(t,e){let n=this.getElementPosition(t),i=eu(n,[...e,0].slice(0,3));this.translateNodeTo(t,i)}translateNodeTo(t,e){let[n=0,i=0,r=0]=e;this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:t,style:{x:n,y:i,z:r}}])})}translateComboBy(t,e){let[n=0,i=0,r=0]=e;if([n,i,r].some(isNaN)||[n,i,r].every(t=>0===t))return;let s=this.getComboData([t])[0];if(!s)return;let o=new Set;eU(s,t=>{let e=t6(t);if(o.has(e))return;o.add(e);let[s,a,l]=eT(t),h=ar(t,{style:{x:s+n,y:a+i,z:l+r}});this.pushChange({value:h,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,h)},t=>this.getChildrenData(t6(t)),"BT")}translateComboTo(t,e){var n;if(e.some(isNaN))return;let[i=0,r=0,s=0]=e,o=null===(n=this.getComboData([t]))||void 0===n?void 0:n[0];if(!o)return;let[a,l,h]=eT(o),d=i-a,c=r-l,u=s-h;eU(o,t=>{let e=t6(t),[n,i,r]=eT(t),s=ar(t,{style:{x:n+d,y:i+c,z:r+u}});this.pushChange({value:s,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,s)},t=>this.getChildrenData(t6(t)),"BT")}removeData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.removeEdgeData(n),this.removeNodeData(e),this.removeComboData(i),this.latestRemovedComboIds=new Set(i)})}removeNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.removeEdgeData(this.getRelatedEdgesData(t).map(t6)),this.pushChange({value:this.getNodeData([t])[0],type:v.NodeRemoved}),this.removeNodeLikeHierarchy(t)}),this.model.removeNodes(t)})}removeEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(t.forEach(t=>this.pushChange({value:this.getEdgeData([t])[0],type:v.EdgeRemoved})),this.model.removeEdges(t))}removeComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.pushChange({value:this.getComboData([t])[0],type:v.ComboRemoved}),this.removeNodeLikeHierarchy(t),this.comboIds.delete(t)}),this.model.removeNodes(t)})}removeNodeLikeHierarchy(t){if(this.model.hasTreeStructure(V)){let e=this.getNodeLikeDatum(t).combo;this.setParent(t,void 0,V,!1),this.model.getChildren(t,V).forEach(t=>{let n=ah(t),i=t6(n);this.setParent(t6(n),e,V,!1);let r=ar(n,{id:t6(n),combo:e});this.pushChange({value:r,original:n,type:this.isCombo(i)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(t6(n),r)}),(0,B.Z)(e)||this.refreshComboData(e)}}getElementType(t){if(this.model.hasNode(t))return this.isCombo(t)?"combo":"node";if(this.model.hasEdge(t))return"edge";throw Error(Y("Unknown element type of id: ".concat(t)))}destroy(){let{model:t}=this,e=t.getAllNodes(),n=t.getAllEdges();t.removeEdges(n.map(t=>t.id)),t.removeNodes(e.map(t=>t.id)),this.context={}}constructor(){this.latestRemovedComboIds=new Set,this.comboIds=new Set,this.changes=[],this.batchCount=0,this.isTraceless=!1,this.enableUpdateNodeLikeHierarchy=!0,this.model=new i8.k}}var ac=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class au{init(){this.initContainer()}initContainer(){if(!this.container||this.container.destroyed){let{canvas:t}=this.context;this.container=t.appendChild(new j.ZA({className:"elements"}))}}emit(t,e){e.silence||o4(this.context.graph,t)}forEachElementData(t){eY.forEach(e=>{let n=this.context.model.getElementsDataByType(e);t(e,n)})}getElementType(t,e){var n;let{options:i,graph:r}=this.context,s=(null===(n=i[t])||void 0===n?void 0:n.type)||e.type;return s?"string"==typeof s?s:s.call(r,e):"edge"===t?"line":"circle"}getTheme(t){return K(this.context.options)[t]||{}}getThemeStyle(t){return this.getTheme(t).style||{}}getThemeStateStyle(t,e){let{state:n={}}=this.getTheme(t);return Object.assign({},...e.map(t=>n[t]||{}))}computePaletteStyle(){let{options:t}=this.context;this.paletteStyle={},this.forEachElementData((e,n)=>{var i,r;let s=Object.assign({},ne(null===(i=this.getTheme(e))||void 0===i?void 0:i.palette),ne(null===(r=t[e])||void 0===r?void 0:r.palette));(null==s?void 0:s.field)&&Object.assign(this.paletteStyle,function(t,e){if(!e)return{};let{type:n,color:i,field:r,invert:s}=e,o=t=>{let e="string"==typeof i?G("palette",i):i;if("function"==typeof e){let n={};return t.forEach(t=>{let[i,r]=t;n[i]=e(s?1-r:r)}),n}if(Array.isArray(e)){let n=s?[...e].reverse():e,i={};return t.forEach(t=>{let[r,s]=t;i[r]=n[s%e.length]}),i}return{}},a=(t,e)=>{var n;return"string"==typeof t?null===(n=e.data)||void 0===n?void 0:n[t]:null==t?void 0:t(e)};if("group"===n){let e=th(t,t=>{if(!r)return"default";let e=a(r,t);return e?String(e):"default"}),n=Object.keys(e),i=o(n.map((t,e)=>[t,e])),s={};return Object.entries(e).forEach(t=>{let[e,n]=t;n.forEach(t=>{s[t6(t)]=i[e]})}),s}if("value"===n){let[e,n]=t.reduce((t,e)=>{let[n,i]=t,s=a(r,e);if("number"!=typeof s)throw Error(Y("Palette field ".concat(r," is not a number")));return[Math.min(n,s),Math.max(i,s)]},[1/0,-1/0]),i=n-e;return o(t.map(t=>[t.id,(a(r,t)-e)/i]))}}(n,s))})}getPaletteStyle(t,e){let n=this.paletteStyle[e];return n?"edge"===t?{stroke:n}:{fill:n}:{}}computeElementDefaultStyle(t,e){var n;let{options:i}=this.context,r=(null===(n=i[t])||void 0===n?void 0:n.style)||{};"transform"in r&&Array.isArray(r.transform)&&(r.transform=[...r.transform]),this.defaultStyle[t6(e.datum)]=e7(r,e)}computeElementsDefaultStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let r=i.length;for(let s=0;s<r;s++){let r=i[s];(void 0===t||t.includes(t6(r)))&&this.computeElementDefaultStyle(n,{datum:r,graph:e})}})}getDefaultStyle(t){return this.defaultStyle[t]||{}}getElementState(t){try{let{model:e}=this.context;return e.getElementState(t)}catch(t){return[]}}getElementStateStyle(t,e,n){var i,r;let{options:s}=this.context,o=(null===(r=null===(i=s[t])||void 0===i?void 0:i.state)||void 0===r?void 0:r[e])||{};return e7(o,n)}computeElementStatesStyle(t,e,n){this.stateStyle[t6(n.datum)]=Object.assign({},...e.map(e=>this.getElementStateStyle(t,e,n)))}computeElementsStatesStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let r=i.length;for(let s=0;s<r;s++){let r=i[s];if(void 0===t||t.includes(t6(r))){let t=this.getElementState(t6(r));this.computeElementStatesStyle(n,t,{datum:r,graph:e})}}})}getStateStyle(t){return this.stateStyle[t]||{}}computeStyle(t,e){t&&["translate","zIndex"].includes(t)||(this.computePaletteStyle(),this.computeElementsDefaultStyle(e),this.computeElementsStatesStyle(e))}getElement(t){return this.elementMap[t]}getNodes(){return this.context.model.getNodeData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getEdges(){return this.context.model.getEdgeData().map(t=>this.elementMap[t6(t)])}getCombos(){return this.context.model.getComboData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getElementComputedStyle(t,e){let n=t6(e),i=this.getThemeStyle(t),r=this.getPaletteStyle(t,n),s=e.style||{},o=this.getDefaultStyle(n),a=this.getThemeStateStyle(t,this.getElementState(n)),l=this.getStateStyle(n),h=Object.assign({},i,r,s,o,a,l);if("combo"===t){let t=this.context.model.getChildrenData(n),e=!!h.collapsed,i=e?[]:t.map(t6).filter(t=>this.getElement(t));Object.assign(h,{childrenNode:i,childrenData:t})}return h}getDrawData(t){this.init();let e=this.computeChangesAndDrawData(t);if(!e)return null;let{type:n="draw",stage:i=n}=t;return this.markDestroyElement(e.drawData),this.computeStyle(i),{type:n,stage:i,data:e}}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{animation:!0},e=this.getDrawData(t);if(!e)return;let{data:{drawData:{add:n,update:i,remove:r}}}=e;return this.destroyElements(r,t),this.createElements(n,t),this.updateElements(i,t),this.setAnimationTask(t,e)}preLayoutDraw(){return ac(this,arguments,void 0,function*(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{animation:!0},i=this.getDrawData(n);if(!i)return;let{data:{drawData:r}}=i;yield null===(e=null===(t=this.context.layout)||void 0===t?void 0:t.preLayout)||void 0===e?void 0:e.call(t,r);let{add:s,update:o,remove:a}=r;return this.destroyElements(a,n),this.createElements(s,n),this.updateElements(o,n),this.setAnimationTask(n,i)})}setAnimationTask(t,e){let{animation:n,silence:i}=t,{data:{dataChanges:r,drawData:s},stage:o,type:a}=e;return this.context.animation.animate(n,i?{}:{before:()=>this.emit(new o1(D.BEFORE_DRAW,{dataChanges:r,animation:n,stage:o,render:"render"===a}),t),beforeAnimate:e=>this.emit(new o2(D.BEFORE_ANIMATE,b.DRAW,e,s),t),afterAnimate:e=>this.emit(new o2(D.AFTER_ANIMATE,b.DRAW,e,s),t),after:()=>this.emit(new o1(D.AFTER_DRAW,{dataChanges:r,animation:n,stage:o,render:"render"===a,firstRender:!1===this.context.graph.rendered}),t)})}computeChangesAndDrawData(t){let{model:e}=this.context,n=e.getChanges(),i=sb(n);if(0===i.length)return null;let{NodeAdded:r=[],NodeUpdated:s=[],NodeRemoved:o=[],EdgeAdded:a=[],EdgeUpdated:l=[],EdgeRemoved:h=[],ComboAdded:d=[],ComboUpdated:c=[],ComboRemoved:u=[]}=th(i,t=>t.type),p=t=>new Map(t.map(t=>{let e=t.value;return[t6(e),e]})),g={add:{nodes:p(r),edges:p(a),combos:p(d)},update:{nodes:p(s),edges:p(l),combos:p(c)},remove:{nodes:p(o),edges:p(h),combos:p(u)}},f=this.transformData(g,t);return e.clearChanges(),{dataChanges:n,drawData:f}}transformData(t,e){let n=this.context.transform.getTransformInstance();return Object.values(n).reduce((t,n)=>n.beforeDraw(t,e),t)}createElement(t,e,n){var i;let r=t6(e),s=this.getElement(r);if(s)return;let o=this.getElementType(t,e),a=this.getElementComputedStyle(t,e),l=G(t,o);if(!l)return U.warn("The element ".concat(o," of ").concat(t," is not registered."));this.emit(new o3(D.BEFORE_ELEMENT_CREATE,t,e),n);let h=this.container.appendChild(new l({id:r,context:this.context,style:a}));this.shapeTypeMap[r]=o,this.elementMap[r]=h;let{stage:d="enter"}=n;null===(i=this.context.animation)||void 0===i||i.add({element:h,elementType:t,stage:d,originalStyle:Object.assign({},h.attributes),updatedStyle:a},{after:()=>{var i;this.emit(new o3(D.AFTER_ELEMENT_CREATE,t,e),n),null===(i=h.onCreate)||void 0===i||i.call(h)}})}createElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["node",n],["combo",r],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.createElement(n,t,e))})}getUpdateStageStyle(t,e,n){let{stage:i="update"}=n;if("translate"===i){if("node"!==t&&"combo"!==t)return{};{let{style:{x:t=0,y:n=0,z:i=0}={}}=e;return{x:t,y:n,z:i}}}return this.getElementComputedStyle(t,e)}updateElement(t,e,n){var i;let r=t6(e),{stage:s="update"}=n,o=this.getElement(r);if(!o)return()=>null;this.emit(new o3(D.BEFORE_ELEMENT_UPDATE,t,e),n);let a=this.getElementType(t,e),l=this.getUpdateStageStyle(t,e,n);this.shapeTypeMap[r]!==a&&(o.destroy(),delete this.shapeTypeMap[r],delete this.elementMap[r],this.createElement(t,e,{animation:!1,silence:!0}));let h="visibility"!==s?s:"hidden"===l.visibility?"hide":"show";"hide"===h&&delete l.visibility,null===(i=this.context.animation)||void 0===i||i.add({element:o,elementType:t,stage:h,originalStyle:Object.assign({},o.attributes),updatedStyle:l},{before:()=>{let t=this.elementMap[r];"collapse"!==s&&iK(t,l),"visibility"===s&&(o5("opacity") in((0,e0.Z)(t,o9)||{})||function(t,e){let n=Array.isArray(e)?e:[e];(0,e0.Z)(t,o9)||(0,e1.Z)(t,o9,{}),n.forEach(e=>{(0,e1.Z)((0,e0.Z)(t,o9),o5(e),t.attributes[e])})}(t,"opacity"),this.visibilityCache.set(t,"show"===h?"visible":"hidden"),"show"===h&&es(t,"visible"))},after:()=>{var i;let o=this.elementMap[r];"collapse"===s&&iK(o,l),"hide"===h&&es(o,this.visibilityCache.get(o)),this.emit(new o3(D.AFTER_ELEMENT_UPDATE,t,e),n),null===(i=o.onUpdate)||void 0===i||i.call(o)}})}updateElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["node",n],["combo",r],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.updateElement(n,t,e))})}markDestroyElement(t){Object.values(t.remove).forEach(t=>{t.forEach(t=>{let e=t6(t),n=this.getElement(e);n&&(0,e1.Z)(n,"__to_be_destroyed__",!0)})})}destroyElement(t,e,n){var i;let{stage:r="exit"}=n,s=t6(e),o=this.elementMap[s];if(!o)return()=>null;this.emit(new o3(D.BEFORE_ELEMENT_DESTROY,t,e),n),null===(i=this.context.animation)||void 0===i||i.add({element:o,elementType:t,stage:r,originalStyle:Object.assign({},o.attributes),updatedStyle:{}},{after:()=>{var i;this.clearElement(s),o.destroy(),null===(i=o.onDestroy)||void 0===i||i.call(o),this.emit(new o3(D.AFTER_ELEMENT_DESTROY,t,e),n)}})}destroyElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["combo",r],["edge",i],["node",n]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.destroyElement(n,t,e))})}clearElement(t){delete this.paletteStyle[t],delete this.defaultStyle[t],delete this.stateStyle[t],delete this.elementMap[t],delete this.shapeTypeMap[t]}alignLayoutResultToElement(t,e){var n,i;let r=null===(n=t.nodes)||void 0===n?void 0:n.find(t=>t6(t)===e);if(r){let n=eT(this.context.model.getNodeLikeDatum(e)),s=eT(r),o=ep(n,s);null===(i=t.nodes)||void 0===i||i.forEach(t=>{var e,n,i;(null===(e=t.style)||void 0===e?void 0:e.x)&&(t.style.x+=o[0]),(null===(n=t.style)||void 0===n?void 0:n.y)&&(t.style.y+=o[1]),(null===(i=t.style)||void 0===i?void 0:i.z)&&(t.style.z+=o[2]||0)})}}collapseNode(t,e){return ac(this,void 0,void 0,function*(){var n;let{animation:i,align:r}=e,{model:s,layout:o}=this.context,a=this.computeChangesAndDrawData({stage:"collapse",animation:i});if(!a)return;this.markDestroyElement(a.drawData);let l=yield o.simulate();r&&this.alignLayoutResultToElement(l,t),s.updateData(l);let h=this.computeChangesAndDrawData({stage:"collapse",animation:i});if(!h)return;let{drawData:d}=h,{add:c,remove:u,update:p}=d;this.markDestroyElement(d);let g={animation:i,stage:"collapse",data:d};this.destroyElements(u,g),this.createElements(c,g),this.updateElements(p,g),yield null===(n=this.context.animation.animate(i,{beforeAnimate:t=>this.emit(new o2(D.BEFORE_ANIMATE,b.COLLAPSE,t,d),g),afterAnimate:t=>this.emit(new o2(D.AFTER_ANIMATE,b.COLLAPSE,t,d),g)},{collapse:{target:t,descendants:Array.from(u.nodes).map(t=>{let[,e]=t;return t6(e)}),position:eT(p.nodes.get(t))}}))||void 0===n?void 0:n.finished})}expandNode(t,e){return ac(this,void 0,void 0,function*(){var n;let{model:i,layout:r}=this.context,{animation:s,align:o}=e,a=eT(i.getNodeData([t])[0]),l=this.computeChangesAndDrawData({stage:"expand",animation:s});if(!l)return;let{drawData:{add:h}}=l;this.createElements(h,{animation:!1,stage:"expand",target:t}),this.context.animation.clear();let d=yield r.simulate();o&&this.alignLayoutResultToElement(d,t),i.updateData(d),this.computeStyle("expand");let c=this.computeChangesAndDrawData({stage:"collapse",animation:s});if(!c)return;let{drawData:u}=c,{update:p}=u,g={animation:s,stage:"expand",data:u};h.edges.forEach(t=>p.edges.set(t6(t),t)),h.nodes.forEach(t=>p.nodes.set(t6(t),t)),this.updateElements(p,g),yield null===(n=this.context.animation.animate(s,{beforeAnimate:t=>this.emit(new o2(D.BEFORE_ANIMATE,b.EXPAND,t,u),g),afterAnimate:t=>this.emit(new o2(D.AFTER_ANIMATE,b.EXPAND,t,u),g)},{expand:{target:t,descendants:Array.from(h.nodes).map(t=>{let[,e]=t;return t6(e)}),position:a}}))||void 0===n?void 0:n.finished})}collapseCombo(t,e){return ac(this,void 0,void 0,function*(){var n;let{model:i,element:r}=this.context;if(i.getAncestorsData(t,V).some(t=>eQ(t)))return;let s=r.getElement(t),o=s.getComboPosition(Object.assign(Object.assign({},s.attributes),{collapsed:!0})),a=this.computeChangesAndDrawData({stage:"collapse",animation:e});if(!a)return;let{dataChanges:l,drawData:h}=a;this.markDestroyElement(h);let{update:d,remove:c}=h,u={animation:e,stage:"collapse",data:h};this.destroyElements(c,u),this.updateElements(d,u);let p=t=>Array.from(t).map(t=>{let[,e]=t;return t6(e)});yield null===(n=this.context.animation.animate(e,{before:()=>this.emit(new o1(D.BEFORE_DRAW,{dataChanges:l,animation:e}),u),beforeAnimate:t=>this.emit(new o2(D.BEFORE_ANIMATE,b.COLLAPSE,t,h),u),afterAnimate:t=>this.emit(new o2(D.AFTER_ANIMATE,b.COLLAPSE,t,h),u),after:()=>this.emit(new o1(D.AFTER_DRAW,{dataChanges:l,animation:e}),u)},{collapse:{target:t,descendants:[...p(c.nodes),...p(c.combos)],position:o}}))||void 0===n?void 0:n.finished})}expandCombo(t,e){return ac(this,void 0,void 0,function*(){var n;let{model:i}=this.context,r=eT(i.getComboData([t])[0]);this.computeStyle("expand");let s=this.computeChangesAndDrawData({stage:"expand",animation:e});if(!s)return;let{dataChanges:o,drawData:a}=s,{add:l,update:h}=a,d={animation:e,stage:"expand",data:a,target:t};this.createElements(l,d),this.updateElements(h,d);let c=t=>Array.from(t).map(t=>{let[,e]=t;return t6(e)});yield null===(n=this.context.animation.animate(e,{before:()=>this.emit(new o1(D.BEFORE_DRAW,{dataChanges:o,animation:e}),d),beforeAnimate:t=>this.emit(new o2(D.BEFORE_ANIMATE,b.EXPAND,t,a),d),afterAnimate:t=>this.emit(new o2(D.AFTER_ANIMATE,b.EXPAND,t,a),d),after:()=>this.emit(new o1(D.AFTER_DRAW,{dataChanges:o,animation:e}),d)},{expand:{target:t,descendants:[...c(l.nodes),...c(l.combos)],position:r}}))||void 0===n?void 0:n.finished})}clear(){this.container.destroy(),this.initContainer(),this.elementMap={},this.shapeTypeMap={},this.defaultStyle={},this.stateStyle={},this.paletteStyle={}}destroy(){this.clear(),this.container.destroy(),this.context={}}constructor(t){this.elementMap={},this.shapeTypeMap={},this.paletteStyle={},this.defaultStyle={},this.stateStyle={},this.visibilityCache=new WeakMap,this.context=t}}var ap=n(21150);class ag extends sv.Z{constructor(t,e,n){super(),this.graph=t,this.layout=e,this.options=n,this.spawnWorker()}spawnWorker(){this.proxy=ap.Ud(new Worker(n.tu(new URL(n.p+n.u(5812),n.b)),{type:void 0})),this.running&&(this.running=!1,this.execute())}execute(){var t;return(0,tP.mG)(this,void 0,void 0,function*(){if(this.running)return this;this.running=!0;let e=this.layout.options,{onTick:n}=e,i=(0,tP._T)(e,["onTick"]),r={};Object.keys(i).forEach(t=>{(0,to.Z)(i[t])||(r[t]=i[t])});let s={layout:{id:this.layout.id,options:r,iterations:null===(t=this.options)||void 0===t?void 0:t.iterations},nodes:this.graph.getAllNodes(),edges:this.graph.getAllEdges()},o=new Float32Array([0]),[a]=yield this.proxy.calculateLayout(s,[o]);return a})}stop(){return this.running=!1,this.proxy.stopLayout(),this}kill(){this.proxy[ap.Yy]()}isRunning(){return this.running}}var af=n(6506),ay=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})},am=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class av{get presetOptions(){return{animation:!!J(this.context.options,!0)}}get options(){let{options:t}=this.context;return t.layout}getLayoutInstance(){return this.instances}preLayout(t){return ay(this,void 0,void 0,function*(){var e,n,i,r;let{graph:s,model:o}=this.context,{add:a}=t;o4(s,new o1(D.BEFORE_LAYOUT,{type:"pre"}));let l=yield null===(e=this.context.layout)||void 0===e?void 0:e.simulate();null===(n=null==l?void 0:l.nodes)||void 0===n||n.forEach(t=>{let e=t6(t),n=a.nodes.get(e);o.syncNodeLikeDatum(t),n&&Object.assign(n.style,t.style)}),null===(i=null==l?void 0:l.edges)||void 0===i||i.forEach(t=>{let e=t6(t),n=a.edges.get(e);o.syncEdgeDatum(t),n&&Object.assign(n.style,t.style)}),null===(r=null==l?void 0:l.combos)||void 0===r||r.forEach(t=>{let e=t6(t),n=a.combos.get(e);o.syncNodeLikeDatum(t),n&&Object.assign(n.style,t.style)}),o4(s,new o1(D.AFTER_LAYOUT,{type:"pre"})),this.transformDataAfterLayout("pre",t)})}postLayout(){return ay(this,void 0,void 0,function*(){if(!this.options)return;let t=Array.isArray(this.options)?this.options:[this.options],{graph:e}=this.context;for(let n of(o4(e,new o1(D.BEFORE_LAYOUT,{type:"post"})),t)){let i=t.indexOf(n),r=this.getLayoutData(n),s=Object.assign(Object.assign({},this.presetOptions),n);o4(e,new o1(D.BEFORE_STAGE_LAYOUT,{options:s,index:i}));let o=yield this.stepLayout(r,s,i);o4(e,new o1(D.AFTER_STAGE_LAYOUT,{options:s,index:i})),n.animation||this.updateElementPosition(o,!1)}o4(e,new o1(D.AFTER_LAYOUT,{type:"post"})),this.transformDataAfterLayout("post")})}transformDataAfterLayout(t,e){let n=this.context.transform.getTransformInstance();Object.values(n).forEach(n=>n.afterLayout(t,e))}simulate(){return ay(this,void 0,void 0,function*(){if(!this.options)return{};let t=Array.isArray(this.options)?this.options:[this.options],e={};for(let n of t){let i=t.indexOf(n),r=this.getLayoutData(n),s=yield this.stepLayout(r,Object.assign(Object.assign(Object.assign({},this.presetOptions),n),{animation:!1}),i);e=s}return e})}stepLayout(t,e,n){return ay(this,void 0,void 0,function*(){return!function(t){let{type:e}=t;return["compact-box","mindmap","dendrogram","indented"].includes(e)}(e)?yield this.graphLayout(t,e,n):yield this.treeLayout(t,e,n)})}graphLayout(t,e,n){return ay(this,void 0,void 0,function*(){let{animation:i,enableWorker:r,iterations:s=300}=e,o=this.initGraphLayout(e);if(!o)return{};if(this.instances[n]=o,this.instance=o,r)return this.supervisor=new ag(o.graphData2LayoutModel(t),o.instance,{iterations:s}),i7((yield this.supervisor.execute()));if((0,af.h)(o))return i?yield o.execute(t,{onTick:t=>{this.updateElementPosition(t,!1)}}):(o.execute(t),o.stop(),o.tick(s));let a=yield o.execute(t);if(i){let t=this.updateElementPosition(a,i);yield null==t?void 0:t.finished}return a})}treeLayout(t,e,n){return ay(this,void 0,void 0,function*(){let{type:n,animation:i}=e,r=G("layout",n);if(!r)return{};let{nodes:s=[],edges:o=[]}=t,a=new i8.k({nodes:s.map(t=>({id:t6(t),data:t.data||{}})),edges:o.map(t=>({id:t6(t),source:t.source,target:t.target,data:t.data||{}}))});!function(t){if(t.hasTreeStructure(W))return;t.attachTreeStructure(W);let e=t.getAllEdges();for(let n of e){let{source:e,target:i}=n;t.setParent(i,e,W)}}(a);let l={nodes:[],edges:[]},h={nodes:[],edges:[]},d=a.getRoots(W);d.forEach(t=>{eU(t,t=>{t.children=a.getSuccessors(t.id)},t=>a.getSuccessors(t.id),"TB");let n=r(t,e),{x:i,y:s,z:o=0}=n;eU(n,t=>{let{id:e,x:n,y:r,z:a=0}=t;l.nodes.push({id:e,style:{x:i,y:s,z:o}}),h.nodes.push({id:e,style:{x:n,y:r,z:a}})},t=>t.children,"TB")});let c=this.inferTreeLayoutOffset(h);if(ab(h,c),i){ab(l,c),this.updateElementPosition(l,!1);let t=this.updateElementPosition(h,i);yield null==t?void 0:t.finished}return h})}inferTreeLayoutOffset(t){var e;let[n,i]=[1/0,-1/0],[r,s]=[1/0,-1/0];null===(e=t.nodes)||void 0===e||e.forEach(t=>{let{x:e=0,y:o=0}=t.style||{};n=Math.min(n,e),i=Math.max(i,e),r=Math.min(r,o),s=Math.max(s,o)});let{canvas:o}=this.context,a=o.getSize(),[l,h]=o.getCanvasByViewport([0,0]),[d,c]=o.getCanvasByViewport(a);return n>=l&&i<=d&&r>=h&&s<=c?[0,0]:[(l+d)/2-(n+i)/2,(h+c)/2-(r+s)/2]}stopLayout(){this.instance&&(0,af.h)(this.instance)&&(this.instance.stop(),this.instance=void 0),this.supervisor&&(this.supervisor.stop(),this.supervisor=void 0),this.animationResult&&(this.animationResult.finish(),this.animationResult=void 0)}getLayoutData(t){let{nodeFilter:e=()=>!0,preLayout:n=!1,isLayoutInvisibleNodes:i=!1}=t,{nodes:r,edges:s,combos:o}=this.context.model.getData(),{element:a,model:l}=this.context,h=t=>a.getElement(t),d=n?t=>{var n;return!(!i&&((null===(n=t.style)||void 0===n?void 0:n.visibility)==="hidden"||l.getAncestorsData(t.id,W).some(eQ)||l.getAncestorsData(t.id,V).some(eQ)))&&e(t)}:t=>{let n=t6(t),i=h(n);return!(!i||iX(i))&&e(t)},c=r.filter(d),u=new Map(c.map(t=>[t6(t),t]));o.forEach(t=>u.set(t6(t),t));let p=s.filter(t=>{let{source:e,target:n}=t;return u.has(e)&&u.has(n)});return{nodes:c,edges:p,combos:o}}initGraphLayout(t){var e,n;let{element:i,viewport:r}=this.context,{type:s,enableWorker:o,animation:a,iterations:l}=t,h=am(t,["type","enableWorker","animation","iterations"]),[d,c]=r.getCanvasSize(),u=[d/2,c/2],p=null!==(e=null==t?void 0:t.nodeSize)&&void 0!==e?e:t=>{let e=null==i?void 0:i.getElement(t.id);return e?e.attributes.size:null==i?void 0:i.getElementComputedStyle("node",t).size},g=G("layout",s);if(!g)return U.warn("The layout of ".concat(s," is not registered."));let f=Object.getPrototypeOf(g.prototype)===i9.prototype?g:(n=this.context,class extends i9{execute(t,e){var n,i,r,s;return n=this,i=void 0,r=void 0,s=function*(){return i7((yield this.instance.execute(this.graphData2LayoutModel(t),this.transformOptions((0,ed.Z)({},this.options,e)))))},new(r||(r=Promise))(function(t,e){function o(t){try{l(s.next(t))}catch(t){e(t)}}function a(t){try{l(s.throw(t))}catch(t){e(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(t){t(n)})).then(o,a)}l((s=s.apply(n,i||[])).next())})}transformOptions(t){let{onTick:e}=t;return e&&(t.onTick=t=>e(i7(t))),t}graphData2LayoutModel(t){let{nodes:e=[],edges:i=[],combos:r=[]}=t,s=e.map(t=>{let e=t6(t),{data:n,style:i,combo:r}=t,s=i5(t,["data","style","combo"]),o={id:e,data:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n),{data:n}),r?{parentId:r}:{}),{style:i}),s)};return(null==i?void 0:i.x)&&Object.assign(o.data,{x:i.x}),(null==i?void 0:i.y)&&Object.assign(o.data,{y:i.y}),(null==i?void 0:i.z)&&Object.assign(o.data,{z:i.z}),o}),o=new Map(s.map(t=>[t.id,t])),a=i.filter(t=>{let{source:e,target:n}=t;return o.has(e)&&o.has(n)}).map(t=>{let{source:e,target:n,data:i,style:r}=t;return{id:t6(t),source:e,target:n,data:Object.assign({},i),style:Object.assign({},r)}}),l=r.map(t=>({id:t6(t),data:Object.assign({_isCombo:!0},t.data),style:Object.assign({},t.style)})),h=new i8.k({nodes:[...s,...l],edges:a});return n.model.model.hasTreeStructure(V)&&(h.attachTreeStructure(V),s.forEach(t=>{let e=n.model.model.getParent(t.id,V);e&&h.hasNode(e.id)&&h.setParent(t.id,e.id,V)})),h}constructor(t,e){if(super(t,e),this.instance=new g({}),this.id=this.instance.id,"stop"in this.instance&&"tick"in this.instance){let t=this.instance;this.stop=t.stop.bind(t),this.tick=e=>{let n=t.tick(e);return i7(n)}}}}),y=new f(this.context),m={nodeSize:p,width:d,height:c,center:u};switch(y.id){case"d3-force":case"d3-force-3d":Object.assign(m,{center:{x:d/2,y:c/2,z:0}})}return(0,ed.Z)(y.options,m,h),y}updateElementPosition(t,e){let{model:n,element:i}=this.context;return i?(n.updateData(t),i.draw({animation:e,silence:!0})):null}destroy(){var t;this.stopLayout(),this.context={},null===(t=this.supervisor)||void 0===t||t.kill(),this.supervisor=void 0,this.instance=void 0,this.instances=[],this.animationResult=void 0}constructor(t){this.instances=[],this.context=t}}let ab=(t,e)=>{var n;let[i,r]=e;null===(n=t.nodes)||void 0===n||n.forEach(t=>{if(t.style){let{x:e=0,y:n=0}=t.style;t.style.x=e+i,t.style.y=n+r}else t.style={x:i,y:r}})};function aE(t){return!t.layout||Array.isArray(t.layout)||"preLayout"in t.layout||["antv-dagre","combo-combined","compact-box","circular","concentric","dagre","fishbone","grid","indented","mds","radial","random","snake","dendrogram","mindmap"].includes(t.layout.type)&&(t.layout.preLayout=!0),t}class ax extends eo{setPlugins(t){this.setExtensions(t)}getPluginInstance(t){let e=this.extensionMap[t];if(e)return e;U.warn("Cannot find the plugin ".concat(t,", will try to find it by type."));let n=this.extensions.find(e=>e.type===t);if(n)return this.extensionMap[n.key]}constructor(t){super(t),this.category="plugin",this.setPlugins(this.context.options.plugins||[])}}let aO=["update-related-edges","collapse-expand-node","collapse-expand-combo","get-edge-actual-ends","arrange-draw-order"];class aw extends eo{getTransforms(){}setTransforms(t){this.setExtensions([...aO.slice(0,aO.length-1),...t,aO[aO.length-1]])}getTransformInstance(t){return t?this.extensionMap[t]:this.extensionMap}constructor(t){super(t),this.category="transform",this.setTransforms(this.context.options.transforms||[])}}var aS=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class aD{get padding(){return tg(this.context.options.padding)}get paddingOffset(){let[t,e,n,i]=this.padding,[r,s,o]=[(i-e)/2,(t-n)/2,0];return[r,s,o]}get camera(){let{canvas:t}=this.context;return new Proxy(t.getCamera(),{get:(e,n)=>{let i=Object.entries(t.getLayers()).filter(t=>{let[e]=t;return!["main"].includes(e)}),r=i.map(t=>{let[,e]=t;return e.getCamera()}),s=e[n];if("function"==typeof s)return function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];let a=s.apply(e,i);return r.forEach(t=>{t[n].apply(t,i)}),a}}})}createLandmark(t){return this.camera.createLandmark("landmark-".concat(this.landmarkCounter++),t)}getAnimation(t){let e=J(this.context.options,t);return!!e&&(0,nz.Z)(Object.assign({},e),["easing","duration"])}getCanvasSize(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e,n]}getCanvasCenter(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e/2,n/2,0]}getViewportCenter(){let[t,e]=this.camera.getPosition();return[t,e,0]}getGraphCenter(){return this.context.graph.getViewportByCanvas(this.getCanvasCenter())}getZoom(){return this.camera.getZoom()}getRotation(){return this.camera.getRoll()}getTranslateOptions(t){let{camera:e}=this,{mode:n,translate:i=[]}=t,r=this.getZoom(),s=e.getPosition(),o=e.getFocalPoint(),[a,l]=this.getCanvasCenter(),[h=0,d=0,c=0]=i,u=ef([-h,-d,-c],r);return"relative"===n?{position:eu(s,u),focalPoint:eu(o,u)}:{position:eu([a,l,s[2]],u),focalPoint:eu([a,l,o[2]],u)}}getRotateOptions(t){let{mode:e,rotate:n=0}=t,i="relative"===e?this.camera.getRoll()+n:n;return{roll:i}}getZoomOptions(t){let{zoomRange:e}=this.context.options,n=this.camera.getZoom(),{mode:i,scale:r=1}=t;return(0,rh.Z)("relative"===i?n*r:r,...e)}transform(t,e){return aS(this,void 0,void 0,function*(){let{graph:n}=this.context,{translate:i,rotate:r,scale:s,origin:o}=t;this.cancelAnimation();let a=this.getAnimation(e);if(o4(n,new o6(D.BEFORE_TRANSFORM,t)),!r&&s&&!i&&o&&!a){this.camera.setZoomByViewportPoint(this.getZoomOptions(t),o),o4(n,new o6(D.AFTER_TRANSFORM,t));return}let l={};if(i&&Object.assign(l,this.getTranslateOptions(t)),(0,Q.Z)(r)&&Object.assign(l,this.getRotateOptions(t)),(0,Q.Z)(s)&&Object.assign(l,{zoom:this.getZoomOptions(t)}),a)return o4(n,new o2(D.BEFORE_ANIMATE,b.TRANSFORM,null,t)),new Promise(e=>{this.transformResolver=e,this.camera.gotoLandmark(this.createLandmark(l),Object.assign(Object.assign({},a),{onfinish:()=>{o4(n,new o2(D.AFTER_ANIMATE,b.TRANSFORM,null,t)),o4(n,new o6(D.AFTER_TRANSFORM,t)),this.transformResolver=void 0,e()}}))});this.camera.gotoLandmark(this.createLandmark(l),{duration:0}),o4(n,new o6(D.AFTER_TRANSFORM,t))})}fitView(t,e){return aS(this,void 0,void 0,function*(){let[n,i,r,s]=this.padding,{when:o="always",direction:a="both"}=t||{},[l,h]=this.context.canvas.getSize(),d=l-s-i,c=h-n-r,u=this.context.canvas.getBounds(),p=this.getBBoxInViewport(u),[g,f]=tm(p);if("overflow"===o&&!("x"===a&&g>=d||"y"===a&&f>=c||"both"===a&&g>=d&&f>=c))return yield this.fitCenter({animation:e});let y=d/g,m=c/f,v="x"===a?y:"y"===a?m:Math.min(y,m),b=this.getAnimation(e);yield this.transform({mode:"relative",scale:v,translate:eu(ep(this.getCanvasCenter(),this.getBBoxInViewport(u).center),ef(this.paddingOffset,v))},b)})}fitCenter(t){return aS(this,void 0,void 0,function*(){let e=this.context.canvas.getBounds();yield this.focus(e,t)})}focusElements(t){return aS(this,arguments,void 0,function*(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{element:n}=this.context;if(!n)return;let i=t=>e.shapes?t.getShape(e.shapes).getRenderBounds():t.getRenderBounds(),r=tx(t.map(t=>i(n.getElement(t))));yield this.focus(r,e)})}focus(t,e){return aS(this,void 0,void 0,function*(){let n=this.context.graph.getViewportByCanvas(t.center),i=e.position||this.getCanvasCenter(),r=ep(i,n);yield this.transform({mode:"relative",translate:eu(r,this.paddingOffset)},e.animation)})}getBBoxInViewport(t){let{min:e,max:n}=t,{graph:i}=this.context,[r,s]=i.getViewportByCanvas(e),[o,a]=i.getViewportByCanvas(n),l=new j.mN;return l.setMinMax([r,s,0],[o,a,0]),l}isInViewport(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{graph:i}=this.context,r=this.getCanvasSize(),[s,o]=i.getCanvasByViewport([0,0]),[a,l]=i.getCanvasByViewport(r),h=new j.mN;return h.setMinMax([s,o,0],[a,l,0]),n&&(h=tE(h,n)),tu(t)?tO(t,h):e?function(t,e){let[n,i]=t.min,[r,s]=t.max,[o,a]=e.min,[l,h]=e.max;return n>=o&&r<=l&&i>=a&&s<=h}(t,h):h.intersects(t)}cancelAnimation(){var t,e;(null===(t=this.camera.landmarks)||void 0===t?void 0:t.length)&&this.camera.cancelLandmarkAnimation(),null===(e=this.transformResolver)||void 0===e||e.call(this)}constructor(t){this.landmarkCounter=0,this.context=t;let[e,n]=this.paddingOffset,{zoom:i,rotation:r,x:s=e,y:o=n}=t.options;this.transform({mode:"absolute",scale:i,translate:[s,o],rotate:r},!1)}}var aC=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{l(i.next(t))}catch(t){s(t)}}function a(t){try{l(i.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}l((i=i.apply(t,e||[])).next())})};class aM extends sv.Z{getOptions(){return this.options}setOptions(t){this._setOptions(t,!1)}_setOptions(t,e){if(this.updateCanvas(t),Object.assign(this.options,[aE].reduce((t,e)=>e(t),t)),e){let{data:e}=t;e&&this.addData(e);return}let{behaviors:n,combo:i,data:r,edge:s,layout:o,node:a,plugins:l,theme:h,transforms:d}=t;n&&this.setBehaviors(n),r&&this.setData(r),a&&this.setNode(a),s&&this.setEdge(s),i&&this.setCombo(i),o&&this.setLayout(o),h&&this.setTheme(h),l&&this.setPlugins(l),d&&this.setTransforms(d)}getSize(){return this.context.canvas?this.context.canvas.getSize():[this.options.width||0,this.options.height||0]}setSize(t,e){t&&(this.options.width=t),e&&(this.options.height=e),this.resize(t,e)}setZoomRange(t){this.options.zoomRange=t}getZoomRange(){return this.options.zoomRange}setNode(t){this.options.node=t,this.context.model.refreshData()}setEdge(t){this.options.edge=t,this.context.model.refreshData()}setCombo(t){this.options.combo=t,this.context.model.refreshData()}getTheme(){return this.options.theme}setTheme(t){this.options.theme=(0,to.Z)(t)?t(this.getTheme()):t}setLayout(t){this.options.layout=(0,to.Z)(t)?t(this.getLayout()):t}getLayout(){return this.options.layout}setBehaviors(t){var e;this.options.behaviors=(0,to.Z)(t)?t(this.getBehaviors()):t,null===(e=this.context.behavior)||void 0===e||e.setBehaviors(this.options.behaviors)}updateBehavior(t){this.setBehaviors(e=>e.map(e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e))}getBehaviors(){return this.options.behaviors||[]}setPlugins(t){var e;this.options.plugins=(0,to.Z)(t)?t(this.getPlugins()):t,null===(e=this.context.plugin)||void 0===e||e.setPlugins(this.options.plugins)}updatePlugin(t){this.setPlugins(e=>e.map(e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e))}getPlugins(){return this.options.plugins||[]}getPluginInstance(t){return this.context.plugin.getPluginInstance(t)}setTransforms(t){var e;this.options.transforms=(0,to.Z)(t)?t(this.getTransforms()):t,null===(e=this.context.transform)||void 0===e||e.setTransforms(this.options.transforms)}updateTransform(t){this.setTransforms(e=>e.map(e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e)),this.context.model.refreshData()}getTransforms(){return this.options.transforms||[]}getData(){return this.context.model.getData()}getElementData(t){return Array.isArray(t)?t.map(t=>this.context.model.getElementDataById(t)):this.context.model.getElementDataById(t)}getNodeData(t){var e;return void 0===t?this.context.model.getNodeData():Array.isArray(t)?this.context.model.getNodeData(t):null===(e=this.context.model.getNodeData([t]))||void 0===e?void 0:e[0]}getEdgeData(t){var e;return void 0===t?this.context.model.getEdgeData():Array.isArray(t)?this.context.model.getEdgeData(t):null===(e=this.context.model.getEdgeData([t]))||void 0===e?void 0:e[0]}getComboData(t){var e;return void 0===t?this.context.model.getComboData():Array.isArray(t)?this.context.model.getComboData(t):null===(e=this.context.model.getComboData([t]))||void 0===e?void 0:e[0]}setData(t){this.context.model.setData((0,to.Z)(t)?t(this.getData()):t)}addData(t){this.context.model.addData((0,to.Z)(t)?t(this.getData()):t)}addNodeData(t){this.context.model.addNodeData((0,to.Z)(t)?t(this.getNodeData()):t)}addEdgeData(t){this.context.model.addEdgeData((0,to.Z)(t)?t(this.getEdgeData()):t)}addComboData(t){this.context.model.addComboData((0,to.Z)(t)?t(this.getComboData()):t)}addChildrenData(t,e){this.context.model.addChildrenData(t,e)}updateData(t){this.context.model.updateData((0,to.Z)(t)?t(this.getData()):t)}updateNodeData(t){this.context.model.updateNodeData((0,to.Z)(t)?t(this.getNodeData()):t)}updateEdgeData(t){this.context.model.updateEdgeData((0,to.Z)(t)?t(this.getEdgeData()):t)}updateComboData(t){this.context.model.updateComboData((0,to.Z)(t)?t(this.getComboData()):t)}removeData(t){this.context.model.removeData((0,to.Z)(t)?t(this.getData()):t)}removeNodeData(t){this.context.model.removeNodeData((0,to.Z)(t)?t(this.getNodeData()):t)}removeEdgeData(t){this.context.model.removeEdgeData((0,to.Z)(t)?t(this.getEdgeData()):t)}removeComboData(t){this.context.model.removeComboData((0,to.Z)(t)?t(this.getComboData()):t)}getElementType(t){return this.context.model.getElementType(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.context.model.getRelatedEdgesData(t,e)}getNeighborNodesData(t){return this.context.model.getNeighborNodesData(t)}getAncestorsData(t,e){return this.context.model.getAncestorsData(t,e)}getParentData(t,e){return this.context.model.getParentData(t,e)}getChildrenData(t){return this.context.model.getChildrenData(t)}getDescendantsData(t){return this.context.model.getDescendantsData(t)}getElementDataByState(t,e){return this.context.model.getElementDataByState(t,e)}initCanvas(){return aC(this,void 0,void 0,function*(){var t;if(this.context.canvas)return yield this.context.canvas.ready;let{container:e="container",width:n,height:i,renderer:r,cursor:s,background:o,canvas:a,devicePixelRatio:l=null!==(t=globalThis.devicePixelRatio)&&void 0!==t?t:1}=this.options;if(e instanceof oX)this.context.canvas=e,s&&e.setCursor(s),r&&e.setRenderer(r),yield e.ready;else{let t=(0,eZ.Z)(e)?document.getElementById(e):e,h=oQ(t);this.emit(D.BEFORE_CANVAS_INIT,{container:t,width:n,height:i});let d=Object.assign(Object.assign({},a),{container:t,width:n||h[0],height:i||h[1],background:o,renderer:r,cursor:s,devicePixelRatio:l}),c=new oX(d);this.context.canvas=c,yield c.ready,this.emit(D.AFTER_CANVAS_INIT,{canvas:c})}})}updateCanvas(t){var e,n;let{renderer:i,cursor:r,height:s,width:o}=t,a=this.context.canvas;a&&(i&&(this.emit(D.BEFORE_RENDERER_CHANGE,{renderer:this.options.renderer}),a.setRenderer(i),this.emit(D.AFTER_RENDERER_CHANGE,{renderer:i})),r&&a.setCursor(r),((0,Q.Z)(o)||(0,Q.Z)(s))&&this.setSize(null!==(e=null!=o?o:this.options.width)&&void 0!==e?e:0,null!==(n=null!=s?s:this.options.height)&&void 0!==n?n:0))}initRuntime(){this.context.options=this.options,this.context.batch||(this.context.batch=new ae(this.context)),this.context.plugin||(this.context.plugin=new ax(this.context)),this.context.viewport||(this.context.viewport=new aD(this.context)),this.context.transform||(this.context.transform=new aw(this.context)),this.context.element||(this.context.element=new au(this.context)),this.context.animation||(this.context.animation=new at(this.context)),this.context.layout||(this.context.layout=new av(this.context)),this.context.behavior||(this.context.behavior=new an(this.context))}prepare(){return aC(this,void 0,void 0,function*(){if(yield Promise.resolve(),this.destroyed)throw Error(Y("The graph instance has been destroyed"));yield this.initCanvas(),this.initRuntime()})}render(){return aC(this,void 0,void 0,function*(){if(yield this.prepare(),o4(this,new o1(D.BEFORE_RENDER)),this.options.layout){var t;if(!this.rendered&&!Array.isArray(t=this.options.layout)&&(null==t?void 0:t.preLayout)){let t=yield this.context.element.preLayoutDraw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.autoFit()])}else{let t=this.context.element.draw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.context.layout.postLayout()]),yield this.autoFit()}}else{let t=this.context.element.draw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.autoFit()])}this.rendered=!0,o4(this,new o1(D.AFTER_RENDER))})}draw(){return aC(this,void 0,void 0,function*(){var t;yield this.prepare(),yield null===(t=this.context.element.draw())||void 0===t?void 0:t.finished})}layout(){return aC(this,void 0,void 0,function*(){yield this.context.layout.postLayout()})}stopLayout(){this.context.layout.stopLayout()}clear(){return aC(this,void 0,void 0,function*(){let{model:t,element:e}=this.context;t.setData({}),t.clearChanges(),null==e||e.clear()})}destroy(){var t;o4(this,new o1(D.BEFORE_DESTROY));let{layout:e,animation:n,element:i,model:r,canvas:s,behavior:o,plugin:a}=this.context;null==a||a.destroy(),null==o||o.destroy(),null==e||e.destroy(),null==n||n.destroy(),null==i||i.destroy(),r.destroy(),null==s||s.destroy(),this.options={},this.context={},this.off(),null===(t=globalThis.removeEventListener)||void 0===t||t.call(globalThis,"resize",this.onResize),this.destroyed=!0,o4(this,new o1(D.AFTER_DESTROY))}getCanvas(){return this.context.canvas}resize(t,e){var n;let i=oQ(null===(n=this.context.canvas)||void 0===n?void 0:n.getContainer()),r=[t||i[0],e||i[1]];if(!this.context.canvas)return;let s=this.context.canvas.getSize();(0,F.Z)(r,s)||(o4(this,new o1(D.BEFORE_SIZE_CHANGE,{size:r})),this.context.canvas.resize(...r),o4(this,new o1(D.AFTER_SIZE_CHANGE,{size:r})))}fitView(t,e){return aC(this,void 0,void 0,function*(){var n;yield null===(n=this.context.viewport)||void 0===n?void 0:n.fitView(t,e)})}fitCenter(t){return aC(this,void 0,void 0,function*(){var e;yield null===(e=this.context.viewport)||void 0===e?void 0:e.fitCenter({animation:t})})}autoFit(){return aC(this,void 0,void 0,function*(){let{autoFit:t}=this.context.options;if(t){if((0,eZ.Z)(t))"view"===t?yield this.fitView():"center"===t&&(yield this.fitCenter());else{let{type:e,animation:n}=t;"view"===e?yield this.fitView(t.options,n):"center"===e&&(yield this.fitCenter(n))}}})}focusElement(t,e){return aC(this,void 0,void 0,function*(){var n;yield null===(n=this.context.viewport)||void 0===n?void 0:n.focusElements(Array.isArray(t)?t:[t],{animation:e})})}zoomBy(t,e,n){return aC(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",scale:t,origin:n},e)})}zoomTo(t,e,n){return aC(this,void 0,void 0,function*(){this.context.viewport.transform({mode:"absolute",scale:t,origin:n},e)})}getZoom(){return this.context.viewport.getZoom()}rotateBy(t,e,n){return aC(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",rotate:t,origin:n},e)})}rotateTo(t,e,n){return aC(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"absolute",rotate:t,origin:n},e)})}getRotation(){return this.context.viewport.getRotation()}translateBy(t,e){return aC(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"relative",translate:t},e)})}translateTo(t,e){return aC(this,void 0,void 0,function*(){yield this.context.viewport.transform({mode:"absolute",translate:t},e)})}getPosition(){return ep([0,0],this.getCanvasByViewport([0,0]))}translateElementBy(t,e){return aC(this,arguments,void 0,function*(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,s]=(0,_.Z)(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(r).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeBy(e,n)}),yield null===(n=this.context.element.draw({animation:s,stage:"translate"}))||void 0===n?void 0:n.finished})}translateElementTo(t,e){return aC(this,arguments,void 0,function*(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,s]=(0,_.Z)(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(r).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeTo(e,n)}),yield null===(n=this.context.element.draw({animation:s,stage:"translate"}))||void 0===n?void 0:n.finished})}getElementPosition(t){return this.context.model.getElementPosition(t)}getElementRenderStyle(t){return(0,rP.Z)(this.context.element.getElement(t).attributes,["context"])}setElementVisibility(t,e){return aC(this,arguments,void 0,function*(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,s]=(0,_.Z)(t)?[t,null==e||e]:[{[t]:e},i],o={nodes:[],edges:[],combos:[]};Object.entries(r).forEach(t=>{let[e,n]=t,i=this.getElementType(e);o["".concat(i,"s")].push({id:e,style:{visibility:n}})});let{model:a,element:l}=this.context;a.preventUpdateNodeLikeHierarchy(()=>{a.updateData(o)}),yield null===(n=l.draw({animation:s,stage:"visibility"}))||void 0===n?void 0:n.finished})}showElement(t,e){return aC(this,void 0,void 0,function*(){let n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"visible"])),e)})}hideElement(t,e){return aC(this,void 0,void 0,function*(){let n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"hidden"])),e)})}getElementVisibility(t){var e,n;let i=this.context.element.getElement(t);return null!==(n=null===(e=null==i?void 0:i.style)||void 0===e?void 0:e.visibility)&&void 0!==n?n:"visible"}setElementZIndex(t,e){return aC(this,void 0,void 0,function*(){var n;let i={nodes:[],edges:[],combos:[]},r=(0,_.Z)(t)?t:{[t]:e};Object.entries(r).forEach(t=>{let[e,n]=t,r=this.getElementType(e);i["".concat(r,"s")].push({id:e,style:{zIndex:n}})});let{model:s,element:o}=this.context;s.preventUpdateNodeLikeHierarchy(()=>s.updateData(i)),yield null===(n=o.draw({animation:!1,stage:"zIndex"}))||void 0===n?void 0:n.finished})}frontElement(t){return aC(this,void 0,void 0,function*(){let e=Array.isArray(t)?t:[t],{model:n}=this.context,i={};e.map(t=>{let e=n.getFrontZIndex(t),r=n.getElementType(t);if("combo"===r){let r=n.getAncestorsData(t,V).at(-1)||this.getComboData(t),s=[r,...n.getDescendantsData(t6(r))],o=e-o8(r);s.forEach(t=>{i[t6(t)]=this.getElementZIndex(t6(t))+o});let{internal:a}=is(s.map(t6),t=>n.getRelatedEdgesData(t));a.forEach(t=>{let e=t6(t);i[e]=this.getElementZIndex(e)+o})}else i[t]=e}),yield this.setElementZIndex(i)})}getElementZIndex(t){return o8(this.context.model.getElementDataById(t))}setElementState(t,e){return aC(this,arguments,void 0,function*(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,s]=(0,_.Z)(t)?[t,null==e||e]:[{[t]:e},i],o=t=>t?Array.isArray(t)?t:[t]:[],a={nodes:[],edges:[],combos:[]};Object.entries(r).forEach(t=>{let[e,n]=t,i=this.getElementType(e);a["".concat(i,"s")].push({id:e,states:o(n)})}),this.updateData(a),yield null===(n=this.context.element.draw({animation:s,stage:"state"}))||void 0===n?void 0:n.finished})}getElementState(t){return this.context.model.getElementState(t)}getElementRenderBounds(t){return this.context.element.getElement(t).getRenderBounds()}collapseElement(t){return aC(this,arguments,void 0,function*(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(eQ(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;"boolean"==typeof e&&(e={animation:e,align:!0});let r=n.getElementType(t);yield this.frontElement(t),this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!0),"node"===r?yield i.collapseNode(t,e):"combo"===r&&(yield i.collapseCombo(t,!!e.animation)),this.isCollapsingExpanding=!1})}expandElement(t){return aC(this,arguments,void 0,function*(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(!eQ(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;"boolean"==typeof e&&(e={animation:e,align:!0});let r=n.getElementType(t);this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!1),"node"===r?yield i.expandNode(t,e):"combo"===r&&(yield i.expandCombo(t,!!e.animation)),this.isCollapsingExpanding=!1})}setElementCollapsibility(t,e){let n=this.getElementType(t);"node"===n?this.updateNodeData([{id:t,style:{collapsed:e}}]):"combo"===n&&this.updateComboData([{id:t,style:{collapsed:e}}])}toDataURL(){return aC(this,arguments,void 0,function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.context.canvas.toDataURL(t)})}getCanvasByViewport(t){return this.context.canvas.getCanvasByViewport(t)}getViewportByCanvas(t){return this.context.canvas.getViewportByCanvas(t)}getClientByCanvas(t){return this.context.canvas.getClientByCanvas(t)}getCanvasByClient(t){return this.context.canvas.getCanvasByClient(t)}getViewportCenter(){return this.context.viewport.getViewportCenter()}getCanvasCenter(){return this.context.viewport.getCanvasCenter()}on(t,e,n){return super.on(t,e,n)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}constructor(t){var e;super(),this.options={},this.rendered=!1,this.destroyed=!1,this.context={model:new ad},this.isCollapsingExpanding=!1,this.onResize=(0,i1.Z)(()=>{this.resize()},300),this._setOptions(Object.assign({},aM.defaultOptions,t),!0),this.context.graph=this,this.options.autoResize&&(null===(e=globalThis.addEventListener)||void 0===e||e.call(globalThis,"resize",this.onResize))}}aM.defaultOptions={autoResize:!1,theme:"light",rotation:0,zoom:1,zoomRange:[.01,10]};let aT=(t,e)=>{let{source:n,target:i}=e,r=t.getElementDataById(n),s=t.getElementDataById(i),o=io(r,e=>t.getParentData(e,V)),a=io(s,e=>t.getParentData(e,V)),l=t6(o),h=t6(a),d={sourceNode:l,targetNode:h};return e.style?Object.assign(e.style,d):e.style=d,e},aA=(t,e,n)=>{let[i,r]=e,[s,o]=n;return r===i?s:s+(t-i)/(r-i)*(o-s)},aL=(t,e,n)=>{let[i,r]=e,[s,o]=n;return s+Math.log(t-i+1)/Math.log(r-i+1)*(o-s)},aR=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,[r,s]=e,[o,a]=n;return o+Math.pow((t-r)/(s-r),i)*(a-o)},aP=(t,e,n)=>{let[i,r]=e,[s,o]=n;return s+Math.sqrt((t-i)/(r-i))*(o-s)};class ak extends oF{beforeDraw(t){let{model:e}=this.context,n=e.getNodeData(),i=e9(this.options.maxSize),r=e9(this.options.minSize),s=this.getCentralities(this.options.centrality),o=s.size>0?Math.max(...s.values()):0,a=s.size>0?Math.min(...s.values()):0;return n.forEach(e=>{var n;let l=this.assignSizeByCentrality(s.get(t6(e))||0,a,o,r,i,this.options.scale),h=null===(n=this.context.element)||void 0===n?void 0:n.getElement(t6(e)),d={size:l};this.assignLabelStyle(d,l,e,h),h&&oz(d,h.attributes)||o_(t,h?"update":"add","node",(0,ed.Z)(e,{style:d}),!0)}),t}assignLabelStyle(t,e,n,i){var r;let s=i?i.config.style:null===(r=this.context.element)||void 0===r?void 0:r.getElementComputedStyle("node",n);if(Object.assign(t,(0,nz.Z)(s,["labelFontSize","labelLineHeight"])),this.options.mapLabelSize){let n=this.getLabelSizeByNodeSize(e,1/0,Number(t.labelFontSize));Object.assign(t,{labelFontSize:n,labelLineHeight:n+function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=tg(t);return e[0]+e[2]}(t.labelPadding)})}return t}getLabelSizeByNodeSize(t,e,n){let[i,r]=Array.isArray(this.options.mapLabelSize)?this.options.mapLabelSize:[n,e];return Math.min(r,Math.max(Math.min(...t)/2,i))}getCentralities(t){let{model:e}=this.context,n=e.getData();if("function"==typeof t)return t(n);let i=e.getRelatedEdgesData.bind(e);return t8(n,i,t)}constructor(t,e){super(t,(0,ed.Z)({},ak.defaultOptions,e)),this.assignSizeByCentrality=(t,e,n,i,r,s)=>{let o=[e,n],a=[i[0],r[0]],l=[i[1],r[1]],h=[i[2],r[2]],d=(t,e)=>{if("function"==typeof s)return s(t,o,e);switch(s){case"linear":return aA(t,o,e);case"log":return aL(t,o,e);case"pow":return aR(t,o,e,2);case"sqrt":return aP(t,o,e);default:return e[0]}};return[d(t,a),d(t,l),d(t,h)]}}}ak.defaultOptions={centrality:{type:"degree"},maxSize:80,minSize:20,scale:"linear",mapLabelSize:!1};class aN extends oF{get ref(){return this.context.model.getRootsData()[0]}afterLayout(){var t;let e=eT(this.ref),{graph:n,model:i}=this.context,r=i.getData();null===(t=r.nodes)||void 0===t||t.forEach(t=>{var r;if(t6(t)===t6(this.ref))return;let s=eS(ep(eT(t),e)),o=Math.abs(s)>Math.PI/2,a=!t.children||0===t.children.length,l=t6(t),h=null===(r=this.context.element)||void 0===r?void 0:r.getElement(l);if(!h||!h.isVisible())return;let d=e9(n.getElementRenderStyle(l).size)[0]/2,c=(a?1:-1)*(d+this.options.offset),u=[["translate",c*Math.cos(s),c*Math.sin(s)],["rotate",o?(0,j.BV)(s)+180:(0,j.BV)(s)]];i.updateNodeData([{id:t6(t),style:{labelTextAlign:o===a?"right":"left",labelTextBaseline:"middle",labelTransform:u}}])}),n.draw()}constructor(t,e){super(t,Object.assign({},aN.defaultOptions,e))}}aN.defaultOptions={offset:5};var aj=n(65029);let aI=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class aB extends oF{beforeDraw(t){let e=this.getAffectedParallelEdges(t);return 0===e.size||("bundle"===this.options.mode?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}constructor(t,e){super(t,Object.assign({},aB.defaultOptions,e)),this.cacheMergeStyle=new Map,this.getAffectedParallelEdges=t=>{let{add:{edges:e},update:{nodes:n,edges:i,combos:r},remove:{edges:s}}=t,{model:o}=this.context,a=new Map,l=(t,e)=>{let n=o.getRelatedEdgesData(e);n.forEach(t=>!a.has(t6(t))&&a.set(t6(t),t))};n.forEach(l),r.forEach(l);let h=t=>{let e=o.getEdgeData().map(t=>aT(o,t)),n=a_(t,e,!0);n.forEach(t=>!a.has(t6(t))&&a.set(t6(t),t))};if(s.size&&s.forEach(h),e.size&&e.forEach(h),i.size){let t=sE(sb(o.getChanges())).update.edges;i.forEach(e=>{var n;h(e);let i=null===(n=t.find(t=>t6(t.value)===t6(e)))||void 0===n?void 0:n.original;i&&!az(e,i)&&h(i)})}nd(this.options.edges)||a.forEach((t,e)=>!this.options.edges.includes(e)&&a.delete(e));let d=o.getEdgeData().map(t6);return new Map([...a].sort((t,e)=>d.indexOf(t[0])-d.indexOf(e[0])))},this.applyBundlingStyle=(t,e,n)=>{let{edgeMap:i,reverses:r}=aF(e);i.forEach(e=>{e.forEach((e,i,s)=>{var o;let a=s.length,l=e.style||{};if(e.source===e.target){let t=aI.length;l.loopPlacement=aI[i%t],l.loopDist=Math.floor(i/t)*n+50}else if(1===a)l.curveOffset=0;else{let t=(i%2==0?1:-1)*(r["".concat(e.source,"|").concat(e.target,"|").concat(i)]?-1:1);l.curveOffset=a%2==1?t*Math.ceil(i/2)*n*2:t*(Math.floor(i/2)*n*2+n)}let h=Object.assign(e,{type:"quadratic",style:l}),d=null===(o=this.context.element)||void 0===o?void 0:o.getElement(t6(e));d&&oz(h.style,d.attributes)||o_(t,d?"update":"add","edge",h,!0)})})},this.resetEdgeStyle=t=>{let e=t.style||{},n=this.cacheMergeStyle.get(t6(t))||{};return Object.keys(n).forEach(i=>{(0,F.Z)(e[i],n[i])&&(t[i]?e[i]=t[i]:delete e[i])}),Object.assign(t,{style:e})},this.applyMergingStyle=(t,e)=>{let{edgeMap:n,reverses:i}=aF(e);n.forEach(e=>{var n;if(1===e.length){let i=e[0],r=null===(n=this.context.element)||void 0===n?void 0:n.getElement(t6(i)),s=this.resetEdgeStyle(i);r&&oz(s,r.attributes)||o_(t,r?"update":"add","edge",s);return}let r=e.map((t,e)=>{let{source:n,target:r,style:s={}}=t,{startArrow:o,endArrow:a}=s,l={},[h,d]=i["".concat(n,"|").concat(r,"|").concat(e)]?["endArrow","startArrow"]:["startArrow","endArrow"];return(0,aj.Z)(o)&&(l[h]=o),(0,aj.Z)(a)&&(l[d]=a),l}).reduce((t,e)=>Object.assign(Object.assign({},t),e),{});e.forEach((e,n,i)=>{var s;if(0!==n){o_(t,"remove","edge",e);return}let o=Object.assign({},(0,to.Z)(this.options.style)?this.options.style(i):this.options.style,{childrenData:i});this.cacheMergeStyle.set(t6(e),o);let a=Object.assign(Object.assign({},e),{type:"line",style:Object.assign(Object.assign(Object.assign({},e.style),r),o)}),l=null===(s=this.context.element)||void 0===s?void 0:s.getElement(t6(e));l&&oz(a.style,l.attributes)||o_(t,l?"update":"add","edge",a,!0)})})}}}aB.defaultOptions={mode:"bundle",distance:15};let aF=t=>{let e=new Map,n=new Set,i={};for(let[r,s]of t){if(n.has(r))continue;let{source:o,target:a}=s,l="".concat(o,"-").concat(a);for(let[h,d]of(e.has(l)||e.set(l,[]),e.get(l).push(s),n.add(r),t))!n.has(h)&&az(s,d)&&(e.get(l).push(d),n.add(h),o===d.target&&a===d.source&&(i["".concat(d.source,"|").concat(d.target,"|").concat(e.get(l).length-1)]=!0))}return{edgeMap:e,reverses:i}},a_=(t,e,n)=>e.filter(e=>(n||t6(e)!==t6(t))&&az(e,t)),az=(t,e)=>{let{sourceNode:n,targetNode:i}=t.style||{},{sourceNode:r,targetNode:s}=e.style||{};return n===r&&i===s||n===s&&i===r},aZ={animation:{"combo-collapse":ts,"combo-expand":ts,"node-collapse":ti,"node-expand":ti,"path-in":tr,"path-out":tr,fade:[{fields:["opacity"]}],translate:[{fields:["x","y"]}]},behavior:{"brush-select":eH,"click-select":eJ,"collapse-expand":i$,"create-edge":i0,"drag-canvas":i3,"drag-element-force":class extends i4{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find(t=>["d3-force","d3-force-3d"].includes(null==t?void 0:t.id))}validate(t){return!!this.context.layout&&(this.forceLayoutInstance?super.validate(t):(U.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1))}moveElement(t,e){var n,i,r,s;return n=this,i=void 0,r=void 0,s=function*(){let n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach((i,r)=>{let{x:s=0,y:o=0}=i.style||{};n&&rt(n,"setFixedPosition",t[r],[...eu([+s,+o],e)])})},new(r||(r=Promise))(function(t,e){function o(t){try{l(s.next(t))}catch(t){e(t)}}function a(t){try{l(s.throw(t))}catch(t){e(t)}}function l(e){var n;e.done?t(e.value):((n=e.value)instanceof r?n:new r(function(t){t(n)})).then(o,a)}l((s=s.apply(n,i||[])).next())})}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);let e=this.forceLayoutInstance;e&&re(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach(t=>{let{x:n=0,y:i=0}=t.style||{};e&&rt(e,"setFixedPosition",t6(t),[+n,+i])})}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){let t=this.forceLayoutInstance;t&&re(t,"simulation").alphaTarget(0),this.options.fixed||this.context.graph.getNodeData(this.target).forEach(e=>{t&&rt(t,"setFixedPosition",t6(e),[null,null,null])})}},"drag-element":i4,"fix-element-size":ri,"focus-element":rr,"hover-activate":rs,"lasso-select":class extends eH{onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;let{canvas:e}=this.context;this.pathShape=new j.y$({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[eG(t)]}onPointerMove(t){var e;if(!this.points)return;let{immediately:n,mode:i}=this.options;this.points.push(eG(t)),null===(e=this.pathShape)||void 0===e||e.setAttribute("d",function(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=[];return t.forEach((t,e)=>{n.push([0===e?"M":"L",...t])}),e&&n.push(["Z"]),n}(this.points)),n&&"default"===i&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){if(this.points){if(this.points.length<2){this.clearLasso();return}super.updateElementsStates(this.points),this.clearLasso()}}clearLasso(){var t;null===(t=this.pathShape)||void 0===t||t.remove(),this.pathShape=void 0,this.points=void 0}},"auto-adapt-label":eh,"optimize-viewport-transform":ro,"scroll-canvas":rl,"zoom-canvas":rc},combo:{circle:class extends nK{drawKeyShape(t,e){return this.upsert("key",j.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let{collapsed:e}=t,n=super.getKeyStyle(t),[i]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},n),e&&e6(n,"collapsed")),{r:i/2})}getCollapsedKeySize(t){let[e,n]=e9(t.collapsedSize),i=Math.max(e,n)/2;return[2*i,2*i,0]}getExpandedKeySize(t){let e=this.getContentBBox(t),[n,i]=tm(e),r=Math.sqrt(Math.pow(n,2)+Math.pow(i,2))/2;return[2*r,2*r,0]}getIntersectPoint(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getShape("key").getBounds();return eB(t,n,e)}constructor(t){super(t)}},rect:class extends nK{drawKeyShape(t,e){return this.upsert("key",j.UL,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},e),t.collapsed&&e6(e,"collapsed")),{width:n,height:i,x:-n/2,y:-i/2})}constructor(t){super(t)}}},edge:{cubic:im,line:ix,polyline:iP,quadratic:ik,"cubic-horizontal":iv,"cubic-radial":ib,"cubic-vertical":iE},layout:{"antv-dagre":rp.b,"combo-combined":rf.u,"compact-box":ru.compactBox,"d3-force":rm.j,"force-atlas2":rb.E,circular:rg.S,concentric:ry.W,dagre:rv.V,dendrogram:ru.dendrogram,fishbone:rM,force:rE.y,fruchterman:rx.O,grid:rO.M,indented:ru.indented,mds:rw.A,mindmap:ru.mindmap,radial:rS.D,random:rD._,snake:rR},node:{circle:nL,diamond:class extends nR{getPoints(t){let[e,n]=this.getSize(t);return[[0,-n/2],[e/2,0],[0,n/2],[-e/2,0]]}constructor(t){super(t)}},ellipse:nF,hexagon:class extends nR{getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){var e;return[[0,e=this.getOuterR(t)],[e*Math.sqrt(3)/2,e/2],[e*Math.sqrt(3)/2,-e/2],[0,-e],[-e*Math.sqrt(3)/2,-e/2],[-e*Math.sqrt(3)/2,e/2]]}getIconStyle(t){let e=super.getIconStyle(t),n=.8*this.getOuterR(t);return!!e&&Object.assign({width:n,height:n},e)}constructor(t){super(t)}},html:nW,image:nG,rect:class extends nA{getKeyStyle(t){let[e,n]=this.getSize(t);return Object.assign(Object.assign({},super.getKeyStyle(t)),{width:e,height:n,x:-e/2,y:-n/2})}getIconStyle(t){let e=super.getIconStyle(t),{width:n,height:i}=this.getShape("key").attributes;return!!e&&Object.assign({width:.8*n,height:.8*i},e)}drawKeyShape(t,e){return this.upsert("key",j.UL,this.getKeyStyle(t),e)}constructor(t){super(t)}},star:class extends nR{getInnerR(t){return t.innerR||3*this.getOuterR(t)/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){var e,n;return[[0,-(e=this.getOuterR(t))],[(n=this.getInnerR(t))*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)],[e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[0,n],[-e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[-n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[-e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[-n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)]]}getIconStyle(t){let e=super.getIconStyle(t),n=2*this.getInnerR(t)*.8;return!!e&&Object.assign({width:n,height:n},e)}getPortXY(t,e){let{placement:n="top"}=e,i=this.getShape("key").getLocalBounds(),r=function(t,e){let n={};return n.top=[0,-t],n.left=[-t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n["left-bottom"]=[-t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.bottom=[0,e],n["right-bottom"]=[t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.right=n.default=[t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n}(this.getOuterR(t),this.getInnerR(t));return i_(i,n,r,!1)}constructor(t){super(t)}},donut:nk,triangle:nY},palette:{spectral:["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],tableau:["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],oranges:["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],greens:["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],blues:["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"]},theme:{dark:oI,light:oB},plugin:{"bubble-sets":r7,"edge-bundling":sr,"edge-filter-lens":sp,"grid-line":sm,background:rI,contextmenu:si,fisheye:sf,fullscreen:sy,history:sx,hull:sL,legend:sN,minimap:sj,snapline:sz,timebar:ob,toolbar:oS,tooltip:oM,watermark:oR},transform:{"arrange-draw-order":class extends oF{beforeDraw(t){let{model:e}=this.context,n=t.add.combos,i=t=>{let n=[];return t.forEach((t,i)=>{let r=e.getAncestorsData(i,"combo"),s=r.map(t=>t6(t)).reverse();n.push([i,t,s.length])}),new Map(n.sort((t,e)=>{let[,,n]=t,[,,i]=e;return i-n}).map(t=>{let[e,n]=t;return[e,n]}))};return t.add.combos=i(n),t.update.combos=i(t.update.combos),t}},"collapse-expand-combo":class extends oF{beforeDraw(t,e){if("visibility"===e.stage||!this.context.model.model.hasTreeStructure(V))return t;let{model:n}=this.context,{add:i,update:r}=t,s=[...t.update.combos.entries(),...t.add.combos.entries()];for(;s.length;){let[e,o]=s.pop();if(eQ(o)){let o=n.getDescendantsData(e),a=o.map(t6),{internal:l,external:h}=is(a,t=>n.getRelatedEdgesData(t));o.forEach(e=>{let i=t6(e),r=s.findIndex(t=>{let[e]=t;return e===i});-1!==r&&s.splice(r,1);let o=n.getElementType(i);o_(t,"remove",o,e)}),l.forEach(e=>o_(t,"remove","edge",e)),h.forEach(t=>{var e;let n=t6(t),s=null===(e=this.context.element)||void 0===e?void 0:e.getElement(n);s?r.edges.set(n,t):i.edges.set(n,t)})}else{let i=n.getChildrenData(e),r=i.map(t6),{edges:o}=is(r,t=>n.getRelatedEdgesData(t));[...i,...o].forEach(e=>{var i;let r=t6(e),o=n.getElementType(r),a=null===(i=this.context.element)||void 0===i?void 0:i.getElement(r);a?o_(t,"update",o,e):o_(t,"add",o,e),"combo"===o&&s.push([r,e])})}}return t}},"collapse-expand-node":class extends oF{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(oZ(e,"add","node",t),eQ(t))return;let n=t6(t);oZ(e,"add","node",t);let i=this.context.model.getRelatedEdgesData(n,"out");i.forEach(t=>{o_(e,"add","edge",t)});let r=this.context.model.getChildrenData(n);r.forEach(t=>{this.handleExpand(t,e)})}beforeDraw(t){let{graph:e,model:n}=this.context;if(!n.model.hasTreeStructure(W))return t;let{add:{nodes:i,edges:r},update:{nodes:s}}=t,o=new Map,a=new Map;i.forEach((t,e)=>{eQ(t)&&o.set(e,t)}),r.forEach(t=>{if("node"!==e.getElementType(t.source))return;let n=e.getNodeData(t.source);eQ(n)&&o.set(t.source,n)}),s.forEach((t,e)=>{let n=this.getElement(e);if(!n)return;let i=n.attributes.collapsed;eQ(t)?i||o.set(e,t):i&&a.set(e,t)});let l=new Set;return o.forEach((e,i)=>{let r=n.getDescendantsData(i);r.forEach(e=>{let i=t6(e);if(l.has(i))return;o_(t,"remove","node",e);let r=n.getRelatedEdgesData(i);r.forEach(e=>{o_(t,"remove","edge",e)}),l.add(i)})}),a.forEach((e,i)=>{let r=n.getAncestorsData(i,W);if(r.some(eQ)){o_(t,"remove","node",e);return}this.handleExpand(e,t)}),t}},"get-edge-actual-ends":class extends oF{beforeDraw(t){let{add:e,update:n}=t,{model:i}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach(t=>{let[,e]=t;aT(i,e)}),t}},"map-node-size":ak,"place-radial-labels":aN,"process-parallel-edges":aB,"update-related-edges":class extends oF{beforeDraw(t,e){let{stage:n}=e;if("visibility"===n)return t;let{model:i}=this.context,{update:{nodes:r,edges:s,combos:o}}=t,a=(t,e)=>{let n=i.getRelatedEdgesData(e);n.forEach(t=>!s.has(t6(t))&&s.set(t6(t),t))};return r.forEach(a),o.forEach(a),t}}},shape:{circle:j.Cd,ellipse:j.Pj,group:j.ZA,html:j.k9,image:nx,line:j.x1,path:j.y$,polygon:j.mg,polyline:j.aH,rect:j.UL,text:j.xv,label:nf,badge:ny}};Object.entries(aZ).forEach(t=>{let[e,n]=t;Object.entries(n).forEach(t=>{let[n,i]=t;!function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=H[t][e];!i&&r?r!==n&&U.warn("The extension ".concat(e," of ").concat(t," has been registered before.")):Object.assign(H[t],{[e]:n})}(e,n,i)})})},83322:function(t,e,n){"use strict";n.d(e,{P3:function(){return c}});var i=n(38497),r=i.createContext({graph:null,isReady:!1}),s=n(6089),o=function(){return(o=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},l=function(){return(l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},h=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n},d=(0,i.forwardRef)(function(t,e){var n,d,c,u,p,g,f,y,m,v,b=t.style,E=t.children,x=(d=(n=h(t,["style","children"])).onInit,c=n.onReady,u=n.onDestroy,p=n.options,f=(g=a((0,i.useState)(!1),2))[0],y=g[1],m=(0,i.useRef)(null),v=(0,i.useRef)(null),(0,i.useEffect)(function(){if(!m.current&&v.current){var t=new s.kJ(o({container:v.current},p));return m.current=t,y(!0),null==d||d(m.current),function(){var t=m.current;t&&(t.destroy(),null==u||u(),m.current=null)}}},[]),(0,i.useEffect)(function(){var t=v.current,e=m.current;p&&t&&e&&!e.destroyed&&(e.setOptions(p),e.render().then(function(){return null==c?void 0:c(e)}))},[p]),{graph:m.current,containerRef:v,isReady:f}),O=x.graph,w=x.containerRef,S=x.isReady;(0,i.useImperativeHandle)(e,function(){return O},[O]);var D=l({height:"inherit",position:"relative"},b);return E?i.createElement(r.Provider,{value:{graph:O,isReady:S}},i.createElement("div",{ref:w,style:D},S&&E)):i.createElement("div",{ref:w,style:D})}),c=(0,i.memo)(d)},29244:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var i=n(12803),r=n(23241),s=n(33478);function o(t,e,n){return e=(0,i.Z)(e),(0,s.Z)(t,(0,r.Z)()?Reflect.construct(e,n||[],(0,i.Z)(t).constructor):e.apply(t,n))}},21150:function(t,e,n){"use strict";n.d(e,{Ud:function(){return c},Yy:function(){return s}});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let i=Symbol("Comlink.proxy"),r=Symbol("Comlink.endpoint"),s=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),l=t=>"object"==typeof t&&null!==t||"function"==typeof t,h=new Map([["proxy",{canHandle:t=>l(t)&&t[i],serialize(t){let{port1:e,port2:n}=new MessageChannel;return function t(e,n=globalThis,r=["*"]){n.addEventListener("message",function s(l){let h;if(!l||!l.data)return;if(!function(t,e){for(let n of t)if(e===n||"*"===n||n instanceof RegExp&&n.test(e))return!0;return!1}(r,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}let{id:c,type:u,path:p}=Object.assign({path:[]},l.data),g=(l.data.argumentList||[]).map(b);try{var f;let n=p.slice(0,-1).reduce((t,e)=>t[e],e),r=p.reduce((t,e)=>t[e],e);switch(u){case"GET":h=r;break;case"SET":n[p.slice(-1)[0]]=b(l.data.value),h=!0;break;case"APPLY":h=r.apply(n,g);break;case"CONSTRUCT":{let t=new r(...g);h=Object.assign(t,{[i]:!0})}break;case"ENDPOINT":{let{port1:n,port2:i}=new MessageChannel;t(e,i),f=[n],m.set(n,f),h=n}break;case"RELEASE":h=void 0;break;default:return}}catch(t){h={value:t,[a]:0}}Promise.resolve(h).catch(t=>({value:t,[a]:0})).then(t=>{let[i,r]=v(t);n.postMessage(Object.assign(Object.assign({},i),{id:c}),r),"RELEASE"===u&&(n.removeEventListener("message",s),d(n),o in e&&"function"==typeof e[o]&&e[o]())}).catch(t=>{let[e,i]=v({value:TypeError("Unserializable return value"),[a]:0});n.postMessage(Object.assign(Object.assign({},e),{id:c}),i)})}),n.start&&n.start()}(t,e),[n,[n]]},deserialize:t=>(t.start(),c(t))}],["throw",{canHandle:t=>l(t)&&a in t,serialize:({value:t})=>[t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[]],deserialize(t){if(t.isError)throw Object.assign(Error(t.value.message),t.value);throw t.value}}]]);function d(t){"MessagePort"===t.constructor.name&&t.close()}function c(t,e){let n=new Map;return t.addEventListener("message",function(t){let{data:e}=t;if(!e||!e.id)return;let i=n.get(e.id);if(i)try{i(e)}finally{n.delete(e.id)}}),function t(e,n,i=[],o=function(){}){let a=!1,l=new Proxy(o,{get(r,o){if(u(a),o===s)return()=>{f&&f.unregister(l),p(e),n.clear(),a=!0};if("then"===o){if(0===i.length)return{then:()=>l};let t=E(e,n,{type:"GET",path:i.map(t=>t.toString())}).then(b);return t.then.bind(t)}return t(e,n,[...i,o])},set(t,r,s){u(a);let[o,l]=v(s);return E(e,n,{type:"SET",path:[...i,r].map(t=>t.toString()),value:o},l).then(b)},apply(s,o,l){u(a);let h=i[i.length-1];if(h===r)return E(e,n,{type:"ENDPOINT"}).then(b);if("bind"===h)return t(e,n,i.slice(0,-1));let[d,c]=y(l);return E(e,n,{type:"APPLY",path:i.map(t=>t.toString()),argumentList:d},c).then(b)},construct(t,r){u(a);let[s,o]=y(r);return E(e,n,{type:"CONSTRUCT",path:i.map(t=>t.toString()),argumentList:s},o).then(b)}});return function(t,e){let n=(g.get(e)||0)+1;g.set(e,n),f&&f.register(t,e,t)}(l,e),l}(t,n,[],e)}function u(t){if(t)throw Error("Proxy has been released and is not useable")}function p(t){return E(t,new Map,{type:"RELEASE"}).then(()=>{d(t)})}let g=new WeakMap,f="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(g.get(t)||0)-1;g.set(t,e),0===e&&p(t)});function y(t){var e;let n=t.map(v);return[n.map(t=>t[0]),(e=n.map(t=>t[1]),Array.prototype.concat.apply([],e))]}let m=new WeakMap;function v(t){for(let[e,n]of h)if(n.canHandle(t)){let[i,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},r]}return[{type:"RAW",value:t},m.get(t)||[]]}function b(t){switch(t.type){case"HANDLER":return h.get(t.name).deserialize(t.value);case"RAW":return t.value}}function E(t,e,n,i){return new Promise(r=>{let s=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.set(s,r),t.start&&t.start(),t.postMessage(Object.assign({id:s},n),i)})}}}]);