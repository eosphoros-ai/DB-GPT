"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4457,9549],{76243:function(e,l,t){t.d(l,{Z:function(){return c}});var a=t(96469),n=t(32373),s=t(34934),r=t(6618),i=t(42746);function c(e){let{type:l}=e;return"TEXT"===l?(0,a.jsx)(n.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===l?(0,a.jsx)(s.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"YUQUEURL"===l?(0,a.jsx)(r.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,a.jsx)(i.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"})}},56982:function(e,l,t){t.d(l,{Z:function(){return en}});var a=t(96469),n=t(27623),s=t(45277),r=t(37022),i=t(56010),c=t(35732),o=t(29766),d=t(32982),u=t(40132),m=t(2537),x=t(52896),h=t(97511),p=t(67144),f=t(28062),j=t(67423),_=t(3936),g=t(16602),v=t(79839),b=t(70351),y=t(42786),N=t(10755),Z=t(55360),k=t(60205),w=t(49030),C=t(67661),S=t(27691),I=t(41999),P=t(67343),E=t(80335),T=t(97818),q=t(87674),F=t(26869),U=t.n(F),R=t(61671),D=t.n(R),A=t(87313),O=t(38497),V=t(56841),L=t(38437),M=t(30994),z=t(5996),G=t(79092),H=t(57668),Y=t(32594);let{TextArea:$}=I.default;function J(e){let{space:l,argumentsShow:t,setArgumentsShow:s}=e,{t:r}=(0,V.$G)(),[i,c]=(0,O.useState)(),[o,d]=(0,O.useState)(!1),u=async()=>{let[e,t]=await (0,n.Vx)((0,n.Tu)(l.name));c(t)};(0,O.useEffect)(()=>{u()},[l.name]);let m=[{key:"Embedding",label:(0,a.jsxs)("div",{children:[(0,a.jsx)(G.Z,{}),r("Embedding")]}),children:(0,a.jsxs)(L.Z,{gutter:24,children:[(0,a.jsx)(M.Z,{span:12,offset:0,children:(0,a.jsx)(Z.default.Item,{tooltip:r("the_top_k_vectors"),rules:[{required:!0}],label:r("topk"),name:["embedding","topk"],children:(0,a.jsx)(I.default,{className:"mb-5 h-12"})})}),(0,a.jsx)(M.Z,{span:12,children:(0,a.jsx)(Z.default.Item,{tooltip:r("Set_a_threshold_score"),rules:[{required:!0}],label:r("recall_score"),name:["embedding","recall_score"],children:(0,a.jsx)(I.default,{className:"mb-5  h-12",placeholder:"请输入"})})}),(0,a.jsx)(M.Z,{span:12,children:(0,a.jsx)(Z.default.Item,{tooltip:r("recall_type"),rules:[{required:!0}],label:r("recall_type"),name:["embedding","recall_type"],children:(0,a.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,a.jsx)(M.Z,{span:12,children:(0,a.jsx)(Z.default.Item,{tooltip:r("A_model_used"),rules:[{required:!0}],label:r("model"),name:["embedding","model"],children:(0,a.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,a.jsx)(M.Z,{span:12,children:(0,a.jsx)(Z.default.Item,{tooltip:r("The_size_of_the_data_chunks"),rules:[{required:!0}],label:r("chunk_size"),name:["embedding","chunk_size"],children:(0,a.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,a.jsx)(M.Z,{span:12,children:(0,a.jsx)(Z.default.Item,{tooltip:r("The_amount_of_overlap"),rules:[{required:!0}],label:r("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,a.jsx)(I.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,a.jsxs)("div",{children:[(0,a.jsx)(H.Z,{}),r("Prompt")]}),children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.default.Item,{tooltip:r("A_contextual_parameter"),label:r("scene"),name:["prompt","scene"],children:(0,a.jsx)($,{rows:4,className:"mb-2"})}),(0,a.jsx)(Z.default.Item,{tooltip:r("structure_or_format"),label:r("template"),name:["prompt","template"],children:(0,a.jsx)($,{rows:7,className:"mb-2"})}),(0,a.jsx)(Z.default.Item,{tooltip:r("The_maximum_number_of_tokens"),label:r("max_token"),name:["prompt","max_token"],children:(0,a.jsx)(I.default,{className:"mb-2"})})]})},{key:"Summary",label:(0,a.jsxs)("div",{children:[(0,a.jsx)(Y.Z,{}),r("Summary")]}),children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.default.Item,{rules:[{required:!0}],label:r("max_iteration"),name:["summary","max_iteration"],children:(0,a.jsx)(I.default,{className:"mb-2"})}),(0,a.jsx)(Z.default.Item,{rules:[{required:!0}],label:r("concurrency_limit"),name:["summary","concurrency_limit"],children:(0,a.jsx)(I.default,{className:"mb-2"})})]})}],x=async e=>{d(!0);let[t,a,r]=await (0,n.Vx)((0,n.iH)(l.name,{argument:JSON.stringify(e)}));d(!1),(null==r?void 0:r.success)&&s(!1)};return(0,a.jsx)(v.default,{width:850,open:t,onCancel:()=>{s(!1)},footer:null,children:(0,a.jsx)(y.Z,{spinning:o,children:(0,a.jsxs)(Z.default,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...i},autoComplete:"off",onFinish:x,children:[(0,a.jsx)(z.Z,{items:m}),(0,a.jsxs)("div",{className:"mt-3 mb-3",children:[(0,a.jsx)(S.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:r("Submit")}),(0,a.jsx)(S.ZP,{onClick:()=>{s(!1)},children:r("close")})]})]})})})}var W=t(76243),Q=t(26657),B=t(47309),K=t(62971),X=t(99631),ee=t(16156),el=e=>{let{open:l,setOpen:t,space:s}=e,[r]=Z.default.useForm(),[i]=Z.default.useForm(),{data:c=[],run:o}=(0,g.Z)(async()=>{let[,e]=await (0,n.Vx)((0,n.Pg)(s.name+""));return null!=e?e:[]},{manual:!0}),{data:d=[],run:u}=(0,g.Z)(async()=>{let[,e]=await (0,n.Vx)((0,n.UO)(s.name+""));return null!=e?e:[]},{manual:!0,onSuccess:e=>{i.setFieldValue("recall_retrievers",e)}});(0,O.useEffect)(()=>{l&&u()},[l,u,o]);let{run:m,data:x=[],loading:h}=(0,g.Z)(async e=>{let[,l]=await (0,n.Vx)((0,n.Y2)({...e},s.name+""));return null!=l?l:[]},{manual:!0}),p=async()=>{r.validateFields().then(async e=>{let l=i.getFieldsValue();console.log(l),await m({recall_top_k:1,recall_retrievers:d,...e,...l})})};return(0,a.jsxs)(v.default,{title:"召回测试",width:"60%",open:l,footer:!1,onCancel:()=>t(!1),centered:!0,destroyOnClose:!0,children:[(0,a.jsx)(P.Z,{title:"召回配置",size:"small",className:"my-4",extra:(0,a.jsx)(K.Z,{placement:"bottomRight",trigger:"hover",title:"向量检索设置",content:(0,a.jsxs)(Z.default,{form:i,initialValues:{recall_top_k:1},children:[(0,a.jsx)(Z.default.Item,{label:"Topk",tooltip:"基于相似度得分的前 k 个向量",name:"recall_top_k",children:(0,a.jsx)(X.Z,{placeholder:"请输入",className:"w-full"})}),(0,a.jsx)(Z.default.Item,{label:"召回方法",name:"recall_retrievers",children:(0,a.jsx)(ee.default,{mode:"multiple",options:d.map(e=>({label:e,value:e})),className:"w-full",allowClear:!0,disabled:!0})}),(0,a.jsx)(Z.default.Item,{label:"score阈值",name:"recall_score_threshold",children:(0,a.jsx)(X.Z,{placeholder:"请输入",className:"w-full",step:.1})})]}),children:(0,a.jsx)(B.Z,{className:"text-lg"})}),children:(0,a.jsx)(Z.default,{form:r,layout:"vertical",onFinish:p,children:(0,a.jsx)(Z.default.Item,{label:"测试问题",required:!0,name:"question",rules:[{required:!0,message:"请输入测试问题"}],className:"m-0 p-0",children:(0,a.jsxs)("div",{className:"flex w-full items-center gap-8",children:[(0,a.jsx)(I.default,{placeholder:"请输入测试问题",autoComplete:"off",allowClear:!0,className:"w-1/2"}),(0,a.jsx)(S.ZP,{type:"primary",htmlType:"submit",children:"测试"})]})})})}),(0,a.jsx)(P.Z,{title:"召回结果",size:"small",children:(0,a.jsx)(y.Z,{spinning:h,children:x.length>0?(0,a.jsx)("div",{className:"flex flex-col overflow-y-auto",style:{height:"45vh"},children:x.map(e=>(0,a.jsx)(P.Z,{title:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)(w.Z,{color:"blue",children:["# ",e.chunk_id]}),e.metadata.prop_field.title]}),extra:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-semibold",children:"score:"}),(0,a.jsx)("span",{className:"text-blue-500",children:e.score})]}),size:"small",className:"mb-4 border-gray-500 shadow-md",children:(0,a.jsx)(Q.default,{children:e.content})},e.chunk_id))}):(0,a.jsx)(T.Z,{})})})]})};let{confirm:et}=v.default,ea=e=>{let{name:l,id:t}=e,[s,c]=(0,O.useState)(!1),{t:o}=(0,V.$G)(),d=async(e,l)=>{var t;c(!0);let a=await (0,n.Vx)((0,n.Hx)(e,{doc_ids:[l]}));c(!1),(null===(t=a[2])||void 0===t?void 0:t.success)&&b.ZP.success(o("Synchronization_initiated"))};return s?(0,a.jsx)(y.Z,{indicator:(0,a.jsx)(r.Z,{spin:!0})}):(0,a.jsxs)(N.Z,{onClick:()=>{d(l,t)},children:[(0,a.jsx)(i.Z,{}),(0,a.jsx)("span",{children:o("Sync")})]})};function en(e){var l;let[t]=Z.default.useForm(),{space:r,addStatus:i}=e,{t:F}=(0,V.$G)(),R=(0,A.useRouter)(),{isMenuExpand:L}=(0,O.useContext)(s.p),[M,z]=(0,O.useState)([]),[G,H]=(0,O.useState)([]),[Y,$]=(0,O.useState)([]),[Q,B]=(0,O.useState)(!1),[K,X]=(0,O.useState)(0),[ee,en]=(0,O.useState)(!1),[es,er]=(0,O.useState)(),[ei,ec]=(0,O.useState)(!1),eo=(0,O.useRef)(1),ed=(0,O.useMemo)(()=>(null==G?void 0:G.length)<K,[G,K]),eu=e=>{et({title:F("Tips"),icon:(0,a.jsx)(c.Z,{}),content:"".concat(F("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await ef(e)}})},{run:em,refresh:ex,loading:eh}=(0,g.Z)(async()=>await (0,n.Vx)((0,n._Q)(r.name,{page:eo.current,page_size:18})),{manual:!0,onSuccess:e=>{let[,l]=e;H(null==l?void 0:l.data),$(null==l?void 0:l.data),X((null==l?void 0:l.total)||0)}}),ep=async()=>{if(!ed)return;eo.current+=1;let[e,l]=await (0,n.Vx)((0,n._Q)(r.name,{page:eo.current,page_size:18}));H([...G,...l.data]),$([...G,...l.data])},ef=async l=>{await (0,n.Vx)((0,n.n3)(r.name,{doc_name:l.doc_name})),em(),e.onDeleteDoc()},ej=()=>{e.onAddDoc(r.name)},e_=(e,l)=>{let t;switch(e){case"TODO":t="gold";break;case"RUNNING":t="#2db7f5";break;case"FINISHED":t="cyan";break;default:t="red"}return(0,a.jsx)(k.Z,{title:l,children:(0,a.jsx)(w.Z,{color:t,children:e})})};(0,O.useEffect)(()=>{em()},[]),(0,O.useEffect)(()=>{"finish"===i&&em()},[i]),(0,O.useCallback)(async e=>{let{data:l}=await (0,n.Yp)({space_id:r.id,user_nos:e});l.success?b.ZP.success(F("Edit_Success")):C.ZP.error({description:l.err_msg,message:"Update Error"})},[r.id]);let{run:eg,loading:ev}=(0,g.Z)(async(e,l)=>{let[,t]=await (0,n.Vx)((0,n.ey)(r.name,{doc_name:l}));return t},{manual:!0,debounceWait:500,onSuccess:e=>{console.log(e),$(null==e?void 0:e.data)}}),{run:eb,loading:ey}=(0,g.Z)(async l=>{var t;return await (0,n.k7)(e.space.name,{questions:null===(t=l.questions)||void 0===t?void 0:t.map(e=>e.question),doc_id:(null==es?void 0:es.id)||"",doc_name:l.doc_name})},{manual:!0,onSuccess:async e=>{e.data.success?(b.ZP.success(F("Edit_Success")),await em(),en(!1)):b.ZP.error(e.data.err_msg)}});return(0,O.useEffect)(()=>{var e;es&&t.setFieldsValue({doc_name:es.doc_name,questions:null===(e=es.questions)||void 0===e?void 0:e.map(e=>({question:e}))})},[es,t]),(0,a.jsxs)("div",{className:"px-4",children:[(0,a.jsxs)(N.Z,{children:[(0,a.jsx)(S.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,a.jsx)(h.Z,{}),onClick:ej,children:F("Add_Datasource")}),(0,a.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,a.jsx)(p.Z,{}),onClick:()=>{B(!0)},children:"Arguments"}),"KnowledgeGraph"===r.vector_type&&(0,a.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,a.jsx)(f.Z,{}),onClick:()=>{R.push("/knowledge/graph/?spaceName=".concat(r.name))},children:F("View_Graph")}),(0,a.jsx)(S.ZP,{icon:(0,a.jsx)(j.Z,{}),onClick:()=>ec(!0),children:F("Recall_test")})]}),(0,a.jsx)(q.Z,{}),(0,a.jsx)(y.Z,{spinning:eh,children:(0,a.jsxs)("div",{className:"w-full h-full",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"flex w-full justify-end",children:(0,a.jsx)(S.ZP,{type:"primary",onClick:async()=>{await ex()},loading:eh,children:F("Refresh_status")})})}),(0,a.jsx)("div",{className:"flex flex-col h-full p-3 border rounded-md",children:(null==G?void 0:G.length)>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-1 justify-between items-center",children:(0,a.jsx)(I.default,{className:"w-1/3",prefix:(0,a.jsx)(o.Z,{}),placeholder:F("please_enter_the_keywords"),onChange:async e=>{await eg(r.id,e.target.value)},allowClear:!0})}),(0,a.jsxs)(y.Z,{spinning:ev,children:[(0,a.jsx)(a.Fragment,{children:Y.length>0?(0,a.jsx)("div",{className:"h-96 mt-3 grid grid-cols-3 gap-x-6 gap-y-5 overflow-y-auto",children:Y.map(e=>(0,a.jsxs)(P.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full max-h-64",title:(0,a.jsx)(k.Z,{title:e.doc_name,children:(0,a.jsxs)("div",{className:"truncate ",children:[(0,a.jsx)(W.Z,{type:e.doc_type}),(0,a.jsx)("span",{children:e.doc_name})]})}),extra:(0,a.jsx)(E.Z,{menu:{items:[{key:"publish",label:(0,a.jsxs)(N.Z,{onClick:()=>{R.push("/construct/knowledge/chunk/?spaceName=".concat(r.name,"&id=").concat(e.id))},children:[(0,a.jsx)(d.Z,{}),(0,a.jsx)("span",{children:F("detail")})]})},{key:"".concat(F("Sync")),label:(0,a.jsx)(ea,{name:r.name,id:e.id})},{key:"edit",label:(0,a.jsxs)(N.Z,{onClick:()=>{en(!0),er(e)},children:[(0,a.jsx)(u.Z,{}),(0,a.jsx)("span",{children:F("Edit")})]})},{key:"del",label:(0,a.jsxs)(N.Z,{onClick:()=>{eu(e)},children:[(0,a.jsx)(m.Z,{}),(0,a.jsx)("span",{children:F("Delete")})]})}]},getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,className:"rounded-md",children:(0,a.jsx)(x.Z,{className:"p-2"})}),children:[(0,a.jsxs)("p",{className:"mt-2 font-semibold ",children:[F("Size"),":"]}),(0,a.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,a.jsxs)("p",{className:"mt-2 font-semibold ",children:[F("Last_Sync"),":"]}),(0,a.jsx)("p",{children:D()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,a.jsx)("p",{className:"mt-2 mb-2",children:e_(e.status,e.result)})]},e.id))}):(0,a.jsx)(T.Z,{className:"flex flex-1 w-full py-10 flex-col items-center justify-center",image:T.Z.PRESENTED_IMAGE_DEFAULT})}),ed&&(0,a.jsx)(q.Z,{children:(0,a.jsx)("span",{className:"cursor-pointer",onClick:ep,children:F("Load_more")})})]})]}):(0,a.jsx)(T.Z,{image:T.Z.PRESENTED_IMAGE_DEFAULT,children:(0,a.jsx)(S.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,a.jsx)(h.Z,{}),onClick:ej,children:"Create Now"})})})]})}),(0,a.jsx)(J,{space:r,argumentsShow:Q,setArgumentsShow:B}),(0,a.jsx)(v.default,{title:F("Edit_document"),open:ee,onCancel:()=>en(!1),destroyOnClose:!0,footer:[(0,a.jsx)(S.ZP,{onClick:()=>en(!1),children:F("cancel")},"back"),(0,a.jsx)(S.ZP,{type:"primary",loading:ey,onClick:async()=>{let e=t.getFieldsValue();await eb(e)},children:F("verify")},"submit")],children:(0,a.jsxs)(Z.default,{form:t,initialValues:{doc_name:null==es?void 0:es.doc_name,questions:null==es?void 0:null===(l=es.questions)||void 0===l?void 0:l.map(e=>({question:e}))},children:[(0,a.jsx)(Z.default.Item,{label:F("Document_name"),name:"doc_name",children:(0,a.jsx)(I.default,{})}),(0,a.jsx)(Z.default.Item,{label:F("Correlation_problem"),children:(0,a.jsx)(Z.default.List,{name:"questions",children:(e,l)=>{let{add:t,remove:n}=l;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,l)=>{let{key:t,name:s}=e;return(0,a.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,a.jsx)(Z.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,a.jsx)(I.default,{placeholder:"请输入"})}),(0,a.jsx)(Z.default.Item,{children:(0,a.jsx)(_.Z,{onClick:()=>{n(s)}})})]},t)}),(0,a.jsx)(Z.default.Item,{children:(0,a.jsx)(S.ZP,{type:"dashed",onClick:()=>{t({question:"",valid:!1})},block:!0,icon:(0,a.jsx)(h.Z,{}),children:F("Add_problem")})})]})}})})]})}),(0,a.jsx)(el,{open:ei,setOpen:ec,space:r})]})}},80053:function(e,l,t){t.d(l,{Z:function(){return i}});var a=t(96469),n=t(67343),s=t(56841),r=t(76243);function i(e){let{t:l}=(0,s.$G)(),{handleStepChange:t}=e,i=[{type:"TEXT",title:l("Text"),subTitle:l("Fill your raw text"),iconType:"TEXT"},{type:"URL",title:l("URL"),subTitle:l("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"DOCUMENT",title:l("Document"),subTitle:l("Upload_a_document"),iconType:"DOCUMENT"},{type:"YUQUEURL",title:l("yuque"),subTitle:l("Get_yuque_document"),iconType:"YUQUEURL"}];return(0,a.jsx)(a.Fragment,{children:i.map((e,l)=>(0,a.jsxs)(n.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{t({label:"forward",docType:e.type})},children:[(0,a.jsxs)("div",{className:"font-semibold",children:[(0,a.jsx)(r.Z,{type:e.iconType}),e.title]}),(0,a.jsx)("div",{children:e.subTitle})]},l))})}},55868:function(e,l,t){t.d(l,{Z:function(){return b}});var a=t(96469),n=t(27623),s=t(3936),r=t(97511),i=t(62938),c=t(19389),o=t(41999),d=t(55360),u=t(70351),m=t(27691),x=t(42786),h=t(26869),p=t.n(h),f=t(38497),j=t(56841),_=t(21840);let{Dragger:g}=c.default,{TextArea:v}=o.default;function b(e){let{className:l,handleStepChange:t,spaceName:c,docType:h}=e,{t:b}=(0,j.$G)(),[y]=d.default.useForm(),[N,Z]=(0,f.useState)(!1),[k,w]=(0,f.useState)([]),C=async e=>{let l;let{docName:a,textSource:s,text:r,webPageUrl:i,doc_token:o,questions:d=[],originFileObj:m}=e;switch(Z(!0),h){case"URL":[,l]=await (0,n.Vx)((0,n.H_)(c,{doc_name:a,content:i,doc_type:"URL",questions:null==d?void 0:d.map(e=>e.question)}));break;case"TEXT":[,l]=await (0,n.Vx)((0,n.H_)(c,{doc_name:a,source:s,content:r,doc_type:"TEXT",questions:d.map(e=>e.question)}));break;case"YUQUEURL":[,l]=await (0,n.Vx)((0,n.TT)({doc_name:a,space_name:c,content:i,doc_type:"YUQUEURL",doc_token:o||"",questions:null==d?void 0:d.map(e=>e.question)}));break;case"DOCUMENT":let x=new FormData,p=null==m?void 0:m.name,f=d.map(e=>e.question);x.append("doc_name",p),x.append("doc_file",m),x.append("doc_type","DOCUMENT"),x.append("questions",JSON.stringify(f)),[,l]=await (0,n.Vx)((0,n.iG)(c,x)),console.log(l),Number.isInteger(l)&&w(e=>(e.push({name:p,doc_id:l||-1}),e))}return(Z(!1),"DOCUMENT"===h&&k.length<1)?u.ZP.error("Upload failed, please re-upload."):"DOCUMENT"===h||l?void t({label:"forward",files:"DOCUMENT"===h?k:[{name:a,doc_id:l||-1}]}):u.ZP.error("Upload failed, please re-upload.")},S=e=>{let{file:l,fileList:t}=e;0===t.length?y.setFieldValue("originFileObj",null):y.setFieldValue("originFileObj",l)},I=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.default.Item,{label:"".concat(b("Name"),":"),name:"docName",rules:[{required:!0,message:b("Please_input_the_name")}],children:(0,a.jsx)(o.default,{className:"mb-5 h-12",placeholder:b("Please_input_the_name")})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:b("Please_input_the_text_source")}],children:(0,a.jsx)(o.default,{className:"mb-5  h-12",placeholder:b("Please_input_the_text_source")})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Text"),":"),name:"text",rules:[{required:!0,message:b("Please_input_the_description")}],children:(0,a.jsx)(v,{rows:4})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Correlation_problem"),":"),children:(0,a.jsx)(d.default.List,{name:"questions",children:(e,l)=>{let{add:t,remove:n}=l;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,l)=>{let{key:t,name:r}=e;return(0,a.jsxs)("div",{className:p()("flex flex-1 items-center gap-8 mb-6"),children:[(0,a.jsx)(d.default.Item,{label:"",name:[r,"question"],className:"grow",children:(0,a.jsx)(o.default,{placeholder:b("input_question")})}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(s.Z,{onClick:()=>{n(r)}})})]},t)}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(m.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,a.jsx)(r.Z,{}),children:b("Add_problem")})})]})}})})]}),P=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.default.Item,{label:"".concat(b("Name"),":"),name:"docName",rules:[{required:!0,message:b("Please_input_the_name")}],children:(0,a.jsx)(o.default,{className:"mb-5 h-12",placeholder:b("Please_input_the_name")})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:b("Please_input_the_Web_Page_URL")}],children:(0,a.jsx)(o.default,{className:"mb-5  h-12",placeholder:b("Please_input_the_Web_Page_URL")})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Correlation_problem"),":"),children:(0,a.jsx)(d.default.List,{name:"questions",children:(e,l)=>{let{add:t,remove:n}=l;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,l)=>{let{key:t,name:r}=e;return(0,a.jsxs)("div",{className:p()("flex flex-1 items-center gap-8 mb-6"),children:[(0,a.jsx)(d.default.Item,{label:"",name:[r,"question"],className:"grow",children:(0,a.jsx)(o.default,{placeholder:b("input_question")})}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(s.Z,{onClick:()=>{n(r)}})})]},t)}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(m.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,a.jsx)(r.Z,{}),children:b("Add_problem")})})]})}})})]}),E=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.default.Item,{label:"".concat(b("Name"),":"),name:"docName",rules:[{required:!0,message:b("Please_input_the_name")}],children:(0,a.jsx)(o.default,{className:"mb-5 h-12",placeholder:b("Please_input_the_name")})}),(0,a.jsx)(d.default.Item,{label:b("document_url"),name:"webPageUrl",rules:[{required:!0,message:b("input_document_url")}],children:(0,a.jsx)(o.default,{className:"mb-5  h-12",placeholder:b("input_document_url")})}),(0,a.jsx)(d.default.Item,{label:b("document_token"),name:"doc_token",tooltip:(0,a.jsxs)(a.Fragment,{children:[b("Get_token"),(0,a.jsx)(_.Z.Link,{href:"https://yuque.antfin-inc.com/lark/openapi/dh8zp4",target:"_blank",children:b("Reference_link")})]}),children:(0,a.jsx)(o.default,{className:"mb-5  h-12",placeholder:b("input_document_token")})}),(0,a.jsx)(d.default.Item,{label:"".concat(b("Correlation_problem"),":"),children:(0,a.jsx)(d.default.List,{name:"questions",children:(e,l)=>{let{add:t,remove:n}=l;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,l)=>{let{key:t,name:r}=e;return(0,a.jsxs)("div",{className:p()("flex flex-1 items-center gap-8 mb-6"),children:[(0,a.jsx)(d.default.Item,{label:"",name:[r,"question"],className:"grow",children:(0,a.jsx)(o.default,{placeholder:b("input_question")})}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(s.Z,{onClick:()=>{n(r)}})})]},t)}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(m.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,a.jsx)(r.Z,{}),children:b("Add_problem")})})]})}})})]}),T=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.default.Item,{name:"originFileObj",rules:[{required:!0,message:b("Please_select_file")}],children:(0,a.jsxs)(g,{multiple:!0,beforeUpload:()=>!1,onChange:S,maxCount:1,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md,.zip",children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(i.Z,{})}),(0,a.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:b("Select_or_Drop_file")}),(0,a.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown, Zip1"})]})}),(0,a.jsx)(d.default.Item,{label:"关联问题:",children:(0,a.jsx)(d.default.List,{name:"questions",children:(e,l)=>{let{add:t,remove:n}=l;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,l)=>{let{key:t,name:r}=e;return(0,a.jsxs)("div",{className:p()("flex flex-1 items-center gap-8 mb-6"),children:[(0,a.jsx)(d.default.Item,{label:"",name:[r,"question"],className:"grow",children:(0,a.jsx)(o.default,{placeholder:"请输入问题"})}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(s.Z,{onClick:()=>{n(r)}})})]},t)}),(0,a.jsx)(d.default.Item,{children:(0,a.jsx)(m.ZP,{type:"dashed",onClick:()=>{t()},block:!0,icon:(0,a.jsx)(r.Z,{}),children:b("Add_problem")})})]})}})})]});return(0,a.jsx)(x.Z,{spinning:N,children:(0,a.jsxs)(d.default,{form:y,size:"large",className:p()("mt-4",l),layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:C,children:[(()=>{switch(h){case"URL":return P();case"DOCUMENT":return T();case"YUQUEURL":return E();default:return I()}})(),(0,a.jsxs)(d.default.Item,{children:[(0,a.jsx)(m.ZP,{onClick:()=>{t({label:"back"})},className:"mr-4",children:"".concat(b("Back"))}),(0,a.jsx)(m.ZP,{type:"primary",loading:N,htmlType:"submit",children:b("Next")})]})]})})}},12862:function(e,l,t){let a;t.d(l,{Z:function(){return y}});var n=t(96469),s=t(27623),r=t(55360),i=t(70351),c=t(76914),o=t(86776),d=t(42786),u=t(27691),m=t(42834),x=t(38497),h=t(56841),p=t(41999),f=t(99631),j=t(29223),_=t(76372);let{TextArea:g}=p.default;function v(e){let{strategies:l,docType:t,fileName:a,field:s}=e,[i,o]=(0,x.useState)(),d="";if("DOCUMENT"===t){let e=a.split(".");d=e[e.length-1]}let u=d?l.filter(e=>e.suffix.indexOf(d)>-1):l,{t:m}=(0,h.$G)(),p={strategy:"Automatic",name:m("Automatic"),desc:m("Automatic_desc")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.default.Item,{name:[s.name,"chunk_parameters","chunk_strategy"],initialValue:p.strategy,children:(0,n.jsxs)(_.ZP.Group,{style:{marginTop:16},onChange:function(e){o(e.target.value)},children:[(0,n.jsx)(_.ZP,{value:p.strategy,children:p.name}),u.map(e=>(0,n.jsx)(_.ZP,{value:e.strategy,children:e.name},"strategy_radio_".concat(e.strategy)))]})}),function(){var e;if(!i)return null;if(i===p.name)return(0,n.jsx)("p",{className:"my-4",children:p.desc});let l=null===(e=null==u?void 0:u.filter(e=>e.strategy===i)[0])||void 0===e?void 0:e.parameters;return l&&l.length?(0,n.jsx)("div",{className:"mt-2",children:null==l?void 0:l.map(e=>(0,n.jsx)(r.default.Item,{label:e.param_name,name:[s.name,"chunk_parameters",e.param_name],rules:[{required:!0,message:m("Please_input_the_name")}],initialValue:e.default_value,valuePropName:"boolean"===e.param_type?"checked":"value",tooltip:e.description,children:function(e){switch(e){case"int":return(0,n.jsx)(f.Z,{className:"w-full",min:1});case"string":return(0,n.jsx)(g,{className:"w-full",rows:2});case"boolean":return(0,n.jsx)(j.Z,{})}}(e.param_type)},"param_".concat(e.param_name)))}):(0,n.jsx)(c.Z,{className:"my-2",type:"warning",message:m("No_parameter")})}()]})}var b=t(67901);function y(e){let{spaceName:l,docType:t,uploadFiles:p,handleStepChange:f}=e;console.log(t,"doctype");let{t:j}=(0,h.$G)(),[_]=r.default.useForm(),[g,y]=(0,x.useState)(p),[N,Z]=(0,x.useState)(),[k,w]=(0,x.useState)([]),[C,S]=(0,x.useState)("");async function I(){var e;Z(!0);let[,l]=await (0,s.Vx)((0,s.iZ)());Z(!1),w(null===(e=l||[])||void 0===e?void 0:e.filter(e=>e.type.indexOf(t)>-1))}localStorage.getItem("cur_space_id"),(0,x.useEffect)(()=>(I(),()=>{a&&clearInterval(a)}),[]);let P=async e=>{if(function(e){let l=!0;"RUNNING"===C&&(l=!1,i.ZP.warning("The task is still running, do not submit it again."));let{fileStrategies:t}=e;return t.map(e=>{var t,a;let n=null==e?void 0:null===(t=e.chunk_parameters)||void 0===t?void 0:t.chunk_strategy;n||(i.ZP.error("Please select chunk strategy for ".concat(e.name,".")),l=!1);let s=k.filter(e=>e.strategy===n)[0],r={chunk_strategy:null==e?void 0:null===(a=e.chunk_parameters)||void 0===a?void 0:a.chunk_strategy};s&&s.parameters&&s.parameters.forEach(l=>{let t=l.param_name;r[t]=(null==e?void 0:e.chunk_parameters)[t]}),e.chunk_parameters=r}),l}(e)){var t;Z(!0);let[,n]=await (0,s.Vx)((0,s.KL)(l,e.fileStrategies));if(Z(!1),(null==n?void 0:n.tasks)&&(null==n?void 0:null===(t=n.tasks)||void 0===t?void 0:t.length)>0){i.ZP.success("Segemation task start successfully. task id: ".concat(null==n?void 0:n.tasks.join(","))),S("RUNNING");let l=e.fileStrategies.map(e=>e.doc_id);a=setInterval(async()=>{let e=await E(l);"FINISHED"===e?(clearInterval(a),S("FINISHED"),i.ZP.success("Congratulation, All files sync successfully."),f({label:"finish"})):"FAILED"===e&&(clearInterval(a),f({label:"finish"}))},3e3)}}};async function E(e){let[,t]=await (0,s.Vx)((0,s._Q)(l,{doc_ids:e}));if((null==t?void 0:t.data)&&(null==t?void 0:t.data.length)>0){let e=[...g];if(null==t||t.data.map(l=>{var t;let a=null===(t=null==e?void 0:e.filter(e=>e.doc_id===l.id))||void 0===t?void 0:t[0];a&&(a.status=l.status)}),y(e),null==t?void 0:t.data.every(e=>"FINISHED"===e.status||"FAILED"===e.status))return"FINISHED"}}return(0,n.jsx)(d.Z,{spinning:N,children:(0,n.jsxs)(r.default,{labelCol:{span:6},wrapperCol:{span:18},labelAlign:"right",form:_,size:"large",className:"mt-4",layout:"horizontal",name:"basic",autoComplete:"off",initialValues:{fileStrategies:g},onFinish:P,children:[k&&k.length?(0,n.jsx)(r.default.List,{name:"fileStrategies",children:e=>{switch(t){case"TEXT":case"URL":case"YUQUEURL":return null==e?void 0:e.map(e=>(0,n.jsx)(v,{strategies:k,docType:t,fileName:g[e.name].name,field:e},e.key));case"DOCUMENT":return(0,n.jsx)(o.Z,{defaultActiveKey:0,size:g.length>5?"small":"middle",children:null==e?void 0:e.map(e=>(0,n.jsx)(o.Z.Panel,{header:"".concat(e.name+1,". ").concat(g[e.name].name),extra:function(e){let l=g[e].status;switch(l){case"FINISHED":return(0,n.jsx)(m.Z,{component:b.qw});case"RUNNING":return(0,n.jsx)(m.Z,{className:"animate-spin animate-infinite",component:b.bn});case"FAILED":return(0,n.jsx)(m.Z,{component:b.FE});default:return(0,n.jsx)(m.Z,{component:b.tu})}}(e.name),children:(0,n.jsx)(v,{strategies:k,docType:t,fileName:g[e.name].name,field:e})},e.key))})}}}):(0,n.jsx)(c.Z,{message:"Cannot find one strategy for ".concat(t," type knowledge."),type:"warning"}),(0,n.jsxs)(r.default.Item,{className:"mt-4",children:[(0,n.jsx)(u.ZP,{onClick:()=>{f({label:"back"})},className:"mr-4",children:"".concat(j("Back"))}),(0,n.jsx)(u.ZP,{type:"primary",htmlType:"submit",loading:N||"RUNNING"===C,children:j("Process")})]})]})})}},78453:function(e,l,t){t.d(l,{Z:function(){return m}});var a=t(96469),n=t(27623),s=t(55360),r=t(42786),i=t(41999),c=t(16156),o=t(27691),d=t(38497),u=t(56841);function m(e){var l;let{t}=(0,u.$G)(),{handleStepChange:m,spaceConfig:x}=e,[h,p]=(0,d.useState)(!1),[f,j]=(0,d.useState)(),[_]=s.default.useForm();(0,d.useEffect)(()=>{_.setFieldValue("storage",null==x?void 0:x[0].name),j(null==x?void 0:x[0].name)},[x]);let g=async e=>{let{spaceName:l,owner:t,description:a,storage:s,field:r}=e;p(!0);let[i,c,o]=await (0,n.Vx)((0,n.be)({name:l,vector_type:s,owner:t,desc:a,domain_type:r}));p(!1);let d="FinancialReport"===r;localStorage.setItem("cur_space_id",JSON.stringify(c)),(null==o?void 0:o.success)&&m({label:"forward",spaceName:l,pace:d?2:1,docType:d?"DOCUMENT":""})};return(0,a.jsx)(r.Z,{spinning:h,children:(0,a.jsxs)(s.default,{form:_,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:g,children:[(0,a.jsx)(s.default.Item,{label:t("Knowledge_Space_Name"),name:"spaceName",rules:[{required:!0,message:t("Please_input_the_name")},()=>({validator:(e,l)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(l)?Promise.reject(Error(t("the_name_can_only_contain"))):Promise.resolve()})],children:(0,a.jsx)(i.default,{className:"h-12",placeholder:t("Please_input_the_name")})}),(0,a.jsx)(s.default.Item,{label:t("Storage"),name:"storage",rules:[{required:!0,message:t("Please_select_the_storage")}],children:(0,a.jsx)(c.default,{className:"mb-5 h-12",placeholder:t("Please_select_the_storage"),onChange:e=>{j(e)},children:null==x?void 0:x.map(e=>(0,a.jsx)(c.default.Option,{value:e.name,children:e.desc}))})}),(0,a.jsx)(s.default.Item,{label:t("Domain"),name:"field",rules:[{required:!0,message:t("Please_select_the_domain_type")}],children:(0,a.jsx)(c.default,{className:"mb-5 h-12",placeholder:t("Please_select_the_domain_type"),children:null===(l=null==x?void 0:x.find(e=>e.name===f))||void 0===l?void 0:l.domain_types.map(e=>(0,a.jsx)(c.default.Option,{value:e.name,children:e.desc}))})}),(0,a.jsx)(s.default.Item,{label:t("Description"),name:"description",rules:[{required:!0,message:t("Please_input_the_description")}],children:(0,a.jsx)(i.default,{className:"h-12",placeholder:t("Please_input_the_description")})}),(0,a.jsx)(s.default.Item,{children:(0,a.jsx)(o.ZP,{type:"primary",htmlType:"submit",children:t("Next")})})]})})}},51310:function(e,l,t){var a=t(88506);l.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}},61977:function(e,l,t){var a=t(96469),n=t(27250),s=t(23852),r=t.n(s),i=t(38497);l.Z=(0,i.memo)(e=>{let{width:l,height:t,model:s}=e,c=(0,i.useMemo)(()=>{let e=null==s?void 0:s.replaceAll("-","_").split("_")[0],l=Object.keys(n.Me);for(let t=0;t<l.length;t++){let a=l[t];if(null==e?void 0:e.includes(a))return n.Me[a]}return"/models/huggingface.svg"},[s]);return s?(0,a.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:l||24,height:t||24,src:c,alt:"llm",priority:!0}):null})},26953:function(e,l,t){var a=t(96469),n=t(67901),s=t(42834),r=t(38497);l.Z=e=>{let{width:l,height:t,scene:i}=e,c=(0,r.useCallback)(()=>{switch(i){case"chat_knowledge":return n.je;case"chat_with_db_execute":return n.zM;case"chat_excel":return n.DL;case"chat_with_db_qa":case"chat_dba":return n.RD;case"chat_dashboard":return n.In;case"chat_agent":return n.si;case"chat_normal":return n.O7;default:return}},[i]);return(0,a.jsx)(s.Z,{className:"w-".concat(l||7," h-").concat(t||7),component:c()})}},58526:function(e,l,t){var a=t(96890);let n=(0,a.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});l.Z=n},5157:function(e,l,t){t.r(l);var a=t(96469),n=t(26953),s=t(98028),r=t(95891),i=t(21840),c=t(93486),o=t.n(c),d=t(38497),u=t(29549);l.default=(0,d.memo)(()=>{var e;let{appInfo:l}=(0,d.useContext)(u.MobileChatContext),{message:t}=r.Z.useApp(),[c,m]=(0,d.useState)(0);if(!(null==l?void 0:l.app_code))return null;let x=async()=>{let e=o()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));t[e?"success":"error"](e?"复制成功":"复制失败")};return c>6&&t.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,a.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(c+1),children:[(0,a.jsx)(n.Z,{scene:(null==l?void 0:null===(e=l.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,a.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,a.jsx)(i.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==l?void 0:l.app_name}),(0,a.jsx)(i.Z.Text,{className:"text-sm line-clamp-2",children:null==l?void 0:l.app_describe})]})]}),(0,a.jsx)("div",{onClick:x,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,a.jsx)(s.Z,{className:"text-lg"})})]})})},86364:function(e,l,t){t.r(l);var a=t(96469),n=t(27623),s=t(7289),r=t(88506),i=t(1858),c=t(72828),o=t(37022),d=t(67620),u=t(31676),m=t(44875),x=t(16602),h=t(49030),p=t(62971),f=t(42786),j=t(41999),_=t(27691),g=t(26869),v=t.n(g),b=t(45875),y=t(38497),N=t(29549),Z=t(95433),k=t(14035),w=t(55238),C=t(75299);let S=["magenta","orange","geekblue","purple","cyan","green"];l.default=()=>{var e,l;let t=(0,b.useSearchParams)(),g=null!==(l=null==t?void 0:t.get("ques"))&&void 0!==l?l:"",{history:I,model:P,scene:E,temperature:T,resource:q,conv_uid:F,appInfo:U,scrollViewRef:R,order:D,userInput:A,ctrl:O,canAbort:V,canNewChat:L,setHistory:M,setCanNewChat:z,setCarAbort:G,setUserInput:H}=(0,y.useContext)(N.MobileChatContext),[Y,$]=(0,y.useState)(!1),[J,W]=(0,y.useState)(!1),Q=async e=>{var l,t,a;H(""),O.current=new AbortController;let n={chat_mode:E,model_name:P,user_input:e||A,conv_uid:F,temperature:T,app_code:null==U?void 0:U.app_code,...q&&{select_param:JSON.stringify(q)}};if(I&&I.length>0){let e=null==I?void 0:I.filter(e=>"view"===e.role);D.current=e[e.length-1].order+1}let i=[{role:"human",context:e||A,model_name:P,order:D.current,time_stamp:0},{role:"view",context:"",model_name:P,order:D.current,time_stamp:0,thinking:!0}],c=i.length-1;M([...I,...i]),z(!1);try{await (0,m.L)("".concat(null!==(l=C.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[r.gp]:null!==(t=(0,s.n5)())&&void 0!==t?t:""},signal:O.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=O.current)||void 0===e||e.abort(),z(!0),G(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(z(!0),G(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(i[c].context=null==l?void 0:l.replace("[ERROR]",""),i[c].thinking=!1,M([...I,...i]),z(!0),G(!1)):(G(!0),i[c].context=l,i[c].thinking=!1,M([...I,...i]))}})}catch(e){null===(a=O.current)||void 0===a||a.abort(),i[c].context="Sorry, we meet some error, please try again later.",i[c].thinking=!1,M([...i]),z(!0),G(!1)}},B=async()=>{A.trim()&&L&&await Q()};(0,y.useEffect)(()=>{var e,l;null===(e=R.current)||void 0===e||e.scrollTo({top:null===(l=R.current)||void 0===l?void 0:l.scrollHeight,behavior:"auto"})},[I,R]);let K=(0,y.useMemo)(()=>{if(!U)return[];let{param_need:e=[]}=U;return null==e?void 0:e.map(e=>e.type)},[U]),X=(0,y.useMemo)(()=>{var e;return 0===I.length&&U&&!!(null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.length)},[I,U]),{run:ee,loading:el}=(0,x.Z)(async()=>await (0,n.Vx)((0,n.zR)(F)),{manual:!0,onSuccess:()=>{M([])}});return(0,y.useEffect)(()=>{g&&P&&F&&U&&Q(g)},[U,F,P,g]),(0,a.jsxs)("div",{className:"flex flex-col",children:[X&&(0,a.jsx)("ul",{children:null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.map((e,l)=>(0,a.jsx)("li",{className:"mb-3",children:(0,a.jsx)(h.Z,{color:S[l],className:"p-2 rounded-xl",onClick:async()=>{Q(e.question)},children:e.question})},e.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==K?void 0:K.includes("model"))&&(0,a.jsx)(Z.default,{}),(null==K?void 0:K.includes("resource"))&&(0,a.jsx)(k.default,{}),(null==K?void 0:K.includes("temperature"))&&(0,a.jsx)(w.default,{})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,a.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,a.jsx)(i.Z,{className:v()("p-2 cursor-pointer",{"text-[#0c75fc]":V,"text-gray-400":!V}),onClick:()=>{var e;V&&(null===(e=O.current)||void 0===e||e.abort(),setTimeout(()=>{G(!1),z(!0)},100))}})}),(0,a.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,a.jsx)(c.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{var e,l;if(!L||0===I.length)return;let t=null===(e=null===(l=I.filter(e=>"human"===e.role))||void 0===l?void 0:l.slice(-1))||void 0===e?void 0:e[0];Q((null==t?void 0:t.context)||"")}})}),el?(0,a.jsx)(f.Z,{spinning:el,indicator:(0,a.jsx)(o.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,a.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,a.jsx)(d.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{L&&ee()}})})]})]}),(0,a.jsxs)("div",{className:v()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":Y}),children:[(0,a.jsx)(j.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:A,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(J){e.preventDefault();return}A.trim()&&(e.preventDefault(),B())}},onChange:e=>{H(e.target.value)},onFocus:()=>{$(!0)},onBlur:()=>$(!1),onCompositionStartCapture:()=>{W(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{W(!1)},0)}}),(0,a.jsx)(_.ZP,{type:"primary",className:v()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!A.trim()||!L}),onClick:B,children:L?(0,a.jsx)(u.Z,{}):(0,a.jsx)(f.Z,{indicator:(0,a.jsx)(o.Z,{className:"text-white"})})})]})]})}},95433:function(e,l,t){t.r(l);var a=t(96469),n=t(61977),s=t(45277),r=t(32857),i=t(80335),c=t(62971),o=t(38497),d=t(29549);l.default=()=>{let{modelList:e}=(0,o.useContext)(s.p),{model:l,setModel:t}=(0,o.useContext)(d.MobileChatContext),u=(0,o.useMemo)(()=>e.length>0?e.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{t(e)},children:[(0,a.jsx)(n.Z,{width:14,height:14,model:e}),(0,a.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,t]);return(0,a.jsx)(i.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,a.jsx)(c.Z,{content:l,children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(n.Z,{width:16,height:16,model:l}),(0,a.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:l}),(0,a.jsx)(r.Z,{rotate:90})]})})})}},33389:function(e,l,t){t.r(l);var a=t(96469),n=t(23852),s=t.n(n),r=t(38497);l.default=(0,r.memo)(e=>{let{width:l,height:t,src:n,label:r}=e;return(0,a.jsx)(s(),{width:l||14,height:t||14,src:n,alt:r||"db-icon",priority:!0})})},14035:function(e,l,t){t.r(l);var a=t(96469),n=t(27623),s=t(7289),r=t(37022),i=t(32857),c=t(71534),o=t(16602),d=t(42786),u=t(19389),m=t(80335),x=t(38497),h=t(29549),p=t(33389);l.default=()=>{let{appInfo:e,resourceList:l,scene:t,model:f,conv_uid:j,getChatHistoryRun:_,setResource:g,resource:v}=(0,x.useContext)(h.MobileChatContext),[b,y]=(0,x.useState)(null),N=(0,x.useMemo)(()=>{var l,t,a;return null===(l=null==e?void 0:null===(t=e.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:a.value},[e]),Z=(0,x.useMemo)(()=>l&&l.length>0?l.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{y(e),g(e.space_id||e.param)},children:[(0,a.jsx)(p.default,{width:14,height:14,src:s.S$[e.type].icon,label:s.S$[e.type].label}),(0,a.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[l,g]),{run:k,loading:w}=(0,o.Z)(async e=>{let[,l]=await (0,n.Vx)((0,n.qn)({convUid:j,chatMode:t,data:e,model:f,config:{timeout:36e5}}));return g(l),l},{manual:!0,onSuccess:async()=>{await _()}}),C=async e=>{let l=new FormData;l.append("doc_file",null==e?void 0:e.file),await k(l)},S=(0,x.useMemo)(()=>w?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.Z,{size:"small",indicator:(0,a.jsx)(r.Z,{spin:!0})}),(0,a.jsx)("span",{className:"text-xs",children:"上传中"})]}):v?(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("span",{className:"text-xs",children:v.file_name}),(0,a.jsx)(i.Z,{rotate:90})]}):(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"text-base"}),(0,a.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[w,v]);return(0,a.jsx)(a.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,a.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,a.jsx)(u.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:C,className:"flex h-full w-full items-center justify-center",children:S})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,t,n,r,c;if(!(null==l?void 0:l.length))return null;return(0,a.jsx)(m.Z,{menu:{items:Z},placement:"top",trigger:["click"],children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(p.default,{width:14,height:14,src:null===(e=s.S$[(null==b?void 0:b.type)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.type)])||void 0===e?void 0:e.icon,label:null===(n=s.S$[(null==b?void 0:b.type)||(null==l?void 0:null===(r=l[0])||void 0===r?void 0:r.type)])||void 0===n?void 0:n.label}),(0,a.jsx)("span",{className:"text-xs font-medium",children:(null==b?void 0:b.param)||(null==l?void 0:null===(c=l[0])||void 0===c?void 0:c.param)}),(0,a.jsx)(i.Z,{rotate:90})]})})}})()})}},55238:function(e,l,t){t.r(l);var a=t(96469),n=t(80335),s=t(28822),r=t(38497),i=t(29549),c=t(58526);l.default=()=>{let{temperature:e,setTemperature:l}=(0,r.useContext)(i.MobileChatContext),t=e=>{isNaN(e)||l(e)};return(0,a.jsx)(n.Z,{trigger:["click"],dropdownRender:()=>(0,a.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,a.jsx)(s.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:t,value:e})}),placement:"top",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,a.jsx)(c.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},29549:function(e,l,t){t.r(l),t.d(l,{MobileChatContext:function(){return v}});var a=t(96469),n=t(45277),s=t(27623),r=t(51310),i=t(7289),c=t(88506),o=t(44875),d=t(16602),u=t(42786),m=t(28469),x=t.n(m),h=t(45875),p=t(38497),f=t(5157),j=t(86364),_=t(75299);let g=x()(()=>Promise.all([t.e(7521),t.e(5197),t.e(6156),t.e(5996),t.e(9223),t.e(3127),t.e(9631),t.e(9790),t.e(4506),t.e(1657),t.e(5444),t.e(3093),t.e(4399),t.e(7463),t.e(6101),t.e(5883),t.e(5891),t.e(2061),t.e(3695)]).then(t.bind(t,33068)),{loadableGenerated:{webpack:()=>[33068]},ssr:!1}),v=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});l.default=()=>{var e,l;let t=(0,h.useSearchParams)(),m=null!==(e=null==t?void 0:t.get("chat_scene"))&&void 0!==e?e:"",x=null!==(l=null==t?void 0:t.get("app_code"))&&void 0!==l?l:"",{modelList:b}=(0,p.useContext)(n.p),[y,N]=(0,p.useState)([]),[Z,k]=(0,p.useState)(""),[w,C]=(0,p.useState)(.5),[S,I]=(0,p.useState)(null),P=(0,p.useRef)(null),[E,T]=(0,p.useState)(""),[q,F]=(0,p.useState)(!1),[U,R]=(0,p.useState)(!0),D=(0,p.useRef)(),A=(0,p.useRef)(1),O=(0,r.Z)(),V=(0,p.useMemo)(()=>"".concat(null==O?void 0:O.user_no,"_").concat(x),[x,O]),{run:L,loading:M}=(0,d.Z)(async()=>await (0,s.Vx)((0,s.$i)("".concat(null==O?void 0:O.user_no,"_").concat(x))),{manual:!0,onSuccess:e=>{let[,l]=e,t=null==l?void 0:l.filter(e=>"view"===e.role);t&&t.length>0&&(A.current=t[t.length-1].order+1),N(l||[])}}),{data:z,run:G,loading:H}=(0,d.Z)(async e=>{let[,l]=await (0,s.Vx)((0,s.BN)(e));return null!=l?l:{}},{manual:!0}),{run:Y,data:$,loading:J}=(0,d.Z)(async()=>{var e,l;let[,t]=await (0,s.Vx)((0,s.vD)(m));return I((null==t?void 0:null===(e=t[0])||void 0===e?void 0:e.space_id)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.param)),null!=t?t:[]},{manual:!0}),{run:W,loading:Q}=(0,d.Z)(async()=>{let[,e]=await (0,s.Vx)((0,s.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var l;let t=null===(l=null==e?void 0:e.filter(e=>e.conv_uid===V))||void 0===l?void 0:l[0];(null==t?void 0:t.select_param)&&I(JSON.parse(null==t?void 0:t.select_param))}});(0,p.useEffect)(()=>{m&&x&&b.length&&G({chat_scene:m,app_code:x})},[x,m,G,b]),(0,p.useEffect)(()=>{x&&L()},[x]),(0,p.useEffect)(()=>{if(b.length>0){var e,l,t;let a=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"model"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;k(a||b[0])}},[b,z]),(0,p.useEffect)(()=>{var e,l,t;let a=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;C(a||.5)},[z]),(0,p.useEffect)(()=>{if(m&&(null==z?void 0:z.app_code)){var e,l,t,a,n,s;let r=null===(e=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value,i=null===(a=null==z?void 0:null===(n=z.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.bind_value;i&&I(i),["database","knowledge","plugin","awel_flow"].includes(r)&&!i&&Y()}},[z,m,Y]);let B=async e=>{var l,t,a;T(""),D.current=new AbortController;let n={chat_mode:m,model_name:Z,user_input:e||E,conv_uid:V,temperature:w,app_code:null==z?void 0:z.app_code,...S&&{select_param:S}};if(y&&y.length>0){let e=null==y?void 0:y.filter(e=>"view"===e.role);A.current=e[e.length-1].order+1}let s=[{role:"human",context:e||E,model_name:Z,order:A.current,time_stamp:0},{role:"view",context:"",model_name:Z,order:A.current,time_stamp:0,thinking:!0}],r=s.length-1;N([...y,...s]),R(!1);try{await (0,o.L)("".concat(null!==(l=_.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[c.gp]:null!==(t=(0,i.n5)())&&void 0!==t?t:""},signal:D.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===o.a)return},onclose(){var e;null===(e=D.current)||void 0===e||e.abort(),R(!0),F(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(R(!0),F(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(s[r].context=null==l?void 0:l.replace("[ERROR]",""),s[r].thinking=!1,N([...y,...s]),R(!0),F(!1)):(F(!0),s[r].context=l,s[r].thinking=!1,N([...y,...s]))}})}catch(e){null===(a=D.current)||void 0===a||a.abort(),s[r].context="Sorry, we meet some error, please try again later.",s[r].thinking=!1,N([...s]),R(!0),F(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&W()},[m,W]),(0,a.jsx)(v.Provider,{value:{model:Z,resource:S,setModel:k,setTemperature:C,setResource:I,temperature:w,appInfo:z,conv_uid:V,scene:m,history:y,scrollViewRef:P,setHistory:N,resourceList:$,order:A,handleChat:B,setCanNewChat:R,ctrl:D,canAbort:q,setCarAbort:F,canNewChat:U,userInput:E,setUserInput:T,getChatHistoryRun:L},children:(0,a.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:M||H||J||Q,children:(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,a.jsxs)("div",{ref:P,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,a.jsx)(f.default,{}),(0,a.jsx)(g,{})]}),(null==z?void 0:z.app_code)&&(0,a.jsx)(j.default,{})]})})})}}}]);