(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2061],{59321:function(e,t,a){"use strict";var l=a(96469),s=a(23852),n=a.n(s);t.Z=function(e){let{src:t,label:a,width:s,height:r,className:i}=e;return(0,l.jsx)(n(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:s||44,height:r||44,src:t,alt:a||"db-icon"})}},78638:function(e,t,a){"use strict";var l=a(42988),s=a(7289),n=a(88506),r=a(44875),i=a(70351),o=a(38497),c=a(45277),d=a(75299);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions",app_code:a}=e,[u,m]=(0,o.useState)({}),{scene:p}=(0,o.useContext)(c.p),h=(0,o.useCallback)(async e=>{let{data:o,chatId:c,onMessage:u,onClose:h,onDone:x,onError:f,ctrl:v}=e;if(v&&m(v),!(null==o?void 0:o.user_input)&&!(null==o?void 0:o.doc_id)){i.ZP.warning(l.Z.t("no_context_tip"));return}let g={...o,conv_uid:c,app_code:a};try{var _,b;await (0,r.L)("".concat(null!==(_=d.env.API_BASE_URL)&&void 0!==_?_:"").concat(t),{method:"POST",headers:{"Content-Type":"application/json",[n.gp]:null!==(b=(0,s.n5)())&&void 0!==b?b:""},body:JSON.stringify(g),signal:v?v.signal:null,openWhenHidden:!0,async onopen(e){e.ok&&e.headers.get("content-type")===r.a||"application/json"!==e.headers.get("content-type")||e.json().then(e=>{null==u||u(e),null==x||x(),v&&v.abort()})},onclose(){v&&v.abort(),null==h||h()},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t="chat_agent"===p?JSON.parse(t).vis:JSON.parse(t)}catch(e){t.replaceAll("\\n","\n")}"string"==typeof t?"[DONE]"===t?null==x||x():(null==t?void 0:t.startsWith("[ERROR]"))?null==f||f(null==t?void 0:t.replace("[ERROR]","")):null==u||u(t):(null==u||u(t),null==x||x())}})}catch(e){v&&v.abort(),null==f||f("Sorry, We meet some error, please try agin later.",e)}},[t,a,p]);return{chat:h,ctrl:u}}},52903:function(e,t,a){"use strict";a.d(t,{TH:function(){return x},ZS:function(){return f}});var l=a(96469),s=a(52896),n=a(60205),r=a(87674),i=a(85851),o=a(80335),c=a(26869),d=a.n(c),u=a(83930),m=a(23852),p=a.n(m);a(38497);var h=a(26953);a(96768);let x=e=>{let{onClick:t,Icon:a="/pictures/card_chat.png",text:s=(0,u.t)("start_chat")}=e;return"string"==typeof a&&(a=(0,l.jsx)(p(),{src:a,alt:a,width:17,height:15})),(0,l.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[a,(0,l.jsx)("span",{children:s})]})},f=e=>{let{menu:t}=e;return(0,l.jsx)(o.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,l.jsx)(s.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:a,LeftBottom:s,RightBottom:o,onClick:c,rightTopHover:u=!0,logo:m,name:x,description:f,className:v,scene:g,code:_}=e;return"string"==typeof f&&(f=(0,l.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:f})),(0,l.jsx)("div",{className:d()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",v),children:(0,l.jsxs)("div",{onClick:c,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,l.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,l.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:g?(0,l.jsx)(h.Z,{scene:g,width:14,height:14}):m&&(0,l.jsx)(p(),{src:m,width:44,height:44,alt:x,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,l.jsx)("div",{className:"flex-1",children:x.length>6?(0,l.jsx)(n.Z,{title:x,children:(0,l.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})}):(0,l.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})})]}),(0,l.jsx)("span",{className:d()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),f,(0,l.jsx)("div",{className:"relative bottom-2",children:a}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("div",{children:s}),(0,l.jsx)("div",{children:o})]}),_&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Z,{className:"my-3"}),(0,l.jsx)(i.Z.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:_})]})]})})}},12061:function(e,t,a){"use strict";a.r(t),a.d(t,{ChatContentContext:function(){return eC},default:function(){return eP}});var l=a(96469),s=a(27623),n=a(37022),r=a(629),i=a(72804),o=a(98028),c=a(70351),d=a(49030),u=a(85851),m=a(42786),p=a(93486),h=a.n(p),x=a(38497),f=a(56841),v=a(16602),g=a(26953);let _=["magenta","orange","geekblue","purple","cyan","green"];var b=e=>{var t,a,p,b,j,y;let{isScrollToTop:w}=e,{appInfo:N,refreshAppInfo:k,handleChat:Z,scrollRef:S,temperatureValue:C,resourceValue:P,currentDialogue:R}=(0,x.useContext)(eC),{t:M}=(0,f.$G)(),O=(0,x.useMemo)(()=>{var e;return(null==N?void 0:null===(e=N.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent"},[N]),V=(0,x.useMemo)(()=>(null==N?void 0:N.is_collected)==="true",[N]),{run:L,loading:T}=(0,v.Z)(async()=>{let[e]=await (0,s.Vx)(V?(0,s.gD)({app_code:N.app_code}):(0,s.mo)({app_code:N.app_code}));if(!e)return await k()},{manual:!0}),z=(0,x.useMemo)(()=>{var e;return(null===(e=N.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[N.param_need]);if(!Object.keys(N).length)return null;let E=async()=>{let e=h()(location.href);c.ZP[e?"success":"error"](e?M("copy_success"):M("copy_failed"))};return(0,l.jsx)("div",{className:"h-20 mt-6 ".concat((null==N?void 0:N.recommend_questions)&&(null==N?void 0:null===(t=N.recommend_questions)||void 0===t?void 0:t.length)>0?"mb-6":""," sticky top-0 bg-transparent z-30 transition-all duration-400 ease-in-out"),children:w?(0,l.jsxs)("header",{className:"flex items-center justify-between w-full h-14 bg-[#ffffffb7] dark:bg-[rgba(41,63,89,0.4)]  px-8 transition-all duration-500 ease-in-out",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-2 bg-white",children:(0,l.jsx)(g.Z,{scene:O})}),(0,l.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,l.jsx)("span",{children:null==N?void 0:N.app_name}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(null==N?void 0:N.team_mode)&&(0,l.jsx)(d.Z,{color:"green",children:null==N?void 0:N.team_mode}),(null==N?void 0:null===(a=N.team_context)||void 0===a?void 0:a.chat_scene)&&(0,l.jsx)(d.Z,{color:"cyan",children:null==N?void 0:null===(p=N.team_context)||void 0===p?void 0:p.chat_scene})]})]})]}),(0,l.jsxs)("div",{className:"flex gap-8",onClick:async()=>{await L()},children:[T?(0,l.jsx)(m.Z,{spinning:T,indicator:(0,l.jsx)(n.Z,{style:{fontSize:24},spin:!0})}):(0,l.jsx)(l.Fragment,{children:V?(0,l.jsx)(r.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,l.jsx)(i.Z,{style:{fontSize:18,cursor:"pointer"}})}),(0,l.jsx)(o.Z,{className:"text-lg",onClick:e=>{e.stopPropagation(),E()}})]})]}):(0,l.jsxs)("header",{className:"flex items-center justify-between w-5/6 h-full px-6  bg-[#ffffff99] border dark:bg-[rgba(255,255,255,0.1)] dark:border-[rgba(255,255,255,0.1)] rounded-2xl mx-auto transition-all duration-400 ease-in-out relative",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex w-12 h-12 justify-center items-center rounded-xl mr-4 bg-white",children:(0,l.jsx)(g.Z,{scene:O,width:16,height:16})}),(0,l.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,l.jsx)("span",{children:null==N?void 0:N.app_name}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(null==N?void 0:N.team_mode)&&(0,l.jsx)(d.Z,{color:"green",children:null==N?void 0:N.team_mode}),(null==N?void 0:null===(b=N.team_context)||void 0===b?void 0:b.chat_scene)&&(0,l.jsx)(d.Z,{color:"cyan",children:null==N?void 0:null===(j=N.team_context)||void 0===j?void 0:j.chat_scene})]})]}),(0,l.jsx)(u.Z.Text,{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",ellipsis:{tooltip:!0},children:null==N?void 0:N.app_describe})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{onClick:async()=>{await L()},className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:T?(0,l.jsx)(m.Z,{spinning:T,indicator:(0,l.jsx)(n.Z,{style:{fontSize:24},spin:!0})}):(0,l.jsx)(l.Fragment,{children:V?(0,l.jsx)(r.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,l.jsx)(i.Z,{style:{fontSize:18,cursor:"pointer"}})})}),(0,l.jsx)("div",{onClick:E,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,l.jsx)(o.Z,{className:"text-lg"})})]}),!!(null==N?void 0:null===(y=N.recommend_questions)||void 0===y?void 0:y.length)&&(0,l.jsxs)("div",{className:"absolute  bottom-[-40px] left-0",children:[(0,l.jsx)("span",{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",children:"或许你想问："}),N.recommend_questions.map((e,t)=>(0,l.jsx)(d.Z,{color:_[t],className:"text-xs p-1 px-2 cursor-pointer",onClick:async()=>{Z((null==e?void 0:e.question)||"",{app_code:N.app_code,...z.includes("temperature")&&{temperature:C},...z.includes("resource")&&{select_param:"string"==typeof P?P:JSON.stringify(P)||R.select_param}}),setTimeout(()=>{var e,t;null===(e=S.current)||void 0===e||e.scrollTo({top:null===(t=S.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"})},0)},children:e.question},e.id))]})]})})},j=a(28469),y=a.n(j);let w=y()(()=>Promise.all([a.e(7521),a.e(5197),a.e(6370),a.e(5996),a.e(1320),a.e(9223),a.e(2476),a.e(4162),a.e(1657),a.e(9790),a.e(1766),a.e(8957),a.e(3549),a.e(9094),a.e(7389),a.e(2957),a.e(5891),a.e(9549),a.e(2672),a.e(3272)]).then(a.bind(a,54865)),{loadableGenerated:{webpack:()=>[54865]},ssr:!1});var N=(0,x.forwardRef)((e,t)=>{let{}=e,a=(0,x.useRef)(null),[s,n]=(0,x.useState)(!1);return(0,x.useImperativeHandle)(t,()=>a.current),(0,x.useEffect)(()=>(a.current&&a.current.addEventListener("scroll",()=>{var e;let t=(null===(e=a.current)||void 0===e?void 0:e.scrollTop)||0;t>=74?n(!0):n(!1)}),()=>{a.current&&a.current.removeEventListener("scroll",()=>{})}),[]),(0,l.jsx)("div",{className:"flex flex-1 overflow-hidden",children:(0,l.jsxs)("div",{ref:a,className:"h-full w-full mx-auto overflow-y-auto",children:[(0,l.jsx)(b,{isScrollToTop:s}),(0,l.jsx)(w,{})]})})}),k=a(19629),Z=a(97818),S=a(87313),C=a(52903),P=a(45277),R=a(23852),M=a.n(R),O=a(58526),V=e=>{let{apps:t,refresh:a,loading:n,type:o}=e,c=async e=>{let[t]=await (0,s.Vx)("true"===e.is_collected?(0,s.gD)({app_code:e.app_code}):(0,s.mo)({app_code:e.app_code}));t||a()},{setAgent:d,model:u,setCurrentDialogInfo:p}=(0,x.useContext)(P.p),h=(0,S.useRouter)(),f=async e=>{if("native_app"===e.team_mode){let{chat_scene:t=""}=e.team_context,[,a]=await (0,s.Vx)((0,s.sW)({chat_mode:t}));a&&(null==p||p({chat_scene:a.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:e.app_code})),h.push("/chat?scene=".concat(t,"&id=").concat(a.conv_uid).concat(u?"&model=".concat(u):"")))}else{let[,t]=await (0,s.Vx)((0,s.sW)({chat_mode:"chat_agent"}));t&&(null==p||p({chat_scene:t.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:e.app_code})),null==d||d(e.app_code),h.push("/chat/?scene=chat_agent&id=".concat(t.conv_uid).concat(u?"&model=".concat(u):"")))}};return n?(0,l.jsx)(m.Z,{size:"large",className:"flex items-center justify-center h-full",spinning:n}):(0,l.jsx)("div",{className:"flex flex-wrap mt-4 w-full overflow-y-auto ",children:(null==t?void 0:t.length)>0?t.map(e=>{var t;return(0,l.jsx)(C.ZP,{name:e.app_name,description:e.app_describe,onClick:()=>f(e),RightTop:"true"===e.is_collected?(0,l.jsx)(r.Z,{onClick:t=>{t.stopPropagation(),c(e)},style:{height:"21px",cursor:"pointer",color:"#f9c533"}}):(0,l.jsx)(i.Z,{onClick:t=>{t.stopPropagation(),c(e)},style:{height:"21px",cursor:"pointer"}}),LeftBottom:(0,l.jsxs)("div",{className:"flex gap-8 items-center text-gray-500 text-sm",children:[e.owner_name&&(0,l.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,l.jsx)(k.C,{src:null==e?void 0:e.owner_avatar_url,className:"bg-gradient-to-tr from-[#31afff] to-[#1677ff] cursor-pointer",children:e.owner_name}),(0,l.jsx)("span",{children:e.owner_name})]}),"used"!==o&&(0,l.jsxs)("div",{className:"flex items-start gap-1",children:[(0,l.jsx)(O.Z,{type:"icon-hot",className:"text-lg"}),(0,l.jsx)("span",{className:"text-[#878c93]",children:e.hot_value})]})]}),scene:(null==e?void 0:null===(t=e.team_context)||void 0===t?void 0:t.chat_scene)||"chat_agent"},e.app_code)}):(0,l.jsx)(Z.Z,{image:(0,l.jsx)(M(),{src:"/pictures/empty.png",alt:"empty",width:142,height:133,className:"w-[142px] h-[133px]"}),className:"flex justify-center items-center w-full h-full min-h-[200px]"})})},L=a(7289),T=a(71841),z=a(27691),E=a(26869),A=a.n(E),D=function(){let{setCurrentDialogInfo:e}=(0,x.useContext)(P.p),{t}=(0,f.$G)(),a=(0,S.useRouter)(),[n,r]=(0,x.useState)(""),[i,o]=(0,x.useState)(!1),[c,d]=(0,x.useState)(!1),u=async()=>{let[,t]=await (0,s.Vx)((0,s.sW)({chat_mode:"chat_normal"}));t&&(null==e||e({chat_scene:t.chat_mode,app_code:t.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:t.chat_mode})),localStorage.setItem(L.rU,JSON.stringify({id:t.conv_uid,message:n})),a.push("/chat/?scene=chat_normal&id=".concat(t.conv_uid))),r("")};return(0,l.jsxs)("div",{className:"flex flex-1 h-12 p-2 pl-4 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl  border-t border-b border-l border-r ".concat(i?"border-[#0c75fc]":""),children:[(0,l.jsx)(T.default.TextArea,{placeholder:t("input_tips"),className:"w-full resize-none border-0 p-0 focus:shadow-none",value:n,autoSize:{minRows:1},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!c&&(e.preventDefault(),n.trim()&&u())},onChange:e=>{r(e.target.value)},onFocus:()=>{o(!0)},onBlur:()=>o(!1),onCompositionStart:()=>d(!0),onCompositionEnd:()=>d(!1)}),(0,l.jsx)(z.ZP,{type:"primary",className:A()("flex items-center justify-center w-14 h-8 rounded-lg text-sm  bg-button-gradient border-0",{"opacity-40 cursor-not-allowed":!n.trim()}),onClick:()=>{n.trim()&&u()},children:t("sent")})]})},J=a(5381),W=a(42518),G=a(197),I=a(83930),$=function(){let{setCurrentDialogInfo:e,model:t}=(0,x.useContext)(P.p),a=(0,S.useRouter)(),[n,r]=(0,x.useState)({app_list:[],total_count:0}),[i,o]=(0,x.useState)("recommend"),c=e=>(0,s.Vx)((0,s.yk)({...e,page_no:"1",page_size:"6"})),d=e=>(0,s.Vx)((0,s.mW)({page_no:"1",page_size:"6",...e})),{run:u,loading:m,refresh:p}=(0,v.Z)(async e=>{switch(i){case"recommend":return await d({});case"used":return await c({is_recent_used:"true",need_owner_info:"true",...e&&{app_name:e}});default:return[]}},{manual:!0,onSuccess:e=>{let[t,a]=e;if("recommend"===i)return r({app_list:a,total_count:(null==a?void 0:a.length)||0});r(a||{})},debounceWait:500});(0,x.useEffect)(()=>{u()},[i,u]);let h=[{value:"recommend",label:(0,I.t)("recommend_apps")},{value:"used",label:(0,I.t)("used_apps")}],{data:f}=(0,v.Z)(async()=>{let[,e]=await (0,s.Vx)((0,J.A)({is_hot_question:"true"}));return null!=e?e:[]});return(0,l.jsx)(W.ZP,{theme:{components:{Button:{defaultBorderColor:"white"},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsxs)("div",{className:"px-28 py-10 h-full flex flex-col justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)(G.Z,{className:"backdrop-filter h-10 backdrop-blur-lg bg-white bg-opacity-30 border border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:h,value:i,onChange:e=>{o(e)}}),(0,l.jsxs)("span",{className:"flex items-center text-gray-500 gap-1 dark:text-slate-300",children:[(0,l.jsx)("span",{children:(0,I.t)("app_in_mind")}),(0,l.jsxs)("span",{className:"flex items-center cursor-pointer",onClick:()=>{a.push("/")},children:[(0,l.jsx)(M(),{src:"/pictures/explore_active.png",alt:"construct_image",width:24,height:24},"image_explore"),(0,l.jsx)("span",{className:"text-default",children:(0,I.t)("explore")})]}),(0,l.jsx)("span",{children:(0,I.t)("Discover_more")})]})]}),(0,l.jsx)(V,{apps:(null==n?void 0:n.app_list)||[],loading:m,refresh:p,type:i}),f&&f.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"font-medium text-xl my-4",children:(0,I.t)("help")}),(0,l.jsx)("div",{className:"flex justify-start gap-4",children:f.map(n=>(0,l.jsxs)("span",{className:"flex gap-4 items-center backdrop-filter backdrop-blur-lg cursor-pointer bg-white bg-opacity-70 border-0 rounded-lg shadow p-2 relative dark:bg-[#6f7f95] dark:bg-opacity-60",onClick:async()=>{let[,l]=await (0,s.Vx)((0,s.sW)({chat_mode:"chat_knowledge",model:t}));l&&(null==e||e({chat_scene:l.chat_mode,app_code:n.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:l.chat_mode,app_code:n.app_code})),localStorage.setItem(L.rU,JSON.stringify({id:l.conv_uid,message:n.question})),a.push("/chat/?scene=".concat(l.chat_mode,"&id=").concat(null==l?void 0:l.conv_uid)))},children:[(0,l.jsx)("span",{children:n.question}),(0,l.jsx)(M(),{src:"/icons/send.png",alt:"construct_image",width:20,height:20},"image_explore")]},n.id))})]})]}),(0,l.jsx)("div",{children:(0,l.jsx)(D,{})})]})})},q=a(45875),F=a(1858),B=a(72828),H=a(67620),U=a(60205),K=a(47309),X=a(39069),Y=a(61977),Q=(0,x.memo)(()=>{let{modelList:e}=(0,x.useContext)(P.p),{appInfo:t,modelValue:a,setModelValue:s}=(0,x.useContext)(eC),{t:n}=(0,f.$G)(),r=(0,x.useMemo)(()=>{var e;return(null===(e=t.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[t.param_need]);return r.includes("model")?(0,l.jsx)(X.default,{value:a,placeholder:n("choose_model"),className:"h-8 rounded-3xl",onChange:e=>{s(e)},popupMatchSelectWidth:300,children:e.map(e=>(0,l.jsx)(X.default.Option,{children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(Y.Z,{model:e}),(0,l.jsx)("span",{className:"ml-2",children:e})]})},e))}):(0,l.jsx)(U.Z,{title:n("model_tip"),children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,l.jsx)(K.Z,{className:"text-xl cursor-not-allowed opacity-30"})})})}),ee=a(59321),et=a(67423),ea=a(71534),el=a(77200),es=a(32818),en=(0,x.memo)(e=>{var t,a,n,r,i;let{fileList:o,setFileList:c,setLoading:d,fileName:u}=e,{setResourceValue:m,appInfo:p,refreshHistory:h,refreshDialogList:g,modelValue:_,resourceValue:b}=(0,x.useContext)(eC),j=(0,q.useSearchParams)(),y=null!==(t=null==j?void 0:j.get("scene"))&&void 0!==t?t:"",w=null!==(a=null==j?void 0:j.get("id"))&&void 0!==a?a:"",{t:N}=(0,f.$G)(),[k,Z]=(0,x.useState)([]),S=(0,x.useMemo)(()=>{var e;return(null===(e=p.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[p.param_need]),C=(0,x.useMemo)(()=>{var e,t;return S.includes("resource")&&(null===(e=null===(t=p.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="database"},[p.param_need,S]),P=(0,x.useMemo)(()=>{var e,t;return S.includes("resource")&&(null===(e=null===(t=p.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="knowledge"},[p.param_need,S]),R=(0,x.useMemo)(()=>{var e;return null===(e=p.param_need)||void 0===e?void 0:e.find(e=>"resource"===e.type)},[p.param_need]),{run:M,loading:O}=(0,v.Z)(async()=>await (0,s.Vx)((0,s.vD)(y)),{manual:!0,onSuccess:e=>{let[,t]=e;Z(null!=t?t:[])}});(0,el.Z)(async()=>{(C||P)&&!(null==R?void 0:R.bind_value)&&await M()},[C,P,R]);let V=(0,x.useMemo)(()=>{var e;return null===(e=k.map)||void 0===e?void 0:e.call(k,e=>({label:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ee.Z,{width:24,height:24,src:L.S$[e.type].icon,label:L.S$[e.type].label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.param]}),value:e.param}))},[k]),T=(0,x.useCallback)(async()=>{let e=new FormData;e.append("doc_file",null==o?void 0:o[0]),d(!0);let[t,a]=await (0,s.Vx)((0,s.qn)({convUid:w,chatMode:y,data:e,model:_,config:{timeout:36e5}})).finally(()=>{d(!1)});a&&(m(a),await h(),await g())},[w,o,_,g,h,y,d,m]);if(!S.includes("resource"))return(0,l.jsx)(U.Z,{title:N("extend_tip"),children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,l.jsx)(et.Z,{className:"text-lg cursor-not-allowed opacity-30"})})});switch(null==R?void 0:R.value){case"excel_file":case"text_file":case"image_file":return(0,l.jsx)(es.default,{name:"file",accept:".csv,.xlsx,.xls",fileList:o,showUploadList:!1,beforeUpload:(e,t)=>{null==c||c(t)},customRequest:T,disabled:!!u||!!(null===(n=o[0])||void 0===n?void 0:n.name),children:(0,l.jsx)(U.Z,{title:N("file_tip"),arrow:!1,placement:"bottom",children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,l.jsx)(ea.Z,{className:A()("text-xl",{"cursor-pointer":!(u||(null===(r=o[0])||void 0===r?void 0:r.name))})})})})});case"database":case"knowledge":case"plugin":case"awel_flow":return b||m(null==V?void 0:null===(i=V[0])||void 0===i?void 0:i.value),(0,l.jsx)(X.default,{value:b,className:"w-52 h-8 rounded-3xl",onChange:e=>{m(e)},disabled:!!(null==R?void 0:R.bind_value),loading:O,options:V})}}),er=a(27214),ei=a(62971),eo=a(28822),ec=a(91103),ed=(0,x.memo)(e=>{let{temperatureValue:t,setTemperatureValue:a}=e,{appInfo:s}=(0,x.useContext)(eC),{t:n}=(0,f.$G)(),r=(0,x.useMemo)(()=>{var e;return(null===(e=s.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[s.param_need]);if(!r.includes("temperature"))return(0,l.jsx)(U.Z,{title:n("temperature_tip"),children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,l.jsx)(er.Z,{className:"text-xl cursor-not-allowed opacity-30"})})});let i=e=>{isNaN(e)||a(e)};return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(ei.Z,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eo.Z,{className:"w-20",min:0,max:1,step:.1,onChange:i,value:"number"==typeof t?t:0}),(0,l.jsx)(ec.Z,{size:"small",className:"w-14",min:0,max:1,step:.1,onChange:i,value:t})]}),children:(0,l.jsx)(U.Z,{title:n("temperature"),placement:"bottom",arrow:!1,children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,l.jsx)(er.Z,{})})})}),(0,l.jsx)("span",{className:"text-sm ml-2",children:t})]})}),eu=e=>{var t,a;let{ctrl:r}=e,{t:i}=(0,f.$G)(),{history:o,scrollRef:c,canAbort:d,replyLoading:u,currentDialogue:p,appInfo:h,temperatureValue:v,resourceValue:g,setTemperatureValue:_,refreshHistory:b,setCanAbort:j,setReplyLoading:y,handleChat:w}=(0,x.useContext)(eC),[N,k]=(0,x.useState)([]),[Z,S]=(0,x.useState)(!1),[C,P]=(0,x.useState)(!1),R=(0,x.useMemo)(()=>{var e;return(null===(e=h.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[h.param_need]),O=(0,x.useMemo)(()=>[{tip:i("stop_replying"),icon:(0,l.jsx)(F.Z,{className:A()({"text-[#0c75fc]":d})}),can_use:d,key:"abort",onClick:()=>{d&&(r.abort(),setTimeout(()=>{j(!1),y(!1)},100))}},{tip:i("answer_again"),icon:(0,l.jsx)(B.Z,{}),can_use:!u&&o.length>0,key:"redo",onClick:async()=>{var e,t;let a=null===(e=null===(t=o.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];w((null==a?void 0:a.context)||"",{app_code:h.app_code,...R.includes("temperature")&&{temperature:v},...R.includes("resource")&&{select_param:"string"==typeof g?g:JSON.stringify(g)||p.select_param}}),setTimeout(()=>{var e,t;null===(e=c.current)||void 0===e||e.scrollTo({top:null===(t=c.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"})},0)}},{tip:i("erase_memory"),icon:C?(0,l.jsx)(m.Z,{spinning:C,indicator:(0,l.jsx)(n.Z,{style:{fontSize:20}})}):(0,l.jsx)(H.Z,{}),can_use:o.length>0,key:"clear",onClick:async()=>{C||(P(!0),await (0,s.Vx)((0,s.zR)(p.conv_uid)).finally(async()=>{await b(),P(!1)}))}}],[i,d,u,o,C,r,j,y,w,h.app_code,R,v,g,p.select_param,p.conv_uid,c,b]),V=(0,x.useMemo)(()=>{try{return JSON.parse(p.select_param).file_name}catch(e){return""}},[p.select_param]);return(0,l.jsxs)("div",{className:"flex flex-col  mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between h-full w-full",children:[(0,l.jsxs)("div",{className:"flex gap-3 text-lg",children:[(0,l.jsx)(Q,{}),(0,l.jsx)(en,{fileList:N,setFileList:k,setLoading:S,fileName:V}),(0,l.jsx)(ed,{temperatureValue:v,setTemperatureValue:_})]}),(0,l.jsx)("div",{className:"flex gap-1",children:(0,l.jsx)(l.Fragment,{children:O.map(e=>(0,l.jsx)(U.Z,{title:e.tip,arrow:!1,placement:"bottom",children:(0,l.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] text-lg ".concat(e.can_use?"cursor-pointer":"opacity-30 cursor-not-allowed"),onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)},children:e.icon})},e.key))})})]}),(V||(null===(t=N[0])||void 0===t?void 0:t.name))&&(0,l.jsx)("div",{className:"group/item flex mt-2",children:(0,l.jsxs)("div",{className:"flex items-center justify-between w-64 border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(M(),{src:"/icons/chat/excel.png",width:20,height:20,alt:"file-icon",className:"mr-2"}),(0,l.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:V||(null===(a=N[0])||void 0===a?void 0:a.name)})]}),(0,l.jsx)(m.Z,{spinning:Z,indicator:(0,l.jsx)(n.Z,{style:{fontSize:24},spin:!0})})]})})]})},em=e=>{var t;let{ctrl:a}=e,{t:s}=(0,f.$G)(),{scrollRef:r,replyLoading:i,handleChat:o,appInfo:c,currentDialogue:d,temperatureValue:u,resourceValue:p,refreshDialogList:h}=(0,x.useContext)(eC),v=(0,q.useSearchParams)();null==v||v.get("scene");let g=null!==(t=null==v?void 0:v.get("select_param"))&&void 0!==t?t:"",[_,b]=(0,x.useState)(""),[j,y]=(0,x.useState)(!1),[w,N]=(0,x.useState)(!1),k=(0,x.useRef)(0),Z=(0,x.useMemo)(()=>{var e;return(null===(e=c.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[c.param_need]),S=async()=>{k.current++,setTimeout(()=>{var e,t;null===(e=r.current)||void 0===e||e.scrollTo({top:null===(t=r.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"}),b("")},0),await o(_,{app_code:c.app_code||"",...Z.includes("temperature")&&{temperature:u},select_param:g,...Z.includes("resource")&&{select_param:"string"==typeof p?p:JSON.stringify(p)||d.select_param}}),1===k.current&&await h()};return(0,l.jsx)("div",{className:"flex flex-col w-5/6 mx-auto pt-4 pb-6 bg-transparent",children:(0,l.jsxs)("div",{className:"flex flex-1 flex-col bg-white dark:bg-[rgba(255,255,255,0.16)] px-5 py-4 pt-2 rounded-xl relative border-t border-b border-l border-r dark:border-[rgba(255,255,255,0.6)] ".concat(j?"border-[#0c75fc]":""),id:"input-panel",children:[(0,l.jsx)(eu,{ctrl:a}),(0,l.jsx)(T.default.TextArea,{placeholder:s("input_tips"),className:"w-full h-20 resize-none border-0 p-0 focus:shadow-none dark:bg-transparent",value:_,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!w&&(e.preventDefault(),_.trim()&&!i&&S())},onChange:e=>{b(e.target.value)},onFocus:()=>{y(!0)},onBlur:()=>y(!1),onCompositionStart:()=>N(!0),onCompositionEnd:()=>N(!1)}),(0,l.jsx)(z.ZP,{type:"primary",className:A()("flex items-center justify-center w-14 h-8 rounded-lg text-sm absolute right-4 bottom-3 bg-button-gradient border-0",{"cursor-not-allowed":!_.trim()}),onClick:()=>{!i&&_.trim()&&S()},children:i?(0,l.jsx)(m.Z,{spinning:i,indicator:(0,l.jsx)(n.Z,{className:"text-white"})}):s("sent")})]})})},ep=a(1952),eh=a(2537),ex=a(47271),ef=a(60943),ev=a(41993),eg=a(79839),e_=a(58898);let{Sider:eb}=ev.default,ej={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8},ey=e=>{var t,a;let{item:n,refresh:r,historyLoading:i,order:o}=e,{t:d}=(0,f.$G)(),m=(0,q.useRouter)(),p=(0,q.useSearchParams)(),v=null!==(t=null==p?void 0:p.get("id"))&&void 0!==t?t:"",g=null!==(a=null==p?void 0:p.get("scene"))&&void 0!==a?a:"",{setCurrentDialogInfo:_}=(0,x.useContext)(P.p),b=(0,x.useMemo)(()=>n.default?n.default&&!v&&!g:n.conv_uid===v&&n.chat_mode===g,[v,g,n]),j=()=>{eg.default.confirm({title:d("delete_chat"),content:d("delete_chat_confirm"),centered:!0,onOk:async()=>{let[e]=await (0,s.Vx)((0,s.MX)(n.conv_uid));e||(await (null==r?void 0:r()),n.conv_uid===v&&m.push("/chat"))}})};return(0,l.jsxs)(e_.Z,{align:"center",className:"group/item w-full h-12 p-3 rounded-lg  hover:bg-white dark:hover:bg-theme-dark cursor-pointer mb-2 relative ".concat(b?"bg-white dark:bg-theme-dark bg-opacity-100":""),onClick:()=>{i||(n.default||null==_||_({chat_scene:n.chat_mode,app_code:n.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:n.chat_mode,app_code:n.app_code})),m.push(n.default?"/chat":"?scene=".concat(n.chat_mode,"&id=").concat(n.conv_uid)))},children:[(0,l.jsx)(U.Z,{title:n.chat_mode,children:(0,l.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-3 bg-white",children:n.icon})}),(0,l.jsx)("div",{className:"flex flex-1 line-clamp-1",children:(0,l.jsx)(u.Z.Text,{ellipsis:{tooltip:!0},children:n.label})}),!n.default&&(0,l.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,l.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation()},children:(0,l.jsx)(ep.Z,{style:{fontSize:16},onClick:()=>{let e=h()("".concat(location.origin,"/chat?scene=").concat(n.chat_mode,"&id=").concat(n.conv_uid));c.ZP[e?"success":"error"](e?d("copy_success"):d("copy_failed"))}})}),(0,l.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation(),j()},children:(0,l.jsx)(eh.Z,{style:{fontSize:16}})})]}),(0,l.jsx)("div",{className:" w-1 rounded-sm bg-[#0c75fc] absolute top-1/2 left-0 -translate-y-1/2 transition-all duration-500 ease-in-out ".concat(b?"h-5":"w-0 h-0")})]})};var ew=e=>{var t;let{dialogueList:a=[],refresh:s,historyLoading:n,listLoading:r,order:i}=e,o=(0,q.useSearchParams)(),c=null!==(t=null==o?void 0:o.get("scene"))&&void 0!==t?t:"",{t:d}=(0,f.$G)(),{mode:u}=(0,x.useContext)(P.p),[p,h]=(0,x.useState)("chat_dashboard"===c),v=(0,x.useMemo)(()=>p?{...ej,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...ej,borderLeft:"1px solid #d6d8da"},[p]),_=(0,x.useMemo)(()=>{let e=a[1]||[];return(null==e?void 0:e.length)>0?e.map(e=>({...e,label:e.user_input||e.select_param,key:e.conv_uid,icon:(0,l.jsx)(g.Z,{scene:e.chat_mode}),default:!1})):[]},[a]);return(0,l.jsx)(eb,{className:"bg-[#ffffff80]  border-r  border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:u,width:280,collapsible:!0,collapsed:p,collapsedWidth:0,trigger:p?(0,l.jsx)(ex.Z,{className:"text-base"}):(0,l.jsx)(ef.Z,{className:"text-base"}),zeroWidthTriggerStyle:v,onCollapse:e=>h(e),children:(0,l.jsxs)("div",{className:"flex flex-col h-full w-full bg-transparent px-4 pt-6  ",children:[(0,l.jsx)("div",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] mb-4 line-clamp-1",children:d("dialog_list")}),(0,l.jsxs)(e_.Z,{flex:1,vertical:!0,className:"overflow-y-auto",children:[(0,l.jsx)(ey,{item:{label:d("assistant"),key:"default",icon:(0,l.jsx)(M(),{src:"/LOGO_SMALL.png",alt:"default",width:24,height:24,className:"flex-1"}),default:!0},order:i}),(0,l.jsx)(m.Z,{spinning:r,className:"mt-2",children:!!(null==_?void 0:_.length)&&_.map(e=>(0,l.jsx)(ey,{item:e,refresh:s,historyLoading:n,order:i},null==e?void 0:e.key))})]})]})})},eN=a(78638);let ek=y()(()=>Promise.all([a.e(7521),a.e(5197),a.e(6370),a.e(1320),a.e(9223),a.e(2476),a.e(4162),a.e(9790),a.e(1766),a.e(9094),a.e(7389),a.e(2672),a.e(6573)]).then(a.bind(a,21601)),{loadableGenerated:{webpack:()=>[21601]},ssr:!1}),eZ=y()(()=>Promise.all([a.e(7521),a.e(5197),a.e(6370),a.e(5360),a.e(5996),a.e(1320),a.e(9223),a.e(2476),a.e(4162),a.e(1657),a.e(9790),a.e(1766),a.e(8957),a.e(3549),a.e(9094),a.e(7389),a.e(7123),a.e(5286),a.e(5891),a.e(9549),a.e(2672),a.e(6858)]).then(a.bind(a,62048)),{loadableGenerated:{webpack:()=>[62048]},ssr:!1}),{Content:eS}=ev.default,eC=(0,x.createContext)({history:[],replyLoading:!1,scrollRef:{current:null},canAbort:!1,chartsData:[],agent:"",currentDialogue:{},appInfo:{},temperatureValue:.5,resourceValue:{},modelValue:"",setModelValue:()=>{},setResourceValue:()=>{},setTemperatureValue:()=>{},setAppInfo:()=>{},setAgent:()=>{},setCanAbort:()=>{},setReplyLoading:()=>{},refreshDialogList:()=>{},refreshHistory:()=>{},refreshAppInfo:()=>{},setHistory:()=>{},handleChat:()=>Promise.resolve()});var eP=()=>{var e,t,a,n;let{model:r,currentDialogInfo:i}=(0,x.useContext)(P.p),{isContract:o,setIsContract:c,setIsMenuExpand:d}=(0,x.useContext)(P.p),{chat:u,ctrl:p}=(0,eN.Z)({app_code:i.app_code||""}),h=(0,q.useSearchParams)(),f=null!==(e=null==h?void 0:h.get("id"))&&void 0!==e?e:"",g=null!==(t=null==h?void 0:h.get("scene"))&&void 0!==t?t:"",_=null!==(a=null==h?void 0:h.get("knowledge_id"))&&void 0!==a?a:"",b=null!==(n=null==h?void 0:h.get("db_name"))&&void 0!==n?n:"",j=(0,x.useRef)(null),y=(0,x.useRef)(1),[w,k]=(0,x.useState)([]),[Z,S]=(0,x.useState)(),[C,R]=(0,x.useState)(!1),[M,O]=(0,x.useState)(!1),[V,T]=(0,x.useState)(""),[z,E]=(0,x.useState)({}),[A,D]=(0,x.useState)(),[J,W]=(0,x.useState)(),[G,I]=(0,x.useState)("");(0,x.useEffect)(()=>{var e,t,a,l,s,n;D((null===(e=null==z?void 0:null===(t=z.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type)[0])||void 0===e?void 0:e.value)||.5),I((null===(a=null==z?void 0:null===(l=z.param_need)||void 0===l?void 0:l.filter(e=>"model"===e.type)[0])||void 0===a?void 0:a.value)||r),W(_||b||(null===(s=null==z?void 0:null===(n=z.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type)[0])||void 0===s?void 0:s.bind_value))},[z,b,_,r]),(0,x.useEffect)(()=>{d("chat_dashboard"!==g),f&&g&&c(!1)},[f,g]);let F=(0,x.useMemo)(()=>!f&&!g,[f,g]),{data:B=[],refresh:H,loading:U}=(0,v.Z)(async()=>await (0,s.Vx)((0,s.iP)())),{run:K,refresh:X}=(0,v.Z)(async()=>await (0,s.Vx)((0,s.BN)({...i})),{manual:!0,onSuccess:e=>{let[,t]=e;E(t||{})}}),Y=(0,x.useMemo)(()=>{let[,e]=B;return(null==e?void 0:e.find(e=>e.conv_uid===f))||{}},[f,B]);(0,x.useEffect)(()=>{let e=(0,L.a_)();i.chat_scene!==g||F||e&&e.message||K()},[f,i,F,K,g]);let{run:Q,loading:ee,refresh:et}=(0,v.Z)(async()=>await (0,s.Vx)((0,s.$i)(f)),{manual:!0,onSuccess:e=>{let[,t]=e,a=null==t?void 0:t.filter(e=>"view"===e.role);a&&a.length>0&&(y.current=a[a.length-1].order+1),k(t||[])}}),ea=(0,x.useCallback)((e,t)=>new Promise(a=>{let l=(0,L.a_)(),s=new AbortController;if(R(!0),w&&w.length>0){var n,r;let e=null==w?void 0:w.filter(e=>"view"===e.role),t=null==w?void 0:w.filter(e=>"human"===e.role);y.current=((null===(n=e[e.length-1])||void 0===n?void 0:n.order)||(null===(r=t[t.length-1])||void 0===r?void 0:r.order))+1}let i=[...l&&l.id===f?[]:w,{role:"human",context:e,model_name:(null==t?void 0:t.model_name)||G,order:y.current,time_stamp:0},{role:"view",context:"",model_name:(null==t?void 0:t.model_name)||G,order:y.current,time_stamp:0,thinking:!0}],o=i.length-1;k([...i]),u({data:{chat_mode:g,model_name:G,user_input:e,...t},ctrl:s,chatId:f,onMessage:e=>{O(!0),(null==t?void 0:t.incremental)?(i[o].context+=e,i[o].thinking=!1):(i[o].context=e,i[o].thinking=!1),k([...i])},onDone:()=>{R(!1),O(!1),a()},onClose:()=>{R(!1),O(!1),a()},onError:e=>{R(!1),O(!1),i[o].context=e,i[o].thinking=!1,k([...i]),a()}})}),[f,w,G,u,g]);return(0,el.Z)(async()=>{if(F)return;let e=(0,L.a_)();e&&e.id===f||await Q()},[f,g,Q]),(0,x.useEffect)(()=>{F&&(y.current=1,k([]))},[F]),(0,l.jsx)(eC.Provider,{value:{history:w,replyLoading:C,scrollRef:j,canAbort:M,chartsData:Z||[],agent:V,currentDialogue:Y,appInfo:z,temperatureValue:A,resourceValue:J,modelValue:G,setModelValue:I,setResourceValue:W,setTemperatureValue:D,setAppInfo:E,setAgent:T,setCanAbort:O,setReplyLoading:R,handleChat:ea,refreshDialogList:H,refreshHistory:et,refreshAppInfo:X,setHistory:k},children:(0,l.jsx)(e_.Z,{flex:1,children:(0,l.jsxs)(ev.default,{className:"bg-gradient-light bg-cover bg-center dark:bg-gradient-dark",children:[(0,l.jsx)(ew,{refresh:H,dialogueList:B,listLoading:U,historyLoading:ee,order:y}),(0,l.jsx)(ev.default,{className:"bg-transparent",children:"chat_dashboard"===g?o?(0,l.jsx)(ek,{}):(0,l.jsx)(eZ,{}):F?(0,l.jsx)(eS,{children:(0,l.jsx)($,{})}):(0,l.jsx)(m.Z,{spinning:ee,className:"w-full h-full m-auto",children:(0,l.jsxs)(eS,{className:"flex flex-col h-screen",children:[(0,l.jsx)(N,{ref:j}),(0,l.jsx)(em,{ctrl:p})]})})})]})})})}},96768:function(){}}]);