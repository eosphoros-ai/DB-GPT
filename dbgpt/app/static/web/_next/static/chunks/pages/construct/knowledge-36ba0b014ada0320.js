(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4554,3913],{45629:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/knowledge",function(){return l(14545)}])},2440:function(e,t,l){"use strict";var a=l(25519);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}},39718:function(e,t,l){"use strict";var a=l(85893),n=l(19284),s=l(25675),r=l.n(s),i=l(67294);t.Z=(0,i.memo)(e=>{let{width:t,height:l,model:s}=e,c=(0,i.useMemo)(()=>{let e=null==s?void 0:s.replaceAll("-","_").split("_")[0],t=Object.keys(n.Me);for(let l=0;l<t.length;l++){let a=t[l];if(null==e?void 0:e.includes(a))return n.Me[a]}return"/models/huggingface.svg"},[s]);return s?(0,a.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:l||24,src:c,alt:"llm",priority:!0}):null})},48218:function(e,t,l){"use strict";var a=l(85893),n=l(82353),s=l(16165),r=l(67294);t.Z=e=>{let{width:t,height:l,scene:i}=e,c=(0,r.useCallback)(()=>{switch(i){case"chat_knowledge":return n.je;case"chat_with_db_execute":return n.zM;case"chat_excel":return n.DL;case"chat_with_db_qa":case"chat_dba":return n.RD;case"chat_dashboard":return n.In;case"chat_agent":return n.si;case"chat_normal":return n.O7;default:return}},[i]);return(0,a.jsx)(s.Z,{className:"w-".concat(t||7," h-").concat(l||7),component:c()})}},70065:function(e,t,l){"use strict";var a=l(91321);let n=(0,a.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});t.Z=n},1771:function(e,t,l){"use strict";var a=l(85893);l(67294);var n=l(28459),s=l(11941),r=l(36609),i=l(41156),c=l(9641),o=l(16165),d=l(9020),u=l(92962),m=l(38545),x=l(50067),p=l(82353),h=l(11163);l(53878),t.Z=function(e){let{children:t}=e,l=[{key:"app",name:(0,r.t)("App"),path:"/app",icon:(0,a.jsx)(i.Z,{})},{key:"flow",name:(0,r.t)("awel_flow"),icon:(0,a.jsx)(c.Z,{}),path:"/flow"},{key:"models",name:(0,r.t)("model_manage"),path:"/models",icon:(0,a.jsx)(o.Z,{component:p.IN})},{key:"database",name:(0,r.t)("Database"),icon:(0,a.jsx)(d.Z,{}),path:"/database"},{key:"knowledge",name:(0,r.t)("Knowledge_Space"),icon:(0,a.jsx)(u.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,r.t)("Prompt"),icon:(0,a.jsx)(m.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,r.t)("dbgpts_community"),path:"/dbgpts",icon:(0,a.jsx)(x.Z,{})}],f=(0,h.useRouter)(),j=f.pathname.split("/")[2];return window.matchMedia("(prefers-color-scheme: dark)").matches,(0,a.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,a.jsx)(n.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,a.jsx)(s.Z,{activeKey:j,items:l.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{f.push("/construct/".concat(e))}})})})}},14545:function(e,t,l){"use strict";let a;l.r(t),l.d(t,{default:function(){return eE}});var n=l(85893),s=l(91467),r=l(1771),i=l(41468),c=l(76212),o=l(79090),d=l(98165),u=l(28058),m=l(40110),x=l(55287),p=l(47389),h=l(82061),f=l(3471),j=l(51042),g=l(18754),_=l(13179),v=l(90725),b=l(3089),y=l(65654),N=l(85576),w=l(45360),k=l(74330),Z=l(42075),C=l(8232),S=l(83062),I=l(66309),P=l(26855),T=l(14726),E=l(55102),F=l(4393),q=l(85418),U=l(32983),R=l(96074),D=l(93967),A=l.n(D),O=l(30381),V=l.n(O),L=l(11163),M=l(67294),z=l(67421),G=l(71230),H=l(15746),Y=l(11941),$=l(31545),B=l(6321),J=l(90389);let{TextArea:K}=E.default;function W(e){let{space:t,argumentsShow:l,setArgumentsShow:a}=e,{t:s}=(0,z.$G)(),[r,i]=(0,M.useState)(),[o,d]=(0,M.useState)(!1),u=async()=>{let[e,l]=await (0,c.Vx)((0,c.Tu)(t.name));i(l)};(0,M.useEffect)(()=>{u()},[t.name]);let m=[{key:"Embedding",label:(0,n.jsxs)("div",{children:[(0,n.jsx)($.Z,{}),s("Embedding")]}),children:(0,n.jsxs)(G.Z,{gutter:24,children:[(0,n.jsx)(H.Z,{span:12,offset:0,children:(0,n.jsx)(C.default.Item,{tooltip:s("the_top_k_vectors"),rules:[{required:!0}],label:s("topk"),name:["embedding","topk"],children:(0,n.jsx)(E.default,{className:"mb-5 h-12"})})}),(0,n.jsx)(H.Z,{span:12,children:(0,n.jsx)(C.default.Item,{tooltip:s("Set_a_threshold_score"),rules:[{required:!0}],label:s("recall_score"),name:["embedding","recall_score"],children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:"请输入"})})}),(0,n.jsx)(H.Z,{span:12,children:(0,n.jsx)(C.default.Item,{tooltip:s("recall_type"),rules:[{required:!0}],label:s("recall_type"),name:["embedding","recall_type"],children:(0,n.jsx)(E.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(H.Z,{span:12,children:(0,n.jsx)(C.default.Item,{tooltip:s("A_model_used"),rules:[{required:!0}],label:s("model"),name:["embedding","model"],children:(0,n.jsx)(E.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(H.Z,{span:12,children:(0,n.jsx)(C.default.Item,{tooltip:s("The_size_of_the_data_chunks"),rules:[{required:!0}],label:s("chunk_size"),name:["embedding","chunk_size"],children:(0,n.jsx)(E.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(H.Z,{span:12,children:(0,n.jsx)(C.default.Item,{tooltip:s("The_amount_of_overlap"),rules:[{required:!0}],label:s("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:s("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(B.Z,{}),s("Prompt")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{tooltip:s("A_contextual_parameter"),label:s("scene"),name:["prompt","scene"],children:(0,n.jsx)(K,{rows:4,className:"mb-2"})}),(0,n.jsx)(C.default.Item,{tooltip:s("structure_or_format"),label:s("template"),name:["prompt","template"],children:(0,n.jsx)(K,{rows:7,className:"mb-2"})}),(0,n.jsx)(C.default.Item,{tooltip:s("The_maximum_number_of_tokens"),label:s("max_token"),name:["prompt","max_token"],children:(0,n.jsx)(E.default,{className:"mb-2"})})]})},{key:"Summary",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(J.Z,{}),s("Summary")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{rules:[{required:!0}],label:s("max_iteration"),name:["summary","max_iteration"],children:(0,n.jsx)(E.default,{className:"mb-2"})}),(0,n.jsx)(C.default.Item,{rules:[{required:!0}],label:s("concurrency_limit"),name:["summary","concurrency_limit"],children:(0,n.jsx)(E.default,{className:"mb-2"})})]})}],x=async e=>{d(!0);let[l,n,s]=await (0,c.Vx)((0,c.iH)(t.name,{argument:JSON.stringify(e)}));d(!1),(null==s?void 0:s.success)&&a(!1)};return(0,n.jsx)(N.default,{width:850,open:l,onCancel:()=>{a(!1)},footer:null,children:(0,n.jsx)(k.Z,{spinning:o,children:(0,n.jsxs)(C.default,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...r},autoComplete:"off",onFinish:x,children:[(0,n.jsx)(Y.Z,{items:m}),(0,n.jsxs)("div",{className:"mt-3 mb-3",children:[(0,n.jsx)(T.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:s("Submit")}),(0,n.jsx)(T.ZP,{onClick:()=>{a(!1)},children:s("close")})]})]})})})}var Q=l(27595),X=l(27329),ee=l(65886),et=l(68346);function el(e){let{type:t}=e;return"TEXT"===t?(0,n.jsx)(Q.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===t?(0,n.jsx)(X.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"YUQUEURL"===t?(0,n.jsx)(ee.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,n.jsx)(et.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"})}var ea=l(18102),en=l(42952),es=l(55241),er=l(73320),ei=l(34041),ec=e=>{let{open:t,setOpen:l,space:a}=e,[s]=C.default.useForm(),[r]=C.default.useForm(),{data:i=[],run:o}=(0,y.Z)(async()=>{let[,e]=await (0,c.Vx)((0,c.Pg)(a.name+""));return null!=e?e:[]},{manual:!0}),{data:d=[],run:u}=(0,y.Z)(async()=>{let[,e]=await (0,c.Vx)((0,c.UO)(a.name+""));return null!=e?e:[]},{manual:!0,onSuccess:e=>{r.setFieldValue("recall_retrievers",e)}});(0,M.useEffect)(()=>{t&&u()},[t,u,o]);let{run:m,data:x=[],loading:p}=(0,y.Z)(async e=>{let[,t]=await (0,c.Vx)((0,c.Y2)({...e},a.name+""));return null!=t?t:[]},{manual:!0}),h=async()=>{s.validateFields().then(async e=>{let t=r.getFieldsValue();console.log(t),await m({recall_top_k:1,recall_retrievers:d,...e,...t})})};return(0,n.jsxs)(N.default,{title:"召回测试",width:"60%",open:t,footer:!1,onCancel:()=>l(!1),centered:!0,destroyOnClose:!0,children:[(0,n.jsx)(F.Z,{title:"召回配置",size:"small",className:"my-4",extra:(0,n.jsx)(es.Z,{placement:"bottomRight",trigger:"hover",title:"向量检索设置",content:(0,n.jsxs)(C.default,{form:r,initialValues:{recall_top_k:1},children:[(0,n.jsx)(C.default.Item,{label:"Topk",tooltip:"基于相似度得分的前 k 个向量",name:"recall_top_k",children:(0,n.jsx)(er.Z,{placeholder:"请输入",className:"w-full"})}),(0,n.jsx)(C.default.Item,{label:"召回方法",name:"recall_retrievers",children:(0,n.jsx)(ei.default,{mode:"multiple",options:d.map(e=>({label:e,value:e})),className:"w-full",allowClear:!0,disabled:!0})}),(0,n.jsx)(C.default.Item,{label:"score阈值",name:"recall_score_threshold",children:(0,n.jsx)(er.Z,{placeholder:"请输入",className:"w-full",step:.1})})]}),children:(0,n.jsx)(en.Z,{className:"text-lg"})}),children:(0,n.jsx)(C.default,{form:s,layout:"vertical",onFinish:h,children:(0,n.jsx)(C.default.Item,{label:"测试问题",required:!0,name:"question",rules:[{required:!0,message:"请输入测试问题"}],className:"m-0 p-0",children:(0,n.jsxs)("div",{className:"flex w-full items-center gap-8",children:[(0,n.jsx)(E.default,{placeholder:"请输入测试问题",autoComplete:"off",allowClear:!0,className:"w-1/2"}),(0,n.jsx)(T.ZP,{type:"primary",htmlType:"submit",children:"测试"})]})})})}),(0,n.jsx)(F.Z,{title:"召回结果",size:"small",children:(0,n.jsx)(k.Z,{spinning:p,children:x.length>0?(0,n.jsx)("div",{className:"flex flex-col overflow-y-auto",style:{height:"45vh"},children:x.map(e=>(0,n.jsx)(F.Z,{title:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)(I.Z,{color:"blue",children:["# ",e.chunk_id]}),e.metadata.prop_field.title]}),extra:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-semibold",children:"score:"}),(0,n.jsx)("span",{className:"text-blue-500",children:e.score})]}),size:"small",className:"mb-4 border-gray-500 shadow-md",children:(0,n.jsx)(ea.default,{children:e.content})},e.chunk_id))}):(0,n.jsx)(U.Z,{})})})]})};let{confirm:eo}=N.default,ed=e=>{let{name:t,id:l}=e,[a,s]=(0,M.useState)(!1),{t:r}=(0,z.$G)(),i=async(e,t)=>{var l;s(!0);let a=await (0,c.Vx)((0,c.Hx)(e,{doc_ids:[t]}));s(!1),(null===(l=a[2])||void 0===l?void 0:l.success)&&w.ZP.success(r("Synchronization_initiated"))};return a?(0,n.jsx)(k.Z,{indicator:(0,n.jsx)(o.Z,{spin:!0})}):(0,n.jsxs)(Z.Z,{onClick:()=>{i(t,l)},children:[(0,n.jsx)(d.Z,{}),(0,n.jsx)("span",{children:r("Sync")})]})};function eu(e){var t;let[l]=C.default.useForm(),{space:a,addStatus:s}=e,{t:r}=(0,z.$G)(),o=(0,L.useRouter)(),{isMenuExpand:d}=(0,M.useContext)(i.p),[D,O]=(0,M.useState)([]),[G,H]=(0,M.useState)([]),[Y,$]=(0,M.useState)([]),[B,J]=(0,M.useState)(!1),[K,Q]=(0,M.useState)(0),[X,ee]=(0,M.useState)(!1),[et,ea]=(0,M.useState)(),[en,es]=(0,M.useState)(!1),er=(0,M.useRef)(1),ei=(0,M.useMemo)(()=>(null==G?void 0:G.length)<K,[G,K]),eu=e=>{eo({title:r("Tips"),icon:(0,n.jsx)(u.Z,{}),content:"".concat(r("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await ef(e)}})},{run:em,refresh:ex,loading:ep}=(0,y.Z)(async()=>await (0,c.Vx)((0,c._Q)(a.name,{page:er.current,page_size:18})),{manual:!0,onSuccess:e=>{let[,t]=e;H(null==t?void 0:t.data),$(null==t?void 0:t.data),Q((null==t?void 0:t.total)||0)}}),eh=async()=>{if(!ei)return;er.current+=1;let[e,t]=await (0,c.Vx)((0,c._Q)(a.name,{page:er.current,page_size:18}));H([...G,...t.data]),$([...G,...t.data])},ef=async t=>{await (0,c.Vx)((0,c.n3)(a.name,{doc_name:t.doc_name})),em(),e.onDeleteDoc()},ej=()=>{e.onAddDoc(a.name)},eg=(e,t)=>{let l;switch(e){case"TODO":l="gold";break;case"RUNNING":l="#2db7f5";break;case"FINISHED":l="cyan";break;default:l="red"}return(0,n.jsx)(S.Z,{title:t,children:(0,n.jsx)(I.Z,{color:l,children:e})})};(0,M.useEffect)(()=>{em()},[]),(0,M.useEffect)(()=>{"finish"===s&&em()},[s]),(0,M.useCallback)(async e=>{let{data:t}=await (0,c.Yp)({space_id:a.id,user_nos:e});t.success?w.ZP.success(r("Edit_Success")):P.ZP.error({description:t.err_msg,message:"Update Error"})},[a.id]);let{run:e_,loading:ev}=(0,y.Z)(async(e,t)=>{let[,l]=await (0,c.Vx)((0,c.ey)(a.name,{doc_name:t}));return l},{manual:!0,debounceWait:500,onSuccess:e=>{console.log(e),$(null==e?void 0:e.data)}}),{run:eb,loading:ey}=(0,y.Z)(async t=>{var l;return await (0,c.k7)(e.space.name,{questions:null===(l=t.questions)||void 0===l?void 0:l.map(e=>e.question),doc_id:(null==et?void 0:et.id)||"",doc_name:t.doc_name})},{manual:!0,onSuccess:async e=>{e.data.success?(w.ZP.success(r("Edit_Success")),await em(),ee(!1)):w.ZP.error(e.data.err_msg)}});return(0,M.useEffect)(()=>{var e;et&&l.setFieldsValue({doc_name:et.doc_name,questions:null===(e=et.questions)||void 0===e?void 0:e.map(e=>({question:e}))})},[et,l]),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsxs)(Z.Z,{children:[(0,n.jsx)(T.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,n.jsx)(j.Z,{}),onClick:ej,children:r("Add_Datasource")}),(0,n.jsx)(T.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(g.Z,{}),onClick:()=>{J(!0)},children:"Arguments"}),"KnowledgeGraph"===a.vector_type&&(0,n.jsx)(T.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(_.Z,{}),onClick:()=>{o.push("/knowledge/graph/?spaceName=".concat(a.name))},children:r("View_Graph")}),(0,n.jsx)(T.ZP,{icon:(0,n.jsx)(v.Z,{}),onClick:()=>es(!0),children:r("Recall_test")})]}),(0,n.jsx)(R.Z,{}),(0,n.jsx)(k.Z,{spinning:ep,children:(0,n.jsxs)("div",{className:"w-full h-full",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{className:"flex w-full justify-end",children:(0,n.jsx)(T.ZP,{type:"primary",onClick:async()=>{await ex()},loading:ep,children:r("Refresh_status")})})}),(0,n.jsx)("div",{className:"flex flex-col h-full p-3 border rounded-md",children:(null==G?void 0:G.length)>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex flex-1 justify-between items-center",children:(0,n.jsx)(E.default,{className:"w-1/3",prefix:(0,n.jsx)(m.Z,{}),placeholder:r("please_enter_the_keywords"),onChange:async e=>{await e_(a.id,e.target.value)},allowClear:!0})}),(0,n.jsxs)(k.Z,{spinning:ev,children:[(0,n.jsx)(n.Fragment,{children:Y.length>0?(0,n.jsx)("div",{className:"h-96 mt-3 grid grid-cols-3 gap-x-6 gap-y-5 overflow-y-auto",children:Y.map(e=>(0,n.jsxs)(F.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full max-h-64",title:(0,n.jsx)(S.Z,{title:e.doc_name,children:(0,n.jsxs)("div",{className:"truncate ",children:[(0,n.jsx)(el,{type:e.doc_type}),(0,n.jsx)("span",{children:e.doc_name})]})}),extra:(0,n.jsx)(q.Z,{menu:{items:[{key:"publish",label:(0,n.jsxs)(Z.Z,{onClick:()=>{o.push("/construct/knowledge/chunk/?spaceName=".concat(a.name,"&id=").concat(e.id))},children:[(0,n.jsx)(x.Z,{}),(0,n.jsx)("span",{children:r("detail")})]})},{key:"".concat(r("Sync")),label:(0,n.jsx)(ed,{name:a.name,id:e.id})},{key:"edit",label:(0,n.jsxs)(Z.Z,{onClick:()=>{ee(!0),ea(e)},children:[(0,n.jsx)(p.Z,{}),(0,n.jsx)("span",{children:r("Edit")})]})},{key:"del",label:(0,n.jsxs)(Z.Z,{onClick:()=>{eu(e)},children:[(0,n.jsx)(h.Z,{}),(0,n.jsx)("span",{children:r("Delete")})]})}]},getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,className:"rounded-md",children:(0,n.jsx)(f.Z,{className:"p-2"})}),children:[(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[r("Size"),":"]}),(0,n.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[r("Last_Sync"),":"]}),(0,n.jsx)("p",{children:V()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,n.jsx)("p",{className:"mt-2 mb-2",children:eg(e.status,e.result)})]},e.id))}):(0,n.jsx)(U.Z,{className:"flex flex-1 w-full py-10 flex-col items-center justify-center",image:U.Z.PRESENTED_IMAGE_DEFAULT})}),ei&&(0,n.jsx)(R.Z,{children:(0,n.jsx)("span",{className:"cursor-pointer",onClick:eh,children:r("Load_more")})})]})]}):(0,n.jsx)(U.Z,{image:U.Z.PRESENTED_IMAGE_DEFAULT,children:(0,n.jsx)(T.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,n.jsx)(j.Z,{}),onClick:ej,children:"Create Now"})})})]})}),(0,n.jsx)(W,{space:a,argumentsShow:B,setArgumentsShow:J}),(0,n.jsx)(N.default,{title:r("Edit_document"),open:X,onCancel:()=>ee(!1),destroyOnClose:!0,footer:[(0,n.jsx)(T.ZP,{onClick:()=>ee(!1),children:r("cancel")},"back"),(0,n.jsx)(T.ZP,{type:"primary",loading:ey,onClick:async()=>{let e=l.getFieldsValue();await eb(e)},children:r("verify")},"submit")],children:(0,n.jsxs)(C.default,{form:l,initialValues:{doc_name:null==et?void 0:et.doc_name,questions:null==et?void 0:null===(t=et.questions)||void 0===t?void 0:t.map(e=>({question:e}))},children:[(0,n.jsx)(C.default.Item,{label:r("Document_name"),name:"doc_name",children:(0,n.jsx)(E.default,{})}),(0,n.jsx)(C.default.Item,{label:r("Correlation_problem"),children:(0,n.jsx)(C.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>{let{key:l,name:s}=e;return(0,n.jsxs)("div",{className:A()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(C.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,n.jsx)(E.default,{placeholder:"请输入"})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(b.Z,{onClick:()=>{a(s)}})})]},l)}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"dashed",onClick:()=>{l({question:"",valid:!1})},block:!0,icon:(0,n.jsx)(j.Z,{}),children:r("Add_problem")})})]})}})})]})}),(0,n.jsx)(ec,{open:en,setOpen:es,space:a})]})}function em(e){let{t}=(0,z.$G)(),{handleStepChange:l}=e,a=[{type:"TEXT",title:t("Text"),subTitle:t("Fill your raw text"),iconType:"TEXT"},{type:"URL",title:t("URL"),subTitle:t("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"DOCUMENT",title:t("Document"),subTitle:t("Upload_a_document"),iconType:"DOCUMENT"},{type:"YUQUEURL",title:t("yuque"),subTitle:t("Get_yuque_document"),iconType:"YUQUEURL"}];return(0,n.jsx)(n.Fragment,{children:a.map((e,t)=>(0,n.jsxs)(F.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{l({label:"forward",docType:e.type})},children:[(0,n.jsxs)("div",{className:"font-semibold",children:[(0,n.jsx)(el,{type:e.iconType}),e.title]}),(0,n.jsx)("div",{children:e.subTitle})]},t))})}var ex=l(64082),ep=l(2913),eh=l(91776);let{Dragger:ef}=ep.default,{TextArea:ej}=E.default;function eg(e){let{className:t,handleStepChange:l,spaceName:a,docType:s}=e,{t:r}=(0,z.$G)(),[i]=C.default.useForm(),[o,d]=(0,M.useState)(!1),[u,m]=(0,M.useState)([]),x=async e=>{let t;let{docName:n,textSource:r,text:i,webPageUrl:o,doc_token:m,questions:x=[],originFileObj:p}=e;switch(d(!0),s){case"URL":[,t]=await (0,c.Vx)((0,c.H_)(a,{doc_name:n,content:o,doc_type:"URL",questions:null==x?void 0:x.map(e=>e.question)}));break;case"TEXT":[,t]=await (0,c.Vx)((0,c.H_)(a,{doc_name:n,source:r,content:i,doc_type:"TEXT",questions:x.map(e=>e.question)}));break;case"YUQUEURL":[,t]=await (0,c.Vx)((0,c.TT)({doc_name:n,space_name:a,content:o,doc_type:"YUQUEURL",doc_token:m||"",questions:null==x?void 0:x.map(e=>e.question)}))}return(d(!1),"DOCUMENT"===s&&u.length<1)?w.ZP.error("Upload failed, please re-upload."):"DOCUMENT"===s||t?void l({label:"forward",files:"DOCUMENT"===s?u:[{name:n,doc_id:t||-1}]}):w.ZP.error("Upload failed, please re-upload.")},p=e=>{let{file:t,fileList:l}=e;0===l.length&&i.setFieldValue("originFileObj",null)},h=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{label:"".concat(r("Name"),":"),name:"docName",rules:[{required:!0,message:r("Please_input_the_name")}],children:(0,n.jsx)(E.default,{className:"mb-5 h-12",placeholder:r("Please_input_the_name")})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:r("Please_input_the_text_source")}],children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_text_source")})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Text"),":"),name:"text",rules:[{required:!0,message:r("Please_input_the_description")}],children:(0,n.jsx)(ej,{rows:4})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Correlation_problem"),":"),children:(0,n.jsx)(C.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>{let{key:l,name:s}=e;return(0,n.jsxs)("div",{className:A()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(C.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,n.jsx)(E.default,{placeholder:r("input_question")})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(b.Z,{onClick:()=>{a(s)}})})]},l)}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(j.Z,{}),children:r("Add_problem")})})]})}})})]}),f=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{label:"".concat(r("Name"),":"),name:"docName",rules:[{required:!0,message:r("Please_input_the_name")}],children:(0,n.jsx)(E.default,{className:"mb-5 h-12",placeholder:r("Please_input_the_name")})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:r("Please_input_the_Web_Page_URL")}],children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:r("Please_input_the_Web_Page_URL")})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Correlation_problem"),":"),children:(0,n.jsx)(C.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>{let{key:l,name:s}=e;return(0,n.jsxs)("div",{className:A()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(C.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,n.jsx)(E.default,{placeholder:r("input_question")})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(b.Z,{onClick:()=>{a(s)}})})]},l)}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(j.Z,{}),children:r("Add_problem")})})]})}})})]}),g=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{label:"".concat(r("Name"),":"),name:"docName",rules:[{required:!0,message:r("Please_input_the_name")}],children:(0,n.jsx)(E.default,{className:"mb-5 h-12",placeholder:r("Please_input_the_name")})}),(0,n.jsx)(C.default.Item,{label:r("document_url"),name:"webPageUrl",rules:[{required:!0,message:r("input_document_url")}],children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:r("input_document_url")})}),(0,n.jsx)(C.default.Item,{label:r("document_token"),name:"doc_token",tooltip:(0,n.jsxs)(n.Fragment,{children:[r("Get_token"),(0,n.jsx)(eh.Z.Link,{href:"https://yuque.antfin-inc.com/lark/openapi/dh8zp4",target:"_blank",children:r("Reference_link")})]}),children:(0,n.jsx)(E.default,{className:"mb-5  h-12",placeholder:r("input_document_token")})}),(0,n.jsx)(C.default.Item,{label:"".concat(r("Correlation_problem"),":"),children:(0,n.jsx)(C.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>{let{key:l,name:s}=e;return(0,n.jsxs)("div",{className:A()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(C.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,n.jsx)(E.default,{placeholder:r("input_question")})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(b.Z,{onClick:()=>{a(s)}})})]},l)}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(j.Z,{}),children:r("Add_problem")})})]})}})})]}),_=async e=>{let{onSuccess:t,onError:l,file:n}=e,s=new FormData,r=null==n?void 0:n.name;s.append("doc_name",r),s.append("doc_file",n),s.append("doc_type","DOCUMENT");let[,i]=await (0,c.Vx)((0,c.iG)(a,s));Number.isInteger(i)?(t&&t(i||0),m(e=>(e.push({name:r,doc_id:i||-1}),e))):l&&l({name:"",message:""})},v=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{name:"originFileObj",rules:[{required:!0,message:r("Please_select_file")}],children:(0,n.jsxs)(ef,{multiple:!0,onChange:p,maxCount:100,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md,.zip,.csv",customRequest:_,children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(ex.Z,{})}),(0,n.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:r("Select_or_Drop_file")}),(0,n.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown, Zip1, Csv"})]})}),(0,n.jsx)(C.default.Item,{label:"关联问题:",children:(0,n.jsx)(C.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>{let{key:l,name:s}=e;return(0,n.jsxs)("div",{className:A()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(C.default.Item,{label:"",name:[s,"question"],className:"grow",children:(0,n.jsx)(E.default,{placeholder:"请输入问题"})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(b.Z,{onClick:()=>{a(s)}})})]},l)}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(j.Z,{}),children:r("Add_problem")})})]})}})})]});return(0,n.jsx)(k.Z,{spinning:o,children:(0,n.jsxs)(C.default,{form:i,size:"large",className:A()("mt-4",t),layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:x,children:[(()=>{switch(s){case"URL":return f();case"DOCUMENT":return v();case"YUQUEURL":return g();default:return h()}})(),(0,n.jsxs)(C.default.Item,{children:[(0,n.jsx)(T.ZP,{onClick:()=>{l({label:"back"})},className:"mr-4",children:"".concat(r("Back"))}),(0,n.jsx)(T.ZP,{type:"primary",loading:o,htmlType:"submit",children:r("Next")})]})]})})}var e_=l(13109),ev=l(47221),eb=l(16165),ey=l(84567),eN=l(78045);let{TextArea:ew}=E.default;function ek(e){let{strategies:t,docType:l,fileName:a,field:s}=e,[r,i]=(0,M.useState)(),c="";if("DOCUMENT"===l){let e=a.split(".");c=e[e.length-1]}let o=c?t.filter(e=>e.suffix.indexOf(c)>-1):t,{t:d}=(0,z.$G)(),u={strategy:"Automatic",name:d("Automatic"),desc:d("Automatic_desc")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.default.Item,{name:[s.name,"chunk_parameters","chunk_strategy"],initialValue:u.strategy,children:(0,n.jsxs)(eN.ZP.Group,{style:{marginTop:16},onChange:function(e){i(e.target.value)},children:[(0,n.jsx)(eN.ZP,{value:u.strategy,children:u.name}),o.map(e=>(0,n.jsx)(eN.ZP,{value:e.strategy,children:e.name},"strategy_radio_".concat(e.strategy)))]})}),function(){var e;if(!r)return null;if(r===u.name)return(0,n.jsx)("p",{className:"my-4",children:u.desc});let t=null===(e=null==o?void 0:o.filter(e=>e.strategy===r)[0])||void 0===e?void 0:e.parameters;return t&&t.length?(0,n.jsx)("div",{className:"mt-2",children:null==t?void 0:t.map(e=>(0,n.jsx)(C.default.Item,{label:e.param_name,name:[s.name,"chunk_parameters",e.param_name],rules:[{required:!0,message:d("Please_input_the_name")}],initialValue:e.default_value,valuePropName:"boolean"===e.param_type?"checked":"value",tooltip:e.description,children:function(e){switch(e){case"int":return(0,n.jsx)(er.Z,{className:"w-full",min:1});case"string":return(0,n.jsx)(ew,{className:"w-full",rows:2});case"boolean":return(0,n.jsx)(ey.Z,{})}}(e.param_type)},"param_".concat(e.param_name)))}):(0,n.jsx)(e_.Z,{className:"my-2",type:"warning",message:d("No_parameter")})}()]})}var eZ=l(82353);function eC(e){let{spaceName:t,docType:l,uploadFiles:s,handleStepChange:r}=e;console.log(l,"doctype");let{t:i}=(0,z.$G)(),[o]=C.default.useForm(),[d,u]=(0,M.useState)(s),[m,x]=(0,M.useState)(),[p,h]=(0,M.useState)([]),[f,j]=(0,M.useState)("");async function g(){var e;x(!0);let[,t]=await (0,c.Vx)((0,c.iZ)());x(!1),h(null===(e=t||[])||void 0===e?void 0:e.filter(e=>e.type.indexOf(l)>-1))}localStorage.getItem("cur_space_id"),(0,M.useEffect)(()=>(g(),()=>{a&&clearInterval(a)}),[]);let _=async e=>{if(function(e){let t=!0;"RUNNING"===f&&(t=!1,w.ZP.warning("The task is still running, do not submit it again."));let{fileStrategies:l}=e;return l.map(e=>{var l,a;let n=null==e?void 0:null===(l=e.chunk_parameters)||void 0===l?void 0:l.chunk_strategy;n||(w.ZP.error("Please select chunk strategy for ".concat(e.name,".")),t=!1);let s=p.filter(e=>e.strategy===n)[0],r={chunk_strategy:null==e?void 0:null===(a=e.chunk_parameters)||void 0===a?void 0:a.chunk_strategy};s&&s.parameters&&s.parameters.forEach(t=>{let l=t.param_name;r[l]=(null==e?void 0:e.chunk_parameters)[l]}),e.chunk_parameters=r}),t}(e)){var l;x(!0);let[,n]=await (0,c.Vx)((0,c.KL)(t,e.fileStrategies));if(x(!1),(null==n?void 0:n.tasks)&&(null==n?void 0:null===(l=n.tasks)||void 0===l?void 0:l.length)>0){w.ZP.success("Segemation task start successfully. task id: ".concat(null==n?void 0:n.tasks.join(","))),j("RUNNING");let t=e.fileStrategies.map(e=>e.doc_id);a=setInterval(async()=>{let e=await v(t);"FINISHED"===e?(clearInterval(a),j("FINISHED"),w.ZP.success("Congratulation, All files sync successfully."),r({label:"finish"})):"FAILED"===e&&(clearInterval(a),r({label:"finish"}))},3e3)}}};async function v(e){let[,l]=await (0,c.Vx)((0,c._Q)(t,{doc_ids:e}));if((null==l?void 0:l.data)&&(null==l?void 0:l.data.length)>0){let e=[...d];if(null==l||l.data.map(t=>{var l;let a=null===(l=null==e?void 0:e.filter(e=>e.doc_id===t.id))||void 0===l?void 0:l[0];a&&(a.status=t.status)}),u(e),null==l?void 0:l.data.every(e=>"FINISHED"===e.status||"FAILED"===e.status))return"FINISHED"}}return(0,n.jsx)(k.Z,{spinning:m,children:(0,n.jsxs)(C.default,{labelCol:{span:6},wrapperCol:{span:18},labelAlign:"right",form:o,size:"large",className:"mt-4",layout:"horizontal",name:"basic",autoComplete:"off",initialValues:{fileStrategies:d},onFinish:_,children:[p&&p.length?(0,n.jsx)(C.default.List,{name:"fileStrategies",children:e=>{switch(l){case"TEXT":case"URL":case"YUQUEURL":return null==e?void 0:e.map(e=>(0,n.jsx)(ek,{strategies:p,docType:l,fileName:d[e.name].name,field:e},e.key));case"DOCUMENT":return(0,n.jsx)(ev.Z,{defaultActiveKey:0,size:d.length>5?"small":"middle",children:null==e?void 0:e.map(e=>(0,n.jsx)(ev.Z.Panel,{header:"".concat(e.name+1,". ").concat(d[e.name].name),extra:function(e){let t=d[e].status;switch(t){case"FINISHED":return(0,n.jsx)(eb.Z,{component:eZ.qw});case"RUNNING":return(0,n.jsx)(eb.Z,{className:"animate-spin animate-infinite",component:eZ.bn});case"FAILED":return(0,n.jsx)(eb.Z,{component:eZ.FE});default:return(0,n.jsx)(eb.Z,{component:eZ.tu})}}(e.name),children:(0,n.jsx)(ek,{strategies:p,docType:l,fileName:d[e.name].name,field:e})},e.key))})}}}):(0,n.jsx)(e_.Z,{message:"Cannot find one strategy for ".concat(l," type knowledge."),type:"warning"}),(0,n.jsxs)(C.default.Item,{className:"mt-4",children:[(0,n.jsx)(T.ZP,{onClick:()=>{r({label:"back"})},className:"mr-4",children:"".concat(i("Back"))}),(0,n.jsx)(T.ZP,{type:"primary",htmlType:"submit",loading:m||"RUNNING"===f,children:i("Process")})]})]})})}function eS(e){var t;let{t:l}=(0,z.$G)(),{handleStepChange:a,spaceConfig:s}=e,[r,i]=(0,M.useState)(!1),[o,d]=(0,M.useState)(),[u]=C.default.useForm();(0,M.useEffect)(()=>{u.setFieldValue("storage",null==s?void 0:s[0].name),d(null==s?void 0:s[0].name)},[s]);let m=async e=>{let{spaceName:t,owner:l,description:n,storage:s,field:r}=e;i(!0);let[o,d,u]=await (0,c.Vx)((0,c.be)({name:t,vector_type:s,owner:l,desc:n,domain_type:r}));i(!1);let m="FinancialReport"===r;localStorage.setItem("cur_space_id",JSON.stringify(d)),(null==u?void 0:u.success)&&a({label:"forward",spaceName:t,pace:m?2:1,docType:m?"DOCUMENT":""})};return(0,n.jsx)(k.Z,{spinning:r,children:(0,n.jsxs)(C.default,{form:u,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:m,children:[(0,n.jsx)(C.default.Item,{label:l("Knowledge_Space_Name"),name:"spaceName",rules:[{required:!0,message:l("Please_input_the_name")},()=>({validator:(e,t)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(t)?Promise.reject(Error(l("the_name_can_only_contain"))):Promise.resolve()})],children:(0,n.jsx)(E.default,{className:"h-12",placeholder:l("Please_input_the_name")})}),(0,n.jsx)(C.default.Item,{label:l("Storage"),name:"storage",rules:[{required:!0,message:l("Please_select_the_storage")}],children:(0,n.jsx)(ei.default,{className:"mb-5 h-12",placeholder:l("Please_select_the_storage"),onChange:e=>{d(e)},children:null==s?void 0:s.map(e=>(0,n.jsx)(ei.default.Option,{value:e.name,children:e.desc}))})}),(0,n.jsx)(C.default.Item,{label:l("Domain"),name:"field",rules:[{required:!0,message:l("Please_select_the_domain_type")}],children:(0,n.jsx)(ei.default,{className:"mb-5 h-12",placeholder:l("Please_select_the_domain_type"),children:null===(t=null==s?void 0:s.find(e=>e.name===o))||void 0===t?void 0:t.domain_types.map(e=>(0,n.jsx)(ei.default.Option,{value:e.name,children:e.desc}))})}),(0,n.jsx)(C.default.Item,{label:l("Description"),name:"description",rules:[{required:!0,message:l("Please_input_the_description")}],children:(0,n.jsx)(E.default,{className:"h-12",placeholder:l("Please_input_the_description")})}),(0,n.jsx)(C.default.Item,{children:(0,n.jsx)(T.ZP,{type:"primary",htmlType:"submit",children:l("Next")})})]})})}var eI=l(14079),eP=l(42119),eT=l(96486),eE=()=>{let{setCurrentDialogInfo:e}=(0,M.useContext)(i.p),[t,l]=(0,M.useState)([]),[a,o]=(0,M.useState)(!1),[d,x]=(0,M.useState)(!1),[p,h]=(0,M.useState)(),[f,g]=(0,M.useState)(0),[_,v]=(0,M.useState)(""),[b,y]=(0,M.useState)([]),[w,Z]=(0,M.useState)(""),[C,S]=(0,M.useState)(""),[P,F]=(0,M.useState)(!1),[q,U]=(0,M.useState)(null),{t:R}=(0,z.$G)(),D=[{title:R("Knowledge_Space_Config")},{title:R("Choose_a_Datasource_type")},{title:R("Upload")},{title:R("Segmentation")}],O=(0,L.useRouter)();async function G(e){F(!0);let[t,a]=await (0,c.Vx)((0,c.Vm)({...e}));F(!1),l(a)}async function H(){let[e,t]=await (0,c.Vx)((0,c.mB)());if(!t)return null;U(t.storage)}(0,M.useEffect)(()=>{G(),H()},[]);let Y=async t=>{let[l,a]=await (0,c.Vx)((0,c.sW)({chat_mode:"chat_knowledge"}));(null==a?void 0:a.conv_uid)&&(null==e||e({chat_scene:a.chat_mode,app_code:a.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:a.chat_mode})),O.push("/chat?scene=chat_knowledge&id=".concat(null==a?void 0:a.conv_uid,"&knowledge_id=").concat(t.name)))},$=e=>{let{label:t,spaceName:l,docType:a,files:n}=e;"finish"===t?(o(!1),G(),v(""),Z(""),S("finish"),localStorage.removeItem("cur_space_id")):"forward"===t?(0===f&&G(),g(e=>e+1)):g(e=>e-1),n&&y(n),l&&v(l),a&&Z(a)},B=e=>{N.default.confirm({title:R("Tips"),icon:(0,n.jsx)(u.Z,{}),content:"".concat(R("Del_Knowledge_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await (0,c.Vx)((0,c.XK)({name:null==e?void 0:e.name})),G()}})},J=async e=>{G({name:e.target.value})};return(0,n.jsx)(r.Z,{children:(0,n.jsxs)(k.Z,{spinning:P,children:[(0,n.jsxs)("div",{className:"page-body p-4 md:p-6 h-[90vh] overflow-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(E.default,{variant:"filled",prefix:(0,n.jsx)(m.Z,{}),placeholder:R("please_enter_the_keywords"),onChange:(0,eT.debounce)(J,300),allowClear:!0,className:"w-[230px] h-[40px] border-1 border-white backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60"})}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(T.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{o(!0)},children:R("create_knowledge")})})]}),(0,n.jsx)("div",{className:"flex flex-wrap mt-4 mx-[-8px]",children:null==t?void 0:t.map(e=>(0,n.jsx)(s.ZP,{onClick:()=>{h(e),x(!0),localStorage.setItem("cur_space_id",JSON.stringify(e.id))},description:e.desc,name:e.name,logo:"FinancialReport"===e.domain_type?"/models/fin_report.jpg":"KnowledgeGraph"===e.vector_type?"/models/knowledge-graph.png":"FullText"===e.vector_type?"/models/knowledge-full-text.jpg":"/models/knowledge-default.jpg",RightTop:(0,n.jsx)(s.ZS,{menu:{items:[{key:"del",label:(0,n.jsx)("span",{className:"text-red-400",onClick:()=>B(e),children:R("Delete")})}]}}),rightTopHover:!1,Tags:(0,n.jsxs)("div",{className:"flex item-center",children:[(0,n.jsx)(I.Z,{children:(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(eI.Z,{className:"mt-[1px]"}),e.docs]})}),(0,n.jsx)(I.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.domain_type||"Normal"})}),e.vector_type?(0,n.jsx)(I.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.vector_type})}):null]}),LeftBottom:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("span",{children:e.owner}),(0,n.jsx)("span",{children:"•"}),(null==e?void 0:e.gmt_modified)&&(0,n.jsx)("span",{children:V()(null==e?void 0:e.gmt_modified).fromNow()+" "+R("update")})]}),RightBottom:(0,n.jsx)(s.TH,{text:R("start_chat"),onClick:()=>{Y(e)}})},e.id))})]}),(0,n.jsx)(N.default,{className:"h-5/6 overflow-hidden",open:d,width:"70%",onCancel:()=>x(!1),footer:null,destroyOnClose:!0,children:(0,n.jsx)(eu,{space:p,onAddDoc:function(e){v(e),g(1),o(!0),S("start")},onDeleteDoc:G,addStatus:C})}),(0,n.jsxs)(N.default,{title:R("New_knowledge_base"),centered:!0,open:a,destroyOnClose:!0,onCancel:()=>{o(!1)},width:1e3,afterClose:()=>{g(0),G()},footer:null,children:[(0,n.jsx)(eP.Z,{current:f,items:D}),0===f&&(0,n.jsx)(eS,{handleStepChange:$,spaceConfig:q}),1===f&&(0,n.jsx)(em,{handleStepChange:$}),(0,n.jsx)(eg,{className:A()({hidden:2!==f}),spaceName:_,docType:w,handleStepChange:$}),3===f&&(0,n.jsx)(eC,{spaceName:_,docType:w,uploadFiles:b,handleStepChange:$})]})]})})}},56397:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(48218),s=l(58638),r=l(31418),i=l(91776),c=l(20640),o=l.n(c),d=l(67294),u=l(73913);t.default=(0,d.memo)(()=>{var e;let{appInfo:t}=(0,d.useContext)(u.MobileChatContext),{message:l}=r.Z.useApp(),[c,m]=(0,d.useState)(0);if(!(null==t?void 0:t.app_code))return null;let x=async()=>{let e=o()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));l[e?"success":"error"](e?"复制成功":"复制失败")};return c>6&&l.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,a.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(c+1),children:[(0,a.jsx)(n.Z,{scene:(null==t?void 0:null===(e=t.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,a.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,a.jsx)(i.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==t?void 0:t.app_name}),(0,a.jsx)(i.Z.Text,{className:"text-sm line-clamp-2",children:null==t?void 0:t.app_describe})]})]}),(0,a.jsx)("div",{onClick:x,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,a.jsx)(s.Z,{className:"text-lg"})})]})})},74638:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(76212),s=l(62418),r=l(25519),i=l(30159),c=l(87740),o=l(79090),d=l(52645),u=l(27496),m=l(1375),x=l(65654),p=l(66309),h=l(55241),f=l(74330),j=l(55102),g=l(14726),_=l(93967),v=l.n(_),b=l(39332),y=l(67294),N=l(73913),w=l(7001),k=l(73749),Z=l(97109),C=l(83454);let S=["magenta","orange","geekblue","purple","cyan","green"];t.default=()=>{var e,t;let l=(0,b.useSearchParams)(),_=null!==(t=null==l?void 0:l.get("ques"))&&void 0!==t?t:"",{history:I,model:P,scene:T,temperature:E,resource:F,conv_uid:q,appInfo:U,scrollViewRef:R,order:D,userInput:A,ctrl:O,canAbort:V,canNewChat:L,setHistory:M,setCanNewChat:z,setCarAbort:G,setUserInput:H}=(0,y.useContext)(N.MobileChatContext),[Y,$]=(0,y.useState)(!1),[B,J]=(0,y.useState)(!1),K=async e=>{var t,l,a;H(""),O.current=new AbortController;let n={chat_mode:T,model_name:P,user_input:e||A,conv_uid:q,temperature:E,app_code:null==U?void 0:U.app_code,...F&&{select_param:JSON.stringify(F)}};if(I&&I.length>0){let e=null==I?void 0:I.filter(e=>"view"===e.role);D.current=e[e.length-1].order+1}let i=[{role:"human",context:e||A,model_name:P,order:D.current,time_stamp:0},{role:"view",context:"",model_name:P,order:D.current,time_stamp:0,thinking:!0}],c=i.length-1;M([...I,...i]),z(!1);try{await (0,m.L)("".concat(null!==(t=C.env.API_BASE_URL)&&void 0!==t?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[r.gp]:null!==(l=(0,s.n5)())&&void 0!==l?l:""},signal:O.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=O.current)||void 0===e||e.abort(),z(!0),G(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(z(!0),G(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(i[c].context=null==t?void 0:t.replace("[ERROR]",""),i[c].thinking=!1,M([...I,...i]),z(!0),G(!1)):(G(!0),i[c].context=t,i[c].thinking=!1,M([...I,...i]))}})}catch(e){null===(a=O.current)||void 0===a||a.abort(),i[c].context="Sorry, we meet some error, please try again later.",i[c].thinking=!1,M([...i]),z(!0),G(!1)}},W=async()=>{A.trim()&&L&&await K()};(0,y.useEffect)(()=>{var e,t;null===(e=R.current)||void 0===e||e.scrollTo({top:null===(t=R.current)||void 0===t?void 0:t.scrollHeight,behavior:"auto"})},[I,R]);let Q=(0,y.useMemo)(()=>{if(!U)return[];let{param_need:e=[]}=U;return null==e?void 0:e.map(e=>e.type)},[U]),X=(0,y.useMemo)(()=>{var e;return 0===I.length&&U&&!!(null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.length)},[I,U]),{run:ee,loading:et}=(0,x.Z)(async()=>await (0,n.Vx)((0,n.zR)(q)),{manual:!0,onSuccess:()=>{M([])}});return(0,y.useEffect)(()=>{_&&P&&q&&U&&K(_)},[U,q,P,_]),(0,a.jsxs)("div",{className:"flex flex-col",children:[X&&(0,a.jsx)("ul",{children:null==U?void 0:null===(e=U.recommend_questions)||void 0===e?void 0:e.map((e,t)=>(0,a.jsx)("li",{className:"mb-3",children:(0,a.jsx)(p.Z,{color:S[t],className:"p-2 rounded-xl",onClick:async()=>{K(e.question)},children:e.question})},e.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,a.jsx)(w.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,a.jsx)(k.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,a.jsx)(Z.default,{})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,a.jsx)(h.Z,{content:"暂停回复",trigger:["hover"],children:(0,a.jsx)(i.Z,{className:v()("p-2 cursor-pointer",{"text-[#0c75fc]":V,"text-gray-400":!V}),onClick:()=>{var e;V&&(null===(e=O.current)||void 0===e||e.abort(),setTimeout(()=>{G(!1),z(!0)},100))}})}),(0,a.jsx)(h.Z,{content:"再来一次",trigger:["hover"],children:(0,a.jsx)(c.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{var e,t;if(!L||0===I.length)return;let l=null===(e=null===(t=I.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];K((null==l?void 0:l.context)||"")}})}),et?(0,a.jsx)(f.Z,{spinning:et,indicator:(0,a.jsx)(o.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,a.jsx)(h.Z,{content:"清除历史",trigger:["hover"],children:(0,a.jsx)(d.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!I.length||!L}),onClick:()=>{L&&ee()}})})]})]}),(0,a.jsxs)("div",{className:v()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":Y}),children:[(0,a.jsx)(j.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:A,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(B){e.preventDefault();return}A.trim()&&(e.preventDefault(),W())}},onChange:e=>{H(e.target.value)},onFocus:()=>{$(!0)},onBlur:()=>$(!1),onCompositionStartCapture:()=>{J(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{J(!1)},0)}}),(0,a.jsx)(g.ZP,{type:"primary",className:v()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!A.trim()||!L}),onClick:W,children:L?(0,a.jsx)(u.Z,{}):(0,a.jsx)(f.Z,{indicator:(0,a.jsx)(o.Z,{className:"text-white"})})})]})]})}},7001:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(39718),s=l(41468),r=l(41441),i=l(85418),c=l(55241),o=l(67294),d=l(73913);t.default=()=>{let{modelList:e}=(0,o.useContext)(s.p),{model:t,setModel:l}=(0,o.useContext)(d.MobileChatContext),u=(0,o.useMemo)(()=>e.length>0?e.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{l(e)},children:[(0,a.jsx)(n.Z,{width:14,height:14,model:e}),(0,a.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,l]);return(0,a.jsx)(i.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,a.jsx)(c.Z,{content:t,children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(n.Z,{width:16,height:16,model:t}),(0,a.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:t}),(0,a.jsx)(r.Z,{rotate:90})]})})})}},46568:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(25675),s=l.n(n),r=l(67294);t.default=(0,r.memo)(e=>{let{width:t,height:l,src:n,label:r}=e;return(0,a.jsx)(s(),{width:t||14,height:l||14,src:n,alt:r||"db-icon",priority:!0})})},73749:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(76212),s=l(62418),r=l(79090),i=l(41441),c=l(83266),o=l(65654),d=l(74330),u=l(2913),m=l(85418),x=l(67294),p=l(73913),h=l(46568);t.default=()=>{let{appInfo:e,resourceList:t,scene:l,model:f,conv_uid:j,getChatHistoryRun:g,setResource:_,resource:v}=(0,x.useContext)(p.MobileChatContext),[b,y]=(0,x.useState)(null),N=(0,x.useMemo)(()=>{var t,l,a;return null===(t=null==e?void 0:null===(l=e.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(a=t[0])||void 0===a?void 0:a.value},[e]),w=(0,x.useMemo)(()=>t&&t.length>0?t.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{y(e),_(e.space_id||e.param)},children:[(0,a.jsx)(h.default,{width:14,height:14,src:s.S$[e.type].icon,label:s.S$[e.type].label}),(0,a.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[t,_]),{run:k,loading:Z}=(0,o.Z)(async e=>{let[,t]=await (0,n.Vx)((0,n.qn)({convUid:j,chatMode:l,data:e,model:f,config:{timeout:36e5}}));return _(t),t},{manual:!0,onSuccess:async()=>{await g()}}),C=async e=>{let t=new FormData;t.append("doc_file",null==e?void 0:e.file),await k(t)},S=(0,x.useMemo)(()=>Z?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.Z,{size:"small",indicator:(0,a.jsx)(r.Z,{spin:!0})}),(0,a.jsx)("span",{className:"text-xs",children:"上传中"})]}):v?(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("span",{className:"text-xs",children:v.file_name}),(0,a.jsx)(i.Z,{rotate:90})]}):(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"text-base"}),(0,a.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[Z,v]);return(0,a.jsx)(a.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,a.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,a.jsx)(u.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:C,className:"flex h-full w-full items-center justify-center",children:S})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,l,n,r,c;if(!(null==t?void 0:t.length))return null;return(0,a.jsx)(m.Z,{menu:{items:w},placement:"top",trigger:["click"],children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(h.default,{width:14,height:14,src:null===(e=s.S$[(null==b?void 0:b.type)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.type)])||void 0===e?void 0:e.icon,label:null===(n=s.S$[(null==b?void 0:b.type)||(null==t?void 0:null===(r=t[0])||void 0===r?void 0:r.type)])||void 0===n?void 0:n.label}),(0,a.jsx)("span",{className:"text-xs font-medium",children:(null==b?void 0:b.param)||(null==t?void 0:null===(c=t[0])||void 0===c?void 0:c.param)}),(0,a.jsx)(i.Z,{rotate:90})]})})}})()})}},97109:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(85418),s=l(30568),r=l(67294),i=l(73913),c=l(70065);t.default=()=>{let{temperature:e,setTemperature:t}=(0,r.useContext)(i.MobileChatContext),l=e=>{isNaN(e)||t(e)};return(0,a.jsx)(n.Z,{trigger:["click"],dropdownRender:()=>(0,a.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,a.jsx)(s.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:l,value:e})}),placement:"top",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,a.jsx)(c.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},73913:function(e,t,l){"use strict";l.r(t),l.d(t,{MobileChatContext:function(){return v}});var a=l(85893),n=l(41468),s=l(76212),r=l(2440),i=l(62418),c=l(25519),o=l(1375),d=l(65654),u=l(74330),m=l(5152),x=l.n(m),p=l(39332),h=l(67294),f=l(56397),j=l(74638),g=l(83454);let _=x()(()=>Promise.all([l.e(3662),l.e(7034),l.e(4041),l.e(1941),l.e(5872),l.e(4567),l.e(2783),l.e(1531),l.e(2611),l.e(3320),l.e(5265),l.e(7332),l.e(7530),l.e(9397),l.e(6212),l.e(8709),l.e(9256),l.e(9870)]).then(l.bind(l,36818)),{loadableGenerated:{webpack:()=>[36818]},ssr:!1}),v=(0,h.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});t.default=()=>{var e,t;let l=(0,p.useSearchParams)(),m=null!==(e=null==l?void 0:l.get("chat_scene"))&&void 0!==e?e:"",x=null!==(t=null==l?void 0:l.get("app_code"))&&void 0!==t?t:"",{modelList:b}=(0,h.useContext)(n.p),[y,N]=(0,h.useState)([]),[w,k]=(0,h.useState)(""),[Z,C]=(0,h.useState)(.5),[S,I]=(0,h.useState)(null),P=(0,h.useRef)(null),[T,E]=(0,h.useState)(""),[F,q]=(0,h.useState)(!1),[U,R]=(0,h.useState)(!0),D=(0,h.useRef)(),A=(0,h.useRef)(1),O=(0,r.Z)(),V=(0,h.useMemo)(()=>"".concat(null==O?void 0:O.user_no,"_").concat(x),[x,O]),{run:L,loading:M}=(0,d.Z)(async()=>await (0,s.Vx)((0,s.$i)("".concat(null==O?void 0:O.user_no,"_").concat(x))),{manual:!0,onSuccess:e=>{let[,t]=e,l=null==t?void 0:t.filter(e=>"view"===e.role);l&&l.length>0&&(A.current=l[l.length-1].order+1),N(t||[])}}),{data:z,run:G,loading:H}=(0,d.Z)(async e=>{let[,t]=await (0,s.Vx)((0,s.BN)(e));return null!=t?t:{}},{manual:!0}),{run:Y,data:$,loading:B}=(0,d.Z)(async()=>{var e,t;let[,l]=await (0,s.Vx)((0,s.vD)(m));return I((null==l?void 0:null===(e=l[0])||void 0===e?void 0:e.space_id)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.param)),null!=l?l:[]},{manual:!0}),{run:J,loading:K}=(0,d.Z)(async()=>{let[,e]=await (0,s.Vx)((0,s.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var t;let l=null===(t=null==e?void 0:e.filter(e=>e.conv_uid===V))||void 0===t?void 0:t[0];(null==l?void 0:l.select_param)&&I(JSON.parse(null==l?void 0:l.select_param))}});(0,h.useEffect)(()=>{m&&x&&b.length&&G({chat_scene:m,app_code:x})},[x,m,G,b]),(0,h.useEffect)(()=>{x&&L()},[x]),(0,h.useEffect)(()=>{if(b.length>0){var e,t,l;let a=null===(e=null==z?void 0:null===(t=z.param_need)||void 0===t?void 0:t.filter(e=>"model"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;k(a||b[0])}},[b,z]),(0,h.useEffect)(()=>{var e,t,l;let a=null===(e=null==z?void 0:null===(t=z.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;C(a||.5)},[z]),(0,h.useEffect)(()=>{if(m&&(null==z?void 0:z.app_code)){var e,t,l,a,n,s;let r=null===(e=null==z?void 0:null===(t=z.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value,i=null===(a=null==z?void 0:null===(n=z.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.bind_value;i&&I(i),["database","knowledge","plugin","awel_flow"].includes(r)&&!i&&Y()}},[z,m,Y]);let W=async e=>{var t,l,a;E(""),D.current=new AbortController;let n={chat_mode:m,model_name:w,user_input:e||T,conv_uid:V,temperature:Z,app_code:null==z?void 0:z.app_code,...S&&{select_param:S}};if(y&&y.length>0){let e=null==y?void 0:y.filter(e=>"view"===e.role);A.current=e[e.length-1].order+1}let s=[{role:"human",context:e||T,model_name:w,order:A.current,time_stamp:0},{role:"view",context:"",model_name:w,order:A.current,time_stamp:0,thinking:!0}],r=s.length-1;N([...y,...s]),R(!1);try{await (0,o.L)("".concat(null!==(t=g.env.API_BASE_URL)&&void 0!==t?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[c.gp]:null!==(l=(0,i.n5)())&&void 0!==l?l:""},signal:D.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===o.a)return},onclose(){var e;null===(e=D.current)||void 0===e||e.abort(),R(!0),q(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(R(!0),q(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(s[r].context=null==t?void 0:t.replace("[ERROR]",""),s[r].thinking=!1,N([...y,...s]),R(!0),q(!1)):(q(!0),s[r].context=t,s[r].thinking=!1,N([...y,...s]))}})}catch(e){null===(a=D.current)||void 0===a||a.abort(),s[r].context="Sorry, we meet some error, please try again later.",s[r].thinking=!1,N([...s]),R(!0),q(!1)}};return(0,h.useEffect)(()=>{m&&"chat_agent"!==m&&J()},[m,J]),(0,a.jsx)(v.Provider,{value:{model:w,resource:S,setModel:k,setTemperature:C,setResource:I,temperature:Z,appInfo:z,conv_uid:V,scene:m,history:y,scrollViewRef:P,setHistory:N,resourceList:$,order:A,handleChat:W,setCanNewChat:R,ctrl:D,canAbort:F,setCarAbort:q,canNewChat:U,userInput:T,setUserInput:E,getChatHistoryRun:L},children:(0,a.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:M||H||B||K,children:(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,a.jsxs)("div",{ref:P,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,a.jsx)(f.default,{}),(0,a.jsx)(_,{})]}),(null==z?void 0:z.app_code)&&(0,a.jsx)(j.default,{})]})})})}},53878:function(){}},function(e){e.O(0,[3662,7034,2648,3791,4296,5102,3293,4330,1776,5418,4041,8232,1941,2913,2378,5872,4567,6231,2783,1531,2611,3320,5265,7332,7530,9397,6212,8237,118,8709,9256,9774,2888,179],function(){return e(e.s=45629)}),_N_E=e.O()}]);