(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4554,3913],{45629:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/knowledge",function(){return l(14545)}])},2440:function(e,t,l){"use strict";var a=l(25519);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}},39718:function(e,t,l){"use strict";var a=l(85893),n=l(19284),s=l(25675),r=l.n(s),i=l(67294);t.Z=(0,i.memo)(e=>{let{width:t,height:l,model:s}=e,c=(0,i.useMemo)(()=>{let e=null==s?void 0:s.replaceAll("-","_").split("_")[0],t=Object.keys(n.Me);for(let l=0;l<t.length;l++){let a=t[l];if(null==e?void 0:e.includes(a))return n.Me[a]}return"/models/huggingface.svg"},[s]);return s?(0,a.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:l||24,src:c,alt:"llm",priority:!0}):null})},48218:function(e,t,l){"use strict";var a=l(85893),n=l(82353),s=l(16165),r=l(67294);t.Z=e=>{let{width:t,height:l,scene:i}=e,c=(0,r.useCallback)(()=>{switch(i){case"chat_knowledge":return n.je;case"chat_with_db_execute":return n.zM;case"chat_excel":return n.DL;case"chat_with_db_qa":case"chat_dba":return n.RD;case"chat_dashboard":return n.In;case"chat_agent":return n.si;case"chat_normal":return n.O7;default:return}},[i]);return(0,a.jsx)(s.Z,{className:"w-".concat(t||7," h-").concat(l||7),component:c()})}},70065:function(e,t,l){"use strict";var a=l(91321);let n=(0,a.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});t.Z=n},1771:function(e,t,l){"use strict";var a=l(85893),n=l(82353),s=l(41156),r=l(9641),i=l(16165),c=l(9020),o=l(92962),d=l(38545),u=l(50067),m=l(28459),x=l(92398),h=l(36609),p=l(11163);l(67294),l(30764),t.Z=function(e){let{children:t}=e,l=[{key:"app",name:(0,h.t)("App"),path:"/app",icon:(0,a.jsx)(s.Z,{})},{key:"flow",name:(0,h.t)("awel_flow"),icon:(0,a.jsx)(r.Z,{}),path:"/flow"},{key:"models",name:(0,h.t)("model_manage"),path:"/models",icon:(0,a.jsx)(i.Z,{component:n.IN})},{key:"database",name:(0,h.t)("Database"),icon:(0,a.jsx)(c.Z,{}),path:"/database"},{key:"knowledge",name:(0,h.t)("Knowledge_Space"),icon:(0,a.jsx)(o.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,h.t)("Prompt"),icon:(0,a.jsx)(d.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,h.t)("dbgpts_community"),path:"/dbgpts",icon:(0,a.jsx)(u.Z,{})}],f=(0,p.useRouter)(),j=f.pathname.split("/")[2];return(0,a.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,a.jsx)(m.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,a.jsx)(x.Z,{activeKey:j,items:l.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{f.push("/construct/".concat(e))}})})})}},14545:function(e,t,l){"use strict";let a;l.r(t),l.d(t,{default:function(){return eP}});var n=l(85893),s=l(41468),r=l(76212),i=l(50888),c=l(98165),o=l(28058),d=l(68795),u=l(99611),m=l(86548),x=l(48689),h=l(89705),p=l(24969),f=l(18754),j=l(13179),g=l(90725),_=l(3089),v=l(65654),b=l(85576),y=l(45360),N=l(74330),w=l(42075),k=l(99859),Z=l(83062),C=l(66309),S=l(14726),I=l(25278),T=l(4393),P=l(85418),E=l(32983),F=l(96074),q=l(93967),U=l.n(q),R=l(30381),D=l.n(R),O=l(11163),A=l(67294),V=l(67421),L=l(18102),M=l(42952),z=l(55241),G=l(13457),H=l(34041),Y=e=>{let{open:t,setOpen:l,space:a}=e,[s]=k.default.useForm(),[i]=k.default.useForm(),{run:c}=(0,v.Z)(async()=>{let[,e]=await (0,r.Vx)((0,r.Pg)(a.name+""));return null!=e?e:[]},{manual:!0}),{data:o=[],run:d}=(0,v.Z)(async()=>{let[,e]=await (0,r.Vx)((0,r.UO)(a.name+""));return null!=e?e:[]},{manual:!0,onSuccess:e=>{i.setFieldValue("recall_retrievers",e)}});(0,A.useEffect)(()=>{t&&d()},[t,d,c]);let{run:u,data:m=[],loading:x}=(0,v.Z)(async e=>{let[,t]=await (0,r.Vx)((0,r.Y2)({...e},a.name+""));return null!=t?t:[]},{manual:!0}),h=async()=>{s.validateFields().then(async e=>{let t=i.getFieldsValue();await u({recall_top_k:1,recall_retrievers:o,...e,...t})})};return(0,n.jsxs)(b.default,{title:"召回测试",width:"60%",open:t,footer:!1,onCancel:()=>l(!1),centered:!0,destroyOnClose:!0,children:[(0,n.jsx)(T.Z,{title:"召回配置",size:"small",className:"my-4",extra:(0,n.jsx)(z.Z,{placement:"bottomRight",trigger:"hover",title:"向量检索设置",content:(0,n.jsxs)(k.default,{form:i,initialValues:{recall_top_k:1},children:[(0,n.jsx)(k.default.Item,{label:"Topk",tooltip:"基于相似度得分的前 k 个向量",name:"recall_top_k",children:(0,n.jsx)(G.Z,{placeholder:"请输入",className:"w-full"})}),(0,n.jsx)(k.default.Item,{label:"召回方法",name:"recall_retrievers",children:(0,n.jsx)(H.default,{mode:"multiple",options:o.map(e=>({label:e,value:e})),className:"w-full",allowClear:!0,disabled:!0})}),(0,n.jsx)(k.default.Item,{label:"score阈值",name:"recall_score_threshold",children:(0,n.jsx)(G.Z,{placeholder:"请输入",className:"w-full",step:.1})})]}),children:(0,n.jsx)(M.Z,{className:"text-lg"})}),children:(0,n.jsx)(k.default,{form:s,layout:"vertical",onFinish:h,children:(0,n.jsx)(k.default.Item,{label:"测试问题",required:!0,name:"question",rules:[{required:!0,message:"请输入测试问题"}],className:"m-0 p-0",children:(0,n.jsxs)("div",{className:"flex w-full items-center gap-8",children:[(0,n.jsx)(I.default,{placeholder:"请输入测试问题",autoComplete:"off",allowClear:!0,className:"w-1/2"}),(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",children:"测试"})]})})})}),(0,n.jsx)(T.Z,{title:"召回结果",size:"small",children:(0,n.jsx)(N.Z,{spinning:x,children:m.length>0?(0,n.jsx)("div",{className:"flex flex-col overflow-y-auto",style:{height:"45vh"},children:m.map(e=>(0,n.jsx)(T.Z,{title:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)(C.Z,{color:"blue",children:["# ",e.chunk_id]}),e.metadata.source]}),extra:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-semibold",children:"score:"}),(0,n.jsx)("span",{className:"text-blue-500",children:e.score})]}),size:"small",className:"mb-4 border-gray-500 shadow-md",children:(0,n.jsx)(L.default,{children:e.content})},e.chunk_id))}):(0,n.jsx)(E.Z,{})})})]})},$=l(71230),J=l(15746),K=l(92398),W=l(31545),B=l(6321),Q=l(90389);let{TextArea:X}=I.default;function ee(e){let{space:t,argumentsShow:l,setArgumentsShow:a}=e,{t:s}=(0,V.$G)(),[i,c]=(0,A.useState)(),[o,d]=(0,A.useState)(!1),u=async()=>{let[e,l]=await (0,r.Vx)((0,r.Tu)(t.name));c(l)};(0,A.useEffect)(()=>{u()},[t.name]);let m=[{key:"Embedding",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(W.Z,{}),s("Embedding")]}),children:(0,n.jsxs)($.Z,{gutter:24,children:[(0,n.jsx)(J.Z,{span:12,offset:0,children:(0,n.jsx)(k.default.Item,{tooltip:s("the_top_k_vectors"),rules:[{required:!0}],label:s("topk"),name:["embedding","topk"],children:(0,n.jsx)(I.default,{className:"mb-5 h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(k.default.Item,{tooltip:s("Set_a_threshold_score"),rules:[{required:!0}],label:s("recall_score"),name:["embedding","recall_score"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:"请输入"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(k.default.Item,{tooltip:s("recall_type"),rules:[{required:!0}],label:s("recall_type"),name:["embedding","recall_type"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(k.default.Item,{tooltip:s("A_model_used"),rules:[{required:!0}],label:s("model"),name:["embedding","model"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(k.default.Item,{tooltip:s("The_size_of_the_data_chunks"),rules:[{required:!0}],label:s("chunk_size"),name:["embedding","chunk_size"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12"})})}),(0,n.jsx)(J.Z,{span:12,children:(0,n.jsx)(k.default.Item,{tooltip:s("The_amount_of_overlap"),rules:[{required:!0}],label:s("chunk_overlap"),name:["embedding","chunk_overlap"],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:s("Please_input_the_description")})})})]})},{key:"Prompt",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(B.Z,{}),s("Prompt")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{tooltip:s("A_contextual_parameter"),label:s("scene"),name:["prompt","scene"],children:(0,n.jsx)(X,{rows:4,className:"mb-2"})}),(0,n.jsx)(k.default.Item,{tooltip:s("structure_or_format"),label:s("template"),name:["prompt","template"],children:(0,n.jsx)(X,{rows:7,className:"mb-2"})}),(0,n.jsx)(k.default.Item,{tooltip:s("The_maximum_number_of_tokens"),label:s("max_token"),name:["prompt","max_token"],children:(0,n.jsx)(I.default,{className:"mb-2"})})]})},{key:"Summary",label:(0,n.jsxs)("div",{children:[(0,n.jsx)(Q.Z,{}),s("Summary")]}),children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{rules:[{required:!0}],label:s("max_iteration"),name:["summary","max_iteration"],children:(0,n.jsx)(I.default,{className:"mb-2"})}),(0,n.jsx)(k.default.Item,{rules:[{required:!0}],label:s("concurrency_limit"),name:["summary","concurrency_limit"],children:(0,n.jsx)(I.default,{className:"mb-2"})})]})}],x=async e=>{d(!0);let[,,l]=await (0,r.Vx)((0,r.iH)(t.name,{argument:JSON.stringify(e)}));d(!1),(null==l?void 0:l.success)&&a(!1)};return(0,n.jsx)(b.default,{width:850,open:l,onCancel:()=>{a(!1)},footer:null,children:(0,n.jsx)(N.Z,{spinning:o,children:(0,n.jsxs)(k.default,{size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{...i},autoComplete:"off",onFinish:x,children:[(0,n.jsx)(K.Z,{items:m}),(0,n.jsxs)("div",{className:"mt-3 mb-3",children:[(0,n.jsx)(S.ZP,{htmlType:"submit",type:"primary",className:"mr-6",children:s("Submit")}),(0,n.jsx)(S.ZP,{onClick:()=>{a(!1)},children:s("close")})]})]})})})}var et=l(27595),el=l(27329),ea=l(65886),en=l(68346);function es(e){let{type:t}=e;return"TEXT"===t?(0,n.jsx)(et.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"DOCUMENT"===t?(0,n.jsx)(el.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):"YUQUEURL"===t?(0,n.jsx)(ea.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"}):(0,n.jsx)(en.Z,{className:"text-[#2AA3FF] mr-2 !text-lg"})}let{confirm:er}=b.default,ei=e=>{let{name:t,id:l}=e,[a,s]=(0,A.useState)(!1),{t:o}=(0,V.$G)(),d=async(e,t)=>{var l;s(!0);let a=await (0,r.Vx)((0,r.Hx)(e,{doc_ids:[t]}));s(!1),(null===(l=a[2])||void 0===l?void 0:l.success)&&y.ZP.success(o("Synchronization_initiated"))};return a?(0,n.jsx)(N.Z,{indicator:(0,n.jsx)(i.Z,{spin:!0})}):(0,n.jsxs)(w.Z,{onClick:()=>{d(t,l)},children:[(0,n.jsx)(c.Z,{}),(0,n.jsx)("span",{children:o("Sync")})]})};function ec(e){var t;let[l]=k.default.useForm(),{space:a,addStatus:s}=e,{t:i}=(0,V.$G)(),c=(0,O.useRouter)(),[q,R]=(0,A.useState)([]),[L,M]=(0,A.useState)([]),[z,G]=(0,A.useState)(!1),[H,$]=(0,A.useState)(0),[J,K]=(0,A.useState)(!1),[W,B]=(0,A.useState)(),[Q,X]=(0,A.useState)(!1),et=(0,A.useRef)(1),el=(0,A.useMemo)(()=>(null==q?void 0:q.length)<H,[q,H]),ea=e=>{er({title:i("Tips"),icon:(0,n.jsx)(o.Z,{}),content:"".concat(i("Del_Document_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await eu(e)}})},{run:en,refresh:ec,loading:eo}=(0,v.Z)(async()=>await (0,r.Vx)((0,r._Q)(a.name,{page:et.current,page_size:18})),{manual:!0,onSuccess:e=>{let[,t]=e;R(null==t?void 0:t.data),M(null==t?void 0:t.data),$((null==t?void 0:t.total)||0)}}),ed=async()=>{if(!el)return;et.current+=1;let[e,t]=await (0,r.Vx)((0,r._Q)(a.name,{page:et.current,page_size:18}));R([...q,...t.data]),M([...q,...t.data])},eu=async t=>{await (0,r.Vx)((0,r.n3)(a.name,{doc_name:t.doc_name})),en(),e.onDeleteDoc()},em=()=>{e.onAddDoc(a.name)},ex=(e,t)=>{let l;switch(e){case"TODO":l="gold";break;case"RUNNING":l="#2db7f5";break;case"FINISHED":l="cyan";break;default:l="red"}return(0,n.jsx)(Z.Z,{title:t,children:(0,n.jsx)(C.Z,{color:l,children:e})})};(0,A.useEffect)(()=>{en()},[]),(0,A.useEffect)(()=>{"finish"===s&&en()},[s]);let{run:eh,loading:ep}=(0,v.Z)(async(e,t)=>{let[,l]=await (0,r.Vx)((0,r.ey)(a.name,{doc_name:t}));return l},{manual:!0,debounceWait:500,onSuccess:e=>{M(null==e?void 0:e.data)}}),{run:ef,loading:ej}=(0,v.Z)(async t=>{var l;return await (0,r.k7)(e.space.name,{questions:null===(l=t.questions)||void 0===l?void 0:l.map(e=>e.question),doc_id:(null==W?void 0:W.id)||"",doc_name:t.doc_name})},{manual:!0,onSuccess:async e=>{e.data.success?(y.ZP.success(i("Edit_Success")),await en(),K(!1)):y.ZP.error(e.data.err_msg)}});return(0,A.useEffect)(()=>{var e;W&&l.setFieldsValue({doc_name:W.doc_name,questions:null===(e=W.questions)||void 0===e?void 0:e.map(e=>({question:e}))})},[W,l]),(0,n.jsxs)("div",{className:"px-4",children:[(0,n.jsxs)(w.Z,{children:[(0,n.jsx)(S.ZP,{size:"middle",type:"primary",className:"flex items-center",icon:(0,n.jsx)(p.Z,{}),onClick:em,children:i("Add_Datasource")}),(0,n.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(f.Z,{}),onClick:()=>{G(!0)},children:"Arguments"}),"KnowledgeGraph"===a.vector_type&&(0,n.jsx)(S.ZP,{size:"middle",className:"flex items-center mx-2",icon:(0,n.jsx)(j.Z,{}),onClick:()=>{c.push("/knowledge/graph/?spaceName=".concat(a.name))},children:i("View_Graph")}),(0,n.jsx)(S.ZP,{icon:(0,n.jsx)(g.Z,{}),onClick:()=>X(!0),children:i("Recall_test")})]}),(0,n.jsx)(F.Z,{}),(0,n.jsx)(N.Z,{spinning:eo,children:(0,n.jsxs)("div",{className:"w-full h-full",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{className:"flex w-full justify-end",children:(0,n.jsx)(S.ZP,{type:"primary",onClick:async()=>{await ec()},loading:eo,children:i("Refresh_status")})})}),(0,n.jsx)("div",{className:"flex flex-col h-full p-3 border rounded-md",children:(null==q?void 0:q.length)>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex flex-1 justify-between items-center",children:(0,n.jsx)(I.default,{className:"w-1/3",prefix:(0,n.jsx)(d.Z,{}),placeholder:i("please_enter_the_keywords"),onChange:async e=>{await eh(a.id,e.target.value)},allowClear:!0})}),(0,n.jsxs)(N.Z,{spinning:ep,children:[(0,n.jsx)(n.Fragment,{children:L.length>0?(0,n.jsx)("div",{className:"h-96 mt-3 grid grid-cols-3 gap-x-6 gap-y-5 overflow-y-auto",children:L.map(e=>(0,n.jsxs)(T.Z,{className:" dark:bg-[#484848] relative  shrink-0 grow-0 cursor-pointer rounded-[10px] border border-gray-200 border-solid w-full max-h-64",title:(0,n.jsx)(Z.Z,{title:e.doc_name,children:(0,n.jsxs)("div",{className:"truncate ",children:[(0,n.jsx)(es,{type:e.doc_type}),(0,n.jsx)("span",{children:e.doc_name})]})}),extra:(0,n.jsx)(P.Z,{menu:{items:[{key:"publish",label:(0,n.jsxs)(w.Z,{onClick:()=>{c.push("/construct/knowledge/chunk/?spaceName=".concat(a.name,"&id=").concat(e.id))},children:[(0,n.jsx)(u.Z,{}),(0,n.jsx)("span",{children:i("detail")})]})},{key:"".concat(i("Sync")),label:(0,n.jsx)(ei,{name:a.name,id:e.id})},{key:"edit",label:(0,n.jsxs)(w.Z,{onClick:()=>{K(!0),B(e)},children:[(0,n.jsx)(m.Z,{}),(0,n.jsx)("span",{children:i("Edit")})]})},{key:"del",label:(0,n.jsxs)(w.Z,{onClick:()=>{ea(e)},children:[(0,n.jsx)(x.Z,{}),(0,n.jsx)("span",{children:i("Delete")})]})}]},getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,className:"rounded-md",children:(0,n.jsx)(h.Z,{className:"p-2"})}),children:[(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[i("Size"),":"]}),(0,n.jsxs)("p",{children:[e.chunk_size," chunks"]}),(0,n.jsxs)("p",{className:"mt-2 font-semibold ",children:[i("Last_Sync"),":"]}),(0,n.jsx)("p",{children:D()(e.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,n.jsx)("p",{className:"mt-2 mb-2",children:ex(e.status,e.result)})]},e.id))}):(0,n.jsx)(E.Z,{className:"flex flex-1 w-full py-10 flex-col items-center justify-center",image:E.Z.PRESENTED_IMAGE_DEFAULT})}),el&&(0,n.jsx)(F.Z,{children:(0,n.jsx)("span",{className:"cursor-pointer",onClick:ed,children:i("Load_more")})})]})]}):(0,n.jsx)(E.Z,{image:E.Z.PRESENTED_IMAGE_DEFAULT,children:(0,n.jsx)(S.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,n.jsx)(p.Z,{}),onClick:em,children:"Create Now"})})})]})}),(0,n.jsx)(ee,{space:a,argumentsShow:z,setArgumentsShow:G}),(0,n.jsx)(b.default,{title:i("Edit_document"),open:J,onCancel:()=>K(!1),destroyOnClose:!0,footer:[(0,n.jsx)(S.ZP,{onClick:()=>K(!1),children:i("cancel")},"back"),(0,n.jsx)(S.ZP,{type:"primary",loading:ej,onClick:async()=>{let e=l.getFieldsValue();await ef(e)},children:i("verify")},"submit")],children:(0,n.jsxs)(k.default,{form:l,initialValues:{doc_name:null==W?void 0:W.doc_name,questions:null==W?void 0:null===(t=W.questions)||void 0===t?void 0:t.map(e=>({question:e}))},children:[(0,n.jsx)(k.default.Item,{label:i("Document_name"),name:"doc_name",children:(0,n.jsx)(I.default,{})}),(0,n.jsx)(k.default.Item,{label:i("Correlation_problem"),children:(0,n.jsx)(k.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:l}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(k.default.Item,{label:"",name:[l,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:"请输入"})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(l)}})})]},t)}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{l({question:"",valid:!1})},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]})}),(0,n.jsx)(Y,{open:Q,setOpen:X,space:a})]})}function eo(e){let{t}=(0,V.$G)(),{handleStepChange:l}=e,a=[{type:"TEXT",title:t("Text"),subTitle:t("Fill your raw text"),iconType:"TEXT"},{type:"URL",title:t("URL"),subTitle:t("Fetch_the_content_of_a_URL"),iconType:"WEBPAGE"},{type:"DOCUMENT",title:t("Document"),subTitle:t("Upload_a_document"),iconType:"DOCUMENT"},{type:"YUQUEURL",title:t("yuque"),subTitle:t("Get_yuque_document"),iconType:"YUQUEURL"}];return(0,n.jsx)(n.Fragment,{children:a.map((e,t)=>(0,n.jsxs)(T.Z,{className:"mt-4 mb-4 cursor-pointer",onClick:()=>{l({label:"forward",docType:e.type})},children:[(0,n.jsxs)("div",{className:"font-semibold",children:[(0,n.jsx)(es,{type:e.iconType}),e.title]}),(0,n.jsx)("div",{children:e.subTitle})]},t))})}var ed=l(64082),eu=l(23799),em=l(45030);let{Dragger:ex}=eu.default,{TextArea:eh}=I.default;function ep(e){let{className:t,handleStepChange:l,spaceName:a,docType:s}=e,{t:i}=(0,V.$G)(),[c]=k.default.useForm(),[o,d]=(0,A.useState)(!1),[u,m]=(0,A.useState)([]),x=async e=>{let t;let{docName:n,textSource:i,text:c,webPageUrl:o,doc_token:m,questions:x=[]}=e;switch(d(!0),s){case"URL":[,t]=await (0,r.Vx)((0,r.H_)(a,{doc_name:n,content:o,doc_type:"URL",questions:null==x?void 0:x.map(e=>e.question)}));break;case"TEXT":[,t]=await (0,r.Vx)((0,r.H_)(a,{doc_name:n,source:i,content:c,doc_type:"TEXT",questions:x.map(e=>e.question)}));break;case"YUQUEURL":[,t]=await (0,r.Vx)((0,r.TT)({doc_name:n,space_name:a,content:o,doc_type:"YUQUEURL",doc_token:m||"",questions:null==x?void 0:x.map(e=>e.question)}))}return(d(!1),"DOCUMENT"===s&&u.length<1)?y.ZP.error("Upload failed, please re-upload."):"DOCUMENT"===s||t?void l({label:"forward",files:"DOCUMENT"===s?u:[{name:n,doc_id:t||-1}]}):y.ZP.error("Upload failed, please re-upload.")},h=e=>{let{fileList:t}=e;0===t.length&&c.setFieldValue("originFileObj",null)},f=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Text_Source"),":"),name:"textSource",rules:[{required:!0,message:i("Please_input_the_text_source")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_text_source")})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Text"),":"),name:"text",rules:[{required:!0,message:i("Please_input_the_description")}],children:(0,n.jsx)(eh,{rows:4})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(k.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:l}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(k.default.Item,{label:"",name:[l,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(l)}})})]},t)}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),j=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Web_Page_URL"),":"),name:"webPageUrl",rules:[{required:!0,message:i("Please_input_the_Web_Page_URL")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("Please_input_the_Web_Page_URL")})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(k.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:l}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(k.default.Item,{label:"",name:[l,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(l)}})})]},t)}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),g=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{label:"".concat(i("Name"),":"),name:"docName",rules:[{required:!0,message:i("Please_input_the_name")}],children:(0,n.jsx)(I.default,{className:"mb-5 h-12",placeholder:i("Please_input_the_name")})}),(0,n.jsx)(k.default.Item,{label:i("document_url"),name:"webPageUrl",rules:[{required:!0,message:i("input_document_url")}],children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("input_document_url")})}),(0,n.jsx)(k.default.Item,{label:i("document_token"),name:"doc_token",tooltip:(0,n.jsxs)(n.Fragment,{children:[i("Get_token"),(0,n.jsx)(em.Z.Link,{href:"https://yuque.antfin-inc.com/lark/openapi/dh8zp4",target:"_blank",children:i("Reference_link")})]}),children:(0,n.jsx)(I.default,{className:"mb-5  h-12",placeholder:i("input_document_token")})}),(0,n.jsx)(k.default.Item,{label:"".concat(i("Correlation_problem"),":"),children:(0,n.jsx)(k.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:l}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(k.default.Item,{label:"",name:[l,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:i("input_question")})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(l)}})})]},t)}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]}),v=async e=>{let{onSuccess:t,onError:l,file:n}=e,s=new FormData,i=null==n?void 0:n.name;s.append("doc_name",i),s.append("doc_file",n),s.append("doc_type","DOCUMENT");let[,c]=await (0,r.Vx)((0,r.iG)(a,s));Number.isInteger(c)?(t&&t(c||0),m(e=>(e.push({name:i,doc_id:c||-1}),e))):l&&l({name:"",message:""})},b=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{name:"originFileObj",rules:[{required:!0,message:i("Please_select_file")}],children:(0,n.jsxs)(ex,{multiple:!0,onChange:h,maxCount:100,accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md,.zip,.csv",customRequest:v,children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(ed.Z,{})}),(0,n.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:i("Select_or_Drop_file")}),(0,n.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown, Zip1, Csv"})]})}),(0,n.jsx)(k.default.Item,{label:"关联问题:",children:(0,n.jsx)(k.default.List,{name:"questions",children:(e,t)=>{let{add:l,remove:a}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:l}=e;return(0,n.jsxs)("div",{className:U()("flex flex-1 items-center gap-8 mb-6"),children:[(0,n.jsx)(k.default.Item,{label:"",name:[l,"question"],className:"grow",children:(0,n.jsx)(I.default,{placeholder:"请输入问题"})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(_.Z,{onClick:()=>{a(l)}})})]},t)}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"dashed",onClick:()=>{l()},block:!0,icon:(0,n.jsx)(p.Z,{}),children:i("Add_problem")})})]})}})})]});return(0,n.jsx)(N.Z,{spinning:o,children:(0,n.jsxs)(k.default,{form:c,size:"large",className:U()("mt-4",t),layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:x,children:[(()=>{switch(s){case"URL":return j();case"DOCUMENT":return b();case"YUQUEURL":return g();default:return f()}})(),(0,n.jsxs)(k.default.Item,{children:[(0,n.jsx)(S.ZP,{onClick:()=>{l({label:"back"})},className:"mr-4",children:"".concat(i("Back"))}),(0,n.jsx)(S.ZP,{type:"primary",loading:o,htmlType:"submit",children:i("Next")})]})]})})}var ef=l(82353),ej=l(16165),eg=l(40056),e_=l(47221),ev=l(84567),eb=l(78045);let{TextArea:ey}=I.default;function eN(e){let{strategies:t,docType:l,fileName:a,field:s}=e,[r,i]=(0,A.useState)(),c="";if("DOCUMENT"===l){let e=a.split(".");c=e[e.length-1]}let o=c?t.filter(e=>e.suffix.indexOf(c)>-1):t,{t:d}=(0,V.$G)(),u={strategy:"Automatic",name:d("Automatic"),desc:d("Automatic_desc")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(k.default.Item,{name:[s.name,"chunk_parameters","chunk_strategy"],initialValue:u.strategy,children:(0,n.jsxs)(eb.ZP.Group,{style:{marginTop:16},onChange:function(e){i(e.target.value)},children:[(0,n.jsx)(eb.ZP,{value:u.strategy,children:u.name}),o.map(e=>(0,n.jsx)(eb.ZP,{value:e.strategy,children:e.name},"strategy_radio_".concat(e.strategy)))]})}),function(){var e;if(!r)return null;if(r===u.name)return(0,n.jsx)("p",{className:"my-4",children:u.desc});let t=null===(e=null==o?void 0:o.filter(e=>e.strategy===r)[0])||void 0===e?void 0:e.parameters;return t&&t.length?(0,n.jsx)("div",{className:"mt-2",children:null==t?void 0:t.map(e=>(0,n.jsx)(k.default.Item,{label:e.param_name,name:[s.name,"chunk_parameters",e.param_name],rules:[{required:!0,message:d("Please_input_the_name")}],initialValue:e.default_value,valuePropName:"boolean"===e.param_type?"checked":"value",tooltip:e.description,children:function(e){switch(e){case"int":return(0,n.jsx)(G.Z,{className:"w-full",min:1});case"string":return(0,n.jsx)(ey,{className:"w-full",rows:2});case"boolean":return(0,n.jsx)(ev.Z,{})}}(e.param_type)},"param_".concat(e.param_name)))}):(0,n.jsx)(eg.Z,{className:"my-2",type:"warning",message:d("No_parameter")})}()]})}function ew(e){let{spaceName:t,docType:l,uploadFiles:s,handleStepChange:i}=e,{t:c}=(0,V.$G)(),[o]=k.default.useForm(),[d,u]=(0,A.useState)(s),[m,x]=(0,A.useState)(),[h,p]=(0,A.useState)([]),[f,j]=(0,A.useState)("");async function g(){var e;x(!0);let[,t]=await (0,r.Vx)((0,r.iZ)());x(!1),p(null===(e=t||[])||void 0===e?void 0:e.filter(e=>e.type.indexOf(l)>-1))}(0,A.useEffect)(()=>(g(),()=>{a&&clearInterval(a)}),[]);let _=async e=>{if(function(e){let t=!0;"RUNNING"===f&&(t=!1,y.ZP.warning("The task is still running, do not submit it again."));let{fileStrategies:l}=e;return l.map(e=>{var l,a;let n=null==e?void 0:null===(l=e.chunk_parameters)||void 0===l?void 0:l.chunk_strategy;n||(y.ZP.error("Please select chunk strategy for ".concat(e.name,".")),t=!1);let s=h.filter(e=>e.strategy===n)[0],r={chunk_strategy:null==e?void 0:null===(a=e.chunk_parameters)||void 0===a?void 0:a.chunk_strategy};s&&s.parameters&&s.parameters.forEach(t=>{let l=t.param_name;r[l]=(null==e?void 0:e.chunk_parameters)[l]}),e.chunk_parameters=r}),t}(e)){var l;x(!0);let[,n]=await (0,r.Vx)((0,r.KL)(t,e.fileStrategies));if(x(!1),(null==n?void 0:n.tasks)&&(null==n?void 0:null===(l=n.tasks)||void 0===l?void 0:l.length)>0){y.ZP.success("Segemation task start successfully. task id: ".concat(null==n?void 0:n.tasks.join(","))),j("RUNNING");let t=e.fileStrategies.map(e=>e.doc_id);a=setInterval(async()=>{let e=await v(t);"FINISHED"===e?(clearInterval(a),j("FINISHED"),y.ZP.success("Congratulation, All files sync successfully."),i({label:"finish"})):"FAILED"===e&&(clearInterval(a),i({label:"finish"}))},3e3)}}};async function v(e){let[,l]=await (0,r.Vx)((0,r._Q)(t,{doc_ids:e}));if((null==l?void 0:l.data)&&(null==l?void 0:l.data.length)>0){let e=[...d];if(null==l||l.data.map(t=>{var l;let a=null===(l=null==e?void 0:e.filter(e=>e.doc_id===t.id))||void 0===l?void 0:l[0];a&&(a.status=t.status)}),u(e),null==l?void 0:l.data.every(e=>"FINISHED"===e.status||"FAILED"===e.status))return"FINISHED"}}return(0,n.jsx)(N.Z,{spinning:m,children:(0,n.jsxs)(k.default,{labelCol:{span:6},wrapperCol:{span:18},labelAlign:"right",form:o,size:"large",className:"mt-4",layout:"horizontal",name:"basic",autoComplete:"off",initialValues:{fileStrategies:d},onFinish:_,children:[h&&h.length?(0,n.jsx)(k.default.List,{name:"fileStrategies",children:e=>{switch(l){case"TEXT":case"URL":case"YUQUEURL":return null==e?void 0:e.map(e=>(0,n.jsx)(eN,{strategies:h,docType:l,fileName:d[e.name].name,field:e},e.key));case"DOCUMENT":return(0,n.jsx)(e_.Z,{defaultActiveKey:0,size:d.length>5?"small":"middle",children:null==e?void 0:e.map(e=>(0,n.jsx)(e_.Z.Panel,{header:"".concat(e.name+1,". ").concat(d[e.name].name),extra:function(e){let t=d[e].status;switch(t){case"FINISHED":return(0,n.jsx)(ej.Z,{component:ef.qw});case"RUNNING":return(0,n.jsx)(ej.Z,{className:"animate-spin animate-infinite",component:ef.bn});case"FAILED":return(0,n.jsx)(ej.Z,{component:ef.FE});default:return(0,n.jsx)(ej.Z,{component:ef.tu})}}(e.name),children:(0,n.jsx)(eN,{strategies:h,docType:l,fileName:d[e.name].name,field:e})},e.key))})}}}):(0,n.jsx)(eg.Z,{message:"Cannot find one strategy for ".concat(l," type knowledge."),type:"warning"}),(0,n.jsxs)(k.default.Item,{className:"mt-4",children:[(0,n.jsx)(S.ZP,{onClick:()=>{i({label:"back"})},className:"mr-4",children:"".concat(c("Back"))}),(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",loading:m||"RUNNING"===f,children:c("Process")})]})]})})}function ek(e){var t;let{t:l}=(0,V.$G)(),{handleStepChange:a,spaceConfig:s}=e,[i,c]=(0,A.useState)(!1),[o,d]=(0,A.useState)(),[u]=k.default.useForm();(0,A.useEffect)(()=>{u.setFieldValue("storage",null==s?void 0:s[0].name),d(null==s?void 0:s[0].name)},[s]);let m=async e=>{let{spaceName:t,owner:l,description:n,storage:s,field:i}=e;c(!0);let[o,d,u]=await (0,r.Vx)((0,r.be)({name:t,vector_type:s,owner:l,desc:n,domain_type:i}));c(!1);let m="FinancialReport"===i;localStorage.setItem("cur_space_id",JSON.stringify(d)),(null==u?void 0:u.success)&&a({label:"forward",spaceName:t,pace:m?2:1,docType:m?"DOCUMENT":""})};return(0,n.jsx)(N.Z,{spinning:i,children:(0,n.jsxs)(k.default,{form:u,size:"large",className:"mt-4",layout:"vertical",name:"basic",initialValues:{remember:!0},autoComplete:"off",onFinish:m,children:[(0,n.jsx)(k.default.Item,{label:l("Knowledge_Space_Name"),name:"spaceName",rules:[{required:!0,message:l("Please_input_the_name")},()=>({validator:(e,t)=>/[^\u4e00-\u9fa50-9a-zA-Z_-]/.test(t)?Promise.reject(Error(l("the_name_can_only_contain"))):Promise.resolve()})],children:(0,n.jsx)(I.default,{className:"h-12",placeholder:l("Please_input_the_name")})}),(0,n.jsx)(k.default.Item,{label:l("Storage"),name:"storage",rules:[{required:!0,message:l("Please_select_the_storage")}],children:(0,n.jsx)(H.default,{className:"mb-5 h-12",placeholder:l("Please_select_the_storage"),onChange:e=>{d(e)},children:null==s?void 0:s.map(e=>(0,n.jsx)(H.default.Option,{value:e.name,children:e.desc},e.name))})}),(0,n.jsx)(k.default.Item,{label:l("Domain"),name:"field",rules:[{required:!0,message:l("Please_select_the_domain_type")}],children:(0,n.jsx)(H.default,{className:"mb-5 h-12",placeholder:l("Please_select_the_domain_type"),children:null===(t=null==s?void 0:s.find(e=>e.name===o))||void 0===t?void 0:t.domain_types.map(e=>(0,n.jsx)(H.default.Option,{value:e.name,children:e.desc},e.name))})}),(0,n.jsx)(k.default.Item,{label:l("Description"),name:"description",rules:[{required:!0,message:l("Please_input_the_description")}],children:(0,n.jsx)(I.default,{className:"h-12",placeholder:l("Please_input_the_description")})}),(0,n.jsx)(k.default.Item,{children:(0,n.jsx)(S.ZP,{type:"primary",htmlType:"submit",children:l("Next")})})]})})}var eZ=l(91467),eC=l(1771),eS=l(14079),eI=l(42119),eT=l(96486),eP=()=>{let{setCurrentDialogInfo:e}=(0,A.useContext)(s.p),[t,l]=(0,A.useState)([]),[a,i]=(0,A.useState)(!1),[c,u]=(0,A.useState)(!1),[m,x]=(0,A.useState)(),[h,f]=(0,A.useState)(0),[j,g]=(0,A.useState)(""),[_,v]=(0,A.useState)([]),[y,w]=(0,A.useState)(""),[k,Z]=(0,A.useState)(""),[T,P]=(0,A.useState)(!1),[E,F]=(0,A.useState)(null),{t:q}=(0,V.$G)(),R=[{title:q("Knowledge_Space_Config")},{title:q("Choose_a_Datasource_type")},{title:q("Upload")},{title:q("Segmentation")}],L=(0,O.useRouter)();async function M(e){P(!0);let[t,a]=await (0,r.Vx)((0,r.Vm)({...e}));P(!1),l(a)}async function z(){let[e,t]=await (0,r.Vx)((0,r.mB)());if(!t)return null;F(t.storage)}(0,A.useEffect)(()=>{M(),z()},[]);let G=async t=>{let[l,a]=await (0,r.Vx)((0,r.sW)({chat_mode:"chat_knowledge"}));(null==a?void 0:a.conv_uid)&&(null==e||e({chat_scene:a.chat_mode,app_code:a.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:a.chat_mode})),L.push("/chat?scene=chat_knowledge&id=".concat(null==a?void 0:a.conv_uid,"&knowledge_id=").concat(t.name)))},H=e=>{let{label:t,spaceName:l,docType:a,files:n}=e;"finish"===t?(i(!1),M(),g(""),w(""),Z("finish"),localStorage.removeItem("cur_space_id")):"forward"===t?(0===h&&M(),f(e=>e+1)):f(e=>e-1),n&&v(n),l&&g(l),a&&w(a)},Y=e=>{b.default.confirm({title:q("Tips"),icon:(0,n.jsx)(o.Z,{}),content:"".concat(q("Del_Knowledge_Tips"),"?"),okText:"Yes",okType:"danger",cancelText:"No",async onOk(){await (0,r.Vx)((0,r.XK)({name:null==e?void 0:e.name})),M()}})},$=async e=>{M({name:e.target.value})};return(0,n.jsx)(eC.Z,{children:(0,n.jsxs)(N.Z,{spinning:T,children:[(0,n.jsxs)("div",{className:"page-body p-4 md:p-6 h-[90vh] overflow-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(I.default,{variant:"filled",prefix:(0,n.jsx)(d.Z,{}),placeholder:q("please_enter_the_keywords"),onChange:(0,eT.debounce)($,300),allowClear:!0,className:"w-[230px] h-[40px] border-1 border-white backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60"})}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(S.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,n.jsx)(p.Z,{}),onClick:()=>{i(!0)},children:q("create_knowledge")})})]}),(0,n.jsx)("div",{className:"flex flex-wrap mt-4 mx-[-8px]",children:null==t?void 0:t.map(e=>(0,n.jsx)(eZ.ZP,{onClick:()=>{x(e),u(!0),localStorage.setItem("cur_space_id",JSON.stringify(e.id))},description:e.desc,name:e.name,logo:"FinancialReport"===e.domain_type?"/models/fin_report.jpg":"KnowledgeGraph"===e.vector_type?"/models/knowledge-graph.png":"FullText"===e.vector_type?"/models/knowledge-full-text.jpg":"/models/knowledge-default.jpg",RightTop:(0,n.jsx)(eZ.ZS,{menu:{items:[{key:"del",label:(0,n.jsx)("span",{className:"text-red-400",onClick:()=>Y(e),children:q("Delete")})}]}}),rightTopHover:!1,Tags:(0,n.jsxs)("div",{className:"flex item-center",children:[(0,n.jsx)(C.Z,{children:(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(eS.Z,{className:"mt-[1px]"}),e.docs]})}),(0,n.jsx)(C.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.domain_type||"Normal"})}),e.vector_type?(0,n.jsx)(C.Z,{children:(0,n.jsx)("span",{className:"flex items-center gap-1",children:e.vector_type})}):null]}),LeftBottom:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("span",{children:e.owner}),(0,n.jsx)("span",{children:"•"}),(null==e?void 0:e.gmt_modified)&&(0,n.jsx)("span",{children:D()(null==e?void 0:e.gmt_modified).fromNow()+" "+q("update")})]}),RightBottom:(0,n.jsx)(eZ.TH,{text:q("start_chat"),onClick:()=>{G(e)}})},e.id))})]}),(0,n.jsx)(b.default,{className:"h-5/6 overflow-hidden",open:c,width:"70%",onCancel:()=>u(!1),footer:null,destroyOnClose:!0,children:(0,n.jsx)(ec,{space:m,onAddDoc:function(e){g(e),f(1),i(!0),Z("start")},onDeleteDoc:M,addStatus:k})}),(0,n.jsxs)(b.default,{title:q("New_knowledge_base"),centered:!0,open:a,destroyOnClose:!0,onCancel:()=>{i(!1)},width:1e3,afterClose:()=>{f(0),M()},footer:null,children:[(0,n.jsx)(eI.Z,{current:h,items:R}),0===h&&(0,n.jsx)(ek,{handleStepChange:H,spaceConfig:E}),1===h&&(0,n.jsx)(eo,{handleStepChange:H}),(0,n.jsx)(ep,{className:U()({hidden:2!==h}),spaceName:j,docType:y,handleStepChange:H}),3===h&&(0,n.jsx)(ew,{spaceName:j,docType:y,uploadFiles:_,handleStepChange:H})]})]})})}},56397:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(48218),s=l(58638),r=l(31418),i=l(45030),c=l(20640),o=l.n(c),d=l(67294),u=l(73913);t.default=(0,d.memo)(()=>{var e;let{appInfo:t}=(0,d.useContext)(u.MobileChatContext),{message:l}=r.Z.useApp(),[c,m]=(0,d.useState)(0);if(!(null==t?void 0:t.app_code))return null;let x=async()=>{let e=o()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));l[e?"success":"error"](e?"复制成功":"复制失败")};return c>6&&l.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,a.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(c+1),children:[(0,a.jsx)(n.Z,{scene:(null==t?void 0:null===(e=t.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,a.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,a.jsx)(i.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==t?void 0:t.app_name}),(0,a.jsx)(i.Z.Text,{className:"text-sm line-clamp-2",children:null==t?void 0:t.app_describe})]})]}),(0,a.jsx)("div",{onClick:x,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,a.jsx)(s.Z,{className:"text-lg"})})]})})},74638:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(76212),s=l(62418),r=l(25519),i=l(30159),c=l(87740),o=l(50888),d=l(52645),u=l(27496),m=l(1375),x=l(65654),h=l(66309),p=l(55241),f=l(74330),j=l(25278),g=l(14726),_=l(93967),v=l.n(_),b=l(39332),y=l(67294),N=l(73913),w=l(7001),k=l(73749),Z=l(97109);let C=["magenta","orange","geekblue","purple","cyan","green"];t.default=()=>{var e,t;let l=(0,b.useSearchParams)(),_=null!==(t=null==l?void 0:l.get("ques"))&&void 0!==t?t:"",{history:S,model:I,scene:T,temperature:P,resource:E,conv_uid:F,appInfo:q,scrollViewRef:U,order:R,userInput:D,ctrl:O,canAbort:A,canNewChat:V,setHistory:L,setCanNewChat:M,setCarAbort:z,setUserInput:G}=(0,y.useContext)(N.MobileChatContext),[H,Y]=(0,y.useState)(!1),[$,J]=(0,y.useState)(!1),K=async e=>{var t,l,a;G(""),O.current=new AbortController;let n={chat_mode:T,model_name:I,user_input:e||D,conv_uid:F,temperature:P,app_code:null==q?void 0:q.app_code,...E&&{select_param:JSON.stringify(E)}};if(S&&S.length>0){let e=null==S?void 0:S.filter(e=>"view"===e.role);R.current=e[e.length-1].order+1}let i=[{role:"human",context:e||D,model_name:I,order:R.current,time_stamp:0},{role:"view",context:"",model_name:I,order:R.current,time_stamp:0,thinking:!0}],c=i.length-1;L([...S,...i]),M(!1);try{await (0,m.L)("".concat((t="http://127.0.0.1:5670",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[r.gp]:null!==(l=(0,s.n5)())&&void 0!==l?l:""},signal:O.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=O.current)||void 0===e||e.abort(),M(!0),z(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(M(!0),z(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(i[c].context=null==t?void 0:t.replace("[ERROR]",""),i[c].thinking=!1,L([...S,...i]),M(!0),z(!1)):(z(!0),i[c].context=t,i[c].thinking=!1,L([...S,...i]))}})}catch(e){null===(a=O.current)||void 0===a||a.abort(),i[c].context="Sorry, we meet some error, please try again later.",i[c].thinking=!1,L([...i]),M(!0),z(!1)}},W=async()=>{D.trim()&&V&&await K()};(0,y.useEffect)(()=>{var e,t;null===(e=U.current)||void 0===e||e.scrollTo({top:null===(t=U.current)||void 0===t?void 0:t.scrollHeight,behavior:"auto"})},[S,U]);let B=(0,y.useMemo)(()=>{if(!q)return[];let{param_need:e=[]}=q;return null==e?void 0:e.map(e=>e.type)},[q]),Q=(0,y.useMemo)(()=>{var e;return 0===S.length&&q&&!!(null==q?void 0:null===(e=q.recommend_questions)||void 0===e?void 0:e.length)},[S,q]),{run:X,loading:ee}=(0,x.Z)(async()=>await (0,n.Vx)((0,n.zR)(F)),{manual:!0,onSuccess:()=>{L([])}});return(0,y.useEffect)(()=>{_&&I&&F&&q&&K(_)},[q,F,I,_]),(0,a.jsxs)("div",{className:"flex flex-col",children:[Q&&(0,a.jsx)("ul",{children:null==q?void 0:null===(e=q.recommend_questions)||void 0===e?void 0:e.map((e,t)=>(0,a.jsx)("li",{className:"mb-3",children:(0,a.jsx)(h.Z,{color:C[t],className:"p-2 rounded-xl",onClick:async()=>{K(e.question)},children:e.question})},e.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==B?void 0:B.includes("model"))&&(0,a.jsx)(w.default,{}),(null==B?void 0:B.includes("resource"))&&(0,a.jsx)(k.default,{}),(null==B?void 0:B.includes("temperature"))&&(0,a.jsx)(Z.default,{})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,a.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,a.jsx)(i.Z,{className:v()("p-2 cursor-pointer",{"text-[#0c75fc]":A,"text-gray-400":!A}),onClick:()=>{var e;A&&(null===(e=O.current)||void 0===e||e.abort(),setTimeout(()=>{z(!1),M(!0)},100))}})}),(0,a.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,a.jsx)(c.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!S.length||!V}),onClick:()=>{var e,t;if(!V||0===S.length)return;let l=null===(e=null===(t=S.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];K((null==l?void 0:l.context)||"")}})}),ee?(0,a.jsx)(f.Z,{spinning:ee,indicator:(0,a.jsx)(o.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,a.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,a.jsx)(d.Z,{className:v()("p-2 cursor-pointer",{"text-gray-400":!S.length||!V}),onClick:()=>{V&&X()}})})]})]}),(0,a.jsxs)("div",{className:v()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":H}),children:[(0,a.jsx)(j.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:D,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if($){e.preventDefault();return}D.trim()&&(e.preventDefault(),W())}},onChange:e=>{G(e.target.value)},onFocus:()=>{Y(!0)},onBlur:()=>Y(!1),onCompositionStartCapture:()=>{J(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{J(!1)},0)}}),(0,a.jsx)(g.ZP,{type:"primary",className:v()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!D.trim()||!V}),onClick:W,children:V?(0,a.jsx)(u.Z,{}):(0,a.jsx)(f.Z,{indicator:(0,a.jsx)(o.Z,{className:"text-white"})})})]})]})}},7001:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(41468),s=l(39718),r=l(94668),i=l(85418),c=l(55241),o=l(67294),d=l(73913);t.default=()=>{let{modelList:e}=(0,o.useContext)(n.p),{model:t,setModel:l}=(0,o.useContext)(d.MobileChatContext),u=(0,o.useMemo)(()=>e.length>0?e.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{l(e)},children:[(0,a.jsx)(s.Z,{width:14,height:14,model:e}),(0,a.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,l]);return(0,a.jsx)(i.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,a.jsx)(c.Z,{content:t,children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(s.Z,{width:16,height:16,model:t}),(0,a.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:t}),(0,a.jsx)(r.Z,{rotate:90})]})})})}},46568:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(25675),s=l.n(n),r=l(67294);t.default=(0,r.memo)(e=>{let{width:t,height:l,src:n,label:r}=e;return(0,a.jsx)(s(),{width:t||14,height:l||14,src:n,alt:r||"db-icon",priority:!0})})},73749:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(76212),s=l(62418),r=l(50888),i=l(94668),c=l(83266),o=l(65654),d=l(74330),u=l(23799),m=l(85418),x=l(67294),h=l(73913),p=l(46568);t.default=()=>{let{appInfo:e,resourceList:t,scene:l,model:f,conv_uid:j,getChatHistoryRun:g,setResource:_,resource:v}=(0,x.useContext)(h.MobileChatContext),[b,y]=(0,x.useState)(null),N=(0,x.useMemo)(()=>{var t,l,a;return null===(t=null==e?void 0:null===(l=e.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(a=t[0])||void 0===a?void 0:a.value},[e]),w=(0,x.useMemo)(()=>t&&t.length>0?t.map(e=>({label:(0,a.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{y(e),_(e.space_id||e.param)},children:[(0,a.jsx)(p.default,{width:14,height:14,src:s.S$[e.type].icon,label:s.S$[e.type].label}),(0,a.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[t,_]),{run:k,loading:Z}=(0,o.Z)(async e=>{let[,t]=await (0,n.Vx)((0,n.qn)({convUid:j,chatMode:l,data:e,model:f,config:{timeout:36e5}}));return _(t),t},{manual:!0,onSuccess:async()=>{await g()}}),C=async e=>{let t=new FormData;t.append("doc_file",null==e?void 0:e.file),await k(t)},S=(0,x.useMemo)(()=>Z?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.Z,{size:"small",indicator:(0,a.jsx)(r.Z,{spin:!0})}),(0,a.jsx)("span",{className:"text-xs",children:"上传中"})]}):v?(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("span",{className:"text-xs",children:v.file_name}),(0,a.jsx)(i.Z,{rotate:90})]}):(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"text-base"}),(0,a.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[Z,v]);return(0,a.jsx)(a.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,a.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,a.jsx)(u.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:C,className:"flex h-full w-full items-center justify-center",children:S})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,l,n,r,c;if(!(null==t?void 0:t.length))return null;return(0,a.jsx)(m.Z,{menu:{items:w},placement:"top",trigger:["click"],children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,a.jsx)(p.default,{width:14,height:14,src:null===(e=s.S$[(null==b?void 0:b.type)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.type)])||void 0===e?void 0:e.icon,label:null===(n=s.S$[(null==b?void 0:b.type)||(null==t?void 0:null===(r=t[0])||void 0===r?void 0:r.type)])||void 0===n?void 0:n.label}),(0,a.jsx)("span",{className:"text-xs font-medium",children:(null==b?void 0:b.param)||(null==t?void 0:null===(c=t[0])||void 0===c?void 0:c.param)}),(0,a.jsx)(i.Z,{rotate:90})]})})}})()})}},97109:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(70065),s=l(85418),r=l(30568),i=l(67294),c=l(73913);t.default=()=>{let{temperature:e,setTemperature:t}=(0,i.useContext)(c.MobileChatContext),l=e=>{isNaN(e)||t(e)};return(0,a.jsx)(s.Z,{trigger:["click"],dropdownRender:()=>(0,a.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,a.jsx)(r.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:l,value:e})}),placement:"top",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,a.jsx)(n.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},73913:function(e,t,l){"use strict";l.r(t),l.d(t,{MobileChatContext:function(){return _}});var a=l(85893),n=l(41468),s=l(76212),r=l(2440),i=l(62418),c=l(25519),o=l(1375),d=l(65654),u=l(74330),m=l(5152),x=l.n(m),h=l(39332),p=l(67294),f=l(56397),j=l(74638);let g=x()(()=>Promise.all([l.e(3662),l.e(7034),l.e(8674),l.e(930),l.e(3166),l.e(2837),l.e(2168),l.e(8163),l.e(7126),l.e(4041),l.e(2398),l.e(1300),l.e(4567),l.e(7665),l.e(9773),l.e(3457),l.e(4035),l.e(6624),l.e(4705),l.e(9202),l.e(5782),l.e(2783),l.e(8709),l.e(9256),l.e(9870)]).then(l.bind(l,36818)),{loadableGenerated:{webpack:()=>[36818]},ssr:!1}),_=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});t.default=()=>{var e,t;let l=(0,h.useSearchParams)(),m=null!==(e=null==l?void 0:l.get("chat_scene"))&&void 0!==e?e:"",x=null!==(t=null==l?void 0:l.get("app_code"))&&void 0!==t?t:"",{modelList:v}=(0,p.useContext)(n.p),[b,y]=(0,p.useState)([]),[N,w]=(0,p.useState)(""),[k,Z]=(0,p.useState)(.5),[C,S]=(0,p.useState)(null),I=(0,p.useRef)(null),[T,P]=(0,p.useState)(""),[E,F]=(0,p.useState)(!1),[q,U]=(0,p.useState)(!0),R=(0,p.useRef)(),D=(0,p.useRef)(1),O=(0,r.Z)(),A=(0,p.useMemo)(()=>"".concat(null==O?void 0:O.user_no,"_").concat(x),[x,O]),{run:V,loading:L}=(0,d.Z)(async()=>await (0,s.Vx)((0,s.$i)("".concat(null==O?void 0:O.user_no,"_").concat(x))),{manual:!0,onSuccess:e=>{let[,t]=e,l=null==t?void 0:t.filter(e=>"view"===e.role);l&&l.length>0&&(D.current=l[l.length-1].order+1),y(t||[])}}),{data:M,run:z,loading:G}=(0,d.Z)(async e=>{let[,t]=await (0,s.Vx)((0,s.BN)(e));return null!=t?t:{}},{manual:!0}),{run:H,data:Y,loading:$}=(0,d.Z)(async()=>{var e,t;let[,l]=await (0,s.Vx)((0,s.vD)(m));return S((null==l?void 0:null===(e=l[0])||void 0===e?void 0:e.space_id)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.param)),null!=l?l:[]},{manual:!0}),{run:J,loading:K}=(0,d.Z)(async()=>{let[,e]=await (0,s.Vx)((0,s.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var t;let l=null===(t=null==e?void 0:e.filter(e=>e.conv_uid===A))||void 0===t?void 0:t[0];(null==l?void 0:l.select_param)&&S(JSON.parse(null==l?void 0:l.select_param))}});(0,p.useEffect)(()=>{m&&x&&v.length&&z({chat_scene:m,app_code:x})},[x,m,z,v]),(0,p.useEffect)(()=>{x&&V()},[x]),(0,p.useEffect)(()=>{if(v.length>0){var e,t,l;let a=null===(e=null==M?void 0:null===(t=M.param_need)||void 0===t?void 0:t.filter(e=>"model"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;w(a||v[0])}},[v,M]),(0,p.useEffect)(()=>{var e,t,l;let a=null===(e=null==M?void 0:null===(t=M.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;Z(a||.5)},[M]),(0,p.useEffect)(()=>{if(m&&(null==M?void 0:M.app_code)){var e,t,l,a,n,s;let r=null===(e=null==M?void 0:null===(t=M.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value,i=null===(a=null==M?void 0:null===(n=M.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.bind_value;i&&S(i),["database","knowledge","plugin","awel_flow"].includes(r)&&!i&&H()}},[M,m,H]);let W=async e=>{var t,l,a;P(""),R.current=new AbortController;let n={chat_mode:m,model_name:N,user_input:e||T,conv_uid:A,temperature:k,app_code:null==M?void 0:M.app_code,...C&&{select_param:C}};if(b&&b.length>0){let e=null==b?void 0:b.filter(e=>"view"===e.role);D.current=e[e.length-1].order+1}let s=[{role:"human",context:e||T,model_name:N,order:D.current,time_stamp:0},{role:"view",context:"",model_name:N,order:D.current,time_stamp:0,thinking:!0}],r=s.length-1;y([...b,...s]),U(!1);try{await (0,o.L)("".concat((t="http://127.0.0.1:5670",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[c.gp]:null!==(l=(0,i.n5)())&&void 0!==l?l:""},signal:R.current.signal,body:JSON.stringify(n),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===o.a)return},onclose(){var e;null===(e=R.current)||void 0===e||e.abort(),U(!0),F(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(U(!0),F(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(s[r].context=null==t?void 0:t.replace("[ERROR]",""),s[r].thinking=!1,y([...b,...s]),U(!0),F(!1)):(F(!0),s[r].context=t,s[r].thinking=!1,y([...b,...s]))}})}catch(e){null===(a=R.current)||void 0===a||a.abort(),s[r].context="Sorry, we meet some error, please try again later.",s[r].thinking=!1,y([...s]),U(!0),F(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&J()},[m,J]),(0,a.jsx)(_.Provider,{value:{model:N,resource:C,setModel:w,setTemperature:Z,setResource:S,temperature:k,appInfo:M,conv_uid:A,scene:m,history:b,scrollViewRef:I,setHistory:y,resourceList:Y,order:D,handleChat:W,setCanNewChat:U,ctrl:R,canAbort:E,setCarAbort:F,canNewChat:q,userInput:T,setUserInput:P,getChatHistoryRun:V},children:(0,a.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:L||G||$||K,children:(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,a.jsxs)("div",{ref:I,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,a.jsx)(f.default,{}),(0,a.jsx)(g,{})]}),(null==M?void 0:M.app_code)&&(0,a.jsx)(j.default,{})]})})})}},30764:function(){}},function(e){e.O(0,[3662,7034,8674,930,3166,2837,2168,8163,7126,2648,3791,2913,5278,4330,8791,5030,5418,4041,2398,9859,3799,2684,1300,4567,7665,9773,3457,4035,6624,4705,9202,5782,8914,4994,8709,9256,9774,2888,179],function(){return e(e.s=45629)}),_N_E=e.O()}]);