(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{27704:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var l=a(87462),s=a(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"},r=a(13401),i=s.forwardRef(function(e,t){return s.createElement(r.Z,(0,l.Z)({},e,{ref:t,icon:n}))})},36531:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var l=a(87462),s=a(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},r=a(13401),i=s.forwardRef(function(e,t){return s.createElement(r.Z,(0,l.Z)({},e,{ref:t,icon:n}))})},79090:function(e,t,a){"use strict";var l=a(87462),s=a(67294),n=a(15294),r=a(13401),i=s.forwardRef(function(e,t){return s.createElement(r.Z,(0,l.Z)({},e,{ref:t,icon:n.Z}))});t.Z=i},2093:function(e,t,a){"use strict";var l=a(97582),s=a(67294),n=a(92770);t.Z=function(e,t){(0,s.useEffect)(function(){var t=e(),a=!1;return!function(){(0,l.mG)(this,void 0,void 0,function(){return(0,l.Jh)(this,function(e){switch(e.label){case 0:if(!(0,n.mf)(t[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,t.next()];case 2:if(e.sent().done||a)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,t];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){a=!0}},t)}},25606:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return a(65064)}])},45247:function(e,t,a){"use strict";var l=a(85893),s=a(79090);t.Z=function(e){let{visible:t}=e;return t?(0,l.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,l.jsx)(s.Z,{})}):null}},1771:function(e,t,a){"use strict";var l=a(85893);a(67294);var s=a(28459),n=a(11941),r=a(36609),i=a(41156),c=a(9641),d=a(16165),o=a(9020),m=a(92962),u=a(38545),h=a(50067),x=a(82353),p=a(11163);a(53878),t.Z=function(e){let{children:t}=e,a=[{key:"app",name:(0,r.t)("App"),path:"/app",icon:(0,l.jsx)(i.Z,{})},{key:"flow",name:(0,r.t)("awel_flow"),icon:(0,l.jsx)(c.Z,{}),path:"/flow"},{key:"models",name:(0,r.t)("model_manage"),path:"/models",icon:(0,l.jsx)(d.Z,{component:x.IN})},{key:"database",name:(0,r.t)("Database"),icon:(0,l.jsx)(o.Z,{}),path:"/database"},{key:"knowledge",name:(0,r.t)("Knowledge_Space"),icon:(0,l.jsx)(m.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,r.t)("Prompt"),icon:(0,l.jsx)(u.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,r.t)("dbgpts_community"),path:"/dbgpts",icon:(0,l.jsx)(h.Z,{})}],f=(0,p.useRouter)(),b=f.pathname.split("/")[2];return window.matchMedia("(prefers-color-scheme: dark)").matches,(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsx)(s.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)(n.Z,{activeKey:b,items:a.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{f.push("/construct/".concat(e))}})})})}},65064:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R},isFileDb:function(){return q}});var l=a(85893),s=a(1771),n=a(41468),r=a(76212),i=a(45247),c=a(67294),d=a(66309),o=a(55241),m=a(83062),u=a(93967),h=a.n(u),x=a(25675),p=a.n(x),f=(0,c.memo)(function(e){let{icon:t,iconBorder:a=!0,title:s,desc:n,tags:r,children:i,disabled:u,operations:x,className:f,extraContent:b,...j}=e,v=(0,c.useMemo)(()=>t?"string"==typeof t?(0,l.jsx)(p(),{className:h()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":a}),width:48,height:48,src:t,alt:s}):t:null,[t]),y=(0,c.useMemo)(()=>r&&r.length?(0,l.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:r.map((e,t)=>{var a;return"string"==typeof e?(0,l.jsx)(d.Z,{className:"text-xs",bordered:!1,color:"default",children:e},t):(0,l.jsx)(d.Z,{className:"text-xs",bordered:null!==(a=e.border)&&void 0!==a&&a,color:e.color,children:e.text},t)})}):null,[r]);return(0,l.jsxs)("div",{className:h()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":u,"cursor-pointer":!u&&!!j.onClick},f),...j,children:[(0,l.jsxs)("div",{className:"p-4 0",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[v,(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)(o.Z,{title:s,children:(0,l.jsx)("h2",{className:"text-sm font-semibold line-clamp-1 pr-8",children:s})}),y]})]}),n&&(0,l.jsx)(m.Z,{title:n,children:(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:n})})]}),(0,l.jsxs)("div",{children:[i,x&&!!x.length&&(0,l.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:x.map((e,t)=>(0,l.jsx)(m.Z,{title:e.label,children:(0,l.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:t=>{var a;t.stopPropagation(),null===(a=e.onClick)||void 0===a||a.call(e)},children:[e.children,t<x.length-1&&(0,l.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(t)))})]}),(0,l.jsx)("div",{className:"absolute top-2 right-4 ",children:b})]})}),b=a(8232),j=a(45360),v=a(85576),y=a(34041),g=a(74330),_=a(55102),N=a(73320),w=a(14726),Z=a(67421),k=a(85980),C=function(e){let{open:t,choiceDBType:a,dbTypeList:s,editValue:n,dbNames:i,onClose:d,onSuccess:o}=e,[u,h]=(0,c.useState)(!1),{t:x}=(0,Z.$G)(),[p]=b.default.useForm(),f=b.default.useWatch("db_type",p),[C,P]=(0,c.useState)([]),[S,F]=(0,c.useState)(!1),E=(0,c.useMemo)(()=>q(s,f),[s,f]);(0,c.useEffect)(()=>{a&&p.setFieldValue("db_type",a)},[a]),(0,c.useEffect)(()=>{n&&(p.setFieldsValue({...n}),"omc"===n.db_type&&p.setFieldValue("db_arn",n.db_path))},[n]),(0,c.useEffect)(()=>{t||p.resetFields()},[t]);let V=async e=>{let{db_host:t,db_path:a,db_port:l,db_type:s,...c}=e;if(h(!0),"omc"===s){let t=null==C?void 0:C.find(t=>t.arn===e.db_name);try{let[a]=await (0,r.Vx)((0,r.Jm)({db_type:"omc",file_path:e.db_arn||"",comment:e.comment,db_name:(null==t?void 0:t.dbName)||e.db_name}));if(a){j.ZP.error(a.message);return}j.ZP.success("success"),null==o||o()}catch(e){j.ZP.error(e.message)}finally{h(!1)}}if(!n&&i.some(e=>e===c.db_name)){j.ZP.error("The database already exists!");return}let d={db_host:E?void 0:t,db_port:E?void 0:l,db_type:s,file_path:E?a:void 0,...c};try{let[e]=await (0,r.Vx)((0,r.KS)(d));if(e)return;let[t]=await (0,r.Vx)((n?r.mR:r.b_)(d));if(t){j.ZP.error(t.message);return}j.ZP.success("success"),null==o||o()}catch(e){j.ZP.error(e.message)}finally{h(!1)}};console.log(p.getFieldValue("db_type"));let{run:I}=(0,k.Z)(async e=>{F(!0);let[t,a=[]]=await (0,r.Vx)((0,r.bf)(e));F(!1),P(a.map(e=>({...e,label:e.dbName,value:e.arn})))},{wait:500});console.log("omcDBList",C);let T=(0,c.useMemo)(()=>!!n||!!a,[n,a]);return(0,l.jsx)(v.default,{open:t,width:800,title:x(n?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:d,children:(0,l.jsxs)(b.default,{form:p,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:V,children:[(0,l.jsx)(b.default.Item,{name:"db_type",label:"DB Type",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(y.default,{"aria-readonly":T,disabled:T,options:s})}),"omc"===p.getFieldValue("db_type")?(0,l.jsx)(b.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(y.default,{optionRender:(e,t)=>{let{index:a}=t,s=C[a];return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"text-[18px]",children:null==s?void 0:s.dbName}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"env: "}),(0,l.jsx)("span",{className:"text-gray-500",children:s.env})]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"account: "}),(0,l.jsx)("span",{className:"text-gray-500",children:s.account})]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"searchName: "}),(0,l.jsx)(m.Z,{title:s.searchName,children:(0,l.jsx)("span",{className:"text-gray-500",children:s.searchName})})]})]},e.value)},notFoundContent:S?(0,l.jsx)(g.Z,{size:"small"}):null,showSearch:!0,options:C,onSearch:I,onSelect:e=>{console.log(e,"searchName");let t=null==C?void 0:C.find(t=>t.value===e);p.setFieldsValue({db_arn:null==t?void 0:t.arn})}})}):(0,l.jsx)(b.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(_.default,{readOnly:!!n,disabled:!!n})}),!0===E&&(0,l.jsx)(b.default.Item,{name:"db_path",label:"Path",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(_.default,{})}),!1===E&&"omc"!==p.getFieldValue("db_type")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.default.Item,{name:"db_user",label:"Username",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(_.default,{})}),(0,l.jsx)(b.default.Item,{name:"db_pwd",label:"Password",className:"mb-6",rules:[{required:!1}],children:(0,l.jsx)(_.default,{type:"password"})}),(0,l.jsx)(b.default.Item,{name:"db_host",label:"Host",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(_.default,{})}),(0,l.jsx)(b.default.Item,{name:"db_port",label:"Port",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(N.Z,{min:1,step:1,max:65535})})]}),"omc"===p.getFieldValue("db_type")&&(0,l.jsx)(b.default.Item,{name:"db_arn",label:"Arn",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(_.default,{})}),(0,l.jsx)(b.default.Item,{name:"comment",label:"Remark",className:"mb-6",children:(0,l.jsx)(_.default,{})}),(0,l.jsxs)(b.default.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,l.jsx)(w.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:u,children:"Save"}),(0,l.jsx)(w.ZP,{size:"middle",onClick:d,children:"Cancel"})]})]})})},P=a(62418),S=a(51042),F=a(36531),E=a(27704),V=a(2093),I=a(40411),T=a(85265),D=a(4393),B=a(32983),M=a(11163);function q(e,t){var a;return null===(a=e.find(e=>e.value===t))||void 0===a?void 0:a.isFileDb}var R=function(){let{setCurrentDialogInfo:e}=(0,c.useContext)(n.p),{t}=(0,Z.$G)();(0,M.useRouter)();let[a,d]=(0,c.useState)([]),[o,m]=(0,c.useState)([]),[u,h]=(0,c.useState)(!1),[x,p]=(0,c.useState)({open:!1}),[b,y]=(0,c.useState)({open:!1}),g=async()=>{let[,e]=await (0,r.Vx)((0,r.t$)());m(null!=e?e:[])},_=async()=>{h(!0);let[,e]=await (0,r.Vx)((0,r.Bw)());d(null!=e?e:[]),h(!1)},N=(0,c.useMemo)(()=>{let e=o.map(e=>{let{db_type:t,is_file_db:a}=e;return{...P.S$[t],value:t,isFileDb:a}}),t=Object.keys(P.S$).filter(t=>!e.some(e=>e.value===t)).map(e=>({...P.S$[e],value:P.S$[e].label,disabled:!0}));return[...e,...t]},[o]),k=e=>{p({open:!0,info:e})},q=e=>{v.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(t,a)=>{try{let[l]=await (0,r.Vx)((0,r.J5)(e.db_name));if(l){j.ZP.error(l.message),a();return}j.ZP.success("success"),_(),t()}catch(e){a()}})})},R=(0,c.useMemo)(()=>{let e=N.reduce((e,t)=>(e[t.value]=a.filter(e=>e.db_type===t.value),e),{});return e},[a,N]);(0,V.Z)(async()=>{await _(),await g()},[]);let z=e=>{let t=a.filter(t=>t.db_type===e.value);y({open:!0,dbList:t,name:e.label,type:e.value})};return(0,l.jsx)(s.Z,{children:(0,l.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,l.jsx)(i.Z,{visible:u}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("div",{className:"flex items-center gap-4"}),(0,l.jsx)("div",{className:"flex items-center gap-4",children:(0,l.jsx)(w.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{p({open:!0})},children:t("Add_Datasource")})})]}),(0,l.jsx)("div",{className:"flex flex-wrap mx-[-8px] gap-2 md:gap-4",children:N.map(e=>{var t,a;return(0,l.jsx)(I.Z,{count:null===(t=R[e.value])||void 0===t?void 0:t.length,className:"min-h-fit",children:(0,l.jsx)(f,{className:"h-full",title:e.label,desc:null!==(a=e.desc)&&void 0!==a?a:"",disabled:e.disabled,icon:e.icon,onClick:()=>{e.disabled||z(e)}})},e.value)})}),(0,l.jsx)(C,{open:x.open,dbTypeList:N,choiceDBType:x.dbType,editValue:x.info,dbNames:a.map(e=>e.db_name),onSuccess:()=>{p({open:!1}),_()},onClose:()=>{p({open:!1})}}),(0,l.jsx)(T.Z,{title:b.name,placement:"right",onClose:()=>{y({open:!1})},open:b.open,children:b.type&&R[b.type]&&R[b.type].length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{p({open:!0,dbType:b.type})},children:"Create"}),R[b.type].map(e=>(0,l.jsxs)(D.Z,{title:e.db_name,extra:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(F.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{k(e)}}),(0,l.jsx)(E.Z,{style:{color:"#ff1b2e"},onClick:()=>{q(e)}})]}),className:"mb-4",children:[e.db_path?(0,l.jsxs)("p",{children:["path: ",e.db_path]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["host: ",e.db_host]}),(0,l.jsxs)("p",{children:["username: ",e.db_user]}),(0,l.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,l.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,l.jsx)(B.Z,{image:B.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(w.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{p({open:!0,dbType:b.type})},children:"Create Now"})})})]})})}},53878:function(){}},function(e){e.O(0,[2648,3791,4296,5102,3293,4330,4041,8232,1941,3320,5265,6261,4393,9774,2888,179],function(){return e(e.s=25606)}),_N_E=e.O()}]);