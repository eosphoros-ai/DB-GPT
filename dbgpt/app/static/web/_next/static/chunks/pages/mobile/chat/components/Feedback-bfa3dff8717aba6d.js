(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3602],{72161:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mobile/chat/components/Feedback",function(){return a(93597)}])},51310:function(e,t,a){"use strict";var n=a(88506);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(n.C9))&&void 0!==e?e:"")}},61977:function(e,t,a){"use strict";var n=a(96469),s=a(27250),c=a(23852),l=a.n(c),r=a(38497);t.Z=(0,r.memo)(e=>{let{width:t,height:a,model:c}=e,i=(0,r.useMemo)(()=>{let e=null==c?void 0:c.replaceAll("-","_").split("_")[0],t=Object.keys(s.Me);for(let a=0;a<t.length;a++){let n=t[a];if(null==e?void 0:e.includes(n))return s.Me[n]}return"/models/huggingface.svg"},[c]);return c?(0,n.jsx)(l(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:a||24,src:i,alt:"llm",priority:!0}):null})},26953:function(e,t,a){"use strict";var n=a(96469),s=a(67901),c=a(42834),l=a(38497);t.Z=e=>{let{width:t,height:a,scene:r}=e,i=(0,l.useCallback)(()=>{switch(r){case"chat_knowledge":return s.je;case"chat_with_db_execute":return s.zM;case"chat_excel":return s.DL;case"chat_with_db_qa":case"chat_dba":return s.RD;case"chat_dashboard":return s.In;case"chat_agent":return s.si;case"chat_normal":return s.O7;default:return}},[r]);return(0,n.jsx)(c.Z,{className:"w-".concat(t||7," h-").concat(a||7),component:i()})}},58526:function(e,t,a){"use strict";var n=a(96890);let s=(0,n.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});t.Z=s},39452:function(e,t,a){"use strict";a.r(t);var n=a(96469),s=a(51657),c=a(49030),l=a(71841),r=a(27691),i=a(38497);t.default=e=>{let{open:t,setFeedbackOpen:a,list:o,feedback:u,loading:d}=e,[x,p]=(0,i.useState)([]),[m,_]=(0,i.useState)("");return(0,n.jsx)(s.Z,{title:"你的反馈助我进步",placement:"bottom",open:t,onClose:()=>a(!1),destroyOnClose:!0,height:"auto",children:(0,n.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,n.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==o?void 0:o.map(e=>{let t=x.findIndex(t=>t.reason_type===e.reason_type)>-1;return(0,n.jsx)(c.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(t?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{p(t=>{let a=t.findIndex(t=>t.reason_type===e.reason_type);return a>-1?[...t.slice(0,a),...t.slice(a+1)]:[...t,e]})},children:e.reason},e.reason_type)})}),(0,n.jsx)(l.default.TextArea,{placeholder:"描述一下具体问题或更优的答案",className:"h-24 resize-none mb-2",value:m,onChange:e=>_(e.target.value.trim())}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(r.ZP,{className:"w-16 h-8",onClick:()=>{a(!1)},children:"取消"}),(0,n.jsx)(r.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=x.map(e=>e.reason_type);await (null==u?void 0:u({feedback_type:"unlike",reason_types:e,remark:m}))},loading:d,children:"确认"})]})]})})}},93597:function(e,t,a){"use strict";a.r(t);var n=a(96469),s=a(27623),c=a(16559),l=a(74552),r=a(67576),i=a(16602),o=a(95891),u=a(87674),d=a(27691),x=a(26869),p=a.n(x),m=a(93486),_=a.n(m),f=a(38497),h=a(29549),v=a(39452);t.default=e=>{var t;let{content:a,index:x,chatDialogRef:m}=e,{conv_uid:k,history:y,scene:g}=(0,f.useContext)(h.MobileChatContext),{message:w}=o.Z.useApp(),[b,j]=(0,f.useState)(!1),[C,N]=(0,f.useState)(null==a?void 0:null===(t=a.feedback)||void 0===t?void 0:t.feedback_type),[Z,S]=(0,f.useState)([]),O=async e=>{var t;let a=null==e?void 0:e.replace(/\trelations:.*/g,""),n=_()((null===(t=m.current)||void 0===t?void 0:t.textContent)||a);n?a?w.success("复制成功"):w.warning("内容复制为空"):w.error("复制失败")},{run:E,loading:I}=(0,i.Z)(async e=>await (0,s.Vx)((0,s.zx)({conv_uid:k,message_id:a.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,t]=e;N(null==t?void 0:t.feedback_type),w.success("反馈成功"),j(!1)}}),{run:M}=(0,i.Z)(async()=>await (0,s.Vx)((0,s.Ir)({conv_uid:k,message_id:(null==a?void 0:a.order)+""})),{manual:!0,onSuccess:e=>{let[,t]=e;t&&(N("none"),w.success("操作成功"))}}),{run:P}=(0,i.Z)(async()=>await (0,s.Vx)((0,s.Jr)()),{manual:!0,onSuccess:e=>{let[,t]=e;S(t||[]),t&&j(!0)}}),{run:z,loading:F}=(0,i.Z)(async()=>await (0,s.Vx)((0,s.Ty)({conv_id:k,round_index:0})),{manual:!0,onSuccess:()=>{w.success("操作成功")}});return(0,n.jsxs)("div",{className:"flex items-center text-sm",children:[(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(c.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"like"===C}),onClick:async()=>{if("like"===C){await M();return}await E({feedback_type:"like"})}}),(0,n.jsx)(l.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"unlike"===C}),onClick:async()=>{if("unlike"===C){await M();return}await P()}}),(0,n.jsx)(v.default,{open:b,setFeedbackOpen:j,list:Z,feedback:E,loading:I})]}),(0,n.jsx)(u.Z,{type:"vertical"}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(r.Z,{className:"cursor-pointer",onClick:()=>O(a.context)}),y.length-1===x&&"chat_agent"===g&&(0,n.jsx)(d.ZP,{loading:F,size:"small",onClick:async()=>{await z()},className:"text-xs",children:"终止话题"})]})]})}}},function(e){e.O(0,[2394,2003,5677,1841,2786,5722,5851,335,2818,3543,8639,3971,9549,9774,2888,179],function(){return e(e.s=72161)}),_N_E=e.O()}]);