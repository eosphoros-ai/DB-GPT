(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{46584:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var s=a(42096),l=a(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"},r=a(55032),c=l.forwardRef(function(e,t){return l.createElement(r.Z,(0,s.Z)({},e,{ref:t,icon:n}))})},55861:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var s=a(42096),l=a(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},r=a(55032),c=l.forwardRef(function(e,t){return l.createElement(r.Z,(0,s.Z)({},e,{ref:t,icon:n}))})},77200:function(e,t,a){"use strict";var s=a(33587),l=a(38497),n=a(60654);t.Z=function(e,t){(0,l.useEffect)(function(){var t=e(),a=!1;return!function(){(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:if(!(0,n.mf)(t[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,t.next()];case 2:if(e.sent().done||a)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,t];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){a=!0}},t)}},77023:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return a(91552)}])},18458:function(e,t,a){"use strict";var s=a(96469),l=a(37022);t.Z=function(e){let{visible:t}=e;return t?(0,s.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,s.jsx)(l.Z,{})}):null}},26953:function(e,t,a){"use strict";var s=a(96469),l=a(67901),n=a(42834),r=a(38497);t.Z=e=>{let{width:t,height:a,scene:c}=e,i=(0,r.useCallback)(()=>{switch(c){case"chat_knowledge":return l.je;case"chat_with_db_execute":return l.zM;case"chat_excel":return l.DL;case"chat_with_db_qa":case"chat_dba":return l.RD;case"chat_dashboard":return l.In;case"chat_agent":return l.si;case"chat_normal":return l.O7;default:return}},[c]);return(0,s.jsx)(n.Z,{className:"w-".concat(t||7," h-").concat(a||7),component:i()})}},52903:function(e,t,a){"use strict";a.d(t,{TH:function(){return x},ZS:function(){return b}});var s=a(96469),l=a(52896),n=a(60205),r=a(87674),c=a(85851),i=a(80335),d=a(26869),o=a.n(d),u=a(83930),m=a(23852),h=a.n(m);a(38497);var p=a(26953);a(96768);let x=e=>{let{onClick:t,Icon:a="/pictures/card_chat.png",text:l=(0,u.t)("start_chat")}=e;return"string"==typeof a&&(a=(0,s.jsx)(h(),{src:a,alt:a,width:17,height:15})),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[a,(0,s.jsx)("span",{children:l})]})},b=e=>{let{menu:t}=e;return(0,s.jsx)(i.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,s.jsx)(l.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:a,LeftBottom:l,RightBottom:i,onClick:d,rightTopHover:u=!0,logo:m,name:x,description:b,className:f,scene:j,code:_}=e;return"string"==typeof b&&(b=(0,s.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:b})),(0,s.jsx)("div",{className:o()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",f),children:(0,s.jsxs)("div",{onClick:d,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,s.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:j?(0,s.jsx)(p.Z,{scene:j,width:14,height:14}):m&&(0,s.jsx)(h(),{src:m,width:44,height:44,alt:x,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,s.jsx)("div",{className:"flex-1",children:x.length>6?(0,s.jsx)(n.Z,{title:x,children:(0,s.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})}):(0,s.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})})]}),(0,s.jsx)("span",{className:o()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),b,(0,s.jsx)("div",{className:"relative bottom-2",children:a}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{children:l}),(0,s.jsx)("div",{children:i})]}),_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z,{className:"my-3"}),(0,s.jsx)(c.Z.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:_})]})]})})}},86059:function(e,t,a){"use strict";var s=a(96469);a(38497);var l=a(42518),n=a(5996),r=a(83930),c=a(31183),i=a(51382),d=a(42834),o=a(43738),u=a(92026),m=a(61760),h=a(94918),p=a(67901),x=a(87313);a(41748),t.Z=function(e){let{children:t}=e,a=[{key:"app",name:(0,r.t)("App"),path:"/app",icon:(0,s.jsx)(c.Z,{})},{key:"flow",name:(0,r.t)("awel_flow"),icon:(0,s.jsx)(i.Z,{}),path:"/flow"},{key:"models",name:(0,r.t)("model_manage"),path:"/models",icon:(0,s.jsx)(d.Z,{component:p.IN})},{key:"database",name:(0,r.t)("Database"),icon:(0,s.jsx)(o.Z,{}),path:"/database"},{key:"knowledge",name:(0,r.t)("Knowledge_Space"),icon:(0,s.jsx)(u.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,r.t)("Prompt"),icon:(0,s.jsx)(m.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,r.t)("dbgpts_community"),path:"/dbgpts",icon:(0,s.jsx)(h.Z,{})}],b=(0,x.useRouter)(),f=b.pathname.split("/")[2];return window.matchMedia("(prefers-color-scheme: dark)").matches,(0,s.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,s.jsx)(l.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,s.jsx)(n.Z,{activeKey:f,items:a.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{b.push("/construct/".concat(e))}})})})}},91552:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return V},isFileDb:function(){return E}});var s=a(96469),l=a(52903),n=a(86059),r=a(45277),c=a(27623),i=a(18458),d=a(55360),o=a(70351),u=a(79839),m=a(39069),h=a(60205),p=a(42786),x=a(71841),b=a(91103),f=a(27691),j=a(38497),_=a(56841),v=a(47019),g=function(e){let{open:t,choiceDBType:a,dbTypeList:l,editValue:n,dbNames:r,onClose:i,onSuccess:g}=e,[y,w]=(0,j.useState)(!1),{t:N}=(0,_.$G)(),[Z]=d.default.useForm(),k=d.default.useWatch("db_type",Z),[C,P]=(0,j.useState)([]),[S,F]=(0,j.useState)(!1),T=(0,j.useMemo)(()=>E(l,k),[l,k]);(0,j.useEffect)(()=>{a&&Z.setFieldValue("db_type",a)},[a]),(0,j.useEffect)(()=>{n&&(Z.setFieldsValue({...n}),"omc"===n.db_type&&Z.setFieldValue("db_arn",n.db_path))},[n]),(0,j.useEffect)(()=>{t||Z.resetFields()},[t]);let V=async e=>{let{db_host:t,db_path:a,db_port:s,db_type:l,...i}=e;if(w(!0),"omc"===l){let t=null==C?void 0:C.find(t=>t.arn===e.db_name);try{let[a]=await (0,c.Vx)((0,c.Jm)({db_type:"omc",file_path:e.db_arn||"",comment:e.comment,db_name:(null==t?void 0:t.dbName)||e.db_name}));if(a){o.ZP.error(a.message);return}o.ZP.success("success"),null==g||g()}catch(e){o.ZP.error(e.message)}finally{w(!1)}}if(!n&&r.some(e=>e===i.db_name)){o.ZP.error("The database already exists!");return}let d={db_host:T?void 0:t,db_port:T?void 0:s,db_type:l,file_path:T?a:void 0,...i};try{let[e]=await (0,c.Vx)((0,c.KS)(d));if(e)return;let[t]=await (0,c.Vx)((n?c.mR:c.b_)(d));if(t){o.ZP.error(t.message);return}o.ZP.success("success"),null==g||g()}catch(e){o.ZP.error(e.message)}finally{w(!1)}};console.log(Z.getFieldValue("db_type"));let{run:D}=(0,v.Z)(async e=>{F(!0);let[t,a=[]]=await (0,c.Vx)((0,c.bf)(e));F(!1),P(a.map(e=>({...e,label:e.dbName,value:e.arn})))},{wait:500});console.log("omcDBList",C);let I=(0,j.useMemo)(()=>!!n||!!a,[n,a]);return(0,s.jsx)(u.default,{open:t,width:800,title:N(n?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:i,children:(0,s.jsxs)(d.default,{form:Z,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:V,children:[(0,s.jsx)(d.default.Item,{name:"db_type",label:"DB Type",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(m.default,{"aria-readonly":I,disabled:I,options:l})}),"omc"===Z.getFieldValue("db_type")?(0,s.jsx)(d.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(m.default,{optionRender:(e,t)=>{let{index:a}=t,l=C[a];return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[18px]",children:null==l?void 0:l.dbName}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"env: "}),(0,s.jsx)("span",{className:"text-gray-500",children:l.env})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"account: "}),(0,s.jsx)("span",{className:"text-gray-500",children:l.account})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"searchName: "}),(0,s.jsx)(h.Z,{title:l.searchName,children:(0,s.jsx)("span",{className:"text-gray-500",children:l.searchName})})]})]},e.value)},notFoundContent:S?(0,s.jsx)(p.Z,{size:"small"}):null,showSearch:!0,options:C,onSearch:D,onSelect:e=>{console.log(e,"searchName");let t=null==C?void 0:C.find(t=>t.value===e);Z.setFieldsValue({db_arn:null==t?void 0:t.arn})}})}):(0,s.jsx)(d.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(x.default,{readOnly:!!n,disabled:!!n})}),!0===T&&(0,s.jsx)(d.default.Item,{name:"db_path",label:"Path",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(x.default,{})}),!1===T&&"omc"!==Z.getFieldValue("db_type")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.default.Item,{name:"db_user",label:"Username",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(x.default,{})}),(0,s.jsx)(d.default.Item,{name:"db_pwd",label:"Password",className:"mb-6",rules:[{required:!1}],children:(0,s.jsx)(x.default,{type:"password"})}),(0,s.jsx)(d.default.Item,{name:"db_host",label:"Host",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(x.default,{})}),(0,s.jsx)(d.default.Item,{name:"db_port",label:"Port",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(b.Z,{min:1,step:1,max:65535})})]}),"omc"===Z.getFieldValue("db_type")&&(0,s.jsx)(d.default.Item,{name:"db_arn",label:"Arn",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(x.default,{})}),(0,s.jsx)(d.default.Item,{name:"comment",label:"Remark",className:"mb-6",children:(0,s.jsx)(x.default,{})}),(0,s.jsxs)(d.default.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,s.jsx)(f.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:y,children:"Save"}),(0,s.jsx)(f.ZP,{size:"middle",onClick:i,children:"Cancel"})]})]})})},y=a(7289),w=a(97511),N=a(55861),Z=a(46584),k=a(77200),C=a(49030),P=a(51657),S=a(67343),F=a(97818),T=a(87313);function E(e,t){var a;return null===(a=e.find(e=>e.value===t))||void 0===a?void 0:a.isFileDb}var V=function(){let{setCurrentDialogInfo:e}=(0,j.useContext)(r.p),{t}=(0,_.$G)(),a=(0,T.useRouter)(),[d,m]=(0,j.useState)([]),[h,p]=(0,j.useState)([]),[x,b]=(0,j.useState)(!1),[v,E]=(0,j.useState)({open:!1}),[V,D]=(0,j.useState)({open:!1}),I=async()=>{let[,e]=await (0,c.Vx)((0,c.t$)());p(null!=e?e:[])},B=async()=>{b(!0);let[,e]=await (0,c.Vx)((0,c.Bw)());m(null!=e?e:[]),b(!1)},R=(0,j.useMemo)(()=>{let e=h.map(e=>{let{db_type:t,is_file_db:a}=e;return{...y.S$[t],value:t,isFileDb:a}}),t=Object.keys(y.S$).filter(t=>!e.some(e=>e.value===t)).map(e=>({...y.S$[e],value:y.S$[e].label,disabled:!0}));return[...e,...t]},[h]),q=e=>{E({open:!0,info:e})},H=e=>{u.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(t,a)=>{try{let[s]=await (0,c.Vx)((0,c.J5)(e.db_name));if(s){o.ZP.error(s.message),a();return}o.ZP.success("success"),B(),t()}catch(e){a()}})})},z=(0,j.useMemo)(()=>{let e=R.reduce((e,t)=>(e[t.value]=d.filter(e=>e.db_type===t.value),e),{});return e},[d,R]);(0,k.Z)(async()=>{await B(),await I()},[]);let M=async t=>{let[s,l]=await (0,c.Vx)((0,c.sW)({chat_mode:"chat_with_db_execute"}));(null==l?void 0:l.conv_uid)&&(null==e||e({chat_scene:l.chat_mode,app_code:l.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:l.chat_mode,app_code:l.chat_mode})),a.push("/chat?scene=chat_with_db_execute&id=".concat(null==l?void 0:l.conv_uid,"&db_name=").concat(t.db_name)))};return(0,s.jsx)(n.Z,{children:(0,s.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,s.jsx)(i.Z,{visible:x}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("div",{className:"flex items-center gap-4"}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)(f.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,s.jsx)(w.Z,{}),onClick:()=>{E({open:!0})},children:t("Add_Datasource")})})]}),(0,s.jsx)("div",{className:"flex flex-wrap mx-[-8px]",children:d.map(e=>{var a;let n=R.find(t=>{var a;return(null==t?void 0:null===(a=t.value)||void 0===a?void 0:a.toLowerCase())===e.db_type});return(0,s.jsx)(l.ZP,{description:null!==(a=e.db_path)&&void 0!==a?a:"",name:e.db_name,logo:null==n?void 0:n.icon,RightTop:(0,s.jsx)(l.ZS,{menu:{items:[{key:"del",label:(0,s.jsx)("span",{className:"text-red-400",onClick:()=>{H(e)},children:t("Delete_Btn")})}]}}),rightTopHover:!1,Tags:(0,s.jsx)("div",{children:(0,s.jsx)(C.Z,{children:e.db_type})}),RightBottom:(0,s.jsx)(l.TH,{text:t("start_chat"),onClick:()=>{M(e)}}),onClick:()=>{q(e)}},e.db_name)})}),(0,s.jsx)(g,{open:v.open,dbTypeList:R,choiceDBType:v.dbType,editValue:v.info,dbNames:d.map(e=>e.db_name),onSuccess:()=>{E({open:!1}),B()},onClose:()=>{E({open:!1})}}),(0,s.jsx)(P.Z,{title:V.name,placement:"right",onClose:()=>{D({open:!1})},open:V.open,children:V.type&&z[V.type]&&z[V.type].length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,s.jsx)(w.Z,{}),onClick:()=>{E({open:!0,dbType:V.type})},children:"Create"}),z[V.type].map(e=>(0,s.jsxs)(S.Z,{title:e.db_name,extra:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{q(e)}}),(0,s.jsx)(Z.Z,{style:{color:"#ff1b2e"},onClick:()=>{H(e)}})]}),className:"mb-4",children:[e.db_path?(0,s.jsxs)("p",{children:["path: ",e.db_path]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["host: ",e.db_host]}),(0,s.jsxs)("p",{children:["username: ",e.db_user]}),(0,s.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,s.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,s.jsx)(F.Z,{image:F.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(f.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(w.Z,{}),onClick:()=>{E({open:!0,dbType:V.type})},children:"Create Now"})})})]})})}},96768:function(){},41748:function(){}},function(e){e.O(0,[2394,2003,5677,1841,5722,5851,2786,335,9069,5360,5996,1103,1657,5755,7343,9774,2888,179],function(){return e(e.s=77023)}),_N_E=e.O()}]);