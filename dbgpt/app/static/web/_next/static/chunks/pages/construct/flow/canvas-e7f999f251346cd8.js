(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1767],{94617:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/flow/canvas",function(){return l(80053)}])},45247:function(e,t,l){"use strict";var a=l(85893),r=l(79090);t.Z=function(e){let{visible:t}=e;return t?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(r.Z,{})}):null}},99743:function(e,t,l){"use strict";var a=l(85893);l(67294);var r=l(36851);t.Z=e=>{let{id:t,sourceX:l,sourceY:s,targetX:n,targetY:o,sourcePosition:i,targetPosition:d,style:c={},data:u,markerEnd:p}=e,[f,m,x]=(0,r.OQ)({sourceX:l,sourceY:s,sourcePosition:i,targetX:n,targetY:o,targetPosition:d}),h=(0,r._K)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.u5,{id:t,style:c,path:f,markerEnd:p}),(0,a.jsx)("foreignObject",{width:40,height:40,x:m-20,y:x-20,className:"bg-transparent w-10 h-10 relative",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,a.jsx)("button",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-stone-400 dark:bg-zinc-700 cursor-pointer text-sm",onClick:e=>{e.stopPropagation(),h.setEdges(h.getEdges().filter(e=>e.id!==t))},children:"\xd7"})})]})}},80053:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return eq}});var a=l(85893),r=l(76212),s=l(45247),n=l(41468),o=l(14313),i=l(94155),d=l(55102),c=l(21612),u=l(40411),p=l(42075),f=l(47221),m=l(67294),x=l(67421),h=l(2487),v=l(7134),j=l(32983),g=e=>{let{nodes:t}=e,{t:l}=(0,x.$G)();return(null==t?void 0:t.length)>0?(0,a.jsx)(h.Z,{className:"overflow-hidden overflow-y-auto w-full",size:"small",itemLayout:"horizontal",dataSource:t,renderItem:e=>(0,a.jsx)(h.Z.Item,{className:"cursor-move hover:bg-[#F1F5F9] dark:hover:bg-theme-dark p-0 py-2",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow",JSON.stringify(e)),t.dataTransfer.effectAllowed="move"},children:(0,a.jsx)(h.Z.Item.Meta,{className:"flex items-center justify-center",avatar:(0,a.jsx)(v.C,{src:"/icons/node/vis.png",size:"large"}),title:(0,a.jsx)("p",{className:"line-clamp-1 font-medium",children:e.label}),description:(0,a.jsx)("p",{className:"line-clamp-2",children:e.description})})})}):(0,a.jsx)(j.Z,{className:"px-2",description:l("no_node")})},b=l(62418);let{Search:w}=d.default,{Sider:_}=c.default,y={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8};var N=()=>{let{t:e}=(0,x.$G)(),{mode:t}=(0,m.useContext)(n.p),[l,s]=(0,m.useState)(!1),[d,c]=(0,m.useState)(""),[h,v]=(0,m.useState)([]),[j,N]=(0,m.useState)([]),[Z,k]=(0,m.useState)([]),[C,P]=(0,m.useState)([]);async function I(){let[e,t]=await (0,r.Vx)((0,r.As)());if(t&&t.length>0){localStorage.setItem(b.zN,JSON.stringify(t));let e=t.filter(e=>"operator"===e.flow_type),l=t.filter(e=>"resource"===e.flow_type);v(e),N(l),k(F(e)),P(F(l))}}(0,m.useEffect)(()=>{I()},[]);let S=(0,m.useMemo)(()=>l?{...y,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...y,borderLeft:"1px solid #d6d8da"},[l]);function F(e){let t=[],l={};return e.forEach(e=>{let{category:a,category_label:r}=e;l[a]||(l[a]={category:a,categoryLabel:r,nodes:[]},t.push(l[a])),l[a].nodes.push(e)}),t}let E=(0,m.useMemo)(()=>{if(!d)return Z.map(e=>{let{category:t,categoryLabel:l,nodes:r}=e;return{key:t,label:l,children:(0,a.jsx)(g,{nodes:r}),extra:(0,a.jsx)(u.Z,{showZero:!0,count:r.length||0,style:{backgroundColor:r.length>0?"#52c41a":"#7f9474"}})}});{let e=h.filter(e=>e.label.toLowerCase().includes(d.toLowerCase()));return F(e).map(e=>{let{category:t,categoryLabel:l,nodes:r}=e;return{key:t,label:l,children:(0,a.jsx)(g,{nodes:r}),extra:(0,a.jsx)(u.Z,{showZero:!0,count:r.length||0,style:{backgroundColor:r.length>0?"#52c41a":"#7f9474"}})}})}},[Z,d]),z=(0,m.useMemo)(()=>{if(!d)return C.map(e=>{let{category:t,categoryLabel:l,nodes:r}=e;return{key:t,label:l,children:(0,a.jsx)(g,{nodes:r}),extra:(0,a.jsx)(u.Z,{showZero:!0,count:r.length||0,style:{backgroundColor:r.length>0?"#52c41a":"#7f9474"}})}});{let e=j.filter(e=>e.label.toLowerCase().includes(d.toLowerCase()));return F(e).map(e=>{let{category:t,categoryLabel:l,nodes:r}=e;return{key:t,label:l,children:(0,a.jsx)(g,{nodes:r}),extra:(0,a.jsx)(u.Z,{showZero:!0,count:r.length||0,style:{backgroundColor:r.length>0?"#52c41a":"#7f9474"}})}})}},[C,d]);return(0,a.jsx)(_,{className:"flex justify-center items-start nodrag bg-[#ffffff80] border-r border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:t,width:280,collapsible:!0,collapsed:l,collapsedWidth:0,trigger:l?(0,a.jsx)(o.Z,{className:"text-base"}):(0,a.jsx)(i.Z,{className:"text-base"}),zeroWidthTriggerStyle:S,onCollapse:e=>s(e),children:(0,a.jsxs)(p.Z,{direction:"vertical",className:"w-[280px] pt-4 px-4 overflow-hidden overflow-y-auto scrollbar-default",children:[(0,a.jsx)("p",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] line-clamp-1",children:e("add_node")}),(0,a.jsx)(w,{placeholder:"Search node",onSearch:function(e){c(e)},allowClear:!0}),(0,a.jsx)("h2",{className:"font-semibold",children:e("operators")}),(0,a.jsx)(f.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:E}),(0,a.jsx)("h2",{className:"font-semibold",children:e("resource")}),(0,a.jsx)(f.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:z})]})})},Z=l(99743),k=l(25675),C=l.n(k),P=l(8232),I=l(73320),S=l(34041),F=l(84567),E=l(45360),z=l(91776),O=l(86738),V=l(83062),A=l(36851),T=e=>{let{optional:t}=e;return t?null:(0,a.jsx)("span",{className:"text-red-600 align-middle inline-block",children:"\xa0*"})},D=l(51042),L=l(45605),M=l(93967),B=l.n(M),G=e=>{let{node:t,data:l,type:r,label:s,index:n}=e,{t:o}=(0,x.$G)(),i=(0,A._K)(),[d,c]=m.useState([]);function u(){let e=localStorage.getItem(b.zN);if(!e)return;let a=JSON.parse(e),r=l.type_cls,n=[];"inputs"===s?n=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.outputs)||void 0===t?void 0:t.some(e=>e.type_cls===r&&e.is_list===(null==l?void 0:l.is_list))}):"parameters"===s?n=a.filter(e=>"resource"===e.flow_type).filter(e=>{var t;return null===(t=e.parent_cls)||void 0===t?void 0:t.includes(r)}):"outputs"===s&&("operator"===t.flow_type?n=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.inputs)||void 0===t?void 0:t.some(e=>e.type_cls===r&&e.is_list===(null==l?void 0:l.is_list))}):"resource"===t.flow_type&&(n=a.filter(e=>{var l,a;return(null===(l=e.inputs)||void 0===l?void 0:l.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))||(null===(a=e.parameters)||void 0===a?void 0:a.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))}))),c(n)}return(0,a.jsxs)("div",{className:B()("relative flex items-center",{"justify-start":"parameters"===s||"inputs"===s,"justify-end":"outputs"===s}),children:[(0,a.jsx)(A.HH,{className:B()("w-2 h-2","source"===r?"-mr-4":"-ml-4"),type:r,position:"source"===r?A.Ly.Right:A.Ly.Left,id:"".concat(t.id,"|").concat(s,"|").concat(n),isValidConnection:e=>(function(e){let{sourceHandle:t,targetHandle:l,source:a,target:r}=e,s=i.getNode(a),n=i.getNode(r),{flow_type:d}=null==s?void 0:s.data,{flow_type:c}=null==n?void 0:n.data,u=null==t?void 0:t.split("|")[1],p=null==l?void 0:l.split("|")[1],f=null==t?void 0:t.split("|")[2],m=null==l?void 0:l.split("|")[2],x=null==n?void 0:n.data[p][m].type_cls;if(d===c&&"operator"===d){let e=null==s?void 0:s.data[u][f].type_cls,t=null==s?void 0:s.data[u][f].is_list,l=null==n?void 0:n.data[p][m].is_list;return e===x&&t===l}if("resource"===d&&("operator"===c||"resource"===c)){let e=null==s?void 0:s.data.parent_cls;return e.includes(x)}return E.ZP.warning(o("connect_warning")),!1})(e)}),(0,a.jsxs)(z.Z,{className:B()("bg-white dark:bg-[#232734] w-full px-2 py-1 rounded text-neutral-500",{"text-right":"outputs"===s}),children:[(0,a.jsx)(O.Z,{placement:"left",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(g,{nodes:d})}),children:["inputs","parameters"].includes(s)&&(0,a.jsx)(D.Z,{className:"cursor-pointer",onClick:u})}),"outputs"!==s&&(0,a.jsx)(T,{optional:l.optional}),l.type_name,l.description&&(0,a.jsx)(V.Z,{title:l.description,children:(0,a.jsx)(L.Z,{className:"ml-2 cursor-pointer"})}),(0,a.jsx)(O.Z,{placement:"right",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(g,{nodes:d})}),children:["outputs"].includes(s)&&(0,a.jsx)(D.Z,{className:"ml-2 cursor-pointer",onClick:u})})]})]})},R=l(67919);let $=e=>{var t;let l=(0,R.It)((null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(S.default,{...l,className:"w-full nodrag",placeholder:"please select",options:e.options})};var q=l(3303);let U=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(q.Z,{...l,options:e.options,placeholder:"please select",className:"w-full nodrag"})};var J=l(60497);let K=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(J.default,{...l,className:"w-full",placeholder:"please select a date"})};var H=l(36832);let W=e=>{let t=e.match(/^icon:(\w+)$/);if(t){let e=t[1],l=H[e];return l?(0,a.jsx)(l,{}):null}return null},Y=e=>{var t,l,r;let s=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return s.prefix=W((null===(l=e.ui)||void 0===l?void 0:null===(r=l.attr)||void 0===r?void 0:r.prefix)||""),(0,a.jsx)(d.default,{...s,className:"w-full",placeholder:"please input",allowClear:!0})},X=e=>{var t,l;let r=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(null===(l=e.options)||void 0===l?void 0:l.length)>0&&(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(F.Z.Group,{...r,options:e.options})})};var Q=l(78045);let ee=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(Q.ZP.Group,{...l,options:e.options})})},{TextArea:et}=d.default,el=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(et,{className:"nowheel mb-3",...l})};var ea=l(30568);let er=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(a.Fragment,{children:e.is_list?(0,a.jsx)(ea.Z,{range:!0,className:"mt-8 nodrag",...l}):(0,a.jsx)(ea.Z,{className:"mt-8 nodrag",...l})})};var es=l(68351);let en=e=>{var t;let{data:l,formValuesChange:r}=e,s=(0,R.It)((null===(t=l.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(es.Z,{...s,onChange:(e,t)=>{r({time:t},{force:!0})},className:"w-full",placeholder:"please select a moment"})};var eo=l(59847);let ei=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eo.Z,{...l,className:"w-full nodrag",treeDefaultExpandAll:!0,treeData:e.options})};var ed=l(14726),ec=l(85576),eu=l(63764);let ep=e=>{var t,l,r,s,n,o,i,d;let{t:c}=(0,x.$G)(),u=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{}),[p,f]=(0,m.useState)(!1),h=(0,m.useMemo)(()=>{var t,l,a,r;return(null==e?void 0:null===(t=e.ui)||void 0===t?void 0:null===(l=t.editor)||void 0===l?void 0:l.width)?(null==e?void 0:null===(a=e.ui)||void 0===a?void 0:null===(r=a.editor)||void 0===r?void 0:r.width)+100:"80%"},[null==e?void 0:null===(l=e.ui)||void 0===l?void 0:null===(r=l.editor)||void 0===r?void 0:r.width]);return(0,a.jsxs)("div",{className:"p-2 text-sm",children:[(0,a.jsx)(ed.ZP,{type:"default",onClick:()=>{f(!0)},children:c("Open_Code_Editor")}),(0,a.jsx)(ec.default,{title:c("Code_Editor"),width:h,open:p,onOk:()=>{f(!1)},onCancel:()=>{f(!1)},children:(0,a.jsx)(P.default.Item,{name:null==e?void 0:e.name,children:(0,a.jsx)(eu.ZP,{...u,width:(null==e?void 0:null===(s=e.ui)||void 0===s?void 0:null===(n=s.editor)||void 0===n?void 0:n.width)||"100%",height:(null==e?void 0:null===(o=e.ui)||void 0===o?void 0:null===(i=o.editor)||void 0===i?void 0:i.height)||200,defaultLanguage:null==e?void 0:null===(d=e.ui)||void 0===d?void 0:d.language,theme:"vs-dark",options:{minimap:{enabled:!1},wordWrap:"on"}})})})]})};var ef=l(88484),em=l(2913),ex=l(83454);let eh=e=>{var t,l,r,s;let{t:n}=(0,x.$G)(),o=(0,m.useRef)([]),{data:i,formValuesChange:d}=e;P.default.useFormInstance();let c=(0,R.It)((null===(t=i.ui)||void 0===t?void 0:t.attr)||{}),[u,p]=(0,m.useState)(!1),[f,h]=(0,m.useState)(""),v=e=>{o.current.length===i.ui.attr.max_count&&o.current.pop(),o.current.push(e),1===i.ui.attr.max_count?d({file:o.current.toString()},{force:!0}):d({multiple_files:JSON.stringify(o.current)},{force:!0})},j=e=>{let t=o.current.indexOf(e.response.data[0].uri);-1!==t&&o.current.splice(t,1),1===i.ui.attr.max_count?d({file:o.current.toString()},{force:!0}):d({multiple_files:JSON.stringify(o.current)},{force:!0})},g={name:"files",action:ex.env.API_BASE_URL+i.ui.action,headers:{authorization:"authorization-text"},onChange(e){p(!0),e.file.status,"done"===e.file.status?(p(!1),E.ZP.success("".concat(e.file.response.data[0].file_name," ").concat(n("Upload_Data_Successfully"))),v(e.file.response.data[0].uri)):"error"===e.file.status&&(p(!1),E.ZP.error("".concat(e.file.response.data[0].file_name,"  ").concat(n("Upload_Data_Failed"))))}};return!f&&(null===(l=i.ui)||void 0===l?void 0:l.file_types)&&Array.isArray(null===(r=i.ui)||void 0===r?void 0:r.file_types)&&h(null===(s=i.ui)||void 0===s?void 0:s.file_types.toString()),(0,a.jsx)("div",{className:"p-2 text-sm text-center",children:i.is_list?(0,a.jsx)(em.default,{onRemove:j,...g,...c,multiple:!0,accept:f,children:(0,a.jsx)(ed.ZP,{loading:u,icon:(0,a.jsx)(ef.Z,{}),children:n("Upload_Data")})}):(0,a.jsx)(em.default,{onRemove:j,...g,...c,multiple:!1,accept:f,children:(0,a.jsx)(ed.ZP,{loading:u,icon:(0,a.jsx)(ef.Z,{}),children:n("Upload_Data")})})})},{Password:ev}=d.default,ej=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(ev,{...l,placeholder:"input password"})},eg=e=>{var t;let l=(0,R.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(d.default,{...l,className:"w-full",placeholder:"please input",allowClear:!0})};var eb=e=>{let{formValuesChange:t,node:l,paramData:r,label:s,index:n}=e;return"resource"===r.category?(0,a.jsx)(G,{node:l,data:r,type:"target",label:s,index:n}):"common"===r.category?(null==r?void 0:r.ui)?function(e,t){var l;let{refresh_depends:r,ui_type:s}=e.ui,n=null!==(l=e.value)&&void 0!==l?l:e.default;return"slider"===s&&e.is_list&&(n=[0,1]),(0,a.jsx)(P.default.Item,{className:"mb-2",initialValue:n,name:e.name,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),...r&&{dependencies:r},...e.description&&{tooltip:{title:e.description,icon:(0,a.jsx)(L.Z,{})}},children:function(e,t,l){switch(e){case"select":return $(t);case"cascader":return U(t);case"checkbox":return X(t);case"radio":return ee(t);case"input":return Y(t);case"text_area":return el(t);case"slider":return er(t);case"date_picker":return K(t);case"time_picker":return en({data:t,formValuesChange:l});case"tree_select":return ei(t);case"password":return ej(t);case"upload":return eh({data:t,formValuesChange:l});case"variables":return eg(t);case"code_editor":return ep(t);default:return null}}(s,e,t)})}(r,t):function(e){var t,l;let r=null!==(t=e.value)&&void 0!==t?t:e.default;switch(e.type_name){case"int":case"float":return(0,a.jsx)(P.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:r,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(L.Z,{})}:"",children:(0,a.jsx)(I.Z,{className:"w-full nodrag"})});case"str":return(0,a.jsx)(P.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:r,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(L.Z,{})}:"",children:(null===(l=e.options)||void 0===l?void 0:l.length)>0?(0,a.jsx)(S.default,{className:"w-full nodrag",options:e.options.map(e=>({label:e.label,value:e.value}))}):(0,a.jsx)(d.default,{className:"w-full"})});case"bool":return r="True"===(r="False"!==r&&r)||r,(0,a.jsx)(P.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:r,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(L.Z,{})}:"",children:(0,a.jsx)(F.Z,{className:"ml-2"})})}}(r):void 0},ew=l(55241),e_=l(85175),ey=l(82061),eN=e=>{let{children:t,className:l}=e;return(0,a.jsx)("div",{className:B()("flex justify-center items-center w-8 h-8 rounded-full dark:bg-zinc-700 hover:bg-stone-200 dark:hover:bg-zinc-900",l),children:t})},eZ=l(96486);function ek(e){let{label:t}=e;return(0,a.jsx)("div",{className:"w-full h-8 align-middle font-semibold",children:t})}let eC=["file","multiple_files","time","images","csv_file"];var eP=l(12906),eI=l(57546),eS=l(60219),eF=l(58638),eE=l(26855),ez=l(96074),eO=l(39332),eV=l(24885),eA=l(59819);l(4583);let{TextArea:eT}=d.default,eD=e=>{let{reactFlow:t,isSaveFlowModalOpen:l,flowInfo:s,setIsSaveFlowModalOpen:n}=e,[o,i]=(0,m.useState)(!0),{t:c}=(0,x.$G)(),u=(0,eO.useSearchParams)(),f=(null==u?void 0:u.get("id"))||"",[h]=P.default.useForm(),[v,j]=E.ZP.useMessage();async function g(){let{name:e,label:l,description:a="",editable:s=!1,state:o="deployed"}=h.getFieldsValue();console.log(h.getFieldsValue());let i=(0,R.Wf)(t.toObject());if(f){let[,,t]=await (0,r.Vx)((0,r.ao)(f,{name:e,label:l,description:a,editable:s,uid:f,flow_data:i,state:o}));(null==t?void 0:t.success)?v.success(c("save_flow_success")):(null==t?void 0:t.err_msg)&&v.error(null==t?void 0:t.err_msg)}else{let[t,n]=await (0,r.Vx)((0,r.zd)({name:e,label:l,description:a,editable:s,flow_data:i,state:o}));if(null==n?void 0:n.uid){v.success(c("save_flow_success"));let e=window.history;e.pushState(null,"","/flow/canvas?id=".concat(n.uid))}}n(!1)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.default,{centered:!0,title:c("flow_modal_title"),open:l,onCancel:()=>{n(!1)},cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(P.default,{name:"flow_form",form:h,labelCol:{span:6},wrapperCol:{span:16},className:"mt-6 max-w-2xl",initialValues:{remember:!0},onFinish:g,autoComplete:"off",children:[(0,a.jsx)(P.default.Item,{label:"Title",name:"label",initialValue:null==s?void 0:s.label,rules:[{required:!0,message:"Please input flow title!"}],children:(0,a.jsx)(d.default,{onChange:function(e){let t=e.target.value,l=t.replace(/\s+/g,"_").replace(/[^a-z0-9_-]/g,"").toLowerCase();h.setFieldsValue({name:l})}})}),(0,a.jsx)(P.default.Item,{label:"Name",name:"name",initialValue:null==s?void 0:s.name,rules:[{required:!0,message:"Please input flow name!"},()=>({validator:(e,t)=>/^[a-zA-Z0-9_\-]+$/.test(t)?Promise.resolve():Promise.reject("Can only contain numbers, letters, underscores, and dashes")})],children:(0,a.jsx)(d.default,{})}),(0,a.jsx)(P.default.Item,{label:"Description",initialValue:null==s?void 0:s.description,name:"description",children:(0,a.jsx)(eT,{rows:3})}),(0,a.jsx)(P.default.Item,{label:"Editable",name:"editable",initialValue:null==s?void 0:s.editable,valuePropName:"checked",children:(0,a.jsx)(F.Z,{})}),(0,a.jsx)(P.default.Item,{hidden:!0,name:"state",children:(0,a.jsx)(d.default,{})}),(0,a.jsx)(P.default.Item,{label:"Deploy",children:(0,a.jsx)(F.Z,{defaultChecked:(null==s?void 0:s.state)==="deployed"||(null==s?void 0:s.state)==="running",checked:o,onChange:e=>{let t=e.target.checked;h.setFieldValue("state",t?"deployed":"developing"),i(t)}})}),(0,a.jsx)(P.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(ed.ZP,{htmlType:"button",onClick:()=>{n(!1)},children:c("cancel")}),(0,a.jsx)(ed.ZP,{type:"primary",htmlType:"submit",children:c("verify")})]})})]})}),j]})};var eL=l(83454);let eM=e=>{let{reactFlow:t,flowInfo:l,isExportFlowModalOpen:r,setIsExportFlowModalOpen:s}=e,{t:n}=(0,x.$G)(),[o]=P.default.useForm(),[i,c]=E.ZP.useMessage(),u=async e=>{if("json"===e.format){let l=t.toObject(),a=new Blob([JSON.stringify(l)],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=e.file_name||"flow.json",s.click()}else{let t="".concat(eL.env.API_BASE_URL,"/api/v2/serve/awel/flow/export/").concat(e.uid,"?export_type=").concat(e.export_type,"&format=").concat(e.format);window.open(t)}i.success(n("Export_Flow_Success")),s(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.default,{centered:!0,title:n("Export_Flow"),open:r,onCancel:()=>s(!1),cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(P.default,{form:o,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:u,initialValues:{export_type:"json",format:"file",uid:null==l?void 0:l.uid},children:[(0,a.jsx)(P.default.Item,{label:n("Export_File_Type"),name:"export_type",children:(0,a.jsxs)(Q.ZP.Group,{children:[(0,a.jsx)(Q.ZP,{value:"json",children:"JSON"}),(0,a.jsx)(Q.ZP,{value:"dbgpts",children:"DBGPTS"})]})}),(0,a.jsx)(P.default.Item,{label:n("Export_File_Format"),name:"format",children:(0,a.jsxs)(Q.ZP.Group,{children:[(0,a.jsx)(Q.ZP,{value:"file",children:"File"}),(0,a.jsx)(Q.ZP,{value:"json",children:"JSON"})]})}),(0,a.jsx)(P.default.Item,{hidden:!0,name:"uid",children:(0,a.jsx)(d.default,{})}),(0,a.jsx)(P.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(ed.ZP,{htmlType:"button",onClick:()=>s(!1),children:n("cancel")}),(0,a.jsx)(ed.ZP,{type:"primary",htmlType:"submit",children:n("verify")})]})})]})}),c]})},eB=e=>{let{setNodes:t,setEdges:l,isImportModalOpen:s,setIsImportFlowModalOpen:n}=e,{t:o}=(0,x.$G)(),[i]=P.default.useForm(),[d,c]=E.ZP.useMessage(),[u,f]=(0,m.useState)([]),h=async e=>{var t;e.file=null===(t=e.file)||void 0===t?void 0:t[0];let l=new FormData;u.forEach(e=>{l.append("file",e)});let[,,a]=await (0,r.Vx)((0,r._Y)(l));(null==a?void 0:a.success)?d.success(o("Export_Flow_Success")):(null==a?void 0:a.err_msg)&&d.error(null==a?void 0:a.err_msg),n(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.default,{centered:!0,title:o("Import_Flow"),open:s,onCancel:()=>n(!1),cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(P.default,{form:i,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:h,initialValues:{save_flow:!1},children:[(0,a.jsx)(P.default.Item,{name:"file",label:o("Select_File"),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0,message:"Please upload a file"}],children:(0,a.jsx)(em.default,{accept:".json,.zip",beforeUpload:()=>!1,maxCount:1,children:(0,a.jsxs)(ed.ZP,{icon:(0,a.jsx)(ef.Z,{}),children:[" ",o("Upload")]})})}),(0,a.jsx)(P.default.Item,{name:"save_flow",label:o("Save_After_Import"),children:(0,a.jsxs)(Q.ZP.Group,{children:[(0,a.jsx)(Q.ZP,{value:!0,children:o("Yes")}),(0,a.jsx)(Q.ZP,{value:!1,children:o("No")})]})}),(0,a.jsx)(P.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(ed.ZP,{onClick:()=>n(!1),children:o("cancel")}),(0,a.jsx)(ed.ZP,{type:"primary",htmlType:"submit",children:o("verify")})]})})]})}),c]})},eG={customNode:e=>{let{data:t}=e,{inputs:l,outputs:s,parameters:n,flow_type:o}=t,[i,d]=(0,m.useState)(!1),c=(0,A._K)(),[u]=P.default.useForm();async function p(e,l){let a=n.filter(t=>{var l;let{ui:a}=t;return null==a?void 0:null===(l=a.refresh_depends)||void 0===l?void 0:l.includes(e)});(null==a?void 0:a.length)!==0&&a.forEach(async a=>{let s={id:(0,R._g)(null==t?void 0:t.id),type_name:t.type_name,type_cls:t.type_cls,flow_type:"operator",refresh:[{name:a.name,depends:[{name:e,value:l,has_value:!0}]}]},[n,o]=await (0,r.Vx)((0,r.ks)(s));o&&c.setNodes(e=>e.map(e=>e.id===t.id?{...e,data:{...e.data,parameters:o.parameters}}:e))})}function f(e,t){let[l,a]=Object.entries(e)[0];!(!(null==t?void 0:t.force)&&eC.includes(l))&&(n.forEach(e=>{e.name===l&&(e.value=a)}),a&&p(l,a))}return(0,a.jsx)(ew.Z,{placement:"rightTop",trigger:["hover"],content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eN,{className:"hover:text-blue-500",children:(0,a.jsx)(e_.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation();let l=c.getNodes(),a=l.find(e=>e.id===t.id);if(a){let e=(0,R.VZ)(a,l),t=(0,eZ.cloneDeep)(a),r={...t,id:e,position:{x:t.position.x+400,y:t.position.y},positionAbsolute:{x:t.positionAbsolute.x+400,y:t.positionAbsolute.y},data:{...t.data,id:e},selected:!1};c.setNodes(e=>[...e,r])}}})}),(0,a.jsx)(eN,{className:"mt-2 hover:text-red-500",children:(0,a.jsx)(ey.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation(),c.setNodes(e=>e.filter(e=>e.id!==t.id)),c.setEdges(e=>e.filter(e=>e.source!==t.id&&e.target!==t.id))}})}),(0,a.jsx)(eN,{className:"mt-2",children:(0,a.jsx)(V.Z,{title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-bold",children:t.label}),(0,a.jsx)("p",{children:t.description})]}),placement:"right",children:(0,a.jsx)(L.Z,{className:"h-full text-lg cursor-pointer"})})})]}),children:(0,a.jsxs)("div",{className:B()("w-80 h-auto rounded-xl shadow-md px-2 py-4 border bg-white dark:bg-zinc-800 cursor-grab flex flex-col space-y-2 text-sm",{"border-blue-500":t.selected||i,"border-stone-400 dark:border-white":!t.selected&&!i,"border-dashed":"operator"!==o,"border-red-600":t.invalid}),onMouseEnter:function(){d(!0)},onMouseLeave:function(){d(!1)},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)(C(),{src:"/icons/node/vis.png",width:24,height:24,alt:""}),(0,a.jsx)("p",{className:"ml-2 text-lg font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.label})]}),(null==l?void 0:l.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(ek,{label:"Inputs"}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:null==l?void 0:l.map((e,l)=>(0,a.jsx)(G,{node:t,data:e,type:"target",label:"inputs",index:l},"".concat(t.id,"_input_").concat(l)))})]}),(null==n?void 0:n.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(ek,{label:"Parameters"}),(0,a.jsx)(P.default,{form:u,layout:"vertical",onValuesChange:f,className:"flex flex-col space-y-3 text-neutral-500",children:null==n?void 0:n.map((e,l)=>(0,a.jsx)(eb,{formValuesChange:f,node:t,paramData:e,label:"parameters",index:l},"".concat(t.id,"_param_").concat(l)))})]}),"operator"===o&&(null==s?void 0:s.length)>0?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(ek,{label:"Outputs"}),(s||[]).map((e,l)=>(0,a.jsx)(G,{node:t,data:e,type:"source",label:"outputs",index:l},"".concat(t.id,"_input_").concat(l)))]}):"resource"===o?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(ek,{label:"Outputs"}),(0,a.jsx)(G,{node:t,data:t,type:"source",label:"outputs",index:0},"".concat(t.id,"_input_0"))]}):void 0]})})}},eR={buttonedge:Z.Z},e$=()=>{let{t:e}=(0,x.$G)(),t=(0,eO.useSearchParams)(),l=(null==t?void 0:t.get("id"))||"",n=(0,A._K)(),[o,i]=(0,m.useState)(!1),[d,c,u]=(0,A.Rr)([]),[f,h,v]=(0,A.ll)([]),j=(0,m.useRef)(null),[g,b]=(0,m.useState)(),[w,_]=(0,m.useState)(!1),[y,Z]=(0,m.useState)(!1),[k,C]=(0,m.useState)(!1);async function P(){i(!0);let[e,t]=await (0,r.Vx)((0,r._d)(l));if(t){let e=(0,R.z5)(t.flow_data);b(t),c(e.nodes),h(e.edges)}i(!1)}(0,m.useEffect)(()=>{l&&P()},[l]),(0,m.useEffect)(()=>{let e=e=>{e.returnValue=E.ZP};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let I=(0,m.useCallback)(e=>{var t,l;e.preventDefault();let a=j.current.getBoundingClientRect(),r=null===(t=null===(l=document.getElementsByClassName("ant-layout-sider"))||void 0===l?void 0:l[0])||void 0===t?void 0:t.offsetWidth,s=e.dataTransfer.getData("application/reactflow");if(!s||void 0===s)return;let o=JSON.parse(s),i=n.screenToFlowPosition({x:e.clientX-a.left+r,y:e.clientY-a.top}),d=(0,R.VZ)(o,n.getNodes());o.id=d;let u={id:d,position:i,type:"customNode",data:o};c(e=>e.concat(u).map(e=>(e.id===u.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},[n]),S=(0,m.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]);function F(){let e=n.toObject(),[t,l,r]=(0,R.Rv)(e);if(!t&&r)return c(e=>e.map(e=>(e.id===(null==l?void 0:l.id)?e.data={...e.data,invalid:!0}:e.data={...e.data,invalid:!1},e))),eE.ZP.error({message:"Error",description:r,icon:(0,a.jsx)(eP.Z,{className:"text-red-600"})});_(!0)}function z(){Z(!0)}function O(){C(!0)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(N,{}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)(p.Z,{className:"my-2 mx-4 flex flex-row justify-end",children:(()=>{let t=[{title:e("Import"),icon:(0,a.jsx)(eI.Z,{className:"block text-xl",onClick:O})},{title:e("save"),icon:(0,a.jsx)(eS.Z,{className:"block text-xl",onClick:F})}];return""!==l&&t.unshift({title:e("Export"),icon:(0,a.jsx)(eF.Z,{className:"block text-xl",onClick:z})}),t})().map(e=>{let{title:t,icon:l}=e;return(0,a.jsx)(V.Z,{title:t,className:"w-8 h-8 rounded-md bg-stone-300 dark:bg-zinc-700 dark:text-zinc-200 hover:text-blue-500 dark:hover:text-zinc-100",children:l},t)})}),(0,a.jsx)(ez.Z,{className:"mt-0 mb-0"}),(0,a.jsx)("div",{className:"h-[calc(100vh-48px)] w-full",ref:j,children:(0,a.jsxs)(A.x$,{nodes:d,edges:f,nodeTypes:eG,edgeTypes:eR,onNodesChange:u,onEdgesChange:v,onNodeClick:function(e,t){n.setNodes(e=>e.map(e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},onConnect:function(e){let t={...e,type:"buttonedge",id:"".concat(e.source,"|").concat(e.target)};h(e=>(0,A.Z_)(t,e))},onDrop:I,onDragOver:S,minZoom:.1,fitView:!0,deleteKeyCode:["Backspace","Delete"],children:[(0,a.jsx)(eV.Z,{className:"flex flex-row items-center",position:"bottom-center"}),(0,a.jsx)(eA.A,{color:"#aaa",gap:16})]})})]})]}),(0,a.jsx)(s.Z,{visible:o}),(0,a.jsx)(eD,{reactFlow:n,flowInfo:g,isSaveFlowModalOpen:w,setIsSaveFlowModalOpen:_}),(0,a.jsx)(eM,{reactFlow:n,flowInfo:g,isExportFlowModalOpen:y,setIsExportFlowModalOpen:Z}),(0,a.jsx)(eB,{setNodes:c,setEdges:h,isImportModalOpen:k,setIsImportFlowModalOpen:C})]})};function eq(){return(0,a.jsx)(A.tV,{children:(0,a.jsx)(e$,{})})}},67919:function(e,t,l){"use strict";l.d(t,{It:function(){return i},Rv:function(){return o},VZ:function(){return a},Wf:function(){return s},_g:function(){return r},z5:function(){return n}});let a=(e,t)=>{let l=0;return t.forEach(t=>{t.data.name===e.name&&l++}),"".concat(e.id,"_").concat(l)},r=e=>e.replace(/_\d+$/,""),s=e=>{let{nodes:t,edges:l,...a}=e,r=t.map(e=>{let{positionAbsolute:t,...l}=e;return{position_absolute:t,...l}}),s=l.map(e=>{let{sourceHandle:t,targetHandle:l,...a}=e;return{source_handle:t,target_handle:l,...a}});return{nodes:r,edges:s,...a}},n=e=>{let{nodes:t,edges:l,...a}=e,r=t.map(e=>{let{position_absolute:t,...l}=e;return{positionAbsolute:t,...l}}),s=l.map(e=>{let{source_handle:t,target_handle:l,...a}=e;return{sourceHandle:t,targetHandle:l,...a}});return{nodes:r,edges:s,...a}},o=e=>{let{nodes:t,edges:l}=e,a=[!0,t[0],""];e:for(let e=0;e<t.length;e++){let r=t[e].data,{inputs:s=[],parameters:n=[]}=r;for(let n=0;n<s.length;n++)if(!l.some(l=>l.targetHandle==="".concat(t[e].id,"|inputs|").concat(n))){a=[!1,t[e],"The input ".concat(s[n].type_name," of node ").concat(r.label," is required")];break e}for(let s=0;s<n.length;s++){let o=n[s];if(o.optional||"resource"!==o.category||l.some(l=>l.targetHandle==="".concat(t[e].id,"|parameters|").concat(s))){if(!o.optional&&"common"===o.category&&(void 0===o.value||null===o.value)){a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(r.label," is required")];break e}}else{a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(r.label," is required")];break e}}}return a},i=e=>(function e(t){if(Array.isArray(t))return t.map(t=>e(t));if(t&&"object"==typeof t&&!Array.isArray(t)){let l={};for(let a in t)if(t.hasOwnProperty(a)){let r=a.replace(/_([a-z])/g,(e,t)=>t.toUpperCase());l[r]=e(t[a])}return l}return t})(e)}},function(e){e.O(0,[3662,8241,2648,3791,4296,5102,4330,1776,4041,8232,2913,2378,5872,4567,1531,3320,6212,3764,7003,8237,905,5376,9774,2888,179],function(){return e(e.s=94617)}),_N_E=e.O()}]);