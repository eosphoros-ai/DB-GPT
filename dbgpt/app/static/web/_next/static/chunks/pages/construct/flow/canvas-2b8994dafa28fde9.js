(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1767],{94617:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/flow/canvas",function(){return l(80053)}])},45247:function(e,t,l){"use strict";var a=l(85893),n=l(50888);t.Z=function(e){let{visible:t}=e;return t?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(n.Z,{})}):null}},99743:function(e,t,l){"use strict";var a=l(85893);l(67294);var n=l(36851);t.Z=e=>{let{id:t,sourceX:l,sourceY:s,targetX:r,targetY:o,sourcePosition:i,targetPosition:d,style:c={},markerEnd:u}=e,[p,f,m]=(0,n.OQ)({sourceX:l,sourceY:s,sourcePosition:i,targetX:r,targetY:o,targetPosition:d}),x=(0,n._K)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.u5,{id:t,style:c,path:p,markerEnd:u}),(0,a.jsx)("foreignObject",{width:40,height:40,x:f-20,y:m-20,className:"bg-transparent w-10 h-10 relative",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,a.jsx)("button",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-stone-400 dark:bg-zinc-700 cursor-pointer text-sm",onClick:e=>{e.stopPropagation(),x.setEdges(x.getEdges().filter(e=>e.id!==t))},children:"\xd7"})})]})}},80053:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return eq}});var a=l(85893),n=l(76212),s=l(45247),r=l(12906),o=l(57546),i=l(60219),d=l(58638),c=l(45360),u=l(26855),p=l(42075),f=l(83062),m=l(96074),x=l(39332),v=l(67294),h=l(67421),j=l(36851),g=l(24885),b=l(59819),w=l(41468),_=l(62418),y=l(14313),N=l(94155),Z=l(25278),k=l(21612),C=l(40411),P=l(47221),I=l(2487),S=l(7134),E=l(32983),F=e=>{let{nodes:t}=e,{t:l}=(0,h.$G)();return(null==t?void 0:t.length)>0?(0,a.jsx)(I.Z,{className:"overflow-hidden overflow-y-auto w-full",size:"small",itemLayout:"horizontal",dataSource:t,renderItem:e=>(0,a.jsx)(I.Z.Item,{className:"cursor-move hover:bg-[#F1F5F9] dark:hover:bg-theme-dark p-0 py-2",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow",JSON.stringify(e)),t.dataTransfer.effectAllowed="move"},children:(0,a.jsx)(I.Z.Item.Meta,{className:"flex items-center justify-center",avatar:(0,a.jsx)(S.C,{src:"/icons/node/vis.png",size:"large"}),title:(0,a.jsx)("p",{className:"line-clamp-1 font-medium",children:e.label}),description:(0,a.jsx)("p",{className:"line-clamp-2",children:e.description})})})}):(0,a.jsx)(E.Z,{className:"px-2",description:l("no_node")})};let{Search:z}=Z.default,{Sider:O}=k.default,V={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8};var A=()=>{let{t:e}=(0,h.$G)(),{mode:t}=(0,v.useContext)(w.p),[l,s]=(0,v.useState)(!1),[r,o]=(0,v.useState)(""),[i,d]=(0,v.useState)([]),[c,u]=(0,v.useState)([]),[f,m]=(0,v.useState)([]),[x,j]=(0,v.useState)([]);async function g(){let[e,t]=await (0,n.Vx)((0,n.As)());if(t&&t.length>0){localStorage.setItem(_.zN,JSON.stringify(t));let e=t.filter(e=>"operator"===e.flow_type),l=t.filter(e=>"resource"===e.flow_type);d(e),u(l),m(Z(e)),j(Z(l))}}(0,v.useEffect)(()=>{g()},[]);let b=(0,v.useMemo)(()=>l?{...V,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...V,borderLeft:"1px solid #d6d8da"},[l]);function Z(e){let t=[],l={};return e.forEach(e=>{let{category:a,category_label:n}=e;l[a]||(l[a]={category:a,categoryLabel:n,nodes:[]},t.push(l[a])),l[a].nodes.push(e)}),t}let k=(0,v.useMemo)(()=>{if(!r)return f.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(F,{nodes:n}),extra:(0,a.jsx)(C.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=i.filter(e=>e.label.toLowerCase().includes(r.toLowerCase()));return Z(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(F,{nodes:n}),extra:(0,a.jsx)(C.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[f,r]),I=(0,v.useMemo)(()=>{if(!r)return x.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(F,{nodes:n}),extra:(0,a.jsx)(C.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=c.filter(e=>e.label.toLowerCase().includes(r.toLowerCase()));return Z(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(F,{nodes:n}),extra:(0,a.jsx)(C.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[x,r]);return(0,a.jsx)(O,{className:"flex justify-center items-start nodrag bg-[#ffffff80] border-r border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:t,width:280,collapsible:!0,collapsed:l,collapsedWidth:0,trigger:l?(0,a.jsx)(y.Z,{className:"text-base"}):(0,a.jsx)(N.Z,{className:"text-base"}),zeroWidthTriggerStyle:b,onCollapse:e=>s(e),children:(0,a.jsxs)(p.Z,{direction:"vertical",className:"w-[280px] pt-4 px-4 overflow-hidden overflow-y-auto scrollbar-default",children:[(0,a.jsx)("p",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] line-clamp-1",children:e("add_node")}),(0,a.jsx)(z,{placeholder:"Search node",onSearch:function(e){o(e)},allowClear:!0}),(0,a.jsx)("h2",{className:"font-semibold",children:e("operators")}),(0,a.jsx)(P.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:k}),(0,a.jsx)("h2",{className:"font-semibold",children:e("resource")}),(0,a.jsx)(P.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:I})]})})},T=l(99743),D=l(99859),L=l(85576),M=l(78045),R=l(14726),B=l(83454);let G=e=>{let{reactFlow:t,flowInfo:l,isExportFlowModalOpen:n,setIsExportFlowModalOpen:s}=e,{t:r}=(0,h.$G)(),[o]=D.default.useForm(),[i,d]=c.ZP.useMessage(),u=async e=>{if("json"===e.format){let l=t.toObject(),a=new Blob([JSON.stringify(l)],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=e.file_name||"flow.json",s.click()}else{let t="".concat(B.env.API_BASE_URL,"/api/v2/serve/awel/flow/export/").concat(e.uid,"?export_type=").concat(e.export_type,"&format=").concat(e.format);window.open(t)}i.success(r("Export_Flow_Success")),s(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.default,{centered:!0,title:r("Export_Flow"),open:n,onCancel:()=>s(!1),cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(D.default,{form:o,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:u,initialValues:{export_type:"json",format:"file",uid:null==l?void 0:l.uid},children:[(0,a.jsx)(D.default.Item,{label:r("Export_File_Type"),name:"export_type",children:(0,a.jsxs)(M.ZP.Group,{children:[(0,a.jsx)(M.ZP,{value:"json",children:"JSON"}),(0,a.jsx)(M.ZP,{value:"dbgpts",children:"DBGPTS"})]})}),(0,a.jsx)(D.default.Item,{label:r("Export_File_Format"),name:"format",children:(0,a.jsxs)(M.ZP.Group,{children:[(0,a.jsx)(M.ZP,{value:"file",children:"File"}),(0,a.jsx)(M.ZP,{value:"json",children:"JSON"})]})}),(0,a.jsx)(D.default.Item,{hidden:!0,name:"uid",children:(0,a.jsx)(Z.default,{})}),(0,a.jsx)(D.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(R.ZP,{htmlType:"button",onClick:()=>s(!1),children:r("cancel")}),(0,a.jsx)(R.ZP,{type:"primary",htmlType:"submit",children:r("verify")})]})})]})}),d]})};var $=l(88484),q=l(23799);let U=e=>{let{isImportModalOpen:t,setIsImportFlowModalOpen:l}=e,{t:s}=(0,h.$G)(),[r]=D.default.useForm(),[o,i]=c.ZP.useMessage(),[d,u]=(0,v.useState)([]);(0,v.useEffect)(()=>{t&&(r.resetFields(),u([]))},[t,r]);let f=async e=>{var t;e.file=null===(t=e.file)||void 0===t?void 0:t[0];let a=new FormData;d.forEach(t=>{a.append("file",t),a.append("save_flow",e.save_flow)});let[,,r]=await (0,n.Vx)((0,n._Y)(a));(null==r?void 0:r.success)?o.success(s("Export_Flow_Success")):(null==r?void 0:r.err_msg)&&o.error(null==r?void 0:r.err_msg),l(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.default,{centered:!0,title:s("Import_Flow"),open:t,onCancel:()=>l(!1),cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(D.default,{form:r,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:f,initialValues:{save_flow:!1},children:[(0,a.jsx)(D.default.Item,{name:"file",label:s("Select_File"),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0,message:"Please upload a file"}],children:(0,a.jsx)(q.default,{onRemove:e=>{let t=d.indexOf(e),l=d.slice();l.splice(t,1),u(l)},beforeUpload:e=>(u([...d,e]),!1),fileList:d,accept:".json,.zip",maxCount:1,children:(0,a.jsxs)(R.ZP,{icon:(0,a.jsx)($.Z,{}),children:[" ",s("Upload")]})})}),(0,a.jsx)(D.default.Item,{name:"save_flow",label:s("Save_After_Import"),children:(0,a.jsxs)(M.ZP.Group,{children:[(0,a.jsx)(M.ZP,{value:!0,children:s("Yes")}),(0,a.jsx)(M.ZP,{value:!1,children:s("No")})]})}),(0,a.jsx)(D.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(R.ZP,{onClick:()=>l(!1),children:s("cancel")}),(0,a.jsx)(R.ZP,{type:"primary",htmlType:"submit",children:s("verify")})]})})]})}),i]})};var J=l(67919),K=l(84567);let{TextArea:H}=Z.default,W=e=>{let{reactFlow:t,isSaveFlowModalOpen:l,flowInfo:s,setIsSaveFlowModalOpen:r}=e,[o,i]=(0,v.useState)(!0),{t:d}=(0,h.$G)(),u=(0,x.useSearchParams)(),f=(null==u?void 0:u.get("id"))||"",[m]=D.default.useForm(),[j,g]=c.ZP.useMessage();async function b(){let{name:e,label:l,description:a="",editable:s=!1,state:o="deployed"}=m.getFieldsValue(),i=(0,J.Wf)(t.toObject());if(f){let[,,t]=await (0,n.Vx)((0,n.ao)(f,{name:e,label:l,description:a,editable:s,uid:f,flow_data:i,state:o}));(null==t?void 0:t.success)?j.success(d("save_flow_success")):(null==t?void 0:t.err_msg)&&j.error(null==t?void 0:t.err_msg)}else{let[t,r]=await (0,n.Vx)((0,n.zd)({name:e,label:l,description:a,editable:s,flow_data:i,state:o}));if(null==r?void 0:r.uid){j.success(d("save_flow_success"));let e=window.history;e.pushState(null,"","/flow/canvas?id=".concat(r.uid))}}r(!1)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.default,{centered:!0,title:d("flow_modal_title"),open:l,onCancel:()=>{r(!1)},cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(D.default,{name:"flow_form",form:m,labelCol:{span:6},wrapperCol:{span:16},className:"mt-6 max-w-2xl",initialValues:{remember:!0},onFinish:b,autoComplete:"off",children:[(0,a.jsx)(D.default.Item,{label:"Title",name:"label",initialValue:null==s?void 0:s.label,rules:[{required:!0,message:"Please input flow title!"}],children:(0,a.jsx)(Z.default,{onChange:function(e){let t=e.target.value,l=t.replace(/\s+/g,"_").replace(/[^a-z0-9_-]/g,"").toLowerCase();m.setFieldsValue({name:l})}})}),(0,a.jsx)(D.default.Item,{label:"Name",name:"name",initialValue:null==s?void 0:s.name,rules:[{required:!0,message:"Please input flow name!"},()=>({validator:(e,t)=>/^[a-zA-Z0-9_\-]+$/.test(t)?Promise.resolve():Promise.reject("Can only contain numbers, letters, underscores, and dashes")})],children:(0,a.jsx)(Z.default,{})}),(0,a.jsx)(D.default.Item,{label:"Description",initialValue:null==s?void 0:s.description,name:"description",children:(0,a.jsx)(H,{rows:3})}),(0,a.jsx)(D.default.Item,{label:"Editable",name:"editable",initialValue:null==s?void 0:s.editable,valuePropName:"checked",children:(0,a.jsx)(K.Z,{})}),(0,a.jsx)(D.default.Item,{hidden:!0,name:"state",children:(0,a.jsx)(Z.default,{})}),(0,a.jsx)(D.default.Item,{label:"Deploy",children:(0,a.jsx)(K.Z,{defaultChecked:(null==s?void 0:s.state)==="deployed"||(null==s?void 0:s.state)==="running",checked:o,onChange:e=>{let t=e.target.checked;m.setFieldValue("state",t?"deployed":"developing"),i(t)}})}),(0,a.jsx)(D.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(R.ZP,{htmlType:"button",onClick:()=>{r(!1)},children:d("cancel")}),(0,a.jsx)(R.ZP,{type:"primary",htmlType:"submit",children:d("verify")})]})})]})}),g]})};var Y=l(57132),X=l(48689),Q=l(45605),ee=l(55241),et=l(93967),el=l.n(et),ea=l(96486),en=l(25675),es=l.n(en),er=e=>{let{children:t,className:l}=e;return(0,a.jsx)("div",{className:el()("flex justify-center items-center w-8 h-8 rounded-full dark:bg-zinc-700 hover:bg-stone-200 dark:hover:bg-zinc-900",l),children:t})},eo=l(24969),ei=l(45030),ed=l(86738),ec=e=>{let{optional:t}=e;return t?null:(0,a.jsx)("span",{className:"text-red-600 align-middle inline-block",children:"\xa0*"})},eu=e=>{let{node:t,data:l,type:n,label:s,index:r}=e,{t:o}=(0,h.$G)(),i=(0,j._K)(),[d,u]=v.useState([]);function p(){let e=localStorage.getItem(_.zN);if(!e)return;let a=JSON.parse(e),n=l.type_cls,r=[];"inputs"===s?r=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.outputs)||void 0===t?void 0:t.some(e=>e.type_cls===n&&e.is_list===(null==l?void 0:l.is_list))}):"parameters"===s?r=a.filter(e=>"resource"===e.flow_type).filter(e=>{var t;return null===(t=e.parent_cls)||void 0===t?void 0:t.includes(n)}):"outputs"===s&&("operator"===t.flow_type?r=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.inputs)||void 0===t?void 0:t.some(e=>e.type_cls===n&&e.is_list===(null==l?void 0:l.is_list))}):"resource"===t.flow_type&&(r=a.filter(e=>{var l,a;return(null===(l=e.inputs)||void 0===l?void 0:l.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))||(null===(a=e.parameters)||void 0===a?void 0:a.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))}))),u(r)}return(0,a.jsxs)("div",{className:el()("relative flex items-center",{"justify-start":"parameters"===s||"inputs"===s,"justify-end":"outputs"===s}),children:[(0,a.jsx)(j.HH,{className:el()("w-2 h-2","source"===n?"-mr-4":"-ml-4"),type:n,position:"source"===n?j.Ly.Right:j.Ly.Left,id:"".concat(t.id,"|").concat(s,"|").concat(r),isValidConnection:e=>(function(e){var t,l;let{sourceHandle:a,targetHandle:n,source:s,target:r}=e,d=i.getNode(s),u=i.getNode(r),{flow_type:p}=null!==(t=null==d?void 0:d.data)&&void 0!==t?t:{},{flow_type:f}=null!==(l=null==u?void 0:u.data)&&void 0!==l?l:{},m=null==a?void 0:a.split("|")[1],x=null==n?void 0:n.split("|")[1],v=null==a?void 0:a.split("|")[2],h=null==n?void 0:n.split("|")[2],j=null==u?void 0:u.data[x][h].type_cls;if(p===f&&"operator"===p){let e=null==d?void 0:d.data[m][v].type_cls,t=null==d?void 0:d.data[m][v].is_list,l=null==u?void 0:u.data[x][h].is_list;return e===j&&t===l}if("resource"===p&&("operator"===f||"resource"===f)){let e=null==d?void 0:d.data.parent_cls;return e.includes(j)}return c.ZP.warning(o("connect_warning")),!1})(e)}),(0,a.jsxs)(ei.Z,{className:el()("bg-white dark:bg-[#232734] w-full px-2 py-1 rounded text-neutral-500",{"text-right":"outputs"===s}),children:[(0,a.jsx)(ed.Z,{placement:"left",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(F,{nodes:d})}),children:["inputs","parameters"].includes(s)&&(0,a.jsx)(eo.Z,{className:"cursor-pointer",onClick:p})}),"outputs"!==s&&(0,a.jsx)(ec,{optional:l.optional}),l.type_name,l.description&&(0,a.jsx)(f.Z,{title:l.description,children:(0,a.jsx)(Q.Z,{className:"ml-2 cursor-pointer"})}),(0,a.jsx)(ed.Z,{placement:"right",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(F,{nodes:d})}),children:["outputs"].includes(s)&&(0,a.jsx)(eo.Z,{className:"ml-2 cursor-pointer",onClick:p})})]})]})},ep=l(13457),ef=l(34041),em=l(3303);let ex=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(em.Z,{...l,options:e.options,placeholder:"please select",className:"w-full nodrag"})},ev=e=>{var t,l;let n=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(null===(l=e.options)||void 0===l?void 0:l.length)>0&&(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(K.Z.Group,{...n,options:e.options})})};var eh=l(63764);let ej=e=>{var t,l,n,s,r,o,i,d;let{t:c}=(0,h.$G)(),u=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{}),[p,f]=(0,v.useState)(!1),m=(0,v.useMemo)(()=>{var t,l,a,n;return(null==e?void 0:null===(t=e.ui)||void 0===t?void 0:null===(l=t.editor)||void 0===l?void 0:l.width)?(null==e?void 0:null===(a=e.ui)||void 0===a?void 0:null===(n=a.editor)||void 0===n?void 0:n.width)+100:"80%"},[null==e?void 0:null===(l=e.ui)||void 0===l?void 0:null===(n=l.editor)||void 0===n?void 0:n.width]);return(0,a.jsxs)("div",{className:"p-2 text-sm",children:[(0,a.jsx)(R.ZP,{type:"default",onClick:()=>{f(!0)},children:c("Open_Code_Editor")}),(0,a.jsx)(L.default,{title:c("Code_Editor"),width:m,open:p,onOk:()=>{f(!1)},onCancel:()=>{f(!1)},children:(0,a.jsx)(D.default.Item,{name:null==e?void 0:e.name,children:(0,a.jsx)(eh.ZP,{...u,width:(null==e?void 0:null===(s=e.ui)||void 0===s?void 0:null===(r=s.editor)||void 0===r?void 0:r.width)||"100%",height:(null==e?void 0:null===(o=e.ui)||void 0===o?void 0:null===(i=o.editor)||void 0===i?void 0:i.height)||200,defaultLanguage:null==e?void 0:null===(d=e.ui)||void 0===d?void 0:d.language,theme:"vs-dark",options:{minimap:{enabled:!1},wordWrap:"on"}})})})]})};var eg=l(69935);let eb=e=>{var t;let{data:l,formValuesChange:n}=e,s=(0,J.It)((null===(t=l.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eg.default,{onChange:(e,t)=>{n({[l.name]:t})},...s,className:"w-full",placeholder:"please select a date"})};var ew=l(95916);let e_=e=>{let t=e.match(/^icon:(\w+)$/);if(t){let e=t[1],l=ew[e];return l?(0,a.jsx)(l,{}):null}return null},ey=e=>{var t,l,n;let s=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return s.prefix=e_((null===(l=e.ui)||void 0===l?void 0:null===(n=l.attr)||void 0===n?void 0:n.prefix)||""),(0,a.jsx)(Z.default,{...s,className:"w-full",placeholder:"please input",allowClear:!0})},{Password:eN}=Z.default,eZ=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eN,{...l,placeholder:"input password"})},ek=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(M.ZP.Group,{...l,options:e.options})})},eC=e=>{var t;let l=(0,J.It)((null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(ef.default,{...l,className:"w-full nodrag",placeholder:"please select",options:e.options})};var eP=l(30568);let eI=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(a.Fragment,{children:e.is_list?(0,a.jsx)(eP.Z,{range:!0,className:"mt-8 nodrag",...l}):(0,a.jsx)(eP.Z,{className:"mt-8 nodrag",...l})})},{TextArea:eS}=Z.default,eE=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eS,{className:"nowheel mb-3",...l})};var eF=l(68351);let ez=e=>{var t;let{data:l,formValuesChange:n}=e,s=(0,J.It)((null===(t=l.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eF.Z,{...s,onChange:(e,t)=>{n({time:t},{force:!0})},className:"w-full",placeholder:"please select a moment"})};var eO=l(59847);let eV=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eO.Z,{...l,className:"w-full nodrag",treeDefaultExpandAll:!0,treeData:e.options})};var eA=l(83454);let eT=e=>{var t,l,n,s;let{t:r}=(0,h.$G)(),o=(0,v.useRef)([]),{data:i,formValuesChange:d}=e,u=(0,J.It)((null===(t=i.ui)||void 0===t?void 0:t.attr)||{}),[p,f]=(0,v.useState)(!1),[m,x]=(0,v.useState)(""),j=e=>{o.current.length===i.ui.attr.max_count&&o.current.pop(),o.current.push(e),1===i.ui.attr.max_count?d({[i.name]:o.current.toString()}):d({[i.name]:o.current})},g=e=>{let t=o.current.indexOf(e.response.data[0].uri);-1!==t&&o.current.splice(t,1),f(!1),1===i.ui.attr.max_count?d({[i.name]:o.current.toString()}):d({[i.name]:o.current})},b={name:"files",action:eA.env.API_BASE_URL+i.ui.action,headers:{authorization:"authorization-text"},onChange(e){f(!0),"uploading"!==e.file.status&&f(!1),"done"===e.file.status?(f(!1),c.ZP.success("".concat(e.file.response.data[0].file_name," ").concat(r("Upload_Data_Successfully"))),j(e.file.response.data[0].uri)):"error"===e.file.status&&(f(!1),c.ZP.error("".concat(e.file.response.data[0].file_name,"  ").concat(r("Upload_Data_Failed"))))}};return!m&&(null===(l=i.ui)||void 0===l?void 0:l.file_types)&&Array.isArray(null===(n=i.ui)||void 0===n?void 0:n.file_types)&&x(null===(s=i.ui)||void 0===s?void 0:s.file_types.toString()),(0,a.jsx)("div",{className:"p-2 text-sm text-center",children:i.is_list?(0,a.jsx)(q.default,{onRemove:g,...b,...u,multiple:!0,accept:m,children:(0,a.jsx)(R.ZP,{loading:p,icon:(0,a.jsx)($.Z,{}),children:r("Upload_Data")})}):(0,a.jsx)(q.default,{onRemove:g,...b,...u,multiple:!1,accept:m,children:(0,a.jsx)(R.ZP,{loading:p,icon:(0,a.jsx)($.Z,{}),children:r("Upload_Data")})})})},eD=e=>{var t;let l=(0,J.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(Z.default,{...l,className:"w-full",placeholder:"please input",allowClear:!0})};var eL=e=>{let{formValuesChange:t,node:l,paramData:n,label:s,index:r}=e;return"resource"===n.category?(0,a.jsx)(eu,{node:l,data:n,type:"target",label:s,index:r}):"common"===n.category?(null==n?void 0:n.ui)?function(e,t){var l;let{refresh_depends:n,ui_type:s}=e.ui,r=null!==(l=e.value)&&void 0!==l?l:e.default;return"slider"===s&&e.is_list&&(r=[0,1]),(0,a.jsx)(D.default.Item,{className:"mb-2",initialValue:r,name:e.name,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),...n&&{dependencies:n},...e.description&&{tooltip:{title:e.description,icon:(0,a.jsx)(Q.Z,{})}},children:function(e,t,l){switch(e){case"select":return eC(t);case"cascader":return ex(t);case"checkbox":return ev(t);case"radio":return ek(t);case"input":return ey(t);case"text_area":return eE(t);case"slider":return eI(t);case"date_picker":return eb({data:t,formValuesChange:l});case"time_picker":return ez({data:t,formValuesChange:l});case"tree_select":return eV(t);case"password":return eZ(t);case"upload":return eT({data:t,formValuesChange:l});case"variables":return eD(t);case"code_editor":return ej(t);default:return null}}(s,e,t)})}(n,t):function(e){var t,l;let n=null!==(t=e.value)&&void 0!==t?t:e.default;switch(e.type_name){case"int":case"float":return(0,a.jsx)(D.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(Q.Z,{})}:"",children:(0,a.jsx)(ep.Z,{className:"w-full nodrag"})});case"str":return(0,a.jsx)(D.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(Q.Z,{})}:"",children:(null===(l=e.options)||void 0===l?void 0:l.length)>0?(0,a.jsx)(ef.default,{className:"w-full nodrag",options:e.options.map(e=>({label:e.label,value:e.value}))}):(0,a.jsx)(Z.default,{className:"w-full"})});case"bool":return n="True"===(n="False"!==n&&n)||n,(0,a.jsx)(D.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(Q.Z,{})}:"",children:(0,a.jsx)(K.Z,{className:"ml-2"})})}}(n):void 0};function eM(e){let{label:t}=e;return(0,a.jsx)("div",{className:"w-full h-8 align-middle font-semibold",children:t})}let eR=["file","multiple_files","time"];l(4583);let eB={customNode:e=>{let{data:t}=e,{inputs:l,outputs:s,parameters:r,flow_type:o}=t,[i,d]=(0,v.useState)(!1),c=(0,j._K)(),[u]=D.default.useForm();async function p(e,l){let a=r.filter(t=>{var l;let{ui:a}=t;return null==a?void 0:null===(l=a.refresh_depends)||void 0===l?void 0:l.includes(e)});(null==a?void 0:a.length)!==0&&a.forEach(async a=>{let s={id:(0,J._g)(null==t?void 0:t.id),type_name:t.type_name,type_cls:t.type_cls,flow_type:"operator",refresh:[{name:a.name,depends:[{name:e,value:l,has_value:!0}]}]},[r,o]=await (0,n.Vx)((0,n.ks)(s));o&&c.setNodes(e=>e.map(e=>e.id===t.id?{...e,data:{...e.data,parameters:o.parameters}}:e))})}function m(e,t){let[l,a]=Object.entries(e)[0];!(!(null==t?void 0:t.force)&&eR.includes(l))&&(r.forEach(e=>{e.name===l&&(e.value=a)}),a&&p(l,a))}return(0,a.jsx)(ee.Z,{placement:"rightTop",trigger:["hover"],content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{className:"hover:text-blue-500",children:(0,a.jsx)(Y.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation();let l=c.getNodes(),a=l.find(e=>e.id===t.id);if(a){let e=(0,J.VZ)(a,l),t=(0,ea.cloneDeep)(a),n={...t,id:e,position:{x:t.position.x+400,y:t.position.y},positionAbsolute:{x:t.positionAbsolute.x+400,y:t.positionAbsolute.y},data:{...t.data,id:e},selected:!1};c.setNodes(e=>[...e,n])}}})}),(0,a.jsx)(er,{className:"mt-2 hover:text-red-500",children:(0,a.jsx)(X.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation(),c.setNodes(e=>e.filter(e=>e.id!==t.id)),c.setEdges(e=>e.filter(e=>e.source!==t.id&&e.target!==t.id))}})}),(0,a.jsx)(er,{className:"mt-2",children:(0,a.jsx)(f.Z,{title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-bold",children:t.label}),(0,a.jsx)("p",{children:t.description})]}),placement:"right",children:(0,a.jsx)(Q.Z,{className:"h-full text-lg cursor-pointer"})})})]}),children:(0,a.jsxs)("div",{className:el()("w-80 h-auto rounded-xl shadow-md px-2 py-4 border bg-white dark:bg-zinc-800 cursor-grab flex flex-col space-y-2 text-sm",{"border-blue-500":t.selected||i,"border-stone-400 dark:border-white":!t.selected&&!i,"border-dashed":"operator"!==o,"border-red-600":t.invalid}),onMouseEnter:function(){d(!0)},onMouseLeave:function(){d(!1)},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)(es(),{src:"/icons/node/vis.png",width:24,height:24,alt:""}),(0,a.jsx)("p",{className:"ml-2 text-lg font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.label})]}),(null==l?void 0:l.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eM,{label:"Inputs"}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:null==l?void 0:l.map((e,l)=>(0,a.jsx)(eu,{node:t,data:e,type:"target",label:"inputs",index:l},"".concat(t.id,"_input_").concat(l)))})]}),(null==r?void 0:r.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eM,{label:"Parameters"}),(0,a.jsx)(D.default,{form:u,layout:"vertical",onValuesChange:m,className:"flex flex-col space-y-3 text-neutral-500",children:null==r?void 0:r.map((e,l)=>(0,a.jsx)(eL,{formValuesChange:m,node:t,paramData:e,label:"parameters",index:l},"".concat(t.id,"_param_").concat(l)))})]}),"operator"===o&&(null==s?void 0:s.length)>0?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eM,{label:"Outputs"}),(s||[]).map((e,l)=>(0,a.jsx)(eu,{node:t,data:e,type:"source",label:"outputs",index:l},"".concat(t.id,"_input_").concat(l)))]}):"resource"===o?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eM,{label:"Outputs"}),(0,a.jsx)(eu,{node:t,data:t,type:"source",label:"outputs",index:0},"".concat(t.id,"_input_0"))]}):void 0]})})}},eG={buttonedge:T.Z},e$=()=>{let{t:e}=(0,h.$G)(),t=(0,x.useSearchParams)(),l=(null==t?void 0:t.get("id"))||"",w=(0,j._K)(),[_,y]=(0,v.useState)(!1),[N,Z,k]=(0,j.Rr)([]),[C,P,I]=(0,j.ll)([]),S=(0,v.useRef)(null),[E,F]=(0,v.useState)(),[z,O]=(0,v.useState)(!1),[V,T]=(0,v.useState)(!1),[D,L]=(0,v.useState)(!1);async function M(){y(!0);let[e,t]=await (0,n.Vx)((0,n._d)(l));if(t){let e=(0,J.z5)(t.flow_data);F(t),Z(e.nodes),P(e.edges)}y(!1)}(0,v.useEffect)(()=>{l&&M()},[l]),(0,v.useEffect)(()=>{let e=e=>{e.returnValue=c.ZP};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let R=(0,v.useCallback)(e=>{var t,l;e.preventDefault();let a=S.current.getBoundingClientRect(),n=null===(t=null===(l=document.getElementsByClassName("ant-layout-sider"))||void 0===l?void 0:l[0])||void 0===t?void 0:t.offsetWidth,s=e.dataTransfer.getData("application/reactflow");if(!s||void 0===s)return;let r=JSON.parse(s),o=w.screenToFlowPosition({x:e.clientX-a.left+n,y:e.clientY-a.top}),i=(0,J.VZ)(r,w.getNodes());r.id=i;let d={id:i,position:o,type:"customNode",data:r};Z(e=>e.concat(d).map(e=>(e.id===d.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},[w]),B=(0,v.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]);function $(){let e=w.toObject(),[t,l,n]=(0,J.Rv)(e);if(!t&&n)return Z(e=>e.map(e=>(e.id===(null==l?void 0:l.id)?e.data={...e.data,invalid:!0}:e.data={...e.data,invalid:!1},e))),u.ZP.error({message:"Error",description:n,icon:(0,a.jsx)(r.Z,{className:"text-red-600"})});O(!0)}function q(){T(!0)}function K(){L(!0)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(A,{}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)(p.Z,{className:"my-2 mx-4 flex flex-row justify-end",children:(()=>{let t=[{title:e("Import"),icon:(0,a.jsx)(o.Z,{className:"block text-xl",onClick:K})},{title:e("save"),icon:(0,a.jsx)(i.Z,{className:"block text-xl",onClick:$})}];return""!==l&&t.unshift({title:e("Export"),icon:(0,a.jsx)(d.Z,{className:"block text-xl",onClick:q})}),t})().map(e=>{let{title:t,icon:l}=e;return(0,a.jsx)(f.Z,{title:t,className:"w-8 h-8 rounded-md bg-stone-300 dark:bg-zinc-700 dark:text-zinc-200 hover:text-blue-500 dark:hover:text-zinc-100",children:l},t)})}),(0,a.jsx)(m.Z,{className:"mt-0 mb-0"}),(0,a.jsx)("div",{className:"h-[calc(100vh-48px)] w-full",ref:S,children:(0,a.jsxs)(j.x$,{nodes:N,edges:C,nodeTypes:eB,edgeTypes:eG,onNodesChange:k,onEdgesChange:I,onNodeClick:function(e,t){w.setNodes(e=>e.map(e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},onConnect:function(e){let t={...e,type:"buttonedge",id:"".concat(e.source,"|").concat(e.target)};P(e=>(0,j.Z_)(t,e))},onDrop:R,onDragOver:B,minZoom:.1,fitView:!0,deleteKeyCode:["Backspace","Delete"],children:[(0,a.jsx)(g.Z,{className:"flex flex-row items-center",position:"bottom-center"}),(0,a.jsx)(b.A,{color:"#aaa",gap:16})]})})]})]}),(0,a.jsx)(s.Z,{visible:_}),(0,a.jsx)(W,{reactFlow:w,flowInfo:E,isSaveFlowModalOpen:z,setIsSaveFlowModalOpen:O}),(0,a.jsx)(G,{reactFlow:w,flowInfo:E,isExportFlowModalOpen:V,setIsExportFlowModalOpen:T}),(0,a.jsx)(U,{setNodes:Z,setEdges:P,isImportModalOpen:D,setIsImportFlowModalOpen:L})]})};function eq(){return(0,a.jsx)(j.tV,{children:(0,a.jsx)(e$,{})})}},67919:function(e,t,l){"use strict";l.d(t,{It:function(){return i},Rv:function(){return o},VZ:function(){return a},Wf:function(){return s},_g:function(){return n},z5:function(){return r}});let a=(e,t)=>{let l=0;return t.forEach(t=>{t.data.name===e.name&&l++}),"".concat(e.id,"_").concat(l)},n=e=>e.replace(/_\d+$/,""),s=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{positionAbsolute:t,...l}=e;return{position_absolute:t,...l}}),s=l.map(e=>{let{sourceHandle:t,targetHandle:l,...a}=e;return{source_handle:t,target_handle:l,...a}});return{nodes:n,edges:s,...a}},r=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{position_absolute:t,...l}=e;return{positionAbsolute:t,...l}}),s=l.map(e=>{let{source_handle:t,target_handle:l,...a}=e;return{sourceHandle:t,targetHandle:l,...a}});return{nodes:n,edges:s,...a}},o=e=>{let{nodes:t,edges:l}=e,a=[!0,t[0],""];e:for(let e=0;e<t.length;e++){let n=t[e].data,{inputs:s=[],parameters:r=[]}=n;for(let r=0;r<s.length;r++)if(!l.some(l=>l.targetHandle==="".concat(t[e].id,"|inputs|").concat(r))){a=[!1,t[e],"The input ".concat(s[r].type_name," of node ").concat(n.label," is required")];break e}for(let s=0;s<r.length;s++){let o=r[s];if(o.optional||"resource"!==o.category||l.some(l=>l.targetHandle==="".concat(t[e].id,"|parameters|").concat(s))){if(!o.optional&&"common"===o.category&&(void 0===o.value||null===o.value)){a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(n.label," is required")];break e}}else{a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(n.label," is required")];break e}}}return a},i=e=>(function e(t){if(Array.isArray(t))return t.map(t=>e(t));if(t&&"object"==typeof t&&!Array.isArray(t)){let l={};for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a)){let n=a.replace(/_([a-z])/g,(e,t)=>t.toUpperCase());l[n]=e(t[a])}return l}return t})(e)}},function(e){e.O(0,[3662,8241,2648,3791,2913,5278,4330,5030,4041,9859,3799,2684,1300,4567,7665,3457,5782,3764,1278,8914,7855,2490,9774,2888,179],function(){return e(e.s=94617)}),_N_E=e.O()}]);