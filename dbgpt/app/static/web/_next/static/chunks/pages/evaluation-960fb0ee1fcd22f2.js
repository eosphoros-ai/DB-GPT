(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4574],{57738:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/evaluation",function(){return a(75288)}])},75288:function(e,t,a){"use strict";a.r(t);var l=a(96469),n=a(38497),s=a(71841),d=a(55360),o=a(49030),i=a(10755),r=a(13419),c=a(70351),u=a(27691),m=a(67853),x=a(4162),p=a(60205),f=a(42518),h=a(197),v=a(89641),g=a(79839),b=a(39069),_=a(32818),j=a(27623),y=a(16602),w=a(39600),k=a(20222);let{TextArea:Z}=s.default,{useWatch:S}=d.default;t.default=e=>{let[t,a]=(0,n.useState)(!1),[C,I]=(0,n.useState)(!1),[P,F]=(0,n.useState)([]),[N,V]=(0,n.useState)(0),[O,R]=(0,n.useState)(0),[U,L]=(0,n.useState)(),[q,E]=(0,n.useState)(),[W,X]=(0,n.useState)(!1),[A,B]=(0,n.useState)("evaluations"),[K,T]=(0,n.useState)(!1),[J,$]=(0,n.useState)(!0),[D,M]=(0,n.useState)([{}]),[Y,z]=(0,n.useState)(),[H,G]=(0,n.useState)([]),[Q,ee]=(0,n.useState)(""),[et,ea]=(0,n.useState)(!1),[el,en]=(0,n.useState)(!1),[es,ed]=(0,n.useState)(!1),eo=(0,n.useMemo)(()=>null==H?void 0:H.map(e=>({label:null==e?void 0:e.name,value:null==e?void 0:e.code})),[H]),[ei]=d.default.useForm(),[er]=d.default.useForm(),{run:ec,loading:eu}=(0,y.Z)(async e=>{let[t,a]=await (0,j.Vx)((0,j.Kt)(e));return a},{manual:!0,onSuccess:e=>{console.log(e,null==e?void 0:e.map(e=>({label:e.describe,value:e.name}))),E(null==e?void 0:e.map(e=>({label:e.describe,value:e.name})))}}),{run:em,loading:ex}=(0,y.Z)(async e=>{let[t,a]=await (0,j.Vx)((0,j.YK)(e));return a},{manual:!0,onSuccess:e=>{e&&e.length&&(M(e),T(!0))}}),{run:ep}=(0,y.Z)(async()=>{let[e,t]=await (0,j.Vx)((0,j.B3)());return t},{onSuccess:e=>{e&&z(e.map(e=>{let[t,a]=Object.entries(e)[0];return{label:a,value:t}}))}}),{run:ef,loading:eh,refresh:ev}=(0,y.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[a,l]=await (0,j.Vx)((0,j.Wm)({page:e,page_size:t}));return l},{onSuccess:e=>{console.log(e),F(null==e?void 0:e.items),V(null==e?void 0:e.total_count)}}),{run:eg,loading:eb,refresh:e_}=(0,y.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[a,l]=await (0,j.Vx)((0,j.a$)({page:e,page_size:t}));return l},{onSuccess:e=>{G(null==e?void 0:e.items),R(null==e?void 0:e.total_count)}}),{run:ej,loading:ey,refresh:ew}=(0,y.Z)(async e=>{let[t,a]=await (0,j.Vx)((0,j.Xx)({...e}));return a},{manual:!0,onSuccess:e=>{F(null==e?void 0:e.items)}}),ek=[{title:"名称",dataIndex:"name",key:"name",width:"10%",fixed:"left"},{title:"编码",dataIndex:"code",key:"code",width:"20%"},{title:"储存方式",dataIndex:"storage_type",key:"storage_type"},{title:"数据集数量",dataIndex:"datasets_count",key:"datasets_count"},{title:"创建时间",dataIndex:"gmt_create",key:"gmt_create"},{title:"成员",dataIndex:"members",key:"members",width:"10%",render:e=>null==e?void 0:e.split(",").map(e=>(0,l.jsx)(o.Z,{children:e},e))},{title:"更新时间",dataIndex:"gmt_modified",key:"gmt_modified"},{title:"Action",key:"action",render:(e,t)=>(0,l.jsxs)(i.Z,{size:"middle",children:[(0,l.jsx)(r.Z,{title:"确认删除吗",onConfirm:async()=>{let[,,e]=await (0,j.Vx)((0,j.$E)({code:null==t?void 0:t.code}));console.log(e),(null==e?void 0:e.success)==!0&&(c.ZP.success("删除成功"),e_())},children:(0,l.jsx)(u.ZP,{type:"link",children:"删除"})}),(0,l.jsx)(u.ZP,{type:"link",onClick:()=>{var e;$(!1),I(!0),ee(null==t?void 0:t.code),er.setFieldsValue({dataset_name:null==t?void 0:t.name,members:null==t?void 0:null===(e=t.members)||void 0===e?void 0:e.split(",")})},children:"编辑"}),(0,l.jsx)(u.ZP,{type:"link",loading:es,onClick:async()=>{ed(!0);let e=await (0,j.Ug)({code:null==t?void 0:t.code}),a=e.headers["content-type"];if(a.includes("application/json")){let t=new FileReader;t.onload=()=>{try{let e=JSON.parse(t.result);c.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},t.readAsText(e.data)}else{let t=e.headers["content-disposition"],a="downloaded_file.xlsx";if(t){let e=t.match(/filename\*?="?(.+)"/);e[1]&&(a=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}));console.log(l,e);let n=document.createElement("a");n.href=l,n.download=a,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}ed(!1)},children:"下载"})]})}],eZ=[{title:"数据集名称",dataIndex:"datasets_name",key:"datasets_name",fixed:"left",width:"15%",render:e=>(0,l.jsx)("span",{style:{textWrap:"nowrap",maxWidth:"300px"},children:e})},{title:"测评状态",dataIndex:"state",key:"state",render:e=>(0,l.jsx)(m.Z,{style:{textWrap:"nowrap"},status:"failed"==e?"error":"success",text:e})},{title:"测评编码",dataIndex:"evaluate_code",key:"evaluate_code"},{title:"场景",dataIndex:"scene_key",key:"scene_key"},{title:"测评指标",dataIndex:"evaluate_metrics",key:"evaluate_metrics"},{title:"创建时间",dataIndex:"gmt_create",key:"gmt_create"},{title:"更新时间",dataIndex:"gmt_modified",key:"gmt_modified"},x.Z.EXPAND_COLUMN,{title:(0,l.jsxs)("span",{className:"w-[50px]",children:[(0,l.jsx)("span",{className:"text-nowrap",children:"详情"}),(0,l.jsx)(p.Z,{placement:"topLeft",title:"查看日志与评分",children:(0,l.jsx)(w.Z,{})})]}),render:()=>(0,l.jsx)("div",{style:{minWidth:"50px"}})},{title:"测评结果",key:"result",render:(e,t)=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.ZP,{type:"link",loading:ex,onClick:async()=>{em({evaluate_code:null==t?void 0:t.evaluate_code})},children:"评分明细"}),(0,l.jsx)(u.ZP,{type:"link",loading:es,onClick:async()=>{ed(!0);let e=await (0,j.XI)({evaluate_code:null==t?void 0:t.evaluate_code}),a=e.headers["content-type"];if(a.includes("application/json")){let t=new FileReader;t.onload=()=>{try{let e=JSON.parse(t.result);c.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},t.readAsText(e.data)}else{let t=e.headers["content-disposition"],a="downloaded_file.xlsx";if(t){let e=t.match(/filename\*?="?(.+)"/);e[1]&&(a=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}));console.log(l,e);let n=document.createElement("a");n.href=l,n.download=a,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}ed(!1)},children:"下载"})]})},{title:"操作",key:"action",width:"25%",render:(e,t)=>(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(r.Z,{title:"确认删除吗",onConfirm:async()=>{let[,,e]=await (0,j.Vx)((0,j.Wd)({evaluation_code:null==t?void 0:t.evaluate_code}));(null==e?void 0:e.success)==!0&&(c.ZP.success("删除成功"),ev())},children:(0,l.jsx)(u.ZP,{type:"link",children:"删除"})})})}],eS=()=>{T(!1)};return(0,l.jsx)(f.ZP,{theme:{components:{Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsxs)("div",{className:"px-6 py-2 overflow-y-auto",children:[(0,l.jsx)(h.Z,{className:"backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 border-2 border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:[{label:"评测数据",value:"evaluations"},{label:"数据集",value:"dataSet"}],onChange:e=>{B(e)},value:A}),"dataSet"===A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(u.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{I(!0),$(!0)},children:"添加数据集"})}),(0,l.jsx)(x.Z,{pagination:{total:O,onChange(e){eg(e)}},scroll:{x:1300},loading:eb,columns:ek,dataSource:H})]}),"evaluations"===A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(u.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{a(!0)},children:"发起评测"})}),(0,l.jsx)(x.Z,{pagination:{total:N,onChange(e){ef(e)}},rowKey:e=>e.evaluate_code,expandable:{expandedRowRender:e=>{let{average_score:t,log_info:a}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(()=>{if(!t)return(0,l.jsx)(l.Fragment,{});try{var e;let a=JSON.parse(t);return(0,l.jsx)("div",{className:"flex flex-row gap-1",children:null===(e=Object.entries(a))||void 0===e?void 0:e.map(e=>{let[t,a]=e;return(0,l.jsx)(v.Z,{title:t,value:a},t)})})}catch(e){return(0,l.jsx)(l.Fragment,{})}})(),a&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 text-sm",children:"log："}),(0,l.jsx)("span",{children:a})]})]})}},scroll:{x:"100%"},loading:eh,columns:eZ,dataSource:P})]}),(0,l.jsx)(g.default,{title:"发起测评",open:t,onOk:async()=>{let e=await ei.validateFields();if(en(!0),e){let[,,t]=await (0,j.Vx)((0,j.kg)({...e}));(null==t?void 0:t.success)&&(c.ZP.success("发起成功"),ev(),ei.resetFields())}a(!1),en(!1)},confirmLoading:el,onCancel:()=>{a(!1)},children:(0,l.jsxs)(d.default,{name:"basic",form:ei,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(d.default.Item,{name:"scene_key",label:"场景类型",rules:[{required:!0}],children:(0,l.jsx)(b.default,{options:[{value:"recall",label:"recall"},{value:"app",label:"app"}],onChange:async e=>{if(X(!0),ei.setFieldValue("scene_value",""),"recall"===e){let e=await (0,j.Vm)();e.data.success&&L(e.data.data.map(e=>({label:e.name,value:e.id.toString()})))}else{let e=await (0,j.yk)({});e.data.success&&L(e.data.data.app_list.map(e=>({label:e.app_name,value:e.app_code})))}X(!1)}})}),(0,l.jsx)(d.default.Item,{name:"scene_value",label:"场景参数",rules:[{required:!0}],children:(0,l.jsx)(b.default,{loading:W,disabled:W,options:U,onChange:e=>{ei.getFieldValue("scene_key")&&ec({scene_key:ei.getFieldValue("scene_key"),scene_value:e})}})}),(0,l.jsx)(d.default.Item,{name:"parallel_num",label:"并行参数",rules:[{required:!0}],initialValue:1,children:(0,l.jsx)(s.default,{})}),(0,l.jsx)(d.default.Item,{name:"datasets",label:"数据集",rules:[{required:!0}],children:(0,l.jsx)(b.default,{options:eo})}),(0,l.jsx)(d.default.Item,{name:"evaluate_metrics",label:"评测指标",rules:[{required:"app"===S("scene_key",ei)}],children:(0,l.jsx)(b.default,{loading:eu,disabled:eu,options:q})})]})}),(0,l.jsx)(g.default,{title:J?"添加数据集":"编辑数据集",open:C,confirmLoading:et,onOk:()=>{er.validateFields().then(e=>{if(ea(!0),J){let t=e.storage_type;if("oss"===t){let t=new FormData;t.append("dataset_name",e.dataset_name),e.members&&t.append("members",e.members.join(","));let a=e.doc_file.file;t.append("doc_file",a,a.name),(0,j.L$)(t).then(e=>{console.log(e),e.data.success?(c.ZP.success("上传成功"),eg()):c.ZP.error(e.data.err_msg)}).catch(e=>{var t,a;console.error("上传失败",e),c.ZP.error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.err_msg)||"上传失败")}).finally(()=>{I(!1),ea(!1)})}else"db"===t&&(0,j.h)({dataset_name:e.dataset_name,members:e.members.join(","),content:e.content}).then(e=>{console.log(e),e.data.success?(c.ZP.success("上传成功"),eg()):c.ZP.error(e.data.err_msg)}).catch(e=>{var t,a;console.log(e),c.ZP.error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.err_msg)||"上传失败")}).finally(()=>{I(!1),ea(!1),er.resetFields()})}else(0,j.w_)({code:Q,members:e.members.join(",")}).then(e=>{e.data.success?(c.ZP.success("更新成功"),eg()):c.ZP.error(e.data.err_msg)}).catch(e=>{console.log(e),c.ZP.error("更新失败")}).finally(()=>{I(!1),ea(!1)})})},onCancel:()=>{I(!1)},children:(0,l.jsxs)(d.default,{name:"basic",form:er,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(d.default.Item,{name:"dataset_name",label:"名称",rules:[{required:!0}],children:(0,l.jsx)(s.default,{disabled:!J})}),(0,l.jsx)(d.default.Item,{name:"members",label:"成员",children:(0,l.jsx)(b.default,{mode:"tags"})}),J&&(0,l.jsx)(d.default.Item,{name:"storage_type",label:"储存类型",rules:[{required:!0}],children:(0,l.jsx)(b.default,{options:Y})}),"oss"===S("storage_type",er)&&J&&(0,l.jsx)(d.default.Item,{name:"doc_file",label:"doc_file",rules:[{required:!0}],children:(0,l.jsx)(_.default,{name:"dataSet",maxCount:1,beforeUpload:e=>(er.setFieldsValue({doc_file:e}),!1),onRemove:()=>{er.setFieldsValue({doc_file:void 0})},children:(0,l.jsx)(u.ZP,{icon:(0,l.jsx)(k.Z,{}),children:"Click to Upload"})})}),"db"===S("storage_type",er)&&J&&(0,l.jsx)(d.default.Item,{name:"content",label:"content",rules:[{required:!0}],children:(0,l.jsx)(Z,{rows:8})})]})}),(0,l.jsx)(g.default,{title:"评分明细",open:K,onOk:eS,onCancel:eS,styles:{body:{maxHeight:"500px",overflowY:"auto",minWidth:"700px"}},style:{minWidth:"750px"},footer:[(0,l.jsx)(u.ZP,{onClick:eS,children:"返回"},"back")],children:(0,l.jsx)(x.Z,{columns:Object.keys(null==D?void 0:D[0]).map(e=>({title:e,dataIndex:e,key:e})),style:{minWidth:"700px"},dataSource:D,rowKey:(e,t)=>null==t?void 0:t.toString(),pagination:!1})})]})})})}}},function(e){e.O(0,[2394,2003,5677,1841,5722,2786,335,9069,5360,2818,1320,9223,5444,2476,4162,7458,9774,2888,179],function(){return e(e.s=57738)}),_N_E=e.O()}]);