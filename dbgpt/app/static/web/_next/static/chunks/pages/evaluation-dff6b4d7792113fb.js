(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4574],{40201:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/evaluation",function(){return a(38266)}])},38266:function(e,t,a){"use strict";a.r(t);var l=a(85893),n=a(76212),s=a(45605),d=a(88484),i=a(65654),o=a(25278),r=a(99859),c=a(66309),u=a(42075),m=a(86738),x=a(45360),p=a(14726),f=a(40411),h=a(39773),v=a(83062),g=a(28459),_=a(92783),b=a(55054),j=a(85576),y=a(34041),w=a(23799),k=a(67294);let{TextArea:Z}=o.default,{useWatch:S}=r.default;t.default=()=>{let[e,t]=(0,k.useState)(!1),[a,C]=(0,k.useState)(!1),[I,P]=(0,k.useState)([]),[F,N]=(0,k.useState)(0),[V,O]=(0,k.useState)(0),[R,U]=(0,k.useState)(),[L,q]=(0,k.useState)(),[E,W]=(0,k.useState)(!1),[A,K]=(0,k.useState)("evaluations"),[T,X]=(0,k.useState)(!1),[B,J]=(0,k.useState)(!0),[$,D]=(0,k.useState)([{}]),[M,Y]=(0,k.useState)(),[z,H]=(0,k.useState)([]),[G,Q]=(0,k.useState)(""),[ee,et]=(0,k.useState)(!1),[ea,el]=(0,k.useState)(!1),[en,es]=(0,k.useState)(!1),ed=(0,k.useMemo)(()=>null==z?void 0:z.map(e=>({label:null==e?void 0:e.name,value:null==e?void 0:e.code})),[z]),[ei]=r.default.useForm(),[eo]=r.default.useForm(),{run:er,loading:ec}=(0,i.Z)(async e=>{let[t,a]=await (0,n.Vx)((0,n.Kt)(e));return a},{manual:!0,onSuccess:e=>{q(null==e?void 0:e.map(e=>({label:e.describe,value:e.name})))}}),{run:eu,loading:em}=(0,i.Z)(async e=>{let[t,a]=await (0,n.Vx)((0,n.YK)(e));return a},{manual:!0,onSuccess:e=>{e&&e.length&&(D(e),X(!0))}}),{run:ex,loading:ep,refresh:ef}=(0,i.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[a,l]=await (0,n.Vx)((0,n.Wm)({page:e,page_size:t}));return l},{onSuccess:e=>{P(null==e?void 0:e.items),N(null==e?void 0:e.total_count)}}),{run:eh,loading:ev,refresh:eg}=(0,i.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[a,l]=await (0,n.Vx)((0,n.a$)({page:e,page_size:t}));return l},{onSuccess:e=>{H(null==e?void 0:e.items),O(null==e?void 0:e.total_count)}}),e_=[{title:"名称",dataIndex:"name",key:"name",width:"10%",fixed:"left"},{title:"编码",dataIndex:"code",key:"code",width:"20%"},{title:"储存方式",dataIndex:"storage_type",key:"storage_type"},{title:"数据集数量",dataIndex:"datasets_count",key:"datasets_count"},{title:"创建时间",dataIndex:"gmt_create",key:"gmt_create"},{title:"成员",dataIndex:"members",key:"members",width:"10%",render:e=>null==e?void 0:e.split(",").map(e=>(0,l.jsx)(c.Z,{children:e},e))},{title:"更新时间",dataIndex:"gmt_modified",key:"gmt_modified"},{title:"Action",key:"action",render:(e,t)=>(0,l.jsxs)(u.Z,{size:"middle",children:[(0,l.jsx)(m.Z,{title:"确认删除吗",onConfirm:async()=>{let[,,e]=await (0,n.Vx)((0,n.$E)({code:null==t?void 0:t.code}));(null==e?void 0:e.success)==!0&&(x.ZP.success("删除成功"),eg())},children:(0,l.jsx)(p.ZP,{type:"link",children:"删除"})}),(0,l.jsx)(p.ZP,{type:"link",onClick:()=>{var e;J(!1),C(!0),Q(null==t?void 0:t.code),eo.setFieldsValue({dataset_name:null==t?void 0:t.name,members:null==t?void 0:null===(e=t.members)||void 0===e?void 0:e.split(",")})},children:"编辑"}),(0,l.jsx)(p.ZP,{type:"link",loading:en,onClick:async()=>{es(!0);let e=await (0,n.Ug)({code:null==t?void 0:t.code}),a=e.headers["content-type"];if(a.includes("application/json")){let t=new FileReader;t.onload=()=>{try{let e=JSON.parse(t.result);x.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},t.readAsText(e.data)}else{let t=e.headers["content-disposition"],a="downloaded_file.xlsx";if(t){let e=t.match(/filename\*?="?(.+)"/);e[1]&&(a=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),n=document.createElement("a");n.href=l,n.download=a,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}es(!1)},children:"下载"})]})}],eb=[{title:"数据集名称",dataIndex:"datasets_name",key:"datasets_name",fixed:"left",width:"15%",render:e=>(0,l.jsx)("span",{style:{textWrap:"nowrap",maxWidth:"300px"},children:e})},{title:"测评状态",dataIndex:"state",key:"state",render:e=>(0,l.jsx)(f.Z,{style:{textWrap:"nowrap"},status:"failed"==e?"error":"success",text:e})},{title:"测评编码",dataIndex:"evaluate_code",key:"evaluate_code"},{title:"场景",dataIndex:"scene_key",key:"scene_key"},{title:"测评指标",dataIndex:"evaluate_metrics",key:"evaluate_metrics"},{title:"创建时间",dataIndex:"gmt_create",key:"gmt_create"},{title:"更新时间",dataIndex:"gmt_modified",key:"gmt_modified"},h.Z.EXPAND_COLUMN,{title:(0,l.jsxs)("span",{className:"w-[50px]",children:[(0,l.jsx)("span",{className:"text-nowrap",children:"详情"}),(0,l.jsx)(v.Z,{placement:"topLeft",title:"查看日志与评分",children:(0,l.jsx)(s.Z,{})})]}),render:()=>(0,l.jsx)("div",{style:{minWidth:"50px"}})},{title:"测评结果",key:"result",render:(e,t)=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.ZP,{type:"link",loading:em,onClick:async()=>{eu({evaluate_code:null==t?void 0:t.evaluate_code})},children:"评分明细"}),(0,l.jsx)(p.ZP,{type:"link",loading:en,onClick:async()=>{es(!0);let e=await (0,n.XI)({evaluate_code:null==t?void 0:t.evaluate_code}),a=e.headers["content-type"];if(a.includes("application/json")){let t=new FileReader;t.onload=()=>{try{let e=JSON.parse(t.result);x.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},t.readAsText(e.data)}else{let t=e.headers["content-disposition"],a="downloaded_file.xlsx";if(t){let e=t.match(/filename\*?="?(.+)"/);e[1]&&(a=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),n=document.createElement("a");n.href=l,n.download=a,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l)}es(!1)},children:"下载"})]})},{title:"操作",key:"action",width:"25%",render:(e,t)=>(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(m.Z,{title:"确认删除吗",onConfirm:async()=>{let[,,e]=await (0,n.Vx)((0,n.Wd)({evaluation_code:null==t?void 0:t.evaluate_code}));(null==e?void 0:e.success)==!0&&(x.ZP.success("删除成功"),ef())},children:(0,l.jsx)(p.ZP,{type:"link",children:"删除"})})})}],ej=()=>{X(!1)};return(0,l.jsx)(g.ZP,{theme:{components:{Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsxs)("div",{className:"px-6 py-2 overflow-y-auto",children:[(0,l.jsx)(_.Z,{className:"backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 border-2 border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:[{label:"评测数据",value:"evaluations"},{label:"数据集",value:"dataSet"}],onChange:e=>{K(e)},value:A}),"dataSet"===A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(p.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{C(!0),J(!0)},children:"添加数据集"})}),(0,l.jsx)(h.Z,{pagination:{total:V,onChange(e){eh(e)}},scroll:{x:1300},loading:ev,columns:e_,dataSource:z})]}),"evaluations"===A&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(p.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{t(!0)},children:"发起评测"})}),(0,l.jsx)(h.Z,{pagination:{total:F,onChange(e){ex(e)}},rowKey:e=>e.evaluate_code,expandable:{expandedRowRender:e=>{let{average_score:t,log_info:a}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(()=>{if(!t)return(0,l.jsx)(l.Fragment,{});try{var e;let a=JSON.parse(t);return(0,l.jsx)("div",{className:"flex flex-row gap-1",children:null===(e=Object.entries(a))||void 0===e?void 0:e.map(e=>{let[t,a]=e;return(0,l.jsx)(b.Z,{title:t,value:a},t)})})}catch(e){return(0,l.jsx)(l.Fragment,{})}})(),a&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 text-sm",children:"log："}),(0,l.jsx)("span",{children:a})]})]})}},scroll:{x:"100%"},loading:ep,columns:eb,dataSource:I})]}),(0,l.jsx)(j.default,{title:"发起测评",open:e,onOk:async()=>{let e=await ei.validateFields();if(el(!0),e){let[,,t]=await (0,n.Vx)((0,n.kg)({...e}));(null==t?void 0:t.success)&&(x.ZP.success("发起成功"),ef(),ei.resetFields())}t(!1),el(!1)},confirmLoading:ea,onCancel:()=>{t(!1)},children:(0,l.jsxs)(r.default,{name:"basic",form:ei,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(r.default.Item,{name:"scene_key",label:"场景类型",rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:[{value:"recall",label:"recall"},{value:"app",label:"app"}],onChange:async e=>{if(W(!0),ei.setFieldValue("scene_value",""),"recall"===e){let e=await (0,n.Vm)();e.data.success&&U(e.data.data.map(e=>({label:e.name,value:e.id.toString()})))}else{let e=await (0,n.yk)({});e.data.success&&U(e.data.data.app_list.map(e=>({label:e.app_name,value:e.app_code})))}W(!1)}})}),(0,l.jsx)(r.default.Item,{name:"scene_value",label:"场景参数",rules:[{required:!0}],children:(0,l.jsx)(y.default,{loading:E,disabled:E,options:R,onChange:e=>{ei.getFieldValue("scene_key")&&er({scene_key:ei.getFieldValue("scene_key"),scene_value:e})}})}),(0,l.jsx)(r.default.Item,{name:"parallel_num",label:"并行参数",rules:[{required:!0}],initialValue:1,children:(0,l.jsx)(o.default,{})}),(0,l.jsx)(r.default.Item,{name:"datasets",label:"数据集",rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:ed})}),(0,l.jsx)(r.default.Item,{name:"evaluate_metrics",label:"评测指标",rules:[{required:"app"===S("scene_key",ei)}],children:(0,l.jsx)(y.default,{loading:ec,disabled:ec,options:L})})]})}),(0,l.jsx)(j.default,{title:B?"添加数据集":"编辑数据集",open:a,confirmLoading:ee,onOk:()=>{eo.validateFields().then(e=>{if(et(!0),B){let t=e.storage_type;if("oss"===t){let t=new FormData;t.append("dataset_name",e.dataset_name),e.members&&t.append("members",e.members.join(","));let a=e.doc_file.file;t.append("doc_file",a,a.name),(0,n.L$)(t).then(e=>{e.data.success?(x.ZP.success("上传成功"),eh()):x.ZP.error(e.data.err_msg)}).catch(e=>{var t,a;console.error("上传失败",e),x.ZP.error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.err_msg)||"上传失败")}).finally(()=>{C(!1),et(!1)})}else"db"===t&&(0,n.h)({dataset_name:e.dataset_name,members:e.members.join(","),content:e.content}).then(e=>{e.data.success?(x.ZP.success("上传成功"),eh()):x.ZP.error(e.data.err_msg)}).catch(e=>{var t,a;console.log(e),x.ZP.error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.err_msg)||"上传失败")}).finally(()=>{C(!1),et(!1),eo.resetFields()})}else(0,n.w_)({code:G,members:e.members.join(",")}).then(e=>{e.data.success?(x.ZP.success("更新成功"),eh()):x.ZP.error(e.data.err_msg)}).catch(e=>{console.log(e),x.ZP.error("更新失败")}).finally(()=>{C(!1),et(!1)})})},onCancel:()=>{C(!1)},children:(0,l.jsxs)(r.default,{name:"basic",form:eo,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(r.default.Item,{name:"dataset_name",label:"名称",rules:[{required:!0}],children:(0,l.jsx)(o.default,{disabled:!B})}),(0,l.jsx)(r.default.Item,{name:"members",label:"成员",children:(0,l.jsx)(y.default,{mode:"tags"})}),B&&(0,l.jsx)(r.default.Item,{name:"storage_type",label:"储存类型",rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:M})}),"oss"===S("storage_type",eo)&&B&&(0,l.jsx)(r.default.Item,{name:"doc_file",label:"doc_file",rules:[{required:!0}],children:(0,l.jsx)(w.default,{name:"dataSet",maxCount:1,beforeUpload:e=>(eo.setFieldsValue({doc_file:e}),!1),onRemove:()=>{eo.setFieldsValue({doc_file:void 0})},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(d.Z,{}),children:"Click to Upload"})})}),"db"===S("storage_type",eo)&&B&&(0,l.jsx)(r.default.Item,{name:"content",label:"content",rules:[{required:!0}],children:(0,l.jsx)(Z,{rows:8})})]})}),(0,l.jsx)(j.default,{title:"评分明细",open:T,onOk:ej,onCancel:ej,styles:{body:{maxHeight:"500px",overflowY:"auto",minWidth:"700px"}},style:{minWidth:"750px"},footer:[(0,l.jsx)(p.ZP,{onClick:ej,children:"返回"},"back")],children:(0,l.jsx)(h.Z,{columns:Object.keys(null==$?void 0:$[0]).map(e=>({title:e,dataIndex:e,key:e})),style:{minWidth:"700px"},dataSource:$,rowKey:"code",pagination:!1})})]})})})}}},function(e){e.O(0,[2648,3791,2913,5278,4330,8791,5418,4041,9859,3799,1300,4567,7665,9773,2783,5248,9774,2888,179],function(){return e(e.s=40201)}),_N_E=e.O()}]);