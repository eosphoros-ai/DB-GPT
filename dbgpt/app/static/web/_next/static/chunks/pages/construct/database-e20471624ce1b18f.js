(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{46584:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(42096),l=a(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"},r=a(55032),i=l.forwardRef(function(e,t){return l.createElement(r.Z,(0,s.Z)({},e,{ref:t,icon:n}))})},55861:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(42096),l=a(38497),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},r=a(55032),i=l.forwardRef(function(e,t){return l.createElement(r.Z,(0,s.Z)({},e,{ref:t,icon:n}))})},77200:function(e,t,a){"use strict";var s=a(33587),l=a(38497),n=a(60654);t.Z=function(e,t){(0,l.useEffect)(function(){var t=e(),a=!1;return!function(){(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:if(!(0,n.mf)(t[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,t.next()];case 2:if(e.sent().done||a)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,t];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){a=!0}},t)}},70351:function(e,t,a){"use strict";var s=a(72991),l=a(38497),n=a(94857),r=a(453),i=a(63346),c=a(42518),o=a(1842),d=a(80918),u=a(38875);let m=null,f=e=>e(),p=[],h={};function x(){let{getContainer:e,duration:t,rtl:a,maxCount:s,top:l}=h,n=(null==e?void 0:e())||document.body;return{getContainer:()=>n,duration:t,rtl:a,maxCount:s,top:l}}let b=l.forwardRef((e,t)=>{let{messageConfig:a,sync:s}=e,{getPrefixCls:n}=(0,l.useContext)(i.E_),c=h.prefixCls||n("message"),o=(0,l.useContext)(r.J),[u,m]=(0,d.K)(Object.assign(Object.assign(Object.assign({},a),{prefixCls:c}),o.message));return l.useImperativeHandle(t,()=>{let e=Object.assign({},u);return Object.keys(e).forEach(t=>{e[t]=function(){return s(),u[t].apply(u,arguments)}}),{instance:e,sync:s}}),m}),j=l.forwardRef((e,t)=>{let[a,s]=l.useState(x),n=()=>{s(x)};l.useEffect(n,[]);let r=(0,c.w6)(),i=r.getRootPrefixCls(),o=r.getIconPrefixCls(),d=r.getTheme(),u=l.createElement(b,{ref:t,sync:n,messageConfig:a});return l.createElement(c.ZP,{prefixCls:i,iconPrefixCls:o,theme:d},r.holderRender?r.holderRender(u):u)});function g(){if(!m){let e=document.createDocumentFragment(),t={fragment:e};m=t,f(()=>{(0,n.s)(l.createElement(j,{ref:e=>{let{instance:a,sync:s}=e||{};Promise.resolve().then(()=>{!t.instance&&a&&(t.instance=a,t.sync=s,g())})}}),e)});return}m.instance&&(p.forEach(e=>{let{type:t,skipped:a}=e;if(!a)switch(t){case"open":f(()=>{let t=m.instance.open(Object.assign(Object.assign({},h),e.config));null==t||t.then(e.resolve),e.setCloseFn(t)});break;case"destroy":f(()=>{null==m||m.instance.destroy(e.key)});break;default:f(()=>{var a;let l=(a=m.instance)[t].apply(a,(0,s.Z)(e.args));null==l||l.then(e.resolve),e.setCloseFn(l)})}}),p=[])}let v={open:function(e){let t=(0,u.J)(t=>{let a;let s={type:"open",config:e,resolve:t,setCloseFn:e=>{a=e}};return p.push(s),()=>{a?f(()=>{a()}):s.skipped=!0}});return g(),t},destroy:e=>{p.push({type:"destroy",key:e}),g()},config:function(e){h=Object.assign(Object.assign({},h),e),f(()=>{var e;null===(e=null==m?void 0:m.sync)||void 0===e||e.call(m)})},useMessage:d.Z,_InternalPanelDoNotUseOrYouWillBeFired:o.ZP};["success","info","warning","error","loading"].forEach(e=>{v[e]=function(){for(var t=arguments.length,a=Array(t),s=0;s<t;s++)a[s]=arguments[s];return function(e,t){(0,c.w6)();let a=(0,u.J)(a=>{let s;let l={type:e,args:t,resolve:a,setCloseFn:e=>{s=e}};return p.push(l),()=>{s?f(()=>{s()}):l.skipped=!0}});return g(),a}(e,a)}}),t.ZP=v},77023:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return a(42253)}])},18458:function(e,t,a){"use strict";var s=a(96469),l=a(37022);t.Z=function(e){let{visible:t}=e;return t?(0,s.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,s.jsx)(l.Z,{})}):null}},86059:function(e,t,a){"use strict";var s=a(96469),l=a(67901),n=a(31183),r=a(51382),i=a(42834),c=a(43738),o=a(92026),d=a(61760),u=a(94918),m=a(42518),f=a(5996),p=a(83930),h=a(87313);a(38497),a(41748),t.Z=function(e){let{children:t}=e,a=[{key:"app",name:(0,p.t)("App"),path:"/app",icon:(0,s.jsx)(n.Z,{})},{key:"flow",name:(0,p.t)("awel_flow"),icon:(0,s.jsx)(r.Z,{}),path:"/flow"},{key:"models",name:(0,p.t)("model_manage"),path:"/models",icon:(0,s.jsx)(i.Z,{component:l.IN})},{key:"database",name:(0,p.t)("Database"),icon:(0,s.jsx)(c.Z,{}),path:"/database"},{key:"knowledge",name:(0,p.t)("Knowledge_Space"),icon:(0,s.jsx)(o.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,p.t)("Prompt"),icon:(0,s.jsx)(d.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,p.t)("dbgpts_community"),path:"/dbgpts",icon:(0,s.jsx)(u.Z,{})}],x=(0,h.useRouter)(),b=x.pathname.split("/")[2];return(0,s.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,s.jsx)(m.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,s.jsx)(f.Z,{activeKey:b,items:a.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{x.push("/construct/".concat(e))}})})})}},42253:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R},isFileDb:function(){return D}});var s=a(96469),l=a(27623),n=a(49030),r=a(62971),i=a(60205),c=a(26869),o=a.n(c),d=a(23852),u=a.n(d),m=a(38497),f=(0,m.memo)(function(e){let{icon:t,iconBorder:a=!0,title:l,desc:c,tags:d,children:f,disabled:p,operations:h,className:x,extraContent:b,...j}=e,g=(0,m.useMemo)(()=>t?"string"==typeof t?(0,s.jsx)(u(),{className:o()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":a}),width:48,height:48,src:t,alt:l}):t:null,[t]),v=(0,m.useMemo)(()=>d&&d.length?(0,s.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:d.map((e,t)=>{var a;return"string"==typeof e?(0,s.jsx)(n.Z,{className:"text-xs",bordered:!1,color:"default",children:e},t):(0,s.jsx)(n.Z,{className:"text-xs",bordered:null!==(a=e.border)&&void 0!==a&&a,color:e.color,children:e.text},t)})}):null,[d]);return(0,s.jsxs)("div",{className:o()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":p,"cursor-pointer":!p&&!!j.onClick},x),...j,children:[(0,s.jsxs)("div",{className:"p-4 0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[g,(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)(r.Z,{title:l,children:(0,s.jsx)("h2",{className:"text-sm font-semibold line-clamp-1 pr-8",children:l})}),v]})]}),c&&(0,s.jsx)(i.Z,{title:c,children:(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:c})})]}),(0,s.jsxs)("div",{children:[f,h&&!!h.length&&(0,s.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:h.map((e,t)=>(0,s.jsx)(i.Z,{title:e.label,children:(0,s.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:t=>{var a;t.stopPropagation(),null===(a=e.onClick)||void 0===a||a.call(e)},children:[e.children,t<h.length-1&&(0,s.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(t)))})]}),(0,s.jsx)("div",{className:"absolute top-2 right-4 ",children:b})]})}),p=a(18458),h=a(47019),x=a(55360),b=a(70351),j=a(79839),g=a(39069),v=a(42786),y=a(71841),_=a(91103),w=a(27691),N=a(56841),Z=function(e){let{open:t,choiceDBType:a,dbTypeList:n,editValue:r,dbNames:c,onClose:o,onSuccess:d}=e,[u,f]=(0,m.useState)(!1),{t:p}=(0,N.$G)(),[Z]=x.default.useForm(),k=x.default.useWatch("db_type",Z),[C,P]=(0,m.useState)([]),[E,F]=(0,m.useState)(!1),S=(0,m.useMemo)(()=>D(n,k),[n,k]);(0,m.useEffect)(()=>{a&&Z.setFieldValue("db_type",a)},[a]),(0,m.useEffect)(()=>{r&&(Z.setFieldsValue({...r}),"omc"===r.db_type&&Z.setFieldValue("db_arn",r.db_path))},[r]),(0,m.useEffect)(()=>{t||Z.resetFields()},[t]);let I=async e=>{let{db_host:t,db_path:a,db_port:s,db_type:n,...i}=e;if(f(!0),"omc"===n){let t=null==C?void 0:C.find(t=>t.arn===e.db_name);try{let[a]=await (0,l.Vx)((0,l.Jm)({db_type:"omc",file_path:e.db_arn||"",comment:e.comment,db_name:(null==t?void 0:t.dbName)||e.db_name}));if(a){b.ZP.error(a.message);return}b.ZP.success("success"),null==d||d()}catch(e){b.ZP.error(e.message)}finally{f(!1)}}if(!r&&c.some(e=>e===i.db_name)){b.ZP.error("The database already exists!");return}let o={db_host:S?void 0:t,db_port:S?void 0:s,db_type:n,file_path:S?a:void 0,...i};try{let[e]=await (0,l.Vx)((0,l.KS)(o));if(e)return;let[t]=await (0,l.Vx)((r?l.mR:l.b_)(o));if(t){b.ZP.error(t.message);return}b.ZP.success("success"),null==d||d()}catch(e){b.ZP.error(e.message)}finally{f(!1)}},{run:O}=(0,h.Z)(async e=>{F(!0);let[t,a=[]]=await (0,l.Vx)((0,l.bf)(e));F(!1),P(a.map(e=>({...e,label:e.dbName,value:e.arn})))},{wait:500}),T=(0,m.useMemo)(()=>!!r||!!a,[r,a]);return(0,s.jsx)(j.default,{open:t,width:800,title:p(r?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:o,children:(0,s.jsxs)(x.default,{form:Z,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:I,children:[(0,s.jsx)(x.default.Item,{name:"db_type",label:"DB Type",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(g.default,{"aria-readonly":T,disabled:T,options:n})}),"omc"===Z.getFieldValue("db_type")?(0,s.jsx)(x.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(g.default,{optionRender:(e,t)=>{let{index:a}=t,l=C[a];return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-[18px]",children:null==l?void 0:l.dbName}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"env: "}),(0,s.jsx)("span",{className:"text-gray-500",children:l.env})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"account: "}),(0,s.jsx)("span",{className:"text-gray-500",children:l.account})]}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{children:"searchName: "}),(0,s.jsx)(i.Z,{title:l.searchName,children:(0,s.jsx)("span",{className:"text-gray-500",children:l.searchName})})]})]},e.value)},notFoundContent:E?(0,s.jsx)(v.Z,{size:"small"}):null,showSearch:!0,options:C,onSearch:O,onSelect:e=>{let t=null==C?void 0:C.find(t=>t.value===e);Z.setFieldsValue({db_arn:null==t?void 0:t.arn})}})}):(0,s.jsx)(x.default.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,s.jsx)(y.default,{readOnly:!!r,disabled:!!r})}),!0===S&&(0,s.jsx)(x.default.Item,{name:"db_path",label:"Path",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(y.default,{})}),!1===S&&"omc"!==Z.getFieldValue("db_type")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.default.Item,{name:"db_user",label:"Username",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(y.default,{})}),(0,s.jsx)(x.default.Item,{name:"db_pwd",label:"Password",className:"mb-6",rules:[{required:!1}],children:(0,s.jsx)(y.default,{type:"password"})}),(0,s.jsx)(x.default.Item,{name:"db_host",label:"Host",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(y.default,{})}),(0,s.jsx)(x.default.Item,{name:"db_port",label:"Port",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(_.Z,{min:1,step:1,max:65535})})]}),"omc"===Z.getFieldValue("db_type")&&(0,s.jsx)(x.default.Item,{name:"db_arn",label:"Arn",className:"mb-6",rules:[{required:!0}],children:(0,s.jsx)(y.default,{})}),(0,s.jsx)(x.default.Item,{name:"comment",label:"Remark",className:"mb-6",children:(0,s.jsx)(y.default,{})}),(0,s.jsxs)(x.default.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,s.jsx)(w.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:u,children:"Save"}),(0,s.jsx)(w.ZP,{size:"middle",onClick:o,children:"Cancel"})]})]})})},k=a(86059),C=a(7289),P=a(97511),E=a(55861),F=a(46584),S=a(77200),I=a(67853),O=a(51657),T=a(67343),V=a(6889);function D(e,t){var a;return null===(a=e.find(e=>e.value===t))||void 0===a?void 0:a.isFileDb}var R=function(){let{t:e}=(0,N.$G)(),[t,a]=(0,m.useState)([]),[n,r]=(0,m.useState)([]),[i,c]=(0,m.useState)(!1),[o,d]=(0,m.useState)({open:!1}),[u,h]=(0,m.useState)({open:!1}),x=async()=>{let[,e]=await (0,l.Vx)((0,l.t$)());r(null!=e?e:[])},g=async()=>{c(!0);let[,e]=await (0,l.Vx)((0,l.Bw)());a(null!=e?e:[]),c(!1)},v=(0,m.useMemo)(()=>{let e=n.map(e=>{let{db_type:t,is_file_db:a}=e;return{...C.S$[t],value:t,isFileDb:a}}),t=Object.keys(C.S$).filter(t=>!e.some(e=>e.value===t)).map(e=>({...C.S$[e],value:C.S$[e].label,disabled:!0}));return[...e,...t]},[n]),y=e=>{d({open:!0,info:e})},_=e=>{j.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise((t,a)=>{D(e.db_name,t,a)})})},D=async(e,t,a)=>{try{let[s]=await (0,l.Vx)((0,l.J5)(e));if(s){b.ZP.error(s.message),a();return}b.ZP.success("success"),g(),t()}catch(e){a()}},R=(0,m.useMemo)(()=>{let e=v.reduce((e,a)=>(e[a.value]=t.filter(e=>e.db_type===a.value),e),{});return e},[t,v]);(0,S.Z)(async()=>{await g(),await x()},[]);let B=e=>{let a=t.filter(t=>t.db_type===e.value);h({open:!0,dbList:a,name:e.label,type:e.value})};return(0,s.jsx)(k.Z,{children:(0,s.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,s.jsx)(p.Z,{visible:i}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("div",{className:"flex items-center gap-4"}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)(w.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,s.jsx)(P.Z,{}),onClick:()=>{d({open:!0})},children:e("Add_Datasource")})})]}),(0,s.jsx)("div",{className:"flex flex-wrap mx-[-8px] gap-2 md:gap-4",children:v.map(e=>{var t,a;return(0,s.jsx)(I.Z,{count:null===(t=R[e.value])||void 0===t?void 0:t.length,className:"min-h-fit",children:(0,s.jsx)(f,{className:"h-full",title:e.label,desc:null!==(a=e.desc)&&void 0!==a?a:"",disabled:e.disabled,icon:e.icon,onClick:()=>{e.disabled||B(e)}})},e.value)})}),(0,s.jsx)(Z,{open:o.open,dbTypeList:v,choiceDBType:o.dbType,editValue:o.info,dbNames:t.map(e=>e.db_name),onSuccess:()=>{d({open:!1}),g()},onClose:()=>{d({open:!1})}}),(0,s.jsx)(O.Z,{title:u.name,placement:"right",onClose:()=>{h({open:!1})},open:u.open,children:u.type&&R[u.type]&&R[u.type].length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,s.jsx)(P.Z,{}),onClick:()=>{d({open:!0,dbType:u.type})},children:"Create"}),R[u.type].map(e=>(0,s.jsxs)(T.Z,{title:e.db_name,extra:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{y(e)}}),(0,s.jsx)(F.Z,{style:{color:"#ff1b2e"},onClick:()=>{_(e)}})]}),className:"mb-4",children:[e.db_path?(0,s.jsxs)("p",{children:["path: ",e.db_path]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["host: ",e.db_host]}),(0,s.jsxs)("p",{children:["username: ",e.db_user]}),(0,s.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,s.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,s.jsx)(V.Z,{image:V.Z.PRESENTED_IMAGE_DEFAULT,children:(0,s.jsx)(w.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,s.jsx)(P.Z,{}),onClick:()=>{d({open:!0,dbType:u.type})},children:"Create Now"})})})]})})}},41748:function(){}},function(e){e.O(0,[2394,2003,5677,1841,5722,2786,9069,5996,5360,1103,1657,6014,7343,9774,2888,179],function(){return e(e.s=77023)}),_N_E=e.O()}]);