(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4769],{36517:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return eD}});var n=l(85893),a=l(67294),s=l(2093),r=l(43446),o=l(41468),i=l(76212),c=()=>{let{history:e,setHistory:t,chatId:l,model:n,docId:s}=(0,a.useContext)(o.p),{chat:c}=(0,r.Z)({queryAgentURL:"/knowledge/document/summary"}),d=(0,a.useCallback)(async e=>{let[,a]=await (0,i.Vx)((0,i.$i)(l)),r=[...a,{role:"human",context:"",model_name:n,order:0,time_stamp:0},{role:"view",context:"",model_name:n,order:0,time_stamp:0,retry:!0}],o=r.length-1;t([...r]),await c({data:{doc_id:e||s,model_name:n},chatId:l,onMessage:e=>{r[o].context=e,t([...r])}})},[e,n,s,l]);return d},d=l(62418),u=l(87740),x=l(57132),m=l(66478),h=l(14553),p=l(45360),f=l(83062),v=l(85576),g=l(93967),j=l.n(g),w=l(20640),b=l.n(w),y=l(96486),_=l(39332),Z=l(67421),N=l(27496),C=l(79531),P=l(14726),k=l(11163),S=l(82353),R=l(1051);function D(e){let{document:t}=e;switch(t.status){case"RUNNING":return(0,n.jsx)(S.Rp,{});case"FINISHED":default:return(0,n.jsx)(S.s2,{});case"FAILED":return(0,n.jsx)(R.Z,{})}}function E(e){let{documents:t,dbParam:l}=e,a=(0,k.useRouter)(),s=e=>{a.push("/knowledge/chunk/?spaceName=".concat(l,"&id=").concat(e))};return(null==t?void 0:t.length)?(0,n.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:t.map(e=>{let t;switch(e.status){case"RUNNING":t="#2db7f5";break;case"FINISHED":default:t="#87d068";break;case"FAILED":t="#f50"}return(0,n.jsx)(f.Z,{title:e.result,children:(0,n.jsxs)(P.ZP,{style:{color:t},onClick:()=>{s(e.id)},className:"shrink flex items-center mr-3",children:[(0,n.jsx)(D,{document:e}),e.doc_name]})},e.id)})}):null}var I=l(5392),F=l(84553);function M(e){let{dbParam:t,setDocId:l}=(0,a.useContext)(o.p),{onUploadFinish:s,handleFinish:r}=e,d=c(),[u,x]=(0,a.useState)(!1),m=async e=>{x(!0);let n=new FormData;n.append("doc_name",e.file.name),n.append("doc_file",e.file),n.append("doc_type","DOCUMENT");let a=await (0,i.Vx)((0,i.iG)(t||"default",n));if(!a[1]){x(!1);return}l(a[1]),s(),x(!1),null==r||r(!0),await d(a[1]),null==r||r(!1)};return(0,n.jsx)(F.default,{customRequest:m,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,n.jsx)(P.ZP,{loading:u,size:"small",shape:"circle",icon:(0,n.jsx)(I.Z,{})})})}var U=l(2487),L=l(28459),O=l(55241),$=l(99859),A=l(66184),V=l(58299),G=l(65654),z=l(30119);let H=e=>{let{data:t,loading:l,submit:a,close:s}=e,{t:r}=(0,Z.$G)(),o=e=>()=>{a(e),s()};return(0,n.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,n.jsx)(U.Z,{dataSource:null==t?void 0:t.data,loading:l,rowKey:e=>e.prompt_name,renderItem:e=>(0,n.jsx)(U.Z.Item,{onClick:o(e.content),children:(0,n.jsx)(f.Z,{title:e.content,children:(0,n.jsx)(U.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:r("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+r("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var q=e=>{let{submit:t}=e,{t:l}=(0,Z.$G)(),[s,r]=(0,a.useState)(!1),[o,i]=(0,a.useState)("common"),{data:c,loading:d}=(0,G.Z)(()=>(0,z.PR)("/prompt/list",{prompt_type:o}),{refreshDeps:[o],onError:e=>{p.ZP.error(null==e?void 0:e.message)}});return(0,n.jsx)(L.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,n.jsx)(O.Z,{title:(0,n.jsx)($.default.Item,{label:"Prompt "+l("Type"),children:(0,n.jsx)(A.default,{style:{width:150},value:o,onChange:e=>{i(e)},options:[{label:l("Public")+" Prompts",value:"common"},{label:l("Private")+" Prompts",value:"private"}]})}),content:(0,n.jsx)(H,{data:c,loading:d,submit:t,close:()=>{r(!1)}}),placement:"topRight",trigger:"click",open:s,onOpenChange:e=>{r(e)},children:(0,n.jsx)(f.Z,{title:l("Click_Select")+" Prompt",children:(0,n.jsx)(V.Z,{className:"bottom-[30%]"})})})})},T=function(e){let{children:t,loading:l,onSubmit:s,handleFinish:r,placeholder:c,...d}=e,{dbParam:u,scene:x}=(0,a.useContext)(o.p),[m,h]=(0,a.useState)(""),p=(0,a.useMemo)(()=>"chat_knowledge"===x,[x]),[f,v]=(0,a.useState)([]),g=(0,a.useRef)(0);async function j(){if(!u)return null;let[e,t]=await (0,i.Vx)((0,i._Q)(u,{page:1,page_size:g.current}));v(null==t?void 0:t.data)}(0,a.useEffect)(()=>{p&&j()},[u]);let w=async()=>{g.current+=1,await j()};return(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)(E,{documents:f,dbParam:u}),p&&(0,n.jsx)(M,{handleFinish:r,onUploadFinish:w,className:"absolute z-10 top-2 left-2"}),(0,n.jsx)(C.default.TextArea,{className:"flex-1 ".concat(p?"pl-10":""," pr-10"),size:"large",value:m,autoSize:{minRows:1,maxRows:4},...d,onPressEnter:e=>{if(m.trim()&&13===e.keyCode){if(e.shiftKey){e.preventDefault(),h(e=>e+"\n");return}s(m),setTimeout(()=>{h("")},0)}},onChange:e=>{if("number"==typeof d.maxLength){h(e.target.value.substring(0,d.maxLength));return}h(e.target.value)},placeholder:c}),(0,n.jsx)(P.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:l,icon:(0,n.jsx)(N.Z,{}),onClick:()=>{s(m)}}),(0,n.jsx)(q,{submit:e=>{h(m+e)}}),t]})},B=l(92975),J=l(30853),Q=l(12767),W=(0,a.memo)(function(e){var t;let{content:l}=e,{scene:s}=(0,a.useContext)(o.p),r="view"===l.role;return(0,n.jsx)("div",{className:j()("relative w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":r,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(s)}),children:r?(0,n.jsx)(B.D,{components:J.Z,rehypePlugins:[Q.Z],children:null==(t=l.context)?void 0:t.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}):(0,n.jsx)("div",{className:"",children:l.context})})}),K=l(24019),X=l(50888),Y=l(97937),ee=l(63606),et=l(50228),el=l(87547),en=l(89035),ea=l(66309),es=l(81799);let er={todo:{bgClass:"bg-gray-500",icon:(0,n.jsx)(K.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,n.jsx)(X.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,n.jsx)(Y.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,n.jsx)(ee.Z,{className:"ml-2"})}};function eo(e){return e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}var ei=(0,a.memo)(function(e){let{children:t,content:l,isChartChat:s,onLinkClick:r}=e,{scene:i}=(0,a.useContext)(o.p),{context:c,model_name:d,role:u}=l,x="view"===u,{relations:m,value:h,cachePluginContext:p}=(0,a.useMemo)(()=>{if("string"!=typeof c)return{relations:[],value:"",cachePluginContext:[]};let[e,t]=c.split("	relations:"),l=t?t.split(","):[],n=[],a=0,s=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var t;let l=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),s=JSON.parse(l),r="<custom-view>".concat(a,"</custom-view>");return n.push({...s,result:eo(null!==(t=s.result)&&void 0!==t?t:"")}),a++,r}catch(t){return console.log(t.message,t),e}});return{relations:l,cachePluginContext:n,value:s}},[c]),f=(0,a.useMemo)(()=>({"custom-view"(e){var t;let{children:l}=e,a=+l.toString();if(!p[a])return l;let{name:s,status:r,err_msg:o,result:i}=p[a],{bgClass:c,icon:d}=null!==(t=er[r])&&void 0!==t?t:{};return(0,n.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,n.jsxs)("div",{className:j()("flex px-4 md:px-6 py-2 items-center text-white text-sm",c),children:[s,d]}),i?(0,n.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,n.jsx)(B.D,{components:J.Z,rehypePlugins:[Q.Z],children:null!=i?i:""})}):(0,n.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:o})]})}}),[c,p]);return x||c?(0,n.jsxs)("div",{className:j()("relative flex flex-wrap w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":x,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(i)}),children:[(0,n.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center h-7 w-7 rounded-full text-lg sm:mr-4",children:x?(0,es.A)(d)||(0,n.jsx)(et.Z,{}):(0,n.jsx)(el.Z,{})}),(0,n.jsxs)("div",{className:"flex-1 overflow-hidden items-center text-md leading-8 pb-2",children:[!x&&"string"==typeof c&&c,x&&s&&"object"==typeof c&&(0,n.jsxs)("div",{children:["[".concat(c.template_name,"]: "),(0,n.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:r,children:[(0,n.jsx)(en.Z,{className:"mr-1"}),c.template_introduce||"More Details"]})]}),x&&"string"==typeof c&&(0,n.jsx)(B.D,{components:{...J.Z,...f},rehypePlugins:[Q.Z],children:eo(h)}),!!(null==m?void 0:m.length)&&(0,n.jsx)("div",{className:"flex flex-wrap mt-2",children:null==m?void 0:m.map((e,t)=>(0,n.jsx)(ea.Z,{color:"#108ee9",children:e},e+t))})]}),t]}):(0,n.jsx)("div",{className:"h-12"})}),ec=l(59301),ed=l(41132),eu=l(74312),ex=l(3414),em=l(72868),eh=l(59562),ep=l(25359),ef=l(7203),ev=l(48665),eg=l(26047),ej=l(99056),ew=l(57814),eb=l(46300),ey=l(33028),e_=l(40911),eZ=e=>{var t;let{conv_index:l,question:s,knowledge_space:r,select_param:c}=e,{t:d}=(0,Z.$G)(),{chatId:u}=(0,a.useContext)(o.p),[x,v]=(0,a.useState)(""),[g,j]=(0,a.useState)(4),[w,b]=(0,a.useState)(""),y=(0,a.useRef)(null),[_,N]=p.ZP.useMessage(),C=(0,a.useCallback)((e,t)=>{t?(0,i.Vx)((0,i.Eb)(u,l)).then(e=>{var t,l,n,a;let s=null!==(t=e[1])&&void 0!==t?t:{};v(null!==(l=s.ques_type)&&void 0!==l?l:""),j(parseInt(null!==(n=s.score)&&void 0!==n?n:"4")),b(null!==(a=s.messages)&&void 0!==a?a:"")}).catch(e=>{console.log(e)}):(v(""),j(4),b(""))},[u,l]),P=(0,eu.Z)(ex.Z)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"#FBFCFD":"#0E0E10",...t.typography["body-sm"],padding:t.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,width:"100%",height:"100%"}});return(0,n.jsxs)(em.L,{onOpenChange:C,children:[N,(0,n.jsx)(f.Z,{title:d("Rating"),children:(0,n.jsx)(eh.Z,{slots:{root:h.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,n.jsx)(ec.Z,{})})}),(0,n.jsxs)(ep.Z,{children:[(0,n.jsx)(ef.Z,{disabled:!0,sx:{minHeight:0}}),(0,n.jsx)(ev.Z,{sx:{width:"100%",maxWidth:350,display:"grid",gap:3,padding:1},children:(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault();let t={conv_uid:u,conv_index:l,question:s,knowledge_space:r,score:g,ques_type:x,messages:w};console.log(t),(0,i.Vx)((0,i.VC)({data:t})).then(e=>{_.open({type:"success",content:"save success"})}).catch(e=>{_.open({type:"error",content:"save error"})})},children:(0,n.jsxs)(eg.Z,{container:!0,spacing:.5,columns:13,sx:{flexGrow:1},children:[(0,n.jsx)(eg.Z,{xs:3,children:(0,n.jsx)(P,{children:d("Q_A_Category")})}),(0,n.jsx)(eg.Z,{xs:10,children:(0,n.jsx)(ej.Z,{action:y,value:x,placeholder:"Choose one…",onChange:(e,t)=>v(null!=t?t:""),...x&&{endDecorator:(0,n.jsx)(h.ZP,{size:"sm",variant:"plain",color:"neutral",onMouseDown:e=>{e.stopPropagation()},onClick:()=>{var e;v(""),null===(e=y.current)||void 0===e||e.focusVisible()},children:(0,n.jsx)(ed.Z,{})}),indicator:null},sx:{width:"100%"},children:c&&(null===(t=Object.keys(c))||void 0===t?void 0:t.map(e=>(0,n.jsx)(ew.Z,{value:e,children:c[e]},e)))})}),(0,n.jsx)(eg.Z,{xs:3,children:(0,n.jsx)(P,{children:(0,n.jsx)(f.Z,{title:(0,n.jsx)(ev.Z,{children:(0,n.jsx)("div",{children:d("feed_back_desc")})}),variant:"solid",placement:"left",children:d("Q_A_Rating")})})}),(0,n.jsx)(eg.Z,{xs:10,sx:{pl:0,ml:0},children:(0,n.jsx)(eb.Z,{"aria-label":"Custom",step:1,min:0,max:5,valueLabelFormat:function(e){return({0:d("Lowest"),1:d("Missed"),2:d("Lost"),3:d("Incorrect"),4:d("Verbose"),5:d("Best")})[e]},valueLabelDisplay:"on",marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],sx:{width:"90%",pt:3,m:2,ml:1},onChange:e=>{var t;return j(null===(t=e.target)||void 0===t?void 0:t.value)},value:g})}),(0,n.jsx)(eg.Z,{xs:13,children:(0,n.jsx)(ey.Z,{placeholder:d("Please_input_the_text"),value:w,onChange:e=>b(e.target.value),minRows:2,maxRows:4,endDecorator:(0,n.jsx)(e_.ZP,{level:"body-xs",sx:{ml:"auto"},children:d("input_count")+w.length+d("input_unit")}),sx:{width:"100%",fontSize:14}})}),(0,n.jsx)(eg.Z,{xs:13,children:(0,n.jsx)(m.Z,{type:"submit",variant:"outlined",sx:{width:"100%",height:"100%"},children:d("submit")})})]})})})]})]})},eN=l(74434),eC=l(91085),eP=e=>{var t,l;let{messages:r,onSubmit:g}=e,{dbParam:w,currentDialogue:N,scene:C,model:P,refreshDialogList:k,chatId:S,agent:R,docId:D}=(0,a.useContext)(o.p),{t:E}=(0,Z.$G)(),I=(0,_.useSearchParams)(),F=null!==(t=I&&I.get("select_param"))&&void 0!==t?t:"",M=null!==(l=I&&I.get("spaceNameOriginal"))&&void 0!==l?l:"",[U,L]=(0,a.useState)(!1),[O,$]=(0,a.useState)(!1),[A,V]=(0,a.useState)(r),[G,z]=(0,a.useState)(""),[H,q]=(0,a.useState)(),B=(0,a.useRef)(null),J=(0,a.useMemo)(()=>"chat_dashboard"===C,[C]),Q=c(),K=(0,a.useMemo)(()=>{switch(C){case"chat_agent":return R;case"chat_excel":return null==N?void 0:N.select_param;case"chat_flow":return F;default:return M||w}},[C,R,N,w,M,F]),X=async e=>{if(!U&&e.trim()){if("chat_agent"===C&&!R){p.ZP.warning(E("choice_agent_tip"));return}try{L(!0),await g(e,{select_param:null!=K?K:""})}finally{L(!1)}}},Y=e=>{try{return JSON.parse(e)}catch(t){return e}},[ee,et]=p.ZP.useMessage(),el=async e=>{let t=null==e?void 0:e.replace(/\trelations:.*/g,""),l=b()(t);l?t?ee.open({type:"success",content:E("copy_success")}):ee.open({type:"warning",content:E("copy_nothing")}):ee.open({type:"error",content:E("copy_failed")})},en=async()=>{!U&&D&&(L(!0),await Q(D),L(!1))};return(0,s.Z)(async()=>{let e=(0,d.a_)();e&&e.id===S&&(await X(e.message),k(),localStorage.removeItem(d.rU))},[S]),(0,a.useEffect)(()=>{let e=r;J&&(e=(0,y.cloneDeep)(r).map(e=>((null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context)&&(e.context=Y(null==e?void 0:e.context)),e))),V(e.filter(e=>["view","human"].includes(e.role)))},[J,r]),(0,a.useEffect)(()=>{(0,i.Vx)((0,i.Lu)()).then(e=>{var t;q(null!==(t=e[1])&&void 0!==t?t:{})}).catch(e=>{console.log(e)})},[]),(0,a.useEffect)(()=>{setTimeout(()=>{var e;null===(e=B.current)||void 0===e||e.scrollTo(0,B.current.scrollHeight)},50)},[r]),(0,n.jsxs)(n.Fragment,{children:[et,(0,n.jsx)("div",{ref:B,className:"flex flex-1 overflow-y-auto pb-8 w-full flex-col",children:(0,n.jsx)("div",{className:"flex items-center flex-1 flex-col text-sm leading-6 text-slate-900 dark:text-slate-300 sm:text-base sm:leading-7",children:A.length?A.map((e,t)=>{var l;return"chat_agent"===C?(0,n.jsx)(W,{content:e},t):(0,n.jsx)(ei,{content:e,isChartChat:J,onLinkClick:()=>{$(!0),z(JSON.stringify(null==e?void 0:e.context,null,2))},children:"view"===e.role&&(0,n.jsxs)("div",{className:"flex w-full border-t border-gray-200 dark:border-theme-dark",children:["chat_knowledge"===C&&e.retry?(0,n.jsxs)(m.Z,{onClick:en,slots:{root:h.ZP},slotProps:{root:{variant:"plain",color:"primary"}},children:[(0,n.jsx)(u.Z,{}),"\xa0",(0,n.jsx)("span",{className:"text-sm",children:E("Retry")})]}):null,(0,n.jsxs)("div",{className:"flex w-full flex-row-reverse",children:[(0,n.jsx)(eZ,{select_param:H,conv_index:Math.ceil((t+1)/2),question:null===(l=null==A?void 0:A.filter(t=>(null==t?void 0:t.role)==="human"&&(null==t?void 0:t.order)===e.order)[0])||void 0===l?void 0:l.context,knowledge_space:M||w||""}),(0,n.jsx)(f.Z,{title:E("copy"),children:(0,n.jsx)(m.Z,{onClick:()=>el(null==e?void 0:e.context),slots:{root:h.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,n.jsx)(x.Z,{})})})]})]})},t)}):(0,n.jsx)(eC.Z,{description:"Start a conversation"})})}),(0,n.jsx)("div",{className:j()("relative after:absolute after:-top-8 after:h-8 after:w-full after:bg-gradient-to-t after:from-theme-light after:to-transparent dark:after:from-theme-dark",{"cursor-not-allowed":"chat_excel"===C&&!(null==N?void 0:N.select_param)}),children:(0,n.jsxs)("div",{className:"flex flex-wrap w-full py-2 sm:pt-6 sm:pb-10 items-center",children:[P&&(0,n.jsx)("div",{className:"mr-2 flex",children:(0,es.A)(P)}),(0,n.jsx)(T,{loading:U,onSubmit:X,handleFinish:L})]})}),(0,n.jsx)(v.default,{title:"JSON Editor",open:O,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{$(!1)},onCancel:()=>{$(!1)},children:(0,n.jsx)(eN.Z,{className:"w-full h-[500px]",language:"json",value:G})})]})},ek=l(34625),eS=l(39156),eR=l(45247),eD=()=>{var e;let t=(0,_.useSearchParams)(),{scene:l,chatId:c,model:u,agent:x,setModel:m,history:h,setHistory:p}=(0,a.useContext)(o.p),{chat:f}=(0,r.Z)({}),v=null!==(e=t&&t.get("initMessage"))&&void 0!==e?e:"",[g,w]=(0,a.useState)(!1),[b,y]=(0,a.useState)(),Z=async()=>{w(!0);let[,e]=await (0,i.Vx)((0,i.$i)(c));p(null!=e?e:[]),w(!1)},N=e=>{var t;let l=null===(t=e[e.length-1])||void 0===t?void 0:t.context;if(l)try{let e="string"==typeof l?JSON.parse(l):l;console.log("contextObj",e),y((null==e?void 0:e.template_name)==="report"?null==e?void 0:e.charts:void 0)}catch(e){console.log(e),y([])}};(0,s.Z)(async()=>{let e=(0,d.a_)();e&&e.id===c||await Z()},[v,c]),(0,a.useEffect)(()=>{var e,t;if(!h.length)return;let l=null===(e=null===(t=h.filter(e=>"view"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];(null==l?void 0:l.model_name)&&m(l.model_name),N(h)},[h.length]),(0,a.useEffect)(()=>()=>{p([])},[]);let C=(0,a.useCallback)((e,t)=>new Promise(n=>{let a=[...h,{role:"human",context:e,model_name:u,order:0,time_stamp:0},{role:"view",context:"",model_name:u,order:0,time_stamp:0}],s=a.length-1;p([...a]),f({data:{...t,chat_mode:l||"chat_normal",model_name:u,user_input:e},chatId:c,onMessage:e=>{(null==t?void 0:t.incremental)?a[s].context+=e:a[s].context=e,p([...a])},onDone:()=>{N(a),n()},onClose:()=>{N(a),n()},onError:e=>{a[s].context=e,p([...a]),n()}})}),[h,f,c,u,x,l]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eR.Z,{visible:g}),(0,n.jsx)(ek.Z,{refreshHistory:Z,modelChange:e=>{m(e)}}),(0,n.jsxs)("div",{className:"px-4 flex flex-1 flex-wrap overflow-hidden relative",children:[!!(null==b?void 0:b.length)&&(0,n.jsx)("div",{className:"w-full pb-4 xl:w-3/4 h-1/2 xl:pr-4 xl:h-full overflow-y-auto",children:(0,n.jsx)(eS.ZP,{chartsData:b})}),!(null==b?void 0:b.length)&&"chat_dashboard"===l&&(0,n.jsx)(eC.Z,{className:"w-full xl:w-3/4 h-1/2 xl:h-full"}),(0,n.jsx)("div",{className:j()("flex flex-1 flex-col overflow-hidden",{"px-0 xl:pl-4 h-1/2 w-full xl:w-auto xl:h-full border-t xl:border-t-0 xl:border-l dark:border-gray-800":"chat_dashboard"===l,"h-full lg:px-8":"chat_dashboard"!==l}),children:(0,n.jsx)(eP,{messages:h,onSubmit:C})})]})]})}},34625:function(e,t,l){"use strict";l.d(t,{Z:function(){return R}});var n=l(85893),a=l(67294),s=l(45360),r=l(83062),o=l(84553),i=l(14726),c=l(49591),d=l(88484),u=l(29158),x=l(76212),m=l(41468),h=function(e){var t;let{convUid:l,chatMode:h,onComplete:p,...f}=e,[v,g]=(0,a.useState)(!1),[j,w]=s.ZP.useMessage(),[b,y]=(0,a.useState)([]),[_,Z]=(0,a.useState)(),{model:N}=(0,a.useContext)(m.p),C=async e=>{var t;if(!e){s.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(t=e.file.name)&&void 0!==t?t:"")){s.ZP.error("File type must be csv, xlsx or xls");return}y([e.file])},P=async()=>{g(!0);try{let e=new FormData;e.append("doc_file",b[0]),j.open({content:"Uploading ".concat(b[0].name),type:"loading",duration:0});let[t]=await (0,x.Vx)((0,x.qn)({convUid:l,chatMode:h,data:e,model:N,config:{timeout:36e5,onUploadProgress:e=>{let t=Math.ceil(e.loaded/(e.total||0)*100);Z(t)}}}));if(t)return;s.ZP.success("success"),null==p||p()}catch(e){s.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{g(!1),j.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[w,(0,n.jsx)(r.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)(o.default,{disabled:v,className:"mr-1",beforeUpload:()=>!1,fileList:b,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:C,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...f,children:(0,n.jsx)(i.ZP,{className:"flex justify-center items-center",type:"primary",disabled:v,icon:(0,n.jsx)(c.Z,{}),children:"Select File"})})}),(0,n.jsx)(i.ZP,{type:"primary",loading:v,className:"flex justify-center items-center",disabled:!b.length,icon:(0,n.jsx)(d.Z,{}),onClick:P,children:v?100===_?"Analysis":"Uploading":"Upload"}),!!b.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>y([]),children:[(0,n.jsx)(u.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(t=b[0])||void 0===t?void 0:t.name})]})]})})},p=function(e){let{onComplete:t}=e,{currentDialogue:l,scene:s,chatId:r}=(0,a.useContext)(m.p);return"chat_excel"!==s?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:l?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(u.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:l.select_param})]}):(0,n.jsx)(h,{convUid:r,chatMode:s,onComplete:t})})};l(23293);var f=l(78045),v=l(16165),g=l(96991),j=l(82353);function w(){let{isContract:e,setIsContract:t,scene:l}=(0,a.useContext)(m.p),s=l&&["chat_with_db_execute","chat_dashboard"].includes(l);return s?(0,n.jsxs)(f.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{t(!e)},children:[(0,n.jsxs)(f.ZP.Button,{value:!1,children:[(0,n.jsx)(v.Z,{component:j.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(f.ZP.Button,{value:!0,children:[(0,n.jsx)(g.Z,{className:"mr-1"}),"Editor"]})]}):null}var b=l(81799),y=l(62418),_=l(2093),Z=l(66184),N=l(98978),C=function(){let{scene:e,dbParam:t,setDbParam:l}=(0,a.useContext)(m.p),[s,r]=(0,a.useState)([]);(0,_.Z)(async()=>{let[,t]=await (0,x.Vx)((0,x.vD)(e));r(null!=t?t:[])},[e]);let o=(0,a.useMemo)(()=>{var e;return null===(e=s.map)||void 0===e?void 0:e.call(s,e=>({name:e.param,...y.S$[e.type]}))},[s]);return((0,a.useEffect)(()=>{(null==o?void 0:o.length)&&!t&&l(o[0].name)},[o,l,t]),null==o?void 0:o.length)?(0,n.jsx)(Z.default,{value:t,className:"w-36",onChange:e=>{l(e)},children:o.map(e=>(0,n.jsxs)(Z.default.Option,{children:[(0,n.jsx)(N.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},P=l(65654),k=l(67421),S=function(){let{t:e}=(0,k.$G)(),{agent:t,setAgent:l}=(0,a.useContext)(m.p),{data:s=[]}=(0,P.Z)(async()=>{let[,e]=await (0,x.Vx)((0,x.H4)());return null!=e?e:[]});return(0,n.jsx)(Z.default,{className:"w-60",value:t,placeholder:e("Select_Plugins"),options:s.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==l||l(e)}})},R=function(e){let{refreshHistory:t,modelChange:l}=e,{scene:s,refreshDialogList:r}=(0,a.useContext)(m.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,n.jsx)(b.Z,{onChange:l}),(0,n.jsx)(C,{}),"chat_excel"===s&&(0,n.jsx)(p,{onComplete:()=>{null==r||r(),null==t||t()}}),"chat_agent"===s&&(0,n.jsx)(S,{}),(0,n.jsx)(w,{})]})}},81799:function(e,t,l){"use strict";l.d(t,{A:function(){return x}});var n=l(85893),a=l(41468),s=l(19284),r=l(66184),o=l(25675),i=l.n(o),c=l(67294),d=l(67421);let u="/models/huggingface.svg";function x(e,t){var l,a;let{width:r,height:o}=t||{};return e?(0,n.jsx)(i(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:r||24,height:o||24,src:(null===(l=s.Hf[e])||void 0===l?void 0:l.icon)||u,alt:"llm"},(null===(a=s.Hf[e])||void 0===a?void 0:a.icon)||u):null}t.Z=function(e){let{onChange:t}=e,{t:l}=(0,d.$G)(),{modelList:o,model:i}=(0,c.useContext)(a.p);return!o||o.length<=0?null:(0,n.jsx)(r.default,{value:i,placeholder:l("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:o.map(e=>{var t;return(0,n.jsx)(r.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[x(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(t=s.Hf[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},91085:function(e,t,l){"use strict";var n=l(85893),a=l(32983),s=l(14726),r=l(93967),o=l.n(r),i=l(67421);t.Z=function(e){let{className:t,error:l,description:r,refresh:c}=e,{t:d}=(0,i.$G)();return(0,n.jsx)(a.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:o()("flex items-center justify-center flex-col h-full w-full",t),description:l?(0,n.jsx)(s.ZP,{type:"primary",onClick:c,children:d("try_again")}):null!=r?r:d("no_data")})}},45247:function(e,t,l){"use strict";var n=l(85893),a=l(50888);t.Z=function(e){let{visible:t}=e;return t?(0,n.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,n.jsx)(a.Z,{})}):null}},2440:function(e,t,l){"use strict";var n=l(25519);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(n.C9))&&void 0!==e?e:"")}},30119:function(e,t,l){"use strict";l.d(t,{Tk:function(){return c},PR:function(){return d}});var n=l(45360),a=l(6154),s=l(83454);let r=a.default.create({baseURL:s.env.API_BASE_URL});r.defaults.timeout=1e4,r.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),l(96486);var o=l(62418);let i={"content-type":"application/json","User-Id":(0,o.n5)()},c=(e,t)=>{if(t){let l=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");l&&(e+="?".concat(l))}return r.get("/api"+e,{headers:i}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},d=(e,t)=>r.post(e,t,{headers:i}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},23293:function(){}}]);