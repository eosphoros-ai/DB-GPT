"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14],{7332:function(e,a,t){t.r(a);var s=t(85893),l=t(89833),n=t(11746),r=t(96074),i=t(93967),c=t.n(i),o=t(67294),d=t(73913),u=t(32966);a.default=(0,o.memo)(e=>{let{message:a,index:t}=e,{scene:i}=(0,o.useContext)(d.MobileChatContext),{context:x,model_name:m,role:p,thinking:f}=a,h=(0,o.useMemo)(()=>"view"===p,[p]),v=(0,o.useRef)(null),{value:g}=(0,o.useMemo)(()=>{if("string"!=typeof x)return{relations:[],value:"",cachePluginContext:[]};let[e,a]=x.split("	relations:"),t=a?a.split(","):[],s=[],l=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var a;let t=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(t),r="<custom-view>".concat(l,"</custom-view>");return s.push({...n,result:w(null!==(a=n.result)&&void 0!==a?a:"")}),l++,r}catch(a){return console.log(a.message,a),e}});return{relations:t,cachePluginContext:s,value:n}},[x]),w=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");return(0,s.jsxs)("div",{className:c()("flex w-full",{"justify-end":!h}),ref:v,children:[!h&&(0,s.jsx)("div",{className:"flex bg-[#0C75FC]  text-white p-3 rounded-xl rounded-br-none",children:x}),h&&(0,s.jsxs)("div",{className:"flex max-w-full flex-col flex-wrap bg-white dark:bg-[rgba(255,255,255,0.16)] p-3 rounded-xl rounded-bl-none",children:["string"==typeof x&&"chat_agent"===i&&(0,s.jsx)(n.default,{children:null==g?void 0:g.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}),"string"==typeof x&&"chat_agent"!==i&&(0,s.jsx)(n.default,{children:w(g)}),f&&!x&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:"思考中"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,s.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,s.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),!f&&(0,s.jsx)(r.Z,{className:"my-2"}),(0,s.jsxs)("div",{className:c()("opacity-0 h-0 w-0",{"opacity-100 flex items-center justify-between gap-6 w-auto h-auto":!f}),children:[(0,s.jsx)(u.default,{content:a,index:t,chatDialogRef:v}),"chat_agent"!==i&&(0,s.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,s.jsx)(l.Z,{width:14,height:14,model:m}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:m})]})]})]})]})})},36818:function(e,a,t){t.r(a);var s=t(85893),l=t(67294),n=t(73913),r=t(7332);a.default=(0,l.memo)(()=>{let{history:e}=(0,l.useContext)(n.MobileChatContext),a=(0,l.useMemo)(()=>e.filter(e=>["view","human"].includes(e.role)),[e]);return(0,s.jsx)("div",{className:"flex flex-col gap-4",children:!!a.length&&a.map((e,a)=>(0,s.jsx)(r.default,{message:e,index:a},e.context+a))})})},5583:function(e,a,t){t.r(a);var s=t(85893),l=t(85265),n=t(66309),r=t(79531),i=t(14726),c=t(67294);a.default=e=>{let{open:a,setFeedbackOpen:t,list:o,feedback:d,loading:u}=e,[x,m]=(0,c.useState)([]),[p,f]=(0,c.useState)("");return(0,s.jsx)(l.Z,{title:"你的反馈助我进步",placement:"bottom",open:a,onClose:()=>t(!1),destroyOnClose:!0,height:"auto",children:(0,s.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,s.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==o?void 0:o.map(e=>{let a=x.findIndex(a=>a.reason_type===e.reason_type)>-1;return(0,s.jsx)(n.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(a?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{m(a=>{let t=a.findIndex(a=>a.reason_type===e.reason_type);return t>-1?[...a.slice(0,t),...a.slice(t+1)]:[...a,e]})},children:e.reason},e.reason_type)})}),(0,s.jsx)(r.default.TextArea,{placeholder:"描述一下具体问题或更优的答案",className:"h-24 resize-none mb-2",value:p,onChange:e=>f(e.target.value.trim())}),(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)(i.ZP,{className:"w-16 h-8",onClick:()=>{t(!1)},children:"取消"}),(0,s.jsx)(i.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=x.map(e=>e.reason_type);await (null==d?void 0:d({feedback_type:"unlike",reason_types:e,remark:p}))},loading:u,children:"确认"})]})]})})}},32966:function(e,a,t){t.r(a);var s=t(85893),l=t(76212),n=t(65429),r=t(15381),i=t(57132),c=t(65654),o=t(31418),d=t(96074),u=t(14726),x=t(93967),m=t.n(x),p=t(20640),f=t.n(p),h=t(67294),v=t(73913),g=t(5583);a.default=e=>{var a;let{content:t,index:x,chatDialogRef:p}=e,{conv_uid:w,history:j,scene:y}=(0,h.useContext)(v.MobileChatContext),{message:N}=o.Z.useApp(),[b,k]=(0,h.useState)(!1),[C,_]=(0,h.useState)(null==t?void 0:null===(a=t.feedback)||void 0===a?void 0:a.feedback_type),[Z,S]=(0,h.useState)([]),M=async e=>{var a;let t=null==e?void 0:e.replace(/\trelations:.*/g,""),s=f()((null===(a=p.current)||void 0===a?void 0:a.textContent)||t);s?t?N.success("复制成功"):N.warning("内容复制为空"):N.error("复制失败")},{run:A,loading:F}=(0,c.Z)(async e=>await (0,l.Vx)((0,l.zx)({conv_uid:w,message_id:t.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,a]=e;_(null==a?void 0:a.feedback_type),N.success("反馈成功"),k(!1)}}),{run:P}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Ir)({conv_uid:w,message_id:(null==t?void 0:t.order)+""})),{manual:!0,onSuccess:e=>{let[,a]=e;a&&(_("none"),N.success("操作成功"))}}),{run:V}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Jr)()),{manual:!0,onSuccess:e=>{let[,a]=e;S(a||[]),a&&k(!0)}}),{run:$,loading:z}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Ty)({conv_id:w,round_index:0})),{manual:!0,onSuccess:()=>{N.success("操作成功")}});return(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(n.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"like"===C}),onClick:async()=>{if("like"===C){await P();return}await A({feedback_type:"like"})}}),(0,s.jsx)(r.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"unlike"===C}),onClick:async()=>{if("unlike"===C){await P();return}await V()}}),(0,s.jsx)(g.default,{open:b,setFeedbackOpen:k,list:Z,feedback:A,loading:F})]}),(0,s.jsx)(d.Z,{type:"vertical"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(i.Z,{className:"cursor-pointer",onClick:()=>M(t.context)}),j.length-1===x&&"chat_agent"===y&&(0,s.jsx)(u.ZP,{loading:z,size:"small",onClick:async()=>{await $()},className:"text-xs",children:"终止话题"})]})]})}}}]);