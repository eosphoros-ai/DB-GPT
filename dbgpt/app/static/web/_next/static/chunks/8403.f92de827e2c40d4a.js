(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8403],{13250:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var n=l(42096),a=l(38497),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},r=l(75651),s=a.forwardRef(function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},64698:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var n=l(42096),a=l(38497),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h360c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H184V184h656v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V144c0-17.7-14.3-32-32-32zM653.3 599.4l52.2-52.2a8.01 8.01 0 00-4.7-13.6l-179.4-21c-5.1-.6-9.5 3.7-8.9 8.9l21 179.4c.8 6.6 8.9 9.4 13.6 4.7l52.4-52.4 256.2 256.2c3.1 3.1 8.2 3.1 11.3 0l42.4-42.4c3.1-3.1 3.1-8.2 0-11.3L653.3 599.4z"}}]},name:"select",theme:"outlined"},r=l(75651),s=a.forwardRef(function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},20222:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var n=l(42096),a=l(38497),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},r=l(75651),s=a.forwardRef(function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},54537:function(e,t,l){"use strict";var n=l(38497);let a=(0,n.createContext)({});t.Z=a},98606:function(e,t,l){"use strict";var n=l(38497),a=l(26869),i=l.n(a),r=l(63346),s=l(54537),o=l(54009),d=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function c(e){return"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let u=["xs","sm","md","lg","xl","xxl"],h=n.forwardRef((e,t)=>{let{getPrefixCls:l,direction:a}=n.useContext(r.E_),{gutter:h,wrap:m}=n.useContext(s.Z),{prefixCls:v,span:f,order:p,offset:x,push:y,pull:g,className:j,children:w,flex:b,style:_}=e,N=d(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),C=l("col",v),[$,Z,k]=(0,o.cG)(C),S={},O={};u.forEach(t=>{let l={},n=e[t];"number"==typeof n?l.span=n:"object"==typeof n&&(l=n||{}),delete N[t],O=Object.assign(Object.assign({},O),{[`${C}-${t}-${l.span}`]:void 0!==l.span,[`${C}-${t}-order-${l.order}`]:l.order||0===l.order,[`${C}-${t}-offset-${l.offset}`]:l.offset||0===l.offset,[`${C}-${t}-push-${l.push}`]:l.push||0===l.push,[`${C}-${t}-pull-${l.pull}`]:l.pull||0===l.pull,[`${C}-rtl`]:"rtl"===a}),l.flex&&(O[`${C}-${t}-flex`]=!0,S[`--${C}-${t}-flex`]=c(l.flex))});let E=i()(C,{[`${C}-${f}`]:void 0!==f,[`${C}-order-${p}`]:p,[`${C}-offset-${x}`]:x,[`${C}-push-${y}`]:y,[`${C}-pull-${g}`]:g},j,O,Z,k),P={};if(h&&h[0]>0){let e=h[0]/2;P.paddingLeft=e,P.paddingRight=e}return b&&(P.flex=c(b),!1!==m||P.minWidth||(P.minWidth=0)),$(n.createElement("div",Object.assign({},N,{style:Object.assign(Object.assign(Object.assign({},P),_),S),className:E,ref:t}),w))});t.Z=h},22698:function(e,t,l){"use strict";var n=l(38497),a=l(26869),i=l.n(a),r=l(30432),s=l(63346),o=l(54537),d=l(54009),c=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function u(e,t){let[l,a]=n.useState("string"==typeof e?e:""),i=()=>{if("string"==typeof e&&a(e),"object"==typeof e)for(let l=0;l<r.c4.length;l++){let n=r.c4[l];if(!t[n])continue;let i=e[n];if(void 0!==i){a(i);return}}};return n.useEffect(()=>{i()},[JSON.stringify(e),t]),l}let h=n.forwardRef((e,t)=>{let{prefixCls:l,justify:a,align:h,className:m,style:v,children:f,gutter:p=0,wrap:x}=e,y=c(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:g,direction:j}=n.useContext(s.E_),[w,b]=n.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[_,N]=n.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),C=u(h,_),$=u(a,_),Z=n.useRef(p),k=(0,r.ZP)();n.useEffect(()=>{let e=k.subscribe(e=>{N(e);let t=Z.current||0;(!Array.isArray(t)&&"object"==typeof t||Array.isArray(t)&&("object"==typeof t[0]||"object"==typeof t[1]))&&b(e)});return()=>k.unsubscribe(e)},[]);let S=g("row",l),[O,E,P]=(0,d.VM)(S),M=(()=>{let e=[void 0,void 0],t=Array.isArray(p)?p:[p,void 0];return t.forEach((t,l)=>{if("object"==typeof t)for(let n=0;n<r.c4.length;n++){let a=r.c4[n];if(w[a]&&void 0!==t[a]){e[l]=t[a];break}}else e[l]=t}),e})(),z=i()(S,{[`${S}-no-wrap`]:!1===x,[`${S}-${$}`]:$,[`${S}-${C}`]:C,[`${S}-rtl`]:"rtl"===j},m,E,P),V={},I=null!=M[0]&&M[0]>0?-(M[0]/2):void 0;I&&(V.marginLeft=I,V.marginRight=I);let[R,T]=M;V.rowGap=T;let D=n.useMemo(()=>({gutter:[R,T],wrap:x}),[R,T,x]);return O(n.createElement(o.Z.Provider,{value:D},n.createElement("div",Object.assign({},y,{className:z,style:Object.assign(Object.assign({},V),v),ref:t}),f)))});t.Z=h},54009:function(e,t,l){"use strict";l.d(t,{VM:function(){return c},cG:function(){return u}});var n=l(72178),a=l(90102),i=l(74934);let r=e=>{let{componentCls:t}=e;return{[t]:{position:"relative",maxWidth:"100%",minHeight:1}}},s=(e,t)=>{let{prefixCls:l,componentCls:n,gridColumns:a}=e,i={};for(let e=a;e>=0;e--)0===e?(i[`${n}${t}-${e}`]={display:"none"},i[`${n}-push-${e}`]={insetInlineStart:"auto"},i[`${n}-pull-${e}`]={insetInlineEnd:"auto"},i[`${n}${t}-push-${e}`]={insetInlineStart:"auto"},i[`${n}${t}-pull-${e}`]={insetInlineEnd:"auto"},i[`${n}${t}-offset-${e}`]={marginInlineStart:0},i[`${n}${t}-order-${e}`]={order:0}):(i[`${n}${t}-${e}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${e/a*100}%`,maxWidth:`${e/a*100}%`}],i[`${n}${t}-push-${e}`]={insetInlineStart:`${e/a*100}%`},i[`${n}${t}-pull-${e}`]={insetInlineEnd:`${e/a*100}%`},i[`${n}${t}-offset-${e}`]={marginInlineStart:`${e/a*100}%`},i[`${n}${t}-order-${e}`]={order:e});return i[`${n}${t}-flex`]={flex:`var(--${l}${t}-flex)`},i},o=(e,t)=>s(e,t),d=(e,t,l)=>({[`@media (min-width: ${(0,n.bf)(t)})`]:Object.assign({},o(e,l))}),c=(0,a.I$)("Grid",e=>{let{componentCls:t}=e;return{[t]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},()=>({})),u=(0,a.I$)("Grid",e=>{let t=(0,i.IX)(e,{gridColumns:24}),l={"-sm":t.screenSMMin,"-md":t.screenMDMin,"-lg":t.screenLGMin,"-xl":t.screenXLMin,"-xxl":t.screenXXLMin};return[r(t),o(t,""),o(t,"-xs"),Object.keys(l).map(e=>d(t,l[e],e)).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})]},()=>({}))},93743:function(e,t,l){"use strict";l.d(t,{_:function(){return V},a:function(){return M}});var n=l(96469),a=l(16156),i=l(38437),r=l(30994),s=l(10755),o=l(60205),d=l(27691),c=l(97818),u=l(48495),h=l(33573),m=l(2),v=l(98922),f=l(44766);let p=e=>{let{charts:t,scopeOfCharts:l,ruleConfig:n}=e,a={};if(null==t||t.forEach(e=>{if(e.chartKnowledge.toSpec){let t=e.chartKnowledge.toSpec;e.chartKnowledge.toSpec=(e,l)=>({...t(e,l),dataProps:l})}else e.chartKnowledge.toSpec=(e,t)=>({dataProps:t});a[e.chartType]=e.chartKnowledge}),(null==l?void 0:l.exclude)&&l.exclude.forEach(e=>{Object.keys(a).includes(e)&&delete a[e]}),null==l?void 0:l.include){let e=l.include;Object.keys(a).forEach(t=>{e.includes(t)||delete a[t]})}let i={...l,custom:a},r={...n},s=new m.w({ckbCfg:i,ruleCfg:r});return s},x=e=>{var t;let{data:l,dataMetaMap:n,myChartAdvisor:a}=e,i=n?Object.keys(n).map(e=>({name:e,...n[e]})):null,r=new v.Z(l).info(),s=(0,f.size)(r)>2?null==r?void 0:r.filter(e=>"string"!==e.recommendation&&"date"!==e.recommendation||e.distinct&&e.distinct>1):r,o=null==a?void 0:a.adviseWithLog({data:l,dataProps:i,fields:null==s?void 0:s.map(e=>e.name)});return null!==(t=null==o?void 0:o.advices)&&void 0!==t?t:[]};var y=l(38497);function g(e,t){return t.every(t=>e.includes(t))}function j(e,t){let l=t.find(t=>t.name===e);return(null==l?void 0:l.recommendation)==="date"?t=>new Date(t[e]):e}function w(e){return e.find(e=>{var t;return e.levelOfMeasurements&&(t=e.levelOfMeasurements,["Time","Ordinal"].some(e=>t.includes(e)))})}function b(e){return e.find(e=>e.levelOfMeasurements&&g(e.levelOfMeasurements,["Nominal"]))}let _=e=>{let{data:t,xField:l}=e,n=(0,f.uniq)(t.map(e=>e[l]));return n.length<=1},N=(e,t,l)=>{let{field4Split:n,field4X:a}=l;if((null==n?void 0:n.name)&&(null==a?void 0:a.name)){let l=e[n.name],i=t.filter(e=>n.name&&e[n.name]===l);return _({data:i,xField:a.name})?5:void 0}return(null==a?void 0:a.name)&&_({data:t,xField:a.name})?5:void 0},C=e=>{let{data:t,chartType:l,xField:n}=e,a=(0,f.cloneDeep)(t);try{if(l.includes("line")&&(null==n?void 0:n.name)&&"date"===n.recommendation)return a.sort((e,t)=>new Date(e[n.name]).getTime()-new Date(t[n.name]).getTime()),a;l.includes("line")&&(null==n?void 0:n.name)&&["float","integer"].includes(n.recommendation)&&a.sort((e,t)=>e[n.name]-t[n.name])}catch(e){console.error(e)}return a},$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.map(e=>{let l={};return Object.keys(e).forEach(n=>{l[n]=e[n]===t?null:e[n]}),l})},Z="multi_line_chart",k="multi_measure_line_chart",S=[{chartType:"multi_line_chart",chartKnowledge:{id:Z,name:"multi_line_chart",alias:["multi_line_chart"],family:["LineCharts"],def:"multi_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Trend"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:1,fieldConditions:["Time","Ordinal"]},{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:0,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{var l,n;let a=w(t),i=b(t),r=null!==(l=null!=a?a:i)&&void 0!==l?l:t[0],s=t.filter(e=>e.name!==(null==r?void 0:r.name)),o=null!==(n=s.filter(e=>e.levelOfMeasurements&&g(e.levelOfMeasurements,["Interval"])))&&void 0!==n?n:[s[0]],d=s.filter(e=>!o.find(t=>t.name===e.name)).find(e=>e.levelOfMeasurements&&g(e.levelOfMeasurements,["Nominal"]));if(!r||!o)return null;let c={type:"view",autoFit:!0,data:C({data:e,chartType:Z,xField:r}),children:[]};return o.forEach(l=>{let n={type:"line",encode:{x:j(r.name,t),y:l.name,size:t=>N(t,e,{field4Split:d,field4X:r})},legend:{size:!1}};d&&(n.encode.color=d.name),c.children.push(n)}),c}},chineseName:"折线图"},{chartType:"multi_measure_column_chart",chartKnowledge:{id:"multi_measure_column_chart",name:"multi_measure_column_chart",alias:["multi_measure_column_chart"],family:["ColumnCharts"],def:"multi_measure_column_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{let l=null==t?void 0:t.filter(e=>g(e.levelOfMeasurements,["Interval"])),n=b(t),a=w(t),i=null!=n?n:a;if(!i||!l)return null;let r={type:"view",data:e,children:[]};return null==l||l.forEach(e=>{let t={type:"interval",encode:{x:i.name,y:e.name,color:()=>e.name,series:()=>e.name}};r.children.push(t)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"},{chartType:"multi_measure_line_chart",chartKnowledge:{id:k,name:"multi_measure_line_chart",alias:["multi_measure_line_chart"],family:["LineCharts"],def:"multi_measure_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{var l,n;let a=null!==(n=null!==(l=b(t))&&void 0!==l?l:w(t))&&void 0!==n?n:t[0],i=null==t?void 0:t.filter(e=>e.name!==(null==a?void 0:a.name)&&g(e.levelOfMeasurements,["Interval"]));if(!a||!i)return null;let r={type:"view",data:C({data:e,chartType:k,xField:a}),children:[]};return null==i||i.forEach(l=>{let n={type:"line",encode:{x:j(a.name,t),y:l.name,color:()=>l.name,series:()=>l.name,size:t=>N(t,e,{field4X:a})},legend:{size:!1}};r.children.push(n)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"}];var O=l(45277);let E=e=>{if(!e)return;let t=e.getContainer(),l=t.getElementsByTagName("canvas")[0];return l};var P=l(91158);let M=e=>"response_line_chart"===e?["multi_line_chart","multi_measure_line_chart"]:"response_bar_chart"===e?["multi_measure_column_chart"]:"response_pie_chart"===e?["pie_chart"]:"response_scatter_chart"===e?["scatter_plot"]:"response_area_chart"===e?["area_chart"]:"response_heatmap_chart"===e?["heatmap"]:[],{Option:z}=a.default,V=e=>{let{data:t,chartType:l,scopeOfCharts:m,ruleConfig:v}=e,g=$(t),{mode:j}=(0,y.useContext)(O.p),[w,b]=(0,y.useState)(),[_,N]=(0,y.useState)([]),[Z,k]=(0,y.useState)(),M=(0,y.useRef)();(0,y.useEffect)(()=>{b(p({charts:S,scopeOfCharts:{exclude:["area_chart","stacked_area_chart","percent_stacked_area_chart"]},ruleConfig:v}))},[v,m]);let V=e=>{if(!w)return[];let t=function(e){let{advices:t}=e;return t}({advices:e}),n=(0,f.uniq)((0,f.compact)((0,f.concat)(l,e.map(e=>e.type)))),a=n.map(e=>{let l=t.find(t=>t.type===e);if(l)return l;let n=w.dataAnalyzer.execute({data:g});if("data"in n){var a;let t=w.specGenerator.execute({data:n.data,dataProps:n.dataProps,chartTypeRecommendations:[{chartType:e,score:1}]});if("advices"in t)return null===(a=t.advices)||void 0===a?void 0:a[0]}}).filter(e=>null==e?void 0:e.spec);return a};(0,y.useEffect)(()=>{if(g&&w){var e;let t=x({data:g,myChartAdvisor:w}),l=V(t);N(l),k(null===(e=l[0])||void 0===e?void 0:e.type)}},[JSON.stringify(g),w,l]);let I=(0,y.useMemo)(()=>{if((null==_?void 0:_.length)>0){var e,t,l,a;let i=null!=Z?Z:_[0].type,r=null!==(t=null===(e=null==_?void 0:_.find(e=>e.type===i))||void 0===e?void 0:e.spec)&&void 0!==t?t:void 0;if(r){if(r.data&&["line_chart","step_line_chart"].includes(i)){let e=null==w?void 0:w.dataAnalyzer.execute({data:g});e&&"dataProps"in e&&(r.data=C({data:r.data,xField:null===(a=e.dataProps)||void 0===a?void 0:a.find(e=>"date"===e.recommendation),chartType:i}))}return"pie_chart"===i&&(null==r?void 0:null===(l=r.encode)||void 0===l?void 0:l.color)&&(r.tooltip={title:{field:r.encode.color}}),(0,n.jsx)(u.k,{options:{...r,autoFit:!0,theme:j,height:300},ref:M},i)}}},[_,j,Z]);return Z?(0,n.jsxs)("div",{children:[(0,n.jsxs)(i.Z,{justify:"space-between",className:"mb-2",children:[(0,n.jsx)(r.Z,{children:(0,n.jsxs)(s.Z,{children:[(0,n.jsx)("span",{children:h.Z.t("Advices")}),(0,n.jsx)(a.default,{className:"w-52",value:Z,placeholder:"Chart Switcher",onChange:e=>k(e),size:"small",children:null==_?void 0:_.map(e=>{let t=h.Z.t(e.type);return(0,n.jsx)(z,{value:e.type,children:(0,n.jsx)(o.Z,{title:t,placement:"right",children:(0,n.jsx)("div",{children:t})})},e.type)})})]})}),(0,n.jsx)(r.Z,{children:(0,n.jsx)(o.Z,{title:h.Z.t("Download"),children:(0,n.jsx)(d.ZP,{onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart",l=document.createElement("a"),n="".concat(t,".png");setTimeout(()=>{let t=function(e){let t=E(e);if(t){let e=t.toDataURL("image/png");return e}}(e);if(t){l.addEventListener("click",()=>{l.download=n,l.href=t});let e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),l.dispatchEvent(e)}},16)})(M.current,h.Z.t(Z)),icon:(0,n.jsx)(P.Z,{}),type:"text"})})})]}),(0,n.jsx)("div",{className:"flex",children:I})]}):(0,n.jsx)(c.Z,{image:c.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无合适的可视化视图"})}},45045:function(e,t,l){"use strict";l.d(t,{_z:function(){return f._},ZP:function(){return p},aG:function(){return f.a}});var n=l(96469),a=l(49841),i=l(62715),r=l(81630),s=l(45277),o=l(48495),d=l(38497);function c(e){let{chart:t}=e,{mode:l}=(0,d.useContext)(s.p);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(o.k,{style:{height:"100%"},options:{autoFit:!0,theme:l,type:"interval",data:t.values,encode:{x:"name",y:"value",color:"type"},axis:{x:{labelAutoRotate:!1}}}})})]})})}function u(e){let{chart:t}=e,{mode:l}=(0,d.useContext)(s.p);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(o.k,{style:{height:"100%"},options:{autoFit:!0,theme:l,type:"view",data:t.values,children:[{type:"line",encode:{x:"name",y:"value",color:"type",shape:"smooth"}},{type:"area",encode:{x:"name",y:"value",color:"type",shape:"smooth"},legend:!1,style:{fillOpacity:.15}}],axis:{x:{labelAutoRotate:!1}}}})})]})})}var h=l(84832),m=l(44766);function v(e){var t,l;let{chart:a}=e,i=(0,m.groupBy)(a.values,"type");return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:a.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:a.chart_desc}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)(h.Z,{"aria-label":"basic table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:Object.keys(i).map(e=>(0,n.jsx)("th",{children:e},e))})}),(0,n.jsx)("tbody",{children:null===(t=Object.values(i))||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.map((e,t)=>{var l;return(0,n.jsx)("tr",{children:null===(l=Object.keys(i))||void 0===l?void 0:l.map(e=>{var l;return(0,n.jsx)("td",{children:(null==i?void 0:null===(l=i[e])||void 0===l?void 0:l[t].value)||""},e)})},t)})})]})})]})})}var f=l(93743),p=function(e){let{chartsData:t}=e;console.log(t,"xxx");let l=(0,d.useMemo)(()=>{if(t){let e=[],l=null==t?void 0:t.filter(e=>"IndicatorValue"===e.chart_type);l.length>0&&e.push({charts:l,type:"IndicatorValue"});let n=null==t?void 0:t.filter(e=>"IndicatorValue"!==e.chart_type),a=n.length,i=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][a].forEach(t=>{if(t>0){let l=n.slice(i,i+t);i+=t,e.push({charts:l})}}),e}},[t]);return(0,n.jsx)("div",{className:"flex flex-col gap-3",children:null==l?void 0:l.map((e,t)=>(0,n.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex gap-3":""),children:e.charts.map(e=>"IndicatorValue"===e.chart_type||"IndicatorValue"===e.type?(0,n.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(a.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(i.Z,{className:"justify-around",children:[(0,n.jsx)(r.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(r.ZP,{children:e.value})]})})},e.name))},e.chart_uid):"LineChart"===e.chart_type||"LineChart"===e.type?(0,n.jsx)(u,{chart:e},e.chart_uid):"BarChart"===e.chart_type||"BarChart"===e.type?(0,n.jsx)(c,{chart:e},e.chart_uid):"Table"===e.chart_type||"TableChartData"===e.type?(0,n.jsx)(v,{chart:e},e.chart_uid):void 0)},"chart_row_".concat(t)))})}},7343:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return V}});var n=l(96469),a=l(38497),i=l(16602),r=l(54506),s=l(60205),o=l(16156),d=l(27691),c=l(42834),u=l(41999),h=l(30281),m=l(22672),v=l(94078),f=l(45875),p=l(53047),x=l(45045),y=l(72097),g=l(86944),j=l(47271),w=l(42096),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},_=l(75651),N=a.forwardRef(function(e,t){return a.createElement(_.Z,(0,w.Z)({},e,{ref:t,icon:b}))});function C(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"49817",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF","p-id":"49818"}),(0,n.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32","p-id":"49819"})]})}function $(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"59847",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93","p-id":"59848"}),(0,n.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93","fill-opacity":".5","p-id":"59849"}),(0,n.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","p-id":"59850","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,n.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93","fill-opacity":".5","p-id":"59851"}),(0,n.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","p-id":"59852","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}function Z(){return(0,n.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"67616",width:"1em",height:"1em",children:(0,n.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db","p-id":"67617"})})}var k=l(26869),S=l.n(k),O=l(76592),E=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z","p-id":"14553"})})},P=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z","p-id":"13913"})})};let{Search:M}=u.default;function z(e){let{layout:t="LR",editorValue:l,chartData:i,tableData:s,tables:o,handleChange:d}=e,c=(0,a.useMemo)(()=>i?(0,n.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,n.jsx)(x.ZP,{chartsData:[i]})}):null,[i]),{columns:u,dataSource:h}=(0,a.useMemo)(()=>{let{columns:e=[],values:t=[]}=null!=s?s:{},l=e.map(e=>({key:e,dataIndex:e,title:e})),n=t.map(t=>t.reduce((t,l,n)=>(t[e[n]]=l,t),{}));return{columns:l,dataSource:n}},[s]),v=(0,a.useMemo)(()=>{let e={},t=null==o?void 0:o.data,l=null==t?void 0:t.children;return null==l||l.forEach(t=>{e[t.title]=t.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==t?void 0:t.title)?[]:(null==l?void 0:l.map(e=>e.title))||[],getTableColumns:async t=>e[t]||[],getSchemaList:async()=>(null==t?void 0:t.title)?[null==t?void 0:t.title]:[]}},[o]);return(0,n.jsxs)("div",{className:S()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===t,"flex-row":"LR"===t}),children:[(0,n.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,n.jsx)(m.Z,{value:(null==l?void 0:l.sql)||"",language:"mysql",onChange:d,thoughts:(null==l?void 0:l.thoughts)||"",session:v})}),(0,n.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==s?void 0:s.values.length)?(0,n.jsx)(r.Z,{bordered:!0,scroll:{x:"auto"},rowKey:u[0].key,columns:u,dataSource:h}):(0,n.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,n.jsx)(O.Z,{})}),c]})]})}var V=function(){var e,t,l,r,u;let[m,x]=(0,a.useState)([]),[w,b]=(0,a.useState)(""),[_,k]=(0,a.useState)(),[O,V]=(0,a.useState)(!0),[I,R]=(0,a.useState)(),[T,D]=(0,a.useState)(),[H,L]=(0,a.useState)(),[q,A]=(0,a.useState)(),[B,F]=(0,a.useState)(),[U,Q]=(0,a.useState)(!1),[G,K]=(0,a.useState)("TB"),W=(0,f.useSearchParams)(),X=null==W?void 0:W.get("id"),J=null==W?void 0:W.get("scene"),{data:Y,loading:ee}=(0,i.Z)(async()=>await (0,v.Tk)("/v1/editor/sql/rounds",{con_uid:X}),{onSuccess:e=>{var t,l;let n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t[(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.length)-1];n&&k(null==n?void 0:n.round)}}),{run:et,loading:el}=(0,i.Z)(async()=>{var e,t;let l=null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name;return await (0,v.PR)("/api/v1/editor/sql/run",{db_name:l,sql:null==H?void 0:H.sql})},{manual:!0,onSuccess:e=>{var t,l;A({columns:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.colunms,values:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.values})}}),{run:en,loading:ea}=(0,i.Z)(async()=>{var e,t;let l=null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name,n={db_name:l,sql:null==H?void 0:H.sql};return"chat_dashboard"===J&&(n.chart_type=null==H?void 0:H.showcase),await (0,v.PR)("/api/v1/editor/chart/run",n)},{manual:!0,ready:!!(null==H?void 0:H.sql),onSuccess:e=>{if(null==e?void 0:e.success){var t,l,n,a,i,r,s;A({columns:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(l=t.sql_data)||void 0===l?void 0:l.colunms)||[],values:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(a=n.sql_data)||void 0===a?void 0:a.values)||[]}),(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values)?R({type:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.chart_type,values:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.chart_values,title:null==H?void 0:H.title,description:null==H?void 0:H.thoughts}):R(void 0)}}}),{run:ei,loading:er}=(0,i.Z)(async()=>{var e,t,l,n,a;let i=null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name;return await (0,v.PR)("/api/v1/sql/editor/submit",{conv_uid:X,db_name:i,conv_round:_,old_sql:null==T?void 0:T.sql,old_speak:null==T?void 0:T.thoughts,new_sql:null==H?void 0:H.sql,new_speak:(null===(l=null==H?void 0:null===(n=H.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===l?void 0:null===(a=l[1])||void 0===a?void 0:a.trim())||(null==H?void 0:H.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&et()}}),{run:es,loading:eo}=(0,i.Z)(async()=>{var e,t,l,n,a,i;let r=null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name;return await (0,v.PR)("/api/v1/chart/editor/submit",{conv_uid:X,chart_title:null==H?void 0:H.title,db_name:r,old_sql:null==T?void 0:null===(l=T[B])||void 0===l?void 0:l.sql,new_chart_type:null==H?void 0:H.showcase,new_sql:null==H?void 0:H.sql,new_comment:(null===(n=null==H?void 0:null===(a=H.thoughts)||void 0===a?void 0:a.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(i=n[1])||void 0===i?void 0:i.trim())||(null==H?void 0:H.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&en()}}),{data:ed}=(0,i.Z)(async()=>{var e,t;let l=null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name;return await (0,v.Tk)("/v1/editor/db/tables",{db_name:l,page_index:1,page_size:200})},{ready:!!(null===(e=null==Y?void 0:null===(t=Y.data)||void 0===t?void 0:t.find(e=>e.round===_))||void 0===e?void 0:e.db_name),refreshDeps:[null===(l=null==Y?void 0:null===(r=Y.data)||void 0===r?void 0:r.find(e=>e.round===_))||void 0===l?void 0:l.db_name]}),{run:ec}=(0,i.Z)(async e=>await (0,v.Tk)("/v1/editor/sql",{con_uid:X,round:e}),{manual:!0,onSuccess:e=>{let t;try{if(Array.isArray(null==e?void 0:e.data))t=null==e?void 0:e.data,F(0);else if("string"==typeof(null==e?void 0:e.data)){let l=JSON.parse(null==e?void 0:e.data);t=l}else t=null==e?void 0:e.data}catch(e){console.log(e)}finally{D(t),Array.isArray(t)?L(null==t?void 0:t[Number(B||0)]):L(t)}}}),eu=(0,a.useMemo)(()=>{let e=(t,l)=>t.map(t=>{let a=t.title,i=a.indexOf(w),r=a.substring(0,i),o=a.slice(i+w.length),d=e=>{switch(e){case"db":return(0,n.jsx)(C,{});case"table":return(0,n.jsx)($,{});default:return(0,n.jsx)(Z,{})}},c=i>-1?(0,n.jsx)(s.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[d(t.type),"\xa0\xa0\xa0",r,(0,n.jsx)("span",{className:"text-[#1677ff]",children:w}),o,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})}):(0,n.jsx)(s.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[d(t.type),"\xa0\xa0\xa0",a,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})});if(t.children){let n=l?String(l)+"_"+t.key:t.key;return{title:a,showTitle:c,key:n,children:e(t.children,n)}}return{title:a,showTitle:c,key:t.key}});return(null==ed?void 0:ed.data)?(x([null==ed?void 0:ed.data.key]),e([null==ed?void 0:ed.data])):[]},[w,ed]),eh=(0,a.useMemo)(()=>{let e=[],t=(l,n)=>{if(l&&!((null==l?void 0:l.length)<=0))for(let a=0;a<l.length;a++){let i=l[a],{key:r,title:s}=i;e.push({key:r,title:s,parentKey:n}),i.children&&t(i.children,r)}};return eu&&t(eu),e},[eu]),em=(e,t)=>{let l;for(let n=0;n<t.length;n++){let a=t[n];a.children&&(a.children.some(t=>t.key===e)?l=a.key:em(e,a.children)&&(l=em(e,a.children)))}return l};function ev(e){let t;if(!e)return{sql:"",thoughts:""};let l=e&&e.match(/(--.*)\n([\s\S]*)/),n="";return l&&l.length>=3&&(n=l[1],t=l[2]),{sql:t,thoughts:n}}return(0,a.useEffect)(()=>{_&&ec(_)},[ec,_]),(0,a.useEffect)(()=>{T&&"chat_dashboard"===J&&B&&en()},[B,J,T,en]),(0,a.useEffect)(()=>{T&&"chat_dashboard"!==J&&et()},[J,T,et]),(0,n.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,n.jsx)(p.Z,{}),(0,n.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,n.jsxs)("div",{className:"relative flex overflow-hidden mr-4",children:[(0,n.jsx)("div",{className:S()("h-full relative transition-[width] overflow-hidden",{"w-0":U,"w-64":!U}),children:(0,n.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,n.jsx)(o.default,{size:"middle",className:"w-full mb-2",value:_,options:null==Y?void 0:null===(u=Y.data)||void 0===u?void 0:u.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{k(e)}}),(0,n.jsx)(M,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:t}=e.target;if(null==ed?void 0:ed.data){if(t){let e=eh.map(e=>e.title.indexOf(t)>-1?em(e.key,eu):null).filter((e,t,l)=>e&&l.indexOf(e)===t);x(e)}else x([]);b(t),V(!0)}}}),eu&&eu.length>0&&(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)(h.Z,{onExpand:e=>{x(e),V(!1)},expandedKeys:m,autoExpandParent:O,treeData:eu,fieldNames:{title:"showTitle"}})})]})}),(0,n.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,n.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{Q(!U)},children:U?(0,n.jsx)(g.Z,{}):(0,n.jsx)(y.Z,{})})})]}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,n.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(d.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,n.jsx)(j.Z,{}),loading:el||ea,onClick:async()=>{"chat_dashboard"===J?en():et()},children:"Run"}),(0,n.jsx)(d.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:er||eo,icon:(0,n.jsx)(N,{}),onClick:async()=>{"chat_dashboard"===J?await es():await ei()},children:"Save"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(c.Z,{className:S()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===G}),component:E,onClick:()=>{K("TB")}}),(0,n.jsx)(c.Z,{className:S()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===G}),component:P,onClick:()=>{K("LR")}})]})]}),Array.isArray(T)?(0,n.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:T.map((e,t)=>(0,n.jsx)(s.Z,{className:"inline-block",title:e.title,children:(0,n.jsx)("div",{className:S()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":B===t}),onClick:()=>{F(t),L(null==T?void 0:T[t])},children:e.title})},e.title))}),(0,n.jsx)("div",{className:"flex flex-1 overflow-hidden",children:T.map((e,t)=>(0,n.jsx)("div",{className:S()("w-full overflow-hidden",{hidden:t!==B,"block flex-1":t===B}),children:(0,n.jsx)(z,{layout:G,editorValue:e,handleChange:e=>{let{sql:t,thoughts:l}=ev(e);L(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:q,chartData:I})},e.title))})]}):(0,n.jsx)(z,{layout:G,editorValue:T,handleChange:e=>{let{sql:t,thoughts:l}=ev(e);L(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:q,chartData:void 0,tables:ed})]})]})]})}},53047:function(e,t,l){"use strict";l.d(t,{Z:function(){return O}});var n=l(96469),a=l(38497),i=l(70351),r=l(60205),s=l(19389),o=l(27691),d=l(64698),c=l(20222),u=l(86959),h=l(27623),m=l(45277),v=function(e){var t;let{convUid:l,chatMode:v,onComplete:f,...p}=e,[x,y]=(0,a.useState)(!1),[g,j]=i.ZP.useMessage(),[w,b]=(0,a.useState)([]),[_,N]=(0,a.useState)(),{model:C}=(0,a.useContext)(m.p),$=async e=>{var t;if(!e){i.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(t=e.file.name)&&void 0!==t?t:"")){i.ZP.error("File type must be csv, xlsx or xls");return}b([e.file])},Z=async()=>{y(!0);try{let e=new FormData;e.append("doc_file",w[0]),g.open({content:"Uploading ".concat(w[0].name),type:"loading",duration:0});let[t]=await (0,h.Vx)((0,h.qn)({convUid:l,chatMode:v,data:e,model:C,config:{timeout:36e5,onUploadProgress:e=>{let t=Math.ceil(e.loaded/(e.total||0)*100);N(t)}}}));if(t)return;i.ZP.success("success"),null==f||f()}catch(e){i.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{y(!1),g.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[j,(0,n.jsx)(r.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)(s.default,{disabled:x,className:"mr-1",beforeUpload:()=>!1,fileList:w,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:$,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...p,children:(0,n.jsx)(o.ZP,{className:"flex justify-center items-center",type:"primary",disabled:x,icon:(0,n.jsx)(d.Z,{}),children:"Select File"})})}),(0,n.jsx)(o.ZP,{type:"primary",loading:x,className:"flex justify-center items-center",disabled:!w.length,icon:(0,n.jsx)(c.Z,{}),onClick:Z,children:x?100===_?"Analysis":"Uploading":"Upload"}),!!w.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>b([]),children:[(0,n.jsx)(u.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(t=w[0])||void 0===t?void 0:t.name})]})]})})},f=function(e){let{onComplete:t}=e,{currentDialogue:l,scene:i,chatId:r}=(0,a.useContext)(m.p);return"chat_excel"!==i?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:l?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(u.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:l.select_param})]}):(0,n.jsx)(v,{convUid:r,chatMode:i,onComplete:t})})};l(65282);var p=l(76372),x=l(42834),y=l(13250),g=l(67901);function j(){let{isContract:e,setIsContract:t,scene:l}=(0,a.useContext)(m.p),i=l&&["chat_with_db_execute","chat_dashboard"].includes(l);return i?(0,n.jsxs)(p.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{t(!e)},children:[(0,n.jsxs)(p.ZP.Button,{value:!1,children:[(0,n.jsx)(x.Z,{component:g.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(p.ZP.Button,{value:!0,children:[(0,n.jsx)(y.Z,{className:"mr-1"}),"Editor"]})]}):null}var w=l(57064),b=l(7289),_=l(77200),N=l(16156),C=l(59321),$=function(){let{scene:e,dbParam:t,setDbParam:l}=(0,a.useContext)(m.p),[i,r]=(0,a.useState)([]);(0,_.Z)(async()=>{let[,t]=await (0,h.Vx)((0,h.vD)(e));r(null!=t?t:[])},[e]);let s=(0,a.useMemo)(()=>{var e;return null===(e=i.map)||void 0===e?void 0:e.call(i,e=>({name:e.param,...b.S$[e.type]}))},[i]);return((0,a.useEffect)(()=>{(null==s?void 0:s.length)&&!t&&l(s[0].name)},[s,l,t]),null==s?void 0:s.length)?(0,n.jsx)(N.default,{value:t,className:"w-36",onChange:e=>{l(e)},children:s.map(e=>(0,n.jsxs)(N.default.Option,{children:[(0,n.jsx)(C.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},Z=l(16602),k=l(56841),S=function(){let{t:e}=(0,k.$G)(),{agent:t,setAgent:l}=(0,a.useContext)(m.p),{data:i=[]}=(0,Z.Z)(async()=>{let[,e]=await (0,h.Vx)((0,h.H4)());return null!=e?e:[]});return(0,n.jsx)(N.default,{className:"w-60",value:t,placeholder:e("Select_Plugins"),options:i.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==l||l(e)}})},O=function(e){let{refreshHistory:t,modelChange:l}=e,{scene:i,refreshDialogList:r}=(0,a.useContext)(m.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,n.jsx)(w.Z,{onChange:l}),(0,n.jsx)($,{}),"chat_excel"===i&&(0,n.jsx)(f,{onComplete:()=>{null==r||r(),null==t||t()}}),"chat_agent"===i&&(0,n.jsx)(S,{}),(0,n.jsx)(j,{})]})}},57064:function(e,t,l){"use strict";l.d(t,{A:function(){return h}});var n=l(96469),a=l(45277),i=l(27250),r=l(16156),s=l(23852),o=l.n(s),d=l(38497),c=l(56841);let u="/models/huggingface.svg";function h(e,t){var l,a;let{width:r,height:s}=t||{};return e?(0,n.jsx)(o(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:r||24,height:s||24,src:(null===(l=i.Hf[e])||void 0===l?void 0:l.icon)||u,alt:"llm"},(null===(a=i.Hf[e])||void 0===a?void 0:a.icon)||u):null}t.Z=function(e){let{onChange:t}=e,{t:l}=(0,c.$G)(),{modelList:s,model:o}=(0,d.useContext)(a.p);return!s||s.length<=0?null:(0,n.jsx)(r.default,{value:o,placeholder:l("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:s.map(e=>{var t;return(0,n.jsx)(r.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[h(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(t=i.Hf[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},76592:function(e,t,l){"use strict";var n=l(96469),a=l(97818),i=l(27691),r=l(26869),s=l.n(r),o=l(56841);t.Z=function(e){let{className:t,error:l,description:r,refresh:d}=e,{t:c}=(0,o.$G)();return(0,n.jsx)(a.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:s()("flex items-center justify-center flex-col h-full w-full",t),description:l?(0,n.jsx)(i.ZP,{type:"primary",onClick:d,children:c("try_again")}):null!=r?r:c("no_data")})}},94078:function(e,t,l){"use strict";l.d(t,{Tk:function(){return d},PR:function(){return c}});var n=l(70351),a=l(81366),i=l(75299);let r=a.default.create({baseURL:i.env.API_BASE_URL});r.defaults.timeout=1e4,r.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),l(44766);var s=l(7289);let o={"content-type":"application/json","User-Id":(0,s.n5)()},d=(e,t)=>{if(t){let l=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");l&&(e+="?".concat(l))}return r.get("/api"+e,{headers:o}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},c=(e,t)=>r.post(e,t,{headers:o}).then(e=>e).catch(e=>{n.ZP.error(e),Promise.reject(e)})},65282:function(){},8874:function(e,t,l){"use strict";function n(e){if(null==e)throw TypeError("Cannot destructure "+e)}l.d(t,{Z:function(){return n}})}}]);