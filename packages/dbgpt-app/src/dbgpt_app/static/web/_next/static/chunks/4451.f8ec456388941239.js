(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4451],{96991:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=l(87462),a=l(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},s=l(13401),r=a.forwardRef(function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},36986:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=l(87462),a=l(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},s=l(13401),r=a.forwardRef(function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},49591:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=l(87462),a=l(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h360c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H184V184h656v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V144c0-17.7-14.3-32-32-32zM653.3 599.4l52.2-52.2a8.01 8.01 0 00-4.7-13.6l-179.4-21c-5.1-.6-9.5 3.7-8.9 8.9l21 179.4c.8 6.6 8.9 9.4 13.6 4.7l52.4-52.4 256.2 256.2c3.1 3.1 8.2 3.1 11.3 0l42.4-42.4c3.1-3.1 3.1-8.2 0-11.3L653.3 599.4z"}}]},name:"select",theme:"outlined"},s=l(13401),r=a.forwardRef(function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},88484:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=l(87462),a=l(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=l(13401),r=a.forwardRef(function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:i}))})},99134:function(e,t,l){"use strict";var n=l(67294);let a=(0,n.createContext)({});t.Z=a},21584:function(e,t,l){"use strict";var n=l(67294),a=l(93967),i=l.n(a),s=l(53124),r=l(99134),o=l(6999),d=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function c(e){return"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let u=["xs","sm","md","lg","xl","xxl"],v=n.forwardRef((e,t)=>{let{getPrefixCls:l,direction:a}=n.useContext(s.E_),{gutter:v,wrap:f}=n.useContext(r.Z),{prefixCls:h,span:m,order:x,offset:p,push:g,pull:y,className:j,children:w,flex:b,style:$}=e,Z=d(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),_=l("col",h),[N,C,S]=(0,o.cG)(_),k={},O={};u.forEach(t=>{let l={},n=e[t];"number"==typeof n?l.span=n:"object"==typeof n&&(l=n||{}),delete Z[t],O=Object.assign(Object.assign({},O),{[`${_}-${t}-${l.span}`]:void 0!==l.span,[`${_}-${t}-order-${l.order}`]:l.order||0===l.order,[`${_}-${t}-offset-${l.offset}`]:l.offset||0===l.offset,[`${_}-${t}-push-${l.push}`]:l.push||0===l.push,[`${_}-${t}-pull-${l.pull}`]:l.pull||0===l.pull,[`${_}-rtl`]:"rtl"===a}),l.flex&&(O[`${_}-${t}-flex`]=!0,k[`--${_}-${t}-flex`]=c(l.flex))});let M=i()(_,{[`${_}-${m}`]:void 0!==m,[`${_}-order-${x}`]:x,[`${_}-offset-${p}`]:p,[`${_}-push-${g}`]:g,[`${_}-pull-${y}`]:y},j,O,C,S),P={};if(v&&v[0]>0){let e=v[0]/2;P.paddingLeft=e,P.paddingRight=e}return b&&(P.flex=c(b),!1!==f||P.minWidth||(P.minWidth=0)),N(n.createElement("div",Object.assign({},Z,{style:Object.assign(Object.assign(Object.assign({},P),$),k),className:M,ref:t}),w))});t.Z=v},92820:function(e,t,l){"use strict";var n=l(67294),a=l(93967),i=l.n(a),s=l(74443),r=l(53124),o=l(99134),d=l(6999),c=function(e,t){var l={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(l[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(l[n[a]]=e[n[a]]);return l};function u(e,t){let[l,a]=n.useState("string"==typeof e?e:""),i=()=>{if("string"==typeof e&&a(e),"object"==typeof e)for(let l=0;l<s.c4.length;l++){let n=s.c4[l];if(!t[n])continue;let i=e[n];if(void 0!==i){a(i);return}}};return n.useEffect(()=>{i()},[JSON.stringify(e),t]),l}let v=n.forwardRef((e,t)=>{let{prefixCls:l,justify:a,align:v,className:f,style:h,children:m,gutter:x=0,wrap:p}=e,g=c(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:y,direction:j}=n.useContext(r.E_),[w,b]=n.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[$,Z]=n.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),_=u(v,$),N=u(a,$),C=n.useRef(x),S=(0,s.ZP)();n.useEffect(()=>{let e=S.subscribe(e=>{Z(e);let t=C.current||0;(!Array.isArray(t)&&"object"==typeof t||Array.isArray(t)&&("object"==typeof t[0]||"object"==typeof t[1]))&&b(e)});return()=>S.unsubscribe(e)},[]);let k=y("row",l),[O,M,P]=(0,d.VM)(k),E=(()=>{let e=[void 0,void 0],t=Array.isArray(x)?x:[x,void 0];return t.forEach((t,l)=>{if("object"==typeof t)for(let n=0;n<s.c4.length;n++){let a=s.c4[n];if(w[a]&&void 0!==t[a]){e[l]=t[a];break}}else e[l]=t}),e})(),z=i()(k,{[`${k}-no-wrap`]:!1===p,[`${k}-${N}`]:N,[`${k}-${_}`]:_,[`${k}-rtl`]:"rtl"===j},f,M,P),V={},H=null!=E[0]&&E[0]>0?-(E[0]/2):void 0;H&&(V.marginLeft=H,V.marginRight=H);let[q,R]=E;V.rowGap=R;let I=n.useMemo(()=>({gutter:[q,R],wrap:p}),[q,R,p]);return O(n.createElement(o.Z.Provider,{value:I},n.createElement("div",Object.assign({},g,{className:z,style:Object.assign(Object.assign({},V),h),ref:t}),m)))});t.Z=v},6999:function(e,t,l){"use strict";l.d(t,{VM:function(){return c},cG:function(){return u}});var n=l(25446),a=l(83559),i=l(83262);let s=e=>{let{componentCls:t}=e;return{[t]:{position:"relative",maxWidth:"100%",minHeight:1}}},r=(e,t)=>{let{prefixCls:l,componentCls:n,gridColumns:a}=e,i={};for(let e=a;e>=0;e--)0===e?(i[`${n}${t}-${e}`]={display:"none"},i[`${n}-push-${e}`]={insetInlineStart:"auto"},i[`${n}-pull-${e}`]={insetInlineEnd:"auto"},i[`${n}${t}-push-${e}`]={insetInlineStart:"auto"},i[`${n}${t}-pull-${e}`]={insetInlineEnd:"auto"},i[`${n}${t}-offset-${e}`]={marginInlineStart:0},i[`${n}${t}-order-${e}`]={order:0}):(i[`${n}${t}-${e}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${e/a*100}%`,maxWidth:`${e/a*100}%`}],i[`${n}${t}-push-${e}`]={insetInlineStart:`${e/a*100}%`},i[`${n}${t}-pull-${e}`]={insetInlineEnd:`${e/a*100}%`},i[`${n}${t}-offset-${e}`]={marginInlineStart:`${e/a*100}%`},i[`${n}${t}-order-${e}`]={order:e});return i[`${n}${t}-flex`]={flex:`var(--${l}${t}-flex)`},i},o=(e,t)=>r(e,t),d=(e,t,l)=>({[`@media (min-width: ${(0,n.bf)(t)})`]:Object.assign({},o(e,l))}),c=(0,a.I$)("Grid",e=>{let{componentCls:t}=e;return{[t]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},()=>({})),u=(0,a.I$)("Grid",e=>{let t=(0,i.IX)(e,{gridColumns:24}),l={"-sm":t.screenSMMin,"-md":t.screenMDMin,"-lg":t.screenLGMin,"-xl":t.screenXLMin,"-xxl":t.screenXXLMin};return[s(t),o(t,""),o(t,"-xs"),Object.keys(l).map(e=>d(t,l[e],e)).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})]},()=>({}))},96307:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return P}});var n=l(85893),a=l(30119),i=l(16165),s=l(65654),r=l(25278),o=l(39773),d=l(83062),c=l(34041),u=l(20863),v=l(14726),f=l(39332),h=l(67294),m=l(13768),x=l(34625),p=l(74434),g=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z"})})},y=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z"})})},j=l(6171),w=l(18073),b=l(14313),$=l(36986),Z=l(93967),_=l.n(Z),N=l(91085);function C(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF"}),(0,n.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32"})]})}function S(){return(0,n.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:(0,n.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db"})})}function k(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93"}),(0,n.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,n.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}let{Search:O}=r.default;function M(e){let{layout:t="LR",editorValue:l,chartData:a,tableData:i,tables:s,handleChange:r}=e,d=(0,h.useMemo)(()=>a?(0,n.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,n.jsx)(m.ZP,{chartsData:[a]})}):null,[a]),{columns:c,dataSource:u}=(0,h.useMemo)(()=>{let{columns:e=[],values:t=[]}=null!=i?i:{},l=e.map(e=>({key:e,dataIndex:e,title:e})),n=t.map(t=>t.reduce((t,l,n)=>(t[e[n]]=l,t),{}));return{columns:l,dataSource:n}},[i]),v=(0,h.useMemo)(()=>{let e={},t=null==s?void 0:s.data,l=null==t?void 0:t.children;return null==l||l.forEach(t=>{e[t.title]=t.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==t?void 0:t.title)?[]:(null==l?void 0:l.map(e=>e.title))||[],getTableColumns:async t=>e[t]||[],getSchemaList:async()=>(null==t?void 0:t.title)?[null==t?void 0:t.title]:[]}},[s]);return(0,n.jsxs)("div",{className:_()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===t,"flex-row":"LR"===t}),children:[(0,n.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,n.jsx)(p.Z,{value:(null==l?void 0:l.sql)||"",language:"mysql",onChange:r,thoughts:(null==l?void 0:l.thoughts)||"",session:v})}),(0,n.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==i?void 0:i.values.length)?(0,n.jsx)(o.Z,{bordered:!0,scroll:{x:"auto"},rowKey:c[0].key,columns:c,dataSource:u}):(0,n.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,n.jsx)(N.Z,{})}),d]})]})}var P=function(){var e,t,l,r,o;let[m,p]=(0,h.useState)([]),[Z,N]=(0,h.useState)(""),[P,E]=(0,h.useState)(),[z,V]=(0,h.useState)(!0),[H,q]=(0,h.useState)(),[R,I]=(0,h.useState)(),[L,A]=(0,h.useState)(),[B,D]=(0,h.useState)(),[U,T]=(0,h.useState)(),[F,G]=(0,h.useState)(!1),[W,K]=(0,h.useState)("TB"),X=(0,f.useSearchParams)(),J=null==X?void 0:X.get("id"),Y=null==X?void 0:X.get("scene"),{data:Q}=(0,s.Z)(async()=>await (0,a.Tk)("/v1/editor/sql/rounds",{con_uid:J}),{onSuccess:e=>{var t,l;let n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t[(null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.length)-1];n&&E(null==n?void 0:n.round)}}),{run:ee,loading:et}=(0,s.Z)(async()=>{var e,t;let l=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/editor/sql/run",{db_name:l,sql:null==L?void 0:L.sql})},{manual:!0,onSuccess:e=>{var t,l;D({columns:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.colunms,values:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.values})}}),{run:el,loading:en}=(0,s.Z)(async()=>{var e,t;let l=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name,n={db_name:l,sql:null==L?void 0:L.sql};return"chat_dashboard"===Y&&(n.chart_type=null==L?void 0:L.showcase),await (0,a.PR)("/api/v1/editor/chart/run",n)},{manual:!0,ready:!!(null==L?void 0:L.sql),onSuccess:e=>{if(null==e?void 0:e.success){var t,l,n,a,i,s,r;D({columns:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(l=t.sql_data)||void 0===l?void 0:l.colunms)||[],values:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(a=n.sql_data)||void 0===a?void 0:a.values)||[]}),(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values)?q({type:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.chart_type,values:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.chart_values,title:null==L?void 0:L.title,description:null==L?void 0:L.thoughts}):q(void 0)}}}),{run:ea,loading:ei}=(0,s.Z)(async()=>{var e,t,l,n,i;let s=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/sql/editor/submit",{conv_uid:J,db_name:s,conv_round:P,old_sql:null==R?void 0:R.sql,old_speak:null==R?void 0:R.thoughts,new_sql:null==L?void 0:L.sql,new_speak:(null===(l=null==L?void 0:null===(n=L.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===l?void 0:null===(i=l[1])||void 0===i?void 0:i.trim())||(null==L?void 0:L.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&ee()}}),{run:es,loading:er}=(0,s.Z)(async()=>{var e,t,l,n,i,s;let r=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/chart/editor/submit",{conv_uid:J,chart_title:null==L?void 0:L.title,db_name:r,old_sql:null==R?void 0:null===(l=R[null!=U?U:0])||void 0===l?void 0:l.sql,new_chart_type:null==L?void 0:L.showcase,new_sql:null==L?void 0:L.sql,new_comment:(null===(n=null==L?void 0:null===(i=L.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(s=n[1])||void 0===s?void 0:s.trim())||(null==L?void 0:L.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&el()}}),{data:eo}=(0,s.Z)(async()=>{var e,t;let l=null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name;return await (0,a.Tk)("/v1/editor/db/tables",{db_name:l,page_index:1,page_size:200})},{ready:!!(null===(e=null==Q?void 0:null===(t=Q.data)||void 0===t?void 0:t.find(e=>e.round===P))||void 0===e?void 0:e.db_name),refreshDeps:[null===(l=null==Q?void 0:null===(r=Q.data)||void 0===r?void 0:r.find(e=>e.round===P))||void 0===l?void 0:l.db_name]}),{run:ed}=(0,s.Z)(async e=>await (0,a.Tk)("/v1/editor/sql",{con_uid:J,round:e}),{manual:!0,onSuccess:e=>{let t;try{if(Array.isArray(null==e?void 0:e.data))t=null==e?void 0:e.data,T(0);else if("string"==typeof(null==e?void 0:e.data)){let l=JSON.parse(null==e?void 0:e.data);t=l}else t=null==e?void 0:e.data}catch(e){console.log(e)}finally{I(t),Array.isArray(t)?A(null==t?void 0:t[Number(U||0)]):A(t)}}}),ec=(0,h.useMemo)(()=>{let e=(t,l)=>t.map(t=>{let a=t.title,i=a.indexOf(Z),s=a.substring(0,i),r=a.slice(i+Z.length),o=e=>{switch(e){case"db":return(0,n.jsx)(C,{});case"table":return(0,n.jsx)(k,{});default:return(0,n.jsx)(S,{})}},c=i>-1?(0,n.jsx)(d.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(t.type),"\xa0\xa0\xa0",s,(0,n.jsx)("span",{className:"text-[#1677ff]",children:Z}),r,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})}):(0,n.jsx)(d.Z,{title:((null==t?void 0:t.comment)||(null==t?void 0:t.title))+((null==t?void 0:t.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(t.type),"\xa0\xa0\xa0",a,"\xa0",(null==t?void 0:t.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==t?void 0:t.type})]})});if(t.children){let n=l?String(l)+"_"+t.key:t.key;return{title:a,showTitle:c,key:n,children:e(t.children,n)}}return{title:a,showTitle:c,key:t.key}});return(null==eo?void 0:eo.data)?(p([null==eo?void 0:eo.data.key]),e([null==eo?void 0:eo.data])):[]},[Z,eo]),eu=(0,h.useMemo)(()=>{let e=[],t=(l,n)=>{if(l&&!((null==l?void 0:l.length)<=0))for(let a=0;a<l.length;a++){let i=l[a],{key:s,title:r}=i;e.push({key:s,title:r,parentKey:n}),i.children&&t(i.children,s)}};return ec&&t(ec),e},[ec]),ev=(e,t)=>{let l;for(let n=0;n<t.length;n++){let a=t[n];a.children&&(a.children.some(t=>t.key===e)?l=a.key:ev(e,a.children)&&(l=ev(e,a.children)))}return l};function ef(e){let t;if(!e)return{sql:"",thoughts:""};let l=e&&e.match(/(--.*)?\n?([\s\S]*)/),n="";return l&&l.length>=3&&(n=l[1],t=l[2]),{sql:t,thoughts:n}}return(0,h.useEffect)(()=>{P&&ed(P)},[ed,P]),(0,h.useEffect)(()=>{R&&"chat_dashboard"===Y&&U&&el()},[U,Y,R,el]),(0,h.useEffect)(()=>{R&&"chat_dashboard"!==Y&&ee()},[Y,R,ee]),(0,n.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,n.jsx)(x.Z,{}),(0,n.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,n.jsxs)("div",{className:"relative flex overflow-hidden mr-4",children:[(0,n.jsx)("div",{className:_()("h-full relative transition-[width] overflow-hidden",{"w-0":F,"w-64":!F}),children:(0,n.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,n.jsx)(c.default,{size:"middle",className:"w-full mb-2",value:P,options:null==Q?void 0:null===(o=Q.data)||void 0===o?void 0:o.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{E(e)}}),(0,n.jsx)(O,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:t}=e.target;if(null==eo?void 0:eo.data){if(t){let e=eu.map(e=>e.title.indexOf(t)>-1?ev(e.key,ec):null).filter((e,t,l)=>e&&l.indexOf(e)===t);p(e)}else p([]);N(t),V(!0)}}}),ec&&ec.length>0&&(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)(u.Z,{onExpand:e=>{p(e),V(!1)},expandedKeys:m,autoExpandParent:z,treeData:ec,fieldNames:{title:"showTitle"}})})]})}),(0,n.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,n.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{G(!F)},children:F?(0,n.jsx)(w.Z,{}):(0,n.jsx)(j.Z,{})})})]}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,n.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,n.jsx)(b.Z,{}),loading:et||en,onClick:async()=>{"chat_dashboard"===Y?el():ee()},children:"Run"}),(0,n.jsx)(v.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:ei||er,icon:(0,n.jsx)($.Z,{}),onClick:async()=>{"chat_dashboard"===Y?await es():await ea()},children:"Save"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(i.Z,{className:_()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===W}),component:y,onClick:()=>{K("TB")}}),(0,n.jsx)(i.Z,{className:_()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===W}),component:g,onClick:()=>{K("LR")}})]})]}),Array.isArray(R)?(0,n.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:R.map((e,t)=>(0,n.jsx)(d.Z,{className:"inline-block",title:e.title,children:(0,n.jsx)("div",{className:_()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":U===t}),onClick:()=>{T(t),A(null==R?void 0:R[t])},children:e.title})},e.title))}),(0,n.jsx)("div",{className:"flex flex-1 overflow-hidden",children:R.map((e,t)=>(0,n.jsx)("div",{className:_()("w-full overflow-hidden",{hidden:t!==U,"block flex-1":t===U}),children:(0,n.jsx)(M,{layout:W,editorValue:e,handleChange:e=>{let{sql:t,thoughts:l}=ef(e);A(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:B,chartData:H})},e.title))})]}):(0,n.jsx)(M,{layout:W,editorValue:R,handleChange:e=>{let{sql:t,thoughts:l}=ef(e);A(e=>Object.assign({},e,{sql:t,thoughts:l}))},tableData:B,chartData:void 0,tables:eo})]})]})]})}},34625:function(e,t,l){"use strict";l.d(t,{Z:function(){return M}});var n=l(85893),a=l(41468),i=l(81799),s=l(82353),r=l(16165),o=l(96991),d=l(78045),c=l(67294);function u(){let{isContract:e,setIsContract:t,scene:l}=(0,c.useContext)(a.p),i=l&&["chat_with_db_execute","chat_dashboard"].includes(l);return i?(0,n.jsxs)(d.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{t(!e)},children:[(0,n.jsxs)(d.ZP.Button,{value:!1,children:[(0,n.jsx)(r.Z,{component:s.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(d.ZP.Button,{value:!0,children:[(0,n.jsx)(o.Z,{className:"mr-1"}),"Editor"]})]}):null}l(23293);var v=l(76212),f=l(65654),h=l(34041),m=l(67421),x=function(){let{t:e}=(0,m.$G)(),{agent:t,setAgent:l}=(0,c.useContext)(a.p),{data:i=[]}=(0,f.Z)(async()=>{let[,e]=await (0,v.Vx)((0,v.H4)());return null!=e?e:[]});return(0,n.jsx)(h.default,{className:"w-60",value:t,placeholder:e("Select_Plugins"),options:i.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==l||l(e)}})},p=l(29158),g=l(57249),y=l(49591),j=l(88484),w=l(45360),b=l(83062),$=l(23799),Z=l(14726),_=function(e){var t;let{convUid:l,chatMode:i,onComplete:s,...r}=e,[o,d]=(0,c.useState)(!1),[u,f]=w.ZP.useMessage(),[h,m]=(0,c.useState)([]),[x,_]=(0,c.useState)(),{model:N}=(0,c.useContext)(a.p),{temperatureValue:C,maxNewTokensValue:S}=(0,c.useContext)(g.ChatContentContext),k=async e=>{var t;if(!e){w.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(t=e.file.name)&&void 0!==t?t:"")){w.ZP.error("File type must be csv, xlsx or xls");return}m([e.file])},O=async()=>{d(!0);try{let e=new FormData;e.append("doc_file",h[0]),u.open({content:"Uploading ".concat(h[0].name),type:"loading",duration:0});let[t]=await (0,v.Vx)((0,v.qn)({convUid:l,chatMode:i,data:e,model:N,temperatureValue:C,maxNewTokensValue:S,config:{timeout:36e5,onUploadProgress:e=>{let t=Math.ceil(e.loaded/(e.total||0)*100);_(t)}}}));if(t)return;w.ZP.success("success"),null==s||s()}catch(e){w.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{d(!1),u.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[f,(0,n.jsx)(b.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)($.default,{disabled:o,className:"mr-1",beforeUpload:()=>!1,fileList:h,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:k,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...r,children:(0,n.jsx)(Z.ZP,{className:"flex justify-center items-center",type:"primary",disabled:o,icon:(0,n.jsx)(y.Z,{}),children:"Select File"})})}),(0,n.jsx)(Z.ZP,{type:"primary",loading:o,className:"flex justify-center items-center",disabled:!h.length,icon:(0,n.jsx)(j.Z,{}),onClick:O,children:o?100===x?"Analysis":"Uploading":"Upload"}),!!h.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>m([]),children:[(0,n.jsx)(p.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(t=h[0])||void 0===t?void 0:t.name})]})]})})},N=function(e){let{onComplete:t}=e,{currentDialogue:l,scene:i,chatId:s}=(0,c.useContext)(a.p);return"chat_excel"!==i?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:l?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(p.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:l.select_param})]}):(0,n.jsx)(_,{convUid:s,chatMode:i,onComplete:t})})},C=l(23430),S=l(62418),k=l(2093),O=function(){let{scene:e,dbParam:t,setDbParam:l}=(0,c.useContext)(a.p),[i,s]=(0,c.useState)([]);(0,k.Z)(async()=>{let[,t]=await (0,v.Vx)((0,v.vD)(e));s(null!=t?t:[])},[e]);let r=(0,c.useMemo)(()=>{var e;return null===(e=i.map)||void 0===e?void 0:e.call(i,e=>({name:e.param,...S.S$[e.type]}))},[i]);return((0,c.useEffect)(()=>{(null==r?void 0:r.length)&&!t&&l(r[0].name)},[r,l,t]),null==r?void 0:r.length)?(0,n.jsx)(h.default,{value:t,className:"w-36",onChange:e=>{l(e)},children:r.map(e=>(0,n.jsxs)(h.default.Option,{children:[(0,n.jsx)(C.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},M=function(e){let{refreshHistory:t,modelChange:l}=e,{scene:s,refreshDialogList:r}=(0,c.useContext)(a.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,n.jsx)(i.Z,{onChange:l}),(0,n.jsx)(O,{}),"chat_excel"===s&&(0,n.jsx)(N,{onComplete:()=>{null==r||r(),null==t||t()}}),"chat_agent"===s&&(0,n.jsx)(x,{}),(0,n.jsx)(u,{})]})}},81799:function(e,t,l){"use strict";l.d(t,{A:function(){return v}});var n=l(85893),a=l(41468),i=l(19284),s=l(34041),r=l(25675),o=l.n(r),d=l(67294),c=l(67421);let u="/models/huggingface.svg";function v(e,t){var l,a;let{width:s,height:r}=t||{};return e?(0,n.jsx)(o(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:r||24,src:(null===(l=i.Hf[e])||void 0===l?void 0:l.icon)||u,alt:"llm"},(null===(a=i.Hf[e])||void 0===a?void 0:a.icon)||u):null}t.Z=function(e){let{onChange:t}=e,{t:l}=(0,c.$G)(),{modelList:r,model:o}=(0,d.useContext)(a.p);return!r||r.length<=0?null:(0,n.jsx)(s.default,{value:o,placeholder:l("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:r.map(e=>{var t;return(0,n.jsx)(s.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[v(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(t=i.Hf[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},91085:function(e,t,l){"use strict";var n=l(85893),a=l(32983),i=l(14726),s=l(93967),r=l.n(s),o=l(67421);t.Z=function(e){let{className:t,error:l,description:s,refresh:d}=e,{t:c}=(0,o.$G)();return(0,n.jsx)(a.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:r()("flex items-center justify-center flex-col h-full w-full",t),description:l?(0,n.jsx)(i.ZP,{type:"primary",onClick:d,children:c("try_again")}):null!=s?s:c("no_data")})}},30119:function(e,t,l){"use strict";l.d(t,{Tk:function(){return c},PR:function(){return u}});var n,a=l(62418),i=l(45360);l(96486);var s=l(87066),r=l(83454);let o=s.default.create({baseURL:null!==(n=r.env.API_BASE_URL)&&void 0!==n?n:""});o.defaults.timeout=1e4,o.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let d={"content-type":"application/json","User-Id":(0,a.n5)()},c=(e,t)=>{if(t){let l=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");l&&(e+="?".concat(l))}return o.get("/api"+e,{headers:d}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},u=(e,t)=>o.post(e,t,{headers:d}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},23293:function(){},36459:function(e,t,l){"use strict";function n(e){if(null==e)throw TypeError("Cannot destructure "+e)}l.d(t,{Z:function(){return n}})}}]);