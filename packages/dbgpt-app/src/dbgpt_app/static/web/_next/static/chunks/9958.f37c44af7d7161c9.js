"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9958],{2440:function(e,l,t){var a=t(25519);l.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}},88331:function(e,l,t){t.r(l),t.d(l,{default:function(){return Y}});var a=t(85893),s=t(41468),n=t(76212),r=t(74434),i=t(13185),o=t(25519),c=t(24019),d=t(50888),u=t(97937),m=t(63606),x=t(57132),p=t(89035),v=t(32975),f=t(45360),h=t(93967),g=t.n(h),y=t(25675),j=t.n(y),w=t(39332),_=t(67294),b=t(67421),k=t(14660),N=t(55186),Z=t(65429),C=t(15381),S=t(65654),P=t(66309),O=t(25278),J=t(14726),$=t(55241),I=t(96074),M=t(20640),T=t.n(M);let A=e=>{let{list:l,loading:t,feedback:s,setFeedbackOpen:n}=e,{t:r}=(0,b.$G)(),[i,o]=(0,_.useState)([]),[c,d]=(0,_.useState)("");return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"flex flex-1 flex-wrap w-72",children:null==l?void 0:l.map(e=>{let l=i.findIndex(l=>l.reason_type===e.reason_type)>-1;return(0,a.jsx)(P.Z,{className:"text-xs text-[#525964] mb-2 p-1 px-2 rounded-md cursor-pointer ".concat(l?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{o(l=>{let t=l.findIndex(l=>l.reason_type===e.reason_type);return t>-1?[...l.slice(0,t),...l.slice(t+1)]:[...l,e]})},children:e.reason},e.reason_type)})}),(0,a.jsx)(O.default.TextArea,{placeholder:r("feedback_tip"),className:"w-64 h-20 resize-none mb-2",value:c,onChange:e=>d(e.target.value.trim())}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(J.ZP,{className:"w-16 h-8",onClick:()=>{n(!1)},children:"取消"}),(0,a.jsx)(J.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=i.map(e=>e.reason_type);await (null==s?void 0:s({feedback_type:"unlike",reason_types:e,remark:c}))},loading:t,children:"确认"})]})]})};var E=e=>{var l,t;let{content:s}=e,{t:r}=(0,b.$G)(),i=(0,w.useSearchParams)(),o=null!==(t=null==i?void 0:i.get("id"))&&void 0!==t?t:"",[c,d]=f.ZP.useMessage(),[u,m]=(0,_.useState)(!1),[p,v]=(0,_.useState)(null==s?void 0:null===(l=s.feedback)||void 0===l?void 0:l.feedback_type),[h,y]=(0,_.useState)(),j=async e=>{let l=null==e?void 0:e.replace(/\trelations:.*/g,""),t=T()(l);t?l?c.open({type:"success",content:r("copy_success")}):c.open({type:"warning",content:r("copy_nothing")}):c.open({type:"error",content:r("copy_failed")})},{run:k,loading:N}=(0,S.Z)(async e=>await (0,n.Vx)((0,n.zx)({conv_uid:o,message_id:s.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,l]=e;v(null==l?void 0:l.feedback_type),f.ZP.success("反馈成功"),m(!1)}}),{run:P}=(0,S.Z)(async()=>await (0,n.Vx)((0,n.Jr)()),{manual:!0,onSuccess:e=>{let[,l]=e;y(l||[]),l&&m(!0)}}),{run:O}=(0,S.Z)(async()=>await (0,n.Vx)((0,n.Ir)({conv_uid:o,message_id:(null==s?void 0:s.order)+""})),{manual:!0,onSuccess:e=>{let[,l]=e;l&&(v("none"),f.ZP.success("操作成功"))}});return(0,a.jsxs)(a.Fragment,{children:[d,(0,a.jsxs)("div",{className:"flex flex-1 items-center text-sm px-4",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(Z.Z,{className:g()("cursor-pointer",{"text-[#0C75FC]":"like"===p}),onClick:async()=>{if("like"===p){await O();return}await k({feedback_type:"like"})}}),(0,a.jsx)($.Z,{placement:"bottom",autoAdjustOverflow:!0,destroyTooltipOnHide:!0,content:(0,a.jsx)(A,{setFeedbackOpen:m,feedback:k,list:h||[],loading:N}),trigger:"click",open:u,children:(0,a.jsx)(C.Z,{className:g()("cursor-pointer",{"text-[#0C75FC]":"unlike"===p}),onClick:async()=>{if("unlike"===p){await O();return}await P()}})})]}),(0,a.jsx)(I.Z,{type:"vertical"}),(0,a.jsx)(x.Z,{className:"cursor-pointer",onClick:()=>j(s.context)})]})]})},F=t(50228),V=t(48218),B=t(39718),G=(0,_.memo)(e=>{var l;let{model:t}=e,s=(0,w.useSearchParams)(),n=null!==(l=null==s?void 0:s.get("scene"))&&void 0!==l?l:"";return"chat_agent"===n?(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white dark:bg-[rgba(255,255,255,0.16)]",children:(0,a.jsx)(V.Z,{scene:n})}):t?(0,a.jsx)(B.Z,{width:32,height:32,model:t}):(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white dark:bg-[rgba(255,255,255,0.16)]",children:(0,a.jsx)(F.Z,{})})});let z=()=>{var e;let l=JSON.parse(null!==(e=localStorage.getItem(o.C9))&&void 0!==e?e:"");return l.avatar_url?(0,a.jsx)(j(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:32,height:32,src:null==l?void 0:l.avatar_url,alt:null==l?void 0:l.nick_name}):(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-tr from-[#31afff] to-[#1677ff] text-xs text-white",children:null==l?void 0:l.nick_name})},D={todo:{bgClass:"bg-gray-500",icon:(0,a.jsx)(c.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,a.jsx)(d.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,a.jsx)(u.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,a.jsx)(m.Z,{className:"ml-2"})}},H=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"),L=e=>null==e?void 0:e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");var R=(0,_.memo)(e=>{var l;let{content:t,onLinkClick:s}=e,{t:n}=(0,b.$G)(),r=(0,w.useSearchParams)(),o=null!==(l=null==r?void 0:r.get("scene"))&&void 0!==l?l:"",{context:c,model_name:d,role:u,thinking:m}=t,h=(0,_.useMemo)(()=>"view"===u,[u]),{value:y,cachePluginContext:j}=(0,_.useMemo)(()=>{if("string"!=typeof c)return{relations:[],value:"",cachePluginContext:[]};let[e,l]=c.split("	relations:"),t=l?l.split(","):[],a=[],s=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var l;let t=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(t),r="<custom-view>".concat(s,"</custom-view>");return a.push({...n,result:H(null!==(l=n.result)&&void 0!==l?l:"")}),s++,r}catch(l){return console.log(l.message,l),e}});return{relations:t,cachePluginContext:a,value:n}},[c]),Z=(0,_.useMemo)(()=>({"custom-view"(e){var l;let{children:t}=e,s=+t.toString();if(!j[s])return t;let{name:n,status:r,err_msg:o,result:c}=j[s],{bgClass:d,icon:u}=null!==(l=D[r])&&void 0!==l?l:{};return(0,a.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,a.jsxs)("div",{className:g()("flex px-4 md:px-6 py-2 items-center text-white text-sm",d),children:[n,u]}),c?(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,a.jsx)(v.Z,{components:i.Z,rehypePlugins:[k.Z],remarkPlugins:[N.Z],children:null!=c?c:""})}):(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:o})]})}}),[j]);return(0,a.jsxs)("div",{className:"flex flex-1 gap-3 mt-6",children:[(0,a.jsx)("div",{className:"flex flex-shrink-0 items-start",children:h?(0,a.jsx)(G,{model:d}):(0,a.jsx)(z,{})}),(0,a.jsxs)("div",{className:"flex ".concat("chat_agent"!==o||m?"":"flex-1"," overflow-hidden"),children:[!h&&(0,a.jsxs)("div",{className:"flex flex-1 relative group",children:[(0,a.jsx)("div",{className:"flex-1 text-sm text-[#1c2533] dark:text-white",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:"string"==typeof c&&c}),"string"==typeof c&&c.trim()&&(0,a.jsx)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,a.jsx)("button",{className:"flex items-center justify-center w-8 h-8 text-[#525964] dark:text-[rgba(255,255,255,0.6)] hover:text-[#1677ff] dark:hover:text-white transition-colors",onClick:()=>{"string"==typeof c&&navigator.clipboard.writeText(c).then(()=>{f.ZP.success(n("copy_to_clipboard_success"))}).catch(e=>{console.error(n("copy_to_clipboard_failed"),e),f.ZP.error(n("copy_to_clipboard_failed"))})},title:n("copy_to_clipboard"),children:(0,a.jsx)(x.Z,{})})})]}),h&&(0,a.jsxs)("div",{className:"flex flex-1 flex-col w-full",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-[rgba(255,255,255,0.16)] p-4 rounded-2xl rounded-tl-none mb-2",children:["object"==typeof c&&(0,a.jsxs)("div",{children:["[".concat(c.template_name,"]: "),(0,a.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:s,children:[(0,a.jsx)(p.Z,{className:"mr-1"}),c.template_introduce||"More Details"]})]}),"string"==typeof c&&"chat_agent"===o&&(0,a.jsx)(v.Z,{components:{...i.Z},rehypePlugins:[k.Z],remarkPlugins:[N.Z],children:L(y)}),"string"==typeof c&&"chat_agent"!==o&&(0,a.jsx)("div",{children:(0,a.jsx)(v.Z,{components:{...i.Z,...Z},rehypePlugins:[k.Z],remarkPlugins:[N.Z],children:H(y)})}),m&&!c&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:n("thinking")}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]})]}),(0,a.jsx)(E,{content:t})]})]})]})}),U=t(57249),q=t(62418),K=t(2093),Q=t(85576),W=t(96486),X=t(25934),Y=()=>{var e,l;let t=(0,_.useRef)(null),i=(0,w.useSearchParams)(),o=null!==(l=null==i?void 0:i.get("id"))&&void 0!==l?l:"",{currentDialogInfo:c,model:d}=(0,_.useContext)(s.p),{history:u,handleChat:m,refreshDialogList:x,setAppInfo:p,setModelValue:v,setTemperatureValue:f,setMaxNewTokensValue:h,setResourceValue:g}=(0,_.useContext)(U.ChatContentContext),[y,j]=(0,_.useState)(!1),[b,k]=(0,_.useState)(""),N=(0,_.useMemo)(()=>{let e=(0,W.cloneDeep)(u);return e.filter(e=>["view","human"].includes(e.role)).map(e=>({...e,key:(0,X.Z)()}))},[u]);return(0,K.Z)(async()=>{let e=(0,q.a_)();if(e&&e.id===o){let[,o]=await (0,n.Vx)((0,n.BN)({...c}));if(o){var l,t,a,s,r,i,u,y,j;let n=(null==o?void 0:null===(l=o.param_need)||void 0===l?void 0:l.map(e=>e.type))||[],c=(null===(t=null==o?void 0:null===(a=o.param_need)||void 0===a?void 0:a.filter(e=>"model"===e.type)[0])||void 0===t?void 0:t.value)||d,w=(null===(s=null==o?void 0:null===(r=o.param_need)||void 0===r?void 0:r.filter(e=>"temperature"===e.type)[0])||void 0===s?void 0:s.value)||.6,_=(null===(i=null==o?void 0:null===(u=o.param_need)||void 0===u?void 0:u.filter(e=>"max_new_tokens"===e.type)[0])||void 0===i?void 0:i.value)||4e3,b=null===(y=null==o?void 0:null===(j=o.param_need)||void 0===j?void 0:j.filter(e=>"resource"===e.type)[0])||void 0===y?void 0:y.bind_value;p(o||{}),f(w||.6),h(_||4e3),v(c),g(b),await m(e.message,{app_code:null==o?void 0:o.app_code,model_name:c,...(null==n?void 0:n.includes("temperature"))&&{temperature:w},...(null==n?void 0:n.includes("max_new_tokens"))&&{max_new_tokens:_},...n.includes("resource")&&{select_param:"string"==typeof b?b:JSON.stringify(b)}}),await x(),localStorage.removeItem(q.rU)}}},[o,c]),(0,_.useEffect)(()=>{setTimeout(()=>{var e,l;null===(e=t.current)||void 0===e||e.scrollTo(0,null===(l=t.current)||void 0===l?void 0:l.scrollHeight)},50)},[u,null===(e=u[u.length-1])||void 0===e?void 0:e.context]),(0,a.jsxs)("div",{className:"flex flex-col w-5/6 mx-auto",ref:t,children:[!!N.length&&N.map((e,l)=>(0,a.jsx)(R,{content:e,onLinkClick:()=>{j(!0),k(JSON.stringify(null==e?void 0:e.context,null,2))}},l)),(0,a.jsx)(Q.default,{title:"JSON Editor",open:y,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{j(!1)},onCancel:()=>{j(!1)},children:(0,a.jsx)(r.Z,{className:"w-full h-[500px]",language:"json",value:b})})]})}}}]);