(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5558],{71965:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var i=n(87462),r=n(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},o=n(13401),s=r.forwardRef(function(t,e){return r.createElement(o.Z,(0,i.Z)({},t,{ref:e,icon:a}))})},81746:function(t){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports={assign:Object.assign,getHeight:function(t,e,n,i){return void 0===i&&(i="height"),"center"===n?(t[i]+e[i])/2:t.height}}},function(t,e,n){var i=n(3),r=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.rootNode=i(t,e)}return t.prototype.execute=function(){throw Error("please override this method")},t}();t.exports=r},function(t,e,n){var i=n(4),r=["LR","RL","TB","BT","H","V"],a=["LR","RL","H"],o=r[0];t.exports=function(t,e,n){var s=e.direction||o;if(e.isHorizontal=a.indexOf(s)>-1,s&&-1===r.indexOf(s))throw TypeError("Invalid direction: "+s);if(s===r[0])n(t,e);else if(s===r[1])n(t,e),t.right2left();else if(s===r[2])n(t,e);else if(s===r[3])n(t,e),t.bottom2top();else if(s===r[4]||s===r[5]){var l=i(t,e),h=l.left,c=l.right;n(h,e),n(c,e),e.isHorizontal?h.right2left():h.bottom2top(),c.translate(h.x-c.x,h.y-c.y),t.x=h.x,t.y=c.y;var u=t.getBoundingBox();e.isHorizontal?u.top<0&&t.translate(0,-u.top):u.left<0&&t.translate(-u.left,0)}var d=e.fixedRoot;return void 0===d&&(d=!0),d&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),t}},function(t,e,n){var i=n(0),r={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function a(t,e){if(this.vgap=this.hgap=0,t instanceof a)return t;this.data=t;var n=e.getHGap(t),i=e.getVGap(t);return this.preH=e.getPreH(t),this.preV=e.getPreV(t),this.width=e.getWidth(t),this.height=e.getHeight(t),this.width+=this.preH,this.height+=this.preV,this.id=e.getId(t),this.x=this.y=0,this.depth=0,this.children||(this.children=[]),this.addGap(n,i),this}i.assign(a.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){this.hgap+=t,this.vgap+=e,this.width+=2*t,this.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode(function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)}),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode(function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV})},right2left:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.x=e.x-(e.x-t.left)*2-e.width}),this.translate(t.width,0)},bottom2top:function(){var t=this.getBoundingBox();this.eachNode(function(e){e.y=e.y-(e.y-t.top)*2-e.height}),this.translate(0,t.height)}}),t.exports=function(t,e,n){void 0===e&&(e={}),e=i.assign({},r,e);var o,s=new a(t,e),l=[s];if(!n&&!t.collapsed){for(;o=l.shift();)if(!o.data.collapsed){var h=e.getChildren(o.data),c=h?h.length:0;if(o.children=Array(c),h&&c)for(var u=0;u<c;u++){var d=new a(h[u],e);o.children[u]=d,l.push(d),d.parent=o,d.depth=o.depth+1}}}return s}},function(t,e,n){var i=n(3);t.exports=function(t,e){for(var n=i(t.data,e,!0),r=i(t.data,e,!0),a=t.children.length,o=Math.round(a/2),s=e.getSide||function(t,e){return e<o?"right":"left"},l=0;l<a;l++){var h=t.children[l];"right"===s(h,l)?r.children.push(h):n.children.push(h)}return n.eachNode(function(t){t.isRoot()||(t.side="left")}),r.eachNode(function(t){t.isRoot()||(t.side="right")}),{left:n,right:r}}},function(t,e,n){var i={compactBox:n(6),dendrogram:n(8),indented:n(10),mindmap:n(12)};t.exports=i},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),a=n(7),o=n(2),s=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return o(this.rootNode,this.options,a)},e}(r),h={};t.exports=function(t,e){return e=s.assign({},h,e),new l(t,e).execute()}},function(t,e){function n(t,e,n,i){void 0===i&&(i=[]),this.w=t||0,this.h=e||0,this.y=n||0,this.x=0,this.c=i||[],this.cs=i.length,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}n.fromNode=function(t,e){if(!t)return null;var i=[];return(t.children.forEach(function(t){i.push(n.fromNode(t,e))}),e)?new n(t.height,t.width,t.x,i):new n(t.width,t.height,t.y,i)},t.exports=function(t,e){void 0===e&&(e={});var i,r=e.isHorizontal;function a(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function o(t){return t.y+t.h}function s(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}!function t(e,n,i){void 0===i&&(i=0),n?(e.x=i,i+=e.width):(e.y=i,i+=e.height),e.children.forEach(function(e){t(e,n,i)})}(t,r);var l=n.fromNode(t,r);return function t(e){if(0===e.cs){a(e);return}t(e.c[0]);for(var n=s(o(e.c[0].el),0,null),i=1;i<e.cs;++i){t(e.c[i]);var r=o(e.c[i].er);(function(t,e,n){for(var i=t.c[e-1],r=i.mod,a=t.c[e],s=a.mod;null!==i&&null!==a;){o(i)>n.low&&(n=n.nxt);var l,h,c,u=r+i.prelim+i.w-(s+a.prelim);u>0&&(s+=u,l=n.index,t.c[e].mod+=u,t.c[e].msel+=u,t.c[e].mser+=u,function(t,e,n,i){if(n!==e-1){var r=e-n;t.c[n+1].shift+=i/r,t.c[e].shift-=i/r,t.c[e].change-=i-i/r}}(t,e,l,u));var d=o(i),p=o(a);d<=p&&null!==(i=0===(h=i).cs?h.tr:h.c[h.cs-1])&&(r+=i.mod),d>=p&&null!==(a=0===(c=a).cs?c.tl:c.c[0])&&(s+=a.mod)}!i&&a?function(t,e,n,i){var r=t.c[0].el;r.tl=n;var a=i-n.mod-t.c[0].msel;r.mod+=a,r.prelim-=a,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,a,s):i&&!a&&function(t,e,n,i){var r=t.c[e].er;r.tr=n;var a=i-n.mod-t.c[e].mser;r.mod+=a,r.prelim-=a,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,i,r)})(e,i,n),n=s(r,i,n)}e.prelim=(e.c[0].prelim+e.c[0].mod+e.c[e.cs-1].mod+e.c[e.cs-1].prelim+e.c[e.cs-1].w)/2-e.w/2,a(e)}(l),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,i=0;i<t.cs;i++)e+=t.c[i].shift,n+=e+t.c[i].change,t.c[i].mod+=n}(e);for(var i=0;i<e.cs;i++)t(e.c[i],n)}(l,0),function t(e,n,i){i?n.y=e.x:n.x=e.x,e.c.forEach(function(e,r){t(e,n.children[r],i)})}(l,t,r),i=function t(e,n){var i=n?e.y:e.x;return e.children.forEach(function(e){i=Math.min(t(e,n),i)}),i}(t,r),function t(e,n,i){i?e.y+=n:e.x+=n,e.children.forEach(function(e){t(e,n,i)})}(t,-i,r),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),a=n(9),o=n(2),s=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return this.rootNode.width=0,o(this.rootNode,this.options,a)},e}(r),h={};t.exports=function(t,e){return e=s.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0);function r(t,e){void 0===t&&(t=0),void 0===e&&(e=[]),this.x=this.y=0,this.leftChild=this.rightChild=null,this.height=0,this.children=e}var a={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},a,e);var n,o=0,s=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>o&&(o=e.depth);var n=e.children,i=n.length,a=new r(e.height,[]);return n.forEach(function(e,n){var r=t(e);a.children.push(r),0===n&&(a.leftChild=r),n===i-1&&(a.rightChild=r)}),a.originNode=e,a.isLeaf=e.isLeaf(),a}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=o;else{var n=e.children.map(function(e){return t(e)}),i=Math.min.apply(null,n);e.drawingDepth=i-1}return e.drawingDepth}(s),function t(i){i.x=i.drawingDepth*e.rankSep,i.isLeaf?(i.y=0,n&&(i.y=n.y+n.height+e.nodeSep,i.originNode.parent!==n.originNode.parent&&(i.y+=e.subTreeSep)),n=i):(i.children.forEach(function(e){t(e)}),i.y=(i.leftChild.y+i.rightChild.y)/2)}(s),function t(e,n,i){i?(n.x=e.x,n.y=e.y):(n.x=e.y,n.y=e.x),e.children.forEach(function(e,r){t(e,n.children[r],i)})}(s,t,e.isHorizontal),t}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),a=n(11),o=n(4),s=n(0),l=["LR","RL","H"],h=l[0],c=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,i=void 0===n?20:n,r=t.dropCap,s=void 0===r||r,c=t.direction,u=void 0===c?h:c,d=t.align;if(u&&-1===l.indexOf(u))throw TypeError("Invalid direction: "+u);if(u===l[0])a(e,i,s,d);else if(u===l[1])a(e,i,s,d),e.right2left();else if(u===l[2]){var p=o(e,t),f=p.left,g=p.right;a(f,i,s,d),f.right2left(),a(g,i,s,d);var y=f.getBoundingBox();g.translate(y.width,0),e.x=g.x-e.width/2}return e},e}(r),u={};t.exports=function(t,e){return e=s.assign({},u,e),new c(t,e).execute()}},function(t,e,n){var i=n(0);t.exports=function(t,e,n,r){var a=null;t.eachNode(function(t){(function(t,e,n,r,a){var o="function"==typeof n?n(t):n*t.depth;if(!r)try{if(t.id===t.parent.children[0].id){t.x+=o,t.y=e?e.y:0;return}}catch(t){}if(t.x+=o,e){if(t.y=e.y+i.getHeight(e,t,a),e.parent&&t.parent.id!==e.parent.id){var s=e.parent,l=s.y+i.getHeight(s,t,a);t.y=l>t.y?l:t.y}}else t.y=0})(t,a,e,n,r),a=t})}},function(t,e,n){function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var r=n(1),a=n(13),o=n(2),s=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t),e.prototype.execute=function(){return o(this.rootNode,this.options,a)},e}(r),h={};t.exports=function(t,e){return e=s.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0),r={getSubTreeSep:function(){return 0}};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},r,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse(function(t){t.x=t.parent.x+t.parent.width}),t.parent=null,function t(e,n){var i=0;return e.children.length?e.children.forEach(function(e){i+=t(e,n)}):i=e.height,e._subTreeSep=n.getSubTreeSep(e.data),e.totalHeight=Math.max(e.height,i)+2*e._subTreeSep,e.totalHeight}(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode(function(t){var e=t.children,n=e.length;if(n){var i=e[0];if(i.startY=t.startY+t._subTreeSep,1===n)i.y=t.y+t.height/2-i.height/2;else{i.y=i.startY+i.totalHeight/2-i.height/2;for(var r=1;r<n;r++){var a=e[r];a.startY=e[r-1].startY+e[r-1].totalHeight,a.y=a.startY+a.totalHeight/2-a.height/2}}}}),function t(e){var n=e.children,i=n.length;if(i){n.forEach(function(e){t(e)});var r=n[0],a=n[i-1],o=a.y-r.y+a.height,s=0;if(n.forEach(function(t){s+=t.totalHeight}),o>e.height)e.y=r.y+o/2-e.height/2;else if(1!==n.length||e.height>s){var l=e.y+(e.height-o)/2-r.y;n.forEach(function(t){t.translate(0,l)})}else e.y=(r.y+r.height/2+a.y+a.height/2)/2-e.height/2}}(t)}}])},80817:function(t){function e(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}t.exports=function(t){let n=function(t){let n=[];for(let i=0;i<t.length;i++){for(;n.length>=2&&0>=e(n[n.length-2],n[n.length-1],t[i]);)n.pop();n.push(t[i])}return n.pop(),n}(t),i=function(t){let n=t.reverse(),i=[];for(let t=0;t<n.length;t++){for(;i.length>=2&&0>=e(i[i.length-2],i[i.length-1],n[t]);)i.pop();i.push(n[t])}return i.pop(),i}(t),r=i.concat(n);return r.push(t[0]),r}},63652:function(t){t.exports={toXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","return [pt"+e[0]+",pt"+e[1]+"];");return n(t)})},fromXy:function(t,e){return void 0===e?t.slice():t.map(function(t){let n=Function("pt","const o = {}; o"+e[0]+"= pt[0]; o"+e[1]+"= pt[1]; return o;");return n(t)})}}},58867:function(t){function e(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(let e=0;e<t.length;e++){let n=t[e],i=this.coordToCellNum(n[0]),r=this.coordToCellNum(n[1]);if(this._cells[i])this._cells[i][r]?this._cells[i][r].push(n):this._cells[i][r]=[n];else{let t=[];t[r]=[n],this._cells[i]=t}}}e.prototype={cellPoints:function(t,e){return void 0!==this._cells[t]&&void 0!==this._cells[t][e]?this._cells[t][e]:[]},rangePoints:function(t){let e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),i=this.coordToCellNum(t[2]),r=this.coordToCellNum(t[3]),a=[];for(let t=e;t<=i;t++)for(let e=n;e<=r;e++)for(let n=0;n<this.cellPoints(t,e).length;n++)a.push(this.cellPoints(t,e)[n]);return a},removePoint:function(t){let e;let n=this.coordToCellNum(t[0]),i=this.coordToCellNum(t[1]),r=this._cells[n][i];for(let n=0;n<r.length;n++)if(r[n][0]===t[0]&&r[n][1]===t[1]){e=n;break}return r.splice(e,1),r},trunc:Math.trunc||function(t){return t-t%1},coordToCellNum:function(t){return this.trunc(t*this._reverseCellSize)},extendBbox:function(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}},t.exports=function(t,n){return new e(t,n)}},1344:function(t,e,n){"use strict";let i=n(77444),r=n(58867),a=n(63652),o=n(80817);function s(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function l(t,e,n){let i=[e[0]-t[0],e[1]-t[1]],r=[n[0]-t[0],n[1]-t[1]],a=s(t,e),o=s(t,n),l=i[0]*r[0]+i[1]*r[1];return l/Math.sqrt(a*o)}function h(t,e){for(let n=0;n<e.length-1;n++){let r=[e[n],e[n+1]];if((t[0][0]!==r[0][0]||t[0][1]!==r[0][1])&&(t[0][0]!==r[1][0]||t[0][1]!==r[1][1])&&i(t,r))return!0}return!1}let c=Math.cos(90/(180/Math.PI));t.exports=function(t,e,n){let i=function(t){let e=[t[0]],n=t[0];for(let i=1;i<t.length;i++){let r=t[i];(n[0]!==r[0]||n[1]!==r[1])&&e.push(r),n=r}return e}(a.toXy(t,n).sort(function(t,e){return t[0]-e[0]||t[1]-e[1]}));if(i.length<4){let t=i.concat([i[0]]);return n?a.fromXy(t,n):t}let u=function(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(let a=t.length-1;a>=0;a--)t[a][0]<e&&(e=t[a][0]),t[a][1]<n&&(n=t[a][1]),t[a][0]>i&&(i=t[a][0]),t[a][1]>r&&(r=t[a][1]);return[i-e,r-n]}(i),d=[.6*u[0],.6*u[1]],p=o(i),f=i.filter(function(t){return 0>p.indexOf(t)}),g=Math.ceil(1/(i.length/(u[0]*u[1]))),y=function t(e,n,i,r,a){let o=!1;for(let t=0;t<e.length-1;t++){let u,d,p;let f=[e[t],e[t+1]],g=f[0][0]+","+f[0][1]+","+f[1][0]+","+f[1][1];if(s(f[0],f[1])<n||a.has(g))continue;let y=0,m=[Math.min(f[0][0],f[1][0]),Math.min(f[0][1],f[1][1]),Math.max(f[0][0],f[1][0]),Math.max(f[0][1],f[1][1])];do u=(m=r.extendBbox(m,y))[2]-m[0],d=m[3]-m[1],p=function(t,e,n){let i=null,r=c,a=c,o,s;for(let c=0;c<e.length;c++)o=l(t[0],t[1],e[c]),s=l(t[1],t[0],e[c]),o>r&&s>a&&!h([t[0],e[c]],n)&&!h([t[1],e[c]],n)&&(r=o,a=s,i=e[c]);return i}(f,r.rangePoints(m),e),y++;while(null===p&&(i[0]>u||i[1]>d));u>=i[0]&&d>=i[1]&&a.add(g),null!==p&&(e.splice(t+1,0,p),r.removePoint(p),o=!0)}return o?t(e,n,i,r,a):e}(p,Math.pow(e||20,2),d,r(f,g),new Set);return n?a.fromXy(y,n):y}},77444:function(t){function e(t,e,n,i,r,a){let o=(a-e)*(n-t)-(i-e)*(r-t);return o>0||!(o<0)}t.exports=function(t,n){let i=t[0][0],r=t[0][1],a=t[1][0],o=t[1][1],s=n[0][0],l=n[0][1],h=n[1][0],c=n[1][1];return e(i,r,s,l,h,c)!==e(a,o,s,l,h,c)&&e(i,r,a,o,s,l)!==e(i,r,a,o,h,c)}},58636:function(t,e,n){"use strict";let i;n.d(e,{kJ:function(){return ht},jD:function(){return tl}});var r,a,o,s,l,h,c,u,d,p,f,g,y,m,v,b,x,E,w,C,S,M,R,O,A,T,k,P,L,D,N={};n.r(N),n.d(N,{circle:function(){return nA},diamond:function(){return nk},rect:function(){return nL},simple:function(){return nN},triangle:function(){return nT},triangleRect:function(){return nD},vee:function(){return nP}});var I=n(1242),B=function(t){return null==t},_=function(t){return B(t)?"":t.toString()},F=function(t){var e=_(t);return e.charAt(0).toUpperCase()+e.substring(1)},j=function(t){return"object"==typeof t&&null!==t},z=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},G={}.toString,H=function(t,e){return G.call(t)==="[object "+e+"]"},W=function(t){return H(t,"String")},V=function(t,e){if(t===e)return!0;if(!t||!e||W(t)||W(e))return!1;if(z(t)||z(e)){if(t.length!==e.length)return!1;for(var n=!0,i=0;i<t.length&&(n=V(t[i],e[i]));i++);return n}if(j(t)||j(e)){var r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(var n=!0,i=0;i<r.length&&(n=V(t[r[i]],e[r[i]]));i++);return n}return!1},Z=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};let U={duration:500},Y={duration:1e3,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"};(r=v||(v={})).NodeAdded="NodeAdded",r.NodeUpdated="NodeUpdated",r.NodeRemoved="NodeRemoved",r.EdgeAdded="EdgeAdded",r.EdgeUpdated="EdgeUpdated",r.EdgeRemoved="EdgeRemoved",r.ComboAdded="ComboAdded",r.ComboUpdated="ComboUpdated",r.ComboRemoved="ComboRemoved",(a=b||(b={})).DRAW="draw",a.COLLAPSE="collapse",a.EXPAND="expand",a.TRANSFORM="transform",(o=x||(x={})).CLICK="canvas:click",o.DBLCLICK="canvas:dblclick",o.POINTER_OVER="canvas:canvas:pointerover",o.POINTER_LEAVE="canvas:pointerleave",o.POINTER_ENTER="canvas:pointerenter",o.POINTER_MOVE="canvas:pointermove",o.POINTER_OUT="canvas:pointerout",o.POINTER_DOWN="canvas:pointerdown",o.POINTER_UP="canvas:pointerup",o.CONTEXT_MENU="canvas:contextmenu",o.DRAG_START="canvas:dragstart",o.DRAG="canvas:drag",o.DRAG_END="canvas:dragend",o.DRAG_ENTER="canvas:dragenter",o.DRAG_OVER="canvas:dragover",o.DRAG_LEAVE="canvas:dragleave",o.DROP="canvas:drop",o.WHEEL="canvas:wheel",(s=E||(E={})).CLICK="combo:click",s.DBLCLICK="combo:dblclick",s.POINTER_OVER="combo:pointerover",s.POINTER_LEAVE="combo:pointerleave",s.POINTER_ENTER="combo:pointerenter",s.POINTER_MOVE="combo:pointermove",s.POINTER_OUT="combo:pointerout",s.POINTER_DOWN="combo:pointerdown",s.POINTER_UP="combo:pointerup",s.CONTEXT_MENU="combo:contextmenu",s.DRAG_START="combo:dragstart",s.DRAG="combo:drag",s.DRAG_END="combo:dragend",s.DRAG_ENTER="combo:dragenter",s.DRAG_OVER="combo:dragover",s.DRAG_LEAVE="combo:dragleave",s.DROP="combo:drop",(l=w||(w={})).CLICK="click",l.DBLCLICK="dblclick",l.POINTER_OVER="pointerover",l.POINTER_LEAVE="pointerleave",l.POINTER_ENTER="pointerenter",l.POINTER_MOVE="pointermove",l.POINTER_OUT="pointerout",l.POINTER_DOWN="pointerdown",l.POINTER_UP="pointerup",l.CONTEXT_MENU="contextmenu",l.DRAG_START="dragstart",l.DRAG="drag",l.DRAG_END="dragend",l.DRAG_ENTER="dragenter",l.DRAG_OVER="dragover",l.DRAG_LEAVE="dragleave",l.DROP="drop",l.KEY_DOWN="keydown",l.KEY_UP="keyup",l.WHEEL="wheel",(h=C||(C={})).KEY_DOWN="keydown",h.KEY_UP="keyup",(c=S||(S={})).CLICK="edge:click",c.DBLCLICK="edge:dblclick",c.POINTER_OVER="edge:pointerover",c.POINTER_LEAVE="edge:pointerleave",c.POINTER_ENTER="edge:pointerenter",c.POINTER_MOVE="edge:pointermove",c.POINTER_OUT="edge:pointerout",c.POINTER_DOWN="edge:pointerdown",c.POINTER_UP="edge:pointerup",c.CONTEXT_MENU="edge:contextmenu",c.DRAG_ENTER="edge:dragenter",c.DRAG_OVER="edge:dragover",c.DRAG_LEAVE="edge:dragleave",c.DROP="edge:drop",(u=M||(M={})).BEFORE_CANVAS_INIT="beforecanvasinit",u.AFTER_CANVAS_INIT="aftercanvasinit",u.BEFORE_SIZE_CHANGE="beforesizechange",u.AFTER_SIZE_CHANGE="aftersizechange",u.BEFORE_ELEMENT_CREATE="beforeelementcreate",u.AFTER_ELEMENT_CREATE="afterelementcreate",u.BEFORE_ELEMENT_UPDATE="beforeelementupdate",u.AFTER_ELEMENT_UPDATE="afterelementupdate",u.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",u.AFTER_ELEMENT_DESTROY="afterelementdestroy",u.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",u.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",u.BEFORE_DRAW="beforedraw",u.AFTER_DRAW="afterdraw",u.BEFORE_RENDER="beforerender",u.AFTER_RENDER="afterrender",u.BEFORE_ANIMATE="beforeanimate",u.AFTER_ANIMATE="afteranimate",u.BEFORE_LAYOUT="beforelayout",u.AFTER_LAYOUT="afterlayout",u.BEFORE_STAGE_LAYOUT="beforestagelayout",u.AFTER_STAGE_LAYOUT="afterstagelayout",u.BEFORE_TRANSFORM="beforetransform",u.AFTER_TRANSFORM="aftertransform",u.BATCH_START="batchstart",u.BATCH_END="batchend",u.BEFORE_DESTROY="beforedestroy",u.AFTER_DESTROY="afterdestroy",u.BEFORE_RENDERER_CHANGE="beforerendererchange",u.AFTER_RENDERER_CHANGE="afterrendererchange",(d=R||(R={})).UNDO="undo",d.REDO="redo",d.CANCEL="cancel",d.ADD="add",d.CLEAR="clear",d.CHANGE="change",(p=O||(O={})).CLICK="node:click",p.DBLCLICK="node:dblclick",p.POINTER_OVER="node:pointerover",p.POINTER_LEAVE="node:pointerleave",p.POINTER_ENTER="node:pointerenter",p.POINTER_MOVE="node:pointermove",p.POINTER_OUT="node:pointerout",p.POINTER_DOWN="node:pointerdown",p.POINTER_UP="node:pointerup",p.CONTEXT_MENU="node:contextmenu",p.DRAG_START="node:dragstart",p.DRAG="node:drag",p.DRAG_END="node:dragend",p.DRAG_ENTER="node:dragenter",p.DRAG_OVER="node:dragover",p.DRAG_LEAVE="node:dragleave",p.DROP="node:drop";let K="combo",$="tree";(f=A||(A={})).NODE="node",f.EDGE="edge",f.COMBO="combo",f.THEME="theme",f.PALETTE="palette",f.LAYOUT="layout",f.BEHAVIOR="behavior",f.PLUGIN="plugin",f.ANIMATION="animation",f.TRANSFORM="transform",f.SHAPE="shape";let X={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{},shape:{}};function q(t,e){var n;let i=null===(n=X[t])||void 0===n?void 0:n[e];if(i)return i}function Q(t){return"[".concat("G6"," v").concat("5.0.17","] ").concat(t)}let J={mute:!1,debug:t=>{J.mute||console.debug(Q(t))},info:t=>{J.mute||console.info(Q(t))},warn:t=>{J.mute||console.warn(Q(t))},error:t=>{J.mute||console.error(Q(t))}};function tt(t){let{theme:e}=t;if(!e)return{};let n=q(A.THEME,e);return n||(J.warn("The theme of ".concat(e," is not registered.")),{})}function te(t,e){if(Array.isArray(t)&&0===t.length)return null;let n=Array.isArray(t)?t[0]:t,i=Array.isArray(t)?t.slice(1):e||[];return new Proxy(n,{get:(t,e)=>"function"!=typeof t[e]||["onframe","onfinish"].includes(e)?"finished"===e?Promise.all([n.finished,...i.map(t=>t.finished)]):Reflect.get(t,e):function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];t[e](...r),i.forEach(t=>{var n;return null===(n=t[e])||void 0===n?void 0:n.call(t,...r)})},set:(t,e,n)=>(["onframe","onfinish"].includes(e)||i.forEach(t=>{t[e]=n}),Reflect.set(t,e,n))})}function tn(t){let e=t.reduce((t,e)=>(Object.entries(e).forEach(e=>{let[n,i]=e;void 0===t[n]?t[n]=[i]:t[n].push(i)}),t),{});Object.entries(e).forEach(n=>{let[i,r]=n;(r.length!==t.length||r.some(t=>B(t))||r.every(t=>!["sourceNode","targetNode","childrenNode"].includes(i)&&V(t,r[0])))&&delete e[i]});let n=Object.entries(e).reduce((t,e)=>{let[n,i]=e;return i.forEach((e,i)=>{t[i]?t[i][n]=e:t[i]={[n]:e}}),t},[]);return 0!==t.length&&0===n.length&&n.push(...[{_:0},{_:0}]),n}function ti(t){switch(t){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function tr(t,e){let{animation:n}=t;if(!1===n||!1===e)return!1;let i={...U};return Z(n)&&Object.assign(i,n),Z(e)&&Object.assign(i,e),i}var ta=function(t){return Array.isArray?Array.isArray(t):H(t,"Array")},to=function(t){if(!j(t)||!H(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},ts=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i+=1)!function t(e,n,i,r){for(var a in i=i||0,r=r||5,n)if(function(t,e){if(Object.hasOwn)return Object.hasOwn(t,e);if(null==t)throw TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}(n,a)){var o=n[a];null!==o&&to(o)?(to(e[a])||(e[a]={}),i<r?t(e[a],o,i+1,r):e[a]=n[a]):ta(o)?(e[a]=[],e[a]=e[a].concat(o)):void 0!==o&&(e[a]=o)}}(t,e[i]);return t};function tl(t){if(void 0!==t.id)return t.id;if(void 0!==t.source&&void 0!==t.target)return"".concat(t.source,"-").concat(t.target);throw Error(Q("The datum does not have available id."))}function th(t,e){let n={nodes:(t.nodes||[]).map(tl),edges:(t.edges||[]).map(tl),combos:(t.combos||[]).map(tl)};return e?Object.values(n).flat():n}function tc(t,e,n,i){let r=i?i.replace(/translate(3d)?\([^)]*\)/g,""):"";return 0===n?"translate(".concat(t,", ").concat(e,")").concat(r):"translate3d(".concat(t,", ").concat(e,", ").concat(n,")").concat(r)}let tu=function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=tl(i),o="".concat(n,"s"),s=t.add[o].get(a)||t.update[o].get(a)||t.remove[o].get(a)||i;Object.entries(t).forEach(t=>{let[n,l]=t;e===n?l[o].set(a,r?ts(s,i):s):l[o].delete(a)})},td=(t,e,n)=>{let i;if(!n.length)return null;let[r,a]=e,o=e=>{if(!e)return{shape:t,fromStyle:r,toStyle:a};{var n;let i=t.getShape(e);if(!i)return null;let o="get".concat(F(e),"Style"),s=(null==t?void 0:null===(n=t[o])||void 0===n?void 0:n.bind(t))||(t=>t),l=(null==s?void 0:s(r))||{},h=(null==s?void 0:s(a))||{};return{shape:i,fromStyle:l,toStyle:h}}},s=n.map(t=>{let{fields:e,shape:n,states:r,...a}=t,s=o(n);if(!s)return null;let{shape:l,fromStyle:h,toStyle:c}=s,u=[{},{}];if(e.forEach(t=>{var e,n;Object.assign(u[0],{[t]:null!==(e=h[t])&&void 0!==e?e:ti(t)}),Object.assign(u[1],{[t]:null!==(n=c[t])&&void 0!==n?n:ti(t)})}),u.some(t=>Object.keys(t).some(t=>["x","y","z"].includes(t)))){let{x:t=0,y:e=0,z:n=0,transform:i=""}=l.attributes||{};u.forEach(r=>{r.transform=tc(r.x||t,r.y||e,r.z||n,i)})}let d=l.animate(tn(u),a);return void 0===n&&(i=d),d}).filter(Boolean),l=i||(null==s?void 0:s[0]);return l?te(l,s.filter(t=>t!=t)):null},tp=[{fields:["x","y"]}],tf=[{fields:["sourceNode","targetNode"]}],tg=[{fields:["childrenNode","x","y"]}];function ty(t,e,n){let i=new Map(t.map(t=>[n(t),t])),r=new Map(e.map(t=>[n(t),t])),a=new Set(i.keys()),o=new Set(r.keys()),s=[],l=[],h=[],c=[];return o.forEach(t=>{a.has(t)?V(i.get(t),r.get(t))?c.push(r.get(t)):l.push(r.get(t)):s.push(r.get(t))}),a.forEach(t=>{o.has(t)||h.push(i.get(t))}),{enter:s,exit:h,keep:c,update:l}}class tm{setExtensions(t){let e=function(t,e,n){let i={},r=t=>(t in i||(i[t]=0),"".concat(e,"-").concat(t,"-").concat(i[t]++));return n.map(e=>"string"==typeof e?{type:e,key:r(e)}:"function"==typeof e?e.call(t):e.key?e:{...e,key:r(e.type)})}(this.context.graph,this.category,t),{enter:n,update:i,exit:r,keep:a}=ty(this.extensions,e,t=>t.key);this.createExtensions(n),this.updateExtensions([...i,...a]),this.destroyExtensions(r),this.extensions=e}createExtension(t){let{category:e}=this,{key:n,type:i}=t,r=q(e,i);if(!r)return J.warn("The extension ".concat(i," of ").concat(e," is not registered."));let a=new r(this.context,t);this.extensionMap[n]=a}createExtensions(t){t.forEach(t=>this.createExtension(t))}updateExtension(t){let{key:e}=t,n=this.extensionMap[e];n&&n.update(t)}updateExtensions(t){t.forEach(t=>this.updateExtension(t))}destroyExtension(t){let e=this.extensionMap[t];e&&(e.destroy(),delete this.extensionMap[t])}destroyExtensions(t){t.forEach(t=>{let{key:e}=t;return this.destroyExtension(e)})}destroy(){Object.values(this.extensionMap).forEach(t=>t.destroy()),this.context={},this.extensions=[],this.extensionMap={}}constructor(t){this.extensions=[],this.extensionMap={},this.context=t}}class tv{update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}constructor(t,e){this.events=[],this.destroyed=!1,this.context=t,this.options=e}}class tb extends tv{}var tx=function(t){return"function"==typeof t},tE=function(t){if("object"!=typeof t||null===t)return t;if(ta(t)){e=[];for(var e,n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=tE(t[n]):e[n]=t[n]}else for(var r in e={},t)"object"==typeof t[r]&&null!=t[r]?e[r]=tE(t[r]):e[r]=t[r];return e};function tw(t){return t instanceof Float32Array||!!Array.isArray(t)&&(2===t.length||3===t.length)&&t.every(t=>"number"==typeof t)}function tC(t,e,n){return t>=e&&t<=n}function tS(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(Array.isArray(t)){let[e=0,n=e,i=e,r=n]=t;return[e,n,i,r]}return[t,t,t,t]}function tM(t){return t.max[0]-t.min[0]}function tR(t){return t.max[1]-t.min[1]}function tO(t){return[tM(t),tR(t)]}function tA(t,e){let n=tw(t)?function(t){let[e,n,i=0]=t,r=new I.mN;return r.setMinMax([e,n,i],[e,n,i]),r}(t):t.getShape("key").getBounds();return e?tT(n,e):n}function tT(t,e){let[n,i,r,a]=tS(e),[o,s,l]=t.min,[h,c,u]=t.max,d=new I.mN;return d.setMinMax([o-a,s-n,l],[h+i,c+r,u]),d}function tk(t){if(0===t.length)return new I.mN;if(1===t.length)return t[0];let e=new I.mN;e.setMinMax(t[0].min,t[0].max);for(let n=1;n<t.length;n++){let i=t[n];e.setMinMax([Math.min(e.min[0],i.min[0]),Math.min(e.min[1],i.min[1]),Math.min(e.min[2],i.min[2])],[Math.max(e.max[0],i.max[0]),Math.max(e.max[1],i.max[1]),Math.max(e.max[2],i.max[2])])}return e}function tP(t,e){return tC(t[0],e.min[0],e.max[0])&&tC(t[1],e.min[1],e.max[1])}function tL(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:[i,r],max:[a,o]}=e,s=(t[1]===r||t[1]===o)&&(n||tC(t[0],i,a)),l=(t[0]===i||t[0]===a)&&(n||tC(t[1],r,o));return s||l}function tD(t,e){let[n,i]=e,[r,a]=t.min,[o,s]=t.max,l=n-r,h=o-n,c=i-a,u=s-i,d=Math.min(l,h,c,u);return d===l?"left":d===h?"right":d===c?"top":d===u?"bottom":"left"}function tN(t,e){let n=tE(e);if(tP(e,t)){let i=tD(t,e);switch(i){case"left":n[0]=t.min[0];break;case"right":n[0]=t.max[0];break;case"top":n[1]=t.min[1];break;case"bottom":n[1]=t.max[1]}}else{let[i,r]=e,[a,o]=t.min,[s,l]=t.max;n[0]=tC(i,a,s)?i:i<a?a:s,n[1]=tC(r,o,l)?r:r<o?o:l}return n}let tI=[0,0,0];function tB(t,e){return t.map((t,n)=>t+e[n])}function t_(t,e){return t.map((t,n)=>t-e[n])}function tF(t,e){return"number"==typeof e?t.map(t=>t*e):t.map((t,n)=>t*e[n])}function tj(t,e){return"number"==typeof e?t.map(t=>t/e):t.map((t,n)=>t/e[n])}function tz(t,e){return t.map(t=>t*e)}function tG(t,e){return Math.sqrt(t.reduce((t,n,i)=>t+(n-e[i]||0)**2,0))}function tH(t,e){return t.reduce((t,n,i)=>t+Math.abs(n-e[i]),0)}function tW(t){let e=t.reduce((t,e)=>t+e**2,0);return t.map(t=>t/Math.sqrt(e))}function tV(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0]*e[1]-t[1]*e[0],r=Math.acos(tF(t,e).reduce((t,e)=>t+e,0)/(tG(t,tI)*tG(e,tI)));return n&&i<0&&(r=2*Math.PI-r),r}function tZ(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e?[-t[1],t[0]]:[t[1],-t[0]]}function tU(t){return[t[0],t[1]]}function tY(t){return 2===t.length?[t[0],t[1],0]:t}function tK(t,e){let[n,i]=t,[r,a]=e,o=t_(n,i),s=t_(r,a);return(function(t,e){let n=tY(t),i=tY(e);return[n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0]]})(o,s).every(t=>0===t)}function t$(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(tK(t,e))return;let[i,r]=t,[a,o]=e,s=((i[0]-a[0])*(a[1]-o[1])-(i[1]-a[1])*(a[0]-o[0]))/((i[0]-r[0])*(a[1]-o[1])-(i[1]-r[1])*(a[0]-o[0])),l=o[0]-a[0]?(i[0]-a[0]+s*(r[0]-i[0]))/(o[0]-a[0]):(i[1]-a[1]+s*(r[1]-i[1]))/(o[1]-a[1]);if(n||tC(s,0,1)&&tC(l,0,1))return[i[0]+s*(r[0]-i[0]),i[1]+s*(r[1]-i[1])]}function tX(t){if(Array.isArray(t))return tC(t[0],0,1)&&tC(t[1],0,1)?t:[.5,.5];let e=t.split("-"),n=e.includes("left")?0:e.includes("right")?1:.5,i=e.includes("top")?0:e.includes("bottom")?1:.5;return[n,i]}function tq(t){let{x:e=0,y:n=0,z:i=0}=t.style||{};return[+e,+n,+i]}function tQ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=tX(e);return function(t,e){let[n,i]=e,{min:r,max:a}=t;return[r[0]+n*(a[0]-r[0]),r[1]+i*(a[1]-r[1])]}(t,n)}function tJ(t){var e;return[t.x,t.y,null!==(e=t.z)&&void 0!==e?e:0]}function t0(t){var e;return{x:t[0],y:t[1],z:null!==(e=t[2])&&void 0!==e?e:0}}function t1(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.map(t=>parseFloat(t.toFixed(e)))}function t2(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=i?t_(t,e):t_(e,t),a=tW(r),o=[a[0]*n,a[1]*n];return tB(tU(t),o)}function t3(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];for(let r=0;r<n.length;r++){let a=n[r],o=n[(r+1)%n.length];i&&(a=tB(e,a),o=tB(e,o));let s=t$([e,t],[a,o]);if(s)return{point:s,line:[a,o]}}return{point:e,line:void 0}}function t6(t,e){let n=e.center,i=t_(t,e.center),r=Math.atan2(i[1],i[0]);if(isNaN(r))return n;let a=tM(e)/2,o=tR(e)/2,s=n[0]+a*Math.cos(r),l=n[1]+o*Math.sin(r);return[s,l]}function t4(t,e){let[n,i]=e[0],[r,a]=e[1],[o,s]=t,l=r-n,h=a-i;if(0===l&&0===h)return[n,i];let c=((o-n)*l+(s-i)*h)/(l*l+h*h);c>1?c=1:c<0&&(c=0);let u=n+c*l,d=i+c*h;return[u,d]}function t8(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=function(t){let e=t.reduce((t,e)=>tB(t,e),[0,0]);return tj(e,t.length)}(t);return t.sort((t,i)=>{let[r,a]=t,[o,s]=i,l=Math.atan2(a-n[1],r-n[0]),h=Math.atan2(s-n[1],o-n[0]);return e?h-l:l-h})}function t9(t,e){return[t,[t[0],e[1]],e,[e[0],t[1]]]}let t5=t=>t.map(t=>W(t)?t.toLocaleLowerCase():t);class t7{bind(t,e){0!==t.length&&this.map.set(t,e)}unbind(t,e){this.map.forEach((n,i)=>{V(i,t)&&(!e||e===n)&&this.map.delete(i)})}unbindAll(){this.map.clear()}match(t){let e=t5(Array.from(this.recordKey)).sort(),n=t5(t).sort();return V(e,n)}bindEvents(){let{emitter:t}=this;t.on(w.KEY_DOWN,this.onKeyDown),t.on(w.KEY_UP,this.onKeyUp),t.on(w.WHEEL,this.onWheel),t.on(w.DRAG,this.onDrag),window.addEventListener("focus",this.onFocus)}trigger(t){this.map.forEach((e,n)=>{this.match(n)&&e(t)})}triggerExtendKey(t,e){this.map.forEach((n,i)=>{i.includes(t)&&V(Array.from(this.recordKey),i.filter(e=>e!==t))&&n(e)})}destroy(){this.unbindAll(),this.emitter.off(w.KEY_DOWN,this.onKeyDown),this.emitter.off(w.KEY_UP,this.onKeyUp),this.emitter.off(w.WHEEL,this.onWheel),this.emitter.off(w.DRAG,this.onDrag),window.removeEventListener("blur",this.onFocus)}constructor(t){this.map=new Map,this.recordKey=new Set,this.onKeyDown=t=>{(null==t?void 0:t.key)&&(this.recordKey.add(t.key),this.trigger(t))},this.onKeyUp=t=>{(null==t?void 0:t.key)&&this.recordKey.delete(t.key)},this.onWheel=t=>{this.triggerExtendKey(w.WHEEL,t)},this.onDrag=t=>{this.triggerExtendKey(w.DRAG,t)},this.onFocus=()=>{this.recordKey.clear()},this.emitter=t,this.bindEvents()}}class et extends tb{onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;let{canvas:e,graph:n}=this.context,i={...this.options.style};this.options.style.lineWidth&&(i.lineWidth=+this.options.style.lineWidth/n.getZoom()),this.rectShape=new I.UL({id:"g6-brush-select",style:i}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){var e;if(!this.startPoint)return;let{immediately:n,mode:i}=this.options;this.endPoint=ee(t),null===(e=this.rectShape)||void 0===e||e.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),n&&"default"===i&&this.updateElementsStates(t9(this.startPoint,this.endPoint))}onPointerUp(t){if(this.startPoint){if(!this.endPoint){this.clearBrush();return}this.endPoint=ee(t),this.updateElementsStates(t9(this.startPoint,this.endPoint)),this.clearBrush()}}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){let{graph:t}=this.context,e=Object.values(t.getData()).reduce((t,e)=>Object.assign({},t,e.reduce((t,e)=>(t[tl(e)]=[],t),{})),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){let{graph:e}=this.context,{enableElements:n,state:i,mode:r,onSelect:a}=this.options,o=this.selector(e,t,n),s={};switch(r){case"union":o.forEach(t=>{s[t]=[...e.getElementState(t),i]});break;case"diff":o.forEach(t=>{let n=e.getElementState(t);s[t]=n.includes(i)?n.filter(t=>t!==i):[...n,i]});break;case"intersect":o.forEach(t=>{let n=e.getElementState(t);s[t]=n.includes(i)?[i]:[]});break;default:o.forEach(t=>{s[t]=[i]})}tx(a)&&(s=a(s)),e.setElementState(s,this.options.animation)}selector(t,e,n){if(!n||0===n.length)return[];let i=[],r=t.getData();if(n.forEach(n=>{r["".concat(n,"s")].forEach(n=>{let r=tl(n);"hidden"!==t.getElementVisibility(r)&&function(t,e,n,i){let r=t[0],a=t[1],o=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);let s=i-n;for(let t=0,i=s-1;t<s;i=t++){let s=e[t+n][0],l=e[t+n][1],h=e[i+n][0],c=e[i+n][1],u=l>a!=c>a&&r<(h-s)*(a-l)/(c-l)+s;u&&(o=!o)}return o}(t.getElementPosition(r),e)&&i.push(r)})}),n.includes("edge")){let t=r.edges;null==t||t.forEach(t=>{let{source:e,target:n}=t;i.includes(e)&&i.includes(n)&&i.push(tl(t))})}return i}clearBrush(){var t;null===(t=this.rectShape)||void 0===t||t.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){let{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return this.shortcut.match(e.filter(t=>"drag"!==t))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}bindEvents(){let{graph:t}=this.context;t.on(w.POINTER_DOWN,this.onPointerDown),t.on(w.POINTER_MOVE,this.onPointerMove),t.on(w.POINTER_UP,this.onPointerUp),t.on(x.CLICK,this.clearStates)}unbindEvents(){let{graph:t}=this.context;t.off(w.POINTER_DOWN,this.onPointerDown),t.off(w.POINTER_MOVE,this.onPointerMove),t.off(w.POINTER_UP,this.onPointerUp),t.off(x.CLICK,this.clearStates)}update(t){this.unbindEvents(),this.options=ts(this.options,t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,ts({},et.defaultOptions,e)),this.shortcut=new t7(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}}et.defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#1677FF",stroke:"#1677FF",fillOpacity:.1,zIndex:2,pointerEvents:"none"}};let ee=t=>[t.canvas.x,t.canvas.y],en=["node","edge","combo"];function ei(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;"TB"===i&&e(t,r);let a=n(t);if(a)for(let t of a)ei(t,e,n,i,r+1);"BT"===i&&e(t,r)}function er(t,e,n,i){if("combo"===e||"node"===e)return ea(t,n,i);let r=t.getEdgeData(n);if(!r)return[];let a=ea(t,r.source,i-1),o=ea(t,r.target,i-1);return Array.from(new Set([...a,...o,n]))}function ea(t,e,n){let i=new Set,r=new Set,a=new Set;return!function(t,e,n){let i=[[t,0]];for(;i.length;){let[t,r]=i.shift();e(t,r);let a=n(t);if(a)for(let t of a)i.push([t,r+1])}}(e,(e,i)=>{i>n||(a.add(e),t.getRelatedEdgesData(e).forEach(t=>{let e=tl(t);!r.has(e)&&i<n&&(a.add(e),r.add(e))}))},e=>t.getRelatedEdgesData(e).map(t=>t.source===e?t.target:t.source).filter(t=>!i.has(t)&&(i.add(t),!0))),Array.from(a)}function eo(t){return t.states||[]}class es extends tb{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),en.forEach(e=>{t.on("".concat(e,":").concat(w.CLICK),this.onClickSelect)}),t.on(x.CLICK,this.onClickCanvas)}get isMultipleSelect(){let{multiple:t,trigger:e}=this.options;return t&&this.shortcut.match(e)}getNeighborIds(t){let{target:e,targetType:n}=t,{graph:i}=this.context,{degree:r}=this.options;return er(i,n,e.id,"function"==typeof r?r(t):r).filter(t=>t!==e.id)}async updateState(t){let{state:e,unselectedState:n,neighborState:i,animation:r}=this.options;if(!e&&!i&&!n)return;let{target:a}=t,{graph:o}=this.context,s=o.getElementData(a.id),l=eo(s).includes(e)?"unselect":"select",h={},c=this.isMultipleSelect,u=[a.id],d=this.getNeighborIds(t);if(c){if(Object.assign(h,this.getDataStates()),"select"===l){let t=(t,e)=>{t.forEach(t=>{let i=new Set(o.getElementState(t));i.add(e),i.delete(n),h[t]=Array.from(i)})};t(u,e),t(d,i),n&&Object.keys(h).forEach(t=>{let r=h[t];r.includes(e)||r.includes(i)||r.includes(n)||h[t].push(n)})}else{let t=h[a.id];h[a.id]=t.filter(t=>t!==e&&t!==i),t.includes(n)||h[a.id].push(n),d.forEach(t=>{h[t]=h[t].filter(t=>t!==i),h[t].includes(e)||h[t].push(n)})}}else if("select"===l){Object.assign(h,this.getClearStates(!!n));let t=(t,e)=>{t.forEach(t=>{h[t]||(h[t]=o.getElementState(t)),h[t].push(e)})};t(u,e),t(d,i),n&&Object.keys(h).forEach(t=>{u.includes(t)||d.includes(t)||h[t].push(n)})}else Object.assign(h,this.getClearStates());await o.setElementState(h,r)}getDataStates(){let{graph:t}=this.context,{nodes:e,edges:n,combos:i}=t.getData(),r={};return[...e,...n,...i].forEach(t=>{r[tl(t)]=eo(t)}),r}getClearStates(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=this.context,{state:n,unselectedState:i,neighborState:r}=this.options,a=new Set([n,i,r]),{nodes:o,edges:s,combos:l}=e.getData(),h={};return[...o,...s,...l].forEach(e=>{let n=eo(e),i=n.filter(t=>!a.has(t));t?h[tl(e)]=i:i.length!==n.length&&(h[tl(e)]=i)}),h}async clearState(){let{graph:t}=this.context;await t.setElementState(this.getClearStates(),this.options.animation)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;en.forEach(e=>{t.off("".concat(e,":").concat(w.CLICK),this.onClickSelect)}),t.off(x.CLICK,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},es.defaultOptions,e)),this.onClickSelect=async t=>{var e,n;this.validate(t)&&(await this.updateState(t),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))},this.onClickCanvas=async t=>{var e,n;this.validate(t)&&(await this.clearState(),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))},this.shortcut=new t7(t.graph),this.bindEvents()}}function el(t){var e;return!!(null===(e=t.style)||void 0===e?void 0:e.collapsed)}es.defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};var eh=function(t,e,n){for(var i=0,r=W(e)?e.split("."):e;t&&i<r.length;)t=t[r[i++]];return void 0===t||i<r.length?n:t},ec=function(t){return H(t,"Number")},eu=function(t,e,n){var i=t,r=W(e)?e.split("."):e;return r.forEach(function(t,e){e<r.length-1?(Z(i[t])||(i[t]=ec(r[e+1])?[]:{}),i=i[t]):i[t]=n}),t},ed=function(t){var e=_(t);return e.charAt(0).toLowerCase()+e.substring(1)};function ep(t,e){if(!t.startsWith(e))return!1;let n=t[e.length];return n>="A"&&n<="Z"}function ef(t,e){let n=Object.entries(t).reduce((t,n)=>{let[i,r]=n;return"className"===i||"class"===i||ep(i,e)&&Object.assign(t,{[function(t,e){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e||!ep(t,e))return t;let i=t.slice(e.length);return n?ed(i):i}(i,e)]:r}),t},{});if("opacity"in t){let i="".concat(e).concat(F("opacity")),r=t.opacity;if(i in t){let e=t[i];Object.assign(n,{opacity:r*e})}else Object.assign(n,{opacity:r})}return n}function eg(t,e){let n=e.length;return Object.keys(t).reduce((i,r)=>{if(r.startsWith(e)){let e=r.slice(n);i[e]=t[r]}return i},{})}function ey(t,e){let n="string"==typeof e?[e]:e,i={};return Object.keys(t).forEach(e=>{n.find(t=>e.startsWith(t))||(i[e]=t[e])}),i}function em(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("number"==typeof t)return[t,t,t];let[e,n=e,i=e]=t;return[e,n,i]}function ev(t,e){let{datum:n,graph:i}=e;return"function"==typeof t?t.call(i,n):Object.fromEntries(Object.entries(t).map(t=>{let[e,r]=t;return"function"==typeof r?[e,r.call(i,n)]:[e,r]}))}function eb(t,e){let n=(null==t?void 0:t.style)||{},i=(null==e?void 0:e.style)||{};return Object.assign({},t,e,{style:Object.assign({},n,i)})}let ex="cachedStyle",eE=t=>"__".concat(t,"__");function ew(t,e){let n=Array.isArray(e)?e:[e];eh(t,ex)||eu(t,ex,{}),n.forEach(e=>{eu(eh(t,ex),eE(e),t.attributes[e])})}function eC(t,e){return eh(t,[ex,eE(e)])}function eS(t,e){return eE(e) in(eh(t,ex)||{})}function eM(t){return function(e,n,i){let r=i.value;return i.value=function(e){for(var i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s="".concat(n,"_invoke");if(!eC(this,s))return eu(this,[ex,eE(s)],!0),r.call(this,e,...a);let l="".concat(n,"_style"),h=eC(this,l),c=t(this,e);return(eu(this,[ex,eE(l)],c),eR(h,c))?null:r.call(this,e,...a)},i}}let eR=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if("object"!=typeof t||"object"!=typeof e)return t===e;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let r of i){let i=t[r],a=e[r];if(n>1&&"object"==typeof i&&"object"==typeof a){if(!eR(i,a,n-1))return!1}else if(i!==a)return!1}return!0};var eO=Object.prototype.hasOwnProperty,eA=function(t,e){if(!e||!ta(t))return{};for(var n,i={},r=tx(e)?e:function(t){return t[e]},a=0;a<t.length;a++){var o=t[a];n=r(o),eO.call(i,n)?i[n].push(o):i[n]=[o]}return i};function eT(t){if(t)return"string"==typeof t||"function"==typeof t||Array.isArray(t)?{type:"group",field:t=>t.id,color:t,invert:!1}:t}function ek(t){let e="string"==typeof t?q("palette",t):t;if("function"!=typeof e)return e}function eP(t,e){let n=2*t;return"string"==typeof e?n=t*Number(e.replace("%",""))/100:"number"==typeof e&&(n=e),isNaN(n)&&(n=2*t),n}function eL(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=(t.max[0]-t.min[0])*(i?n:1);return eP(r,e)}let eD=new WeakMap;function eN(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;if(void 0===e)return;let r=function(a){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,s=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return a.childNodes.forEach(e=>r(e,t))};if(i&&!i(a))return s();if(n||a!==t){eD.has(a)||eD.set(a,a.style.visibility);let t="hidden"===o||"hidden"===(eD.has(a)?eD.get(a):a.style.visibility)?"hidden":"visible";a.style.visibility=t,s(t)}else t.style.visibility=e,eD.delete(t),s(e)};r(t)}var eI={}.toString,eB=Object.prototype,e_=function(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||eB;return t===n},eF=Object.prototype.hasOwnProperty,ej=function(t){if(B(t))return!0;if(z(t))return!t.length;var e=eI.call(t).replace(/^\[object /,"").replace(/]$/,"");if("Map"===e||"Set"===e)return!t.size;if(e_(t))return!Object.keys(t).length;for(var n in t)if(eF.call(t,n))return!1;return!0};class ez extends I.b_{get parsedAttributes(){return this.attributes}upsert(t,e,n,i,r){var a,o,s,l,h,c,u,d;let p=this.shapeMap[t];if(!1===n){p&&(null==r||null===(s=r.beforeDestroy)||void 0===s||s.call(r,p),i.removeChild(p),delete this.shapeMap[t],null==r||null===(l=r.afterDestroy)||void 0===l||l.call(r,p));return}let f="string"==typeof e?q(A.SHAPE,e):e;if(!f)throw Error(Q("Shape ".concat(e," not found")));if(!p||p.destroyed||!(p instanceof f)){p&&(null==r||null===(u=r.beforeDestroy)||void 0===u||u.call(r,p),null==p||p.destroy(),null==r||null===(d=r.afterDestroy)||void 0===d||d.call(r,p)),null==r||null===(h=r.beforeCreate)||void 0===h||h.call(r);let e=new f({className:t,style:n});return i.appendChild(e),this.shapeMap[t]=e,null==r||null===(c=r.afterCreate)||void 0===c||c.call(r,e),e}return null==r||null===(a=r.beforeUpdate)||void 0===a||a.call(r,p),ii(p,n),null==r||null===(o=r.afterUpdate)||void 0===o||o.call(r,p),p}transformPosition(t){let{x:e=0,y:n=0,z:i=0,transform:r}=t;(0!==e||0!==n||0!==i)&&(this.style.transform=tc(+e,+n,+i,r))}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},this.attributes,t);this.attr(e),this.render(e,this),this.transformPosition(e),this.setVisibility()}bindEvents(){}getGraphicStyle(t){return function(t){let{x:e,y:n,z:i,class:r,className:a,transform:o,transformOrigin:s,context:l,zIndex:h,visibility:c,...u}=t;return u}(t)}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}animate(t,e){if(0===t.length)return null;let n=[];if(void 0!==t[0].x||void 0!==t[0].y||void 0!==t[0].z){let{x:e=0,y:n=0,z:i=0}=this.attributes;t.forEach(t=>{let{x:r=e,y:a=n,z:o=i}=t;Object.assign(t,{transform:tc(+r,+a,+o)})})}let i=super.animate(t,e);if(i&&(eG(this,i),n.push(i)),Array.isArray(t)&&t.length>0){let i=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some(t=>!i.includes(t))){Object.entries(this.shapeMap).forEach(i=>{let[r,a]=i,o="get".concat(F(r),"Style"),s=this[o];if(tx(s)){let i=t.map(t=>s.call(this,{...this.attributes,...t})),r=a.animate(tn(i),e);r&&(eG(a,r),n.push(r))}});let i=(i,r)=>{if(!ej(i)){let a="get".concat(F(r),"Style"),o=this[a];if(tx(o)){let r=t.map(t=>o.call(this,{...this.attributes,...t}));Object.entries(r[0]).map(t=>{let[a]=t,o=r.map(t=>t[a]),s=i[a];if(s){let t=s.animate(tn(o),e);t&&(eG(s,t),n.push(t))}})}}};this.compositeShapes.forEach(t=>{let[e,n]=t,r=eg(this.shapeMap,n);i(r,e)})}}return te(n)}getShape(t){return this.shapeMap[t]}setVisibility(){let{visibility:t}=this.attributes;eN(this,t,!0)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}constructor(t){super(t),this.shapeMap={},this.animateMap={},this.transformPosition(this.attributes),this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}}function eG(t,e){null==e||e.finished.then(()=>{let n=t.activeAnimations.findIndex(t=>t===e);n>-1&&t.activeAnimations.splice(n,1)})}class eH extends ez{isTextStyle(t){return ep(t,"label")}isBackgroundStyle(t){return ep(t,"background")}getTextStyle(t){let{padding:e,...n}=this.getGraphicStyle(t);return ey(n,"background")}getBackgroundStyle(t){if(!1===t.background)return!1;let e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:i,padding:r}=e,a=ef(e,"background"),{min:[o,s],center:[l,h],halfExtents:[c,u]}=this.shapeMap.text.getGeometryBounds(),[d,p,f,g]=tS(r),y=2*c+g+p,{width:m,height:v}=a;m&&v?Object.assign(a,{x:l-Number(m)/2,y:h-Number(v)/2}):Object.assign(a,{x:o-g,y:s-d,width:n?Math.min(y,i+g+p):y,height:2*u+d+f});let{radius:b}=a;if("string"==typeof b&&b.endsWith("%")){let t=Number(b.replace("%",""))/100;a.radius=Math.min(+a.width,+a.height)*t}return a}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("text",I.xv,this.getTextStyle(t),e),this.upsert("background",I.UL,this.getBackgroundStyle(t),e)}getGeometryBounds(){let t=this.getShape("background")||this.getShape("text");return t.getGeometryBounds()}constructor(t){super(eb({style:eH.defaultStyleProps},t))}}eH.defaultStyleProps={padding:0,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};class eW extends ez{getBadgeStyle(t){return this.getGraphicStyle(t)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("label",eH,this.getBadgeStyle(t),e)}getGeometryBounds(){let t=this.getShape("label"),e=t.getShape("background")||t.getShape("text");return e.getGeometryBounds()}constructor(t){super(eb({style:eW.defaultStyleProps},t))}}eW.defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};let eV={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]},eZ=t=>{if(t.length<2)return[["M",0,0],["L",0,0]];let e=t[0],n=t[1],i=t[t.length-1],r=t[t.length-2];t.unshift(r,i),t.push(e,n);let a=[["M",i[0],i[1]]];for(let e=1;e<t.length-2;e+=1){let[n,i]=t[e-1],[r,o]=t[e],[s,l]=t[e+1],[h,c]=e!==t.length-2?t[e+2]:[s,l],u=r+(s-n)/6,d=o+(l-i)/6,p=s-(h-r)/6,f=l-(c-o)/6;a.push(["C",u,d,p,f,s,l])}return a};class eU extends ez{getLabelStyle(t){if(!t.label||!t.d||0===t.d.length)return!1;let{maxWidth:e,offsetX:n,offsetY:i,autoRotate:r,placement:a,closeToPath:o,...s}=ef(this.getGraphicStyle(t),"label"),l=this.shapeMap.key,h=null==l?void 0:l.getRenderBounds();return Object.assign(function(t,e,n,i,r,a,o){var s;let l,h;let[c,u]=tQ(t,e),d={textAlign:"left"===e?"right":"right"===e?"left":"center",textBaseline:"top"===e?"bottom":"bottom"===e?"top":"middle",transform:"translate(".concat(c+n,", ").concat(u+i,")")};if("center"===e||!r)return d;let p=function(t){let e=[],n="string"==typeof t?function(t){let e=t.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),n=[],i="",r={};for(;e.length>0;){let t=e.shift();t in eV?i=t:e.unshift(t),r={type:i},eV[i].forEach(n=>{t=e.shift(),r[n]=t}),"M"===i?i="L":"m"===i&&(i="l");let[a,...o]=Object.values(r);n.push([a,...o.map(Number)])}return n}(t):t;return n.forEach(t=>{let n=t[0];if("Z"===n){e.push(e[0]);return}if("A"!==n)for(let n=1;n<t.length;n+=2)e.push([t[n],t[n+1],0]);else{let n=t.length;e.push([t[n-2],t[n-1],0])}}),e}(a);if(!p||p.length<=3)return d;let f=p.map((t,e)=>{let n=p[(e+1)%p.length];return V(t,n)?null:[t,n]}).filter(Boolean),g=(s=[c,u],l=1/0,h=[[0,0],[0,0]],f.forEach(t=>{let e=function(t,e){let n=t4(t,e);return tG(t,n)}(s,t);e<l&&(l=e,h=t)}),h),y=t4([c,u],g);if(y&&g&&(d.transform="translate(".concat(y[0]+n,", ").concat(y[1]+i,")"),o)){let t=Math.atan((g[0][1]-g[1][1])/(g[0][0]-g[1][0]));d.transform+="rotate(".concat(t/Math.PI*180,"deg)"),d.textAlign="center",("right"===e||"left"===e)&&(t>0?d.textBaseline="right"===e?"bottom":"top":d.textBaseline="right"===e?"top":"bottom")}return d}(h,a,n,i,o,t.d,r),{wordWrapWidth:eL(h,e)},s)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",I.y$,this.getKeyStyle(t),e),this.upsert("label",eH,this.getLabelStyle(t),e)}constructor(t){super(eb({style:eU.defaultStyleProps},t))}}eU.defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};class eY extends I.Ee{handleRadius(){let{radius:t,clipPath:e,width:n=0,height:i=0}=this.attributes;if(t&&n&&i){let[r,a]=this.getBounds().min,o={x:r,y:a,radius:t,width:n,height:i};if(e)Object.assign(this.parsedStyle.clipPath.style,o);else{let t=new I.UL({style:o});this.style.clipPath=t}}else e&&(this.style.clipPath=null)}constructor(t){super(t),this.onMounted=()=>{this.handleRadius()},this.onAttrModified=()=>{this.handleRadius()},e$=this,this.isMutationObserved=!0,this.addEventListener(I.Dk.MOUNTED,this.onMounted),this.addEventListener(I.Dk.ATTR_MODIFIED,this.onAttrModified)}}let eK=new WeakMap,e$=null,eX=t=>{if(e$&&(function(t){let e=[],n=t.parentNode;for(;n;)e.push(n),n=n.parentNode;return e})(e$).includes(t)){let e=eK.get(t);e?e.includes(e$)||e.push(e$):eK.set(t,[e$])}},eq=t=>{let e=eK.get(t);e&&e.forEach(t=>t.handleRadius())};class eQ extends ez{isImage(){let{src:t}=this.attributes;return!!t}getIconStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{width:e=0,height:n=0}=t,i=this.getGraphicStyle(t);return this.isImage()?{x:-e/2,y:-n/2,...i}:{textBaseline:"middle",textAlign:"center",...i}}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.upsert("icon",this.isImage()?eY:I.xv,this.getIconStyle(t),e)}constructor(t){super(t)}}class eJ extends ez{get context(){return this.attributes.context}get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){let n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then(()=>this.onframe())),n}}var e0=function(t,e,n,i){var r,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,n,o):r(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o};class e1 extends eJ{getSize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attributes,{size:e}=t;return em(e)}getKeyStyle(t){let e=this.getGraphicStyle(t);return Object.assign(ey(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let{placement:e,maxWidth:n,offsetX:i,offsetY:r,...a}=ef(this.getGraphicStyle(t),"label"),o=this.getShape("key").getLocalBounds();return Object.assign(ie(o,e,i,r),{wordWrapWidth:eL(o,n)},a)}getHaloStyle(t){if(!1===t.halo)return!1;let{fill:e,...n}=this.getKeyStyle(t),i=ef(this.getGraphicStyle(t),"halo");return{...n,stroke:e,...i}}getIconStyle(t){if(!1===t.icon||!t.iconText&&!t.iconSrc)return!1;let e=ef(this.getGraphicStyle(t),"icon");return Object.assign(function(t,e){let n=em(t),i={};return e.text&&!e.fontSize&&(i={fontSize:.5*Math.min(...n)}),!e.src||e.width&&e.height||(i={width:.5*n[0],height:.5*n[1]}),i}(t.size,e),e)}getBadgesStyle(t){var e;let n=eg(this.shapeMap,"badge-"),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.badge||!(null===(e=t.badges)||void 0===e?void 0:e.length))return i;let{badges:r=[],badgePalette:a,opacity:o=1,...s}=t,l=ek(a),h=ef(this.getGraphicStyle(s),"badge");return r.forEach((t,e)=>{i[e]={backgroundFill:l?l[e%(null==l?void 0:l.length)]:void 0,opacity:o,...h,...this.getBadgeStyle(t)}}),i}getBadgeStyle(t){let e=this.getShape("key"),{placement:n="top",offsetX:i,offsetY:r,...a}=t,o=ie(e.getLocalBounds(),n,i,r,!0);return{...o,...a}}getPortsStyle(t){var e;let n=this.getPorts(),i={};if(Object.keys(n).forEach(t=>{i[t]=!1}),!1===t.port||!(null===(e=t.ports)||void 0===e?void 0:e.length))return i;let r=ef(this.getGraphicStyle(t),"port"),{ports:a=[]}=t;return a.forEach((e,n)=>{let a=e.key||n,o={...r,...e};if(n4(o))i[a]=!1;else{let[n,r]=this.getPortXY(t,e);i[a]={transform:"translate(".concat(n,", ").concat(r,")"),...o}}}),i}getPortXY(t,e){let{placement:n="left"}=e,i=this.getShape("key");return n3(function(t,e){if(!t)return e.getLocalBounds();let n=t.canvas.getLayer(),i=e.cloneNode();eN(i,"hidden"),n.appendChild(i);let r=i.getLocalBounds();return n.removeChild(i),r}(this.context,i),n)}getPorts(){return eg(this.shapeMap,"port-")}getCenter(){return this.getShape("key").getBounds().center}getIntersectPoint(t){let e=this.getShape("key").getBounds();return function(t,e){let n=tQ(e,"center"),i=[tQ(e,"left-top"),tQ(e,"right-top"),tQ(e,"right-bottom"),tQ(e,"left-bottom")];return t3(t,n,i,!1).point}(t,e)}drawHaloShape(t,e){let n=this.getShape("key");this.upsert("halo",n.constructor,this.getHaloStyle(t),e)}drawIconShape(t,e){this.upsert("icon",eQ,this.getIconStyle(t),e),eX(this)}drawBadgeShapes(t,e){let n=this.getBadgesStyle(t);Object.keys(n).forEach(t=>{this.upsert("badge-".concat(t),eW,n[t],e)})}drawPortShapes(t,e){let n=this.getPortsStyle(t);Object.keys(n).forEach(t=>{this.upsert("port-".concat(t),I.Cd,n[t],e)})}drawLabelShape(t,e){this.upsert("label",eH,this.getLabelStyle(t),e)}_drawKeyShape(t,e){return this.drawKeyShape(t,e)}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this._drawKeyShape(t,e),this.getShape("key")&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&eq(this)}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}constructor(t){super(eb({style:e1.defaultStyleProps},t)),this.type="node"}}e1.defaultStyleProps={x:0,y:0,size:32,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0},e0([eM((t,e)=>t.getHaloStyle(e))],e1.prototype,"drawHaloShape",null),e0([eM((t,e)=>t.getIconStyle(e))],e1.prototype,"drawIconShape",null),e0([eM((t,e)=>t.getBadgesStyle(e))],e1.prototype,"drawBadgeShapes",null),e0([eM((t,e)=>t.getPortsStyle(e))],e1.prototype,"drawPortShapes",null),e0([eM((t,e)=>t.getLabelStyle(e))],e1.prototype,"drawLabelShape",null),e0([eM((t,e)=>t.getKeyStyle(e))],e1.prototype,"_drawKeyShape",null);class e2 extends e1{drawKeyShape(t,e){return this.upsert("key",I.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return{...e,r:Math.min(...this.getSize(t))/2}}getIconStyle(t){let e=super.getIconStyle(t),{r:n}=this.getShape("key").attributes,i=2*n*.8;return!!e&&{width:i,height:i,...e}}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t6(t,e)}constructor(t){super(eb({style:e2.defaultStyleProps},t))}}e2.defaultStyleProps={size:32};class e3 extends e1{get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",I.mg,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t);return{...e,points:this.getPoints(t)}}getIntersectPoint(t){var e,n;let{points:i}=this.getShape("key").attributes,r=[+((null===(e=this.attributes)||void 0===e?void 0:e.x)||0),+((null===(n=this.attributes)||void 0===n?void 0:n.y)||0)];return t3(t,r,i).point}constructor(t){super(t)}}class e6 extends e2{parseOuterR(){let{size:t}=this.parsedAttributes;return Math.min(...em(t))/2}parseInnerR(){let{innerR:t}=this.parsedAttributes;return W(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){var n;let{donuts:i}=t;if(!(null==i?void 0:i.length))return;let r=i.map(t=>ec(t)?{value:t}:t),a=ef(this.getGraphicStyle(t),"donut"),o=ek(t.donutPalette);if(!o)return;let s=r.reduce((t,e)=>t+(null!==(n=e.value)&&void 0!==n?n:0),0),l=this.parseOuterR(),h=this.parseInnerR(),c=0;r.forEach((t,n)=>{let{value:i=0,color:u=o[n%o.length],...d}=t,p=(0===s?1/r.length:i/s)*360;this.upsert("round".concat(n),I.y$,{...a,d:e5(l,h,c,c+p),fill:u,...d},e),c+=p})}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawDonutShape(t,e)}constructor(t){super(eb({style:e6.defaultStyleProps},t))}}e6.defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};let e4=(t,e,n,i)=>[t+Math.sin(i)*n,e-Math.cos(i)*n],e8=(t,e,n,i)=>i<=0||n<=i?[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"]]:[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"],["M",t+i,e],["A",i,i,0,1,0,t-i,e],["A",i,i,0,1,0,t+i,e],["Z"]],e9=(t,e,n,i,r,a)=>{let[o,s]=[r/360*2*Math.PI,a/360*2*Math.PI],l=[e4(t,e,i,o),e4(t,e,n,o),e4(t,e,n,s),e4(t,e,i,s)],h=s-o>Math.PI?1:0;return[["M",l[0][0],l[0][1]],["L",l[1][0],l[1][1]],["A",n,n,0,h,1,l[2][0],l[2][1]],["L",l[3][0],l[3][1]],["A",i,i,0,h,0,l[0][0],l[0][1]],["Z"]]},e5=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,[r,a]=[0,0];return Math.abs(n-i)%360<1e-6?e8(r,a,t,e):e9(r,a,t,e,n,i)};class e7 extends e1{drawKeyShape(t,e){return this.upsert("key",I.Pj,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getSize(t);return{...e,rx:n/2,ry:i/2}}getIconStyle(t){let e=super.getIconStyle(t),{rx:n,ry:i}=this.getShape("key").attributes,r=2*Math.min(+n,+i)*.8;return!!e&&{width:r,height:r,...e}}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t6(t,e)}constructor(t){super(eb({style:e7.defaultStyleProps},t))}}e7.defaultStyleProps={size:[45,35]};var nt=function(t,e){if(t){if(ta(t))for(var n=0,i=t.length;n<i&&!1!==e(t[n],n);n++);else if(Z(t)){for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break}}},ne=Object.prototype.hasOwnProperty,nn=function(t,e){if(null===t||!to(t))return{};var n={};return nt(e,function(e){ne.call(t,e)&&(n[e]=t[e])}),n},ni=function(t){return void 0===t};class nr extends e1{get eventService(){return this.context.canvas.context.eventService}get events(){return[w.CLICK,w.POINTER_DOWN,w.POINTER_MOVE,w.POINTER_UP,w.POINTER_OVER,w.POINTER_LEAVE]}getDomElement(){return this.getShape("key").getDomElement()}getKeyStyle(t){let e=nn(t,["innerHTML","pointerEvents","cursor"]),[n,i]=this.getSize(t);return{...e,width:n,height:i}}drawKeyShape(t,e){let n=this.getKeyStyle(t),{width:i=0,height:r=0}=n,a=this.upsert("key-container",I.UL,{width:i,height:r,opacity:0},e);return this.upsert("key",I.k9,n,a)}connectedCallback(){let t=this.getDomElement();this.events.forEach(e=>{t.addEventListener(e,this.forwardEvents)})}attributeChangedCallback(t,e,n){"zIndex"===t&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){let t=this.getDomElement();this.events.forEach(e=>{t.removeEventListener(e,this.forwardEvents)}),super.destroy()}normalizeToPointerEvent(t,e){let n=[];if(e.isTouchEvent(t))for(let e=0;e<t.changedTouches.length;e++){let i=t.changedTouches[e];ni(i.button)&&(i.button=0),ni(i.buttons)&&(i.buttons=1),ni(i.isPrimary)&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),ni(i.width)&&(i.width=i.radiusX||1),ni(i.height)&&(i.height=i.radiusY||1),ni(i.tiltX)&&(i.tiltX=0),ni(i.tiltY)&&(i.tiltY=0),ni(i.pointerType)&&(i.pointerType="touch"),ni(i.pointerId)&&(i.pointerId=i.identifier||0),ni(i.pressure)&&(i.pressure=i.force||.5),ni(i.twist)&&(i.twist=0),ni(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=t.type,n.push(i)}else e.isMouseEvent(t)&&(ni(t.isPrimary)&&(t.isPrimary=!0),ni(t.width)&&(t.width=1),ni(t.height)&&(t.height=1),ni(t.tiltX)&&(t.tiltX=0),ni(t.tiltY)&&(t.tiltY=0),ni(t.pointerType)&&(t.pointerType="mouse"),ni(t.pointerId)&&(t.pointerId=1),ni(t.pressure)&&(t.pressure=.5),ni(t.twist)&&(t.twist=0),ni(t.tangentialPressure)&&(t.tangentialPressure=0),t.isNormalized=!0),n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,i){t.view=n,t.originalEvent=null,t.nativeEvent=i,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);let{x:r,y:a}=this.getViewportXY(e);t.viewport.x=r,t.viewport.y=a;let[o,s]=this.context.canvas.getCanvasByViewport([r,a]);return t.canvas.x=o,t.canvas.y=s,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=i.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t}getViewportXY(t){let e,n;let{offsetX:i,offsetY:r,clientX:a,clientY:o}=t;if(!this.context.canvas.context.config.supportsCSSTransform||B(i)||B(r)){let t=this.eventService.client2Viewport({x:a,y:o});e=t.x,n=t.y}else e=i,n=r;return{x:e,y:n}}onframe(){super.onframe();let{opacity:t}=this.attributes;this.getDomElement().style.opacity="".concat(t)}constructor(t){super({...t,style:Object.assign({},nr.defaultStyleProps,t.style)}),this.rootPointerEvent=new I.nR(null),this.forwardEvents=t=>{let e=this.context.canvas,n=e.context.renderingContext.root.ownerDocument.defaultView,i=this.normalizeToPointerEvent(t,n);i.forEach(i=>{let r=this.bootstrapEvent(this.rootPointerEvent,i,n,t);e.context.eventService.mapEvent(r)})}}}nr.defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};class na extends e1{getKeyStyle(t){let[e,n]=this.getSize(t),{fillOpacity:i,opacity:r=i,...a}=super.getKeyStyle(t);return{opacity:r,...a,width:e,height:n,x:-e/2,y:-n/2}}getHaloStyle(t){if(!1===t.halo)return!1;let{fill:e,stroke:n,...i}=this.getShape("key").attributes,r=ef(this.getGraphicStyle(t),"halo"),a=Number(r.lineWidth),[o,s]=tB(this.getSize(t),[a,a]);return{...r,width:o,height:s,fill:"transparent",x:-o/2,y:-s/2}}getIconStyle(t){let e=super.getIconStyle(t),[n,i]=this.getSize(t);return!!e&&{width:.8*n,height:.8*i,...e}}drawKeyShape(t,e){let n=this.upsert("key",eY,this.getKeyStyle(t),e);return eX(this),n}drawHaloShape(t,e){this.upsert("halo",I.UL,this.getHaloStyle(t),e)}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&eq(this)}constructor(t){super(eb({style:na.defaultStyleProps},t))}}na.defaultStyleProps={size:32};class no extends e3{getPoints(t){let{direction:e}=t,[n,i]=this.getSize(t);return function(t,e,n){let i=e/2,r=t/2,a={up:[[-r,i],[r,i],[0,-i]],left:[[-r,0],[r,i],[r,-i]],right:[[-r,i],[-r,-i],[r,0]],down:[[-r,-i],[r,-i],[0,i]]};return a[n]||a.up}(n,i,e)}getPortXY(t,e){let{direction:n}=t,{placement:i="top"}=e,r=this.getShape("key").getLocalBounds(),[a,o]=this.getSize(t),s=function(t,e,n){let i=e/2,r=t/2,a={};return"down"===n?(a.bottom=a.default=[0,i],a.right=[r,-i],a.left=[-r,-i]):"left"===n?(a.top=[r,-i],a.bottom=[r,i],a.left=a.default=[-r,0]):"right"===n?(a.top=[-r,-i],a.bottom=[-r,i],a.right=a.default=[r,0]):(a.left=[-r,i],a.top=a.default=[0,-i],a.right=[r,i]),a}(a,o,n);return n3(r,i,s,!1)}getIconStyle(t){let{icon:e,iconText:n,iconSrc:i,direction:r}=t;if(!1===e||ej(n||i))return!1;let a=ef(this.getGraphicStyle(t),"icon"),o=this.getShape("key").getLocalBounds(),[s,l]=function(t,e){let{center:n}=t,[i,r]=tO(t),a="up"===e||"down"===e?n[0]:"right"===e?n[0]-i/6:n[0]+i/6,o="left"===e||"right"===e?n[1]:"down"===e?n[1]-r/6:n[1]+r/6;return[a,o]}(o,r),h=2*function(t,e){let[n,i]=tO(t);return[n,i]="up"===e||"down"===e?[n,i]:[i,n],(i**2-(Math.sqrt((n/2)**2+i**2)-n/2)**2)/(2*i)}(o,r)*.8;return{x:s,y:l,width:h,height:h,...a}}constructor(t){super(eb({style:no.defaultStyleProps},t))}}no.defaultStyleProps={size:40,direction:"up"};class ns extends e1{getKeySize(t){let{collapsed:e,childrenNode:n=[]}=t;return 0===n.length?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){let{padding:e,collapsedSize:n}=t,[i,r,a,o]=tS(e);return tB(em(n),[o+r,i+a,0])}getCollapsedKeySize(t){return em(t.collapsedSize)}getExpandedKeySize(t){let e=this.getContentBBox(t);return[tM(e),tR(e),0]}getContentBBox(t){let{context:e,childrenNode:n=[],padding:i}=t,r=n.map(t=>e.element.getElement(t)).filter(Boolean);if(0===r.length){let e=new I.mN,{x:n=0,y:i=0,size:r}=t,[a,o]=em(r);return e.setMinMax([n-a/2,i-o/2,0],[n+a/2,i+o/2,0]),e}let a=tk(r.map(t=>t.getBounds()));return i?tT(a,i):a}drawCollapsedMarkerShape(t,e){this.upsert("collapsed-marker",eQ,this.getCollapsedMarkerStyle(t),e),eX(this)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;let{type:e,...n}=ef(this.getGraphicStyle(t),"collapsedMarker"),i=this.getShape("key"),[r,a]=tQ(i.getLocalBounds(),"center"),o={...n,x:r,y:a};if(e){let n=this.getCollapsedMarkerText(e,t);Object.assign(o,{text:n})}return o}getCollapsedMarkerText(t,e){let{context:n,childrenData:i=[]}=e,{model:r}=n;return"descendant-count"===t?r.getDescendantsData(this.id).length.toString():"child-count"===t?i.length.toString():"node-count"===t?r.getDescendantsData(this.id).filter(t=>"node"===r.getElementType(tl(t))).length.toString():tx(t)?t(i):""}getComboZIndex(t){let e=this.context.model.getAncestorsData(this.id,K)||[];return e.length}getComboPosition(t){let{x:e=0,y:n=0,collapsed:i,context:r,childrenData:a=[]}=t;if(0===a.length)return[+e,+n,0];if(i){let{model:t}=r,i=t.getDescendantsData(this.id).filter(e=>!t.isCombo(tl(e)));if(i.length>0){let t=i.reduce((t,e)=>tB(t,tq(e)),[0,0,0]);return tj(t,i.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){let{zIndex:e=this.getComboZIndex(t)}=t,[n,i]=this.getComboPosition(t);return{x:n,y:i,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:e}}updateComboPosition(t){let e=this.getComboStyle(t);Object.assign(this.style,e);let{x:n,y:i}=e;this.context.model.syncComboDatum({id:this.id,style:{x:n,y:i}}),eq(this)}render(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;super.render(t,e),this.drawCollapsedMarkerShape(t,e)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.update(t),this.updateComboPosition(this.parsedAttributes)}onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(this.attributes.collapsed?t:t.map(t=>{let{x:e,y:n,z:i,transform:r,...a}=t;return a}),e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(eb({style:ns.defaultStyleProps},t)),this.type="combo",this.updateComboPosition(this.parsedAttributes)}}ns.defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"},function(t,e,n,i){var r,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,n,o):r(e,n))||o);a>3&&o&&Object.defineProperty(e,n,o)}([eM((t,e)=>t.getCollapsedMarkerStyle(e))],ns.prototype,"drawCollapsedMarkerShape",null);var nl=function(t,e){if(!z(t))return t;for(var n=[],i=0;i<t.length;i++){var r=t[i];e(r,i)&&n.push(r)}return n};let nh={padding:10};function nc(t,e,n,i,r,a){let{padding:o}=Object.assign(nh,a),s=tA(n,o),l=tA(i,o),h=[t,...r,e],c=null,u=[];for(let t=0,e=h.length;t<e-1;t++){var d,p;let n=t+1,i=h[t],r=h[n],a=(d=i,p=r,d[1]===p[1]||d[0]===p[0]),f=null;0===t?n===e-1?s.intersects(l)?f=nm(i,r,s,l):a||(f=function(t,e,n,i){let r=ng(t,e,n),a=tY(r.points[0]);if(tP(a,i)){r=ng(e,t,i);let o=tY(r.points[0]);if(tP(o,n)){let s=t2(t,a,nf(n,np(t,a))/2),l=t2(e,o,nf(i,np(e,o))/2),h=[(s[0]+l[0])/2,(s[1]+l[1])/2],c=ng(t,h,n),u=ny(h,e,i,c.direction);r.points=[c.points[0],u.points[0]],r.direction=u.direction}}return r}(i,r,s,l)):tP(r,s)?f=nm(i,r,s,tA(r,o),c):a||(f=ng(i,r,s)):n===e-1?tP(i,l)?f=nm(i,r,tA(i,o),l,c):a||(f=ny(i,r,l,c)):a||(f=function(t,e,n){let i=[t[0],e[1]],r=[e[0],t[1]],a=np(t,i),o=np(t,r),s=n?nu[n]:null,l=a===n||a!==s&&o!==n?i:r;return{points:[l],direction:np(l,e)}}(i,r,c)),f?(u.push(...f.points),c=f.direction):c=np(i,r),n<e-1&&u.push(r)}return u}let nu={N:"S",S:"N",W:"E",E:"W"},nd={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function np(t,e){let[n,i]=t,[r,a]=e;return n===r?i>a?"N":"S":i===a?n>r?"W":"E":null}function nf(t,e){return"N"===e||"S"===e?tR(t):tM(t)}function ng(t,e,n){let i=nv(t,e,n);return{points:[i],direction:np(i,e)}}function ny(t,e,n,i){let r=[[e[0],t[1]],[t[0],e[1]]],a=r.filter(t=>!tP(t,n)&&!tL(t,n,!0)),o=a.filter(e=>np(e,t)!==i);if(o.length>0){let n=o.find(e=>np(t,e)===i)||o[0];return{points:[n],direction:np(n,e)}}{var s;let o=(void 0===(s=a)&&(s=[]),nl(r,function(t){var e;return!(z(e=s)&&e.indexOf(t)>-1)}))[0],l=t2(e,o,nf(n,i)/2),h=nv(l,t,n);return{points:[h,l],direction:np(l,e)}}}function nm(t,e,n,i,r){let a;let o=tk([n,i]),s=tG(e,o.center)>tG(t,o.center),[l,h]=s?[e,t]:[t,e],c=tR(o)+tM(o);if(r){let t=[l[0]+c*Math.cos(nd[r]),l[1]+c*Math.sin(nd[r])];a=t2(tN(o,t),t,.01)}else a=t2(tN(o,l),l,-.01);let u=nv(a,h,o),d=[t1(a,2),t1(u,2)];if(V(t1(a),t1(u))){let t=tV(t_(a,l),[1,0,0])+Math.PI/2;u=[h[0]+c*Math.cos(t),h[1]+c*Math.sin(t),0],u=t1(t2(tN(o,u),h,-.01),2);let e=nv(a,u,o);d=[a,e,u]}return{points:s?d.reverse():d,direction:s?np(a,e):np(u,e)}}function nv(t,e,n){let i=[t[0],e[1]];return tP(i,n)&&(i=[e[0],t[1]]),i}function nb(t,e,n,i,r){let a="number"==typeof e?e:.5;"start"===e&&(a=0),"end"===e&&(a=.99);let o=tJ(t.getPoint(a)),s=tJ(t.getPoint(a+.01)),l="start"===e?"left":"end"===e?"right":"center";if(o[1]===s[1]||!n){let[e,n]=nx(t,a,i,r);return{transform:"translate(".concat(e,", ").concat(n,")"),textAlign:l}}let h=Math.atan2(s[1]-o[1],s[0]-o[0]),c=s[0]<o[0];c&&(l="center"===l?l:"left"===l?"right":"left",i*=-1,h+=Math.PI);let[u,d]=nx(t,a,i,r,h),p="translate(".concat(u,", ").concat(d,") rotate(").concat(h/Math.PI*180,"deg)");return{textAlign:l,transform:p}}function nx(t,e,n,i,r){let[a,o]=tJ(t.getPoint(e)),s=n,l=i;return r&&(s=n*Math.cos(r)-i*Math.sin(r),l=n*Math.sin(r)+i*Math.cos(r)),[a+s,o+l]}function nE(t,e,n,i){if(V(t,e))return t;let r=t_(e,t),a=[t[0]+n*r[0],t[1]+n*r[1]],o=tW(tZ(r,!1));return a[0]+=i*o[0],a[1]+=i*o[1],a}function nw(t,e,n){return[["M",t[0],t[1]],["C",n[0][0],n[0][1],n[1][0],n[1][1],e[0],e[1]]]}function nC(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[0],r=t[t.length-1],a=t.slice(1,t.length-1),o=[["M",i[0],i[1]]];return a.forEach((t,n)=>{let s=a[n-1]||i,l=a[n+1]||r;if(!tK([s,t],[t,l])&&e){let[n,i]=function(t,e,n,i){let r=tH(t,e),a=tH(n,e),o=Math.min(i,Math.min(r,a)/2),s=[e[0]-o/r*(e[0]-t[0]),e[1]-o/r*(e[1]-t[1])],l=[e[0]-o/a*(e[0]-n[0]),e[1]-o/a*(e[1]-n[1])];return[s,l]}(s,t,l,e);o.push(["L",n[0],n[1]],["Q",t[0],t[1],i[0],i[1]],["L",i[0],i[1]])}else o.push(["L",t[0],t[1]])}),o.push(["L",r[0],r[1]]),n&&o.push(["Z"]),o}let nS=t=>{let e=Math.PI/2,n=tR(t)/2,i=tM(t)/2,r=Math.atan2(n,i)/2,a=Math.atan2(i,n)/2;return{top:[-e-a,-e+a],"top-right":[-e+a,-r],"right-top":[-e+a,-r],right:[-r,r],"bottom-right":[r,e-a],"right-bottom":[r,e-a],bottom:[e-a,e+a],"bottom-left":[e+a,Math.PI-r],"left-bottom":[e+a,Math.PI-r],left:[Math.PI-r,Math.PI+r],"top-left":[Math.PI+r,-e-a],"left-top":[Math.PI+r,-e-a]}};function nM(t,e,n,i,r){let a=tA(t),o=t.getCenter(),s=i&&n8(i),l=r&&n8(r);if(!s||!l){let i=nS(a),r=i[e][0],h=i[e][1],[c,u]=tO(a),d=Math.max(c,u),p=tB(o,[d*Math.cos(r),d*Math.sin(r),0]),f=tB(o,[d*Math.cos(h),d*Math.sin(h),0]);s=it(t,p),l=it(t,f),n||([s,l]=[l,s])}return[s,l]}function nR(t,e){let n=new Set,i=new Set,r=new Set;return t.forEach(a=>{let o=e(a);o.forEach(e=>{n.add(e),t.includes(e.source)&&t.includes(e.target)?i.add(e):r.add(e)})}),{edges:Array.from(n),internal:Array.from(i),external:Array.from(r)}}function nO(t,e){let n=[],i=t;for(;i;){n.push(i);let t=e(tl(i));if(t)i=t;else break}if(n.some(t=>{var e;return null===(e=t.style)||void 0===e?void 0:e.collapsed})){let t=n.reverse().findIndex(el);return n[t]||n.at(-1)}return t}let nA=(t,e)=>{let n=Math.max(t,e)/2;return[["M",-t/2,0],["A",n,n,0,1,0,2*n-t/2,0],["A",n,n,0,1,0,-t/2,0],["Z"]]},nT=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",t/2,e/2],["Z"]],nk=(t,e)=>[["M",-t/2,0],["L",0,-e/2],["L",t/2,0],["L",0,e/2],["Z"]],nP=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",4*t/5-t/2,0],["L",t/2,e/2],["Z"]],nL=(t,e)=>[["M",-t/2,-e/2],["L",t/2,-e/2],["L",t/2,e/2],["L",-t/2,e/2],["Z"]],nD=(t,e)=>{let n=t/2,i=t/7,r=t-i;return[["M",-n,0],["L",0,-e/2],["L",0,e/2],["Z"],["M",r-n,-e/2],["L",r+i-n,-e/2],["L",r+i-n,e/2],["L",r-n,e/2],["Z"]]},nN=(t,e)=>[["M",t/2,-e/2],["L",-t/2,0],["L",t/2,0],["L",-t/2,0],["L",t/2,e/2]];var nI=function(t,e,n,i){var r,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,n,o):r(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o};class nB extends eJ{get sourceNode(){let{context:t,sourceNode:e}=this.parsedAttributes;return t.element.getElement(e)}get targetNode(){let{context:t,targetNode:e}=this.parsedAttributes;return t.element.getElement(e)}getKeyStyle(t){let{loop:e,...n}=this.getGraphicStyle(t),{sourceNode:i,targetNode:r}=this,a=e&&i&&r&&i===r?this.getLoopPath(t):this.getKeyPath(t);return{d:a,...ey(n,["halo","label","startArrow","endArrow"])}}getLoopPath(t){let{sourcePort:e,targetPort:n}=t,i=this.sourceNode,r=tA(i),a=Math.max(tM(r),tR(r)),{placement:o,clockwise:s,dist:l=a}=ef(this.getGraphicStyle(t),"loop");return function(t,e,n,i,r,a){let o=t.getPorts()[r||a],s=t.getPorts()[a||r],[l,h]=nM(t,e,n,o,s),c=function(t,e,n,i){let r=t.getCenter();if(V(e,n)){let t=t_(e,r),a=[i*Math.sign(t[0])||i/2,i*Math.sign(t[1])||-i/2,0];return[tB(e,a),tB(n,tF(a,[1,-1,1]))]}return[t2(r,e,tG(r,e)+i),t2(r,n,tG(r,n)+i)]}(t,l,h,i);return o&&(l=n7(o,c[0])),s&&(h=n7(s,c[c.length-1])),nw(l,h,c)}(i,o,s,l,e,n)}getEndpoints(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{sourcePort:i,targetPort:r}=t,{sourceNode:a,targetNode:o}=this,[s,l]=function(t,e,n,i){let r=n9(t,e,n,i),a=n9(e,t,i,n);return[r,a]}(a,o,i,r);if(!e){let t=s?n8(s):a.getCenter(),e=l?n8(l):o.getCenter();return[t,e]}let h="function"==typeof n?n():n,c=n5(s||a,h[0]||l||o),u=n5(l||o,h[h.length-1]||s||a);return[c,u]}getHaloStyle(t){if(!1===t.halo)return!1;let e=this.getKeyStyle(t),n=ef(this.getGraphicStyle(t),"halo");return{...e,...n}}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;let e=ef(this.getGraphicStyle(t),"label"),{placement:n,offsetX:i,offsetY:r,autoRotate:a,maxWidth:o,...s}=e,l=nb(this.shapeMap.key,n,a,i,r),h=this.shapeMap.key.getLocalBounds(),c=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=tG(t[0],t[1])*n;return eP(i,e)}([h.min,h.max],o);return Object.assign({wordWrapWidth:c},l,s)}getBadgeStyle(t){if(!1===t.badge||!t.badgeText)return!1;let{offsetX:e,offsetY:n,placement:i,...r}=ef(t,"badge");return Object.assign(r,function(t,e,n,i,r){var a,o;let s=(null===(a=t.badge)||void 0===a?void 0:a.getGeometryBounds().halfExtents[0])*2||0,l=(null===(o=t.label)||void 0===o?void 0:o.getGeometryBounds().halfExtents[0])*2||0;return nb(t.key,n,!0,(l?(l/2+s/2)*("suffix"===e?1:-1):0)+i,r)}(this.shapeMap,i,t.labelPlacement,e,n))}drawArrow(t,e){let n="start"===e,i=t["start"===e?"startArrow":"endArrow"],r=this.shapeMap.key;if(i){let e=this.getArrowStyle(t,n),[i,a,o]=n?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],s=r.parsedStyle[i];if(s)s.attr(e);else{let t=e.src?I.Ee:I.y$,n=new t({style:e});r.style[i]=n}r.style[a]=t[o]||e.width/2+ +e.lineWidth}else{var a;let t=n?"markerStart":"markerEnd";null===(a=r.style[t])||void 0===a||a.destroy(),r.style[t]=null}}getArrowStyle(t,e){var n;let i=this.getShape("key").attributes,{size:r,type:a,...o}=ef(this.getGraphicStyle(t),e?"startArrow":"endArrow"),[s,l]=em((n=i.lineWidth,r||(n<4?10:4===n?12:2.5*n))),h=tx(a)?a:N[a]||nT,c=h(s,l);return Object.assign(nn(i,["stroke","strokeOpacity","fillOpacity"]),{width:s,height:l},{...c&&{d:c,fill:"simple"===a?"":i.stroke}},o)}drawLabelShape(t,e){this.upsert("label",eH,this.getLabelStyle(t),e)}drawHaloShape(t,e){this.upsert("halo",I.y$,this.getHaloStyle(t),e)}drawBadgeShape(t,e){this.upsert("badge",eW,this.getBadgeStyle(t),e)}drawSourceArrow(t){this.drawArrow(t,"start")}drawTargetArrow(t){this.drawArrow(t,"end")}drawKeyShape(t,e){let n=this.upsert("key",I.y$,this.getKeyStyle(t),e);return n}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.drawKeyShape(t,e),this.getShape("key")&&(this.drawSourceArrow(t),this.drawTargetArrow(t),this.drawLabelShape(t,e),this.drawHaloShape(t,e),this.drawBadgeShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawSourceArrow(this.parsedAttributes),this.drawTargetArrow(this.parsedAttributes),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this),this.drawBadgeShape(this.parsedAttributes,this)}animate(t,e){let n=super.animate(t,e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then(()=>this.onframe()),Reflect.set(t,e,n))}):n}constructor(t){super(eb({style:nB.defaultStyleProps},t)),this.type="edge"}}nB.defaultStyleProps={badge:!0,badgeOffsetX:0,badgeOffsetY:0,badgePlacement:"suffix",isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowLineDash:0,startArrowLineJoin:"round",startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"vee",endArrow:!1,endArrowLineDash:0,endArrowLineJoin:"round",endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"vee",loopPlacement:"top",loopClockwise:!0},nI([eM((t,e)=>t.getLabelStyle(e))],nB.prototype,"drawLabelShape",null),nI([eM((t,e)=>t.getHaloStyle(e))],nB.prototype,"drawHaloShape",null),nI([eM((t,e)=>t.getBadgeStyle(e))],nB.prototype,"drawBadgeShape",null),nI([eM((t,e)=>t.getArrowStyle(e,"start"))],nB.prototype,"drawSourceArrow",null),nI([eM((t,e)=>t.getArrowStyle(e,"end"))],nB.prototype,"drawTargetArrow",null),nI([eM((t,e)=>t.getKeyStyle(e))],nB.prototype,"drawKeyShape",null);class n_ extends nB{getKeyPath(t){let[e,n]=this.getEndpoints(t),{controlPoints:i,curvePosition:r,curveOffset:a}=t,o=this.getControlPoints(e,n,ec(r)?[r,1-r]:r,ec(a)?[a,-a]:a,i);return nw(e,n,o)}getControlPoints(t,e,n,i,r){return(null==r?void 0:r.length)===2?r:[nE(t,e,n[0],i[0]),nE(t,e,n[1],i[1])]}constructor(t){super(eb({style:n_.defaultStyleProps},t))}}n_.defaultStyleProps={curvePosition:.5,curveOffset:20};class nF extends n_{getControlPoints(t,e,n,i){let r=e[0]-t[0];return[[t[0]+r*n[0]+i[0],t[1]],[e[0]-r*n[1]+i[1],e[1]]]}constructor(t){super(eb({style:nF.defaultStyleProps},t))}}nF.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class nj extends n_{getControlPoints(t,e,n,i){let r=e[1]-t[1];return[[t[0],t[1]+r*n[0]+i[0]],[e[0],e[1]-r*n[1]+i[1]]]}constructor(t){super(eb({style:nj.defaultStyleProps},t))}}nj.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class nz extends nB{getKeyPath(t){let[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}constructor(t){super(eb({style:nz.defaultStyleProps},t))}}nz.defaultStyleProps={};let nG={enableObstacleAvoidance:!1,offset:10,maxAllowedDirectionChange:Math.PI/2,maximumLoops:3e3,gridSize:5,startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{right:{stepX:1,stepY:0},left:{stepX:-1,stepY:0},bottom:{stepX:0,stepY:1},top:{stepX:0,stepY:-1}},penalties:{0:0,90:0},distFunc:tH},nH=t=>"".concat(Math.round(t[0]),"|||").concat(Math.round(t[1]));function nW(t,e){let n=t=>Math.round(t/e);return ec(t)?n(t):t.map(n)}function nV(t,e){let n=e[0]-t[0],i=e[1]-t[1];return n||i?Math.atan2(i,n):0}function nZ(t,e,n,i){let r=nV(t,e),a=n[nH(t)],o=nV(a||i,t);return function(t,e){let n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n}(o,r)}let nU=(t,e)=>{let{offset:n,gridSize:i}=e,r={};return t.forEach(t=>{if(!t||t.destroyed||!t.isVisible())return;let e=tT(t.getRenderBounds(),n);for(let t=nW(e.min[0],i);t<=nW(e.max[0],i);t+=1)for(let n=nW(e.min[1],i);n<=nW(e.max[1],i);n+=1)r["".concat(t,"|||").concat(n)]=!0}),r};function nY(t,e,n){return Math.min(...e.map(e=>n(t,e)))}let nK=(t,e,n,i)=>{if(!e)return[t];let{directionMap:r,offset:a}=i,o=tT(e.getRenderBounds(),a),s=Object.keys(r).reduce((e,i)=>{if(n.includes(i)){let n=r[i],[a,s]=tO(o),l=[t[0]+n.stepX*a,t[1]+n.stepY*s],h=function(t){let{min:[e,n],max:[i,r]}=t,a=[e,r],o=[i,r],s=[i,n],l=[e,n];return[[a,o],[o,s],[s,l],[l,a]]}(o);for(let n=0;n<h.length;n++){let i=t$([t,l],h[n]);i&&tL(i,o)&&e.push(i)}}return e},[]);return tP(t,o)||s.push(t),s.map(t=>nW(t,i.gridSize))},n$=(t,e,n,i,r,a,o)=>{let s=[],l=[a[0]===i[0]?i[0]:t[0]*o,a[1]===i[1]?i[1]:t[1]*o];s.unshift(l);let h=t,c=e[nH(h)];for(;c;){let t=c,i=h,r=nZ(t,i,e,n);r&&(l=[t[0]===i[0]?l[0]:t[0]*o,t[1]===i[1]?l[1]:t[1]*o],s.unshift(l)),c=e[nH(t)],h=t}let u=r.map(t=>[t[0]*o,t[1]*o]),d=function(t,e,n){let i=t[0],r=n(t[0],e);for(let a=0;a<t.length;a++){let o=t[a],s=n(o,e);s<r&&(i=o,r=s)}return i}(u,l,tH);return s.unshift(d),s};class nX{_innerAdd(t,e){let n=0,i=e-1;for(;i-n>1;){let e=Math.floor((n+i)/2);if(this.arr[e].value>t.value)i=e;else if(this.arr[e].value<t.value)n=e;else{this.arr.splice(e,0,t),this.map[t.id]=!0;return}}this.arr.splice(i,0,t),this.map[t.id]=!0}add(t){delete this.map[t.id];let e=this.arr.length;if(!e||this.arr[e-1].value<t.value){this.arr.push(t),this.map[t.id]=!0;return}this._innerAdd(t,e)}remove(t){this.map[t]&&delete this.map[t]}_clearAndGetMinId(){let t;for(let e=this.arr.length-1;e>=0;e--)this.map[this.arr[e].id]?t=this.arr[e].id:this.arr.splice(e,1);return t}_findFirstId(){for(;this.arr.length;){let t=this.arr.shift();if(this.map[t.id])return t.id}}minId(t){return t?this._clearAndGetMinId():this._findFirstId()}constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}}class nq extends nB{getControlPoints(t){let{router:e}=t,{sourceNode:n,targetNode:i}=this,[r,a]=this.getEndpoints(t,!1),o=[];if(e){if("shortest-path"===e.type){let s=this.context.element.getNodes();(o=function(t,e,n,i){let r;let a=tU(t.getCenter()),o=tU(e.getCenter()),s=Object.assign(nG,i),{gridSize:l}=s,h=s.enableObstacleAvoidance?n:[t,e],c=nU(h,s),u=nW(a,l),d=nW(o,l),p=nK(a,t,s.startDirections,s),f=nK(o,e,s.endDirections,s);p.forEach(t=>delete c[nH(t)]),f.forEach(t=>delete c[nH(t)]);let g={},y={},m={},v={},b={},x=new nX;for(let t=0;t<p.length;t++){let e=p[t],n=nH(e);g[n]=e,v[n]=0,b[n]=nY(e,f,s.distFunc),x.add({id:n,value:b[n]})}let E=f.map(t=>nH(t)),w=s.maximumLoops,C=1/0;for(let[t,e]of Object.entries(g))b[t]<=C&&(C=b[t],r=e);for(;Object.keys(g).length>0&&w>0;){let t=x.minId(!1);if(t)r=g[t];else break;let e=nH(r);if(E.includes(e))return n$(r,m,u,o,p,d,l);for(let t of(delete g[e],x.remove(e),y[e]=!0,Object.values(s.directionMap))){let n=tB(r,[t.stepX,t.stepY]),i=nH(n);if(y[i])continue;let a=nZ(r,n,m,u);if(a>s.maxAllowedDirectionChange||c[i])continue;g[i]||(g[i]=n);let o=s.penalties[a],h=s.distFunc(r,n)+(isNaN(o)?l:o),d=v[e]+h,p=v[i];p&&d>=p||(m[i]=r,v[i]=d,b[i]=d+nY(n,f,s.distFunc),x.add({id:i,value:b[i]}))}w-=1}return[]}(n,i,s,e)).length||(o=nc(r,a,n,i,t.controlPoints,{padding:e.offset}))}else"orth"===e.type&&(o=nc(r,a,n,i,t.controlPoints,e))}else o=t.controlPoints;return o}getPoints(t){let e=this.getControlPoints(t),[n,i]=this.getEndpoints(t,!0,e);return[n,...e,i]}getKeyPath(t){let e=this.getPoints(t);return nC(e,t.radius)}getLoopPath(t){let{sourcePort:e,targetPort:n,radius:i}=t,r=this.sourceNode,a=tA(r),o=Math.max(tM(a),tR(a))/4,{placement:s,clockwise:l,dist:h=o}=ef(this.getGraphicStyle(t),"loop");return function(t,e,n,i,r,a,o){let s=n6(t),l=s[a||o],h=s[o||a],[c,u]=nM(t,n,i,l,h),d=function(t,e,n,i){let r=[],a=tA(t);if(V(e,n)){let t=tD(a,e);switch(t){case"left":r.push([e[0]-i,e[1]]),r.push([e[0]-i,e[1]+i]),r.push([e[0],e[1]+i]);break;case"right":r.push([e[0]+i,e[1]]),r.push([e[0]+i,e[1]+i]),r.push([e[0],e[1]+i]);break;case"top":r.push([e[0],e[1]-i]),r.push([e[0]+i,e[1]-i]),r.push([e[0]+i,e[1]]);break;case"bottom":r.push([e[0],e[1]+i]),r.push([e[0]+i,e[1]+i]),r.push([e[0]+i,e[1]])}}else{let t=tD(a,e),o=tD(a,n);if(t===o){let a,o;switch(t){case"left":a=Math.min(e[0],n[0])-i,r.push([a,e[1]]),r.push([a,n[1]]);break;case"right":a=Math.max(e[0],n[0])+i,r.push([a,e[1]]),r.push([a,n[1]]);break;case"top":o=Math.min(e[1],n[1])-i,r.push([e[0],o]),r.push([n[0],o]);break;case"bottom":o=Math.max(e[1],n[1])+i,r.push([e[0],o]),r.push([n[0],o])}}else{let s=(t,e)=>({left:[e[0]-i,e[1]],right:[e[0]+i,e[1]],top:[e[0],e[1]-i],bottom:[e[0],e[1]+i]})[t],l=s(t,e),h=s(o,n),c=nv(l,h,a);r.push(l,c,h)}}return r}(t,c,u,r);return l&&(c=n7(l,d[0])),h&&(u=n7(h,d[d.length-1])),nC([c,...d,u],e)}(r,i,s,l,h,e,n)}constructor(t){super(eb({style:nq.defaultStyleProps},t))}}nq.defaultStyleProps={radius:0,controlPoints:[],router:!1};class nQ extends nB{getKeyPath(t){let{curvePosition:e,curveOffset:n}=t,[i,r]=this.getEndpoints(t),a=t.controlPoint||nE(i,r,e,n);return[["M",i[0],i[1]],["Q",a[0],a[1],r[0],r[1]]]}constructor(t){super(eb({style:nQ.defaultStyleProps},t))}}function nJ(t){return t instanceof e1&&"node"===t.type}function n0(t){return t instanceof nB}function n1(t){return t instanceof ns}nQ.defaultStyleProps={curvePosition:.5,curveOffset:30};let n2={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],default:[.5,.5]};function n3(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n2,i=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=[.5,.5],a=W(e)?eh(n,e.toLocaleLowerCase(),r):e;if(!i&&W(e))return a;let[o,s]=a||r;return[t.min[0]+tM(t)*o,t.min[1]+tR(t)*s]}function n6(t){if(!t)return{};let e=t.getPorts(),n=t.attributes.ports||[];return n.forEach((n,i)=>{let{key:r,placement:a}=n;if(n4(n)){var o;e[o=r||i]||(e[o]=tQ(t.getShape("key").getBounds(),a))}}),e}function n4(t){let{r:e}=t;return!e||0===Number(e)}function n8(t){return tw(t)?t:t.getPosition()}function n9(t,e,n,i){let r,a;let o=n6(t);if(n)return o[n];let s=Object.values(o);if(0===s.length)return;let l=s.map(t=>n8(t)),h=function(t,e){let n=n6(t);if(e)return[n8(n[e])];let i=Object.values(n);return i.length>0?i.map(t=>n8(t)):[t.getCenter()]}(e,i),[c]=(r=1/0,a=[l[0],h[0]],l.forEach(t=>{h.forEach(e=>{let n=tG(t,e);n<r&&(r=n,a=[t,e])})}),a);return s.find(t=>n8(t)===c)}function n5(t,e){return n1(t)||nJ(t)?it(t,e):n7(t,e)}function n7(t,e){if(!t||!e)return[0,0,0];if(tw(t))return t;if(t.attributes.linkToCenter)return t.getPosition();let n=tw(e)?e:nJ(e)?e.getCenter():e.getPosition();return t6(n,t.getBounds())}function it(t,e){if(!t||!e)return[0,0,0];let n=tw(e)?e:nJ(e)?e.getCenter():e.getPosition();return t.getIntersectPoint(n)||t.getCenter()}function ie(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.split("-"),[o,s]=tQ(t,e),l=a.includes("left")?"right":a.includes("right")?"left":"center",h=a.includes("top")?"bottom":a.includes("bottom")?"top":"middle";return r&&(h="top"===h?"bottom":"bottom"===h?"top":h),{transform:"translate(".concat(o+n,", ").concat(s+i,")"),textBaseline:h,textAlign:l}}function ii(t,e){"update"in t?t.update(e):t.attr(e)}function ir(t){return eh(t,"__to_be_destroyed__",!1)}class ia extends tb{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("node:".concat(e),this.onCollapseExpand),t.on("combo:".concat(e),this.onCollapseExpand)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("node:".concat(e),this.onCollapseExpand),t.off("combo:".concat(e),this.onCollapseExpand)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ia.defaultOptions,e)),this.onCollapseExpand=async t=>{if(!this.validate(t))return;let{target:e}=t;if(!(nJ(e)||n0(e)||n1(e)))return;let n=e.id,{model:i,graph:r}=this.context,a=i.getElementDataById(n);if(!a)return!1;let{onCollapse:o,onExpand:s,animation:l}=this.options;el(a)?(await r.expandElement(n,l),null==s||s(n)):(await r.collapseElement(n,l),null==o||o(n))},this.bindEvents()}}ia.defaultOptions={enable:!0,animation:!0,trigger:w.DBLCLICK};var io={};let is="g6-create-edge-assist-node-id";class il extends tb{update(t){super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),"click"===e?(t.on(O.CLICK,this.handleCreateEdge),t.on(E.CLICK,this.handleCreateEdge),t.on(x.CLICK,this.cancelEdge),t.on(S.CLICK,this.cancelEdge)):(t.on(O.DRAG_START,this.handleCreateEdge),t.on(E.DRAG_START,this.handleCreateEdge),t.on(w.POINTER_UP,this.drop)),t.on(w.POINTER_MOVE,this.updateAssistEdge)}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;t.off(O.CLICK,this.handleCreateEdge),t.off(E.CLICK,this.handleCreateEdge),t.off(x.CLICK,this.cancelEdge),t.off(S.CLICK,this.cancelEdge),t.off(O.DRAG_START,this.handleCreateEdge),t.off(E.DRAG_START,this.handleCreateEdge),t.off(w.POINTER_UP,this.drop),t.off(w.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},il.defaultOptions,e)),this.drop=async t=>{let{targetType:e}=t;["combo","node"].includes(e)&&this.source?await this.handleCreateEdge(t):await this.cancelEdge()},this.handleCreateEdge=async t=>{var e;if(!this.validate(t))return;let{graph:n,canvas:i,batch:r,element:a}=this.context,{style:o}=this.options;if(this.source){this.createEdge(t),await this.cancelEdge();return}r.startBatch(),i.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([t.target.id])[0],n.addNodeData([{id:is,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}]}}]),n.addEdgeData([{id:"g6-create-edge-assist-edge-id",source:this.source,target:is,style:{pointerEvents:"none",...o}}]),await (null===(e=a.draw({animation:!1}))||void 0===e?void 0:e.finished)},this.updateAssistEdge=async t=>{var e;if(!this.source)return;let{model:n,element:i}=this.context;n.translateNodeTo(is,[t.canvas.x,t.canvas.y]),await (null===(e=i.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished)},this.createEdge=t=>{var e,n,i;let{graph:r}=this.context,{style:a,onFinish:o,onCreate:s}=this.options,l=null===(e=t.target)||void 0===e?void 0:e.id;if(void 0===l||void 0===this.source)return;let h=null===(n=this.getSelectedNodeIDs([t.target.id]))||void 0===n?void 0:n[0],c="".concat(this.source,"-").concat(h,"-").concat((io[i=i||"g"]?io[i]+=1:io[i]=1,i+io[i])),u=s({id:c,source:this.source,target:h,style:a});r.addEdgeData([u]),o(u)},this.cancelEdge=async()=>{var t;if(!this.source)return;let{graph:e,element:n,batch:i}=this.context;e.removeNodeData([is]),this.source=void 0,await (null===(t=n.draw({animation:!1}))||void 0===t?void 0:t.finished),i.endBatch()},this.bindEvents()}}il.defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:t=>t,onFinish:()=>{}};var ih=function(t,e,n){var i;return function(){var r=this,a=arguments,o=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,a)},e),o&&t.apply(r,a)}};class ic extends tb{update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{trigger:t}=this.options;if(Z(t)){let{up:e=[],down:n=[],left:i=[],right:r=[]}=t;this.shortcut.bind(e,t=>this.onTranslate([0,1],t)),this.shortcut.bind(n,t=>this.onTranslate([0,-1],t)),this.shortcut.bind(i,t=>this.onTranslate([1,0],t)),this.shortcut.bind(r,t=>this.onTranslate([-1,0],t))}else{let{graph:t}=this.context;t.on(w.DRAG_START,this.onDragStart),t.on(w.DRAG,this.onDrag),t.on(w.DRAG_END,this.onDragEnd)}}async onTranslate(t,e){if(!this.validate(e))return;let{sensitivity:n}=this.options;await this.translate(tF(t,-1*n),this.options.animation),this.invokeOnFinish()}async translate(t,e){let[n,i]=t,{direction:r}=this.options;"x"===r?i=0:"y"===r&&(n=0),await this.context.graph.translateBy([n,i],e)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return"function"==typeof e?e(t):!!e}unbindEvents(){this.shortcut.unbindAll();let{graph:t}=this.context;t.off(w.DRAG_START,this.onDragStart),t.off(w.DRAG,this.onDrag),t.off(w.DRAG_END,this.onDragEnd)}destroy(){this.shortcut.destroy(),this.unbindEvents(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}constructor(t,e){super(t,Object.assign({},ic.defaultOptions,e)),this.isDragging=!1,this.onDragStart=t=>{this.validate(t)&&(this.isDragging=!0,this.context.canvas.setCursor("grabbing"))},this.onDrag=t=>{if(!this.isDragging)return;let{x:e,y:n}=t.movement;(e|n)!=0&&this.translate([e,n],!1)},this.onDragEnd=()=>{var t,e;this.isDragging=!1,this.context.canvas.setCursor(this.defaultCursor),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},this.invokeOnFinish=ih(()=>{var t,e;null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},300),this.shortcut=new t7(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default"}}ic.defaultOptions={enable:t=>!("targetType"in t)||"canvas"===t.targetType,sensitivity:10,direction:"both"};class iu extends tb{get animation(){return!!this.options.shadow&&this.options.animation}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){let{graph:t}=this.context;this.enableElements.forEach(e=>{t.on("".concat(e,":").concat(w.DRAG_START),this.onDragStart),t.on("".concat(e,":").concat(w.DRAG),this.onDrag),t.on("".concat(e,":").concat(w.DRAG_END),this.onDragEnd),t.on("".concat(e,":").concat(w.POINTER_ENTER),this.setCursor),t.on("".concat(e,":").concat(w.POINTER_LEAVE),this.setCursor)}),["link"].includes(this.options.dropEffect)&&(t.on(E.DROP,this.onDrop),t.on(x.DROP,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map(t=>t.id).concat(t)))}getDelta(t){let e=this.context.graph.getZoom();return tj([t.dx,t.dy],e)}onDragStart(t){var e;if(this.enable=this.validate(t),!this.enable)return;let{batch:n,canvas:i}=this.context;i.setCursor((null===(e=this.options.cursor)||void 0===e?void 0:e.grabbing)||"grabbing"),this.isDragging=!0,n.startBatch(),this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target)}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){var t,e,n;if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";let{x:t=0,y:e=0}=this.shadow.attributes,[n,i]=t_([+t,+e],this.shadowOrigin);this.moveElement(this.target,[n,i])}this.showEdges(),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t,this.target);let{batch:i,canvas:r}=this.context;i.endBatch(),r.setCursor((null===(n=this.options.cursor)||void 0===n?void 0:n.grab)||"grab"),this.isDragging=!1,this.target=[]}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}async moveElement(t,e){let{graph:n,model:i}=this.context,{dropEffect:r}=this.options;"move"===r&&t.forEach(t=>i.refreshComboData(t)),n.translateElementBy(Object.fromEntries(t.map(t=>[t,e])),!1)}moveShadow(t){if(!this.shadow)return;let{x:e=0,y:n=0}=this.shadow.attributes,[i,r]=t;this.shadow.attr({x:+e+i,y:+n+r})}createShadow(t){let e=ef(this.options,"shadow"),n=tk(t.map(t=>this.context.element.getElement(t).getBounds())),[i,r]=n.min;this.shadowOrigin=[i,r];let[a,o]=tO(n),s={width:a,height:o,x:i,y:r};this.shadow?this.shadow.attr({...e,...s,visibility:"visible"}):(this.shadow=new I.UL({style:{$layer:"transient",...e,...s,pointerEvents:"none"}}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||0===this.hiddenEdges.length||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){let{hideEdge:t,shadow:e}=this.options;if("none"===t||e)return;let{graph:n}=this.context;"all"===t?this.hiddenEdges=n.getEdgeData().map(tl):this.hiddenEdges=Array.from(new Set(this.target.map(e=>n.getRelatedEdgesData(e,t).map(tl)).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){let{graph:t}=this.context;this.enableElements.forEach(e=>{t.off("".concat(e,":").concat(w.DRAG_START),this.onDragStart),t.off("".concat(e,":").concat(w.DRAG),this.onDrag),t.off("".concat(e,":").concat(w.DRAG_END),this.onDragEnd),t.off("".concat(e,":").concat(w.POINTER_ENTER),this.setCursor),t.off("".concat(e,":").concat(w.POINTER_LEAVE),this.setCursor)}),t.off("combo:".concat(w.DROP),this.onDrop),t.off("canvas:".concat(w.DROP),this.onDrop)}destroy(){var t;this.unbindEvents(),null===(t=this.shadow)||void 0===t||t.destroy(),super.destroy()}constructor(t,e){super(t,Object.assign({},iu.defaultOptions,e)),this.enable=!1,this.enableElements=["node","combo"],this.target=[],this.shadowOrigin=[0,0],this.hiddenEdges=[],this.isDragging=!1,this.onDrop=async t=>{var e;if("link"!==this.options.dropEffect)return;let{model:n,element:i}=this.context,r=t.target.id;this.target.forEach(t=>{let e=n.getParentData(t,K);e&&tl(e)===r&&n.refreshComboData(r),n.setParent(t,r,K)}),await (null===(e=null==i?void 0:i.draw({animation:!0}))||void 0===e?void 0:e.finished)},this.setCursor=t=>{if(this.isDragging)return;let{type:e}=t,{canvas:n}=this.context,{cursor:i}=this.options;e===w.POINTER_ENTER?n.setCursor((null==i?void 0:i.grab)||"grab"):n.setCursor((null==i?void 0:i.default)||"default")},this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}}iu.defaultOptions={animation:!0,enable:t=>["node","combo"].includes(t.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5],cursor:{default:"default",grab:"grab",grabbing:"grabbing"}};var id=n(72137);class ip{constructor(t,e){this.context=t,this.options=e||{}}}function ig(t){let{nodes:e,edges:n}=t,i={nodes:[],edges:[],combos:[]};return e.forEach(t=>{let e=t.data._isCombo?i.combos:i.nodes,{x:n,y:r,z:a=0}=t.data;null==e||e.push({id:t.id,style:{x:n,y:r,z:a}})}),n.forEach(t=>{let{id:e,source:n,target:r,data:{points:a=[],controlPoints:o=a.slice(1,a.length-1)}}=t;i.edges.push({id:e,source:n,target:r,style:{...(null==o?void 0:o.length)?{controlPoints:o.map(tJ)}:{}}})}),i}function iy(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if(e in t)return t[e](...i);if("instance"in t){let n=t.instance;if(e in n)return n[e](...i)}return null}function im(t,e){if(e in t)return t[e];if("instance"in t){let n=t.instance;if(e in n)return n[e]}return null}class iv extends tb{bindEvents(){let{graph:t}=this.context;t.on(M.AFTER_TRANSFORM,this.fixElementSize),t.on(M.BEFORE_DRAW,this.resetTransform)}unbindEvents(){let{graph:t}=this.context;t.off(M.AFTER_TRANSFORM,this.fixElementSize),t.off(M.BEFORE_DRAW,this.resetTransform)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},iv.defaultOptions,e)),this.elementCache=new Map,this.isZoomEvent=t=>"scale"in t.data,this.fixElementSize=async t=>{if(!this.isZoomEvent(t)||!this.validate(t))return;let{graph:e,element:n}=this.context,{state:i}=this.options,r=i?[...e.getElementDataByState("node",i),...e.getElementDataByState("edge",i),...e.getElementDataByState("combo",i)]:Object.values(e.getData()).flat();if(!r.length)return;let a=t.data.scale||e.getZoom();r.forEach(t=>{let i=tl(t),r=null==n?void 0:n.getElement(i),o=e.getElementType(i),s=this.options[o];if(!s){this.elementCache.set(i,r),"edge"===o&&(r.style.transformOrigin="center"),r.setLocalScale(1/a);return}let l=function(t){let e=[],n=t=>{(null==t?void 0:t.children.length)&&t.children.forEach(t=>{e.push(t),n(t)})};return n(t),e}(r),h=Array.isArray(s)?s:[s];h.forEach(t=>{let{shape:e,fields:n}=t,i=e(l);n.forEach(t=>{eS(i,t)||ew(i,t);let e=eC(i,t);ec(e)&&(i.style[t]=e/a)})})})},this.resetTransform=async()=>{this.elementCache&&(this.elementCache.forEach(t=>t.setLocalScale(1)),this.elementCache.clear())},this.bindEvents()}}iv.defaultOptions={enable:t=>t.data.scale<1,state:"selected",edge:[{shape:t=>t.find(t=>"key"===t.className),fields:["lineWidth"]},{shape:t=>t.find(t=>{var e;return(null===(e=t.parentElement)||void 0===e?void 0:e.className)==="label"&&"text"===t.className}),fields:["fontSize","lineHeight"]}]};class ib extends tb{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),en.forEach(e=>{t.on("".concat(e,":").concat(w.CLICK),this.focus)})}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;en.forEach(e=>{t.off("".concat(e,":").concat(w.CLICK),this.focus)})}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ib.defaultOptions,e)),this.focus=async t=>{if(!this.validate(t))return;let{graph:e}=this.context;await e.focusElement(t.target.id,this.options.animation)},this.bindEvents()}}ib.defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};class ix extends tb{bindEvents(){let{graph:t}=this.context;this.unbindEvents(),en.forEach(e=>{t.on("".concat(e,":").concat(w.POINTER_OVER),this.hoverElement),t.on("".concat(e,":").concat(w.POINTER_OUT),this.hoverElement)});let e=this.context.canvas.document;e.addEventListener("".concat(w.DRAG_START),this.toggleFrozen),e.addEventListener("".concat(w.DRAG_END),this.toggleFrozen)}validate(t){if(this.destroyed||this.isFrozen||this.context.graph.isCollapsingExpanding)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}unbindEvents(){let{graph:t}=this.context;en.forEach(e=>{t.off("".concat(e,":").concat(w.POINTER_OVER),this.hoverElement),t.off("".concat(e,":").concat(w.POINTER_OUT),this.hoverElement)});let e=this.context.canvas.document;e.removeEventListener("".concat(w.DRAG_START),this.toggleFrozen),e.removeEventListener("".concat(w.DRAG_END),this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},ix.defaultOptions,e)),this.isFrozen=!1,this.toggleFrozen=t=>{this.isFrozen="dragstart"===t.type},this.hoverElement=t=>{if(!this.validate(t))return;let e=t.type===w.POINTER_OVER;this.updateElementsState(t,e);let{onHover:n,onHoverEnd:i}=this.options;e?null==n||n(t):null==i||i(t)},this.updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.inactiveState)return;let{graph:n}=this.context,{state:i,degree:r,animation:a,inactiveState:o}=this.options,{targetType:s,target:l}=t,h=r?er(n,s,l.id,r):[l.id],c={};if(i&&Object.assign(c,this.getElementsState(h,i,e)),o){let t=th(n.getData(),!0).filter(t=>!h.includes(t));Object.assign(c,this.getElementsState(t,o,e))}n.setElementState(c,a)},this.getElementsState=(t,e,n)=>{let{graph:i}=this.context,r={};return t.forEach(t=>{let a=i.getElementState(t),o=n?[...a,e]:a.filter(t=>t!==e);r[t]=o}),r},this.bindEvents()}}ix.defaultOptions={animation:!1,enable:!0,degree:0,state:"active",inactiveState:void 0};class iE extends tb{bindEvents(){let{graph:t}=this.context;t.on(M.BEFORE_TRANSFORM,this.hideShapes),t.on(M.AFTER_TRANSFORM,this.showShapes)}unbindEvents(){let{graph:t}=this.context;t.off(M.BEFORE_TRANSFORM,this.hideShapes),t.off(M.AFTER_TRANSFORM,this.showShapes)}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},iE.defaultOptions,e)),this.isVisible=!0,this.setElementsVisibility=(t,e,n)=>{t.forEach(t=>{eN(t,e,!1,t=>!t.className||!(null==n?void 0:n.includes(t.className)))})},this.hideShapes=t=>{if(!this.validate(t)||!this.isVisible)return;let{element:e}=this.context,{shapes:n={}}=this.options;this.setElementsVisibility(e.getNodes(),"hidden",n.node),this.setElementsVisibility(e.getEdges(),"hidden",n.edge),this.setElementsVisibility(e.getCombos(),"hidden",n.combo),this.isVisible=!1},this.showShapes=ih(t=>{if(!this.validate(t)||this.isVisible)return;let{element:e}=this.context;this.setElementsVisibility(e.getNodes(),"visible"),this.setElementsVisibility(e.getEdges(),"visible"),this.setElementsVisibility(e.getCombos(),"visible"),this.isVisible=!0},this.options.debounce),this.bindEvents()}}iE.defaultOptions={enable:!0,debounce:200,shapes:{node:["key"]}};class iw extends tb{update(t){super.update(t),this.bindEvents()}bindEvents(){var t,e;let{trigger:n}=this.options;if(this.shortcut.unbindAll(),Z(n)){null===(t=this.graphDom)||void 0===t||t.removeEventListener(w.WHEEL,this.onWheel);let{up:e=[],down:i=[],left:r=[],right:a=[]}=n;this.shortcut.bind(e,t=>this.scroll([0,-10],t)),this.shortcut.bind(i,t=>this.scroll([0,10],t)),this.shortcut.bind(r,t=>this.scroll([-10,0],t)),this.shortcut.bind(a,t=>this.scroll([10,0],t))}else null===(e=this.graphDom)||void 0===e||e.addEventListener(w.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}formatDisplacement(t){let[e,n]=t,{direction:i,sensitivity:r}=this.options;return e*=r,n*=r,"x"===i?n=0:"y"===i&&(e=0),[e,n]}async scroll(t,e){if(!this.validate(e))return;let{onFinish:n}=this.options,i=this.context.graph,r=this.formatDisplacement(t);await i.translateBy(r,!1),null==n||n()}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.graphDom)||void 0===t||t.removeEventListener(w.WHEEL,this.onWheel),super.destroy()}constructor(t,e){super(t,Object.assign({},iw.defaultOptions,e)),this.onWheel=async t=>{this.options.preventDefault&&t.preventDefault();let e=t.deltaX,n=t.deltaY;await this.scroll([-e,-n],t)},this.shortcut=new t7(t.graph),this.bindEvents()}}iw.defaultOptions={enable:!0,sensitivity:1,preventDefault:!0};var iC=function(t,e,n){return t<e?e:t>n?n:t};class iS extends tb{update(t){super.update(t),this.bindEvents()}bindEvents(){let{trigger:t}=this.options;if(this.shortcut.unbindAll(),Array.isArray(t)){var e;null===(e=this.context.canvas.getContainer())||void 0===e||e.addEventListener(w.WHEEL,this.preventDefault),this.shortcut.bind([...t,w.WHEEL],t=>{let{deltaX:e,deltaY:n}=t;this.zoom(-(null!=n?n:e),t,!1)})}if("object"==typeof t){let{zoomIn:e=[],zoomOut:n=[],reset:i=[]}=t;this.shortcut.bind(e,t=>this.zoom(10,t,this.options.animation)),this.shortcut.bind(n,t=>this.zoom(-10,t,this.options.animation)),this.shortcut.bind(i,this.onReset)}}validate(t){if(this.destroyed)return!1;let{enable:e}=this.options;return tx(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.context.canvas.getContainer())||void 0===t||t.removeEventListener(w.WHEEL,this.preventDefault),super.destroy()}constructor(t,e){super(t,Object.assign({},iS.defaultOptions,e)),this.zoom=async(t,e,n)=>{let i;if(!this.validate(e))return;let{graph:r}=this.context;"viewport"in e&&(i=tJ(e.viewport));let{sensitivity:a,onFinish:o}=this.options,s=1+iC(t,-50,50)*a/100,l=r.getZoom();await r.zoomTo(l*s,n,i),null==o||o()},this.onReset=async()=>{await this.context.graph.zoomTo(1,this.options.animation)},this.preventDefault=t=>{this.options.preventDefault&&t.preventDefault()},this.shortcut=new t7(t.graph),this.bindEvents()}}iS.defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[],preventDefault:!0};var iM=n(81746),iR=n(28104),iO=n(63795),iA=n(39233),iT=n(5192),ik=n(63330),iP=n(51712),iL=n(67753),iD=n(12368),iN=n(89469),iI=n(41733),iB=n(64912),i_=n(29257),iF=n(26629),ij=function(t,e,n){if(!ta(t)&&!to(t))return t;var i=n;return nt(t,function(t,n){i=e(i,t,n)}),i},iz=function(t,e){return ij(t,function(t,n,i){return e.includes(i)||(t[i]=n),t},{})};let iG=t=>t?parseInt(t):0;function iH(t){let e=640,n=480,[i,r]=function(t){let e=getComputedStyle(t),n=t.clientWidth||iG(e.width),i=t.clientHeight||iG(e.height),r=iG(e.paddingLeft)+iG(e.paddingRight),a=iG(e.paddingTop)+iG(e.paddingBottom);return[n-r,i-a]}(t);return e=i||e,n=r||n,[Math.max(ec(e)?e:1,1),Math.max(ec(n)?n:1,1)]}function iW(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=document.createElement("div");return n.setAttribute("class","g6-".concat(t)),n.style.position="absolute",n.style.display="block",e&&(n.style.inset="0px",n.style.height="100%",n.style.width="100%",n.style.overflow="hidden",n.style.pointerEvents="none"),n}function iV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.body,a=document.getElementById(t);a&&a.remove();let o=document.createElement(e);return o.innerHTML=i,o.id=t,Object.assign(o.style,n),r.appendChild(o),o}class iZ extends tv{}class iU extends iZ{async update(t){super.update(t),Object.assign(this.$element.style,iz(this.options,["key","type"]))}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},iU.defaultOptions,e)),this.$element=iW("background");let n=this.context.canvas.getContainer();n.prepend(this.$element),this.update(e)}}function iY(t,e,n,i,r,a){let o=n-t,s=i-e,l=r-t,h=a-e,c=l*o+h*s,u=0;u=c<=0?0:(c=(l=o-l)*o+(h=s-h)*s)<=0?0:c*c/(o*o+s*s);let d=l*l+h*h-u;return d<0?0:d}function iK(t,e,n,i){return(t-n)*(t-n)+(e-i)*(e-i)}function i$(t){let e=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),r=Math.max(t.y1,t.y2);return{x:e,y:i,x2:n,y2:r,width:n-e,height:r-i}}iU.defaultOptions={transition:"background 0.5s",backgroundSize:"cover"};class iX{constructor(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new iX(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2||e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2||t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;let n=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1);return t<=n}distSquare(t,e){return iY(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,n){if(this.x1<this.x2){if(t<this.x1-n||t>this.x2+n)return!1}else if(t<this.x2-n||t>this.x1+n)return!1;if(this.y1<this.y2){if(e<this.y1-n||e>this.y2+n)return!1}else if(e<this.y2-n||e>this.y1+n)return!1;return!0}}(g=T||(T={}))[g.POINT=1]="POINT",g[g.PARALLEL=2]="PARALLEL",g[g.COINCIDENT=3]="COINCIDENT",g[g.NONE=4]="NONE";class iq{constructor(t,e=0,n=0){this.state=t,this.x=e,this.y=n}}function iQ(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),r=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(r){let e=n/r,a=i/r;return 0<=e&&e<=1&&0<=a&&a<=1?new iq(T.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new iq(T.NONE)}return new iq(0===n||0===i?T.COINCIDENT:T.PARALLEL)}function iJ(t,e){let n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),r=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(r){let t=n/r,e=i/r;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function i0(t,e,n){let i=new Set;return t.width<=0?(i.add(k.LEFT),i.add(k.RIGHT)):e<t.x?i.add(k.LEFT):e>t.x+t.width&&i.add(k.RIGHT),t.height<=0?(i.add(k.TOP),i.add(k.BOTTOM)):n<t.y?i.add(k.TOP):n>t.y+t.height&&i.add(k.BOTTOM),i}function i1(t,e){let n=e.x1,i=e.y1,r=e.x2,a=e.y2,o=Array.from(i0(t,r,a));if(0===o.length)return!0;let s=i0(t,n,i);for(;0!==s.size;){for(let t of o)if(s.has(t))return!1;if(s.has(k.RIGHT)||s.has(k.LEFT)){let e=t.x;s.has(k.RIGHT)&&(e+=t.width),i+=(e-n)*(a-i)/(r-n),n=e}else{let e=t.y;s.has(k.BOTTOM)&&(e+=t.height),n+=(e-i)*(r-n)/(a-i),i=e}s=i0(t,n,i)}return!0}(y=k||(k={}))[y.LEFT=0]="LEFT",y[y.TOP=1]="TOP",y[y.RIGHT=2]="RIGHT",y[y.BOTTOM=3]="BOTTOM";class i2{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new i2(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new i2(this.x,this.y,this.width,this.height)}add(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x+t.width),r=Math.max(this.y2,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=r-n}addPoint(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x),r=Math.max(this.y2,t.y);this.x=e,this.y=n,this.width=i-e,this.height=r-n}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0)&&!(t.width<=0)&&!(t.height<=0)&&t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2}distSquare(t,e){if(this.containsPt(t,e))return 0;let n=i0(this,t,e);return n.has(k.TOP)?n.has(k.LEFT)?iK(t,e,this.x,this.y):n.has(k.RIGHT)?iK(t,e,this.x2,this.y):(this.y-e)*(this.y-e):n.has(k.BOTTOM)?n.has(k.LEFT)?iK(t,e,this.x,this.y2):n.has(k.RIGHT)?iK(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):n.has(k.LEFT)?(this.x-t)*(this.x-t):n.has(k.RIGHT)?(t-this.x2)*(t-this.x2):0}}class i3{constructor(t,e,n){this.cx=t,this.cy=e,this.radius=n}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new i3(t.cx,t.cy,t.radius)}containsPt(t,e){return iK(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){let n=iK(this.cx,this.cy,t,e);if(n<this.radius*this.radius)return 0;let i=Math.sqrt(n)-this.radius;return i*i}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class i6{constructor(t,e=0,n=0,i=0,r=0,a=10,o=10,s=new Float32Array(Math.max(0,a*o)).fill(0)){this.pixelGroup=t,this.i=e,this.j=n,this.pixelX=i,this.pixelY=r,this.width=a,this.height=o,this.area=s}createSub(t,e){return new i6(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new i6(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new i6(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){let e=this.scaleX(t.x),n=this.scaleY(t.y),i=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),r=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup)),a=i-e,o=r-n;return new i2(e,n,a,o)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){let n=Math.ceil(e/this.pixelGroup),i=this.boundX(t.x-n),r=this.boundY(t.y-n),a=this.boundX(t.x2+n),o=this.boundY(t.y2+n),s=a-i,l=o-r;return new i2(i,r,s,l)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=n)}set(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=n)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;let n=this.width,i=t.width,r=Math.max(0,t.i),a=Math.max(0,t.j),o=Math.min(t.i+t.width,n),s=Math.min(t.j+t.height,this.height);if(!(s<=0)&&!(o<=0)&&!(r>=n)&&!(s>=this.height))for(let l=a;l<s;l++){let a=(l-t.j)*i,s=l*n;for(let n=r;n<o;n++){let i=t.area[n-t.i+a];0!==i&&(this.area[n+s]+=e*i)}}}fill(t){this.area.fill(t)}fillArea(t,e){let n=t.x+t.y*this.width;for(let i=0;i<t.height;i++){let r=n+i*this.width;this.area.fill(e,r,r+t.width)}}fillHorizontalLine(t,e,n,i){let r=t+e*this.width;this.area.fill(i,r,r+n)}fillVerticalLine(t,e,n,i){let r=t+e*this.width;for(let t=0;t<n;t++)this.area[r+t*this.width]=i}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){let n=e*this.width;for(let e=0;e<this.width;e++){let i=this.area[n+e];t+=i.toFixed(1).padStart(6)+" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);let n=this.area.reduce((t,e)=>Math.min(t,e),Number.POSITIVE_INFINITY),i=this.area.reduce((t,e)=>Math.max(t,e),Number.NEGATIVE_INFINITY),r=t=>(t-n)/(i-n);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let i=this.area[e+n*this.width];t.fillStyle=`rgba(0, 0, 0, ${r(i)})`,t.fillRect(e,n,1,1)}t.restore()}drawThreshold(t,e,n=!0){if(!(this.width<=0)&&!(this.height<=0)){t.save(),n&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){let r=this.area[n+i*this.width];t.fillStyle=r>e?"black":"white",t.fillRect(n,i,1,1)}t.restore()}}}function i4(t,e){let n=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(n):n(t)}function i8(t,e,n){return i9(Object.assign(i$(t),{distSquare:(e,n)=>iY(t.x1,t.y1,t.x2,t.y2,e,n)}),e,n)}function i9(t,e,n){let i=i4(t,n),r=e.scale(i),a=e.createSub(r,i);return function(t,e,n,i){let r=n*n;for(let a=0;a<t.height;a++)for(let o=0;o<t.width;o++){let s=e.invertScaleX(t.i+o),l=e.invertScaleY(t.j+a),h=i(s,l);if(0===h){t.set(o,a,r);continue}if(h<r){let e=n-Math.sqrt(h);t.set(o,a,e*e)}}}(a,e,n,(e,n)=>t.distSquare(e,n)),a}function i5(t,e){return e.some(e=>e.containsPt(t.x,t.y))}function i7(t,e){return e.some(e=>{var n,i,r,a;return n=e.x1,i=e.y1,1e-6>iK(n,i,t.x,t.y)||(r=e.x2,a=e.y2,1e-6>iK(r,a,t.x,t.y))})}function rt(t,e){let n=Number.POSITIVE_INFINITY,i=null;for(let r of t){if(!i1(r,e))continue;let t=function(t,e){let n=Number.POSITIVE_INFINITY,i=0;function r(t,r,a,o){let s=iJ(e,new iX(t,r,a,o));(s=Math.abs(s-.5))>=0&&s<=1&&(i++,s<n&&(n=s))}return(r(t.x,t.y,t.x2,t.y),r(t.x,t.y,t.x,t.y2),i>1)?n:(r(t.x,t.y2,t.x2,t.y2),i>1)?n:(r(t.x2,t.y,t.x2,t.y2),0===i)?-1:n}(r,e);t>=0&&t<n&&(i=r,n=t)}return i}function re(t,e,n,i){let r=n.top,a=n.left,o=n.bottom,s=n.right;if(i){if(a.state===T.POINT){if(r.state===T.POINT)return{x:t.x-e,y:t.y-e};if(o.state===T.POINT)return{x:t.x-e,y:t.y2+e};let n=t.width*t.height,i=t.width*((a.y-t.y+(s.y-t.y))*.5);return i<.5*n?a.y>s.y?{x:t.x-e,y:t.y-e}:{x:t.x2+e,y:t.y-e}:a.y<s.y?{x:t.x-e,y:t.y2+e}:{x:t.x2+e,y:t.y2+e}}if(s.state===T.POINT){if(r.state===T.POINT)return{x:t.x2+e,y:t.y-e};if(o.state===T.POINT)return{x:t.x2+e,y:t.y2+e}}let n=t.height*t.width,i=t.height*((r.x-t.x+(s.x-t.x))*.5);return i<.5*n?r.x>o.x?{x:t.x-e,y:t.y-e}:{x:t.x-e,y:t.y2+e}:r.x<o.x?{x:t.x2+e,y:t.y-e}:{x:t.x2+e,y:t.y2+e}}if(a.state===T.POINT){if(r.state===T.POINT)return{x:t.x2+e,y:t.y2+e};if(o.state===T.POINT)return{x:t.x2+e,y:t.y-e};let n=t.height*t.width,i=t.width*((a.y-t.y+(s.y-t.y))*.5);return i<.5*n?a.y>s.y?{x:t.x2+e,y:t.y2+e}:{x:t.x-e,y:t.y2+e}:a.y<s.y?{x:t.x2+e,y:t.y-e}:{x:t.x-e,y:t.y-e}}if(s.state===T.POINT){if(r.state===T.POINT)return{x:t.x-e,y:t.y2+e};if(o.state===T.POINT)return{x:t.x-e,y:t.y-e}}let l=t.height*t.width,h=t.height*((r.x-t.x+(s.x-t.x))*.5);return h<.5*l?r.x>o.x?{x:t.x2+e,y:t.y2+e}:{x:t.x2+e,y:t.y-e}:r.x<o.x?{x:t.x-e,y:t.y2+e}:{x:t.x-e,y:t.y-e}}class rn{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){let e=this.points.length;return t<0?this.closed?this.get(t+e):this.points[0]:t>=e?this.closed?this.get(t-e):this.points[e-1]:this.points[t]}get length(){return this.points.length}toString(t=1/0){let e=this.points;if(0===e.length)return"";let n="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;let e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t),i="M";for(let t of e)i+=`${n(t.x)},${n(t.y)} L`;return i=i.slice(0,-1),this.closed&&(i+=" Z"),i}draw(t){let e=this.points;if(0!==e.length){for(let n of(t.beginPath(),t.moveTo(e[0].x,e[0].y),e))t.lineTo(n.x,n.y);this.closed&&t.closePath()}}sample(t){return(function(t=8){return e=>{let n=t,i=e.length;if(n>1)for(i=Math.floor(e.length/n);i<3&&n>1;)n-=1,i=Math.floor(e.length/n);let r=[];for(let t=0,a=0;a<i;a++,t+=n)r.push(e.get(t));return new rn(r)}})(t)(this)}simplify(t){return(function(t=0){return e=>{if(t<0||e.length<3)return e;let n=[],i=0,r=t*t;for(;i<e.length;){let t=i+1;for(;function(t,e,n,i){let r=t.closed?n<t.length:n<t.length-1;if(!r)return!1;let a=t.get(e),o=t.get(n+1);for(let r=e+1;r<=n;r++){let e=t.get(r),n=iY(a.x,a.y,o.x,o.y,e.x,e.y);if(n>i)return!1}return!0}(e,i,t,r);)t++;n.push(e.get(i)),i=t}return new rn(n)}})(t)(this)}bSplines(t){return(function(t=6){function e(t,e,n){let i=0,r=0;for(let a=-2;a<=1;a++){let o=t.get(e+a),s=function(t,e){switch(t){case -2:return(((-e+3)*e-3)*e+1)/6;case -1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw Error("unknown error")}}(a,n);i+=s*o.x,r+=s*o.y}return{x:i,y:r}}return n=>{if(n.length<3)return n;let i=[],r=n.closed,a=n.length+3-1+(r?0:2);i.push(e(n,2-(r?0:2),0));for(let o=2-(r?0:2);o<a;o++)for(let r=1;r<=t;r++)i.push(e(n,o,r/t));return new rn(i)}})(t)(this)}apply(t){return t(this)}containsElements(t){let e=function(t){if(0===t.length)return null;let e=t[0],n=new i2(e.x,e.y,0,0);for(let e of t)n.addPoint(e);return n}(this.points);return!!e&&t.every(t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy))}withinArea(t,e){if(0===this.length)return!1;let n=0,i=this.points[0],r=new iX(i.x,i.y,i.x,i.y);for(let i=1;i<this.points.length;i++){let a=this.points[i];r.x1=r.x2,r.y1=r.y2,r.x2=a.x,r.y2=a.y,r.cuts(t,e)&&n++}return r.x1=r.x2,r.y1=r.y2,r.x2=i.x,r.y2=i.y,r.cuts(t,e)&&n++,n%2==1}}class ri{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;let e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new rn(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}let rr={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};function ra(t){return null!=t&&"number"==typeof t.radius}function ro(t,e){return ra(t)===ra(e)&&(ra(t)?t.cx===e.cx&&t.cy===e.cy&&t.radius===e.radius:t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height)}(m=P||(P={}))[m.MEMBERS=0]="MEMBERS",m[m.NON_MEMBERS=1]="NON_MEMBERS",m[m.EDGES=2]="EDGES";class rs{constructor(t={}){this.dirty=new Set,this.members=[],this.nonMembers=[],this.virtualEdges=[],this.edges=[],this.activeRegion=new i2(0,0,0,0),this.potentialArea=new i6(1,0,0,0,0,0,0),this.o=Object.assign({},rr,t)}pushMember(...t){if(0!==t.length)for(let e of(this.dirty.add(P.MEMBERS),t))this.members.push({raw:e,obj:ra(e)?i3.from(e):i2.from(e),area:null})}removeMember(t){let e=this.members.findIndex(e=>ro(e.raw,t));return!(e<0)&&(this.members.splice(e,1),this.dirty.add(P.MEMBERS),!0)}removeNonMember(t){let e=this.nonMembers.findIndex(e=>ro(e.raw,t));return!(e<0)&&(this.nonMembers.splice(e,1),this.dirty.add(P.NON_MEMBERS),!0)}removeEdge(t){let e=this.edges.findIndex(e=>e.obj.equals(t));return!(e<0)&&(this.edges.splice(e,1),this.dirty.add(P.NON_MEMBERS),!0)}pushNonMember(...t){if(0!==t.length)for(let e of(this.dirty.add(P.NON_MEMBERS),t))this.nonMembers.push({raw:e,obj:ra(e)?i3.from(e):i2.from(e),area:null})}pushEdge(...t){if(0!==t.length)for(let e of(this.dirty.add(P.EDGES),t))this.edges.push({raw:e,obj:iX.from(e),area:null})}update(){let t=this.dirty.has(P.MEMBERS),e=this.dirty.has(P.NON_MEMBERS),n=this.dirty.has(P.EDGES);this.dirty.clear();let i=this.members.map(t=>t.obj);if(this.o.virtualEdges&&(t||e)){let t=this.nonMembers.map(t=>t.obj),e=function(t,e,n,i){if(0===t.length)return[];let r=function(t){if(t.length<2)return t;let e=0,n=0;return t.forEach(t=>{e+=t.cx,n+=t.cy}),e/=t.length,n/=t.length,t.map(t=>{let i=e-t.cx,r=n-t.cy;return[t,i*i+r*r]}).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}(t);return r.map((t,a)=>{let o=r.slice(0,a);return function(t,e,n,i,r){let a;let o={x:e.cx,y:e.cy},s=(a=Number.POSITIVE_INFINITY,n.reduce((e,n)=>{let i=iK(o.x,o.y,n.cx,n.cy);if(i>a)return e;let r=new iX(o.x,o.y,n.cx,n.cy),s=t.reduce((t,e)=>i1(e,r)&&function(t,e){function n(t,n,i,r){let a=iJ(e,new iX(t,n,i,r));return(a=Math.abs(a-.5))>=0&&a<=1?1:0}let i=n(t.x,t.y,t.x2,t.y);return!!((i+=n(t.x,t.y,t.x,t.y2))>1||(i+=n(t.x,t.y2,t.x2,t.y2))>1)||(i+=n(t.x2,t.y,t.x2,t.y2))>0}(e,r)?t+1:t,0);return i*(s+1)*(s+1)<a&&(e=n,a=i*(s+1)*(s+1)),e},null));if(null==s)return[];let l=new iX(o.x,o.y,s.cx,s.cy),h=function(t,e,n,i){let r=[],a=[];a.push(t);let o=!0;for(let t=0;t<n&&o;t++)for(o=!1;!o&&a.length>0;){let t=a.pop(),n=rt(e,t),s=n?function(t,e){let n=0,i=iQ(t,new iX(e.x,e.y,e.x2,e.y));n+=i.state===T.POINT?1:0;let r=iQ(t,new iX(e.x,e.y,e.x,e.y2));n+=r.state===T.POINT?1:0;let a=iQ(t,new iX(e.x,e.y2,e.x2,e.y2));n+=a.state===T.POINT?1:0;let o=iQ(t,new iX(e.x2,e.y,e.x2,e.y2));return{top:i,left:r,bottom:a,right:o,count:n+=o.state===T.POINT?1:0}}(t,n):null;if(!n||!s||2!==s.count){o||r.push(t);continue}let l=i,h=re(n,l,s,!0),c=i7(h,a)||i7(h,r),u=i5(h,e);for(;!c&&u&&l>=1;)l/=1.5,c=i7(h=re(n,l,s,!0),a)||i7(h,r),u=i5(h,e);if(!h||c||u||(a.push(new iX(t.x1,t.y1,h.x,h.y)),a.push(new iX(h.x,h.y,t.x2,t.y2)),o=!0),o)continue;let d=i7(h=re(n,l=i,s,!1),a)||i7(h,r);for(u=i5(h,e);!d&&u&&l>=1;)l/=1.5,d=i7(h=re(n,l,s,!1),a)||i7(h,r),u=i5(h,e);h&&!d&&(a.push(new iX(t.x1,t.y1,h.x,h.y)),a.push(new iX(h.x,h.y,t.x2,t.y2)),o=!0),o||r.push(t)}for(;a.length>0;)r.push(a.pop());return r}(l,t,i,r);return function(t,e){let n=[];for(;t.length>0;){let i=t.pop();if(0===t.length){n.push(i);break}let r=t.pop(),a=new iX(i.x1,i.y1,r.x2,r.y2),o=rt(e,a);o?(n.push(i),t.push(r)):t.push(a)}return n}(h,t)}(e,t,o,n,i)}).flat()}(i,t,this.o.maxRoutingIterations,this.o.morphBuffer),r=new Map(this.virtualEdges.map(t=>[t.obj.toString(),t.area]));this.virtualEdges=e.map(t=>{var e;return{raw:t,obj:t,area:null!==(e=r.get(t.toString()))&&void 0!==e?e:null}}),n=!0}let r=!1;if(t||n){let t=this.virtualEdges.concat(this.edges).map(t=>t.obj),e=function(t,e){if(0===t.length)return new i2(0,0,0,0);let n=i2.from(t[0]);for(let e of t)n.add(e);for(let t of e)n.add(i$(t));return n}(i,t),n=Math.max(this.o.edgeR1,this.o.nodeR1)+this.o.morphBuffer,a=i2.from(i4(e,n));a.equals(this.activeRegion)||(r=!0,this.activeRegion=a)}if(r){let t=Math.ceil(this.activeRegion.width/this.o.pixelGroup),e=Math.ceil(this.activeRegion.height/this.o.pixelGroup);this.activeRegion.x!==this.potentialArea.pixelX||this.activeRegion.y!==this.potentialArea.pixelY?(this.potentialArea=i6.fromPixelRegion(this.activeRegion,this.o.pixelGroup),this.members.forEach(t=>t.area=null),this.nonMembers.forEach(t=>t.area=null),this.edges.forEach(t=>t.area=null),this.virtualEdges.forEach(t=>t.area=null)):(t!==this.potentialArea.width||e!==this.potentialArea.height)&&(this.potentialArea=i6.fromPixelRegion(this.activeRegion,this.o.pixelGroup))}let a=new Map,o=t=>{if(t.area){let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof i2?"R":"C"}`;a.set(e,t.area)}},s=t=>{if(t.area)return;let e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof i2?"R":"C"}`;if(a.has(e)){let n=a.get(e);t.area=this.potentialArea.copy(n,{x:t.obj.x-this.o.nodeR1,y:t.obj.y-this.o.nodeR1});return}let n=t.obj instanceof i2?function(t,e,n){let i=e.scale(t),r=e.addPadding(i,n),a=e.createSub(r,{x:t.x-n,y:t.y-n}),o=i.x-r.x,s=i.y-r.y,l=r.x2-i.x2,h=r.y2-i.y2,c=r.width-o-l,u=r.height-s-h,d=n*n;a.fillArea({x:o,y:s,width:c+1,height:u+1},d);let p=[0],f=Math.max(s,o,l,h);{let r=e.invertScaleX(i.x+i.width/2);for(let a=1;a<f;a++){let o=e.invertScaleY(i.y-a),s=t.distSquare(r,o);if(s<d){let t=n-Math.sqrt(s);p.push(t*t)}else break}}let g=[],y=Math.max(o,l),m=Math.max(s,l);for(let r=1;r<y;r++){let a=e.invertScaleX(i.x-r),o=[];for(let r=1;r<m;r++){let s=e.invertScaleY(i.y-r),l=t.distSquare(a,s);if(l<d){let t=n-Math.sqrt(l);o.push(t*t)}else o.push(0)}g.push(o)}for(let t=1;t<Math.min(s,p.length);t++){let e=p[t];a.fillHorizontalLine(o,s-t,c+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];a.fillHorizontalLine(o,s+u+t,c+1,e)}for(let t=1;t<Math.min(o,p.length);t++){let e=p[t];a.fillVerticalLine(o-t,s,u+1,e)}for(let t=1;t<Math.min(h,p.length);t++){let e=p[t];a.fillVerticalLine(o+c+t,s,u+1,e)}for(let t=1;t<o;t++){let e=g[t-1],n=o-t;for(let t=1;t<s;t++)a.set(n,s-t,e[t-1]);for(let t=1;t<h;t++)a.set(n,s+u+t,e[t-1])}for(let t=1;t<l;t++){let e=g[t-1],n=o+c+t;for(let t=1;t<s;t++)a.set(n,s-t,e[t-1]);for(let t=1;t<h;t++)a.set(n,s+u+t,e[t-1])}return a}(t.obj,this.potentialArea,this.o.nodeR1):i9(t.obj,this.potentialArea,this.o.nodeR1);t.area=n,a.set(e,n)};this.members.forEach(o),this.nonMembers.forEach(o),this.members.forEach(s),this.nonMembers.forEach(t=>{this.activeRegion.intersects(t.obj)?s(t):t.area=null}),this.edges.forEach(t=>{t.area||(t.area=i8(t.obj,this.potentialArea,this.o.edgeR1))}),this.virtualEdges.forEach(t=>{t.area||(t.area=i8(t.obj,this.potentialArea,this.o.edgeR1))})}drawMembers(t){for(let e of this.members)e.obj.draw(t)}drawNonMembers(t){for(let e of this.nonMembers)e.obj.draw(t)}drawEdges(t){for(let e of this.edges)e.obj.draw(t)}drawPotentialArea(t,e=!0){this.potentialArea.draw(t,e)}compute(){if(0===this.members.length)return new rn([]);this.dirty.size>0&&this.update();let{o:t,potentialArea:e}=this,n=this.members.map(t=>t.area),i=this.virtualEdges.concat(this.edges).map(t=>t.area),r=this.nonMembers.filter(t=>null!=t.area).map(t=>t.area),a=this.members.map(t=>t.obj);return function(t,e,n,i,r,a={}){let o=Object.assign({},rr,a),s=o.threshold,l=o.memberInfluenceFactor,h=o.edgeInfluenceFactor,c=o.nonMemberInfluenceFactor,u=(o.nodeR0-o.nodeR1)*(o.nodeR0-o.nodeR1),d=(o.edgeR0-o.edgeR1)*(o.edgeR0-o.edgeR1);for(let a=0;a<o.maxMarchingIterations;a++){if(t.clear(),0!==l){let n=l/u;for(let i of e)t.incArea(i,n)}if(0!==h){let e=h/d;for(let i of n)t.incArea(i,e)}if(0!==c){let e=c/u;for(let n of i)t.incArea(n,e)}let p=function(t,e){let n=(Math.floor(t.width)+Math.floor(t.height))*2,i=new ri(n);function r(n,i,r,a){let o=t.get(n,i);return Number.isNaN(o)?Number.NaN:o>e?r+a:r}function a(t,e){let n=0;return(n=r(t,e,0,1),n=r(t+1,e,n,2),n=r(t,e+1,n,4),Number.isNaN(n=r(t+1,e+1,n,8)))?-1:n}let o=1;for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++){if(t.get(n,r)<=e)continue;let s=a(n,r);if(!(s<0)&&15!==s&&function(e,n){let r=e,s=n,l=t.invertScaleX(r),h=t.invertScaleY(s);for(let e=0;e<t.width*t.height;e++){let e={x:l,y:h};if(i.contains(e)){if(i.isFirst(e))break}else i.add(e);let n=a(r,s);switch(n){case -1:return!0;case 0:case 3:case 2:case 7:o=2;break;case 12:case 14:case 4:o=3;break;case 6:o=0===o?3:2;break;case 1:case 13:case 5:o=0;break;case 9:o=2===o?0:1;break;case 10:case 8:case 11:o=1;break;default:return console.warn("Marching squares invalid state: "+n),!0}switch(o){case 0:s--,h-=t.pixelGroup;break;case 1:s++,h+=t.pixelGroup;break;case 3:r--,l-=t.pixelGroup;break;case 2:r++,l+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+n),!0}}return!0}(n,r))return i.path()}return null}(t,s);if(p&&r(p))return p;if(s*=.95,a<=.5*o.maxMarchingIterations)l*=1.2,h*=1.2;else if(0!==c&&i.length>0)c*=.8;else break}return new rn([])}(e,n,i,r,t=>t.containsElements(a),t)}}class rl extends iZ{bindEvents(){this.context.graph.on(M.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(M.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new rs(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){let{type:t,key:e,members:n,avoidMembers:i,...r}=this.options,a=Object.keys(r).reduce((t,e)=>(e in rr?t.bubbleSetOptions[e]=r[e]:t.style[e]=r[e],t),{style:{},bubbleSetOptions:{}});return{type:t,key:e,members:n,avoidMembers:i,...a}}addMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.avoidMembers.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),this.drawBubbleSets()}updateMember(t){this.options.members=tx(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){let e=Array.isArray(t)?t:[t];e.some(t=>this.options.members.includes(t))&&(this.options.members=this.options.members.filter(t=>!e.includes(t))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){let e=Array.isArray(t)?t:[t];this.options.avoidMembers.some(t=>e.includes(t))&&(this.options.avoidMembers=this.options.avoidMembers.filter(t=>!e.includes(t)),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(M.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(M.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}constructor(t,e){super(t,ts({},rl.defaultOptions,e)),this.members=new Map,this.avoidMembers=new Map,this.bubbleSetOptions={},this.drawBubbleSets=()=>{let{style:t,bubbleSetOptions:e}=this.parseOptions();V(this.bubbleSetOptions,e)||this.init(),this.bubbleSetOptions={...e};let n={...t,d:this.getPath()};this.shape?this.shape.update(n):(this.shape=new eU({style:n}),this.context.canvas.appendChild(this.shape))},this.updateBubbleSetsPath=t=>{if(!this.shape)return;let e=tl(t.data);[...this.options.members,...this.options.avoidMembers].includes(e)&&this.shape.update({...this.parseOptions().style,d:this.getPath(e)})},this.getPath=t=>{let{graph:e}=this.context,n=this.options.members,i=[...this.members.keys()],r=this.options.avoidMembers,a=[...this.avoidMembers.keys()];if(!t&&V(n,i)&&V(r,a))return this.path;let{enter:o=[],exit:s=[]}=ty(i,n,t=>t),{enter:l=[],exit:h=[]}=ty(a,r,t=>t);t&&(s.push(t),o.push(t));let c=(t,n,i)=>{t.forEach(t=>{let r=i?this.members:this.avoidMembers;if(n){let n;"edge"===e.getElementType(t)?([n]=rc(e,t),this.bubbleSets.pushEdge(n)):([n]=rh(e,t),this.bubbleSets[i?"pushMember":"pushNonMember"](n)),r.set(t,n)}else{let n=r.get(t);n&&("edge"===e.getElementType(t)?this.bubbleSets.removeEdge(n):this.bubbleSets[i?"removeMember":"removeNonMember"](n),r.delete(t))}})};c(s,!1,!0),c(o,!0,!0),c(h,!1,!1),c(l,!0,!1);let u=this.bubbleSets.compute(),d=u.sample(8).simplify(0).bSplines().simplify(0);return this.path=eZ(d.points.map(tJ)),this.path},this.bindEvents(),this.bubbleSets=new rs(this.options)}}rl.defaultOptions={members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2,...rr};let rh=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getElementRenderBounds(e);return new i2(n.min[0],n.min[1],tM(n),tR(n))})},rc=(t,e)=>{let n=Array.isArray(e)?e:[e];return n.map(e=>{let n=t.getEdgeData(e),i=t.getElementPosition(n.source),r=t.getElementPosition(n.target);return iX.from({x1:i[0],y1:i[1],x2:r[0],y2:r[1]})})};class ru extends iZ{initElement(){this.$element=iW("contextmenu",!1);let{className:t}=this.options;t&&this.$element.classList.add(t);let e=this.context.canvas.getContainer();e.appendChild(this.$element),iV("g6-contextmenu-css","style",{},"\n  .g6-contextmenu {\n    font-size: 12px;\n    background-color: rgba(255, 255, 255, 0.96);\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;\n    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;\n  }\n\n  .g6-contextmenu-ul {\n    max-width: 256px;\n    min-width: 96px;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n\n  .g6-contextmenu-li {\n    padding: 8px 12px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .g6-contextmenu-li:hover {\n    background-color: #f5f5f5;\n    cursor: pointer;\n  }\n",document.head)}async show(t){let{enable:e,offset:n}=this.options;if("function"==typeof e&&!e(t)||!e){this.hide();return}let i=await this.getDOMContent(t);i instanceof HTMLElement?(this.$element.innerHTML="",this.$element.appendChild(i)):this.$element.innerHTML=i;let r=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left="".concat(t.client.x-r.left+n[0],"px"),this.$element.style.top="".concat(t.client.y-r.top+n[1],"px"),this.$element.style.display="block",this.targetElement=t.target}hide(){this.$element.style.display="none",this.targetElement=null}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}async getDOMContent(t){let{getContent:e,getItems:n}=this.options;if(n){var i;return i=await n(t),'\n    <ul class="g6-contextmenu-ul">\n      '.concat(i.map(t=>'<li  class="g6-contextmenu-li" value="'.concat(t.value,'">').concat(t.name,"</li>")).join(""),"\n    </ul>\n  ")}return await e(t)}bindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.on("canvas:".concat(e),this.onTriggerEvent),t.on("node:".concat(e),this.onTriggerEvent),t.on("edge:".concat(e),this.onTriggerEvent),t.on("combo:".concat(e),this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){let{graph:t}=this.context,{trigger:e}=this.options;t.off("canvas:".concat(e),this.onTriggerEvent),t.off("node:".concat(e),this.onTriggerEvent),t.off("edge:".concat(e),this.onTriggerEvent),t.off("combo:".concat(e),this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}constructor(t,e){super(t,Object.assign({},ru.defaultOptions,e)),this.targetElement=null,this.onTriggerEvent=t=>{var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.show(t)},this.onMenuItemClick=t=>{let{onClick:e,trigger:n}=this.options;if(t.target instanceof HTMLElement&&t.target.className.includes("g6-contextmenu-li")){let n=t.target.getAttribute("value");null==e||e(n,t.target,this.targetElement),this.hide()}"click"!==n&&this.hide()},this.initElement(),this.update(e)}}ru.defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};let rd={fill:"#fff",fillOpacity:1,lineWidth:1,stroke:"#000",strokeOpacity:.8};class rp extends iZ{get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}getElementStyle(t,e){let n="node"===t?this.options.nodeStyle:this.options.edgeStyle;return"function"==typeof n?n(e):n}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){let{graph:t}=this.context,{trigger:e,scaleRByWheel:n}=this.options,i=t.getCanvas().getLayer();if(["click","drag"].includes(e)&&i.addEventListener(w.CLICK,this.onEdgeFilter),"pointermove"===e?i.addEventListener(w.POINTER_MOVE,this.onEdgeFilter):"drag"===e&&(i.addEventListener(w.DRAG_START,this.onDragStart),i.addEventListener(w.DRAG,this.onDrag),i.addEventListener(w.DRAG_END,this.onDragEnd)),n){var r;null===(r=this.graphDom)||void 0===r||r.addEventListener(w.WHEEL,this.scaleRByWheel,{passive:!1})}}unbindEvents(){let{graph:t}=this.context,{trigger:e,scaleRByWheel:n}=this.options,i=t.getCanvas().getLayer();if(["click","drag"].includes(e)&&i.removeEventListener(w.CLICK,this.onEdgeFilter),"pointermove"===e?i.removeEventListener(w.POINTER_MOVE,this.onEdgeFilter):"drag"===e&&(i.removeEventListener(w.DRAG_START,this.onDragStart),i.removeEventListener(w.DRAG,this.onDrag),i.removeEventListener(w.DRAG_END,this.onDragEnd)),n){var r;null===(r=this.graphDom)||void 0===r||r.removeEventListener(w.WHEEL,this.scaleRByWheel)}}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),this.isLensOn&&this.lens.destroy(),this.shapes.forEach((t,e)=>{t.destroy(),this.shapes.delete(e)}),super.destroy()}constructor(t,e){super(t,Object.assign({},rp.defaultOptions,e)),this.shapes=new Map,this.r=this.options.r,this.onEdgeFilter=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;let e=tJ(t.canvas);this.renderLens(e),this.renderFocusElements()},this.renderLens=t=>{let[e,n]=t,i={size:2*this.r,x:e,y:n};if(this.isLensOn)this.lens.update(i);else{let t=Object.assign({},rd,this.options.style,i);this.lens=new e2({style:t})}this.canvas.appendChild(this.lens)},this.getFilterData=()=>{let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:r,combos:a}=n;return{nodes:i.filter(e=>t(tl(e),"node")),edges:r.filter(e=>t(tl(e),"edge")),combos:a.filter(e=>t(tl(e),"combo"))}},this.getFocusElements=t=>{let{nodes:e,edges:n}=this.getFilterData(),i=e.filter(e=>tG(tq(e),t)<this.r),r=i.map(t=>tl(t)),a=n.filter(t=>{let{source:e,target:n}=t,i=r.includes(e),a=r.includes(n);switch(this.options.nodeType){case"both":return i&&a;case"either":return i!==a;case"source":return i&&!a;case"target":return!i&&a;default:return!1}});return{nodes:i,edges:a}},this.renderFocusElements=()=>{let{element:t,graph:e}=this.context;if(!this.isLensOn)return;let n=this.lens.getCenter(),{nodes:i,edges:r}=this.getFocusElements(n),a=new Set,{nodeStyle:o,edgeStyle:s}=this.options,l=n=>{let i=tl(n);a.add(i);let r=t.getElement(i);if(!r)return;let o=this.shapes.get(i)||r.cloneNode();o.setPosition(r.getPosition()),o.id=r.id,this.shapes.has(i)?Object.entries(r.attributes).forEach(t=>{let[e,n]=t;o.style[e]!==n&&(o.style[e]=n)}):(this.canvas.appendChild(o),this.shapes.set(i,o));let s=e.getElementType(i),l=this.getElementStyle(s,n);o.update(l)};i.forEach(l),r.forEach(l),this.shapes.forEach((t,e)=>{a.has(e)||(t.destroy(),this.shapes.delete(e))})},this.scaleRByWheel=t=>{var e;this.options.preventDefault&&t.preventDefault();let{clientX:n,clientY:i,deltaX:r,deltaY:a}=t,{graph:o,canvas:s}=this.context,l=o.getCanvasByClient([n,i]),h=null===(e=this.lens)||void 0===e?void 0:e.getCenter();if(!this.isLensOn||tG(l,h)>this.r)return;let{maxR:c,minR:u}=this.options,d=Math.min(...s.getSize())/2;this.r=Math.max(u||0,Math.min(c||d,this.r*(r+a>0?1/.95:.95))),this.renderLens(h),this.renderFocusElements()},this.isLensDragging=!1,this.onDragStart=t=>{var e;let n=tJ(t.canvas),i=null===(e=this.lens)||void 0===e?void 0:e.getCenter();!this.isLensOn||tG(n,i)>this.r||(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;let e=tJ(t.canvas);this.renderLens(e),this.renderFocusElements()},this.onDragEnd=()=>{this.isLensDragging=!1},this.bindEvents()}}rp.defaultOptions={trigger:"pointermove",r:60,nodeType:"both",filter:()=>!0,style:{lineWidth:2},nodeStyle:{label:!1},edgeStyle:{label:!0},scaleRByWheel:!0,preventDefault:!0};class rf extends iZ{bindEvents(){this.unbindEvents(),this.shortcut.unbindAll();let{request:t=[],exit:e=[]}=this.options.trigger;this.shortcut.bind(t,this.request),this.shortcut.bind(e,this.exit),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.addEventListener(t,this.onFullscreenChange,!1)})}unbindEvents(){this.shortcut.unbindAll(),["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach(t=>{document.removeEventListener(t,this.onFullscreenChange,!1)})}setGraphSize(){let t,e,n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];n?(t=window.screen.width,e=window.screen.height,this.graphSize=this.context.graph.getSize()):[t,e]=this.graphSize,this.context.graph.setSize(t,e),this.context.graph.render()}request(){!document.fullscreenElement&&(document.fullscreenEnabled||Reflect.get(document,"webkitFullscreenEnabled")||Reflect.get(document,"mozFullscreenEnabled")||Reflect.get(document,"msFullscreenEnabled"))&&this.$el.requestFullscreen().catch(t=>{J.warn("Error attempting to enable full-screen: ".concat(t.message," (").concat(t.name,")"))})}exit(){document.fullscreenElement&&document.exitFullscreen()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.exit(),this.style.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},rf.defaultOptions,e)),this.$el=this.context.canvas.getContainer(),this.graphSize=[0,0],this.onFullscreenChange=()=>{var t,e,n,i;let r=!!document.fullscreenElement;this.options.autoFit&&this.setGraphSize(r),r?null===(e=(t=this.options).onEnter)||void 0===e||e.call(t):null===(i=(n=this.options).onExit)||void 0===i||i.call(n)},this.shortcut=new t7(t.graph),this.bindEvents(),this.style=document.createElement("style"),document.head.appendChild(this.style),this.style.innerHTML="\n      :not(:root):fullscreen::backdrop {\n        background: transparent;\n      }\n    "}}rf.defaultOptions={trigger:{},autoFit:!0};class rg extends iZ{update(t){super.update(t),this.updateStyle()}bindEvents(){let{graph:t}=this.context;t.on(M.AFTER_TRANSFORM,this.onTransform)}updateStyle(){let{size:t,stroke:e,lineWidth:n,border:i,borderLineWidth:r,borderStroke:a,borderStyle:o}=this.options;Object.assign(this.$element.style,{border:i?"".concat(r,"px ").concat(o," ").concat(a):"none",backgroundImage:"linear-gradient(".concat(e," ").concat(n,"px, transparent ").concat(n,"px), linear-gradient(90deg, ").concat(e," ").concat(n,"px, transparent ").concat(n,"px)"),backgroundSize:"".concat(t,"px ").concat(t,"px")})}updateOffset(t){var e,n;this.offset=(e=tB(this.offset,t),n=this.options.size,e.map(t=>t%n)),this.$element.style.backgroundPosition="".concat(this.offset[0],"px ").concat(this.offset[1],"px")}destroy(){this.context.graph.off(M.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},rg.defaultOptions,e)),this.$element=iW("grid-line"),this.offset=[0,0],this.onTransform=t=>{if(!this.options.follow)return;let{data:{translate:e}}=t;e&&this.updateOffset(e)};let n=this.context.canvas.getContainer();!function(t,e){let n=t.firstChild;n?t.insertBefore(e,n):t.appendChild(e)}(n,this.$element),this.updateStyle(),this.bindEvents()}}rg.defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};var ry=n(90494);function rm(t){let e={Added:new Map,Updated:new Map,Removed:new Map};return t.forEach(t=>{let{type:n,value:i}=t,r=tl(i);if("NodeAdded"===n||"EdgeAdded"===n||"ComboAdded"===n)e.Added.set(r,t);else if("NodeUpdated"===n||"EdgeUpdated"===n||"ComboUpdated"===n){if(e.Added.has(r))e.Added.set(r,{type:n.replace("Updated","Added"),value:i});else if(e.Updated.has(r)){let{original:t}=e.Updated.get(r);e.Updated.set(r,{type:n,value:i,original:t})}else e.Removed.has(r)||e.Updated.set(r,t)}else("NodeRemoved"===n||"EdgeRemoved"===n||"ComboRemoved"===n)&&(e.Added.has(r)?e.Added.delete(r):(e.Updated.has(r)&&e.Updated.delete(r),e.Removed.set(r,t)))}),[...Array.from(e.Added.values()),...Array.from(e.Updated.values()),...Array.from(e.Removed.values())]}function rv(t){let{NodeAdded:e=[],NodeUpdated:n=[],NodeRemoved:i=[],EdgeAdded:r=[],EdgeUpdated:a=[],EdgeRemoved:o=[],ComboAdded:s=[],ComboUpdated:l=[],ComboRemoved:h=[]}=eA(t,t=>t.type);return{add:{nodes:e,edges:r,combos:s},update:{nodes:n,edges:a,combos:l},remove:{nodes:i,edges:o,combos:h}}}class rb extends iZ{canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){let t=this.undoStack.pop();if(t){var e,n,i,r;this.executeCommand(t);let a=null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!1);if(!1===a)return;this.redoStack.push(t),null===(r=(i=this.options).afterAddCommand)||void 0===r||r.call(i,t,!1),this.notify(R.UNDO,t)}return this}redo(){let t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(R.REDO,t)),this}undoAndCancel(){let t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(R.CANCEL,t)),this}undoStackPush(t){var e,n,i,r;let{stackSize:a}=this.options;0!==a&&this.undoStack.length>=a&&this.undoStack.shift();let o=null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!0);!1!==o&&(this.undoStack.push(t),null===(r=(i=this.options).afterAddCommand)||void 0===r||r.call(i,t,!0))}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(R.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(R.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){let{graph:t}=this.context;t.off(M.AFTER_DRAW,this.addCommand),t.off(M.BATCH_START,this.initBatchCommand),t.off(M.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}constructor(t,e){var n;super(t,Object.assign({},rb.defaultOptions,e)),n=this,this.batchChanges=null,this.batchAnimation=!1,this.undoStack=[],this.redoStack=[],this.freezed=!1,this.executeCommand=function(t){var e,i,r;let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];n.freezed=!0,null===(i=(e=n.options).executeCommand)||void 0===i||i.call(e,t);let o=a?t.original:t.current;n.context.graph.addData(o.add),n.context.graph.updateData(o.update),n.context.graph.removeData(th(o.remove,!1)),null===(r=n.context.element)||void 0===r||r.draw({silence:!0,animation:t.animation}),n.freezed=!1},this.addCommand=t=>{if(!this.freezed){if(t.type===M.AFTER_DRAW){var e;let{dataChanges:n=[],animation:i=!0}=t.data;if(null===(e=this.context.batch)||void 0===e?void 0:e.isBatching){if(!this.batchChanges)return;this.batchChanges.push(n),this.batchAnimation&&(this.batchAnimation=i);return}this.batchChanges=[n],this.batchAnimation=i}this.undoStackPush(function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,i={animation:e,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:r,update:a,remove:o}=rv(rm(t));return["nodes","edges","combos"].forEach(t=>{a[t]&&a[t].forEach(e=>{var r,a;let o={...e.value},s={...e.original};if(n){let t=n.graph.getElementType(tl(e.original)),i="edge"===t?"stroke":"fill",r=n.element.getElementComputedStyle(t,e.original);s={...e.original,style:{[i]:r[i],...e.original.style}}}(function t(e,n){for(let i in e)Z(e[i])&&!Array.isArray(e[i])&&null!==e[i]?(n[i]||(n[i]={}),t(e[i],n[i])):void 0===n[i]&&(n[i]=ti(i))})(o,s),(r=i.current.update)[t]||(r[t]=[]),i.current.update[t].push(o),(a=i.original.update)[t]||(a[t]=[]),i.original.update[t].push(s)}),r[t]&&r[t].forEach(e=>{var n,r;let a={...e.value};(n=i.current.add)[t]||(n[t]=[]),i.current.add[t].push(a),(r=i.original.remove)[t]||(r[t]=[]),i.original.remove[t].push(a)}),o[t]&&o[t].forEach(e=>{var n,r;let a={...e.value};(n=i.current.remove)[t]||(n[t]=[]),i.current.remove[t].push(a),(r=i.original.add)[t]||(r[t]=[]),i.original.add[t].push(a)})}),i}(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(R.ADD,this.undoStack[this.undoStack.length-1])}},this.initBatchCommand=t=>{let{initiate:e}=t.data;if(this.batchAnimation=!1,e)this.batchChanges=[];else{let t=this.undoStack.pop();t||(this.batchChanges=null)}},this.emitter=new ry.Z;let{graph:i}=this.context;i.on(M.AFTER_DRAW,this.addCommand),i.on(M.BATCH_START,this.initBatchCommand),i.on(M.BATCH_END,this.addCommand)}}rb.defaultOptions={stackSize:0};var rx=n(1344),rE=n.n(rx);let rw=(t,e,n)=>{if("sharp"===n)return[["M",t[0]-e,t[1]-e],["L",t[0]+e,t[1]-e],["L",t[0]+e,t[1]+e],["L",t[0]-e,t[1]+e],["Z"]];let i=[e,e,0,0,0];return[["M",t[0],t[1]-e],["A",...i,t[0],t[1]+e],["A",...i,t[0],t[1]-e]]},rC=(t,e,n)=>{let i=[e,e,0,0,0],r="sharp"===n?tB(t[0],tz(tW(t_(t[0],t[1])),e)):t[0],a="sharp"===n?tB(t[1],tz(tW(t_(t[1],t[0])),e)):t[1],o=tz(tW(tZ(t_(r,a),!1)),e),s=tz(o,-1),l=tB(r,o),h=tB(a,o),c=tB(a,s),u=tB(r,s);return"sharp"===n?[["M",l[0],l[1]],["L",h[0],h[1]],["L",c[0],c[1]],["L",u[0],u[1]],["Z"]]:[["M",l[0],l[1]],["L",h[0],h[1]],["A",...i,c[0],c[1]],["L",u[0],u[1]],["A",...i,l[0],l[1]]]},rS=(t,e)=>{let n=t8(t).map((n,i)=>{let r=(i-2+t.length)%t.length,a=(i-1+t.length)%t.length,o=(i+1)%t.length,s=t[r],l=t[a],h=t[o],c=t_(s,l),u=t_(l,n),d=t_(n,h),p=(t,e)=>tV(t,e,!0)<Math.PI,f=p(c,u),g=p(u,d),y=t=>tz(tW(tZ(t,!1)),e),m=y(u);return[{p:tU(f?tB(l,y(c)):tB(l,m)),concave:f&&l},{p:tU(g?tB(n,y(d)):tB(n,m)),concave:g&&n}]}),i=[e,e,0,0,0],r=n.findIndex((t,e)=>!n[(e-1+n.length)%n.length][0].concave&&!n[(e-1+n.length)%n.length][1].concave&&!t[0].concave&&!t[0].concave&&!t[1].concave),a=n.slice(r).concat(n.slice(0,r)),o=[];return a.flatMap((t,e)=>{let r=[],s=a[n.length-1];return 0===e&&r.push(["M",...s[1].p]),t[0].concave?o.push(t[0].p,t[1].p):r.push(["A",...i,...t[0].p]),t[1].concave?o.unshift(t[1].p):r.push(["L",...t[1].p]),3===o.length&&(r.pop(),r.push(["C",...o.flat()]),o=[]),r})},rM=(t,e)=>{let n=t8(t).map((e,n)=>{let i=t[(n+1)%t.length];return{p:e,v:tW(t_(i,e))}});return n.forEach((i,r)=>{let a=r>0?r-1:t.length-1,o=n[a].v,s=tW(tB(o,tz(i.v,tV(o,i.v,!0)<Math.PI?1:-1)));i.p=tB(i.p,tz(s,e))}),eZ(n.map(t=>t.p))},rR=(t,e)=>{let n=t.map((n,i)=>{let r=t[0===i?t.length-1:i-1],a=tY(tz(tW(tZ(t_(r,n),!1)),e));return[tB(r,a),tB(n,a)]}),i=n.flat(),r=i.map((t,e)=>{if(e%2==0)return null;let n=[i[(e-1)%i.length],i[e%i.length]],r=[i[(e+1)%i.length],i[(e+2)%i.length]];return t$(n,r,!0)}).filter(Boolean);return r.map((t,e)=>[0===e?"M":"L",t[0],t[1]]).concat([["Z"]])};class rO extends iZ{bindEvents(){this.context.graph.on(M.AFTER_RENDER,this.drawHull),this.context.graph.on(M.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){let{members:e,padding:n,corner:i,...r}=this.options;return{...r,d:this.getHullPath(t)}}getPadding(){let{graph:t}=this.context,e=this.hullMemberIds.reduce((e,n)=>{let{halfExtents:i}=t.getElementRenderBounds(n),r=Math.max(i[0],i[1]);return Math.max(e,r)},0);return e+this.options.padding}addMember(t){let e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){let e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter(t=>!e.includes(t)),e.some(t=>this.hullMemberIds.includes(t))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=tx(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(M.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}constructor(t,e){var n;super(t,Object.assign({},rO.defaultOptions,e)),n=this,this.hullMemberIds=[],this.drawHull=()=>{if(this.shape){let t=!V(this.optionsCache,this.options);this.shape.update(this.getHullStyle(t))}else this.shape=new eU({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);this.optionsCache={...this.options}},this.updateHullPath=t=>{this.shape&&this.options.members.includes(tl(t.data))&&this.shape.update({d:this.getHullPath(!0)})},this.getHullPath=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{graph:e}=n.context,i=n.getMember();if(0===i.length)return"";let r=i.map(t=>e.getNodeData(t)),a=rE()(r.map(tq),n.options.concavity).slice(1).reverse(),o=a.flatMap(t=>r.filter(e=>V(tq(e),t)).map(tl));return V(o,n.hullMemberIds)&&!t||(n.hullMemberIds=o,n.path=function(t,e,n){if(1===t.length)return rw(t[0],e,n);if(2===t.length)return rC(t,e,n);switch(n){case"smooth":return rM(t,e);case"sharp":return rR(t,e);default:return rS(t,e)}}(a,n.getPadding(),n.options.corner)),n.path},this.bindEvents()}}rO.defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};var rA=n(97582),rT=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=n,this.height=i}return Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t.prototype.toJSON=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,top:this.top,right:this.right,bottom:this.bottom,left:this.left}},t.prototype.isPointIn=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},t}();function rk(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,a=0;a<t.length;a++){var o=t[a],s=o.x,l=o.y,h=o.width,c=o.height,u=(0,rA.CR)([s+h,l+c],2),d=u[0],p=u[1];s<e&&(e=s),l<n&&(n=l),d>i&&(i=d),p>r&&(r=p)}return new rT(e,n,i-e,r-n)}var rP=function(t,e,n){var i=t.width,r=t.height,a=n.flexDirection,o=void 0===a?"row":a,s=(n.flexWrap,n.justifyContent),l=void 0===s?"flex-start":s,h=(n.alignContent,n.alignItems),c=void 0===h?"flex-start":h,u="row"===o,d="row"===o||"column"===o,p=u?d?[1,0]:[-1,0]:d?[0,1]:[0,-1],f=(0,rA.CR)([0,0],2),g=f[0],y=f[1],m=e.map(function(t){var e,n=t.width,i=t.height,r=(0,rA.CR)([g,y],2),a=r[0],o=r[1];return g=(e=(0,rA.CR)([g+n*p[0],y+i*p[1]],2))[0],y=e[1],new rT(a,o,n,i)}),v=rk(m),b={"flex-start":0,"flex-end":u?i-v.width:r-v.height,center:u?(i-v.width)/2:(r-v.height)/2},x=m.map(function(t){var e=t.x,n=t.y,i=rT.fromRect(t);return i.x=u?e+b[l]:e,i.y=u?n:n+b[l],i});rk(x);var E=function(t){var e=(0,rA.CR)(u?["height",r]:["width",i],2),n=e[0],a=e[1];switch(c){case"flex-start":default:return 0;case"flex-end":return a-t[n];case"center":return a/2-t[n]/2}};return x.map(function(t){var e=t.x,n=t.y,i=rT.fromRect(t);return i.x=u?e:e+E(i),i.y=u?n+E(i):n,i}).map(function(e){var n,i,r=rT.fromRect(e);return r.x+=null!==(n=t.x)&&void 0!==n?n:0,r.y+=null!==(i=t.y)&&void 0!==i?i:0,r})},rL=function(t,e,n){return[]},rD=function(t,e,n){if(0===e.length)return[];var i={flex:rP,grid:rL},r=n.display in i?i[n.display]:null;return(null==r?void 0:r.call(null,t,e,n))||[]};function rN(t){if(ec(t))return[t,t,t,t];if(ta(t)){var e=t.length;if(1===e)return[t[0],t[0],t[0],t[0]];if(2===e)return[t[0],t[1],t[0],t[1]];if(3===e)return[t[0],t[1],t[2],t[1]];if(4===e)return t}return[0,0,0,0]}var rI=function(t){function e(e){var n=t.call(this,e)||this;n.layoutEvents=[I.Dk.BOUNDS_CHANGED,I.Dk.INSERTED,I.Dk.REMOVED],n.$margin=rN(0),n.$padding=rN(0);var i=e.style||{},r=i.margin,a=i.padding;return n.margin=void 0===r?0:r,n.padding=void 0===a?0:a,n.isMutationObserved=!0,n.bindEvents(),n}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"margin",{get:function(){return this.$margin},set:function(t){this.$margin=rN(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this.$padding},set:function(t){this.$padding=rN(t)},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var t=this.attributes,e=t.x,n=void 0===e?0:e,i=t.y,r=void 0===i?0:i,a=t.width,o=t.height,s=(0,rA.CR)(this.$margin,4),l=s[0],h=s[1],c=s[2],u=s[3];return new rT(n-u,r-l,a+u+h,o+l+c)},e.prototype.appendChild=function(e,n){return e.isMutationObserved=!0,t.prototype.appendChild.call(this,e,n),e},e.prototype.getAvailableSpace=function(){var t=this.attributes,e=t.width,n=t.height,i=(0,rA.CR)(this.$padding,4),r=i[0],a=i[1],o=i[2],s=i[3],l=(0,rA.CR)(this.$margin,4),h=l[0],c=l[3];return new rT(s+c,r+h,e-s-a,n-r-o)},e.prototype.layout=function(){if(this.attributes.display&&this.isConnected&&!this.children.some(function(t){return!t.isConnected}))try{var t=this.attributes,e=t.x,n=t.y;this.style.transform="translate(".concat(e,", ").concat(n,")");var i=rD(this.getAvailableSpace(),this.children.map(function(t){return t.getBBox()}),this.attributes);this.children.forEach(function(t,e){var n=i[e],r=n.x,a=n.y;t.style.transform="translate(".concat(r,", ").concat(a,")")})}catch(t){}},e.prototype.bindEvents=function(){var t=this;this.layoutEvents.forEach(function(e){t.addEventListener(e,function(e){e.target.isMutationObserved=!0,t.layout()})})},e.prototype.attributeChangedCallback=function(t,e,n){"margin"===t?this.margin=n:"padding"===t&&(this.padding=n),this.layout()},e}(I.ZA);function rB(t){rF(t,!0)}function r_(t){rF(t,!1)}function rF(t,e){var n=e?"visible":"hidden";!function t(e,n){n(e),e.children&&e.children.forEach(function(e){e&&t(e,n)})}(t,function(t){t.attr("visibility",n)})}var rj=function(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=5),Object.entries(e).forEach(function(r){var a=(0,rA.CR)(r,2),o=a[0],s=a[1];Object.prototype.hasOwnProperty.call(e,o)&&(s?to(s)?(to(t[o])||(t[o]={}),n<i?rj(t[o],s,n+1,i):t[o]=e[o]):ta(s)?(t[o]=[],t[o]=t[o].concat(s)):t[o]=s:t[o]=s)})},rz=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i+=1)rj(t,e[i]);return t},rG=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.apply(this,(0,rA.ev)([],(0,rA.CR)(e),!1))||this;return i.isMutationObserved=!0,i.addEventListener(I.Dk.INSERTED,function(){r_(i)}),i}return(0,rA.ZT)(e,t),e}(I.ZA);function rH(t){var e=t.appendChild(new rG({class:"offscreen"}));return r_(e),e}function rW(){rF(this,"hidden"!==this.attributes.visibility)}var rV=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,rz({},{style:n},e))||this;return i.initialized=!1,i._defaultOptions=n,i}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=rH(this)),this._offscreen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultOptions",{get:function(){return this._defaultOptions},enumerable:!1,configurable:!0}),e.prototype.connectedCallback=function(){this.render(this.attributes,this),this.bindEvents(this.attributes,this),this.initialized=!0},e.prototype.disconnectedCallback=function(){var t;null===(t=this._offscreen)||void 0===t||t.destroy()},e.prototype.attributeChangedCallback=function(t){"visibility"===t&&rW.call(this)},e.prototype.update=function(t,e){var n;return this.attr(rz({},this.attributes,t||{})),null===(n=this.render)||void 0===n?void 0:n.call(this,this.attributes,this,e)},e.prototype.clear=function(){this.removeChildren()},e.prototype.bindEvents=function(t,e){},e.prototype.getSubShapeStyle=function(t){return t.x,t.y,t.transform,t.transformOrigin,t.class,t.className,t.zIndex,(0,rA._T)(t,["x","y","transform","transformOrigin","class","className","zIndex"])},e}(I.b_);function rZ(t){return t.toString().charAt(0).toUpperCase()+t.toString().slice(1)}function rU(t,e,n){void 0===n&&(n=!0);var i,r=e||(null===(i=t.match(/^([a-z][a-z0-9]+)/))||void 0===i?void 0:i[0])||"",a=t.replace(new RegExp("^(".concat(r,")")),"");return n?a.toString().charAt(0).toLowerCase()+a.toString().slice(1):a}var rY=function(t,e){if(!(null==t?void 0:t.startsWith(e)))return!1;var n=t[e.length];return n>="A"&&n<="Z"};function rK(t,e,n){void 0===n&&(n=!1);var i={};return Object.entries(t).forEach(function(t){var r=(0,rA.CR)(t,2),a=r[0],o=r[1];if("className"===a||"class"===a);else if(rY(a,"show")&&rY(rU(a,"show"),e)!==n)a==="".concat("show").concat(rZ(e))?i[a]=o:i[a.replace(new RegExp(rZ(e)),"")]=o;else if(!rY(a,"show")&&rY(a,e)!==n){var s=rU(a,e);"filter"===s&&"function"==typeof o||(i[s]=o)}}),i}function r$(t,e){return Object.entries(t).reduce(function(t,n){var i=(0,rA.CR)(n,2),r=i[0],a=i[1];return r.startsWith("show")?t["show".concat(e).concat(r.slice(4))]=a:t["".concat(e).concat(rZ(r))]=a,t},{})}function rX(t,e){void 0===e&&(e=["x","y","class","className"]);var n=["transform","transformOrigin","anchor","visibility","pointerEvents","zIndex","cursor","clipPath","clipPathTargets","offsetPath","offsetPathTargets","offsetDistance","draggable","droppable"],i={},r={};return Object.entries(t).forEach(function(t){var a=(0,rA.CR)(t,2),o=a[0],s=a[1];e.includes(o)||(-1!==n.indexOf(o)?r[o]=s:i[o]=s)}),[i,r]}var rq=function(t){function e(e){void 0===e&&(e={});var n=e.style,i=(0,rA._T)(e,["style"]);return t.call(this,(0,rA.pi)({style:(0,rA.pi)({text:"",fill:"black",fontFamily:"sans-serif",fontSize:16,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineWidth:1,textAlign:"start",textBaseline:"middle"},n)},i))||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"offscreenGroup",{get:function(){return this._offscreen||(this._offscreen=rH(this)),this._offscreen},enumerable:!1,configurable:!0}),e.prototype.disconnectedCallback=function(){var t;null===(t=this._offscreen)||void 0===t||t.destroy()},e}(I.xv),rQ=function(){var t,e,n;function i(e,n,i,r,a,o,s){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=[null,null,null,null,null]),void 0===o&&(o=[]),void 0===s&&(s=[]),t.add(this),this._elements=Array.from(e),this._data=n,this._parent=i,this._document=r,this._enter=a[0],this._update=a[1],this._exit=a[2],this._merge=a[3],this._split=a[4],this._transitions=o,this._facetElements=s}return i.prototype.selectAll=function(t){var n="string"==typeof t?this._parent.querySelectorAll(t):t;return new e(n,null,this._elements[0],this._document)},i.prototype.selectFacetAll=function(t){var n="string"==typeof t?this._parent.querySelectorAll(t):t;return new e(this._elements,null,this._parent,this._document,void 0,void 0,n)},i.prototype.select=function(t){var n="string"==typeof t?this._parent.querySelectorAll(t)[0]||null:t;return new e([n],null,n,this._document)},i.prototype.append=function(t){var n=this,i="function"==typeof t?t:function(){return n.createElement(t)},r=[];if(null!==this._data){for(var a=0;a<this._data.length;a++){var o=this._data[a],s=(0,rA.CR)(Array.isArray(o)?o:[o,null],2),l=s[0],h=s[1],c=i(l,a);c.__data__=l,null!==h&&(c.__fromElements__=h),this._parent.appendChild(c),r.push(c)}return new e(r,null,this._parent,this._document)}for(var a=0;a<this._elements.length;a++){var u=this._elements[a],l=u.__data__,c=i(l,a);u.appendChild(c),r.push(c)}return new e(r,null,r[0],this._document)},i.prototype.maybeAppend=function(e,i){var r=(0,rA.Q_)(this,t,"m",n).call(this,"#"===e[0]?e:"#".concat(e),i);return r.attr("id",e),r},i.prototype.maybeAppendByClassName=function(e,i){var r=e.toString(),a=(0,rA.Q_)(this,t,"m",n).call(this,"."===r[0]?r:".".concat(r),i);return a.attr("className",r),a},i.prototype.maybeAppendByName=function(e,i){var r=(0,rA.Q_)(this,t,"m",n).call(this,'[name="'.concat(e,'"]'),i);return r.attr("name",e),r},i.prototype.data=function(t,n,i){void 0===n&&(n=function(t){return t}),void 0===i&&(i=function(){return null});for(var r,a,o,s,l=[],h=[],c=new Set(this._elements),u=[],d=new Set,p=new Map(this._elements.map(function(t,e){return[n(t.__data__,e),t]})),f=new Map(this._facetElements.map(function(t,e){return[n(t.__data__,e),t]})),g=(r=this._elements,a=new Map,r.forEach(function(t){var e=i(t.__data__);a.has(e)||a.set(e,[]),a.get(e).push(t)}),a),y=0;y<t.length;y++){var m=t[y],v=n(m,y),b=i(m,y);if(p.has(v)){var x=p.get(v);x.__data__=m,x.__facet__=!1,h.push(x),c.delete(x),p.delete(v)}else if(f.has(v)){var x=f.get(v);x.__data__=m,x.__facet__=!0,h.push(x),f.delete(v)}else if(g.has(v)){var E=g.get(v);u.push([m,E]);try{for(var w=(o=void 0,(0,rA.XA)(E)),C=w.next();!C.done;C=w.next()){var x=C.value;c.delete(x)}}catch(t){o={error:t}}finally{try{C&&!C.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}g.delete(v)}else if(p.has(b)){var x=p.get(b);x.__toData__?x.__toData__.push(m):x.__toData__=[m],d.add(x),c.delete(x)}else l.push(m)}var S=[new e([],l,this._parent,this._document),new e(h,null,this._parent,this._document),new e(c,null,this._parent,this._document),new e([],u,this._parent,this._document),new e(d,null,this._parent,this._document)];return new e(this._elements,null,this._parent,this._document,S)},i.prototype.merge=function(t){var n=(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(this._elements),!1),(0,rA.CR)(t._elements),!1),i=(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(this._transitions),!1),(0,rA.CR)(t._transitions),!1);return new e(n,null,this._parent,this._document,void 0,i)},i.prototype.createElement=function(t){if(this._document)return this._document.createElement(t,{});var n=e.registry[t];return n?new n:function(t){throw Error(t)}("Unknown node type: ".concat(t))},i.prototype.join=function(t,e,n,i,r){void 0===t&&(t=function(t){return t}),void 0===e&&(e=function(t){return t}),void 0===n&&(n=function(t){return t.remove()}),void 0===i&&(i=function(t){return t}),void 0===r&&(r=function(t){return t.remove()});var a=t(this._enter),o=e(this._update),s=n(this._exit),l=i(this._merge),h=r(this._split);return o.merge(a).merge(s).merge(l).merge(h)},i.prototype.remove=function(){for(var t=this,n=0;n<this._elements.length;n++)!function(e){var n=t._elements[e],i=t._transitions[e];i?i.then(function(){return n.remove()}):n.remove()}(n);return new e([],null,this._parent,this._document,void 0,this._transitions)},i.prototype.each=function(t){for(var e=0;e<this._elements.length;e++){var n=this._elements[e],i=n.__data__;t.call(n,i,e)}return this},i.prototype.attr=function(t,e){var n="function"!=typeof e?function(){return e}:e;return this.each(function(i,r){void 0!==e&&(this[t]=n.call(this,i,r))})},i.prototype.style=function(t,e,n){void 0===n&&(n=!0);var i="function"==typeof e&&n?e:function(){return e};return this.each(function(n,r){void 0!==e&&(this.style[t]=i.call(this,n,r))})},i.prototype.styles=function(t,e){return void 0===t&&(t={}),void 0===e&&(e=!0),this.each(function(n,i){var r=this;Object.entries(t).forEach(function(t){var a=(0,rA.CR)(t,2),o=a[0],s=a[1],l="function"==typeof s&&e?s:function(){return s};void 0!==s&&r.attr(o,l.call(r,n,i))})})},i.prototype.update=function(t,e){void 0===e&&(e=!0);var n="function"==typeof t&&e?t:function(){return t};return this.each(function(e,i){t&&this.update&&this.update(n.call(this,e,i))})},i.prototype.maybeUpdate=function(t,e){void 0===e&&(e=!0);var n="function"==typeof t&&e?t:function(){return t};return this.each(function(e,i){t&&this.update&&this.update(n.call(this,e,i))})},i.prototype.transition=function(t){var e=this._transitions;return this.each(function(n,i){e[i]=t.call(this,n,i)})},i.prototype.on=function(t,e){return this.each(function(){this.addEventListener(t,e)}),this},i.prototype.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.call.apply(t,(0,rA.ev)([this._parent,this],(0,rA.CR)(e),!1)),this},i.prototype.node=function(){return this._elements[0]},i.prototype.nodes=function(){return this._elements},i.prototype.transitions=function(){return this._transitions.filter(function(t){return!!t})},i.prototype.parent=function(){return this._parent},e=i,t=new WeakSet,n=function(t,n){var i=this._elements[0],r=i.querySelector(t);if(r)return new e([r],null,this._parent,this._document);var a="string"==typeof n?this.createElement(n):n();return i.appendChild(a),new e([a],null,this._parent,this._document)},i.registry={g:I.ZA,rect:I.UL,circle:I.Cd,path:I.y$,text:rq,ellipse:I.Pj,image:I.Ee,line:I.x1,polygon:I.mg,polyline:I.aH,html:I.k9},i}();function rJ(t){return new rQ([t],null,t,t.ownerDocument)}var r0=function(t,e){var n=function(t){return"".concat(e,"-").concat(t)},i=Object.fromEntries(Object.entries(t).map(function(t){var e=(0,rA.CR)(t,2),i=e[0],r=n(e[1]);return[i,{name:r,class:".".concat(r),id:"#".concat(r),toString:function(){return r}}]}));return Object.assign(i,{prefix:n}),i};function r1(t,e,n,i,r){return(void 0===i&&(i=!0),void 0===r&&(r=function(t){t.node().removeChildren()}),t)?n(e):(i&&r(e),null)}var r2=r0({text:"text"},"title");function r3(t){return/\S+-\S+/g.test(t)?t.split("-").map(function(t){return t[0]}):t.length>2?[t[0]]:t.split("")}function r6(t,e){var n=Object.entries(e).reduce(function(e,n){var i=(0,rA.CR)(n,2),r=i[0],a=i[1];return t.node().attr(r)||(e[r]=a),e},{});t.styles(n)}var r4=function(t){function e(e){return t.call(this,e,{text:"",width:0,height:0,fill:"#4a505a",fontWeight:"bold",fontSize:12,fontFamily:"sans-serif",inset:0,spacing:0,position:"top-left"})||this}return(0,rA.ZT)(e,t),e.prototype.getAvailableSpace=function(){var t=this.attributes,e=t.width,n=t.height,i=t.position,r=t.spacing,a=t.inset,o=this.querySelector(r2.text.class);if(!o)return new rT(0,0,+e,+n);var s=o.getBBox(),l=s.width,h=s.height,c=(0,rA.CR)(rN(r),4),u=c[0],d=c[1],p=c[2],f=c[3],g=(0,rA.CR)([0,0,+e,+n],4),y=g[0],m=g[1],v=g[2],b=g[3],x=r3(i);if(x.includes("i"))return new rT(y,m,v,b);x.forEach(function(t,i){var r,a;"t"===t&&(m=(r=(0,rA.CR)(0===i?[h+p,+n-h-p]:[0,+n],2))[0],b=r[1]),"r"===t&&(v=(0,rA.CR)([+e-l-f],1)[0]),"b"===t&&(b=(0,rA.CR)([+n-h-u],1)[0]),"l"===t&&(y=(a=(0,rA.CR)(0===i?[l+d,+e-l-d]:[0,+e],2))[0],v=a[1])});var E=(0,rA.CR)(rN(a),4),w=E[0],C=E[1],S=E[2],M=E[3],R=(0,rA.CR)([M+C,w+S],2),O=R[0],A=R[1];return new rT(y+M,m+w,v-O,b-A)},e.prototype.getBBox=function(){return this.title?this.title.getBBox():new rT(0,0,0,0)},e.prototype.render=function(t,e){var n,i,r,a,o,s,l,h,c,u,d,p,f,g,y,m,v=this;t.width,t.height,t.position,t.spacing;var b=(0,rA._T)(t,["width","height","position","spacing"]),x=(0,rA.CR)(rX(b),1)[0],E=(o=t.width,s=t.height,l=t.position,c=(h=(0,rA.CR)([+o/2,+s/2],2))[0],u=h[1],p=(d=(0,rA.CR)([+c,+u,"center","middle"],4))[0],f=d[1],g=d[2],y=d[3],(m=r3(l)).includes("l")&&(p=(n=(0,rA.CR)([0,"start"],2))[0],g=n[1]),m.includes("r")&&(p=(i=(0,rA.CR)([+o,"end"],2))[0],g=i[1]),m.includes("t")&&(f=(r=(0,rA.CR)([0,"top"],2))[0],y=r[1]),m.includes("b")&&(f=(a=(0,rA.CR)([+s,"bottom"],2))[0],y=a[1]),{x:p,y:f,textAlign:g,textBaseline:y}),w=E.x,C=E.y,S=E.textAlign,M=E.textBaseline;r1(!!b.text,rJ(e),function(t){v.title=t.maybeAppendByClassName(r2.text,"text").styles(x).call(r6,{x:w,y:C,textAlign:S,textBaseline:M}).node()})},e}(rV),r8=function(){};function r9(t,e){return tx(t)?t.apply(void 0,(0,rA.ev)([],(0,rA.CR)(e),!1)):t}function r5(t){if(!t)return{enter:!1,update:!1,exit:!1};var e=["enter","update","exit"],n=Object.fromEntries(Object.entries(t).filter(function(t){var n=(0,rA.CR)(t,1)[0];return!e.includes(n)}));return Object.fromEntries(e.map(function(e){return"boolean"!=typeof t&&"enter"in t&&"update"in t&&"exit"in t?!1===t[e]?[e,!1]:[e,(0,rA.pi)((0,rA.pi)({},t[e]),n)]:[e,n]}))}function r7(t,e){t?t.finished.then(e):e()}function at(t,e){"update"in t?t.update(e):t.attr(e)}function ae(t,e,n){return 0===e.length?null:n?t.animate(e,n):(at(t,{style:e.slice(-1)[0]}),null)}function an(t,e,n){var i={},r={};return(Object.entries(e).forEach(function(e){var n=(0,rA.CR)(e,2),a=n[0],o=n[1];if(!B(o)){var s=t.style[a]||t.parsedStyle[a]||0;s!==o&&(i[a]=s,r[a]=o)}}),n)?ae(t,[i,r],(0,rA.pi)({fill:"both"},n)):(at(t,r),null)}function ai(t,e,n){void 0===n&&(n=!1);var i=t.getBBox(),r=e/Math.max(i.width,i.height);return n&&(t.style.transform="scale(".concat(r,")")),r}var ar=function(t,e,n){return[["M",t-n,e],["A",n,n,0,1,0,t+n,e],["A",n,n,0,1,0,t-n,e],["Z"]]},aa=function(t,e,n){return[["M",t,e+n],["L",t,e-n]]},ao=function(t,e,n){return[["M",t-n,e],["L",t+n,e]]},as=r0({prevBtnGroup:"prev-btn-group",prevBtn:"prev-btn",nextBtnGroup:"next-btn-group",nextBtn:"next-btn",pageInfoGroup:"page-info-group",pageInfo:"page-info",playWindow:"play-window",contentGroup:"content-group",controller:"controller",clipPath:"clip-path"},"navigator"),al=function(t){function e(e){var n=t.call(this,e,{x:0,y:0,animate:{easing:"linear",duration:200,fill:"both"},buttonCursor:"pointer",buttonFill:"black",buttonD:[["M",-6,-6],["L",6,0],["L",-6,6],["Z"]],buttonSize:12,controllerPadding:5,controllerSpacing:5,formatter:function(t,e){return"".concat(t,"/").concat(e)},defaultPage:0,loop:!1,orientation:"horizontal",pageNumFill:"black",pageNumFontSize:12,pageNumTextAlign:"start",pageNumTextBaseline:"middle"})||this;return n.playState="idle",n.contentGroup=n.appendChild(new I.ZA({class:as.contentGroup.name})),n.playWindow=n.contentGroup.appendChild(new I.ZA({class:as.playWindow.name})),n.innerCurrPage=n.defaultPage,n}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"defaultPage",{get:function(){return iC(this.attributes.defaultPage,0,Math.max(this.pageViews.length-1,0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageViews",{get:function(){return this.playWindow.children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"controllerShape",{get:function(){return this.totalPages>1?{width:55,height:0}:{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageShape",{get:function(){var t,e,n=this.pageViews,i=(0,rA.CR)(((null===(e=(t=n.map(function(t){var e=t.getBBox();return[e.width,e.height]}))[0])||void 0===e?void 0:e.map(function(e,n){return t.map(function(t){return t[n]})}))||[]).map(function(t){return Math.max.apply(Math,(0,rA.ev)([],(0,rA.CR)(t),!1))}),2),r=i[0],a=i[1],o=this.attributes,s=o.pageWidth,l=o.pageHeight;return{pageWidth:void 0===s?r:s,pageHeight:void 0===l?a:l}},enumerable:!1,configurable:!0}),e.prototype.getContainer=function(){return this.playWindow},Object.defineProperty(e.prototype,"totalPages",{get:function(){return this.pageViews.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currPage",{get:function(){return this.innerCurrPage},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var e=t.prototype.getBBox.call(this),n=e.x,i=e.y,r=this.controllerShape,a=this.pageShape,o=a.pageWidth,s=a.pageHeight;return new rT(n,i,o+r.width,s)},e.prototype.goTo=function(t){var e=this,n=this.attributes.animate,i=this.currPage,r=this.playState,a=this.playWindow,o=this.pageViews;if("idle"!==r||t<0||o.length<=0||t>=o.length)return null;o[i].setLocalPosition(0,0),this.prepareFollowingPage(t);var s=(0,rA.CR)(this.getFollowingPageDiff(t),2),l=s[0],h=s[1];this.playState="running";var c=ae(a,[{transform:"translate(0, 0)"},{transform:"translate(".concat(-l,", ").concat(-h,")")}],n);return r7(c,function(){e.innerCurrPage=t,e.playState="idle",e.setVisiblePages([t]),e.updatePageInfo()}),c},e.prototype.prev=function(){var t=this.attributes.loop,e=this.pageViews.length,n=this.currPage;if(!t&&n<=0)return null;var i=t?(n-1+e)%e:iC(n-1,0,e);return this.goTo(i)},e.prototype.next=function(){var t=this.attributes.loop,e=this.pageViews.length,n=this.currPage;if(!t&&n>=e-1)return null;var i=t?(n+1)%e:iC(n+1,0,e);return this.goTo(i)},e.prototype.renderClipPath=function(t){var e=this.pageShape,n=e.pageWidth,i=e.pageHeight;if(!n||!i){this.contentGroup.style.clipPath=void 0;return}this.clipPath=t.maybeAppendByClassName(as.clipPath,"rect").styles({width:n,height:i}),this.contentGroup.attr("clipPath",this.clipPath.node())},e.prototype.setVisiblePages=function(t){this.playWindow.children.forEach(function(e,n){t.includes(n)?rB(e):r_(e)})},e.prototype.adjustControllerLayout=function(){var t=this.prevBtnGroup,e=this.nextBtnGroup,n=this.pageInfoGroup,i=this.attributes,r=i.orientation,a=i.controllerPadding,o=n.getBBox(),s=o.width;o.height;var l=(0,rA.CR)("horizontal"===r?[-180,0]:[-90,90],2),h=l[0],c=l[1];t.setLocalEulerAngles(h),e.setLocalEulerAngles(c);var u=t.getBBox(),d=u.width,p=u.height,f=e.getBBox(),g=f.width,y=f.height,m=Math.max(d,s,g),v="horizontal"===r?{offset:[[0,0],[d/2+a,0],[d+s+2*a,0]],textAlign:"start"}:{offset:[[m/2,-p-a],[m/2,0],[m/2,y+a]],textAlign:"center"},b=(0,rA.CR)(v.offset,3),x=(0,rA.CR)(b[0],2),E=x[0],w=x[1],C=(0,rA.CR)(b[1],2),S=C[0],M=C[1],R=(0,rA.CR)(b[2],2),O=R[0],A=R[1],T=v.textAlign,k=n.querySelector("text");k&&(k.style.textAlign=T),t.setLocalPosition(E,w),n.setLocalPosition(S,M),e.setLocalPosition(O,A)},e.prototype.updatePageInfo=function(){var t,e=this.currPage,n=this.pageViews,i=this.attributes.formatter;n.length<2||(null===(t=this.pageInfoGroup.querySelector(as.pageInfo.class))||void 0===t||t.attr("text",i(e+1,n.length)),this.adjustControllerLayout())},e.prototype.getFollowingPageDiff=function(t){var e=this.currPage;if(e===t)return[0,0];var n=this.attributes.orientation,i=this.pageShape,r=i.pageWidth,a=i.pageHeight,o=t<e?-1:1;return"horizontal"===n?[o*r,0]:[0,o*a]},e.prototype.prepareFollowingPage=function(t){var e=this.currPage,n=this.pageViews;if(this.setVisiblePages([t,e]),t!==e){var i=(0,rA.CR)(this.getFollowingPageDiff(t),2),r=i[0],a=i[1];n[t].setLocalPosition(r,a)}},e.prototype.renderController=function(t){var e=this,n=this.attributes.controllerSpacing,i=this.pageShape,r=i.pageWidth,a=i.pageHeight,o=this.pageViews.length>=2,s=t.maybeAppendByClassName(as.controller,"g");if(rF(s.node(),o),o){var l=rK(this.attributes,"button"),h=rK(this.attributes,"pageNum"),c=(0,rA.CR)(rX(l),2),u=c[0],d=c[1],p=u.size,f=(0,rA._T)(u,["size"]),g=!s.select(as.prevBtnGroup.class).node(),y=s.maybeAppendByClassName(as.prevBtnGroup,"g").styles(d);this.prevBtnGroup=y.node();var m=y.maybeAppendByClassName(as.prevBtn,"path"),v=s.maybeAppendByClassName(as.nextBtnGroup,"g").styles(d);this.nextBtnGroup=v.node(),[m,v.maybeAppendByClassName(as.nextBtn,"path")].forEach(function(t){t.styles((0,rA.pi)((0,rA.pi)({},f),{transformOrigin:"center"})),ai(t.node(),p,!0)});var b=s.maybeAppendByClassName(as.pageInfoGroup,"g");this.pageInfoGroup=b.node(),b.maybeAppendByClassName(as.pageInfo,"text").styles(h),this.updatePageInfo(),s.node().setLocalPosition(r+n,a/2),g&&(this.prevBtnGroup.addEventListener("click",function(){e.prev()}),this.nextBtnGroup.addEventListener("click",function(){e.next()}))}},e.prototype.render=function(t,e){var n=t.x,i=t.y,r=void 0===i?0:i;this.attr("transform","translate(".concat(void 0===n?0:n,", ").concat(r,")"));var a=rJ(e);this.renderClipPath(a),this.renderController(a),this.setVisiblePages([this.defaultPage]),this.goTo(this.defaultPage)},e.prototype.bindEvents=function(){var t=this,e=ih(function(){return t.render(t.attributes,t)},50);this.playWindow.addEventListener(I.Dk.INSERTED,e),this.playWindow.addEventListener(I.Dk.REMOVED,e)},e}(rV),ah=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),e.prototype.render=function(t,n){var i,r=t.x,a=void 0===r?0:r,o=t.y,s=void 0===o?0:o,l=this.getSubShapeStyle(t),h=l.symbol,c=l.size,u=void 0===c?16:c,d=(0,rA._T)(l,["symbol","size"]),p=["base64","url","image"].includes(i=function(t){var e="default";if(Z(t)&&t instanceof Image)e="image";else if(tx(t))e="symbol";else if(W(t)){var n=RegExp("data:(image|text)");e=t.match(n)?"base64":/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(t)?"url":"symbol"}return e}(h))?"image":h&&"symbol"===i?"path":null;r1(!!p,rJ(n),function(t){t.maybeAppendByClassName("marker",p).attr("className","marker ".concat(p,"-marker")).call(function(t){if("image"===p){var n=2*u;t.styles({img:h,width:n,height:n,x:a-u,y:s-u})}else{var n=u/2,i=tx(h)?h:e.getSymbol(h);t.styles((0,rA.pi)({d:null==i?void 0:i(a,s,n)},d))}})})},e.MARKER_SYMBOL_MAP=new Map,e.registerSymbol=function(t,n){e.MARKER_SYMBOL_MAP.set(t,n)},e.getSymbol=function(t){return e.MARKER_SYMBOL_MAP.get(t)},e.getSymbols=function(){return Array.from(e.MARKER_SYMBOL_MAP.keys())},e}(rV);function ac(t,e,n){return void 0===t&&(t="horizontal"),"horizontal"===t?e:n}function au(t){var e=t.getLocalBounds(),n=e.min,i=e.max,r=(0,rA.CR)([n,i],2),a=(0,rA.CR)(r[0],2),o=a[0],s=a[1],l=(0,rA.CR)(r[1],2),h=l[0],c=l[1];return{x:o,y:s,width:h-o,height:c-s,left:o,bottom:c,top:s,right:h}}function ad(t,e){var n=(0,rA.CR)(t,2),i=n[0],r=n[1],a=(0,rA.CR)(e,2),o=a[0],s=a[1];return i!==o&&r===s}function ap(t){return"function"==typeof t?t():W(t)||ec(t)?new rq({style:{text:String(t)}}):t}ah.registerSymbol("cross",function(t,e,n){return[["M",t-n,e-n],["L",t+n,e+n],["M",t+n,e-n],["L",t-n,e+n]]}),ah.registerSymbol("hyphen",function(t,e,n){return[["M",t-n,e],["L",t+n,e]]}),ah.registerSymbol("line",aa),ah.registerSymbol("plus",function(t,e,n){return[["M",t-n,e],["L",t+n,e],["M",t,e-n],["L",t,e+n]]}),ah.registerSymbol("tick",function(t,e,n){return[["M",t-n/2,e-n],["L",t+n/2,e-n],["M",t,e-n],["L",t,e+n],["M",t-n/2,e+n],["L",t+n/2,e+n]]}),ah.registerSymbol("circle",ar),ah.registerSymbol("point",ar),ah.registerSymbol("bowtie",function(t,e,n){var i=n-1.5;return[["M",t-n,e-i],["L",t+n,e+i],["L",t+n,e-i],["L",t-n,e+i],["Z"]]}),ah.registerSymbol("hexagon",function(t,e,n){var i=n/2*Math.sqrt(3);return[["M",t,e-n],["L",t+i,e-n/2],["L",t+i,e+n/2],["L",t,e+n],["L",t-i,e+n/2],["L",t-i,e-n/2],["Z"]]}),ah.registerSymbol("square",function(t,e,n){return[["M",t-n,e-n],["L",t+n,e-n],["L",t+n,e+n],["L",t-n,e+n],["Z"]]}),ah.registerSymbol("diamond",function(t,e,n){return[["M",t-n,e],["L",t,e-n],["L",t+n,e],["L",t,e+n],["Z"]]}),ah.registerSymbol("triangle",function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e+i],["L",t,e-i],["L",t+n,e+i],["Z"]]}),ah.registerSymbol("triangle-down",function(t,e,n){var i=n*Math.sin(1/3*Math.PI);return[["M",t-n,e-i],["L",t+n,e-i],["L",t,e+i],["Z"]]}),ah.registerSymbol("line",aa),ah.registerSymbol("dot",ao),ah.registerSymbol("dash",ao),ah.registerSymbol("smooth",function(t,e,n){return[["M",t-n,e],["A",n/2,n/2,0,1,1,t,e],["A",n/2,n/2,0,1,0,t+n,e]]}),ah.registerSymbol("hv",function(t,e,n){return[["M",t-n-1,e-2.5],["L",t,e-2.5],["L",t,e+2.5],["L",t+n+1,e+2.5]]}),ah.registerSymbol("vh",function(t,e,n){return[["M",t-n-1,e+2.5],["L",t,e+2.5],["L",t,e-2.5],["L",t+n+1,e-2.5]]}),ah.registerSymbol("hvh",function(t,e,n){return[["M",t-(n+1),e+2.5],["L",t-n/2,e+2.5],["L",t-n/2,e-2.5],["L",t+n/2,e-2.5],["L",t+n/2,e+2.5],["L",t+n+1,e+2.5]]}),ah.registerSymbol("vhv",function(t,e){return[["M",t-5,e+2.5],["L",t-5,e],["L",t,e],["L",t,e-3],["L",t,e+3],["L",t+6.5,e+3]]}),ah.registerSymbol("hiddenHandle",function(t,e,n){var i=1.4*n;return[["M",t-n,e-i],["L",t+n,e-i],["L",t+n,e+i],["L",t-n,e+i],["Z"]]}),ah.registerSymbol("verticalHandle",function(t,e,n){var i=1.4*n,r=n/2,a=n/6,o=t+.4*i;return[["M",t,e],["L",o,e+r],["L",t+i,e+r],["L",t+i,e-r],["L",o,e-r],["Z"],["M",o,e+a],["L",t+i-2,e+a],["M",o,e-a],["L",t+i-2,e-a]]}),ah.registerSymbol("horizontalHandle",function(t,e,n){var i=1.4*n,r=n/2,a=n/6,o=e+.4*i;return[["M",t,e],["L",t-r,o],["L",t-r,e+i],["L",t+r,e+i],["L",t+r,o],["Z"],["M",t-a,o],["L",t-a,e+i-2],["M",t+a,o],["L",t+a,e+i-2]]});var af=function(t,e,n){if(void 0===n&&(n=128),!tx(t))throw TypeError("Expected a function");var i=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var a=e?e.apply(this,n):n[0],o=i.cache;if(o.has(a))return o.get(a);var s=t.apply(this,n);return o.set(a,s),s};return i.cache=function(t){var e,n,i,r=t||1;function a(t,a){++e>r&&(i=n,o(1),++e),n[t]=a}function o(t){e=0,n=Object.create(null),t||(i=Object.create(null))}return o(),{clear:o,has:function(t){return void 0!==n[t]||void 0!==i[t]},get:function(t){var e=n[t];return void 0!==e?e:void 0!==(e=i[t])?(a(t,e),e):void 0},set:function(t,e){void 0!==n[t]?n[t]=e:a(t,e)}}}(n),i}(function(t,e){var n=e.fontSize,i=e.fontFamily,r=e.fontWeight,a=e.fontStyle,o=e.fontVariant;return D?D(t,n):(L||(L=I.GZ.offscreenCanvasCreator.getOrCreateContext(void 0)),L.font=[a,o,r,"".concat(n,"px"),i].join(" "),L.measureText(t).width)},function(t,e){return[t,Object.values(e||ag(t)).join()].join("")},4096),ag=function(t){var e=t.style.fontFamily||"sans-serif",n=t.style.fontWeight||"normal",i=t.style.fontStyle||"normal",r=t.style.fontVariant,a=t.style.fontSize;return{fontSize:a="object"==typeof a?a.value:a,fontFamily:e,fontWeight:n,fontStyle:i,fontVariant:r}};function ay(t){return"text"===t.nodeName?t:"g"===t.nodeName&&1===t.children.length&&"text"===t.children[0].nodeName?t.children[0]:null}function am(t,e){var n=ay(t);n&&n.attr(e)}function av(t,e,n){void 0===n&&(n="..."),am(t,{wordWrap:!0,wordWrapWidth:e,maxLines:1,textOverflow:n})}var ab=r0({layout:"flex",markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label",valueGroup:"value-group",value:"value",backgroundGroup:"background-group",background:"background"},"legend-category-item"),ax=function(t){function e(e){return t.call(this,e,{span:[1,1],marker:function(){return new I.Cd({style:{r:6}})},markerSize:10,labelFill:"#646464",valueFill:"#646464",labelFontSize:12,valueFontSize:12,labelTextBaseline:"middle",valueTextBaseline:"middle"})||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"showValue",{get:function(){var t=this.attributes.valueText;return!!t&&("string"==typeof t||"number"==typeof t?""!==t:"function"==typeof t||""!==t.attr("text"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actualSpace",{get:function(){var t=this.labelGroup,e=this.valueGroup,n=this.attributes.markerSize,i=t.node().getBBox(),r=i.width,a=i.height,o=e.node().getBBox();return{markerWidth:n,labelWidth:r,valueWidth:o.width,height:Math.max(n,a,o.height)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"span",{get:function(){var t=this.attributes.span;if(!t)return[1,1];var e=(0,rA.CR)(rN(t),2),n=e[0],i=e[1],r=this.showValue?i:0,a=n+r;return[n/a,r/a]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shape",{get:function(){var t,e=this.attributes,n=e.markerSize,i=e.width,r=this.actualSpace,a=r.markerWidth,o=r.height,s=this.actualSpace,l=s.labelWidth,h=s.valueWidth,c=(0,rA.CR)(this.spacing,2),u=c[0],d=c[1];if(i){var p=i-n-u-d,f=(0,rA.CR)(this.span,2),g=f[0],y=f[1];l=(t=(0,rA.CR)([g*p,y*p],2))[0],h=t[1]}return{width:a+l+h+u+d,height:o,markerWidth:a,labelWidth:l,valueWidth:h}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacing",{get:function(){var t=this.attributes.spacing;if(!t)return[0,0];var e=(0,rA.CR)(rN(t),2),n=e[0],i=e[1];return this.showValue?[n,i]:[n,0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){var t=this.shape,e=t.markerWidth,n=t.labelWidth,i=t.valueWidth,r=t.width,a=t.height,o=(0,rA.CR)(this.spacing,2),s=o[0];return{height:a,width:r,markerWidth:e,labelWidth:n,valueWidth:i,position:[e/2,e+s,e+n+s+o[1]]}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleSize",{get:function(){var t,e=(t=this.markerGroup.node().querySelector(ab.marker.class))?t.style:{},n=this.attributes,i=n.markerSize,r=n.markerStrokeWidth,a=void 0===r?e.strokeWidth:r,o=n.markerLineWidth,s=void 0===o?e.lineWidth:o,l=n.markerStroke,h=void 0===l?e.stroke:l,c=+(a||s||(h?1:0))*Math.sqrt(2),u=this.markerGroup.node().getBBox();return(1-c/Math.max(u.width,u.height))*i},enumerable:!1,configurable:!0}),e.prototype.renderMarker=function(t){var e=this,n=this.attributes.marker,i=rK(this.attributes,"marker");this.markerGroup=t.maybeAppendByClassName(ab.markerGroup,"g").style("zIndex",0),r1(!!n,this.markerGroup,function(){var t,r=e.markerGroup.node(),a=null===(t=r.childNodes)||void 0===t?void 0:t[0],o="string"==typeof n?new ah({style:{symbol:n},className:ab.marker.name}):n();a?o.nodeName===a.nodeName?a instanceof ah?a.update((0,rA.pi)((0,rA.pi)({},i),{symbol:n})):(function(t,e){var n,i,r=e.attributes;try{for(var a=(0,rA.XA)(Object.entries(r)),o=a.next();!o.done;o=a.next()){var s=(0,rA.CR)(o.value,2),l=s[0],h=s[1];"id"!==l&&"className"!==l&&t.attr(l,h)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}(a,o),rJ(a).styles(i)):(a.remove(),rJ(o).attr("className",ab.marker.name).styles(i),r.appendChild(o)):(o instanceof ah||rJ(o).attr("className",ab.marker.name).styles(i),r.appendChild(o)),e.markerGroup.node().scale(1/e.markerGroup.node().getScale()[0]);var s=ai(e.markerGroup.node(),e.scaleSize,!0);e.markerGroup.node().style._transform="scale(".concat(s,")")})},e.prototype.renderLabel=function(t){var e=rK(this.attributes,"label"),n=e.text,i=(0,rA._T)(e,["text"]);this.labelGroup=t.maybeAppendByClassName(ab.labelGroup,"g").style("zIndex",0),this.labelGroup.maybeAppendByClassName(ab.label,function(){return ap(n)}).styles(i)},e.prototype.renderValue=function(t){var e=this,n=rK(this.attributes,"value"),i=n.text,r=(0,rA._T)(n,["text"]);this.valueGroup=t.maybeAppendByClassName(ab.valueGroup,"g").style("zIndex",0),r1(this.showValue,this.valueGroup,function(){e.valueGroup.maybeAppendByClassName(ab.value,function(){return ap(i)}).styles(r)})},e.prototype.renderBackground=function(t){var e=this.shape,n=e.width,i=e.height,r=rK(this.attributes,"background");this.background=t.maybeAppendByClassName(ab.backgroundGroup,"g").style("zIndex",-1),this.background.maybeAppendByClassName(ab.background,"rect").styles((0,rA.pi)({width:n,height:i},r))},e.prototype.adjustLayout=function(){var t=this.layout,e=t.labelWidth,n=t.valueWidth,i=t.height,r=(0,rA.CR)(t.position,3),a=r[0],o=r[1],s=r[2],l=i/2;this.markerGroup.styles({transform:"translate(".concat(a,", ").concat(l,")").concat(this.markerGroup.node().style._transform)}),this.labelGroup.styles({transform:"translate(".concat(o,", ").concat(l,")")}),av(this.labelGroup.select(ab.label.class).node(),Math.ceil(e)),this.showValue&&(this.valueGroup.styles({transform:"translate(".concat(s,", ").concat(l,")")}),av(this.valueGroup.select(ab.value.class).node(),Math.ceil(n)))},e.prototype.render=function(t,e){var n=rJ(e),i=t.x,r=t.y,a=void 0===r?0:r;n.styles({transform:"translate(".concat(void 0===i?0:i,", ").concat(a,")")}),this.renderMarker(n),this.renderLabel(n),this.renderValue(n),this.renderBackground(n),this.adjustLayout()},e}(rV),aE=r0({page:"item-page",navigator:"navigator",item:"item"},"items"),aw=function(t,e,n){return(void 0===n&&(n=!0),t)?e(t):n},aC=function(t){function e(e){var n=t.call(this,e,{data:[],gridRow:1/0,gridCol:void 0,padding:0,width:1e3,height:100,rowPadding:0,colPadding:0,layout:"flex",orientation:"horizontal",click:r8,mouseenter:r8,mouseleave:r8})||this;return n.navigatorShape=[0,0],n}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"pageViews",{get:function(){return this.navigator.getContainer()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){var t=this.attributes,e=t.gridRow,n=t.gridCol,i=t.data;if(!e&&!n)throw Error("gridRow and gridCol can not be set null at the same time");return e&&n?[e,n]:e?[e,i.length]:[i.length,n]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderData",{get:function(){var t=this.attributes,e=t.data,n=t.layout,i=rK(this.attributes,"item");return e.map(function(t,r){var a=t.id,o=void 0===a?r:a,s=t.label,l=t.value;return{id:"".concat(o),index:r,style:(0,rA.pi)({layout:n,labelText:s,valueText:l},Object.fromEntries(Object.entries(i).map(function(n){var i=(0,rA.CR)(n,2);return[i[0],r9(i[1],[t,r,e])]})))}})},enumerable:!1,configurable:!0}),e.prototype.getGridLayout=function(){var t=this,e=this.attributes,n=e.orientation,i=e.width,r=e.rowPadding,a=e.colPadding,o=(0,rA.CR)(this.navigatorShape,1)[0],s=(0,rA.CR)(this.grid,2),l=s[0],h=s[1],c=h*l,u=0;return this.pageViews.children.map(function(e,s){var d,p,f=Math.floor(s/c),g=s%c,y=t.ifHorizontal(h,l),m=[Math.floor(g/y),g%y];"vertical"===n&&m.reverse();var v=(0,rA.CR)(m,2),b=v[0],x=v[1],E=(i-o-(h-1)*a)/h,w=e.getBBox().height,C=(0,rA.CR)([0,0],2),S=C[0],M=C[1];return"horizontal"===n?(S=(d=(0,rA.CR)([u,b*(w+r)],2))[0],M=d[1],u=x===h-1?0:u+E+a):(S=(p=(0,rA.CR)([x*(E+a),u],2))[0],M=p[1],u=b===l-1?0:u+w+r),{page:f,index:s,row:b,col:x,pageIndex:g,width:E,height:w,x:S,y:M}})},e.prototype.getFlexLayout=function(){var t=this.attributes,e=t.width,n=t.height,i=t.rowPadding,r=t.colPadding,a=(0,rA.CR)(this.navigatorShape,1)[0],o=(0,rA.CR)(this.grid,2),s=o[0],l=o[1],h=(0,rA.CR)([e-a,n],2),c=h[0],u=h[1],d=(0,rA.CR)([0,0,0,0,0,0,0,0],8),p=d[0],f=d[1],g=d[2],y=d[3],m=d[4],v=d[5],b=d[6],x=d[7];return this.pageViews.children.map(function(t,e){var n,a,o,h,d=t.getBBox(),E=d.width,w=d.height,C=0===b?0:r,S=b+C+E;return S<=c&&aw(m,function(t){return t<l})?(p=(n=(0,rA.CR)([b+C,x,S],3))[0],f=n[1],b=n[2],{width:E,height:w,x:p,y:f,page:g,index:e,pageIndex:y++,row:v,col:m++}):(v=(a=(0,rA.CR)([v+1,0,0,x+w+i],4))[0],m=a[1],b=a[2],(x=a[3])+w<=u&&aw(v,function(t){return t<s}))?(p=(o=(0,rA.CR)([b,x,E],3))[0],f=o[1],b=o[2],{width:E,height:w,x:p,y:f,page:g,index:e,pageIndex:y++,row:v,col:m++}):(p=(h=(0,rA.CR)([0,0,E,0,g+1,0,0,0],8))[0],f=h[1],b=h[2],x=h[3],g=h[4],y=h[5],v=h[6],m=h[7],{width:E,height:w,x:p,y:f,page:g,index:e,pageIndex:y++,row:v,col:m++})})},Object.defineProperty(e.prototype,"itemsLayout",{get:function(){this.navigatorShape=[0,0];var t="grid"===this.attributes.layout?this.getGridLayout:this.getFlexLayout,e=t.call(this);return e.slice(-1)[0].page>0?(this.navigatorShape=[55,0],t.call(this)):e},enumerable:!1,configurable:!0}),e.prototype.ifHorizontal=function(t,e){return ac(this.attributes.orientation,t,e)},e.prototype.flattenPage=function(t){t.querySelectorAll(aE.item.class).forEach(function(e){t.appendChild(e)}),t.querySelectorAll(aE.page.class).forEach(function(e){t.removeChild(e).destroy()})},e.prototype.renderItems=function(t){var e=this.attributes,n=e.click,i=e.mouseenter,r=e.mouseleave;this.flattenPage(t);var a=this.dispatchCustomEvent.bind(this);rJ(t).selectAll(aE.item.class).data(this.renderData,function(t){return t.id}).join(function(t){return t.append(function(t){var e=t.style;return new ax({style:e})}).attr("className",aE.item.name).on("click",function(){null==n||n(this),a("itemClick",{item:this})}).on("pointerenter",function(){null==i||i(this),a("itemMouseenter",{item:this})}).on("pointerleave",function(){null==r||r(this),a("itemMouseleave",{item:this})})},function(t){return t.each(function(t){var e=t.style;this.update(e)})},function(t){return t.remove()})},e.prototype.relayoutNavigator=function(){var t,e=this.attributes,n=e.layout,i=e.width,r=(null===(t=this.pageViews.children[0])||void 0===t?void 0:t.getBBox().height)||0,a=(0,rA.CR)(this.navigatorShape,2),o=a[0],s=a[1];this.navigator.update("grid"===n?{pageWidth:i-o,pageHeight:r-s}:{})},e.prototype.adjustLayout=function(){var t,e,n=this,i=Object.entries((t=this.itemsLayout,e="page",t.reduce(function(t,n){return(t[n[e]]=t[n[e]]||[]).push(n),t},{}))).map(function(t){var e=(0,rA.CR)(t,2);return{page:e[0],layouts:e[1]}}),r=(0,rA.ev)([],(0,rA.CR)(this.navigator.getContainer().children),!1);i.forEach(function(t){var e=t.layouts,i=n.pageViews.appendChild(new I.ZA({className:aE.page.name}));e.forEach(function(t){var e=t.x,n=t.y,a=t.index,o=t.width,s=t.height,l=r[a];i.appendChild(l),eu(l,"__layout__",t),l.update({x:e,y:n,width:o,height:s})})}),this.relayoutNavigator()},e.prototype.renderNavigator=function(t){var e=rz({orientation:this.attributes.orientation},rK(this.attributes,"nav")),n=this;return t.selectAll(aE.navigator.class).data(["nav"]).join(function(t){return t.append(function(){return new al({style:e})}).attr("className",aE.navigator.name).each(function(){n.navigator=this})},function(t){return t.each(function(){this.update(e)})},function(t){return t.remove()}),this.navigator},e.prototype.getBBox=function(){return this.navigator.getBBox()},e.prototype.render=function(t,e){var n=this.attributes.data;if(n&&0!==n.length){var i=this.renderNavigator(rJ(e));this.renderItems(i.getContainer()),this.adjustLayout()}},e.prototype.dispatchCustomEvent=function(t,e){var n=new I.Aw(t,{detail:e});this.dispatchEvent(n)},e}(rV),aS=r0({markerGroup:"marker-group",marker:"marker",labelGroup:"label-group",label:"label"},"handle"),aM={showLabel:!0,formatter:function(t){return t.toString()},markerSize:25,markerStroke:"#c5c5c5",markerFill:"#fff",markerLineWidth:1,labelFontSize:12,labelFill:"#c5c5c5",labelText:"",orientation:"vertical",spacing:0};!function(t){function e(e){return t.call(this,e,aM)||this}(0,rA.ZT)(e,t),e.prototype.render=function(t,e){var n=rJ(e).maybeAppendByClassName(aS.markerGroup,"g");this.renderMarker(n);var i=rJ(e).maybeAppendByClassName(aS.labelGroup,"g");this.renderLabel(i)},e.prototype.renderMarker=function(t){var e=this,n=this.attributes,i=n.orientation,r=n.markerSymbol,a=void 0===r?ac(i,"horizontalHandle","verticalHandle"):r;r1(!!a,t,function(t){var n=rK(e.attributes,"marker"),i=(0,rA.pi)({symbol:a},n);e.marker=t.maybeAppendByClassName(aS.marker,function(){return new ah({style:i})}).update(i)})},e.prototype.renderLabel=function(t){var e=this,n=this.attributes,i=n.showLabel,r=n.orientation,a=n.spacing,o=void 0===a?0:a,s=n.formatter;r1(i,t,function(t){var n,i=rK(e.attributes,"label"),a=i.text,l=(0,rA._T)(i,["text"]),h=(null===(n=t.select(aS.marker.class))||void 0===n?void 0:n.node().getBBox())||{},c=h.width,u=h.height,d=(0,rA.CR)(ac(r,[0,(void 0===u?0:u)+o,"center","top"],[(void 0===c?0:c)+o,0,"start","middle"]),4),p=d[0],f=d[1],g=d[2],y=d[3];t.maybeAppendByClassName(aS.label,"text").styles((0,rA.pi)((0,rA.pi)({},l),{x:p,y:f,text:s(a).toString(),textAlign:g,textBaseline:y}))})}}(rV);var aR={showTitle:!0,padding:0,orientation:"horizontal",backgroundFill:"transparent",titleText:"",titleSpacing:4,titlePosition:"top-left",titleFill:"#2C3542",titleFontWeight:"bold",titleFontFamily:"sans-serif",titleFontSize:12},aO=rz({},aR,{});rz({},aR,r$(aM,"handle"),{color:["#d0e3fa","#acc7f6","#8daaf2","#6d8eea","#4d73cd","#325bb1","#5a3e75","#8c3c79","#e23455","#e7655b"],indicatorBackgroundFill:"#262626",indicatorLabelFill:"white",indicatorLabelFontSize:12,indicatorVisibility:"hidden",labelAlign:"value",labelDirection:"positive",labelSpacing:5,showHandle:!0,showIndicator:!0,showLabel:!0,slidable:!0,titleText:"",type:"continuous"});var aA=r0({title:"title",titleGroup:"title-group",items:"items",itemsGroup:"items-group",contentGroup:"content-group",ribbonGroup:"ribbon-group",ribbon:"ribbon",handlesGroup:"handles-group",handle:"handle",startHandle:"start-handle",endHandle:"end-handle",labelGroup:"label-group",label:"label",indicator:"indicator"},"legend"),aT=function(t){function e(e){return t.call(this,e,aO)||this}return(0,rA.ZT)(e,t),e.prototype.renderTitle=function(t,e,n){var i=this.attributes,r=i.showTitle,a=i.titleText,o=rK(this.attributes,"title"),s=(0,rA.CR)(rX(o),2),l=s[0],h=s[1];this.titleGroup=t.maybeAppendByClassName(aA.titleGroup,"g").styles(h);var c=(0,rA.pi)((0,rA.pi)({width:e,height:n},l),{text:r?a:""});this.title=this.titleGroup.maybeAppendByClassName(aA.title,function(){return new r4({style:c})}).update(c)},e.prototype.renderItems=function(t,e){var n=e.x,i=e.y,r=e.width,a=e.height,o=rK(this.attributes,"title",!0),s=(0,rA.CR)(rX(o),2),l=s[0],h=s[1],c=(0,rA.pi)((0,rA.pi)({},l),{width:r,height:a,x:0,y:0});this.itemsGroup=t.maybeAppendByClassName(aA.itemsGroup,"g").styles((0,rA.pi)((0,rA.pi)({},h),{transform:"translate(".concat(n,", ").concat(i,")")}));var u=this;this.itemsGroup.selectAll(aA.items.class).data(["items"]).join(function(t){return t.append(function(){return new aC({style:c})}).attr("className",aA.items.name).each(function(){u.items=rJ(this)})},function(t){return t.update(c)},function(t){return t.remove()})},e.prototype.adjustLayout=function(){if(this.attributes.showTitle){var t=this.title.node().getAvailableSpace(),e=t.x,n=t.y;this.itemsGroup.node().style.transform="translate(".concat(e,", ").concat(n,")")}},Object.defineProperty(e.prototype,"availableSpace",{get:function(){var t=this.attributes,e=t.showTitle,n=t.width,i=t.height;return e?this.title.node().getAvailableSpace():new rT(0,0,n,i)},enumerable:!1,configurable:!0}),e.prototype.getBBox=function(){var e,n,i=null===(e=this.title)||void 0===e?void 0:e.node(),r=null===(n=this.items)||void 0===n?void 0:n.node();return i&&r?function(t,e){var n=t.attributes,i=n.position,r=n.spacing,a=n.inset,o=n.text,s=t.getBBox(),l=e.getBBox(),h=r3(i),c=(0,rA.CR)(rN(o?r:0),4),u=c[0],d=c[1],p=c[2],f=c[3],g=(0,rA.CR)(rN(a),4),y=g[0],m=g[1],v=g[2],b=g[3],x=(0,rA.CR)([f+d,u+p],2),E=x[0],w=x[1],C=(0,rA.CR)([b+m,y+v],2),S=C[0],M=C[1];if("l"===h[0])return new rT(s.x,s.y,l.width+s.width+E+S,Math.max(l.height+M,s.height));if("t"===h[0])return new rT(s.x,s.y,Math.max(l.width+S,s.width),l.height+s.height+w+M);var R=(0,rA.CR)([e.attributes.width||l.width,e.attributes.height||l.height],2),O=R[0],A=R[1];return new rT(l.x,l.y,O+s.width+E+S,A+s.height+w+M)}(i,r):t.prototype.getBBox.call(this)},e.prototype.render=function(t,e){var n=this.attributes,i=n.width,r=n.height,a=n.x,o=n.y,s=void 0===o?0:o,l=rJ(e);e.style.transform="translate(".concat(void 0===a?0:a,", ").concat(s,")"),this.renderTitle(l,i,r),this.renderItems(l,this.availableSpace),this.adjustLayout()},e}(rV);class ak extends iZ{update(t){super.update(t),this.clear(),this.createElement()}clear(){var t;null===(t=this.element)||void 0===t||t.destroy(),this.element=null,this.draw=!1}updateElement(){if(!this.element)return;let t=this.element.getChildByIndex(0);t.update({itemMarkerOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5},itemLabelOpacity:t=>{let{id:e}=t;return!this.selectedItems.length||this.selectedItems.includes(e)?1:.5}})}destroy(){this.clear(),this.context.graph.off(M.AFTER_DRAW,this.createElement),super.destroy()}constructor(t,e){super(t,Object.assign({},ak.defaultOptions,e)),this.typePrefix="__data__",this.element=null,this.draw=!1,this.fieldMap={node:new Map,edge:new Map,combo:new Map},this.selectedItems=[],this.bindEvents=()=>{let{graph:t}=this.context;t.on(M.AFTER_DRAW,this.createElement)},this.changeState=(t,e)=>{let{graph:n}=this.context,{typePrefix:i}=this,r=eh(t,[i,"id"]),a=eh(t,[i,"style","labelText"]),[o]=r.split("__"),s=this.fieldMap[o].get(a)||[];n.setElementState(Object.fromEntries(null==s?void 0:s.map(t=>[t,e])))},this.click=t=>{if("hover"===this.options.trigger)return;let e=eh(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?(this.selectedItems=this.selectedItems.filter(t=>t!==e),this.changeState(t,[])):(this.selectedItems.push(e),this.changeState(t,"selected"))},this.mouseleave=t=>{"click"!==this.options.trigger&&(this.selectedItems=[],this.changeState(t,[]))},this.mouseenter=t=>{if("click"===this.options.trigger)return;let e=eh(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?this.selectedItems=this.selectedItems.filter(t=>t!==e):(this.selectedItems.push(e),this.changeState(t,"active"))},this.setFieldMap=(t,e,n)=>{if(!t)return;let i=this.fieldMap[n];if(i){if(i.has(t)){let n=i.get(t);n&&(n.push(e),i.set(t,n))}else i.set(t,[e])}},this.getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click}),this.getMarkerData=(t,e)=>{if(!t)return[];let{model:n,element:i,graph:r}=this.context,{nodes:a,edges:o,combos:s}=n.getData(),l={},h=e=>tx(t)?t(e):t,c={node:"circle",edge:"line",combo:"rect"},u={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},d=(t,e)=>{let n=null==i?void 0:i.getElementComputedStyle(t,e);return n},p=(t,e)=>{t.forEach(t=>{let{id:n}=t,r=eh(t,["data",h(t)]),a=(null==i?void 0:i.getElementType(e,t))||"circle",o=d(e,t),s=("edge"===e?null==o?void 0:o.stroke:null==o?void 0:o.fill)||"#1783ff";n&&r&&r.replace(/\s+/g,"")&&(this.setFieldMap(r,n,e),l[r]||(l[r]={id:"".concat(e,"__").concat(n),label:r,marker:u[a]||c[e],elementType:e,lineWidth:1,stroke:s,fill:s}))})};switch(e){case"node":p(a,"node");break;case"edge":p(o,"edge");break;case"combo":p(s,"combo");break;default:return[]}return Object.values(l)},this.layout=t=>{let{flexDirection:e,alignItems:n,justifyContent:i}={flexDirection:"row",alignItems:"flex-end",justifyContent:"center"},r={top:["row","flex-start","center"],bottom:["row","flex-end","center"],left:["column","flex-start","center"],right:["column","flex-end","center"]};return t in r&&([e,n,i]=r[t]),{display:"flex",flexDirection:e,justifyContent:i,alignItems:n}},this.createElement=()=>{if(this.draw){this.updateElement();return}let{canvas:t}=this.context,[e,n]=t.getSize(),{width:i=e,height:r=n,nodeField:a,edgeField:o,comboField:s,trigger:l,position:h,...c}=this.options,u=this.getMarkerData(a,"node"),d=this.getMarkerData(o,"edge"),p=this.getMarkerData(s,"combo"),f=[...u,...p,...d],g=this.layout(h),y=new rI({style:{width:i,height:r,...g}}),m=Object.assign({width:i,height:r,data:f,itemMarkerLineWidth:t=>{let{lineWidth:e}=t;return e},itemMarker:t=>{let{marker:e}=t;return e},itemMarkerStroke:t=>{let{stroke:e}=t;return e},itemMarkerFill:t=>{let{fill:e}=t;return e},gridCol:u.length},c,this.getEvents()),v=new aT({className:"legend",style:m});y.appendChild(v),t.appendChild(y),this.element=y,this.draw=!0},this.bindEvents()}}ak.defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16};var aP=n(4559);function aL(t,e){var n=e.cx,i=void 0===n?0:n,r=e.cy,a=void 0===r?0:r,o=e.r;t.arc(i,a,o,0,2*Math.PI,!1)}function aD(t,e){var n=e.cx,i=void 0===n?0:n,r=e.cy,a=void 0===r?0:r,o=e.rx,s=e.ry;if(t.ellipse)t.ellipse(i,a,o,s,0,0,2*Math.PI,!1);else{var l=o>s?o:s,h=o>s?1:o/s,c=o>s?s/o:1;t.save(),t.scale(h,c),t.arc(i,a,l,0,2*Math.PI)}}function aN(t,e){var n,i=e.x1,r=e.y1,a=e.x2,o=e.y2,s=e.markerStart,l=e.markerEnd,h=e.markerStartOffset,c=e.markerEndOffset,u=0,d=0,p=0,f=0,g=0;s&&(0,aP.RV)(s)&&h&&(u=Math.cos(g=Math.atan2(o-r,a-i))*(h||0),d=Math.sin(g)*(h||0)),l&&(0,aP.RV)(l)&&c&&(p=Math.cos(g=Math.atan2(r-o,i-a))*(c||0),f=Math.sin(g)*(c||0)),t.moveTo(i+u,r+d),t.lineTo(a+p,o+f)}function aI(t,e){var n,i=e.markerStart,r=e.markerEnd,a=e.markerStartOffset,o=e.markerEndOffset,s=e.d,l=s.absolutePath,h=s.segments,c=0,u=0,d=0,p=0,f=0;if(i&&(0,aP.RV)(i)&&a){var g=(0,rA.CR)(i.parentNode.getStartTangent(),2),y=g[0],m=g[1];n=y[0]-m[0],c=Math.cos(f=Math.atan2(y[1]-m[1],n))*(a||0),u=Math.sin(f)*(a||0)}if(r&&(0,aP.RV)(r)&&o){var v=(0,rA.CR)(r.parentNode.getEndTangent(),2),y=v[0],m=v[1];n=y[0]-m[0],d=Math.cos(f=Math.atan2(y[1]-m[1],n))*(o||0),p=Math.sin(f)*(o||0)}for(var b=0;b<l.length;b++){var x=l[b],E=x[0],w=l[b+1],C=0===b&&(0!==c||0!==u),S=(b===l.length-1||w&&("M"===w[0]||"Z"===w[0]))&&0!==d&&0!==p;switch(E){case"M":C?(t.moveTo(x[1]+c,x[2]+u),t.lineTo(x[1],x[2])):t.moveTo(x[1],x[2]);break;case"L":S?t.lineTo(x[1]+d,x[2]+p):t.lineTo(x[1],x[2]);break;case"Q":t.quadraticCurveTo(x[1],x[2],x[3],x[4]),S&&t.lineTo(x[3]+d,x[4]+p);break;case"C":t.bezierCurveTo(x[1],x[2],x[3],x[4],x[5],x[6]),S&&t.lineTo(x[5]+d,x[6]+p);break;case"A":var M=h[b].arcParams,R=M.cx,O=M.cy,A=M.rx,T=M.ry,k=M.startAngle,P=M.endAngle,L=M.xRotation,D=M.sweepFlag;if(t.ellipse)t.ellipse(R,O,A,T,L,k,P,!!(1-D));else{var N=A>T?A:T,I=A>T?1:A/T,B=A>T?T/A:1;t.translate(R,O),t.rotate(L),t.scale(I,B),t.arc(0,0,N,k,P,!!(1-D)),t.scale(1/I,1/B),t.rotate(-L),t.translate(-R,-O)}S&&t.lineTo(x[6]+d,x[7]+p);break;case"Z":t.closePath()}}}function aB(t,e){var n,i=e.markerStart,r=e.markerEnd,a=e.markerStartOffset,o=e.markerEndOffset,s=e.points.points,l=s.length,h=s[0][0],c=s[0][1],u=s[l-1][0],d=s[l-1][1],p=0,f=0,g=0,y=0,m=0;i&&(0,aP.RV)(i)&&a&&(n=s[1][0]-s[0][0],p=Math.cos(m=Math.atan2(s[1][1]-s[0][1],n))*(a||0),f=Math.sin(m)*(a||0)),r&&(0,aP.RV)(r)&&o&&(n=s[l-1][0]-s[0][0],g=Math.cos(m=Math.atan2(s[l-1][1]-s[0][1],n))*(o||0),y=Math.sin(m)*(o||0)),t.moveTo(h+(p||g),c+(f||y));for(var v=1;v<l-1;v++){var b=s[v];t.lineTo(b[0],b[1])}t.lineTo(u,d)}function a_(t,e){var n,i=e.markerStart,r=e.markerEnd,a=e.markerStartOffset,o=e.markerEndOffset,s=e.points.points,l=s.length,h=s[0][0],c=s[0][1],u=s[l-1][0],d=s[l-1][1],p=0,f=0,g=0,y=0,m=0;i&&(0,aP.RV)(i)&&a&&(n=s[1][0]-s[0][0],p=Math.cos(m=Math.atan2(s[1][1]-s[0][1],n))*(a||0),f=Math.sin(m)*(a||0)),r&&(0,aP.RV)(r)&&o&&(n=s[l-2][0]-s[l-1][0],g=Math.cos(m=Math.atan2(s[l-2][1]-s[l-1][1],n))*(o||0),y=Math.sin(m)*(o||0)),t.moveTo(h+p,c+f);for(var v=1;v<l-1;v++){var b=s[v];t.lineTo(b[0],b[1])}t.lineTo(u+g,d+y)}function aF(t,e){var n=e.x,i=void 0===n?0:n,r=e.y,a=void 0===r?0:r,o=e.radius,s=e.width,l=e.height;if(o&&o.some(function(t){return 0!==t})){var h=s>0?1:-1,c=l>0?1:-1,u=h+c===0,d=(0,rA.CR)(o.map(function(t){return iC(t,0,Math.min(Math.abs(s)/2,Math.abs(l)/2))}),4),p=d[0],f=d[1],g=d[2],y=d[3];t.moveTo(h*p+i,a),t.lineTo(s-h*f+i,a),0!==f&&t.arc(s-h*f+i,c*f+a,f,-c*Math.PI/2,h>0?0:Math.PI,u),t.lineTo(s+i,l-c*g+a),0!==g&&t.arc(s-h*g+i,l-c*g+a,g,h>0?0:Math.PI,c>0?Math.PI/2:1.5*Math.PI,u),t.lineTo(h*y+i,l+a),0!==y&&t.arc(h*y+i,l-c*y+a,y,c>0?Math.PI/2:-Math.PI/2,h>0?Math.PI:0,u),t.lineTo(i,c*p+a),0!==p&&t.arc(h*p+i,c*p+a,p,h>0?Math.PI:0,c>0?1.5*Math.PI:Math.PI/2,u)}else t.rect(i,a,s,l)}var aj=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="canvas-path-generator",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){var t,e=((t={})[aP.bn.CIRCLE]=aL,t[aP.bn.ELLIPSE]=aD,t[aP.bn.RECT]=aF,t[aP.bn.LINE]=aN,t[aP.bn.POLYLINE]=a_,t[aP.bn.POLYGON]=aB,t[aP.bn.PATH]=aI,t[aP.bn.TEXT]=void 0,t[aP.bn.GROUP]=void 0,t[aP.bn.IMAGE]=void 0,t[aP.bn.HTML]=void 0,t[aP.bn.MESH]=void 0,t);this.context.pathGeneratorFactory=e},e.prototype.destroy=function(){delete this.context.pathGeneratorFactory},e}(aP.F6),az=n(77160),aG=n(85975),aH=n(11702);function aW(t,e,n){return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}var aV=az.Ue(),aZ=az.Ue(),aU=az.Ue(),aY=aG.create(),aK=function(){function t(){var t=this;this.isHit=function(e,n,i,r){var a=t.context.pointInPathPickerFactory[e.nodeName];if(a){var o=aG.invert(aY,i),s=az.fF(aZ,az.t8(aU,n[0],n[1],0),o);if(a(e,new aP.E9(s[0],s[1]),r,t.isPointInPath,t.context,t.runtime))return!0}return!1},this.isPointInPath=function(e,n){var i=t.runtime.offscreenCanvasCreator.getOrCreateContext(t.context.config.offscreenCanvas),r=t.context.pathGeneratorFactory[e.nodeName];return r&&(i.beginPath(),r(i,e.parsedStyle),i.closePath()),i.isPointInPath(n.x,n.y)}}return t.prototype.apply=function(e,n){var i,r=this,a=e.renderingService,o=e.renderingContext;this.context=e,this.runtime=n;var s=null===(i=o.root)||void 0===i?void 0:i.ownerDocument;a.hooks.pick.tapPromise(t.tag,function(t){return(0,rA.mG)(r,void 0,void 0,function(){return(0,rA.Jh)(this,function(e){return[2,this.pick(s,t)]})})}),a.hooks.pickSync.tap(t.tag,function(t){return r.pick(s,t)})},t.prototype.pick=function(t,e){var n,i,r=e.topmost,a=e.position,o=a.x,s=a.y,l=az.t8(aV,o,s,0),h=t.elementsFromBBox(l[0],l[1],l[0],l[1]),c=[];try{for(var u=(0,rA.XA)(h),d=u.next();!d.done;d=u.next()){var p=d.value,f=p.getWorldTransform();if(this.isHit(p,l,f,!1)){var g=(0,aP.Oi)(p);if(g){var y=g.parsedStyle.clipPath;if(this.isHit(y,l,y.getWorldTransform(),!0)){if(r)return e.picked=[p],e;c.push(p)}}else{if(r)return e.picked=[p],e;c.push(p)}}}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return e.picked=c,e},t.tag="CanvasPicker",t}();function a$(t,e,n){var i=t.parsedStyle,r=i.cx,a=i.cy,o=i.r,s=i.fill,l=i.stroke,h=i.lineWidth,c=i.increasedLineWidthForHitTesting,u=i.pointerEvents,d=((void 0===h?1:h)+(void 0===c?0:c))/2,p=(0,aH.TE)(void 0===r?0:r,void 0===a?0:a,e.x,e.y),f=(0,rA.CR)((0,aP.L1)(void 0===u?"auto":u,s,l),2),g=f[0],y=f[1];return g&&y||n?p<=o+d:g?p<=o:!!y&&p>=o-d&&p<=o+d}function aX(t,e,n){var i,r,a,o,s,l,h=t.parsedStyle,c=h.cx,u=void 0===c?0:c,d=h.cy,p=void 0===d?0:d,f=h.rx,g=h.ry,y=h.fill,m=h.stroke,v=h.lineWidth,b=h.increasedLineWidthForHitTesting,x=h.pointerEvents,E=e.x,w=e.y,C=(0,rA.CR)((0,aP.L1)(void 0===x?"auto":x,y,m),2),S=C[0],M=C[1],R=((void 0===v?1:v)+(void 0===b?0:b))/2,O=(E-u)*(E-u),A=(w-p)*(w-p);return S&&M||n?1>=O/((i=f+R)*i)+A/((r=g+R)*r):S?1>=O/(f*f)+A/(g*g):!!M&&O/((a=f-R)*a)+A/((o=g-R)*o)>=1&&1>=O/((s=f+R)*s)+A/((l=g+R)*l)}function aq(t,e,n,i,r,a){return r>=t&&r<=t+n&&a>=e&&a<=e+i}function aQ(t,e,n,i,r,a,o,s){var l=(Math.atan2(s-e,o-t)+2*Math.PI)%(2*Math.PI),h={x:t+n*Math.cos(l),y:e+n*Math.sin(l)};return(0,aH.TE)(h.x,h.y,o,s)<=a/2}function aJ(t,e,n,i,r,a,o){var s=Math.min(t,n),l=Math.max(t,n),h=Math.min(e,i),c=Math.max(e,i),u=r/2;return a>=s-u&&a<=l+u&&o>=h-u&&o<=c+u&&(0,aH._x)(t,e,n,i,a,o)<=r/2}function a0(t,e,n,i,r){var a=t.length;if(a<2)return!1;for(var o=0;o<a-1;o++)if(aJ(t[o][0],t[o][1],t[o+1][0],t[o+1][1],e,n,i))return!0;if(r){var s=t[0],l=t[a-1];if(aJ(s[0],s[1],l[0],l[1],e,n,i))return!0}return!1}function a1(t){return 1e-6>Math.abs(t)?0:t<0?-1:1}function a2(t,e,n){var i=!1,r=t.length;if(r<=2)return!1;for(var a=0;a<r;a++){var o,s=t[a],l=t[(a+1)%r];if(((o=[e,n])[0]-s[0])*(l[1]-s[1])==(l[0]-s[0])*(o[1]-s[1])&&Math.min(s[0],l[0])<=o[0]&&o[0]<=Math.max(s[0],l[0])&&Math.min(s[1],l[1])<=o[1]&&o[1]<=Math.max(s[1],l[1]))return!0;a1(s[1]-n)>0!=a1(l[1]-n)>0&&0>a1(e-(n-s[1])*(s[0]-l[0])/(s[1]-l[1])-s[0])&&(i=!i)}return i}function a3(t,e,n){for(var i=!1,r=0;r<t.length&&!(i=a2(t[r],e,n));r++);return i}function a6(t,e,n){var i=t.parsedStyle,r=i.x1,a=i.y1,o=i.x2,s=i.y2,l=i.lineWidth,h=void 0===l?1:l,c=i.increasedLineWidthForHitTesting,u=void 0===c?0:c,d=i.pointerEvents,p=void 0===d?"auto":d,f=i.fill,g=i.stroke;return(!!(0,rA.CR)((0,aP.L1)(p,f,g),2)[1]||!!n)&&!!h&&aJ(r,a,o,s,h+u,e.x,e.y)}function a4(t,e,n,i,r,a){var o=t.parsedStyle,s=o.lineWidth,l=o.increasedLineWidthForHitTesting,h=o.stroke,c=o.fill,u=o.d,d=o.pointerEvents,p=u.segments,f=u.hasArc,g=u.polylines,y=u.polygons,m=(0,rA.CR)((0,aP.L1)(void 0===d?"auto":d,(null==y?void 0:y.length)&&c,h),2),v=m[0],b=m[1],x=(0,aP.gz)(t),E=!1;return v||n?E=f?i(t,e):a3(y,e.x,e.y)||a3(g,e.x,e.y):(b||n)&&(E=function(t,e,n,i,r){for(var a=!1,o=e/2,s=0;s<t.length;s++){var l=t[s],h=l.currentPoint,c=l.params,u=l.prePoint,d=l.box;if(!d||aq(d.x-o,d.y-o,d.width+e,d.height+e,n,i))switch(l.command){case"L":case"Z":if(a=aJ(u[0],u[1],h[0],h[1],e,n,i))return!0;break;case"Q":if(a=(0,aH.Y1)(u[0],u[1],c[1],c[2],c[3],c[4],n,i)<=e/2)return!0;break;case"C":if(a=(0,aH.ph)(u[0],u[1],c[1],c[2],c[3],c[4],c[5],c[6],n,i,r)<=e/2)return!0;break;case"A":l.cubicParams||(l.cubicParams=function t(e,n,i,r,a,o,s,l,h,c){var u,d,p,f,g,y=e,m=n,v=i,b=r,x=l,E=h,w=120*Math.PI/180,C=Math.PI/180*(+a||0),S=[];if(c)d=c[0],p=c[1],f=c[2],g=c[3];else{y=(u=aW(y,m,-C)).x,m=u.y,x=(u=aW(x,E,-C)).x,E=u.y;var M=(y-x)/2,R=(m-E)/2,O=M*M/(v*v)+R*R/(b*b);O>1&&(v*=O=Math.sqrt(O),b*=O);var A=v*v,T=b*b,k=(o===s?-1:1)*Math.sqrt(Math.abs((A*T-A*R*R-T*M*M)/(A*R*R+T*M*M)));f=k*v*R/b+(y+x)/2,g=-(k*b)*M/v+(m+E)/2,d=Math.asin(((m-g)/b*1e9>>0)/1e9),p=Math.asin(((E-g)/b*1e9>>0)/1e9),d=y<f?Math.PI-d:d,p=x<f?Math.PI-p:p,d<0&&(d=2*Math.PI+d),p<0&&(p=2*Math.PI+p),s&&d>p&&(d-=2*Math.PI),!s&&p>d&&(p-=2*Math.PI)}var P=p-d;if(Math.abs(P)>w){var L=p,D=x,N=E;S=t(x=f+v*Math.cos(p=d+w*(s&&p>d?1:-1)),E=g+b*Math.sin(p),v,b,a,0,s,D,N,[p,L,f,g])}P=p-d;var I=Math.cos(d),B=Math.cos(p),_=Math.tan(P/4),F=4/3*v*_,j=4/3*b*_,z=[y,m],G=[y+F*Math.sin(d),m-j*I],H=[x+F*Math.sin(p),E-j*B],W=[x,E];if(G[0]=2*z[0]-G[0],G[1]=2*z[1]-G[1],c)return G.concat(H,W,S);S=G.concat(H,W,S);for(var V=[],Z=0,U=S.length;Z<U;Z+=1)V[Z]=Z%2?aW(S[Z-1],S[Z],C).y:aW(S[Z],S[Z+1],C).x;return V}(u[0],u[1],c[1],c[2],c[3],c[4],c[5],c[6],c[7],void 0));for(var p=l.cubicParams,f=u,g=0;g<p.length;g+=6){var y=(0,aH.ph)(f[0],f[1],p[g],p[g+1],p[g+2],p[g+3],p[g+4],p[g+5],n,i,r);if(f=[p[g+4],p[g+5]],a=y<=e/2)return!0}}}return a}(p,(void 0===s?1:s)+(void 0===l?0:l),e.x,e.y,x)),E}function a8(t,e,n){var i=t.parsedStyle,r=i.stroke,a=i.fill,o=i.lineWidth,s=i.increasedLineWidthForHitTesting,l=i.points,h=i.pointerEvents,c=(0,rA.CR)((0,aP.L1)(void 0===h?"auto":h,a,r),2),u=c[0],d=c[1],p=!1;return(d||n)&&(p=a0(l.points,(void 0===o?1:o)+(void 0===s?0:s),e.x,e.y,!0)),!p&&(u||n)&&(p=a2(l.points,e.x,e.y)),p}function a9(t,e,n){var i=t.parsedStyle,r=i.lineWidth,a=void 0===r?1:r,o=i.increasedLineWidthForHitTesting,s=void 0===o?0:o,l=i.points,h=i.pointerEvents,c=void 0===h?"auto":h,u=i.fill,d=i.stroke;return(!!(0,rA.CR)((0,aP.L1)(c,u,d),2)[1]||!!n)&&!!a&&a0(l.points,a+s,e.x,e.y,!1)}function a5(t,e,n,i,r){var a,o,s,l=t.parsedStyle,h=l.radius,c=l.fill,u=l.stroke,d=l.lineWidth,p=l.increasedLineWidthForHitTesting,f=l.x,g=void 0===f?0:f,y=l.y,m=void 0===y?0:y,v=l.width,b=l.height,x=l.pointerEvents,E=(0,rA.CR)((0,aP.L1)(void 0===x?"auto":x,c,u),2),w=E[0],C=E[1],S=h&&h.some(function(t){return 0!==t}),M=(void 0===d?1:d)+(void 0===p?0:p);if(S){var R,O,A,T,k,P,L,D,N=!1;return(C||n)&&(R=h.map(function(t){return iC(t,0,Math.min(Math.abs(v)/2,Math.abs(b)/2))}),O=e.x,A=e.y,k=(T=(0,rA.CR)(R,4))[0],P=T[1],L=T[2],D=T[3],N=aJ(g+k,m,g+v-P,m,M,O,A)||aJ(g+v,m+P,g+v,m+b-L,M,O,A)||aJ(g+v-L,m+b,g+D,m+b,M,O,A)||aJ(g,m+b-D,g,m+k,M,O,A)||aQ(g+v-P,m+P,P,1.5*Math.PI,2*Math.PI,M,O,A)||aQ(g+v-L,m+b-L,L,0,.5*Math.PI,M,O,A)||aQ(g+D,m+b-D,D,.5*Math.PI,Math.PI,M,O,A)||aQ(g+k,m+k,k,Math.PI,1.5*Math.PI,M,O,A)),!N&&(w||n)&&(N=i(t,e)),N}var I=M/2;return w&&C||n?aq(g-I,m-I,v+I,b+I,e.x,e.y):w?aq(g,m,v,b,e.x,e.y):!!C&&(a=e.x,o=e.y,aq(g-(s=M/2),m-s,v,M,a,o)||aq(g+v-s,m-s,M,b,a,o)||aq(g+s,m+b-s,v,M,a,o)||aq(g-s,m+s,M,b,a,o))}function a7(t,e,n,i,r,a){var o=t.parsedStyle,s=o.pointerEvents,l=o.x,h=o.y,c=o.width,u=o.height;if("non-transparent-pixel"===(void 0===s?"auto":s)){var d=r.config.offscreenCanvas,p=a.offscreenCanvasCreator.getOrCreateCanvas(d),f=a.offscreenCanvasCreator.getOrCreateContext(d,{willReadFrequently:!0});return p.width=c,p.height=u,r.defaultStyleRendererFactory[aP.bn.IMAGE].render(f,(0,rA.pi)((0,rA.pi)({},t.parsedStyle),{x:0,y:0}),t,void 0,void 0,void 0),f.getImageData(e.x-(void 0===l?0:l),e.y-(void 0===h?0:h),1,1).data.every(function(t){return 0!==t})}return!0}var ot=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="canvas-picker",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){var t,e=((t={})[aP.bn.CIRCLE]=a$,t[aP.bn.ELLIPSE]=aX,t[aP.bn.RECT]=a5,t[aP.bn.LINE]=a6,t[aP.bn.POLYLINE]=a9,t[aP.bn.POLYGON]=a8,t[aP.bn.PATH]=a4,t[aP.bn.TEXT]=function(){return!0},t[aP.bn.GROUP]=null,t[aP.bn.IMAGE]=a7,t[aP.bn.HTML]=null,t[aP.bn.MESH]=null,t);this.context.pointInPathPickerFactory=e,this.addRenderingPlugin(new aK)},e.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},e}(aP.F6),oe=function(){function t(t){this.canvasRendererPluginOptions=t,this.removedRBushNodeAABBs=[],this.renderQueue=[],this.restoreStack=[],this.clearFullScreenLastFrame=!1,this.clearFullScreen=!1,this.vpMatrix=aG.create(),this.dprMatrix=aG.create(),this.tmpMat4=aG.create(),this.vec3a=az.Ue(),this.vec3b=az.Ue(),this.vec3c=az.Ue(),this.vec3d=az.Ue()}return t.prototype.apply=function(e,n){var i=this;this.context=e;var r=e.config,a=e.camera,o=e.renderingService,s=e.renderingContext,l=e.rBushRoot,h=e.pathGeneratorFactory;this.rBush=l,this.pathGeneratorFactory=h;var c=e.contextService,u=s.root.ownerDocument.defaultView,d=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)},p=function(t){var e=t.target.rBushNode;e.aabb&&i.removedRBushNodeAABBs.push(e.aabb)};o.hooks.init.tap(t.tag,function(){u.addEventListener(aP.Dk.UNMOUNTED,d),u.addEventListener(aP.Dk.CULLED,p);var t=c.getDPR(),e=r.width,n=r.height,a=c.getContext();i.clearRect(a,0,0,e*t,n*t,r.background)}),o.hooks.destroy.tap(t.tag,function(){u.removeEventListener(aP.Dk.UNMOUNTED,d),u.removeEventListener(aP.Dk.CULLED,p),i.renderQueue=[],i.removedRBushNodeAABBs=[],i.restoreStack=[]}),o.hooks.beginFrame.tap(t.tag,function(){var t,e=c.getContext(),n=c.getDPR(),a=r.width,s=r.height,l=i.canvasRendererPluginOptions,h=l.dirtyObjectNumThreshold,d=l.dirtyObjectRatioThreshold,p=o.getStats(),f=p.total,g=p.rendered;i.clearFullScreen=i.clearFullScreenLastFrame||!(null===(t=u.context.renderingPlugins[1])||void 0===t?void 0:t.isFirstTimeRenderingFinished)||o.disableDirtyRectangleRendering()||g>h&&g/f>d,e&&(e.resetTransform?e.resetTransform():e.setTransform(1,0,0,1,0,0),i.clearFullScreen&&i.clearRect(e,0,0,a*n,s*n,r.background))});var f=function(t,e){t.isVisible()&&!t.isCulled()&&i.renderDisplayObject(t,e,i.context,i.restoreStack,n),(t.sortable.sorted||t.childNodes).forEach(function(t){f(t,e)})};o.hooks.endFrame.tap(t.tag,function(){if(0===s.root.childNodes.length){i.clearFullScreenLastFrame=!0;return}i.clearFullScreenLastFrame=!1;var t=c.getContext(),e=c.getDPR();if(aG.fromScaling(i.dprMatrix,[e,e,1]),aG.multiply(i.vpMatrix,i.dprMatrix,a.getOrthoMatrix()),i.clearFullScreen)f(s.root,t);else{var o=i.safeMergeAABB.apply(i,(0,rA.ev)([i.mergeDirtyAABBs(i.renderQueue)],(0,rA.CR)(i.removedRBushNodeAABBs.map(function(t){var e=t.minX,n=t.minY,i=t.maxX,r=t.maxY,a=new aP.mN;return a.setMinMax([e,n,0],[i,r,0]),a})),!1));if(i.removedRBushNodeAABBs=[],aP.mN.isEmpty(o)){i.renderQueue=[];return}var l=i.convertAABB2Rect(o),h=l.x,d=l.y,p=l.width,g=l.height,y=az.fF(i.vec3a,[h,d,0],i.vpMatrix),m=az.fF(i.vec3b,[h+p,d,0],i.vpMatrix),v=az.fF(i.vec3c,[h,d+g,0],i.vpMatrix),b=az.fF(i.vec3d,[h+p,d+g,0],i.vpMatrix),x=Math.min(y[0],m[0],b[0],v[0]),E=Math.min(y[1],m[1],b[1],v[1]),w=Math.max(y[0],m[0],b[0],v[0]),C=Math.max(y[1],m[1],b[1],v[1]),S=Math.floor(x),M=Math.floor(E),R=Math.ceil(w-x),O=Math.ceil(C-E);t.save(),i.clearRect(t,S,M,R,O,r.background),t.beginPath(),t.rect(S,M,R,O),t.clip(),t.setTransform(i.vpMatrix[0],i.vpMatrix[1],i.vpMatrix[4],i.vpMatrix[5],i.vpMatrix[12],i.vpMatrix[13]),r.renderer.getConfig().enableDirtyRectangleRenderingDebug&&u.dispatchEvent(new aP.Aw(aP.$6.DIRTY_RECTANGLE,{dirtyRect:{x:S,y:M,width:R,height:O}})),i.searchDirtyObjects(o).sort(function(t,e){return t.sortable.renderOrder-e.sortable.renderOrder}).forEach(function(e){e&&e.isVisible()&&!e.isCulled()&&i.renderDisplayObject(e,t,i.context,i.restoreStack,n)}),t.restore(),i.renderQueue.forEach(function(t){i.saveDirtyAABB(t)}),i.renderQueue=[]}i.restoreStack.forEach(function(){t.restore()}),i.restoreStack=[]}),o.hooks.render.tap(t.tag,function(t){i.clearFullScreen||i.renderQueue.push(t)})},t.prototype.clearRect=function(t,e,n,i,r,a){t.clearRect(e,n,i,r),a&&(t.fillStyle=a,t.fillRect(e,n,i,r))},t.prototype.renderDisplayObject=function(t,e,n,i,r){var a=t.nodeName,o=i[i.length-1];o&&!(t.compareDocumentPosition(o)&aP.NB.DOCUMENT_POSITION_CONTAINS)&&(e.restore(),i.pop());var s=this.context.styleRendererFactory[a],l=this.pathGeneratorFactory[a],h=t.parsedStyle.clipPath;if(h){this.applyWorldTransform(e,h);var c=this.pathGeneratorFactory[h.nodeName];c&&(e.save(),i.push(t),e.beginPath(),c(e,h.parsedStyle),e.closePath(),e.clip())}s&&(this.applyWorldTransform(e,t),e.save(),this.applyAttributesToContext(e,t)),l&&(e.beginPath(),l(e,t.parsedStyle),t.nodeName!==aP.bn.LINE&&t.nodeName!==aP.bn.PATH&&t.nodeName!==aP.bn.POLYLINE&&e.closePath()),s&&(s.render(e,t.parsedStyle,t,n,this,r),e.restore()),t.renderable.dirty=!1},t.prototype.convertAABB2Rect=function(t){var e=t.getMin(),n=t.getMax(),i=Math.floor(e[0]),r=Math.floor(e[1]);return{x:i,y:r,width:Math.ceil(n[0])-i,height:Math.ceil(n[1])-r}},t.prototype.mergeDirtyAABBs=function(t){var e=new aP.mN;return t.forEach(function(t){var n=t.getRenderBounds();e.add(n);var i=t.renderable.dirtyRenderBounds;i&&e.add(i)}),e},t.prototype.searchDirtyObjects=function(t){var e=(0,rA.CR)(t.getMin(),2),n=e[0],i=e[1],r=(0,rA.CR)(t.getMax(),2),a=r[0],o=r[1];return this.rBush.search({minX:n,minY:i,maxX:a,maxY:o}).map(function(t){return t.displayObject})},t.prototype.saveDirtyAABB=function(t){var e=t.renderable;e.dirtyRenderBounds||(e.dirtyRenderBounds=new aP.mN);var n=t.getRenderBounds();n&&e.dirtyRenderBounds.update(n.center,n.halfExtents)},t.prototype.applyAttributesToContext=function(t,e){var n=e.parsedStyle,i=n.stroke,r=n.fill,a=n.opacity,o=n.lineDash,s=n.lineDashOffset;o&&t.setLineDash(o),B(s)||(t.lineDashOffset=s),B(a)||(t.globalAlpha*=a),B(i)||Array.isArray(i)||i.isNone||(t.strokeStyle=e.attributes.stroke),B(r)||Array.isArray(r)||r.isNone||(t.fillStyle=e.attributes.fill)},t.prototype.applyWorldTransform=function(t,e,n){n?(aG.copy(this.tmpMat4,e.getLocalTransform()),aG.multiply(this.tmpMat4,n,this.tmpMat4),aG.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)):(aG.copy(this.tmpMat4,e.getWorldTransform()),aG.multiply(this.tmpMat4,this.vpMatrix,this.tmpMat4)),t.setTransform(this.tmpMat4[0],this.tmpMat4[1],this.tmpMat4[4],this.tmpMat4[5],this.tmpMat4[12],this.tmpMat4[13])},t.prototype.safeMergeAABB=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=new aP.mN;return t.forEach(function(t){n.add(t)}),n},t.tag="CanvasRenderer",t}(),on=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n,i,r,a){var o=e.fill,s=e.fillRule,l=e.opacity,h=void 0===l?1:l,c=e.fillOpacity,u=e.stroke,d=e.strokeOpacity,p=e.lineWidth,f=void 0===p?1:p,g=e.lineCap,y=e.lineJoin,m=e.shadowType,v=e.shadowColor,b=e.shadowBlur,x=e.filter,E=e.miterLimit,w=o&&!o.isNone,C=u&&!u.isNone&&f>0,S=(null==o?void 0:o.alpha)===0,M=!!(x&&x.length),R=!B(v)&&b>0,O=n.nodeName,A="inner"===m,T=C&&R&&(O===aP.bn.PATH||O===aP.bn.LINE||O===aP.bn.POLYLINE||S||A);w&&(t.globalAlpha=h*(void 0===c?1:c),T||oi(n,t,R),oo(t,n,o,s,i,r,a,this.imagePool),T||this.clearShadowAndFilter(t,M,R)),C&&(t.globalAlpha=h*(void 0===d?1:d),t.lineWidth=f,B(E)||(t.miterLimit=E),B(g)||(t.lineCap=g),B(y)||(t.lineJoin=y),T&&(A&&(t.globalCompositeOperation="source-atop"),oi(n,t,!0),A&&(os(t,n,u,i,r,a,this.imagePool),t.globalCompositeOperation="source-over",this.clearShadowAndFilter(t,M,!0))),os(t,n,u,i,r,a,this.imagePool))},t.prototype.clearShadowAndFilter=function(t,e,n){if(n&&(t.shadowColor="transparent",t.shadowBlur=0),e){var i=t.filter;!B(i)&&i.indexOf("drop-shadow")>-1&&(t.filter=i.replace(/drop-shadow\([^)]*\)/,"").trim()||"none")}},t}();function oi(t,e,n){var i=t.parsedStyle,r=i.filter,a=i.shadowColor,o=i.shadowBlur,s=i.shadowOffsetX,l=i.shadowOffsetY;r&&r.length&&(e.filter=t.style.filter),n&&(e.shadowColor=a.toString(),e.shadowBlur=o||0,e.shadowOffsetX=s||0,e.shadowOffsetY=l||0)}function or(t,e,n,i,r,a,o){if("rect"===t.image.nodeName){var s,l,h=t.image.parsedStyle,c=h.width,u=h.height;l=i.contextService.getDPR();var d=i.config.offscreenCanvas;(s=a.offscreenCanvasCreator.getOrCreateCanvas(d)).width=c*l,s.height=u*l;var p=a.offscreenCanvasCreator.getOrCreateContext(d),f=[];t.image.forEach(function(t){r.renderDisplayObject(t,p,i,f,a)}),f.forEach(function(){p.restore()})}return o.getOrCreatePatternSync(t,n,s,l,e.getGeometryBounds().min,function(){e.renderable.dirty=!0,i.renderingService.dirtify()})}function oa(t,e,n,i){var r;if(t.type===aP.GL.LinearGradient||t.type===aP.GL.RadialGradient){var a=e.getGeometryBounds(),o=a&&2*a.halfExtents[0]||1,s=a&&2*a.halfExtents[1]||1,l=a&&a.min||[0,0];r=i.getOrCreateGradient((0,rA.pi)((0,rA.pi)({type:t.type},t.value),{min:l,width:o,height:s}),n)}return r}function oo(t,e,n,i,r,a,o,s,l){void 0===l&&(l=!1),Array.isArray(n)?n.forEach(function(n){t.fillStyle=oa(n,e,t,s),l||(i?t.fill(i):t.fill())}):((0,aP.R)(n)&&(t.fillStyle=or(n,e,t,r,a,o,s)),l||(i?t.fill(i):t.fill()))}function os(t,e,n,i,r,a,o,s){void 0===s&&(s=!1),Array.isArray(n)?n.forEach(function(n){t.strokeStyle=oa(n,e,t,o),s||t.stroke()}):((0,aP.R)(n)&&(t.strokeStyle=or(n,e,t,i,r,a,o)),s||t.stroke())}var ol=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n){var i,r=e.x,a=e.y,o=e.width,s=e.height,l=e.src,h=e.shadowColor,c=e.shadowBlur,u=o,d=s;if(W(l)?i=this.imagePool.getImageSync(l):(u||(u=l.width),d||(d=l.height),i=l),i){oi(n,t,!B(h)&&c>0);try{t.drawImage(i,void 0===r?0:r,void 0===a?0:a,u,d)}catch(t){}}},t}(),oh=function(){function t(t){this.imagePool=t}return t.prototype.render=function(t,e,n,i,r,a){n.getBounds();var o=e.lineWidth,s=void 0===o?1:o,l=e.textAlign,h=void 0===l?"start":l,c=e.textBaseline,u=void 0===c?"alphabetic":c,d=e.lineJoin,p=e.miterLimit,f=void 0===p?10:p,g=e.letterSpacing,y=void 0===g?0:g,m=e.stroke,v=e.fill,b=e.fillRule,x=e.fillOpacity,E=void 0===x?1:x,w=e.strokeOpacity,C=void 0===w?1:w,S=e.opacity,M=void 0===S?1:S,R=e.metrics,O=e.x,A=e.y,T=e.dx,k=e.dy,P=e.shadowColor,L=e.shadowBlur,D=R.font,N=R.lines,I=R.height,_=R.lineHeight,F=R.lineMetrics;t.font=D,t.lineWidth=s,t.textAlign="middle"===h?"center":h;var j=u;a.enableCSSParsing||"alphabetic"!==j||(j="bottom"),t.lineJoin=void 0===d?"miter":d,B(f)||(t.miterLimit=f);var z=void 0===A?0:A;"middle"===u?z+=-I/2-_/2:"bottom"===u||"alphabetic"===u||"ideographic"===u?z+=-I:("top"===u||"hanging"===u)&&(z+=-_);var G=(void 0===O?0:O)+(T||0);z+=k||0,1===N.length&&("bottom"===j?(j="middle",z-=.5*I):"top"===j&&(j="middle",z+=.5*I)),t.textBaseline=j,oi(n,t,!B(P)&&L>0);for(var H=0;H<N.length;H++){var W=s/2+G;z+=_,B(m)||m.isNone||!s||this.drawLetterSpacing(t,n,N[H],F[H],h,W,z,y,v,b,E,m,C,M,!0,i,r,a),B(v)||this.drawLetterSpacing(t,n,N[H],F[H],h,W,z,y,v,b,E,m,C,M,!1,i,r,a)}},t.prototype.drawLetterSpacing=function(t,e,n,i,r,a,o,s,l,h,c,u,d,p,f,g,y,m){if(0===s){f?this.strokeText(t,e,n,a,o,u,d,g,y,m):this.fillText(t,e,n,a,o,l,h,c,p,g,y,m);return}var v=t.textAlign;t.textAlign="left";var b=a;"center"===r||"middle"===r?b=a-i.width/2:("right"===r||"end"===r)&&(b=a-i.width);for(var x=Array.from(n),E=t.measureText(n).width,w=0,C=0;C<x.length;++C){var S=x[C];f?this.strokeText(t,e,S,b,o,u,d,g,y,m):this.fillText(t,e,S,b,o,l,h,c,p,g,y,m),b+=E-(w=t.measureText(n.substring(C+1)).width)+s,E=w}t.textAlign=v},t.prototype.fillText=function(t,e,n,i,r,a,o,s,l,h,c,u){oo(t,e,a,o,h,c,u,this.imagePool,!0);var d,p=!B(s)&&1!==s;p&&(d=t.globalAlpha,t.globalAlpha=s*l),t.fillText(n,i,r),p&&(t.globalAlpha=d)},t.prototype.strokeText=function(t,e,n,i,r,a,o,s,l,h){os(t,e,a,s,l,h,this.imagePool,!0);var c,u=!B(o)&&1!==o;u&&(c=t.globalAlpha,t.globalAlpha=o),t.strokeText(n,i,r),u&&(t.globalAlpha=c)},t}();(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on),(0,rA.ZT)(function(){return null!==on&&on.apply(this,arguments)||this},on);var oc=function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.options=e,n.name="canvas-renderer",n}return(0,rA.ZT)(e,t),e.prototype.init=function(){var t,e=(0,rA.pi)({dirtyObjectNumThreshold:500,dirtyObjectRatioThreshold:.8},this.options),n=this.context.imagePool,i=new on(n),r=((t={})[aP.bn.CIRCLE]=i,t[aP.bn.ELLIPSE]=i,t[aP.bn.RECT]=i,t[aP.bn.IMAGE]=new ol(n),t[aP.bn.TEXT]=new oh(n),t[aP.bn.LINE]=i,t[aP.bn.POLYLINE]=i,t[aP.bn.POLYGON]=i,t[aP.bn.PATH]=i,t[aP.bn.GROUP]=void 0,t[aP.bn.HTML]=void 0,t[aP.bn.MESH]=void 0,t);this.context.defaultStyleRendererFactory=r,this.context.styleRendererFactory=r,this.addRenderingPlugin(new oe(e))},e.prototype.destroy=function(){this.removeAllRenderingPlugins(),delete this.context.defaultStyleRendererFactory,delete this.context.styleRendererFactory},e}(aP.F6),ou=function(){function t(){}return t.prototype.apply=function(e,n){var i=this,r=e.renderingService,a=e.renderingContext,o=e.config;this.context=e;var s=a.root.ownerDocument.defaultView,l=function(t){r.hooks.pointerMove.call(t)},h=function(t){r.hooks.pointerUp.call(t)},c=function(t){r.hooks.pointerDown.call(t)},u=function(t){r.hooks.pointerOver.call(t)},d=function(t){r.hooks.pointerOut.call(t)},p=function(t){r.hooks.pointerCancel.call(t)},f=function(t){r.hooks.pointerWheel.call(t)},g=function(t){r.hooks.click.call(t)},y=function(t){n.globalThis.document.addEventListener("pointermove",l,!0),t.addEventListener("pointerdown",c,!0),t.addEventListener("pointerleave",d,!0),t.addEventListener("pointerover",u,!0),n.globalThis.addEventListener("pointerup",h,!0),n.globalThis.addEventListener("pointercancel",p,!0)},m=function(t){t.addEventListener("touchstart",c,!0),t.addEventListener("touchend",h,!0),t.addEventListener("touchmove",l,!0),t.addEventListener("touchcancel",p,!0)},v=function(t){n.globalThis.document.addEventListener("mousemove",l,!0),t.addEventListener("mousedown",c,!0),t.addEventListener("mouseout",d,!0),t.addEventListener("mouseover",u,!0),n.globalThis.addEventListener("mouseup",h,!0)},b=function(t){n.globalThis.document.removeEventListener("pointermove",l,!0),t.removeEventListener("pointerdown",c,!0),t.removeEventListener("pointerleave",d,!0),t.removeEventListener("pointerover",u,!0),n.globalThis.removeEventListener("pointerup",h,!0)},x=function(t){t.removeEventListener("touchstart",c,!0),t.removeEventListener("touchend",h,!0),t.removeEventListener("touchmove",l,!0),t.removeEventListener("touchcancel",p,!0)},E=function(t){n.globalThis.document.removeEventListener("mousemove",l,!0),t.removeEventListener("mousedown",c,!0),t.removeEventListener("mouseout",d,!0),t.removeEventListener("mouseover",u,!0),n.globalThis.removeEventListener("mouseup",h,!0)};r.hooks.init.tap(t.tag,function(){var t=i.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="none",t.style.msTouchAction="none"):s.supportsPointerEvents&&(t.style.touchAction="none"),s.supportsPointerEvents?y(t):v(t),s.supportsTouchEvents&&m(t),o.useNativeClickEvent&&t.addEventListener("click",g,!0),t.addEventListener("wheel",f,{passive:!0,capture:!0})}),r.hooks.destroy.tap(t.tag,function(){var t=i.context.contextService.getDomElement();n.globalThis.navigator.msPointerEnabled?(t.style.msContentZooming="",t.style.msTouchAction=""):s.supportsPointerEvents&&(t.style.touchAction=""),s.supportsPointerEvents?b(t):E(t),s.supportsTouchEvents&&x(t),o.useNativeClickEvent&&t.removeEventListener("click",g,!0),t.removeEventListener("wheel",f,!0)})},t.tag="DOMInteraction",t}(),od=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="dom-interaction",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){this.addRenderingPlugin(new ou)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(aP.F6),op=function(){function t(){this.displayObjectHTMLElementMap=new WeakMap}return t.prototype.joinTransformMatrix=function(t){return"matrix(".concat([t[0],t[1],t[4],t[5],t[12],t[13]].join(","),")")},t.prototype.apply=function(e,n){var i=this,r=e.camera,a=e.renderingContext,o=e.renderingService;this.context=e;var s=a.root.ownerDocument.defaultView,l=s.context.eventService.nativeHTMLMap,h=function(t,e){e.style.transform=i.joinTransformMatrix(t.getWorldTransform())},c=function(t){var e=t.target;if(e.nodeName===aP.bn.HTML){i.$camera||(i.$camera=i.createCamera(r));var a=i.getOrCreateEl(e);if(i.$camera.appendChild(a),n.enableCSSParsing){var o=e.ownerDocument.documentElement.attributes;Object.keys(o).forEach(function(t){a.style[t]=o[t]})}Object.keys(e.attributes).forEach(function(t){i.updateAttribute(t,e)}),h(e,a),l.set(a,e)}},u=function(t){var e=t.target;if(e.nodeName===aP.bn.HTML&&i.$camera){var n=i.getOrCreateEl(e);n&&(n.remove(),l.delete(n))}},d=function(t){var e=t.target;if(e.nodeName===aP.bn.HTML){var n=t.attrName;i.updateAttribute(n,e)}},p=function(t){var e=t.target;if(e.nodeName===aP.bn.HTML){var n=i.getOrCreateEl(e);h(e,n)}},f=function(){if(i.$camera){var t=i.context.config,e=t.width,n=t.height;i.$camera.style.width="".concat(e||0,"px"),i.$camera.style.height="".concat(n||0,"px")}};o.hooks.init.tap(t.tag,function(){s.addEventListener(aP.$6.RESIZE,f),s.addEventListener(aP.Dk.MOUNTED,c),s.addEventListener(aP.Dk.UNMOUNTED,u),s.addEventListener(aP.Dk.ATTR_MODIFIED,d),s.addEventListener(aP.Dk.BOUNDS_CHANGED,p)}),o.hooks.endFrame.tap(t.tag,function(){i.$camera&&a.renderReasons.has(aP.Rr.CAMERA_CHANGED)&&(i.$camera.style.transform=i.joinTransformMatrix(r.getOrthoMatrix()))}),o.hooks.destroy.tap(t.tag,function(){i.$camera&&i.$camera.remove(),s.removeEventListener(aP.$6.RESIZE,f),s.removeEventListener(aP.Dk.MOUNTED,c),s.removeEventListener(aP.Dk.UNMOUNTED,u),s.removeEventListener(aP.Dk.ATTR_MODIFIED,d),s.removeEventListener(aP.Dk.BOUNDS_CHANGED,p)})},t.prototype.createCamera=function(t){var e=this.context.config,n=e.document,i=e.width,r=e.height,a=this.context.contextService.getDomElement(),o=a.parentNode;if(o){var s="g-canvas-camera",l=o.querySelector("#"+s);if(!l){var h=(n||document).createElement("div");h.style.overflow="hidden",h.style.pointerEvents="none",h.style.position="absolute",h.style.left="0px",h.style.top="0px",h.style.width="".concat(i||0,"px"),h.style.height="".concat(r||0,"px");var c=(n||document).createElement("div");l=c,c.id=s,c.style.position="absolute",c.style.left="".concat(a.offsetLeft||0,"px"),c.style.top="".concat(a.offsetTop||0,"px"),c.style.transformOrigin="left top",c.style.transform=this.joinTransformMatrix(t.getOrthoMatrix()),c.style.pointerEvents="none",c.style.width="100%",c.style.height="100%",h.appendChild(c),o.appendChild(h)}return l}return null},t.prototype.getOrCreateEl=function(t){var e=this.context.config.document,n=this.displayObjectHTMLElementMap.get(t);return n||(n=(e||document).createElement("div"),t.parsedStyle.$el=n,this.displayObjectHTMLElementMap.set(t,n),t.id&&(n.id=t.id),t.name&&n.setAttribute("name",t.name),t.className&&(n.className=t.className),n.style.position="absolute",n.style["will-change"]="transform",n.style.transform=this.joinTransformMatrix(t.getWorldTransform())),n},t.prototype.updateAttribute=function(t,e){var n=this.getOrCreateEl(e);switch(t){case"innerHTML":var i=e.parsedStyle.innerHTML;W(i)?n.innerHTML=i:(n.innerHTML="",n.appendChild(i));break;case"x":n.style.left="".concat(e.parsedStyle.x,"px");break;case"y":n.style.top="".concat(e.parsedStyle.y,"px");break;case"transformOrigin":var r=e.parsedStyle.transformOrigin;n.style["transform-origin"]="".concat(r[0].value," ").concat(r[1].value);break;case"width":if(this.context.enableCSSParsing){var a=e.computedStyleMap().get("width");n.style.width=a.toString()}else{var a=e.parsedStyle.width;n.style.width=ec(a)?"".concat(a,"px"):a.toString()}break;case"height":if(this.context.enableCSSParsing){var o=e.computedStyleMap().get("height");n.style.height=o.toString()}else{var o=e.parsedStyle.height;n.style.height=ec(o)?"".concat(o,"px"):o.toString()}break;case"zIndex":var s=e.parsedStyle.zIndex;n.style["z-index"]="".concat(s);break;case"visibility":var l=e.parsedStyle.visibility;n.style.visibility=l;break;case"pointerEvents":var h=e.parsedStyle.pointerEvents;n.style.pointerEvents=void 0===h?"auto":h;break;case"opacity":var c=e.parsedStyle.opacity;n.style.opacity="".concat(c);break;case"fill":var u=e.parsedStyle.fill,d="";(0,aP.qA)(u)?d=u.isNone?"transparent":e.getAttribute("fill"):Array.isArray(u)?d=e.getAttribute("fill"):(0,aP.R)(u),n.style.background=d;break;case"stroke":var p=e.parsedStyle.stroke,f="";(0,aP.qA)(p)?f=p.isNone?"transparent":e.getAttribute("stroke"):Array.isArray(p)?f=e.getAttribute("stroke"):(0,aP.R)(p),n.style["border-color"]=f,n.style["border-style"]="solid";break;case"lineWidth":var g=e.parsedStyle.lineWidth;n.style["border-width"]="".concat(g||0,"px");break;case"lineDash":n.style["border-style"]="dashed";break;case"filter":var y=e.style.filter;n.style.filter=y;break;default:B(e.style[t])||""===e.style[t]||(n.style[t]=e.style[t])}},t.tag="HTMLRendering",t}(),of=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="html-renderer",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){this.addRenderingPlugin(new op)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(aP.F6),og=function(){function t(t){this.canvasConfig=t,this.imageCache={},this.gradientCache={},this.patternCache={}}return t.prototype.getImageSync=function(t,e){return this.imageCache[t]?e&&e(this.imageCache[t]):this.getOrCreateImage(t).then(function(t){e&&e(t)}),this.imageCache[t]},t.prototype.getOrCreateImage=function(t){var e=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var n=this.canvasConfig.createImage;return new Promise(function(i,r){var a;n?a=n(t):aP.jU&&(a=new window.Image),a&&(a.onload=function(){e.imageCache[t]=a,i(a)},a.onerror=function(t){r(t)},a.crossOrigin="Anonymous",a.src=t)})},t.prototype.getOrCreatePatternSync=function(t,e,n,i,r,a){var o,s=this.generatePatternKey(t);if(s&&this.patternCache[s])return this.patternCache[s];var l=t.image,h=t.repetition,c=t.transform,u=!1;W(l)?o=this.getImageSync(l,a):n?(o=n,u=!0):o=l;var d=o&&e.createPattern(o,h);if(d){var p=void 0;p=c?(0,aP.G0)((0,aP.G$)(c),new aP.s$({})):aG.identity(aG.create()),u&&aG.scale(p,p,[1/i,1/i,1]),d.setTransform({a:p[0],b:p[1],c:p[4],d:p[5],e:p[12]+r[0],f:p[13]+r[1]})}return s&&d&&(this.patternCache[s]=d),d},t.prototype.getOrCreateGradient=function(t,e){var n=this.generateGradientKey(t),i=t.type,r=t.steps,a=t.min,o=t.width,s=t.height,l=t.angle,h=t.cx,c=t.cy,u=t.size;if(this.gradientCache[n])return this.gradientCache[n];var d=null;if(i===aP.GL.LinearGradient){var p=(0,aP.Rx)(a,o,s,l),f=p.x1,g=p.y1,y=p.x2,m=p.y2;d=e.createLinearGradient(f,g,y,m)}else if(i===aP.GL.RadialGradient){var v=(0,aP.o6)(a,o,s,h,c,u),b=v.x,x=v.y,E=v.r;d=e.createRadialGradient(b,x,0,b,x,E)}return d&&(r.forEach(function(t){var e=t.offset,n=t.color;e.unit===aP.Cm.kPercentage&&(null==d||d.addColorStop(e.value/100,n.toString()))}),this.gradientCache[n]=d),this.gradientCache[n]},t.prototype.generateGradientKey=function(t){var e=t.type,n=t.min,i=t.width,r=t.height,a=t.steps,o=t.angle,s=t.cx,l=t.cy,h=t.size;return"gradient-".concat(e,"-").concat((null==o?void 0:o.toString())||0,"-").concat((null==s?void 0:s.toString())||0,"-").concat((null==l?void 0:l.toString())||0,"-").concat((null==h?void 0:h.toString())||0,"-").concat(n[0],"-").concat(n[1],"-").concat(i,"-").concat(r,"-").concat(a.map(function(t){var e=t.offset,n=t.color;return"".concat(e).concat(n)}).join("-"))},t.prototype.generatePatternKey=function(t){var e=t.image,n=t.repetition;return W(e)?"pattern-".concat(e,"-").concat(n):"rect"===e.nodeName?"pattern-".concat(e.entity,"-").concat(n):void 0},t}(),oy=function(){function t(){}return t.prototype.apply=function(e){var n=e.renderingService,i=e.renderingContext,r=e.imagePool,a=i.root.ownerDocument.defaultView,o=function(t,e,n){var i=t.parsedStyle,r=i.width,a=i.height;r&&!a?t.setAttribute("height",n/e*r):!r&&a&&t.setAttribute("width",e/n*a)},s=function(t){var e=t.target,i=e.nodeName,a=e.attributes;if(i===aP.bn.IMAGE){var s=a.src,l=a.keepAspectRatio;W(s)&&r.getImageSync(s,function(t){var i=t.width,r=t.height;l&&o(e,i,r),e.renderable.dirty=!0,n.dirtify()})}},l=function(t){var e=t.target,i=t.attrName,a=t.newValue;e.nodeName===aP.bn.IMAGE&&"src"===i&&W(a)&&r.getOrCreateImage(a).then(function(t){var i=t.width,r=t.height;e.attributes.keepAspectRatio&&o(e,i,r),e.renderable.dirty=!0,n.dirtify()})};n.hooks.init.tap(t.tag,function(){a.addEventListener(aP.Dk.MOUNTED,s),a.addEventListener(aP.Dk.ATTR_MODIFIED,l)}),n.hooks.destroy.tap(t.tag,function(){a.removeEventListener(aP.Dk.MOUNTED,s),a.removeEventListener(aP.Dk.ATTR_MODIFIED,l)})},t.tag="LoadImage",t}(),om=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="image-loader",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){this.context.imagePool=new og(this.context.config),this.addRenderingPlugin(new oy)},e.prototype.destroy=function(){this.removeAllRenderingPlugins()},e}(aP.F6),ov=function(){function t(t){this.renderingContext=t.renderingContext,this.canvasConfig=t.config}return t.prototype.init=function(){var t=this.canvasConfig,e=t.container,n=t.canvas;if(n)this.$canvas=n,e&&n.parentElement!==e&&e.appendChild(n),this.$container=n.parentElement,this.canvasConfig.container=this.$container;else if(e&&(this.$container=W(e)?document.getElementById(e):e,this.$container)){var i=document.createElement("canvas");this.$container.appendChild(i),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=i}this.context=this.$canvas.getContext("2d"),this.resize(this.canvasConfig.width,this.canvasConfig.height)},t.prototype.getContext=function(){return this.context},t.prototype.getDomElement=function(){return this.$canvas},t.prototype.getDPR=function(){return this.dpr},t.prototype.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},t.prototype.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},t.prototype.resize=function(t,e){var n=this.canvasConfig.devicePixelRatio||aP.jU&&window.devicePixelRatio||1;n=n>=1?Math.ceil(n):1,this.dpr=n,this.$canvas&&(this.$canvas.width=this.dpr*t,this.$canvas.height=this.dpr*e,(0,aP.$p)(this.$canvas,t,e)),this.renderingContext.renderReasons.add(aP.Rr.CAMERA_CHANGED)},t.prototype.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},t.prototype.toDataURL=function(t){return void 0===t&&(t={}),(0,rA.mG)(this,void 0,void 0,function(){var e,n;return(0,rA.Jh)(this,function(i){return e=t.type,n=t.encoderOptions,[2,this.context.canvas.toDataURL(e,n)]})})},t}(),ob=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.name="canvas-context-register",e}return(0,rA.ZT)(e,t),e.prototype.init=function(){this.context.ContextService=ov},e.prototype.destroy=function(){delete this.context.ContextService},e}(aP.F6),ox=function(t){function e(e){var n=t.call(this,e)||this;return n.registerPlugin(new ob),n.registerPlugin(new om),n.registerPlugin(new aj),n.registerPlugin(new oc),n.registerPlugin(new od),n.registerPlugin(new ot),n.registerPlugin(new of),n}return(0,rA.ZT)(e,t),e}(aP.I8),oE=function(t,e,n){var i,r,a,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:Date.now(),i=null,o=t.apply(r,a),i||(r=a=null)},h=function(){var h=Date.now();s||!1!==n.leading||(s=h);var c=e-(h-s);return r=this,a=arguments,c<=0||c>e?(i&&(clearTimeout(i),i=null),s=h,o=t.apply(r,a),i||(r=a=null)):i||!1===n.trailing||(i=setTimeout(l,c)),o};return h.cancel=function(){clearTimeout(i),s=0,i=r=a=null},h};class ow extends iZ{bindEvents(){let{graph:t}=this.context;t.on(M.AFTER_DRAW,this.onDraw),t.on(M.AFTER_RENDER,this.onRender),t.on(M.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){let{graph:t}=this.context;t.off(M.AFTER_DRAW,this.onDraw),t.off(M.AFTER_RENDER,this.onRender),t.off(M.AFTER_TRANSFORM,this.onTransform)}renderMinimap(){let t=this.getElements(),e=this.initCanvas();this.setShapes(e,t)}getElements(){let{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;let{nodes:i,edges:r,combos:a}=n;return{nodes:i.filter(e=>t(tl(e),"node")),edges:r.filter(e=>t(tl(e),"edge")),combos:a.filter(e=>t(tl(e),"combo"))}}setShapes(t,e){let{nodes:n,edges:i,combos:r}=e,{shape:a}=this.options,{element:o}=this.context;if("key"===a){let e=new Set,a=n=>{let i=tl(n);e.add(i);let r=o.getElement(i);if(!r)return;let a=r.getShape("key"),s=this.shapes.get(i)||a.cloneNode();s.setPosition(a.getPosition()),r.style.zIndex&&(s.style.zIndex=r.style.zIndex),s.id=r.id,this.shapes.has(i)?Object.entries(a.attributes).forEach(t=>{let[e,n]=t;s.style[e]!==n&&(s.style[e]=n)}):(t.appendChild(s),this.shapes.set(i,s))};i.forEach(a),r.forEach(a),n.forEach(a),this.shapes.forEach((n,i)=>{e.has(i)||(t.removeChild(n),this.shapes.delete(i))});return}let s=(t,e)=>{let n=o.getElement(t),i=n.getPosition();return e.setPosition(i),e};t.removeChildren(),i.forEach(e=>t.appendChild(a(tl(e),"edge"))),r.forEach(e=>{t.appendChild(s(tl(e),a(tl(e),"combo")))}),n.forEach(e=>{t.appendChild(s(tl(e),a(tl(e),"node")))})}calculatePosition(){let{position:t,size:[e,n]}=this.options,{canvas:i}=this.context,[r,a]=i.getSize(),[o,s]=tX(t);return[o*(r-e),s*(a-n)]}createContainer(){let{container:t,className:e,size:[n,i],containerStyle:r}=this.options;if(t)return"string"==typeof t?document.querySelector(t):t;let a=document.createElement("div");a.classList.add("g6-minimap"),e&&a.classList.add(e);let[o,s]=this.calculatePosition();return Object.assign(a.style,{position:"absolute",left:o+"px",top:s+"px",width:n+"px",height:i+"px",...r}),this.context.canvas.getContainer().appendChild(a)}initCanvas(){let{renderer:t,size:[e,n]}=this.options;if(this.canvas)this.canvas.resize(e,n),t&&this.canvas.setRenderer(t);else{let i=document.createElement("div"),r=this.createContainer();this.container=r,r.appendChild(i),this.canvas=new I.Xz({width:e,height:n,container:i,renderer:t||new ox})}return this.setCamera(),this.canvas}createLandmark(t,e,n){let i="".concat(t.join(","),"-").concat(e.join(","),"-").concat(n);if(this.landmarkMap.has(i))return this.landmarkMap.get(i);let r=this.canvas.getCamera(),a=r.createLandmark(i,{position:t,focalPoint:e,zoom:n});return this.landmarkMap.set(i,a),a}setCamera(){var t;let{canvas:e}=this.context,n=null===(t=this.canvas)||void 0===t?void 0:t.getCamera();if(!n)return;let{size:[i,r],padding:a}=this.options,[o,s,l,h]=tS(a),{min:c,max:u,center:d}=e.getBounds("elements"),p=u[0]-c[0],f=u[1]-c[1],g=Math.min((i-h-s)/p,(r-o-l)/f),y=this.createLandmark(d,d,g);n.gotoLandmark(y,0)}get maskBBox(){let{canvas:t}=this.context,e=t.getSize(),n=t.getCanvasByViewport([0,0]),i=t.getCanvasByViewport(e),r=this.canvas.canvas2Viewport(t0(n)),a=this.canvas.canvas2Viewport(t0(i)),o=a.x-r.x,s=a.y-r.y;return[r.x,r.y,o,s]}calculateMaskBBox(){let{size:[t,e]}=this.options,[n,i,r,a]=this.maskBBox;return n<0&&(r=oC(r+n,t),n=0),i<0&&(a=oC(a+i,e),i=0),n+r>t&&(r=oS(t-n,0)),i+a>e&&(a=oS(e-i,0)),[oC(n,t),oC(i,e),oS(r,0),oS(a,0)]}renderMask(){let{maskStyle:t}=this.options;this.mask||(this.mask=document.createElement("div"),this.mask.addEventListener("pointerdown",this.onMaskDragStart)),this.container.appendChild(this.mask),Object.assign(this.mask.style,{...t,cursor:"move",position:"absolute",pointerEvents:"auto"}),this.updateMask()}updateMask(){if(!this.mask)return;let[t,e,n,i]=this.calculateMaskBBox();Object.assign(this.mask.style,{top:e+"px",left:t+"px",width:n+"px",height:i+"px"})}destroy(){var t;this.unbindEvents(),this.canvas.destroy(),null===(t=this.mask)||void 0===t||t.remove(),super.destroy()}constructor(t,e){super(t,Object.assign({},ow.defaultOptions,e)),this.onDraw=t=>{var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.render||this.onRender()},this.onRender=oE(()=>{this.renderMinimap(),this.renderMask()},32,{leading:!0}),this.shapes=new Map,this.landmarkMap=new Map,this.mask=null,this.isMaskDragging=!1,this.onMaskDragStart=t=>{this.mask&&(this.isMaskDragging=!0,this.mask.setPointerCapture(t.pointerId),this.mask.addEventListener("pointermove",this.onMaskDrag),this.mask.addEventListener("pointerup",this.onMaskDragEnd),this.mask.addEventListener("pointercancel",this.onMaskDragEnd))},this.onMaskDrag=t=>{if(!this.mask||!this.isMaskDragging)return;let{size:[e,n]}=this.options,{movementX:i,movementY:r}=t,{left:a,top:o,width:s,height:l}=this.mask.style,[,,h,c]=this.maskBBox,u=parseInt(a)+i,d=parseInt(o)+r,p=parseInt(s),f=parseInt(l);u<0&&(u=0),d<0&&(d=0),u+p>e&&(u=oS(e-p,0)),d+f>n&&(d=oS(n-f,0)),p<h&&(i>0?(u=oS(u-i,0),p=oC(p+i,e)):i<0&&(p=oC(p-i,e))),f<c&&(r>0?(d=oS(d-r,0),f=oC(f+r,n)):r<0&&(f=oC(f-r,n))),Object.assign(this.mask.style,{left:u+"px",top:d+"px",width:p+"px",height:f+"px"});let g=parseInt(a)-u,y=parseInt(o)-d;if(0===g&&0===y)return;let m=this.context.canvas.getCamera().getZoom(),v=this.canvas.getCamera().getZoom(),b=m/v;this.context.graph.translateBy([g*b,y*b],!1)},this.onMaskDragEnd=t=>{this.mask&&(this.isMaskDragging=!1,this.mask.releasePointerCapture(t.pointerId),this.mask.removeEventListener("pointermove",this.onMaskDrag),this.mask.removeEventListener("pointerup",this.onMaskDragEnd),this.mask.removeEventListener("pointercancel",this.onMaskDragEnd))},this.onTransform=oE(()=>{this.isMaskDragging||(this.updateMask(),this.setCamera())},32,{leading:!0}),this.bindEvents()}}ow.defaultOptions={size:[240,160],shape:"key",padding:10,position:"right-bottom",maskStyle:{border:"1px solid #ddd",background:"rgba(0, 0, 0, 0.1)"},containerStyle:{border:"1px solid #ddd",background:"#fff"}};let oC=(t,e)=>Math.min(t,e),oS=(t,e)=>Math.max(t,e),oM={x1:0,y1:0,x2:0,y2:0,visibility:"hidden"};class oR extends iZ{getNodes(){var t;let{filter:e}=this.options,n=(null===(t=this.context.element)||void 0===t?void 0:t.getNodes())||[],i=n.filter(t=>{var e;return"hidden"!==eh(t,["style","visibility"])&&(null===(e=this.context.viewport)||void 0===e?void 0:e.isInViewport(t.getRenderBounds()))});return e?i.filter(t=>e(t)):i}hideSnapline(){this.horizontalLine.style.visibility="hidden",this.verticalLine.style.visibility="hidden"}getLineWidth(t){let{lineWidth:e}=this.options["".concat(t,"LineStyle")];return+(e||oM.lineWidth||1)/this.context.graph.getZoom()}updateSnapline(t){let{verticalX:e,verticalMinY:n,verticalMaxY:i,horizontalY:r,horizontalMinX:a,horizontalMaxX:o}=t,[s,l]=this.context.canvas.getSize(),{offset:h}=this.options;null!==r?Object.assign(this.horizontalLine.style,{x1:h===1/0?0:a-h,y1:r,x2:h===1/0?s:o+h,y2:r,visibility:"visible",lineWidth:this.getLineWidth("horizontal")}):this.horizontalLine.style.visibility="hidden",null!==e?Object.assign(this.verticalLine.style,{x1:e,y1:h===1/0?0:n-h,x2:e,y2:h===1/0?l:i+h,visibility:"visible",lineWidth:this.getLineWidth("vertical")}):this.verticalLine.style.visibility="hidden"}getDelta(t){let e=this.context.graph.getZoom();return tj([t.dx,t.dy],e)}async bindEvents(){let{graph:t}=this.context;t.on(O.DRAG_START,this.onDragStart),t.on(O.DRAG,this.onDrag),t.on(O.DRAG_END,this.onDragEnd)}unbindEvents(){let{graph:t}=this.context;t.off(O.DRAG_START,this.onDragStart),t.off(O.DRAG,this.onDrag),t.off(O.DRAG_END,this.onDragEnd)}destroyElements(){var t,e;null===(t=this.horizontalLine)||void 0===t||t.destroy(),null===(e=this.verticalLine)||void 0===e||e.destroy()}destroy(){this.destroyElements(),this.unbindEvents(),super.destroy()}constructor(t,e){super(t,Object.assign({},oR.defaultOptions,e)),this.initSnapline=()=>{let t=this.context.canvas.getLayer("transient");this.horizontalLine||(this.horizontalLine=t.appendChild(new I.x1({style:{...oM,...this.options.horizontalLineStyle}}))),this.verticalLine||(this.verticalLine=t.appendChild(new I.x1({style:{...oM,...this.options.verticalLineStyle}})))},this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!0,this.autoSnapToLine=async(t,e,n)=>{let{verticalX:i,horizontalY:r}=n,{tolerance:a}=this.options,{min:[o,s],max:[l,h],center:[c,u]}=e,d=0,p=0;null!==i&&(oO(l,i)<a&&(d=i-l),oO(o,i)<a&&(d=i-o),oO(c,i)<a&&(d=i-c),0!==d&&(this.isVerticalSticking=!0)),null!==r&&(oO(h,r)<a&&(p=r-h),oO(s,r)<a&&(p=r-s),oO(u,r)<a&&(p=r-u),0!==p&&(this.isHorizontalSticking=!0)),(0!==d||0!==p)&&await this.context.graph.translateElementBy({[t]:[d,p]},!1)},this.enableSnap=t=>{let{target:e}=t;if(this.isHorizontalSticking||this.isVerticalSticking){let[n,i]=this.getDelta(t);if(this.isHorizontalSticking&&this.isVerticalSticking&&.5>=Math.abs(n)&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[-n,-i]},!1),!1;if(this.isHorizontalSticking&&.5>=Math.abs(i))return this.context.graph.translateElementBy({[e.id]:[0,-i]},!1),!1;if(this.isVerticalSticking&&.5>=Math.abs(n))return this.context.graph.translateElementBy({[e.id]:[-n,0]},!1),!1;this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!1,setTimeout(()=>{this.enableStick=!0},200)}return this.enableStick},this.calcSnaplineMetadata=(t,e)=>{let{tolerance:n,shape:i}=this.options,{min:[r,a],max:[o,s],center:[l,h]}=e,c=null,u=null,d=null,p=null,f=null,g=null;return this.getNodes().some(e=>{if(V(t.id,e.id))return!1;let y=oA(e,i).getRenderBounds(),{min:[m,v],max:[b,x],center:[E,w]}=y;return null===c&&(oO(E,l)<n?c=E:oO(m,r)<n?c=m:oO(m,o)<n?c=m:oO(b,o)<n?c=b:oO(b,r)<n&&(c=b),null!==c&&(u=Math.min(v,a),d=Math.max(x,s))),null===p&&(oO(w,h)<n?p=w:oO(v,a)<n?p=v:oO(v,s)<n?p=v:oO(x,s)<n?p=x:oO(x,a)<n&&(p=x),null!==p&&(f=Math.min(m,r),g=Math.max(b,o))),null!==c&&null!==p}),{verticalX:c,verticalMinY:u,verticalMaxY:d,horizontalY:p,horizontalMinX:f,horizontalMaxX:g}},this.onDragStart=()=>{this.initSnapline()},this.onDrag=async t=>{let{target:e}=t;if(this.options.autoSnap){let e=this.enableSnap(t);if(!e)return}let n=oA(e,this.options.shape).getRenderBounds(),i=this.calcSnaplineMetadata(e,n);this.hideSnapline(),(null!==i.verticalX||null!==i.horizontalY)&&this.updateSnapline(i),this.options.autoSnap&&await this.autoSnapToLine(e.id,n,i)},this.onDragEnd=()=>{this.hideSnapline()},this.bindEvents()}}oR.defaultOptions={tolerance:5,offset:20,autoSnap:!0,shape:"key",verticalLineStyle:{stroke:"#1783FF"},horizontalLineStyle:{stroke:"#1783FF"},filter:()=>!0};let oO=(t,e)=>Math.abs(t-e),oA=(t,e)=>"function"==typeof e?e(t):t.getShape(e);function oT(t,e){var n={YYYY:t.getFullYear(),MM:t.getMonth()+1,DD:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds()},i=e;return Object.keys(n).forEach(function(t){var e=n[t];i=i.replace(t,"YYYY"===t?"".concat(e):"".concat(e).padStart(2,"0"))}),i}var ok={data:[],animate:{enter:!1,update:{duration:100,easing:"ease-in-out-sine",fill:"both"},exit:{duration:100,fill:"both"}},showArrow:!0,showGrid:!0,showLabel:!0,showLine:!0,showTick:!0,showTitle:!0,showTrunc:!1,dataThreshold:100,lineLineWidth:1,lineStroke:"black",crossPadding:10,titleFill:"black",titleFontSize:12,titlePosition:"lb",titleSpacing:0,titleTextAlign:"center",titleTextBaseline:"middle",lineArrow:function(){return new I.y$({style:{d:[["M",10,10],["L",-10,0],["L",10,-10],["L",0,0],["L",10,10],["Z"]],fill:"black",transformOrigin:"center"}})},labelAlign:"parallel",labelDirection:"positive",labelFontSize:12,labelSpacing:0,gridConnect:"line",gridControlAngles:[],gridDirection:"positive",gridLength:0,gridType:"segment",lineArrowOffset:15,lineArrowSize:10,tickDirection:"positive",tickLength:5,tickLineWidth:1,tickStroke:"black",labelOverlap:[]};ts({},ok,{style:{type:"arc"}}),ts({},ok,{style:{}});var oP=r0({mainGroup:"main-group",gridGroup:"grid-group",grid:"grid",lineGroup:"line-group",line:"line",tickGroup:"tick-group",tick:"tick",tickItem:"tick-item",labelGroup:"label-group",label:"label",labelItem:"label-item",titleGroup:"title-group",title:"title",lineFirst:"line-first",lineSecond:"line-second"},"axis");function oL(t,e){return[t[0]*e,t[1]*e]}function oD(t,e){return[t[0]+e[0],t[1]+e[1]]}function oN(t,e){return[t[0]-e[0],t[1]-e[1]]}function oI(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1])]}function oB(t,e){return[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}function o_(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function oF(t){if(0===t[0]&&0===t[1])return[0,0];var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]}function oj(t){return t*Math.PI/180}function oz(t){return Number((180*t/Math.PI).toPrecision(5))}function oG(t,e){return t.style.opacity||(t.style.opacity=1),an(t,{opacity:0},e)}var oH=["$el","cx","cy","d","dx","dy","fill","fillOpacity","filter","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","img","increasedLineWidthForHitTesting","innerHTML","isBillboard","billboardRotation","isSizeAttenuation","isClosed","isOverflowing","leading","letterSpacing","lineDash","lineHeight","lineWidth","markerEnd","markerEndOffset","markerMid","markerStart","markerStartOffset","maxLines","metrics","miterLimit","offsetX","offsetY","opacity","path","points","r","radius","rx","ry","shadowColor","src","stroke","strokeOpacity","text","textAlign","textBaseline","textDecorationColor","textDecorationLine","textDecorationStyle","textOverflow","textPath","textPathSide","textPathStartOffset","transform","transformOrigin","visibility","width","wordWrap","wordWrapWidth","x","x1","x2","y","y1","y2","z1","z2","zIndex"];function oW(t){var e={};for(var n in t)oH.includes(n)&&(e[n]=t[n]);return e}var oV=r0({lineGroup:"line-group",line:"line",regionGroup:"region-group",region:"region"},"grid");function oZ(t){return t.reduce(function(t,e,n){return t.push((0,rA.ev)([0===n?"M":"L"],(0,rA.CR)(e),!1)),t},[])}function oU(t,e,n){return"surround"===e.type?function(t,e,n){var i=e.connect,r=e.center;if("line"===(void 0===i?"line":i))return oZ(t);if(!r)return[];var a=o_(t[0],r),o=n?0:1;return t.reduce(function(t,e,n){return 0===n?t.push((0,rA.ev)(["M"],(0,rA.CR)(e),!1)):t.push((0,rA.ev)(["A",a,a,0,0,o],(0,rA.CR)(e),!1)),t},[])}(t,e,n):oZ(t)}var oY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),e.prototype.render=function(t,e){t.type,t.center,t.areaFill,t.closed;var n,i,r,a,o,s=(0,rA._T)(t,["type","center","areaFill","closed"]),l=(i=void 0===(n=t.data)?[]:n,t.closed?i.map(function(t){var e=t.points,n=(0,rA.CR)(e,1)[0];return(0,rA.pi)((0,rA.pi)({},t),{points:(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(e),!1),[n],!1)})}):i),h=rJ(e).maybeAppendByClassName(oV.lineGroup,"g"),c=rJ(e).maybeAppendByClassName(oV.regionGroup,"g"),u=(r=t.animate,a=t.isBillboard,o=l.map(function(e,n){return{id:e.id||"grid-line-".concat(n),d:oU(e.points,t)}}),h.selectAll(oV.line.class).data(o,function(t){return t.id}).join(function(t){return t.append("path").each(function(t,e){var n=r9(oW((0,rA.pi)({d:t.d},s)),[t,e,o]);this.attr((0,rA.pi)({class:oV.line.name,stroke:"#D9D9D9",lineWidth:1,lineDash:[4,4],isBillboard:a},n))})},function(t){return t.transition(function(t,e){return an(this,r9(oW((0,rA.pi)({d:t.d},s)),[t,e,o]),r.update)})},function(t){return t.transition(function(){var t=this,e=oG(this,r.exit);return r7(e,function(){return t.remove()}),e})}).transitions()),d=function(t,e,n){var i=n.animate,r=n.connect,a=n.areaFill;if(e.length<2||!a||!r)return[];for(var o=Array.isArray(a)?a:[a,"transparent"],s=[],l=0;l<e.length-1;l++){var h=(0,rA.CR)([e[l].points,e[l+1].points],2),c=function(t,e,n){var i=n.type,r=n.connect,a=n.center,o=n.closed?[["Z"]]:[],s=(0,rA.CR)([oU(t,n),oU(e.slice().reverse(),n,!0)],2),l=s[0],h=s[1],c=(0,rA.CR)([t[0],e.slice(-1)[0]],2),u=c[0],d=c[1],p=function(t,e){return[l,t,h,e,o].flat()};if("line"===r||"surround"===i)return p([(0,rA.ev)(["L"],(0,rA.CR)(d),!1)],[(0,rA.ev)(["L"],(0,rA.CR)(u),!1)]);if(!a)throw Error("Arc grid need to specified center");var f=(0,rA.CR)([o_(d,a),o_(u,a)],2),g=f[0],y=f[1];return p([(0,rA.ev)(["A",g,g,0,0,1],(0,rA.CR)(d),!1),(0,rA.ev)(["L"],(0,rA.CR)(d),!1)],[(0,rA.ev)(["A",y,y,0,0,0],(0,rA.CR)(u),!1),(0,rA.ev)(["L"],(0,rA.CR)(u),!1)])}(h[0],h[1],n);s.push({d:c,fill:o[l%o.length]})}return t.selectAll(oV.region.class).data(s,function(t,e){return e}).join(function(t){return t.append("path").each(function(t,e){var n=r9(t,[t,e,s]);this.attr(n)}).attr("className",oV.region.name)},function(t){return t.transition(function(t,e){return an(this,r9(t,[t,e,s]),i.update)})},function(t){return t.transition(function(){var t=this,e=oG(this,i.exit);return r7(e,function(){return t.remove()}),e})}).transitions()}(c,l,t);return(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(u),!1),(0,rA.CR)(d),!1)},e}(rV);function oK(t,e){var n={},i=Array.isArray(e)?e:[e];for(var r in t)i.includes(r)||(n[r]=t[r]);return n}function o$(t,e){return Object.fromEntries(Object.entries(t).map(function(t){var n=(0,rA.CR)(t,2);return[n[0],r9(n[1],e)]}))}function oX(t,e){return e&&tx(e)?t.filter(e):t}function oq(t,e){var n=e.startAngle;return(e.endAngle-n)*t+n}function oQ(t,e){if("linear"===e.type){var n=(0,rA.CR)(e.startPos,2),i=n[0],r=n[1],a=(0,rA.CR)(e.endPos,2),o=a[0],s=a[1],l=(0,rA.CR)([o-i,s-r],2);return oF([l[0],l[1]])}var h=oj(oq(t,e));return[-Math.sin(h),Math.cos(h)]}function oJ(t,e,n){var i;return i=oQ(t,n),"positive"!==e?[i[1],-i[0]]:[-i[1],i[0]]}function o0(t,e){return oJ(t,e.labelDirection,e)}function o1(t,e){var n,i,r,a,o,s,l,h,c,u,d,p;return"linear"===e.type?(i=(n=(0,rA.CR)(e.startPos,2))[0],r=n[1],o=(a=(0,rA.CR)(e.endPos,2))[0],s=a[1],l=(0,rA.CR)([o-i,s-r],2),[i+l[0]*t,r+l[1]*t]):(h=e.radius,u=(c=(0,rA.CR)(e.center,2))[0],d=c[1],[u+h*Math.cos(p=oj(oq(t,e))),d+h*Math.sin(p)])}function o2(t){return 0===oQ(0,t)[1]}function o3(t){return 0===oQ(0,t)[0]}function o6(t,e,n,i,r){var a=e-t,o=(0,rA.CR)([r,r],2),s=o[0],l=o[1],h=(0,rA.CR)([oj(t),oj(e)],2),c=h[0],u=h[1],d=function(t){return[n+r*Math.cos(t),i+r*Math.sin(t)]},p=(0,rA.CR)(d(c),2),f=p[0],g=p[1],y=(0,rA.CR)(d(u),2),m=y[0],v=y[1];if(e-t==360){var b=(u+c)/2,x=(0,rA.CR)(d(b),2);return[["M",f,g],["A",s,l,0,1,0,x[0],x[1]],["A",s,l,0,1,0,m,v]]}var E=t>e?0:1;return"M".concat(f,",").concat(g,",A").concat(s,",").concat(l,",0,").concat(a>180?1:0,",").concat(E,",").concat(m,",").concat(v)}function o4(t){var e=(0,rA.CR)(t,2),n=(0,rA.CR)(e[0],2),i=n[0],r=n[1],a=(0,rA.CR)(e[1],2);return{x1:i,y1:r,x2:a[0],y2:a[1]}}function o8(t){var e=t.type,n=t.gridCenter;return"linear"===e?n:n||t.center}function o9(t,e,n,i,r){return void 0===i&&(i=!0),void 0===r&&(r=!1),!!i&&t===e||!!r&&t===n||t>e&&t<n}function o5(t,e){if(e)try{var n=e.replace(/translate\(([+-]*[\d]+[%]*),[ ]*([+-]*[\d]+[%]*)\)/g,function(e,n,i){var r,a,o,s;return"translate(".concat((a=(r=t.getBBox()).width,o=r.height,[(s=(0,rA.CR)([n,i].map(function(t,e){var n;return t.includes("%")?parseFloat((null===(n=t.match(/[+-]?([0-9]*[.])?[0-9]+/))||void 0===n?void 0:n[0])||"0")/100*(0===e?a:o):t}),2))[0],s[1]]),")")});t.attr("transform",n)}catch(t){}}var o7=function(t){return void 0!==t&&null!=t&&!Number.isNaN(t)},st=function(){function t(t,e,n,i){this.set(t,e,n,i)}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.defined("x2")&&this.defined("x1")?this.x2-this.x1:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.defined("y2")&&this.defined("y1")?this.y2-this.y1:void 0},enumerable:!1,configurable:!0}),t.prototype.rotatedPoints=function(t,e,n){var i=this.x1,r=this.y1,a=this.x2,o=this.y2,s=Math.cos(t),l=Math.sin(t),h=e-e*s+n*l,c=n-e*l-n*s;return[[s*i-l*o+h,l*i+s*o+c],[s*a-l*o+h,l*a+s*o+c],[s*i-l*r+h,l*i+s*r+c],[s*a-l*r+h,l*a+s*r+c]]},t.prototype.set=function(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},t.prototype.defined=function(t){return this[t]!==Number.MAX_VALUE&&this[t]!==-Number.MAX_VALUE},t}();function se(t,e){var n=t.getEulerAngles()||0;t.setEulerAngles(0);var i=t.getBounds(),r=(0,rA.CR)(i.min,2),a=r[0],o=r[1],s=(0,rA.CR)(i.max,2),l=s[0],h=s[1],c=t.getBBox(),u=c.width,d=c.height,p=0,f=0,g=a,y=o,m=ay(t);if(m){d-=1.5;var v=m.style.textAlign,b=m.style.textBaseline;"center"===v?g=(a+l)/2:("right"===v||"end"===v)&&(g=l),"middle"===b?y=(o+h)/2:"bottom"===b&&(y=h)}var x=(0,rA.CR)(rN(e),4),E=x[0],w=void 0===E?0:E,C=x[1],S=void 0===C?0:C,M=x[2],R=void 0===M?w:M,O=x[3],A=void 0===O?S:O,T=new st((p+=a)-A,(f+=o)-w,p+u+S,f+d+R);return t.setEulerAngles(n),T.rotatedPoints(oj(n),g,y)}function sn(t,e){return e[0]<=Math.max(t[0][0],t[1][0])&&e[0]<=Math.min(t[0][0],t[1][0])&&e[1]<=Math.max(t[0][1],t[1][1])&&e[1]<=Math.min(t[0][1],t[1][1])}function si(t,e,n){var i=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return 0===i?0:i<0?2:1}function sr(t,e,n){var i,r,a=e.crossPadding,o=new Set,s=null,l=function(t,e){var n=t.type,i=t.labelDirection,r=t.crossSize;if(!r)return!1;if("arc"===n){var a=t.center,o=t.radius,s=(0,rA.CR)(a,2),l=s[0],h=s[1],c="negative"===i?0:r,u=-o-c,d=o+c,p=(0,rA.CR)(rN(e),4),f=p[0],g=p[1],y=p[2],m=p[3];return new st(l+u-m,h+u-f,l+d+g,h+d+y)}var v=(0,rA.CR)(t.startPos,2),b=v[0],x=v[1],E=(0,rA.CR)(t.endPos,2),w=E[0],C=E[1],S=(0,rA.CR)(o3(t)?[-e,0,e,0]:[0,e,0,-e],4),M=S[0],R=S[1],O=S[2],A=S[3],T=oL(o0(0,t),r),k=new st(b,x,w,C);return k.x1+=A,k.y1+=M,k.x2+=R+T[0],k.y2+=O+T[1],k}(e,a);try{for(var h=(0,rA.XA)(t),c=h.next();!c.done;c=h.next()){var u,d=c.value;!function(t){if(l){var e,n,i,r,a;return e=l.x1,n=l.x2,i=l.y1,r=l.y2,a=[[e,i],[n,i],[n,r],[e,r]],se(t,void 0).every(function(t){return function(t,e){var n=t.length;if(n<3)return!1;var i=[e,[9999,e[1]]],r=0,a=0;do{var o=[t[a],t[(a+1)%n]];if(function(t,e){var n=si(t[0],t[1],e[0]),i=si(t[0],t[1],e[1]),r=si(e[0],e[1],t[0]),a=si(e[0],e[1],t[1]);return!!(n!==i&&r!==a||0===n&&sn(t,e[0])||0===i&&sn(t,e[1])||0===r&&sn(e,t[0])||0===a&&sn(e,t[1]))}(o,i)){if(0===si(o[0],e,o[1]))return sn(o,e);r++}a=(a+1)%n}while(0!==a);return!!(1&r)}(a,t)})}return!0}(d)?o.add(d):s&&((u=s)&&u.firstChild?function(t,e,n){var i,r,a=se(t,n).flat(1),o=se(e,n).flat(1),s=[[a[0],a[1],a[2],a[3]],[a[0],a[1],a[4],a[5]],[a[4],a[5],a[6],a[7]],[a[2],a[3],a[6],a[7]]];try{for(var l=(0,rA.XA)(s),h=l.next();!h.done;h=l.next()){var c=h.value;if(function(t,e){return[[t[0],t[1],t[2],t[3]],[t[2],t[3],t[4],t[5]],[t[4],t[5],t[6],t[7]],[t[6],t[7],t[0],t[1]]].some(function(t){return function(t,e){var n=(0,rA.CR)(t,4),i=n[0],r=n[1],a=n[2],o=n[3],s=(0,rA.CR)(e,4),l=s[0],h=s[1],c=s[2],u=s[3],d=a-i,p=o-r,f=c-l,g=u-h,y=d*g-f*p;if(0===y)return!1;var m=y>0,v=i-l,b=r-h,x=d*b-p*v;if(x<0===m)return!1;var E=f*b-g*v;return E<0!==m&&x>y!==m&&E>y!==m}(e,t)})}(o,c))return!0}}catch(t){i={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(i)throw i.error}}return!1}(u.firstChild,d.firstChild,rN(n)):0)?(o.add(s),o.add(d)):s=d}}catch(t){i={error:t}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}return Array.from(o)}function sa(t,e){return(void 0===e&&(e={}),B(t))?0:"number"==typeof t?t:Math.floor(af(t,e))}var so={parity:function(t,e){var n=e.seq,i=void 0===n?2:n;return t.filter(function(t,e){return!(e%i)||(r_(t),!1)})}},ss=new Map([["hide",function(t,e,n,i){var r,a,o=t.length,s=e.keepHeader,l=e.keepTail;if(!(o<=1)&&(2!==o||!s||!l)){var h=so.parity,c=function(t){return t.forEach(i.show),t},u=2,d=t.slice(),p=t.slice(),f=Math.min.apply(Math,(0,rA.ev)([1],(0,rA.CR)(t.map(function(t){return t.getBBox().width})),!1));if("linear"===n.type&&(o2(n)||o3(n))){var g=au(t[0]).left,y=Math.abs(au(t[o-1]).right-g)||1;u=Math.max(Math.floor(o*f/y),u)}for(s&&(r=d.splice(0,1)[0]),l&&(a=d.splice(-1,1)[0],d.reverse()),c(d);u<t.length&&sr((a?(0,rA.ev)((0,rA.ev)([a],(0,rA.CR)(p),!1),[r],!1):(0,rA.ev)([r],(0,rA.CR)(p),!1)).filter(o7),n,null==e?void 0:e.margin).length;){if(a&&!r&&u%2==0){var m=d.splice(0,1);m.forEach(i.hide)}else if(a&&r){var m=d.splice(0,1);m.forEach(i.hide)}p=h(c(d),{seq:u}),u++}}}],["rotate",function(t,e,n,i){var r,a,o=e.optionalAngles,s=e.margin,l=e.recoverWhenFailed,h=t.map(function(t){return t.getLocalEulerAngles()}),c=function(e){return t.forEach(function(t,n){var r=Array.isArray(e)?e[n]:e;i.rotate(t,+r)})};try{for(var u=(0,rA.XA)(void 0===o?[0,45,90]:o),d=u.next();!d.done;d=u.next()){var p=d.value;if(c(p),sr(t,n,s).length<1)return}}catch(t){r={error:t}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}(void 0===l||l)&&c(h)}],["ellipsis",function(t,e,n,i){if(!(t.length<=1)){var r=e.suffix,a=void 0===r?"...":r,o=e.minLength,s=e.maxLength,l=void 0===s?1/0:s,h=e.step,c=e.margin,u=void 0===c?[0,0,0,0]:c,d=ag(i.getTextShape(t[0])),p=sa(void 0===h?" ":h,d),f=o?sa(o,d):p,g=sa(l,d);(B(g)||g===1/0)&&(g=Math.max.apply(null,t.map(function(t){return t.getBBox().width})));var y=t.slice(),m=(0,rA.CR)(u,4);m[0],m[1],m[2],m[3];for(var v=function(e){if(y.forEach(function(t){i.ellipsis(i.getTextShape(t),e,a)}),(y=sr(t,n,u)).length<1)return{value:void 0}},b=g;b>f+p;b-=p){var x=v(b);if("object"==typeof x)return x.value}}}],["wrap",function(t,e,n,i){var r,a,o=e.wordWrapWidth,s=void 0===o?50:o,l=e.maxLines,h=void 0===l?3:l,c=e.recoverWhenFailed,u=e.margin,d=void 0===u?[0,0,0,0]:u,p=t.map(function(t){return t.attr("maxLines")||1}),f=Math.min.apply(Math,(0,rA.ev)([],(0,rA.CR)(p),!1)),g=(r=n.type,a=n.labelDirection,"linear"===r&&o2(n)?"negative"===a?"bottom":"top":"middle"),y=function(e){return t.forEach(function(t,n){var r=Array.isArray(e)?e[n]:e;i.wrap(t,s,r,g)})};if(!(f>h)){for(var m=f;m<=h;m++)if(y(m),sr(t,n,d).length<1)return;(void 0===c||c)&&y(p)}}]]);function sl(t){for(var e=t;e<0;)e+=360;return Math.round(e%360)}function sh(t,e){var n=(0,rA.CR)(t,2),i=n[0],r=n[1],a=(0,rA.CR)(e,2),o=a[0],s=a[1],l=(0,rA.CR)([i*o+r*s,i*s-r*o],2),h=l[0];return Math.atan2(l[1],h)}function sc(t,e,n){var i=n.type,r=n.labelAlign,a=o0(t,n),o=sl(e),s=sl(oz(sh([1,0],a))),l="center",h="middle";return"linear"===i?[90,270].includes(s)&&0===o?(l="center",h=1===a[1]?"top":"bottom"):!(s%180)&&[90,270].includes(o)?l="center":0===s?o9(o,0,90,!1,!0)?l="start":(o9(o,0,90)||o9(o,270,360))&&(l="start"):90===s?o9(o,0,90,!1,!0)?l="start":(o9(o,90,180)||o9(o,270,360))&&(l="end"):270===s?o9(o,0,90,!1,!0)?l="end":(o9(o,90,180)||o9(o,270,360))&&(l="start"):180===s&&(90===o?l="start":(o9(o,0,90)||o9(o,270,360))&&(l="end")):"parallel"===r?h=o9(s,0,180,!0)?"top":"bottom":"horizontal"===r?o9(s,90,270,!1)?l="end":(o9(s,270,360,!1)||o9(s,0,90))&&(l="start"):"perpendicular"===r&&(l=o9(s,90,270)?"end":"start"),{textAlign:l,textBaseline:h}}function su(t,e,n){var i=n.showTick,r=n.tickLength,a=n.tickDirection,o=n.labelDirection,s=n.labelSpacing,l=e.indexOf(t),h=r9(s,[t,l,e]),c=(0,rA.CR)([o0(t.value,n),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(function(t,e){return t*("positive"===e?-1:1)},1)}(o,a)],2),u=c[0],d=1===c[1]?r9(i?r:0,[t,l,e]):0,p=(0,rA.CR)(oD(oL(u,h+d),o1(t.value,n)),2);return{x:p[0],y:p[1]}}function sd(t,e){"text"===t.nodeName&&t.attr(e)}function sp(t){var e,n,i,r;e=this.node().childNodes,n={hide:r_,show:rB,rotate:function(e,n){!function(t,e,n){e.setLocalEulerAngles(t);var i=sc(e.__data__.value,t,n),r=e.querySelector(oP.labelItem.class);r&&sd(r,i)}(+n,e,t)},ellipsis:function(t,e,n){t&&av(t,e||1/0,n)},wrap:function(t,e,n){var i,r;t&&(void 0===(i=n)&&(i=2),void 0===r&&(r="top"),am(t,{wordWrap:!0,wordWrapWidth:e,maxLines:i,textBaseline:r}))},getTextShape:function(t){return t.querySelector("text")}},(r=void 0===(i=t.labelOverlap)?[]:i).length&&r.forEach(function(i){var r=i.type,a=ss.get(r);t.labelOverlap.length<1||("hide"===r?function(t){for(var e=t;e;){if("offscreen"===e.className)return!0;e=e.parent}return!1}(e[0]):"rotate"===r?e.some(function(t){var e;return!!(null===(e=t.attr("transform"))||void 0===e?void 0:e.includes("rotate"))}):("ellipsis"===r||"wrap"===r)&&!(e.filter(function(t){return t.querySelector("text")}).length>1))||null==a||a(e,i,t,n)})}function sf(t,e,n,i,r){var a,o=n.indexOf(e),s=rJ(t).append(tx(a=r.labelFormatter)?function(){return ap(r9(a,[e,o,n,o0(e.value,r)]))}:function(){return ap(e.label||"")}).attr("className",oP.labelItem.name).node(),l=(0,rA.CR)(rX(o$(i,[e,o,n])),2),h=l[0],c=l[1],u=c.transform,d=(0,rA._T)(c,["transform"]);o5(s,u);var p=function(t,e,n){var i,r,a=n.labelAlign;if(null===(r=e.style.transform)||void 0===r?void 0:r.includes("rotate"))return e.getLocalEulerAngles();var o=0,s=o0(t.value,n),l=oQ(t.value,n);return"horizontal"===a?0:(o9(i=(oz(o="perpendicular"===a?sh([1,0],s):sh([l[0]<0?-1:1,0],l))+360)%180,-90,90)||(i+=180),i)}(e,s,r);return s.getLocalEulerAngles()||s.setLocalEulerAngles(p),sd(s,(0,rA.pi)((0,rA.pi)({},sc(e.value,p,r)),h)),t.attr(d),s}function sg(t,e){return oJ(t,e.tickDirection,e)}function sy(t,e,n,i,r,a){var o,s,l,h,c,u,d,p,f,g,y,m,v,b,x,E,w,C,S,M,R,O=(o=rJ(this),s=i.tickFormatter,l=sg(t.value,i),h="line",tx(s)&&(h=function(){return r9(s,[t,e,n,l])}),o.append(h).attr("className",oP.tickItem.name));c=sg(t.value,i),u=i.tickLength,f=(0,rA.CR)((d=r9(u,[t,e,n]),[[0,0],[(p=(0,rA.CR)(c,2))[0]*d,p[1]*d]]),2),y=(g=(0,rA.CR)(f[0],2))[0],m=g[1],x=(b={x1:y,x2:(v=(0,rA.CR)(f[1],2))[0],y1:m,y2:v[1]}).x1,E=b.x2,w=b.y1,C=b.y2,M=(S=(0,rA.CR)(rX(o$(r,[t,e,n,c])),2))[0],R=S[1],"line"===O.node().nodeName&&O.styles((0,rA.pi)({x1:x,x2:E,y1:w,y2:C},M)),this.attr(R),O.styles(M);var A=(0,rA.CR)(o1(t.value,i),2),T=A[0],k=A[1];return an(this,{transform:"translate(".concat(T,", ").concat(k,")")},a)}function sm(t,e,n,i,r){var a=rK(i,"title"),o=(0,rA.CR)(rX(a),2),s=o[0],l=o[1],h=l.transform,c=l.transformOrigin,u=(0,rA._T)(l,["transform","transformOrigin"]);e.styles(u);var d=h||function(t,e,n){var i=2*t.getGeometryBounds().halfExtents[1];if("vertical"===e){if("left"===n)return"rotate(-90) translate(0, ".concat(i/2,")");if("right"===n)return"rotate(-90) translate(0, -".concat(i/2,")")}return""}(t.node(),s.direction,s.position);t.styles((0,rA.pi)((0,rA.pi)({},s),{transformOrigin:c})),o5(t.node(),d);var p=function(t,e,n){var i=n.titlePosition,r=void 0===i?"lb":i,a=n.titleSpacing,o=r3(r),s=t.node().getLocalBounds(),l=(0,rA.CR)(s.min,2),h=l[0],c=l[1],u=(0,rA.CR)(s.halfExtents,2),d=u[0],p=u[1],f=(0,rA.CR)(e.node().getLocalBounds().halfExtents,2),g=f[0],y=f[1],m=(0,rA.CR)([h+d,c+p],2),v=m[0],b=m[1],x=(0,rA.CR)(rN(a),4),E=x[0],w=x[1],C=x[2],S=x[3];if(["start","end"].includes(r)&&"linear"===n.type){var M=n.startPos,R=n.endPos,O=(0,rA.CR)("start"===r?[M,R]:[R,M],2),A=O[0],T=O[1],k=oF([-T[0]+A[0],-T[1]+A[1]]),P=(0,rA.CR)(oL(k,E),2),L=P[0],D=P[1];return{x:A[0]+L,y:A[1]+D}}return o.includes("t")&&(b-=p+y+E),o.includes("r")&&(v+=d+g+w),o.includes("l")&&(v-=d+g+S),o.includes("b")&&(b+=p+y+C),{x:v,y:b}}(rJ(n._offscreen||n.querySelector(oP.mainGroup.class)),e,i),f=p.x,g=p.y;return an(e.node(),{transform:"translate(".concat(f,", ").concat(g,")")},r)}function sv(t,e,n,i){var r=t.showLine,a=t.showTick,o=t.showLabel,s=r1(r,e.maybeAppendByClassName(oP.lineGroup,"g"),function(e){var n,r,a,o,s,l,h,c,u,d,p;return n=e,r=t,a=i,d=r.type,p=rK(r,"line"),"linear"===d?u=function(t,e,n,i){var r,a,o,s,l,h,c,u,d,p,f,g,y,m,v,b,x,E,w=e.showTrunc,C=e.startPos,S=e.endPos,M=e.truncRange,R=e.lineExtension,O=(0,rA.CR)([C,S],2),A=(0,rA.CR)(O[0],2),T=A[0],k=A[1],P=(0,rA.CR)(O[1],2),L=P[0],D=P[1],N=(0,rA.CR)(R?(void 0===(r=R)&&(r=[0,0]),a=(0,rA.CR)([C,S,r],3),s=(o=(0,rA.CR)(a[0],2))[0],l=o[1],c=(h=(0,rA.CR)(a[1],2))[0],u=h[1],p=(d=(0,rA.CR)(a[2],2))[0],f=d[1],v=Math.sqrt(Math.pow(y=(g=(0,rA.CR)([c-s,u-l],2))[0],2)+Math.pow(m=g[1],2)),[(x=(b=(0,rA.CR)([-p/v,f/v],2))[0])*y,x*m,(E=b[1])*y,E*m]):[,,,,].fill(0),4),I=N[0],B=N[1],_=N[2],F=N[3],j=function(e){return t.selectAll(oP.line.class).data(e,function(t,e){return e}).join(function(t){return t.append("line").attr("className",function(t){return"".concat(oP.line.name," ").concat(t.className)}).styles(n).transition(function(t){return an(this,o4(t.line),!1)})},function(t){return t.styles(n).transition(function(t){return an(this,o4(t.line),i.update)})},function(t){return t.remove()}).transitions()};if(!w||!M)return j([{line:[[T+I,k+B],[L+_,D+F]],className:oP.line.name}]);var z=(0,rA.CR)(M,2),G=z[0],H=z[1],W=L-T,V=D-k,Z=(0,rA.CR)([T+W*G,k+V*G],2),U=Z[0],Y=Z[1],K=(0,rA.CR)([T+W*H,k+V*H],2),$=K[0],X=K[1],q=j([{line:[[T+I,k+B],[U,Y]],className:oP.lineFirst.name},{line:[[$,X],[L+_,D+F]],className:oP.lineSecond.name}]);return e.truncRange,e.truncShape,e.lineExtension,q}(n,r,oK(p,"arrow"),a):(o=oK(p,"arrow"),s=r.startAngle,l=r.endAngle,h=r.center,c=r.radius,u=n.selectAll(oP.line.class).data([{d:o6.apply(void 0,(0,rA.ev)((0,rA.ev)([s,l],(0,rA.CR)(h),!1),[c],!1))}],function(t,e){return e}).join(function(t){return t.append("path").attr("className",oP.line.name).styles(r).styles({d:function(t){return t.d}})},function(t){return t.transition(function(){var t,e,n,i,r,o=this,u=function(t,e,n,i){if(!i)return t.attr("__keyframe_data__",n),null;var r=i.duration,a=function t(e,n){var i,r,a,o,s,l;return"number"==typeof e&&"number"==typeof n?function(t){return e*(1-t)+n*t}:Array.isArray(e)&&Array.isArray(n)?(i=n?n.length:0,r=e?Math.min(i,e.length):0,function(a){var o=Array(r),s=Array(i),l=0;for(l=0;l<r;++l)o[l]=t(e[l],n[l]);for(;l<i;++l)s[l]=n[l];for(l=0;l<r;++l)s[l]=o[l](a);return s}):"object"==typeof e&&"object"==typeof n?(void 0===(a=e)&&(a={}),void 0===(o=n)&&(o={}),s={},l={},Object.entries(o).forEach(function(e){var n=(0,rA.CR)(e,2),i=n[0],r=n[1];i in a?s[i]=t(a[i],r):l[i]=r}),function(t){return Object.entries(s).forEach(function(e){var n=(0,rA.CR)(e,2),i=n[0],r=n[1];return l[i]=r(t)}),l}):function(t){return e}}(e,n),o=Array(Math.ceil(+(void 0===r?0:r)/16)).fill(0).map(function(t,e,n){return{__keyframe_data__:a(e/(n.length-1))}});return t.animate(o,(0,rA.pi)({fill:"both"},i))}(this,(e=(t=this.attributes).startAngle,n=t.endAngle,i=t.center,r=t.radius,(0,rA.ev)((0,rA.ev)([e,n],(0,rA.CR)(i),!1),[r],!1)),(0,rA.ev)((0,rA.ev)([s,l],(0,rA.CR)(h),!1),[c],!1),a.update);if(u){var d=function(){var t=eh(o.attributes,"__keyframe_data__");o.style.d=o6.apply(void 0,(0,rA.ev)([],(0,rA.CR)(t),!1))};u.onframe=d,u.onfinish=d}return u}).styles(r)},function(t){return t.remove()}).styles(o).transitions()),!function(t,e,n,i){var r,a,o=n.showArrow,s=n.showTrunc,l=n.lineArrow,h=n.lineArrowOffset,c=n.lineArrowSize;if(a="arc"===e?t.select(oP.line.class):s?t.select(oP.lineSecond.class):t.select(oP.line.class),!o||!l||"arc"===n.type&&(r=n.startAngle,n.endAngle-r==360)){var u=a.node();u&&(u.style.markerEnd=void 0);return}var d=ap(l);d.attr(i),ai(d,c,!0),a.style("markerEnd",d).style("markerEndOffset",-h)}(n,d,r,p),u})||[],l=r1(a,e.maybeAppendByClassName(oP.tickGroup,"g"),function(e){var r,a;return r=oX(n,t.tickFilter),a=rK(t,"tick"),e.selectAll(oP.tick.class).data(r,function(t){return t.id||t.label}).join(function(e){return e.append("g").attr("className",oP.tick.name).transition(function(e,n){return sy.call(this,e,n,r,t,a,!1)})},function(e){return e.transition(function(e,n){return this.removeChildren(),sy.call(this,e,n,r,t,a,i.update)})},function(t){return t.transition(function(){var t=this,e=oG(this.childNodes[0],i.exit);return r7(e,function(){return t.remove()}),e})}).transitions()})||[],h=r1(o,e.maybeAppendByClassName(oP.labelGroup,"g"),function(e){var r,a;return r=oX(n,t.labelFilter),a=rK(t,"label"),e.selectAll(oP.label.class).data(r,function(t,e){return e}).join(function(i){return i.append("g").attr("className",oP.label.name).transition(function(e){sf(this,e,n,a,t);var i=su(e,n,t),r=i.x,o=i.y;return this.style.transform="translate(".concat(r,", ").concat(o,")"),null}).call(function(){sp.call(e,t)})},function(r){return r.transition(function(e){var r=function(t,e,n,i){if(void 0===i&&(i="destroy"),"text"===t.nodeName&&"text"===e.nodeName&&t.attributes.text===e.attributes.text)return t.remove(),[null];var r=function(){"destroy"===i?t.destroy():"hide"===i&&r_(t),e.isVisible()&&rB(e)};if(!n)return r(),[null];var a=n.duration,o=void 0===a?0:a,s=n.delay,l=void 0===s?0:s,h=Math.ceil(+o/2),c=+o/4,u=(0,rA.CR)(t.getGeometryBounds().center,2),d=u[0],p=u[1],f=(0,rA.CR)(e.getGeometryBounds().center,2),g=f[0],y=f[1],m=(0,rA.CR)([(d+g)/2-d,(p+y)/2-p],2),v=m[0],b=m[1],x=t.style.opacity,E=e.style.opacity,w=t.style.transform||"",C=e.style.transform||"",S=t.animate([{opacity:void 0===x?1:x,transform:"translate(0, 0) ".concat(w)},{opacity:0,transform:"translate(".concat(v,", ").concat(b,") ").concat(w)}],(0,rA.pi)((0,rA.pi)({fill:"both"},n),{duration:l+h+c})),M=e.animate([{opacity:0,transform:"translate(".concat(-v,", ").concat(-b,") ").concat(C),offset:.01},{opacity:void 0===E?1:E,transform:"translate(0, 0) ".concat(C)}],(0,rA.pi)((0,rA.pi)({fill:"both"},n),{duration:h+c,delay:l+h-c}));return r7(M,r),[S,M]}(this.querySelector(oP.labelItem.class),sf(this,e,n,a,t),i.update),o=su(e,n,t),s=o.x,l=o.y,h=an(this,{transform:"translate(".concat(s,", ").concat(l,")")},i.update);return(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(r),!1),[h],!1)}).call(function(n){var i,r;i=eh(n,"_transitions").flat().filter(o7),r=function(){sp.call(e,t)},0===i.length?r():Promise.all(i.map(function(t){return null==t?void 0:t.finished})).then(r)})},function(t){return t.transition(function(){var t=this,e=oG(this.childNodes[0],i.exit);return r7(e,function(){return rJ(t).remove()}),e})}).transitions()})||[];return(0,rA.ev)((0,rA.ev)((0,rA.ev)([],(0,rA.CR)(s),!1),(0,rA.CR)(l),!1),(0,rA.CR)(h),!1).filter(function(t){return!!t})}var sb=function(t){function e(e){return t.call(this,e,ok)||this}return(0,rA.ZT)(e,t),e.prototype.render=function(t,e,n){var i=this,r=t.titleText,a=t.data,o=t.animate,s=t.showTitle,l=t.showGrid,h=t.dataThreshold,c=t.truncRange,u=(function(t,e){if(t.length<=e)return t;for(var n=Math.floor(t.length/e),i=[],r=0;r<t.length;r+=n)i.push(t[r]);return i})(a,h).filter(function(t){var e=t.value;return!c||!(e>c[0])||!(e<c[1])}),d=r5(void 0===n?o:n),p=r1(l,rJ(e).maybeAppendByClassName(oP.gridGroup,"g"),function(e){var n,i,r,a,o,s,l,h;return i=(n=rK(t,"grid")).type,r=n.areaFill,a=o8(t),o=oX(u,t.gridFilter),l="segment"===i?(s=t.gridLength,o.map(function(e,n){var i=e.value,r=(0,rA.CR)(o1(i,t),2),a=r[0],o=r[1],l=(0,rA.CR)(oL(oJ(i,t.gridDirection,t),s),2);return{id:n,points:[[a,o],[a+l[0],o+l[1]]]}})):function(t,e){var n=e.gridControlAngles,i=o8(e);if(!i)throw Error("grid center is not provide");if(t.length<2)throw Error("Invalid grid data");if(!n||0===n.length)throw Error("Invalid gridControlAngles");var r=(0,rA.CR)(i,2),a=r[0],o=r[1];return t.map(function(t,i){var r=t.value,s=(0,rA.CR)(o1(r,e),2),l=s[0],h=s[1],c=(0,rA.CR)([l-a,h-o],2),u=c[0],d=c[1],p=[];return n.forEach(function(t){var e=oj(t),n=(0,rA.CR)([Math.cos(e),Math.sin(e)],2),i=n[0],r=n[1],s=u*i-d*r+a,l=u*r+d*i+o;p.push([s,l])}),{points:p,id:i}})}(o,t),h=(0,rA.pi)((0,rA.pi)({},n),{center:a,areaFill:tx(r)?o.map(function(t,e){return r9(r,[t,e,o])}):r,animate:d,data:l}),e.selectAll(oP.grid.class).data([1]).join(function(t){return t.append(function(){return new oY({style:h})}).attr("className",oP.grid.name)},function(t){return t.transition(function(){return this.update(h)})},function(t){return t.remove()}).transitions()})||[],f=rJ(e).maybeAppendByClassName(oP.mainGroup,"g");r&&(!this.initialized&&d.enter||this.initialized&&d.update)&&sv(t,rJ(this.offscreenGroup),u,r5(!1));var g=sv(t,rJ(f.node()),u,d),y=r1(s,rJ(e).maybeAppendByClassName(oP.titleGroup,"g"),function(e){var n;return n=t.titleText,e.selectAll(oP.title.class).data([{title:n}].filter(function(t){return!!t.title}),function(t,e){return t.title}).join(function(r){return r.append(function(){return ap(n)}).attr("className",oP.title.name).transition(function(){return sm(rJ(this),e,i,t,d.enter)})},function(n){return n.transition(function(){return sm(rJ(this),e,i,t,d.update)})},function(t){return t.remove()}).transitions()})||[];return(0,rA.ev)((0,rA.ev)((0,rA.ev)([],(0,rA.CR)(p),!1),(0,rA.CR)(g),!1),(0,rA.CR)(y),!1).flat().filter(function(t){return!!t})},e}(rV);function sx(t){var e=t.canvas,n=t.touches,i=t.offsetX,r=t.offsetY;if(e)return[e.x,e.y];if(n){var a=n[0];return[a.clientX,a.clientY]}return i&&r?[i,r]:[0,0]}function sE(t,e){return+t.toPrecision(e)}var sw=n(36380),sC=n(88944),sS=function(t){function e(e){var n=this,i=e.style,r=(0,rA._T)(e,["style"]);return(n=t.call(this,ts({},{type:"column"},(0,rA.pi)({style:i},r)))||this).columnsGroup=new I.ZA({name:"columns"}),n.appendChild(n.columnsGroup),n.render(),n}return(0,rA.ZT)(e,t),e.prototype.render=function(){var t=this.attributes,e=t.columns,n=t.x,i=t.y;this.columnsGroup.style.transform="translate(".concat(n,", ").concat(i,")"),rJ(this.columnsGroup).selectAll(".column").data(e.flat()).join(function(t){return t.append("rect").attr("className","column").each(function(t){this.attr(t)})},function(t){return t.each(function(t){this.attr(t)})},function(t){return t.remove()})},e.prototype.update=function(t){this.attr(rz({},this.attributes,t)),this.render()},e.prototype.clear=function(){this.removeChildren()},e}(I.s$),sM=function(t){function e(e){var n=this,i=e.style,r=(0,rA._T)(e,["style"]);return(n=t.call(this,ts({},{type:"lines"},(0,rA.pi)({style:i},r)))||this).linesGroup=n.appendChild(new I.ZA),n.areasGroup=n.appendChild(new I.ZA),n.render(),n}return(0,rA.ZT)(e,t),e.prototype.render=function(){var t=this.attributes,e=t.lines,n=t.areas,i=t.x,r=t.y;this.style.transform="translate(".concat(i,", ").concat(r,")"),e&&this.renderLines(e),n&&this.renderAreas(n)},e.prototype.clear=function(){this.linesGroup.removeChildren(),this.areasGroup.removeChildren()},e.prototype.update=function(t){this.attr(rz({},this.attributes,t)),this.render()},e.prototype.renderLines=function(t){rJ(this.linesGroup).selectAll(".line").data(t).join(function(t){return t.append("path").attr("className","line").each(function(t){this.attr(t)})},function(t){return t.each(function(t){this.attr(t)})},function(t){return t.remove()})},e.prototype.renderAreas=function(t){rJ(this.linesGroup).selectAll(".area").data(t).join(function(t){return t.append("path").attr("className","area").each(function(t){this.attr(t)})},function(t){return t.each(function(t){this.style(t)})},function(t){return t.remove()})},e}(I.s$);function sR(t,e){void 0===e&&(e=!1);var n=e?t.length-1:0,i=t.map(function(t,e){return(0,rA.ev)([e===n?"M":"L"],(0,rA.CR)(t),!1)});return e?i.reverse():i}function sO(t,e){if(void 0===e&&(e=!1),t.length<=2)return sR(t);for(var n=[],i=t.length,r=0;r<i;r+=1){var a=e?t[i-r-1]:t[r];V(a,n.slice(-2))||n.push.apply(n,(0,rA.ev)([],(0,rA.CR)(a),!1))}var o=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=[[0,0],[1,1]]);for(var i,r,a,o=!!e,s=[],l=0,h=t.length;l<h;l+=2)s.push([t[l],t[l+1]]);for(var c=function(t,e,n,i){var r,a,o,s,l,h,c=[],u=!!i,d=[1/0,1/0],p=[-1/0,-1/0];if(u){d=(r=(0,rA.CR)(i,2))[0],p=r[1];for(var f=0,g=t.length;f<g;f+=1){var y=t[f];d=oI(d,y),p=oB(p,y)}}for(var f=0,m=t.length;f<m;f+=1){var y=t[f];if(0!==f||n){if(f!==m-1||n){a=t[[f?f-1:m-1,f-1][n?0:1]];var v=[0,0];v=oL(v=oN(o=t[n?(f+1)%m:f+1],a),.4);var b=o_(y,a),x=o_(y,o),E=b+x;0!==E&&(b/=E,x/=E);var w=oL(v,-b),C=oL(v,x);l=oD(y,w),s=oI(s=oD(y,C),oB(o,y)),w=oL(w=oN(s=oB(s,oI(o,y)),y),-b/x),l=oI(l=oD(y,w),oB(a,y)),l=oB(l,oI(a,y)),C=oL(C=oN(y,l),x/b),s=oD(y,C),u&&(l=oI(l=oB(l,d),p),s=oI(s=oB(s,d),p)),c.push(h),c.push(l),h=s}else l=y,c.push(h),c.push(l)}else h=y}return n&&c.push(c.shift()),c}(s,0,o,n),u=s.length,d=[],l=0;l<u-1;l+=1)i=c[2*l],r=c[2*l+1],a=s[l+1],d.push(["C",i[0],i[1],r[0],r[1],a[0],a[1]]);return o&&(i=c[u],r=c[u+1],a=(0,rA.CR)(s,1)[0],d.push(["C",i[0],i[1],r[0],r[1],a[0],a[1]])),d}(n,!1);return e?o.unshift((0,rA.ev)(["M"],(0,rA.CR)(t[i-1]),!1)):o.unshift((0,rA.ev)(["M"],(0,rA.CR)(t[0]),!1)),o}function sA(t,e,n){var i=tE(t);return i.push(["L",e,n],["L",0,n],["Z"]),i}var sT=function(t){if(ta(t))return t.reduce(function(t,e){return Math.min(t,e)},t[0])},sk=function(t,e){if(ta(t)){for(var n,i=1/0,r=0;r<t.length;r++){var a=t[r],o=tx(e)?e(a):a[e];o<i&&(n=a,i=o)}return n}},sP=function(t){if(ta(t))return t.reduce(function(t,e){return Math.max(t,e)},t[0])},sL=function(t,e){if(ta(t)){for(var n,i=-1/0,r=0;r<t.length;r++){var a=t[r],o=tx(e)?e(a):a[e];o>i&&(n=a,i=o)}return n}};function sD(t){return 0===t.length?[0,0]:[sT(sk(t,function(t){return sT(t)||0})),sP(sL(t,function(t){return sP(t)||0}))]}function sN(t){for(var e=tE(t),n=e[0].length,i=(0,rA.CR)([Array(n).fill(0),Array(n).fill(0)],2),r=i[0],a=i[1],o=0;o<e.length;o+=1)for(var s=e[o],l=0;l<n;l+=1)s[l]>=0?(s[l]+=r[l],r[l]=s[l]):(s[l]+=a[l],a[l]=s[l]);return e}var sI=function(t){function e(e){return t.call(this,e,{type:"line",x:0,y:0,width:200,height:20,isStack:!1,color:["#83daad","#edbf45","#d2cef9","#e290b3","#6f63f4"],smooth:!0,lineLineWidth:1,areaOpacity:0,isGroup:!1,columnLineWidth:1,columnStroke:"#fff",scale:1,spacing:0})||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"rawData",{get:function(){var t=this.attributes.data;if(!t||(null==t?void 0:t.length)===0)return[[]];var e=tE(t);return ec(e[0])?[e]:e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.isStack?sN(this.rawData):this.rawData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scales",{get:function(){return this.createScales(this.data)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseline",{get:function(){var t=this.scales.y,e=(0,rA.CR)(t.getOptions().domain||[0,0],2),n=e[0],i=e[1];return i<0?t.map(i):t.map(n<0?0:n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"containerShape",{get:function(){var t=this.attributes;return{width:t.width,height:t.height}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linesStyle",{get:function(){var t=this,e=this.attributes,n=e.type,i=e.isStack,r=e.smooth;if("line"!==n)throw Error("linesStyle can only be used in line type");var a=rK(this.attributes,"area"),o=rK(this.attributes,"line"),s=this.containerShape.width,l=this.data;if(0===l[0].length)return{lines:[],areas:[]};var h=this.scales,c=(f=(d={type:"line",x:h.x,y:h.y}).x,g=d.y,m=(y=(0,rA.CR)(g.getOptions().range||[0,0],2))[0],(v=y[1])>m&&(v=(p=(0,rA.CR)([m,v],2))[0],m=p[1]),l.map(function(t){return t.map(function(t,e){return[f.map(e),iC(g.map(t),v,m)]})})),u=[];if(a){var d,p,f,g,y,m,v,b=this.baseline;u=i?r?function(t,e,n){for(var i=[],r=t.length-1;r>=0;r-=1){var a=t[r],o=sO(a),s=void 0;if(0===r)s=sA(o,e,n);else{var l=sO(t[r-1],!0),h=a[0];l[0][0]="L",s=(0,rA.ev)((0,rA.ev)((0,rA.ev)([],(0,rA.CR)(o),!1),(0,rA.CR)(l),!1),[(0,rA.ev)(["M"],(0,rA.CR)(h),!1),["Z"]],!1)}i.push(s)}return i}(c,s,b):function(t,e,n){for(var i=[],r=t.length-1;r>=0;r-=1){var a=sR(t[r]),o=void 0;if(0===r)o=sA(a,e,n);else{var s=sR(t[r-1],!0);s[0][0]="L",o=(0,rA.ev)((0,rA.ev)((0,rA.ev)([],(0,rA.CR)(a),!1),(0,rA.CR)(s),!1),[["Z"]],!1)}i.push(o)}return i}(c,s,b):c.map(function(t){return sA(r?sO(t):sR(t),s,b)})}return{lines:c.map(function(e,n){return(0,rA.pi)({stroke:t.getColor(n),d:r?sO(e):sR(e)},o)}),areas:u.map(function(e,n){return(0,rA.pi)({d:e,fill:t.getColor(n)},a)})}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columnsStyle",{get:function(){var t=this,e=rK(this.attributes,"column"),n=this.attributes,i=n.isStack,r=n.type,a=n.scale;if("column"!==r)throw Error("columnsStyle can only be used in column type");var o=this.containerShape.height,s=this.rawData;if(!s)return{columns:[]};i&&(s=sN(s));var l=this.createScales(s),h=l.x,c=l.y,u=(0,rA.CR)(sD(s),2),d=u[0],p=u[1],f=new sw.b({domain:[0,p-(d>0?0:d)],range:[0,o*a]}),g=h.getBandWidth(),y=this.rawData;return{columns:s.map(function(n,r){return n.map(function(n,a){var o=g/s.length;return(0,rA.pi)((0,rA.pi)({fill:t.getColor(r)},e),i?{x:h.map(a),y:c.map(n),width:g,height:f.map(y[r][a])}:{x:h.map(a)+o*r,y:n>=0?c.map(n):c.map(0),width:o,height:f.map(Math.abs(n))})})})}},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){(n=".container",e.querySelector(n)?rJ(e).select(n):rJ(e).append("rect")).attr("className","container").node();var n,i=t.type,r=t.x,a=t.y,o="spark".concat(i),s=(0,rA.pi)({x:r,y:a},"line"===i?this.linesStyle:this.columnsStyle);rJ(e).selectAll(".spark").data([i]).join(function(t){return t.append(function(t){return"line"===t?new sM({className:o,style:s}):new sS({className:o,style:s})}).attr("className","spark ".concat(o))},function(t){return t.update(s)},function(t){return t.remove()})},e.prototype.getColor=function(t){var e=this.attributes.color;return ta(e)?e[t%e.length]:tx(e)?e.call(null,t):e},e.prototype.createScales=function(t){var e,n,i=this.attributes,r=i.type,a=i.scale,o=i.range,s=void 0===o?[]:o,l=i.spacing,h=this.containerShape,c=h.width,u=h.height,d=(0,rA.CR)(sD(t),2),p=d[0],f=d[1],g=new sw.b({domain:[null!==(e=s[0])&&void 0!==e?e:p,null!==(n=s[1])&&void 0!==n?n:f],range:[u,u*(1-a)]});return"line"===r?{type:r,x:new sw.b({domain:[0,t[0].length-1],range:[0,c]}),y:g}:{type:r,x:new sC.t({domain:t[0].map(function(t,e){return e}),range:[0,c],paddingInner:l,paddingOuter:l/2,align:.5}),y:g}},e.tag="sparkline",e}(rV),sB={fill:"#fff",lineWidth:1,radius:2,size:10,stroke:"#bfbfbf",strokeOpacity:1,zIndex:0},s_={fill:"#000",fillOpacity:.45,fontSize:12,textAlign:"center",textBaseline:"middle",zIndex:1},sF={x:0,y:0,orientation:"horizontal",showLabel:!0,type:"start"},sj=r0({foreground:"foreground",handle:"handle",selection:"selection",sparkline:"sparkline",sparklineGroup:"sparkline-group",track:"track",brushArea:"brush-area"},"slider"),sz=r0({labelGroup:"label-group",label:"label",iconGroup:"icon-group",icon:"icon",iconRect:"icon-rect",iconLine:"icon-line"},"handle"),sG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),e.prototype.render=function(t,e){var n=t.x,i=t.y,r=t.size,a=void 0===r?10:r,o=t.radius,s=t.orientation,l=(0,rA._T)(t,["x","y","size","radius","orientation"]),h=2.4*a,c=rJ(e).maybeAppendByClassName(sz.iconRect,"rect").styles((0,rA.pi)((0,rA.pi)({},l),{width:a,height:h,radius:void 0===o?a/4:o,x:n-a/2,y:i-h/2,transformOrigin:"center"})),u=n+1/3*a-a/2,d=n+2/3*a-a/2,p=i+1/4*h-h/2,f=i+3/4*h-h/2;c.maybeAppendByClassName("".concat(sz.iconLine,"-1"),"line").styles((0,rA.pi)({x1:u,x2:u,y1:p,y2:f},l)),c.maybeAppendByClassName("".concat(sz.iconLine,"-2"),"line").styles((0,rA.pi)({x1:d,x2:d,y1:p,y2:f},l)),"vertical"===s&&(c.node().style.transform="rotate(90)")},e}(rV),sH=function(t){function e(e){return t.call(this,e,sF)||this}return(0,rA.ZT)(e,t),e.prototype.renderLabel=function(t){var e=this,n=this.attributes,i=n.x,r=n.y,a=n.showLabel,o=rK(this.attributes,"label"),s=o.x,l=void 0===s?0:s,h=o.y,c=void 0===h?0:h,u=o.transform,d=o.transformOrigin,p=(0,rA._T)(o,["x","y","transform","transformOrigin"]),f=(0,rA.CR)(rX(p,[]),2),g=f[0],y=f[1],m=rJ(t).maybeAppendByClassName(sz.labelGroup,"g").styles(y),v=(0,rA.pi)((0,rA.pi)({},s_),g),b=v.text,x=(0,rA._T)(v,["text"]);r1(!!a,m,function(t){e.label=t.maybeAppendByClassName(sz.label,"text").styles((0,rA.pi)((0,rA.pi)({},x),{x:i+l,y:r+c,transform:u,transformOrigin:d,text:"".concat(b)})),e.label.on("mousedown",function(t){t.stopPropagation()}),e.label.on("touchstart",function(t){t.stopPropagation()})})},e.prototype.renderIcon=function(t){var e=this.attributes,n=e.x,i=e.y,r=e.orientation,a=e.type,o=(0,rA.pi)((0,rA.pi)({x:n,y:i,orientation:r},sB),rK(this.attributes,"icon")),s=this.attributes.iconShape,l=void 0===s?function(){return new sG({style:o})}:s;rJ(t).maybeAppendByClassName(sz.iconGroup,"g").selectAll(sz.icon.class).data([l]).join(function(t){return t.append("string"==typeof l?l:function(){return l(a)}).attr("className",sz.icon.name)},function(t){return t.update(o)},function(t){return t.remove()})},e.prototype.render=function(t,e){this.renderIcon(e),this.renderLabel(e)},e}(rV),sW=function(t){function e(e){var n=t.call(this,e,(0,rA.pi)((0,rA.pi)((0,rA.pi)({x:0,y:0,animate:{duration:100,fill:"both"},brushable:!0,formatter:function(t){return t.toString()},handleSpacing:2,orientation:"horizontal",padding:0,autoFitLabel:!0,scrollable:!0,selectionFill:"#5B8FF9",selectionFillOpacity:.45,selectionZIndex:2,showHandle:!0,showLabel:!0,slidable:!0,trackFill:"#416180",trackLength:200,trackOpacity:.05,trackSize:20,trackZIndex:-1,values:[0,1],type:"range",selectionType:"select",handleIconOffset:0},r$(sF,"handle")),r$(sB,"handleIcon")),r$(s_,"handleLabel")))||this;return n.range=[0,1],n.onDragStart=function(t){return function(e){e.stopPropagation(),n.target=t,n.prevPos=n.getOrientVal(sx(e));var i=n.availableSpace,r=i.x,a=i.y,o=n.getBBox(),s=o.x,l=o.y;n.selectionStartPos=n.getRatio(n.prevPos-n.getOrientVal([r,a])-n.getOrientVal([+s,+l])),n.selectionWidth=0,document.addEventListener("pointermove",n.onDragging),document.addEventListener("pointerup",n.onDragEnd)}},n.onDragging=function(t){var e=n.attributes,i=e.slidable,r=e.brushable,a=e.type;t.stopPropagation();var o=n.getOrientVal(sx(t)),s=o-n.prevPos;if(s){var l=n.getRatio(s);switch(n.target){case"start":i&&n.setValuesOffset(l);break;case"end":i&&n.setValuesOffset(0,l);break;case"selection":i&&n.setValuesOffset(l,l);break;case"track":if(!r)return;n.selectionWidth+=l,"range"===a?n.innerSetValues([n.selectionStartPos,n.selectionStartPos+n.selectionWidth].sort(),!0):n.innerSetValues([0,n.selectionStartPos+n.selectionWidth],!0)}n.prevPos=o}},n.onDragEnd=function(){document.removeEventListener("pointermove",n.onDragging),document.removeEventListener("pointermove",n.onDragging),document.removeEventListener("pointerup",n.onDragEnd),n.target="",n.updateHandlesPosition(!1)},n.onValueChange=function(t){var e=n.attributes,i=e.onChange,r=e.type,a="range"===r?t:t[1],o="range"===r?n.getValues():n.getValues()[1],s=new I.Aw("valuechange",{detail:{oldValue:a,value:o}});n.dispatchEvent(s),null==i||i(o)},n.selectionStartPos=0,n.selectionWidth=0,n.prevPos=0,n.target="",n}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"values",{get:function(){return this.attributes.values},set:function(t){this.attributes.values=this.clampValues(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sparklineStyle",{get:function(){if("horizontal"!==this.attributes.orientation)return null;var t=rK(this.attributes,"sparkline");return(0,rA.pi)((0,rA.pi)({zIndex:0},this.availableSpace),t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shape",{get:function(){var t=this.attributes,e=t.trackLength,n=t.trackSize,i=(0,rA.CR)(this.getOrientVal([[e,n],[n,e]]),2);return{width:i[0],height:i[1]}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"availableSpace",{get:function(){var t=this.attributes,e=(t.x,t.y,t.padding),n=(0,rA.CR)(rN(e),4),i=n[0],r=n[1],a=n[2],o=n[3],s=this.shape;return{x:o,y:i,width:s.width-(o+r),height:s.height-(i+a)}},enumerable:!1,configurable:!0}),e.prototype.getValues=function(){return this.values},e.prototype.setValues=function(t,e){void 0===t&&(t=[0,0]),void 0===e&&(e=!1),this.attributes.values=t;var n=!1!==e&&this.attributes.animate;this.updateSelectionArea(n),this.updateHandlesPosition(n)},e.prototype.updateSelectionArea=function(t){var e=this.calcSelectionArea();this.foregroundGroup.selectAll(sj.selection.class).each(function(n,i){an(this,e[i],t)})},e.prototype.updateHandlesPosition=function(t){this.attributes.showHandle&&(this.startHandle&&an(this.startHandle,this.getHandleStyle("start"),t),this.endHandle&&an(this.endHandle,this.getHandleStyle("end"),t))},e.prototype.innerSetValues=function(t,e){void 0===t&&(t=[0,0]),void 0===e&&(e=!1);var n=this.values,i=this.clampValues(t);this.attributes.values=i,this.setValues(i),e&&this.onValueChange(n)},e.prototype.renderTrack=function(t){var e=this.attributes,n=e.x,i=e.y,r=rK(this.attributes,"track");this.trackShape=rJ(t).maybeAppendByClassName(sj.track,"rect").styles((0,rA.pi)((0,rA.pi)({x:n,y:i},this.shape),r))},e.prototype.renderBrushArea=function(t){var e=this.attributes,n=e.x,i=e.y,r=e.brushable;this.brushArea=rJ(t).maybeAppendByClassName(sj.brushArea,"rect").styles((0,rA.pi)({x:n,y:i,fill:"transparent",cursor:r?"crosshair":"default"},this.shape))},e.prototype.renderSparkline=function(t){var e=this,n=this.attributes,i=n.x,r=n.y;r1("horizontal"===n.orientation,rJ(t).maybeAppendByClassName(sj.sparklineGroup,"g"),function(t){var n=(0,rA.pi)((0,rA.pi)({},e.sparklineStyle),{x:i,y:r});t.maybeAppendByClassName(sj.sparkline,function(){return new sI({style:n})}).update(n)})},e.prototype.renderHandles=function(){var t,e=this,n=this.attributes,i=n.showHandle,r=n.type,a=this;null===(t=this.foregroundGroup)||void 0===t||t.selectAll(sj.handle.class).data((i?"range"===r?["start","end"]:["end"]:[]).map(function(t){return{type:t}}),function(t){return t.type}).join(function(t){return t.append(function(t){var n=t.type;return new sH({style:e.getHandleStyle(n)})}).each(function(t){var e=t.type;this.attr("class","".concat(sj.handle.name," ").concat(e,"-handle")),a["".concat(e,"Handle")]=this,this.addEventListener("pointerdown",a.onDragStart(e))})},function(t){return t.each(function(t){var e=t.type;this.update(a.getHandleStyle(e))})},function(t){return t.each(function(t){var e=t.type;a["".concat(e,"Handle")]=void 0}).remove()})},e.prototype.renderSelection=function(t){var e=this.attributes,n=e.x,i=e.y,r=e.type,a=e.selectionType;this.foregroundGroup=rJ(t).maybeAppendByClassName(sj.foreground,"g");var o=rK(this.attributes,"selection"),s=function(t){return t.style("visibility",function(t){return t.show?"visible":"hidden"}).style("cursor",function(t){return"select"===a?"grab":"invert"===a?"crosshair":"default"}).styles((0,rA.pi)((0,rA.pi)({},o),{transform:"translate(".concat(n,", ").concat(i,")")}))},l=this;this.foregroundGroup.selectAll(sj.selection.class).data("value"===r?[]:this.calcSelectionArea().map(function(t,e){return{style:(0,rA.pi)({},t),index:e,show:"select"===a?1===e:1!==e}}),function(t){return t.index}).join(function(t){return t.append("rect").attr("className",sj.selection.name).call(s).each(function(t,e){var n=this;1===e?(l.selectionShape=rJ(this),this.on("pointerdown",function(t){n.attr("cursor","grabbing"),l.onDragStart("selection")(t)}),l.dispatchCustomEvent(this,"pointerenter","selectionMouseenter"),l.dispatchCustomEvent(this,"pointerleave","selectionMouseleave"),l.dispatchCustomEvent(this,"click","selectionClick"),this.addEventListener("pointerdown",function(){n.attr("cursor","grabbing")}),this.addEventListener("pointerup",function(){n.attr("cursor","pointer")}),this.addEventListener("pointerover",function(){n.attr("cursor","pointer")})):this.on("pointerdown",l.onDragStart("track"))})},function(t){return t.call(s)},function(t){return t.remove()}),this.updateSelectionArea(!1),this.renderHandles()},e.prototype.render=function(t,e){this.renderTrack(e),this.renderSparkline(e),this.renderBrushArea(e),this.renderSelection(e)},e.prototype.clampValues=function(t,e){void 0===e&&(e=4);var n,i=(0,rA.CR)(this.range,2),r=i[0],a=i[1],o=(0,rA.CR)(this.getValues().map(function(t){return sE(t,e)}),2),s=o[0],l=o[1],h=Array.isArray(t)?t:[s,null!=t?t:l],c=(0,rA.CR)((h||[s,l]).map(function(t){return sE(t,e)}),2),u=c[0],d=c[1];if("value"===this.attributes.type)return[0,iC(d,r,a)];u>d&&(u=(n=(0,rA.CR)([d,u],2))[0],d=n[1]);var p=d-u;return p>a-r?[r,a]:u<r?s===r&&l===d?[r,d]:[r,p+r]:d>a?l===a&&s===u?[u,a]:[a-p,a]:[u,d]},e.prototype.calcSelectionArea=function(t){var e=(0,rA.CR)(this.clampValues(t),2),n=e[0],i=e[1],r=this.availableSpace,a=r.x,o=r.y,s=r.width,l=r.height;return this.getOrientVal([[{y:o,height:l,x:a,width:n*s},{y:o,height:l,x:n*s+a,width:(i-n)*s},{y:o,height:l,x:i*s,width:(1-i)*s}],[{x:a,width:s,y:o,height:n*l},{x:a,width:s,y:n*l+o,height:(i-n)*l},{x:a,width:s,y:i*l,height:(1-i)*l}]])},e.prototype.calcHandlePosition=function(t){var e=this.attributes.handleIconOffset,n=this.availableSpace,i=n.x,r=n.y,a=n.width,o=n.height,s=(0,rA.CR)(this.clampValues(),2),l=s[0],h=s[1],c=("start"===t?l:h)*this.getOrientVal([a,o])+("start"===t?-e:e);return{x:i+this.getOrientVal([c,a/2]),y:r+this.getOrientVal([o/2,c])}},e.prototype.inferTextStyle=function(t){return"horizontal"===this.attributes.orientation?{}:"start"===t?{transformOrigin:"left center",transform:"rotate(90)",textAlign:"start"}:"end"===t?{transformOrigin:"right center",transform:"rotate(90)",textAlign:"end"}:{}},e.prototype.calcHandleText=function(t){var e,n=this.attributes,i=n.type,r=n.orientation,a=n.formatter,o=n.autoFitLabel,s=rK(this.attributes,"handle"),l=rK(s,"label"),h=s.spacing,c=this.getHandleSize(),u=this.clampValues(),d=a("start"===t?u[0]:u[1]),p=new rq({style:(0,rA.pi)((0,rA.pi)((0,rA.pi)({},l),this.inferTextStyle(t)),{text:d})}),f=p.getBBox(),g=f.width,y=f.height;if(p.destroy(),!o){if("value"===i)return{text:d,x:0,y:-y-h};var m=h+c+("horizontal"===r?g/2:0);return(e={text:d})["horizontal"===r?"x":"y"]="start"===t?-m:m,e}var v=0,b=0,x=this.availableSpace,E=x.width,w=x.height,C=this.calcSelectionArea()[1],S=C.x,M=C.y,R=C.width,O=C.height,A=h+c;if("horizontal"===r){var T=A+g/2;v="start"===t?S-A-g>0?-T:T:E-S-R-A>g?T:-T}else{var k=y+A;b="start"===t?M-c>y?-k:A:w-(M+O)-c>y?k:-A}return{x:v,y:b,text:d}},e.prototype.getHandleLabelStyle=function(t){var e=rK(this.attributes,"handleLabel");return(0,rA.pi)((0,rA.pi)((0,rA.pi)({},e),this.calcHandleText(t)),this.inferTextStyle(t))},e.prototype.getHandleIconStyle=function(){var t=this.attributes.handleIconShape,e=rK(this.attributes,"handleIcon"),n=this.getOrientVal(["ew-resize","ns-resize"]),i=this.getHandleSize();return(0,rA.pi)({cursor:n,shape:t,size:i},e)},e.prototype.getHandleStyle=function(t){var e=this.attributes,n=e.x,i=e.y,r=e.showLabel,a=e.showLabelOnInteraction,o=e.orientation,s=this.calcHandlePosition(t),l=s.x,h=s.y,c=this.calcHandleText(t),u=r;return!r&&a&&(u=!!this.target),(0,rA.pi)((0,rA.pi)((0,rA.pi)({},r$(this.getHandleIconStyle(),"icon")),r$((0,rA.pi)((0,rA.pi)({},this.getHandleLabelStyle(t)),c),"label")),{transform:"translate(".concat(l+n,", ").concat(h+i,")"),orientation:o,showLabel:u,type:t,zIndex:3})},e.prototype.getHandleSize=function(){var t=this.attributes,e=t.handleIconSize,n=t.width,i=t.height;return e||Math.floor((this.getOrientVal([+i,+n])+4)/2.4)},e.prototype.getOrientVal=function(t){var e=(0,rA.CR)(t,2),n=e[0],i=e[1];return"horizontal"===this.attributes.orientation?n:i},e.prototype.setValuesOffset=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=!1);var i=this.attributes.type,r=(0,rA.CR)(this.getValues(),2),a=[r[0]+("range"===i?t:0),r[1]+e].sort();n?this.setValues(a):this.innerSetValues(a,!0)},e.prototype.getRatio=function(t){var e=this.availableSpace,n=e.width,i=e.height;return t/this.getOrientVal([n,i])},e.prototype.dispatchCustomEvent=function(t,e,n){var i=this;t.on(e,function(t){t.stopPropagation(),i.dispatchEvent(new I.Aw(n,{detail:t}))})},e.prototype.bindEvents=function(){this.addEventListener("wheel",this.onScroll);var t=this.brushArea;this.dispatchCustomEvent(t,"click","trackClick"),this.dispatchCustomEvent(t,"pointerenter","trackMouseenter"),this.dispatchCustomEvent(t,"pointerleave","trackMouseleave"),t.on("pointerdown",this.onDragStart("track"))},e.prototype.onScroll=function(t){if(this.attributes.scrollable){var e=t.deltaX,n=t.deltaY||e,i=this.getRatio(n);this.setValuesOffset(i,i,!0)}},e.tag="slider",e}(rV),sV={backgroundFill:"#262626",backgroundLineCap:"round",backgroundLineWidth:1,backgroundStroke:"#333",backgroundZIndex:-1,formatter:function(t){return t.toString()},labelFill:"#fff",labelFontSize:12,labelTextBaseline:"middle",padding:[2,4],position:"right",radius:0,zIndex:999},sZ=r0({background:"background",labelGroup:"label-group",label:"label"},"indicator"),sU=function(t){function e(e){var n=t.call(this,e,sV)||this;return n.point=[0,0],n.group=n.appendChild(new I.ZA({})),n.isMutationObserved=!0,n}return(0,rA.ZT)(e,t),e.prototype.renderBackground=function(){if(this.label){var t=this.attributes,e=t.position,n=t.padding,i=(0,rA.CR)(rN(n),4),r=i[0],a=i[1],o=i[2],s=i[3],l=this.label.node().getLocalBounds(),h=l.min,c=l.max,u=new rT(h[0]-s,h[1]-r,c[0]+a-h[0]+s,c[1]+o-h[1]+r),d=this.getPath(e,u),p=rK(this.attributes,"background");this.background=rJ(this.group).maybeAppendByClassName(sZ.background,"path").styles((0,rA.pi)((0,rA.pi)({},p),{d:d})),this.group.appendChild(this.label.node())}},e.prototype.renderLabel=function(){var t=this.attributes,e=t.formatter,n=t.labelText,i=rK(this.attributes,"label"),r=(0,rA.CR)(rX(i),2),a=r[0],o=r[1],s=(a.text,(0,rA._T)(a,["text"]));this.label=rJ(this.group).maybeAppendByClassName(sZ.labelGroup,"g").styles(o),n&&this.label.maybeAppendByClassName(sZ.label,function(){return ap(e(n))}).style("text",e(n).toString()).selectAll("text").styles(s)},e.prototype.adjustLayout=function(){var t=(0,rA.CR)(this.point,2),e=t[0],n=t[1],i=this.attributes,r=i.x,a=i.y;this.group.attr("transform","translate(".concat(r-e,", ").concat(a-n,")"))},e.prototype.getPath=function(t,e){var n=this.attributes.radius,i=e.x,r=e.y,a=e.width,o=e.height,s=[["M",i+n,r],["L",i+a-n,r],["A",n,n,0,0,1,i+a,r+n],["L",i+a,r+o-n],["A",n,n,0,0,1,i+a-n,r+o],["L",i+n,r+o],["A",n,n,0,0,1,i,r+o-n],["L",i,r+n],["A",n,n,0,0,1,i+n,r],["Z"]],l={top:4,right:6,bottom:0,left:2}[t],h=this.createCorner([s[l].slice(-2),s[l+1].slice(-2)]);return s.splice.apply(s,(0,rA.ev)([l+1,1],(0,rA.CR)(h),!1)),s[0][0]="M",s},e.prototype.createCorner=function(t,e){void 0===e&&(e=10);var n=ad.apply(void 0,(0,rA.ev)([],(0,rA.CR)(t),!1)),i=(0,rA.CR)(t,2),r=(0,rA.CR)(i[0],2),a=r[0],o=r[1],s=(0,rA.CR)(i[1],2),l=s[0],h=s[1],c=(0,rA.CR)(n?[l-a,[a,l]]:[h-o,[o,h]],2),u=c[0],d=(0,rA.CR)(c[1],2),p=d[0],f=d[1],g=u/2,y=e*(u/Math.abs(u)),m=y/2,v=y*Math.sqrt(3)/2*.8,b=(0,rA.CR)([p,p+g-m,p+g,p+g+m,f],5),x=b[0],E=b[1],w=b[2],C=b[3],S=b[4];return n?(this.point=[w,o-v],[["L",x,o],["L",E,o],["L",w,o-v],["L",C,o],["L",S,o]]):(this.point=[a+v,w],[["L",a,x],["L",a,E],["L",a+v,w],["L",a,C],["L",a,S]])},e.prototype.applyVisibility=function(){"hidden"===this.attributes.visibility?r_(this):rB(this)},e.prototype.bindEvents=function(){this.label.on(I.Dk.BOUNDS_CHANGED,this.renderBackground)},e.prototype.render=function(){this.renderLabel(),this.renderBackground(),this.adjustLayout(),this.applyVisibility()},e}(rV),sY=function(t){function e(n){var i=t.call(this,rz({},e.defaultOptions,n))||this;return i.hoverColor="#f5f5f5",i.selectedColor="#e6f7ff",i.background=i.appendChild(new I.UL({})),i.label=i.background.appendChild(new I.ZA({})),i}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return rN(this.style.padding)},enumerable:!1,configurable:!0}),e.prototype.renderLabel=function(){var t=this.style,e=t.label,n=t.value,i=rK(this.attributes,"label");rJ(this.label).maybeAppend(".label",function(){return ap(e)}).attr("className","label").styles(i),this.label.attr("__data__",n)},e.prototype.renderBackground=function(){var t=this.label.getBBox(),e=(0,rA.CR)(this.padding,4),n=e[0],i=e[1],r=e[2],a=e[3],o=t.width,s=t.height,l=s+n+r,h=rK(this.attributes,"background"),c=this.style,u=c.width,d=c.height,p=c.selected;this.background.attr((0,rA.pi)((0,rA.pi)({},h),{width:Math.max(o+a+i,void 0===u?0:u),height:Math.max(l,void 0===d?0:d),fill:p?this.selectedColor:"#fff"})),this.label.attr({transform:"translate(".concat(a,", ").concat((l-s)/2,")")})},e.prototype.render=function(){this.renderLabel(),this.renderBackground()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("pointerenter",function(){t.style.selected||t.background.attr("fill",t.hoverColor)}),this.addEventListener("pointerleave",function(){t.style.selected||t.background.attr("fill",t.style.backgroundFill)});var e=this;this.addEventListener("click",function(){var n=t.style,i=n.label,r=n.value,a=n.onClick;null==a||a(r,{label:i,value:r},e)})},e.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},e}(rV),sK=function(t){function e(n){var i,r,a=t.call(this,rz({},e.defaultOptions,n))||this;a.currentValue=null===(i=e.defaultOptions.style)||void 0===i?void 0:i.defaultValue,a.isPointerInSelect=!1,a.select=a.appendChild(new I.UL({className:"select",style:{cursor:"pointer",width:0,height:0}})),a.dropdown=a.appendChild(new I.UL({className:"dropdown"}));var o=a.style.defaultValue;return o&&(null===(r=a.style.options)||void 0===r?void 0:r.some(function(t){return t.value===o}))&&(a.currentValue=o),a}return(0,rA.ZT)(e,t),e.prototype.setValue=function(t){this.currentValue=t,this.render()},e.prototype.getValue=function(){return this.currentValue},Object.defineProperty(e.prototype,"dropdownPadding",{get:function(){return rN(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),e.prototype.renderSelect=function(){var t,e=this,n=this.style,i=n.x,r=n.y,a=n.width,o=n.height,s=n.bordered,l=n.showDropdownIcon,h=rK(this.attributes,"select"),c=rK(this.attributes,"placeholder");this.select.attr((0,rA.pi)((0,rA.pi)({x:i,y:r,width:a,height:o},h),{fill:"#fff",strokeWidth:s?1:0}));var u=this.dropdownPadding;l&&rJ(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(i+a-10-u[1]-u[3],", ").concat(r+o/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var d=null===(t=this.style.options)||void 0===t?void 0:t.find(function(t){return t.value===e.currentValue}),p=(0,rA.pi)({x:i+u[3]},c);rJ(this.select).selectAll(".placeholder").data(d?[]:[1]).join(function(t){return t.append("text").attr("className","placeholder").styles(p).style("y",function(){return r+(o-this.getBBox().height)/2})},function(t){return t.styles(p)},function(t){return t.remove()});var f=rK(this.attributes,"optionLabel"),g=(0,rA.pi)({x:i+u[3]},f);rJ(this.select).selectAll(".value").data(d?[d]:[]).join(function(t){return t.append(function(t){return ap(t.label)}).attr("className","value").styles(g).style("y",function(){return r+(o-this.getBBox().height)/2})},function(t){return t.styles(g)},function(t){return t.remove()})},e.prototype.renderDropdown=function(){var t,e,n=this,i=this.style,r=i.x,a=i.y,o=i.width,s=i.height,l=i.options,h=i.onSelect,c=i.open,u=rK(this.attributes,"dropdown"),d=rK(this.attributes,"option"),p=this.dropdownPadding;rJ(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(l,function(t){return t.value}).join(function(t){return t.append(function(t){return new sY({className:"dropdown-item",style:(0,rA.pi)((0,rA.pi)((0,rA.pi)({},t),d),{width:o-p[1]-p[3],selected:t.value===n.currentValue,onClick:function(t,e,i){n.setValue(t),null==h||h(t,e,i),n.dispatchEvent(new I.Aw("change",{detail:{value:t,option:e,item:i}})),r_(n.dropdown)}})})}).each(function(t,e){var n,i=(null===(n=this.parentNode)||void 0===n?void 0:n.children).reduce(function(t,n,i){return i<e&&(t+=n.getBBox().height),t},0);this.attr("transform","translate(".concat(p[3],", ").concat(p[0]+i,")"))})},function(t){return t.update(function(t){return{selected:t.value===n.currentValue}})},function(t){return t.remove()});var f=null===(e=null===(t=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===t?void 0:t[0])||void 0===e?void 0:e.getBBox(),g=u.spacing;this.dropdown.attr((0,rA.pi)({transform:"translate(".concat(r,", ").concat(a+s+g,")"),width:f.width+p[1]+p[3],height:f.height+p[0]+p[2]},u)),c||r_(this.dropdown)},e.prototype.render=function(){this.renderSelect(),this.renderDropdown()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("click",function(t){t.stopPropagation()}),this.select.addEventListener("click",function(){"visible"===t.dropdown.style.visibility?r_(t.dropdown):rB(t.dropdown)}),this.addEventListener("pointerenter",function(){t.isPointerInSelect=!0}),this.addEventListener("pointerleave",function(){t.isPointerInSelect=!1}),null==document||document.addEventListener("click",function(){t.isPointerInSelect||r_(t.dropdown)})},e.defaultOptions={style:{x:0,y:0,width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},e}(rV),s$=function(t){function e(n){var i=t.call(this,rz({},{style:{backgroundOpacity:e.backgroundOpacities.default}},e.defaultOptions,n))||this;return i.showBackground=!0,i.background=i.appendChild(new I.UL({})),i.icon=i.appendChild(new I.ZA({})),i}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return rN(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconSize",{get:function(){var t=this.attributes.size,e=(0,rA.CR)(this.padding,4),n=e[0],i=e[1],r=e[2];return Math.max(t-Math.max(e[3]+i,n+r),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.size,r=i/2,a=rK(this.attributes,"background");this.background.attr((0,rA.pi)({x:e-r,y:n-r,width:i,height:i},a))},e.prototype.showIndicator=function(){if(this.label){var t=this.attributes.size,e=this.background.getBBox(),n=e.x,i=e.y;this.indicator.update({x:n+t/2,y:i-5,labelText:this.label,visibility:"visible"})}},e.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},e.prototype.connectedCallback=function(){t.prototype.connectedCallback.call(this);var e,n=this.attributes.size,i=this.background.getBBox(),r=i.x,a=i.y,o=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView;o&&(this.indicator=o.appendChild(new sU({style:{x:r+n/2,y:a-n/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},e.prototype.disconnectedCallback=function(){this.indicator.destroy()},e.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},e.prototype.bindEvents=function(){var t=this,n=this.attributes.onClick;if(this.addEventListener("click",function(){null==n||n(t)}),this.showBackground){var i=function(){return t.background.attr({opacity:e.backgroundOpacities.default})};this.addEventListener("pointerenter",function(){t.background.attr({opacity:e.backgroundOpacities.hover}),t.showIndicator()}),this.addEventListener("pointerleave",function(){i(),t.hideIndicator()}),this.addEventListener("pointerdown",function(){t.background.attr({opacity:e.backgroundOpacities.active})}),this.addEventListener("pointerup",function(){i()})}},e.tag="IconBase",e.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},e.backgroundOpacities={default:0,hover:.8,active:1},e}(rV),sX=function(t,e){return void 0===e&&(e="#565758"),new I.y$({style:{fill:e,d:"M ".concat(t,",").concat(t," L -").concat(t,",0 L ").concat(t,",-").concat(t," Z"),transformOrigin:"center"}})},sq=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),e.prototype.arcPath=function(t,e,n){var i=(0,rA.CR)([n,n],2),r=i[0],a=i[1],o=function(i){return[t+n*Math.cos(i),e+n*Math.sin(i)]},s=(0,rA.CR)(o(-5/4*Math.PI),2),l=s[0],h=s[1],c=(0,rA.CR)(o(1/4*Math.PI),2),u=c[0],d=c[1];return"M".concat(l,",").concat(h,",A").concat(r,",").concat(a,",0,1,1,").concat(u,",").concat(d)},Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=this.lineWidth,o=a+.5;rJ(this.icon).maybeAppend(".reset","path").styles({stroke:i,lineWidth:a,d:this.arcPath(e,n,r/2-a),markerStart:sX(o,i)})},e}(s$),sQ=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=r/2,o=r/2/1.7320508075688772;rJ(this.icon).maybeAppend(".backward","polygon").styles({points:[[e,n],[e,n-o],[e-a,n],[e,n+o],[e,n],[e+a,n-o],[e+a,n+o],[e,n]],fill:i})},e}(s$),sJ=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=r/2,o=r/2/1.7320508075688772;rJ(this.icon).maybeAppend(".forward","polygon").styles({points:[[e,n],[e,n-o],[e+a,n],[e,n+o],[e,n],[e-a,n-o],[e-a,n+o],[e,n]],fill:i})},e}(s$),s0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=r/3*1.3856406460551018;rJ(this.icon).maybeAppend(".play","polygon").styles({points:[[e+a,n],[e-a/2,n-r/2*.8],[e-a/2,n+r/2*.8],[e+a,n]],fill:i})},e}(s$),s1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=r/3;rJ(this.icon).maybeAppend(".pause","polygon").styles({points:[[e-a,n-r/2],[e-a,n+r/2],[e-a/2,n+r/2],[e-a/2,n-r/2],[e-a,n-r/2],[e+a/2,n-r/2],[e+a/2,n+r/2],[e+a,n+r/2],[e+a,n-r/2]],fill:i})},e}(s$),s2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=this.lineWidth;rJ(this.icon).maybeAppend(".left-line","line").styles({x1:e-r/2,y1:n-r/2,x2:e-r/2,y2:n+r/2,stroke:i,lineWidth:a}),rJ(this.icon).maybeAppend(".right-line","line").styles({x1:e+r/2,y1:n-r/2,x2:e+r/2,y2:n+r/2,stroke:i,lineWidth:a}),rJ(this.icon).maybeAppend(".left-arrow","line").styles({x1:e,y1:n,x2:e-r/2+2*a,y2:n,stroke:i,lineWidth:a,markerEnd:sX(2*a,i)}),rJ(this.icon).maybeAppend(".right-arrow","line").styles({x1:e,y1:n,x2:e+r/2-2*a,y2:n,stroke:i,lineWidth:a,markerEnd:sX(2*a,i)})},e}(s$),s3=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=this.lineWidth;rJ(this.icon).maybeAppend(".line","line").styles({x1:e,y1:n-r/2,x2:e,y2:n+r/2,stroke:i,lineWidth:a}),rJ(this.icon).maybeAppend(".left-arrow","line").styles({x1:e-r/2-2*a,y1:n,x2:e-2*a,y2:n,stroke:i,lineWidth:a,markerEnd:sX(2*a,i)}),rJ(this.icon).maybeAppend(".right-arrow","line").styles({x1:e+r/2+2*a,y1:n,x2:e+2*a,y2:n,stroke:i,lineWidth:a,markerEnd:sX(2*a,i)})},e}(s$),s6=function(t){return[[-t/2,-t/2],[-t/2,t/2],[t/2,t/2]]},s4=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=this.lineWidth,o=(r-2*a-a)/4,s=(r-2*a-a)/2,l=(0,rA.CR)([e-r/2+a,n+r/2-2*a],2),h=l[0],c=l[1];rJ(this.icon).maybeAppend(".coordinate","polyline").styles({points:s6(r).map(function(t){var i=(0,rA.CR)(t,2);return[i[0]+e,i[1]+n]}),stroke:i,lineWidth:a}),rJ(this.icon).maybeAppend(".line","polyline").styles({points:[[h,c],[h+o,c-s],[h+2*o,c],[h+4*o,c-2*s]],stroke:i,lineWidth:a})},e}(s$),s8=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.data,e=this.attributes,n=e.x,i=e.y,r=e.color,a=this.iconSize,o=this.lineWidth,s=(a-o)/t.length,l=(a-2*o)/4,h=(0,rA.CR)([n-a/2+2*o,i+a/2-o],2),c=h[0],u=h[1];rJ(this.icon).maybeAppend(".coordinate","polyline").styles({points:s6(a).map(function(t){var e=(0,rA.CR)(t,2);return[e[0]+n,e[1]+i]}),stroke:r,lineWidth:o}),rJ(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map(function(t,e){return{value:t,index:e}})).join(function(t){return t.append("line").attr("className","column").style("x1",function(t){return c+s*t.index}).style("y1",u).style("x2",function(t){return c+s*t.index}).style("y2",function(t){return u-l*t.value}).styles({y1:u,stroke:r,lineWidth:o})})},e}(s$),s9=function(t){function e(e){var n=t.call(this,rz({},{style:{color:"#d8d9d9"}},e))||this;return n.showBackground=!1,n}return(0,rA.ZT)(e,t),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,r=this.iconSize,a=this.lineWidth;rJ(this.icon).maybeAppend(".split","line").styles({x1:e,y1:n-r/2,x2:e,y2:n+r/2,stroke:i,lineWidth:a})},e}(s$),s5=function(t){function e(){var e=t.apply(this,(0,rA.ev)([],(0,rA.CR)(arguments),!1))||this;return e.showBackground=!1,e}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return rN(0)},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.iconSize,e=this.attributes,n=e.x,i=e.y,r=e.speed,a=iz(this.attributes,["x","y","transform","transformOrigin","width","height","size","color","speed"]),o=iC(t,20,1/0),s=(0,rA.pi)((0,rA.pi)({},a),{x:n-o/2,y:i-10,width:o,height:20,defaultValue:void 0===r?1:r,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:t/5,placeholderFontSize:t/2,optionPadding:0,optionLabelFontSize:t/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});rJ(this.icon).maybeAppend(".speed",function(){return new sK({style:s})}).attr("className","speed").each(function(){this.update(s)})},e.tag="SpeedSelect",e}(s$),s7=function(t){function e(e){var n=t.call(this,e)||this;return n.icon=n.appendChild(new I.ZA({})),n.currentType=n.attributes.type,n}return(0,rA.ZT)(e,t),e.prototype.getType=function(){return this.currentType},e.prototype.render=function(){var t=this,e=this.attributes,n=(e.onChange,(0,rA._T)(e,["onChange"]));rJ(this.icon).selectAll(".icon").data([this.currentType]).join(function(e){return e.append(function(e){var n,i=null===(n=t.toggles.find(function(t){return(0,rA.CR)(t,1)[0]===e}))||void 0===n?void 0:n[1];if(!i)throw Error("Invalid type: ".concat(e));return new i({})}).attr("className","icon").styles(n,!1).update({})},function(t){return t.styles({restStyles:n}).update({})},function(t){return t.remove()})},e.prototype.bindEvents=function(){var t=this,e=this.attributes.onChange;this.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var i=(t.toggles.findIndex(function(e){return(0,rA.CR)(e,1)[0]===t.currentType})+1)%t.toggles.length,r=t.toggles[i][0];null==e||e(t.currentType),t.currentType=r,t.render()})},e.tag="ToggleIcon",e}(rV),lt=function(t){function e(e){var n=t.call(this,rz({},{style:{type:"play"}},e))||this;return n.toggles=[["play",s0],["pause",s1]],n}return(0,rA.ZT)(e,t),e}(s7),le=function(t){function e(e){var n=t.call(this,rz({},{style:{type:"range"}},e))||this;return n.toggles=[["range",s2],["value",s3]],n}return(0,rA.ZT)(e,t),e}(s7),ln=function(t){function e(e){var n=t.call(this,rz({},{style:{type:"column"}},e))||this;return n.toggles=[["line",s4],["column",s8]],n}return(0,rA.ZT)(e,t),e}(s7),li={reset:sq,speed:s5,backward:sQ,playPause:lt,forward:sJ,selectionType:le,chartType:ln,split:s9},lr=function(t){function e(n){var i=t.call(this,rz({},e.defaultOptions,n))||this;return i.background=i.appendChild(new I.UL({})),i.functions=i.appendChild(new I.ZA({})),i}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return rN(this.attributes.padding)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.style,e=t.x,n=t.y,i=t.width,r=t.height,a=rK(this.attributes,"background");this.background.attr((0,rA.pi)({x:e,y:n,width:i,height:r},a))},e.prototype.renderFunctions=function(){var t,e=this,n=this.attributes,i=n.functions,r=n.iconSize,a=n.iconSpacing,o=n.x,s=n.y,l=n.width,h=n.height,c=n.align,u=(0,rA.CR)(this.padding,4),d=u[1],p=u[3],f=i.reduce(function(t,e){return t.length&&e.length?t.concat.apply(t,(0,rA.ev)(["split"],(0,rA.CR)(e),!1)):t.concat.apply(t,(0,rA.ev)([],(0,rA.CR)(e),!1))},[]),g=f.length*(r+a)-a,y={left:p+r/2,center:(l-g)/2+r/2,right:l-g-p-d+r/2}[c]||0;null===(t=this.speedSelect)||void 0===t||t.destroy(),this.functions.removeChildren(),f.forEach(function(t,n){var i,l=li[t],c={x:o+n*(r+a)+y,y:s+h/2,size:r};if(l===s5?(c.speed=e.attributes.speed,c.onSelect=function(n){return e.handleFunctionChange(t,{value:n})}):[lt,le,ln].includes(l)?(c.onChange=function(n){return e.handleFunctionChange(t,{value:n})},l===lt&&(c.type="play"===e.attributes.state?"pause":"play"),l===le&&(c.type="range"===e.attributes.selectionType?"value":"range"),l===ln&&(c.type="line"===e.attributes.chartType?"column":"line")):c.onClick=function(){return e.handleFunctionChange(t,{value:t})},l===s5){var u=null===(i=e.ownerDocument)||void 0===i?void 0:i.defaultView;u&&(e.speedSelect=new l({style:(0,rA.pi)((0,rA.pi)({},c),{zIndex:100})}),u.appendChild(e.speedSelect))}else e.functions.appendChild(new l({style:c}))})},e.prototype.disconnectedCallback=function(){var e;t.prototype.disconnectedCallback.call(this),null===(e=this.speedSelect)||void 0===e||e.destroy()},e.prototype.render=function(){this.renderBackground(),this.renderFunctions()},e.prototype.handleFunctionChange=function(t,e){var n=this.attributes.onChange;null==n||n(t,e)},e.defaultOptions={style:{x:0,y:0,width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},e}(rV),la=function(t){function e(n){var i=t.call(this,rz({},e.defaultOptions,n))||this;return i.bindEvents(),i}return(0,rA.ZT)(e,t),e.prototype.bindEvents=function(){var t=this;this.addEventListener("mouseenter",function(){t.attr("lineWidth",Math.ceil(+(t.style.r||0)/2))}),this.addEventListener("mouseleave",function(){t.attr("lineWidth",0)})},e.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},e}(I.Cd),lo=function(t){function e(n){return t.call(this,rz({},e.defaultOptions,n))||this}return(0,rA.ZT)(e,t),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,r=t.height,a=rK(this.attributes,"background");rJ(this).maybeAppend("background","rect").attr("className","background").styles((0,rA.pi)({x:e-i/2,y:n-r/2,width:i,height:r},a))},e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.iconSize,r=rK(this.attributes,"icon"),a=i/2;rJ(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles((0,rA.pi)({x1:e-1,y1:n-a,x2:e-1,y2:n+a},r)),rJ(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles((0,rA.pi)({x1:e+1,y1:n-a,x2:e+1,y2:n+a},r))},e.prototype.renderBorder=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,r=t.height,a=t.type,o=rK(this.attributes,"border"),s="start"===a?+i/2:-i/2;rJ(this).maybeAppend("border","line").attr("className","border").styles((0,rA.pi)({x1:s+e,y1:n-r/2,x2:s+e,y2:n+r/2},o))},e.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},e.defaultOptions={style:{x:0,y:0,width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},e}(rV);function ls(t){var e=String(Math.floor(t/3600)).padStart(2,"0"),n=String(Math.floor(t%3600/60)).padStart(2,"0"),i=String(Math.floor(t%60)).padStart(2,"0");return t<3600?"".concat(n,":").concat(i):"".concat(e,":").concat(n,":").concat(i)}var ll=function(t){function e(n){var i=t.call(this,rz({},e.defaultOptions,n))||this;i.axis=i.appendChild(new sb({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),i.timeline=i.appendChild(new sW({style:{onChange:function(t){i.handleSliderChange(t)}}})),i.controller=i.appendChild(new lr({})),i.states={},i.handleSliderChange=function(t){var e,n=Array.isArray(e=i.states.values)?(0,rA.ev)([],(0,rA.CR)(e),!1):e;i.setBySliderValues(t),i.dispatchOnChange(n)};var r=i.attributes,a=r.selectionType,o=r.chartType,s=r.speed,l=r.state,h=r.playMode,c=r.values;return i.states={chartType:o,playMode:h,selectionType:a,speed:s,state:l},i.setByTimebarValues(c),i}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.data.sort(function(t,e){return t.time<e.time?-1:t.time>e.time?1:0})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"space",{get:function(){var t,e=this.attributes,n=e.x,i=e.y,r=e.width,a=e.height,o=e.type,s=e.controllerHeight,l=iC(+a-s,0,+a),h=new rT(n,i+ +a-s,+r,s),c=0;"chart"===o?(c=35,t=new rT(n,i+l-c,+r,c)):t=new rT;var u="time"===o?10:l;return{axisBBox:t,controllerBBox:h,timelineBBox:new rT(n,i+("time"===o?l:l-u),+r,u-c)}},enumerable:!1,configurable:!0}),e.prototype.setBySliderValues=function(t){var e,n,i=this.data,r=(0,rA.CR)(Array.isArray(t)?t:[0,t],2),a=r[0],o=r[1],s=i.length,l=i[Math.floor(a*s)],h=i[Math.ceil(o*s)-(Array.isArray(t)?0:1)];this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:i[0].time,null!==(n=null==h?void 0:h.time)&&void 0!==n?n:1/0]},e.prototype.setByTimebarValues=function(t){var e,n,i,r=this.data,a=(0,rA.CR)(Array.isArray(t)?t:[void 0,t],2),o=a[0],s=a[1],l=r.find(function(t){return t.time===o}),h=r.find(function(t){return t.time===s});this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:null===(n=r[0])||void 0===n?void 0:n.time,null!==(i=null==h?void 0:h.time)&&void 0!==i?i:1/0]},e.prototype.setByIndex=function(t){var e,n,i,r,a=this.data,o=(0,rA.CR)(t,2),s=o[0],l=o[1];this.states.values=[null!==(n=null===(e=a[s])||void 0===e?void 0:e.time)&&void 0!==n?n:a[0].time,null!==(r=null===(i=this.data[l])||void 0===i?void 0:i.time)&&void 0!==r?r:1/0]},Object.defineProperty(e.prototype,"sliderValues",{get:function(){var t,e=this.states,n=e.values,i=e.selectionType,r=(0,rA.CR)(Array.isArray(n)?n:[void 0,n],2),a=r[0],o=r[1],s=this.data,l=s.length,h="value"===i;return[(t=s.findIndex(function(t){return t.time===a}),h?0:t>-1?t/l:0),function(){if(o===1/0)return 1;var t=s.findIndex(function(t){return t.time===o});return t>-1?t/l:h?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){var t=this.states,e=t.values,n=t.selectionType,i=(0,rA.CR)(Array.isArray(e)?e:[this.data[0].time,e],2),r=i[0],a=i[1];return"value"===n?a:[r,a]},enumerable:!1,configurable:!0}),e.prototype.getDatumByRatio=function(t){var e=this.data,n=Math.floor(t*(e.length-1));return e[n]},Object.defineProperty(e.prototype,"chartHandleIconShape",{get:function(){var t=this.states.selectionType,e=this.space.timelineBBox.height;return"range"===t?function(t){return new lo({style:{type:t,height:e,iconSize:e/6}})}:function(){return new I.x1({style:{x1:0,y1:-e/2,x2:0,y2:e/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),e.prototype.getChartStyle=function(t){var e=this,n=t.x,i=t.y,r=t.width,a=t.height,o=this.states,s=o.selectionType,l=o.chartType,h=this.data,c=this.attributes,u=c.type,d=c.labelFormatter,p=rK(this.attributes,"chart"),f=(p.type,(0,rA._T)(p,["type"])),g="range"===s;if("time"===u)return(0,rA.pi)({handleIconShape:function(){return new la({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:g?-15:0,autoFitLabel:g,handleSpacing:g?-15:0,trackFill:"#edeeef",trackLength:r,trackOpacity:.5,trackRadius:a/2,trackSize:a/2,type:s,values:this.sliderValues,formatter:function(t){if(d)return d(t);var n=e.getDatumByRatio(t).time;return"number"==typeof n?ls(n):oT(n,"YYYY-MM-DD HH:mm:ss")},transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},f);var y=h.map(function(t){return t.value});return(0,rA.pi)({handleIconOffset:"range"===s?5:0,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData:y,sparklineType:l,sparklineScale:.8,trackLength:r,trackSize:a,type:s,values:this.sliderValues,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},f)},e.prototype.renderChart=function(t){void 0===t&&(t=this.space.timelineBBox),this.timeline.update(this.getChartStyle(t))},e.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},e.prototype.getAxisStyle=function(t){var e=this.data,n=this.attributes,i=n.interval,r=n.labelFormatter,a=rK(this.attributes,"axis"),o=t.x,s=t.y,l=t.width,h=(0,rA.ev)((0,rA.ev)([],(0,rA.CR)(e),!1),[{time:0}],!1).map(function(t,e,n){var i=t.time;return{label:"".concat(i),value:e/(n.length-1),time:i}});return(0,rA.pi)({startPos:[o,s],endPos:[o+l,s],data:h,labelFilter:function(t,e){return e<h.length-1},labelFormatter:function(t){var e=t.time;return r?r(e):"number"==typeof e?ls(e):function(t,e){var n=new Date(t);switch(e){case"half-hour":case"hour":case"four-hour":if([0,6,12,18].includes(n.getHours())&&0===n.getMinutes())return oT(n,"HH:mm\nYYYY-MM-DD");return oT(n,"HH:mm");case"half-day":if(12>n.getHours())return"AM\n".concat(oT(n,"YYYY-MM-DD"));return"PM";case"day":if([1,10,20].includes(n.getDate()))return oT(n,"DD\nYYYY-MM");return oT(n,"DD");case"week":if(7>=n.getDate())return oT(n,"DD\nYYYY-MM");return oT(n,"DD");case"month":if([0,6].includes(n.getMonth()))return oT(n,"MM\nYYYY");return oT(n,"MM");case"season":if([0].includes(n.getMonth()))return oT(n,"MM\nYYYY");return oT(n,"MM");case"year":return oT(n,"YYYY");default:return oT(n,"YYYY-MM-DD HH:mm")}}(e,i)}},a)},e.prototype.renderAxis=function(t){void 0===t&&(t=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(t))},e.prototype.renderController=function(t){void 0===t&&(t=this.space.controllerBBox);var e=this.attributes.type,n=this.states,i=n.state,r=n.speed,a=n.selectionType,o=n.chartType,s=rK(this.attributes,"controller"),l=this,h=(0,rA.pi)((0,rA.pi)((0,rA.pi)({},t),{iconSize:20,speed:r,state:i,selectionType:a,chartType:o,onChange:function(t,e){var n=e.value;switch(t){case"reset":l.internalReset();break;case"speed":l.handleSpeedChange(n);break;case"backward":l.internalBackward();break;case"playPause":"play"===n?l.internalPlay():l.internalPause();break;case"forward":l.internalForward();break;case"selectionType":l.handleSelectionTypeChange(n);break;case"chartType":l.handleChartTypeChange(n)}}}),s);"time"===e&&(h.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(h)},e.prototype.dispatchOnChange=function(t){var e=this.data,n=this.attributes.onChange,i=this.states,r=i.values,a=i.selectionType,o=(0,rA.CR)(r,2),s=o[0],l=o[1],h=l===1/0?e.at(-1).time:l,c="range"===a?[s,h]:h;(!t||(Array.isArray(t)?!Array.isArray(c)||t[0]!==c[0]||t[1]!==c[1]&&t[1]!==1/0&&c[1]!==1/0:Array.isArray(c)||t!==c))&&null!=n&&n("range"===a?[s,h]:h)},e.prototype.internalReset=function(t){var e,n,i=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===i?[0,1]:[0,0]),this.renderController(),this.updateSelection(),t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onReset)||void 0===n||n.call(e),this.dispatchOnChange())},e.prototype.reset=function(){this.internalReset()},e.prototype.moveSelection=function(t,e){var n,i,r,a,o,s,l=this.data,h=l.length,c=this.states,u=c.values,d=c.selectionType,p=c.playMode,f=(0,rA.CR)(u,2),g=f[0],y=f[1],m=l.findIndex(function(t){return t.time===g}),v=l.findIndex(function(t){return t.time===y});-1===v&&(v=h);var b="backward"===t?-1:1;"range"===d?"acc"===p?(s=[m,v+b],-1===b&&m===v&&(s=[m,h])):s=[m+b,v+b]:s=[m,v+b];var x=(n=s,r=(i=(0,rA.CR)(n.sort(function(t,e){return t-e}),2))[0],a=i[1],o=function(t){return iC(t,0,h)},a>h?"value"===d?[0,0]:"acc"===p?[o(r),o(r)]:[0,o(a-r)]:r<0?"acc"===p?[0,o(a)]:[o(r+h-a),h]:[o(r),o(a)]);return this.setByIndex(x),this.updateSelection(),x},e.prototype.internalBackward=function(t){var e,n,i=this.moveSelection("backward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onBackward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.backward=function(){this.internalBackward()},e.prototype.internalPlay=function(t){var e,n,i=this,r=this.data,a=this.attributes.loop,o=this.states.speed,s=void 0===o?1:o;this.playInterval=window.setInterval(function(){i.internalForward()[1]!==r.length||a||(i.internalPause(),i.renderController())},1e3/s),this.states.state="play",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPlay)||void 0===n||n.call(e)},e.prototype.play=function(){this.internalPlay()},e.prototype.internalPause=function(t){var e,n;clearInterval(this.playInterval),this.states.state="pause",t||null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPause)||void 0===n||n.call(e)},e.prototype.pause=function(){this.internalPause()},e.prototype.internalForward=function(t){var e,n,i=this.moveSelection("forward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onForward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.forward=function(){this.internalForward()},e.prototype.handleSpeedChange=function(t){var e,n;this.states.speed=t,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSpeedChange)||void 0===n||n.call(e,t)},e.prototype.handleSelectionTypeChange=function(t){var e,n;this.states.selectionType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSelectionTypeChange)||void 0===n||n.call(e,t)},e.prototype.handleChartTypeChange=function(t){var e,n;this.states.chartType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onChartTypeChange)||void 0===n||n.call(e,t)},e.prototype.render=function(){var t=this.space,e=t.axisBBox,n=t.controllerBBox,i=t.timelineBBox;this.renderController(n),this.renderAxis(e),this.renderChart(i),"play"===this.states.state&&this.internalPlay()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.internalPause(!0)},e.defaultOptions={style:{x:0,y:0,axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},e}(rV);let lh=["timestamp","time","date","datetime"];class lc extends iZ{get padding(){return tS(this.options.padding)}play(){var t;null===(t=this.timebar)||void 0===t||t.play()}pause(){var t;null===(t=this.timebar)||void 0===t||t.pause()}forward(){var t;null===(t=this.timebar)||void 0===t||t.forward()}backward(){var t;null===(t=this.timebar)||void 0===t||t.backward()}reset(){var t;null===(t=this.timebar)||void 0===t||t.reset()}update(t){super.update(t),this.backup(),Object.keys(t).forEach(t=>{"position"===t?this.upsertWrapper():this.upsertTimebar()})}backup(){this.originalData=lu(this.context.graph.getData())}upsertTimebar(){let{canvas:t}=this.context,{onChange:e,timebarType:n,data:i,x:r,y:a,width:o,height:s,mode:l,...h}=this.options,c=t.getSize(),[u]=this.padding;this.upsertCanvas().ready.then(()=>{let t={x:c[0]/2-o/2,y:u,onChange:t=>{let n=(ta(t)?t:[t,t]).map(t=>H(t,"Date")?t.getTime():t);"modify"===this.options.mode?this.filterElements(n):this.hiddenElements(n),null==e||e(n)},...h,data:i.map(t=>ec(t)?{time:t,value:0}:t),width:o,height:s,type:n};if(this.timebar)this.timebar.update(t);else{var r;this.timebar=new ll({style:t}),null===(r=this.canvas)||void 0===r||r.appendChild(this.timebar)}})}upsertWrapper(){var t;if(!this.wrapper){let t=document.createElement("div");t.style.position="absolute",this.wrapper=t}let{x:e,y:n,className:i,position:r}=this.options;return i&&(this.wrapper.className=i),ec(e)||ec(n)?Object.assign(this.wrapper.style,{left:"".concat(null!=e?e:0,"px"),top:"".concat(null!=n?n:0,"px")}):Object.assign(this.wrapper.style,{["top"===r?"bottom":"top"]:"unset",["top"===r?"top":"bottom"]:"0px"}),null===(t=this.context.canvas.getContainer())||void 0===t||t.appendChild(this.wrapper),this.wrapper}upsertCanvas(){var t,e;let n=this.upsertWrapper();if(this.canvas)return this.canvas;let{height:i}=this.options,[r]=this.context.canvas.getSize(),[a,,o]=this.padding;return this.canvas=new I.Xz({container:n,width:r,height:i+a+o,renderer:(null===(e=(t=this.context.options).renderer)||void 0===e?void 0:e.call(t,"main"))||new ox,supportsMutipleCanvasesInOneContainer:!0}),this.canvas}async filterElements(t){var e;if(!this.originalData)return;let{elementTypes:n,getTime:i}=this.options,{graph:r,element:a}=this.context,o=lu(this.originalData);n.forEach(e=>{let n="".concat(e,"s");o[n]=(this.originalData[n]||[]).filter(e=>{let n=i(e);return!!ld(n,t)})});let s=[...o.nodes,...o.combos].map(t=>tl(t));o.edges=o.edges.filter(t=>{let e=t.source,n=t.target;return s.includes(e)&&s.includes(n)}),r.setData(o),await (null===(e=a.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished)}hiddenElements(t){let{graph:e}=this.context,{elementTypes:n,getTime:i}=this.options,r=[],a=[];n.forEach(e=>{var n;let o=(null===(n=this.originalData)||void 0===n?void 0:n["".concat(e,"s")])||[];o.forEach(e=>{let n=tl(e),o=i(e);ld(o,t)?a.push(n):r.push(n)})}),e.hideElement(r,!1),e.showElement(a,!1)}destroy(){var t,e,n;let{graph:i}=this.context;this.originalData&&i.setData({...this.originalData}),null===(t=this.timebar)||void 0===t||t.destroy(),null===(e=this.canvas)||void 0===e||e.destroy(),null===(n=this.wrapper)||void 0===n||n.remove(),this.originalData=void 0,this.wrapper=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}constructor(t,e){super(t,Object.assign({},lc.defaultOptions,e)),this.backup(),this.upsertTimebar()}}lc.defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],padding:10,mode:"modify",getTime:t=>lp(t,lh,void 0),loop:!1};let lu=t=>{let{nodes:e=[],edges:n=[],combos:i=[]}=t;return{nodes:[...e],edges:[...n],combos:[...i]}},ld=(t,e)=>{if(ec(e))return t===e;let[n,i]=e;return t>=n&&t<=i},lp=(t,e,n)=>{for(let n=0;n<e.length;n++){var i;let r=e[n],a=null===(i=t.data)||void 0===i?void 0:i[r];if(a)return a}return n};class lf extends iZ{async update(t){super.update(t);let{className:e,position:n,style:i}=this.options;this.$element.className="g6-toolbar ".concat(e||""),Object.assign(this.$element.style,i,function(t){let e={top:"unset",right:"unset",bottom:"unset",left:"unset"},n=t.split("-");return n.forEach(t=>{e[t]="8px"}),e.flexDirection=t.startsWith("top")||t.startsWith("bottom")?"row":"column",e}(n)),this.$element.innerHTML=await this.getDOMContent()}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}async getDOMContent(){let t=await this.options.getItems();return t.map(t=>'\n          <div class="g6-toolbar-item" value="'.concat(t.value,'">\n            <svg aria-hidden="true" focusable="false">\n              <use xlink:href="#').concat(t.id,'"></use>\n            </svg>\n          </div>')).join("")}constructor(t,e){super(t,Object.assign({},lf.defaultOptions,e)),this.$element=iW("toolbar",!1),this.onToolbarItemClick=t=>{let{onClick:e}=this.options;if(t.target instanceof Element&&t.target.className.includes("g6-toolbar-item")){let n=t.target.getAttribute("value");null==e||e(n,t.target)}};let n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),iV("g6-toolbar-css","style",{},"\n  .g6-toolbar {\n    position: absolute;\n    z-index: 100;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);\n    opacity: 0.65;\n  }\n  .g6-toolbar .g6-toolbar-item {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    padding: 4px;\n    cursor: pointer;\n    box-sizing: content-box;\n  }\n\n  .g6-toolbar .g6-toolbar-item:hover {\n    background-color: #f0f0f0;\n  }\n\n  .g6-toolbar .g6-toolbar-item svg {\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n",document.head),iV("g6-toolbar-svgicon","div",{display:"none"},'\n  <svg>\n    <symbol id="zoom-in" viewBox="64 64 896 896">\n      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="zoom-out" viewBox="64 64 896 896">\n      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="edit" viewBox="64 64 896 896">\n      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>\n    </symbol>\n    <symbol id="delete" viewBox="64 64 896 896">\n      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>\n    </symbol>\n    <symbol id="redo" viewBox="64 64 896 896">\n      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>\n    </symbol>\n    <symbol id="undo" viewBox="64 64 896 896">\n      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>\n    </symbol>\n    <symbol id="export" viewBox="64 64 896 896">\n      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>\n    </symbol>\n    <symbol id="auto-fit" viewBox="64 64 896 896">\n      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>\n      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>\n    </symbol>\n    <symbol id="reset" viewBox="64 64 896 896">\n      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>\n    </symbol>\n    <symbol id="exit-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M418.13333333 361.43786666c0 0.2048-0.13653333 0.4096-0.13653334 0.68266667C417.99679999 362.32533333 418.13333333 362.53013333 418.13333333 362.73493333 418.13333333 371.54133333 414.44693333 379.392 408.78079999 385.39946666 408.43946666 385.7408 408.30293333 386.21866666 408.02986666 386.49173333c-1.09226667 1.09226667-2.59413333 1.77493333-3.82293333 2.73066667C398.40426666 393.65973333 391.64586666 396.8 383.93173333 396.8 383.72693333 396.8 383.59039999 396.73173333 383.38559999 396.73173333S382.97599999 396.8 382.77119999 396.8L112.29866666 396.8C92.50133333 396.8 76.79999999 381.50826666 76.79999999 362.66666666 76.66346666 343.89333333 92.63786666 328.53333333 112.16213333 328.53333333l189.44 0L87.44959999 114.51733333C73.59146666 100.59093333 73.25013333 78.5408 86.63039999 65.29706666c13.17546667-13.44853333 35.36213333-12.97066667 49.152 0.88746667l214.08426667 214.08426667L349.86666666 90.89706666C349.79839999 71.23626666 365.22666666 55.46666666 383.99999999 55.46666666 402.77333333 55.33013333 418.13333333 71.30453333 418.13333333 90.8288L418.13333333 361.43786666zM928.90453333 328.53333333l-189.44 0 214.15253333-214.08426667c13.85813333-13.9264 14.19946667-35.90826667 0.88746667-49.22026666-13.17546667-13.44853333-35.36213333-12.97066667-49.152 0.88746666l-214.08426667 214.08426667L691.26826666 90.89706666C691.26826666 71.23626666 675.83999999 55.46666666 657.06666666 55.46666666 638.29333333 55.33013333 622.93333333 71.30453333 622.93333333 90.8288l0 270.60906666c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 362.32533333 622.93333333 362.53013333 622.93333333 362.73493333 622.93333333 371.54133333 626.61973333 379.392 632.28586666 385.39946666c0.34133333 0.34133333 0.47786667 0.8192 0.8192 1.09226667 1.09226667 1.09226667 2.59413333 1.77493333 3.8912 2.73066667C642.66239999 393.65973333 649.42079999 396.8 657.13493333 396.8c0.2048 0 0.34133333-0.06826667 0.54613333-0.06826667S658.09066666 396.8 658.29546666 396.8l270.5408 0C948.56533333 396.8 964.26666666 381.50826666 964.26666666 362.66666666 964.40319999 343.89333333 948.42879999 328.53333333 928.90453333 328.53333333zM418.13333333 635.73333333c0-8.8064-3.6864-16.5888-9.35253334-22.66453333C408.43946666 612.72746666 408.30293333 612.2496 408.02986666 611.90826666 406.86933333 610.88426666 405.43573333 610.2016 404.20693333 609.24586666 398.47253333 604.80853333 391.64586666 601.6 383.93173333 601.6 383.72693333 601.6 383.59039999 601.73653333 383.38559999 601.73653333S382.97599999 601.6 382.77119999 601.6L112.29866666 601.6C92.50133333 601.6 76.79999999 616.96 76.79999999 635.73333333 76.66346666 654.50666666 92.63786666 669.86666666 112.16213333 669.86666666l189.44 0-214.15253334 214.15253334c-13.85813333 13.85813333-14.19946667 35.84-0.88746666 49.22026666 13.17546667 13.44853333 35.36213333 12.9024 49.152-0.95573333l214.08426666-214.08426667 0 189.37173334c0 19.59253333 15.42826667 35.49866667 34.2016 35.36213333C402.77333333 943.2064 418.13333333 927.232 418.13333333 907.5712L418.13333333 637.09866666c0-0.27306667-0.13653333-0.47786667-0.13653334-0.68266666C417.99679999 636.14293333 418.13333333 635.93813333 418.13333333 635.73333333zM739.46453333 669.86666666l189.44 0c19.456 0 35.49866667-15.36 35.36213333-34.13333333C964.26666666 616.96 948.56533333 601.6 928.76799999 601.6L658.29546666 601.6C658.09066666 601.6 657.88586666 601.73653333 657.68106666 601.73653333S657.33973333 601.6 657.13493333 601.6C649.42079999 601.6 642.59413333 604.80853333 636.85973333 609.24586666 635.63093333 610.2016 634.19733333 610.88426666 633.03679999 611.90826666 632.76373333 612.2496 632.62719999 612.72746666 632.28586666 613.0688 626.61973333 619.14453333 622.93333333 626.92693333 622.93333333 635.73333333c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 636.6208 622.93333333 636.8256 622.93333333 637.09866666l0 270.5408C622.93333333 927.232 638.29333333 943.2064 657.06666666 942.93333333c18.77333333 0.13653333 34.2016-15.70133333 34.2016-35.36213333l0-189.37173334 214.08426667 214.08426667c13.78986667 13.85813333 35.90826667 14.40426667 49.152 0.95573333 13.312-13.312 12.97066667-35.36213333-0.88746667-49.22026666L739.46453333 669.86666666z"  ></path></symbol>\n    <symbol id="request-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M69.818182 87.598545v273.128728a34.909091 34.909091 0 0 0 69.818182 0V163.653818l221.928727 222.021818a33.512727 33.512727 0 0 0 47.383273-47.383272L186.926545 116.363636h197.073455a34.909091 34.909091 0 0 0 0-69.818181H110.871273C85.364364 46.545455 69.818182 59.671273 69.818182 87.598545zM938.542545 46.545455H665.413818a34.909091 34.909091 0 0 0 0 69.818181h197.073455L640.465455 338.292364a33.512727 33.512727 0 0 0 47.383272 47.383272l221.928728-222.021818v197.073455a34.909091 34.909091 0 0 0 69.818181 0V87.598545c0-27.927273-15.453091-41.053091-40.96-41.05309z m-827.671272 907.636363h273.128727a34.909091 34.909091 0 0 0 0-69.818182H186.926545l222.021819-221.928727a33.512727 33.512727 0 0 0-47.383273-47.383273L139.636364 837.073455V640a34.909091 34.909091 0 0 0-69.818182 0v273.128727c0 27.927273 15.546182 41.053091 41.053091 41.053091z m868.724363-41.053091V640a34.909091 34.909091 0 0 0-69.818181 0v197.073455L687.941818 615.051636a33.512727 33.512727 0 0 0-47.383273 47.383273L862.487273 884.363636H665.413818a34.909091 34.909091 0 0 0 0 69.818182h273.128727c25.6 0 41.053091-13.125818 41.053091-41.053091z"  ></path></symbol>\n  </svg>\n'),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}}function lg(t){var e=document.createElement("div");e.innerHTML=t;var n=e.childNodes[0];return n&&e.contains(n)&&e.removeChild(n),n}lf.defaultOptions={position:"top-left"};var ly=function(t,e){if(null==e){t.innerHTML="";return}t.replaceChildren?Array.isArray(e)?t.replaceChildren.apply(t,(0,rA.ev)([],(0,rA.CR)(e),!1)):t.replaceChildren(e):(t.innerHTML="",Array.isArray(e)?e.forEach(function(e){return t.appendChild(e)}):t.appendChild(e))};function lm(t){return void 0===t&&(t=""),{CONTAINER:"".concat(t,"tooltip"),TITLE:"".concat(t,"tooltip-title"),LIST:"".concat(t,"tooltip-list"),LIST_ITEM:"".concat(t,"tooltip-list-item"),NAME:"".concat(t,"tooltip-list-item-name"),MARKER:"".concat(t,"tooltip-list-item-marker"),NAME_LABEL:"".concat(t,"tooltip-list-item-name-label"),VALUE:"".concat(t,"tooltip-list-item-value"),CROSSHAIR_X:"".concat(t,"tooltip-crosshair-x"),CROSSHAIR_Y:"".concat(t,"tooltip-crosshair-y")}}var lv={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},lb=function(t){function e(e){var n,i,r,a,o,s=this,l=null===(o=null===(a=e.style)||void 0===a?void 0:a.template)||void 0===o?void 0:o.prefixCls,h=lm(l);return(s=t.call(this,e,{data:[],x:0,y:0,visibility:"visible",title:"",position:"bottom-right",offset:[5,5],enterable:!1,container:{x:0,y:0},bounding:null,template:{prefixCls:"",container:'<div class="'.concat(h.CONTAINER,'"></div>'),title:'<div class="'.concat(h.TITLE,'"></div>'),item:'<li class="'.concat(h.LIST_ITEM,'" data-index={index}>\n        <span class="').concat(h.NAME,'">\n          <span class="').concat(h.MARKER,'" style="background:{color}"></span>\n          <span class="').concat(h.NAME_LABEL,'" title="{name}">{name}</span>\n        </span>\n        <span class="').concat(h.VALUE,'" title="{value}">{value}</span>\n      </li>')},style:(void 0===(n=l)&&(n=""),r=lm(n),(i={})[".".concat(r.CONTAINER)]={position:"absolute",visibility:"visible","z-index":8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)","background-color":"rgba(255, 255, 255, 0.96)","box-shadow":"0 6px 12px 0 rgba(0, 0, 0, 0.12)","border-radius":"4px",color:"rgba(0, 0, 0, 0.65)","font-size":"12px","line-height":"20px",padding:"12px","min-width":"120px","max-width":"360px","font-family":"Roboto-Regular"},i[".".concat(r.TITLE)]={color:"rgba(0, 0, 0, 0.45)"},i[".".concat(r.LIST)]={margin:"0px","list-style-type":"none",padding:"0px"},i[".".concat(r.LIST_ITEM)]={"list-style-type":"none",display:"flex","line-height":"2em","align-items":"center","justify-content":"space-between","white-space":"nowrap"},i[".".concat(r.MARKER)]={width:"8px",height:"8px","border-radius":"50%",display:"inline-block","margin-right":"4px"},i[".".concat(r.NAME)]={display:"flex","align-items":"center","max-width":"216px"},i[".".concat(r.NAME_LABEL)]=(0,rA.pi)({flex:1},lv),i[".".concat(r.VALUE)]=(0,rA.pi)({display:"inline-block",float:"right",flex:1,"text-align":"right","min-width":"28px","margin-left":"30px",color:"rgba(0, 0, 0, 0.85)"},lv),i[".".concat(r.CROSSHAIR_X)]={position:"absolute",width:"1px","background-color":"rgba(0, 0, 0, 0.25)"},i[".".concat(r.CROSSHAIR_Y)]={position:"absolute",height:"1px","background-color":"rgba(0, 0, 0, 0.25)"},i)})||this).timestamp=-1,s.prevCustomContentKey=s.attributes.contentKey,s.initShape(),s.render(s.attributes,s),s}return(0,rA.ZT)(e,t),Object.defineProperty(e.prototype,"HTMLTooltipElement",{get:function(){return this.element},enumerable:!1,configurable:!0}),e.prototype.getContainer=function(){return this.element},Object.defineProperty(e.prototype,"elementSize",{get:function(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"HTMLTooltipItemsElements",{get:function(){var t=this.attributes,e=t.data,n=t.template;return e.map(function(t,e){var i,r=t.name,a=t.color,o=t.index,s=(0,rA._T)(t,["name","color","index"]),l=(0,rA.pi)({name:void 0===r?"":r,color:void 0===a?"black":a,index:null!=o?o:e},s);return lg((i=n.item)&&l?i.replace(/\\?\{([^{}]+)\}/g,function(t,e){return"\\"===t.charAt(0)?t.slice(1):void 0===l[e]?"":l[e]}):i)})},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){this.renderHTMLTooltipElement(),this.updatePosition()},e.prototype.destroy=function(){var e;null===(e=this.element)||void 0===e||e.remove(),t.prototype.destroy.call(this)},e.prototype.show=function(t,e){var n=this;if(void 0!==t&&void 0!==e){var i="hidden"===this.element.style.visibility,r=function(){n.attributes.x=null!=t?t:n.attributes.x,n.attributes.y=null!=e?e:n.attributes.y,n.updatePosition()};i?this.closeTransition(r):r()}this.element.style.visibility="visible"},e.prototype.hide=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.attributes.enterable&&this.isCursorEntered(t,e)||(this.element.style.visibility="hidden")},e.prototype.initShape=function(){var t=this.attributes.template;this.element=lg(t.container),this.id&&this.element.setAttribute("id",this.id)},e.prototype.renderCustomContent=function(){if(void 0===this.prevCustomContentKey||this.prevCustomContentKey!==this.attributes.contentKey){this.prevCustomContentKey=this.attributes.contentKey;var t=this.attributes.content;t&&("string"==typeof t?this.element.innerHTML=t:ly(this.element,t))}},e.prototype.renderHTMLTooltipElement=function(){var t,e,n=this.attributes,i=n.template,r=n.title,a=n.enterable,o=n.style,s=n.content,l=lm(i.prefixCls),h=this.element;if(this.element.style.pointerEvents=a?"auto":"none",s)this.renderCustomContent();else{r?(h.innerHTML=i.title,h.getElementsByClassName(l.TITLE)[0].innerHTML=r):null===(e=null===(t=h.getElementsByClassName(l.TITLE))||void 0===t?void 0:t[0])||void 0===e||e.remove();var c=this.HTMLTooltipItemsElements,u=document.createElement("ul");u.className=l.LIST,ly(u,c);var d=this.element.querySelector(".".concat(l.LIST));d?d.replaceWith(u):h.appendChild(u)}!function(t,e){Object.entries(e).forEach(function(e){var n=(0,rA.CR)(e,2),i=n[0],r=n[1];(0,rA.ev)([t],(0,rA.CR)(t.querySelectorAll(i)),!1).filter(function(t){return t.matches(i)}).forEach(function(t){t&&(t.style.cssText+=Object.entries(r).reduce(function(t,e){return"".concat(t).concat(e.join(":"),";")},""))})})}(h,o)},e.prototype.getRelativeOffsetFromCursor=function(t){var e=this.attributes,n=e.position,i=e.offset,r=(t||n).split("-"),a={left:[-1,0],right:[1,0],top:[0,-1],bottom:[0,1]},o=this.elementSize,s=o.width,l=o.height,h=[-s/2,-l/2];return r.forEach(function(t){var e=(0,rA.CR)(h,2),n=e[0],r=e[1],o=(0,rA.CR)(a[t],2),c=o[0],u=o[1];h=[n+(s/2+i[0])*c,r+(l/2+i[1])*u]}),h},e.prototype.setOffsetPosition=function(t){var e=(0,rA.CR)(t,2),n=e[0],i=e[1],r=this.attributes,a=r.x,o=r.y,s=r.container,l=s.x,h=s.y;this.element.style.left="".concat(+(void 0===a?0:a)+l+n,"px"),this.element.style.top="".concat(+(void 0===o?0:o)+h+i,"px")},e.prototype.updatePosition=function(){var t=this.attributes.showDelay,e=Date.now();this.timestamp>0&&e-this.timestamp<(void 0===t?60:t)||(this.timestamp=e,this.setOffsetPosition(this.autoPosition(this.getRelativeOffsetFromCursor())))},e.prototype.autoPosition=function(t){var e=(0,rA.CR)(t,2),n=e[0],i=e[1],r=this.attributes,a=r.x,o=r.y,s=r.bounding,l=r.position;if(!s)return[n,i];var h=this.element,c=h.offsetWidth,u=h.offsetHeight,d=(0,rA.CR)([+a+n,+o+i],2),p=d[0],f=d[1],g={left:"right",right:"left",top:"bottom",bottom:"top"},y=s.x,m=s.y,v={left:p<y,right:p+c>y+s.width,top:f<m,bottom:f+u>m+s.height},b=[];l.split("-").forEach(function(t){v[t]?b.push(g[t]):b.push(t)});var x=b.join("-");return this.getRelativeOffsetFromCursor(x)},e.prototype.isCursorEntered=function(t,e){if(this.element){var n=this.element.getBoundingClientRect(),i=n.x,r=n.y,a=n.width,o=n.height;return new rT(i,r,a,o).isPointIn(t,e)}return!1},e.prototype.closeTransition=function(t){var e=this,n=this.element.style.transition;this.element.style.transition="none",t(),setTimeout(function(){e.element.style.transition=n},10)},e.tag="tooltip",e}(rV);class lx extends iZ{getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){if(this.unbindEvents(),super.update(t),this.tooltipElement){var e;null===(e=this.container)||void 0===e||e.removeChild(this.tooltipElement.HTMLTooltipElement)}this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){let{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.off(n,e[n])})}bindEvents(){let{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach(n=>{t.on(n,e[n])})}destroy(){if(this.unbindEvents(),this.tooltipElement){var t;null===(t=this.container)||void 0===t||t.removeChild(this.tooltipElement.HTMLTooltipElement)}super.destroy()}constructor(t,e){super(t,Object.assign({},lx.defaultOptions,e)),this.currentTarget=null,this.tooltipElement=null,this.container=null,this.isEnable=t=>{let{enable:e}=this.options;return"function"==typeof e?e(t):e},this.onClick=t=>{let{target:{id:e}}=t;this.currentTarget===e?(this.currentTarget=null,this.hide(t)):(this.currentTarget=e,this.show(t))},this.onPointerMove=t=>{let{target:e}=t;this.currentTarget&&e.id!==this.currentTarget&&this.show(t)},this.onPointerLeave=t=>{this.hide(t),this.currentTarget=null},this.onCanvasMove=t=>{this.hide(t),this.currentTarget=null},this.onPointerEnter=t=>{this.show(t)},this.showById=t=>{this.show({target:{id:t}})},this.getElementData=(t,e)=>{let{model:n}=this.context;switch(e){case"node":return n.getNodeData([t]);case"edge":return n.getEdgeData([t]);case"combo":return n.getComboData([t]);default:return[]}},this.show=t=>{let e,n;let{client:i,target:{id:r}}=t;if(ir(t.target)||!this.tooltipElement||!this.isEnable(t))return;let a=this.context.graph.getElementType(r),{getContent:o,title:s}=this.options;this.currentTarget=r;let l=this.getElementData(r,a);if(i)e=i.x,n=i.y;else{let t=eh(l,"0.style",{x:0,y:0});e=t.x,n=t.y}let h={};if(o)h.content=o(t,l);else{let t=this.context.graph.getElementRenderStyle(r),e="node"===a?t.fill:t.stroke;h={title:s||a,data:l.map(t=>({name:"ID",value:t.id||"".concat(t.source," -> ").concat(t.target),color:e}))}}this.tooltipElement.update({x:e,y:n,style:{".tooltip":{visibility:"visible"}},...h})},this.hide=t=>{if(!t){var e;null===(e=this.tooltipElement)||void 0===e||e.hide();return}if(!this.tooltipElement||!this.isEnable(t))return;let{client:{x:n,y:i}}=t;this.tooltipElement.hide(n,i)},this.initTooltip=()=>{var t;let{canvas:e}=this.context,{center:n}=e.getBounds(),i=e.getContainer(),{top:r,left:a}=i.getBoundingClientRect(),{style:o,position:s,enterable:l,container:h={x:-a,y:-r},title:c,offset:u}=this.options,[d,p]=n,[f,g]=e.getSize(),y=new lb({className:"tooltip",style:{x:d,y:p,container:h,title:c,bounding:{x:0,y:0,width:f,height:g},position:s,enterable:l,offset:u,style:o}});return null===(t=this.container)||void 0===t||t.appendChild(y.HTMLTooltipElement),y},this.render(),this.bindEvents()}}function lE(t,e){i||(i=document.createElement("canvas")),i.width=t,i.height=e;let n=i.getContext("2d");return n.clearRect(0,0,t,e),i}async function lw(t,e,n,i){let r=lE(t,e),a=r.getContext("2d"),{rotate:o,opacity:s,textFill:l,textFontSize:h,textFontFamily:c,textFontVariant:u,textFontWeight:d,textAlign:p,textBaseline:f}=i;return a.textAlign=p,a.textBaseline=f,a.translate(t/2,e/2),a.font="".concat(h,"px ").concat(c," ").concat(u," ").concat(d),o&&a.rotate(o),s&&(a.globalAlpha=s),l&&(a.fillStyle=l,a.fillText("".concat(n),0,0)),r.toDataURL()}async function lC(t,e,n,i){let r=lE(t,e),a=r.getContext("2d"),{rotate:o,opacity:s}=i;o&&a.rotate(o),s&&(a.globalAlpha=s);let l=new Image;return l.crossOrigin="anonymous",l.src=n,new Promise(n=>{l.onload=function(){let i=t>l.width?(t-l.width)/2:0,o=e>l.height?(e-l.height)/2:0;a.drawImage(l,0,0,l.width,l.height,i,o,t-2*i,e-2*o),n(r.toDataURL())}})}lx.defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};class lS extends iZ{async update(t){super.update(t);let{width:e,height:n,text:i,imageURL:r,...a}=this.options;Object.keys(a).forEach(e=>{e.startsWith("background")&&(this.$element.style[e]=t[e])});let o=r?await lC(e,n,r,a):await lw(e,n,i,a);this.$element.style.backgroundImage="url(".concat(o,")")}destroy(){super.destroy(),this.$element.remove()}constructor(t,e){super(t,Object.assign({},lS.defaultOptions,e)),this.$element=iW("watermark");let n=this.context.canvas.getContainer();n.appendChild(this.$element),this.update(e)}}lS.defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};let lM=["#7E92B5","#F4664A","#FFBE3A"],lR={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},lO={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function lA(t){let{bgColor:e,textColor:n,nodeColor:i,nodeColorDisabled:r,nodeStroke:a,nodeHaloStrokeOpacityActive:o=.15,nodeHaloStrokeOpacitySelected:s=.25,nodeOpacityDisabled:l=.06,nodeIconOpacityInactive:h=.85,nodeOpacityInactive:c=.25,nodeBadgePalette:u=lM,nodePaletteOptions:d=lR,edgeColor:p,edgeColorDisabled:f,edgePaletteOptions:g=lO,comboColor:y,comboColorDisabled:m,comboStroke:v,comboStrokeDisabled:b,edgeColorInactive:x}=t;return{background:e,node:{palette:d,style:{donutOpacity:1,badgeBackgroundOpacity:1,badgeFill:"#fff",badgeFontSize:8,badgePadding:[0,4],badgePalette:u,fill:i,fillOpacity:1,halo:!1,iconFill:"#fff",iconOpacity:1,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelFill:n,labelFillOpacity:.85,labelLineHeight:16,labelPadding:[0,2],labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelOffsetY:2,lineWidth:0,portFill:i,portLineWidth:1,portStroke:a,portStrokeOpacity:.65,size:32,stroke:a,strokeOpacity:1,zIndex:2},state:{selected:{halo:!0,haloLineWidth:24,haloStrokeOpacity:s,labelFontSize:12,labelFontWeight:"bold",lineWidth:4,stroke:a},active:{halo:!0,haloLineWidth:12,haloStrokeOpacity:o},highlight:{labelFontWeight:"bold",lineWidth:4,stroke:a,strokeOpacity:.85},inactive:{badgeBackgroundOpacity:c,donutOpacity:c,fillOpacity:c,iconOpacity:h,labelFill:n,labelFillOpacity:c,strokeOpacity:c},disabled:{badgeBackgroundOpacity:.25,donutOpacity:l,fill:r,fillOpacity:l,iconFill:r,iconOpacity:.25,labelFill:n,labelFillOpacity:.25,strokeOpacity:l}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}],translate:[{fields:["x","y"]}]}},edge:{palette:g,style:{badgeBackgroundFill:p,badgeFill:"#fff",badgeFontSize:8,badgeOffsetX:10,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:1,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:p,strokeOpacity:1,zIndex:1},state:{selected:{halo:!0,haloStrokeOpacity:.25,labelFontSize:14,labelFontWeight:"bold",lineWidth:3},active:{halo:!0,haloStrokeOpacity:.15},highlight:{labelFontWeight:"bold",lineWidth:3},inactive:{stroke:x,fillOpacity:.08,labelOpacity:.25,strokeOpacity:.08,badgeBackgroundOpacity:.25},disabled:{stroke:f,fillOpacity:.45,strokeOpacity:.45,labelOpacity:.25,badgeBackgroundOpacity:.45}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}],translate:[{fields:["sourceNode","targetNode"]}]}},combo:{style:{collapsedMarkerFill:e,collapsedMarkerFontSize:12,collapsedMarkerFillOpacity:1,collapsedSize:32,collapsedFillOpacity:1,fill:y,halo:!1,haloLineWidth:12,haloStroke:v,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:.04,strokeOpacity:1,padding:10,stroke:v},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:m,fillOpacity:.25,labelOpacity:.25,stroke:b,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}],translate:[{fields:["x","y"]}]}}}}let lT=lA({bgColor:"#000000",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696",edgeColor:"#637088",edgeColorDisabled:"#637088",edgeColorInactive:"#D0E4FF",edgePaletteOptions:{type:"group",color:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"]},nodeColor:"#1783ff",nodeColorDisabled:"#D0E4FF",nodeHaloStrokeOpacityActive:.25,nodeHaloStrokeOpacitySelected:.45,nodeIconOpacityInactive:.45,nodeOpacityDisabled:.25,nodeOpacityInactive:.45,nodeStroke:"#d0e4ff",textColor:"#ffffff"}),lk=lA({bgColor:"#ffffff",comboColor:"#99ADD1",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",edgeColorInactive:"#1B324F",nodeColor:"#1783ff",nodeColorDisabled:"#1B324F",nodeHaloStrokeOpacityActive:.15,nodeHaloStrokeOpacitySelected:.25,nodeIconOpacityInactive:.85,nodeOpacityDisabled:.06,nodeOpacityInactive:.25,nodeStroke:"#000000",textColor:"#000000"});class lP extends tv{beforeDraw(t,e){return t}}function lL(t,e,n,i,r){let a=tl(i),o="".concat(n,"s"),s=r?i:t.add[o].get(a)||t.update[o].get(a)||t.remove[o].get(a)||i;Object.entries(t).forEach(t=>{let[n,i]=t;e===n?i[o].set(a,s):i[o].delete(a)})}let lD=(t,e,n,i)=>{let r="".concat(n,"s"),a=tl(i);t.add[r].has(a)||t.update[r].has(a)||t[e][r].set(tl(i),i)};class lN{constructor(t){this.type=t}}class lI extends lN{constructor(t,e){super(t),this.data=e}}class lB extends lN{constructor(t,e,n,i){super(t),this.animationType=e,this.animation=n,this.data=i}}class l_ extends lN{constructor(t,e,n){super(t),this.elementType=e,this.data=n}}class lF extends lN{constructor(t,e){super(t),this.data=e}}function lj(t,e){t.emit(e.type,e)}class lz{getTasks(){let t=[...this.tasks];return this.tasks=[],t}add(t,e){this.tasks.push([t,e])}animate(t,e,n){var i,r,a;null==e||null===(i=e.before)||void 0===i||i.call(e);let o=this.getTasks().map(e=>{var i,r,a;let[o,s]=e,{element:l,elementType:h,stage:c}=o,u=function(t,e,n,i){var r,a;let{animation:o}=t,s=null==t?void 0:null===(r=t[e])||void 0===r?void 0:r.animation;if(!1===s)return[];let l=null==s?void 0:s[n];if(!1===l||!1===o||!1===i)return[];let h=null===(a=tt(t)[e])||void 0===a?void 0:a.animation,c=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(function(t){if("string"==typeof t){let e=q(A.ANIMATION,t);return e||(J.warn("The animation of ".concat(t," is not registered.")),[])}return t})(t).map(t=>({...Y,...Z(o)&&o,...t,...Z(i)&&i}))};if(l)return c(l);if(!h)return[];let u=h[n];return!1===u?[]:c(u)}(this.context.options,h,c,t);null==s||null===(i=s.before)||void 0===i||i.call(s);let d=td(l,this.inferStyle(o,n),u);return d?(null==s||null===(a=s.beforeAnimate)||void 0===a||a.call(s,d),d.finished.then(()=>{var t,e;null==s||null===(t=s.afterAnimate)||void 0===t||t.call(s,d),null==s||null===(e=s.after)||void 0===e||e.call(s),this.animations.delete(d)})):null==s||null===(r=s.after)||void 0===r||r.call(s),d}).filter(Boolean);o.forEach(t=>this.animations.add(t));let s=te(o);return s?(null==e||null===(a=e.beforeAnimate)||void 0===a||a.call(e,s),s.finished.then(()=>{var t,n;null==e||null===(t=e.afterAnimate)||void 0===t||t.call(e,s),null==e||null===(n=e.after)||void 0===n||n.call(e),this.release()})):null==e||null===(r=e.after)||void 0===r||r.call(e),s}inferStyle(t,e){var n;let{element:i,elementType:r,stage:a,originalStyle:o,modifiedStyle:s}=t,l={...o},h={...s},c=()=>null!==(n=eC(i,"opacity"))&&void 0!==n?n:ti("opacity");if("enter"===a)Object.assign(l,{opacity:0});else if("exit"===a)Object.assign(h,{opacity:0});else if("show"===a)Object.assign(l,{opacity:0}),Object.assign(h,{opacity:c()});else if("hide"===a)Object.assign(l,{opacity:c()}),Object.assign(h,{opacity:0});else if("collapse"===a){let{collapse:t}=e||{},{target:n,descendants:a,position:o}=t;if("node"===r){if(a.includes(i.id)){let[t,e,n]=o;Object.assign(h,{x:t,y:e,z:n})}}else if("combo"===r){if(i.id===n||a.includes(i.id)){let[t,e]=o;Object.assign(h,{x:t,y:e,childrenNode:l.childrenNode})}}else"edge"===r&&Object.assign(h,{sourceNode:l.sourceNode,targetNode:l.targetNode})}else if("expand"===a){let{expand:t}=e||{},{target:n,descendants:a,position:o}=t;if("node"===r){if(i.id===n||a.includes(i.id)){let[t,e,n]=o;Object.assign(l,{x:t,y:e,z:n})}}else if("combo"===r){if(i.id===n||a.includes(i.id)){let[t,e,n]=o;Object.assign(l,{x:t,y:e,z:n,childrenNode:h.childrenNode})}}else"edge"===r&&Object.assign(l,{sourceNode:h.sourceNode,targetNode:h.targetNode})}return[l,h]}stop(){this.animations.forEach(t=>t.cancel())}clear(){this.tasks=[]}release(){var t,e;let{canvas:n}=this.context,i=null===(t=n.document)||void 0===t?void 0:null===(e=t.timeline)||void 0===e?void 0:e.animationsWithPromises;i&&(n.document.timeline.animationsWithPromises=i.filter(t=>"finished"!==t.playState))}destroy(){this.stop(),this.animations.clear(),this.tasks=[]}constructor(t){this.tasks=[],this.animations=new Set,this.context=t}}class lG{emit(t){let{graph:e}=this.context;e.emit(t.type,t)}startBatch(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.batchCount++,1===this.batchCount&&this.emit(new lI(M.BATCH_START,{initiate:t}))}endBatch(){this.batchCount--,0===this.batchCount&&this.emit(new lI(M.BATCH_END))}get isBatching(){return this.batchCount>0}destroy(){this.context=null}constructor(t){this.batchCount=0,this.context=t}}class lH extends tm{setBehaviors(t){this.setExtensions(t)}forwardEvents(){let t=this.context.canvas.getContainer();t&&[C.KEY_DOWN,C.KEY_UP].forEach(e=>{t.addEventListener(e,this.forwardContainerEvents)});let e=this.context.canvas.document;e&&[w.CLICK,w.DBLCLICK,w.POINTER_OVER,w.POINTER_LEAVE,w.POINTER_ENTER,w.POINTER_MOVE,w.POINTER_OUT,w.POINTER_DOWN,w.POINTER_UP,w.CONTEXT_MENU,w.DRAG_START,w.DRAG,w.DRAG_END,w.DRAG_ENTER,w.DRAG_OVER,w.DRAG_LEAVE,w.DROP,w.WHEEL].forEach(t=>{e.addEventListener(t,this.forwardCanvasEvents)})}destroy(){let t=this.context.canvas.getContainer();t&&[C.KEY_DOWN,C.KEY_UP].forEach(e=>{t.removeEventListener(e,this.forwardContainerEvents)}),this.context.canvas.document.removeAllEventListeners(),super.destroy()}constructor(t){super(t),this.currentTarget=null,this.currentTargetType=null,this.category="behavior",this.forwardCanvasEvents=t=>{let{target:e}=t,n=function(t){if(!t)return null;if(t instanceof I.BB)return{type:"canvas",element:t};let e=t;for(;e;){if(nJ(e))return{type:"node",element:e};if(n0(e))return{type:"edge",element:e};if(n1(e))return{type:"combo",element:e};e=e.parentElement}return null}(e);if(!n)return;let{graph:i,canvas:r}=this.context,{type:a,element:o}=n;if("destroyed"in o&&(ir(o)||o.destroyed))return;let{type:s,detail:l,button:h}=t,c={...t,target:o,targetType:a,originalTarget:e};s===w.POINTER_MOVE&&(this.currentTarget!==o&&(this.currentTarget&&i.emit("".concat(this.currentTargetType,":").concat(w.POINTER_LEAVE),{...c,type:w.POINTER_LEAVE,target:this.currentTarget}),o&&(Object.assign(c,{type:w.POINTER_ENTER}),i.emit("".concat(a,":").concat(w.POINTER_ENTER),c))),this.currentTarget=o,this.currentTargetType=a),s===w.CLICK&&2===h||(i.emit("".concat(a,":").concat(s),c),i.emit(s,c)),s===w.CLICK&&2===l&&(Object.assign(c,{type:w.DBLCLICK}),i.emit("".concat(a,":").concat(w.DBLCLICK),c),i.emit(w.DBLCLICK,c)),s===w.POINTER_DOWN&&2===h&&(Object.assign(c,{type:w.CONTEXT_MENU,preventDefault:()=>{var t;null===(t=r.getContainer())||void 0===t||t.addEventListener(w.CONTEXT_MENU,t=>t.preventDefault(),{once:!0})}}),i.emit("".concat(a,":").concat(w.CONTEXT_MENU),c),i.emit(w.CONTEXT_MENU,c))},this.forwardContainerEvents=t=>{this.context.graph.emit(t.type,t)},this.forwardEvents(),this.setBehaviors(this.context.options.behaviors||[])}}var lW=n(98875);let lV=["background","main","label","transient"];class lZ{getConfig(){return this.config}getLayer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.extends.layers[t]}getLayers(){return this.extends.layers}getRenderer(t){return this.extends.renderers[t]}getCamera(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getCamera()}getRoot(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getRoot()}getContextService(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.getLayer(t).getContextService()}setCursor(t){this.config.cursor=t,this.getLayer().setCursor(t)}get document(){return this.getLayer().document}get context(){return this.getLayer().context}get ready(){return Promise.all(Object.entries(this.getLayers()).map(t=>{let[,e]=t;return e.ready}))}resize(t,e){Object.assign(this.extends.config,{width:t,height:e}),Object.values(this.getLayers()).forEach(n=>{let i=n.getCamera(),r=i.getPosition(),a=i.getFocalPoint();n.resize(t,e),i.setPosition(r),i.setFocalPoint(a)})}getBounds(t){return tk(Object.values(this.getLayers()).map(e=>{let n=t?e.getRoot().childNodes.find(e=>e.classList.includes(t)):e.getRoot();return n}).filter(t=>(null==t?void 0:t.childNodes.length)>0).map(t=>t.getBounds()))}getContainer(){let t=this.extends.config.container;return"string"==typeof t?document.getElementById(t):t}getSize(){return[this.extends.config.width||0,this.extends.config.height||0]}appendChild(t,e){var n;let i=(null===(n=t.style)||void 0===n?void 0:n.$layer)||"main";return this.getLayer(i).appendChild(t,e)}setRenderer(t){if(t===this.extends.renderer)return;let e=lU(t);this.extends.renderers=e,Object.entries(e).forEach(t=>{let[e,n]=t;return this.getLayer(e).setRenderer(n)}),lY(this.getLayers())}getCanvasByViewport(t){return tJ(this.getLayer().viewport2Canvas(t0(t)))}getViewportByCanvas(t){return tJ(this.getLayer().canvas2Viewport(t0(t)))}getViewportByClient(t){return tJ(this.getLayer().client2Viewport(t0(t)))}getClientByViewport(t){return tJ(this.getLayer().viewport2Client(t0(t)))}getClientByCanvas(t){return this.getClientByViewport(this.getViewportByCanvas(t))}getCanvasByClient(t){let e=this.getLayer(),n=e.client2Viewport(t0(t));return tJ(e.viewport2Canvas(n))}async toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=window.devicePixelRatio||1,{mode:n="viewport",...i}=t,[r,a,o,s]=[0,0,0,0];if("viewport"===n)[o,s]=this.getSize();else if("overall"===n){let t=this.getBounds(),e=tO(t);[r,a]=t.min,[o,s]=e}let l=lg('<div id="virtual-image"></div>'),h=new I.Xz({width:o,height:s,renderer:new ox,devicePixelRatio:e,container:l,background:this.extends.config.background});await h.ready,h.appendChild(this.getLayer("background").getRoot().cloneNode(!0)),h.appendChild(this.getRoot().cloneNode(!0));let c=this.getLayer("label").getRoot().cloneNode(!0),u=h.viewport2Canvas({x:0,y:0}),d=this.getCanvasByViewport([0,0]);c.translate([d[0]-u.x,d[1]-u.y]),c.scale(1/this.getCamera().getZoom()),h.appendChild(c),h.appendChild(this.getLayer("transient").getRoot().cloneNode(!0));let p=this.getCamera(),f=h.getCamera();if("viewport"===n)f.setZoom(p.getZoom()),f.setPosition(p.getPosition()),f.setFocalPoint(p.getFocalPoint());else if("overall"===n){let[t,e,n]=f.getPosition(),[i,o,s]=f.getFocalPoint();f.setPosition([t+r,e+a,n]),f.setFocalPoint([i+r,o+a,s])}let g=h.getContextService();return new Promise(t=>{h.addEventListener(I.$6.RERENDER,async()=>{await new Promise(t=>setTimeout(t,300));let e=await g.toDataURL(i);t(e)})})}destroy(){Object.values(this.getLayers()).forEach(t=>{let e=t.getCamera();e.cancelLandmarkAnimation(),t.destroy()})}constructor(t){this.config=t;let{renderer:e,background:n,cursor:i,...r}=t,a=lU(e),o=Object.fromEntries(lV.map(t=>{let e=new I.Xz({...r,supportsMutipleCanvasesInOneContainer:!0,renderer:a[t],background:"background"===t?n:void 0});return[t,e]}));lY(o),this.extends={config:t,renderer:e,renderers:a,layers:o}}}function lU(t){return Object.fromEntries(lV.map(e=>{let n=(null==t?void 0:t(e))||new ox;return"main"===e?n.registerPlugin(new lW.S({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})):n.unregisterPlugin(n.getPlugin("dom-interaction")),[e,n]}))}function lY(t){Object.entries(t).forEach(t=>{let[e,n]=t,i=n.getContextService().getDomElement();i.style.position="absolute",i.style.outline="none",i.tabIndex=1,"main"!==e&&(i.style.pointerEvents="none")})}function lK(t,e){let{data:n,style:i,...r}=t,{data:a,style:o,...s}=e,l={...r,...s};return(n||a)&&Object.assign(l,{data:{...n,...a}}),(i||o)&&Object.assign(l,{style:{...i,...o}}),l}function l$(t){let{data:e,style:n,...i}=t;return e&&(i.data={...e}),n&&(i.style={...n}),i}function lX(t){let{id:e=tl(t),style:n,data:i,...r}=t,a={...t,style:{...n},data:{...i}};return"source"in t&&"target"in t?{id:e,data:a,...r}:{id:e,data:a}}function lq(t){return t.data}class lQ{pushChange(t){if(this.isTraceless)return;let{type:e}=t;if(e===v.NodeUpdated||e===v.EdgeUpdated||e===v.ComboUpdated){let{value:n,original:i}=t;this.changes.push({value:l$(n),original:l$(i),type:e})}else this.changes.push({value:l$(t.value),type:e})}getChanges(){return this.changes}clearChanges(){this.changes=[]}batch(t){this.batchCount++,this.model.batch(t),this.batchCount--}silence(t){this.isTraceless=!0,t(),this.isTraceless=!1}isCombo(t){return this.comboIds.has(t)||this.latestRemovedComboIds.has(t)}getData(){return{nodes:this.getNodeData(),edges:this.getEdgeData(),combos:this.getComboData()}}getNodeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=lq(n);return this.isCombo(tl(i))||(void 0===t?e.push(i):t.includes(tl(i))&&e.push(i)),e},[])}getEdgeDatum(t){return lq(this.model.getEdge(t))}getEdgeData(t){return this.model.getAllEdges().reduce((e,n)=>{let i=lq(n);return void 0===t?e.push(i):t.includes(tl(i))&&e.push(i),e},[])}getComboData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=lq(n);return this.isCombo(tl(i))&&(void 0===t?e.push(i):t.includes(tl(i))&&e.push(i)),e},[])}getAncestorsData(t,e){let{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getAncestors(t,e).map(lq):[]}getDescendantsData(t){let e=this.getElementDataById(t),n=[];return ei(e,t=>{t!==e&&n.push(t)},t=>this.getChildrenData(tl(t)),"TB"),n}getParentData(t,e){let{model:n}=this;if(!e){J.warn("The hierarchy structure key is not specified");return}if(!n.hasNode(t)||!n.hasTreeStructure(e))return;let i=n.getParent(t,e);return i?lq(i):void 0}getChildrenData(t){let e="node"===this.getElementType(t)?$:K,{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getChildren(t,e).map(lq):[]}getElementsDataByType(t){return"node"===t?this.getNodeData():"edge"===t?this.getEdgeData():"combo"===t?this.getComboData():[]}getElementDataById(t){let e=this.getElementType(t);return"edge"===e?this.getEdgeDatum(t):this.getNodeLikeDatum(t)}getNodeLikeDatum(t){let e=this.model.getNode(t);return lq(e)}getNodeLikeData(t){return this.model.getAllNodes().reduce((e,n)=>{let i=lq(n);return t?t.includes(tl(i))&&e.push(i):e.push(i),e},[])}getElementDataByState(t,e){let n=this.getElementsDataByType(t);return n.filter(t=>{var n;return null===(n=t.states)||void 0===n?void 0:n.includes(e)})}getElementState(t){var e;return(null===(e=this.getElementDataById(t))||void 0===e?void 0:e.states)||[]}hasNode(t){return this.model.hasNode(t)&&!this.isCombo(t)}hasEdge(t){return this.model.hasEdge(t)}hasCombo(t){return this.model.hasNode(t)&&this.isCombo(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.model.getRelatedEdges(t,e).map(lq)}getNeighborNodesData(t){return this.model.getNeighbors(t).map(lq)}setData(t){let{nodes:e=[],edges:n=[],combos:i=[]}=t,{nodes:r,edges:a,combos:o}=this.getData(),s=ty(r,e,t=>tl(t)),l=ty(a,n,t=>tl(t)),h=ty(o,i,t=>tl(t));this.batch(()=>{this.addData({nodes:s.enter,edges:l.enter,combos:h.enter}),this.updateData({nodes:s.update,edges:l.update,combos:h.update}),this.removeData({nodes:s.exit.map(tl),edges:l.exit.map(tl),combos:h.exit.map(tl)})})}addData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.addComboData(i),this.addNodeData(e),this.addEdgeData(n)})}addNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(this.model.addNodes(t.map(t=>(this.pushChange({value:t,type:v.NodeAdded}),lX(t)))),this.updateNodeLikeHierarchy(t))}addEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.model.addEdges(t.map(t=>(this.pushChange({value:t,type:v.EdgeAdded}),lX(t))))}addComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.hasTreeStructure(K)||e.attachTreeStructure(K),e.addNodes(t.map(t=>(this.comboIds.add(tl(t)),this.pushChange({value:t,type:v.ComboAdded}),lX(t)))),this.updateNodeLikeHierarchy(t)}addChildrenData(t,e){let n=this.getNodeLikeDatum(t),i=e.map(tl);this.addNodeData(e),this.updateNodeData([{id:t,children:[...n.children||[],...i]}]),this.addEdgeData(i.map(e=>({source:t,target:e})))}updateNodeLikeHierarchy(t){if(!this.enableUpdateNodeLikeHierarchy)return;let{model:e}=this;t.forEach(t=>{let n=tl(t);e.attachTreeStructure(K),this.setParent(n,t.combo,K);let i=t.children;if(void 0!==i){e.attachTreeStructure($);let t=i.filter(t=>e.hasNode(t));t.forEach(t=>this.setParent(t,n,$)),t.length!==i.length&&this.updateNodeData([{id:n,children:t}])}})}preventUpdateNodeLikeHierarchy(t){this.enableUpdateNodeLikeHierarchy=!1,t(),this.enableUpdateNodeLikeHierarchy=!0}updateData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.updateNodeData(e),this.updateComboData(i),this.updateEdgeData(n)})}updateNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{let n=[];t.forEach(t=>{let i=tl(t),r=lq(e.getNode(i));if(V(r,t))return;let a=lK(r,t);this.pushChange({value:a,original:r,type:v.NodeUpdated}),e.mergeNodeData(i,a),n.push(a)}),this.updateNodeLikeHierarchy(n)})}refreshData(){let{nodes:t,edges:e,combos:n}=this.getData();t.forEach(t=>{this.pushChange({value:t,original:t,type:v.NodeUpdated})}),e.forEach(t=>{this.pushChange({value:t,original:t,type:v.EdgeUpdated})}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}syncNodeDatum(t){let{model:e}=this,n=tl(t),i=lq(e.getNode(n)),r=lK(i,t);e.mergeNodeData(n,r)}updateEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;this.batch(()=>{t.forEach(t=>{let n=tl(t),i=lq(e.getEdge(n));if(V(i,t))return;t.source&&i.source!==t.source&&e.updateEdgeSource(n,t.source),t.target&&i.target!==t.target&&e.updateEdgeTarget(n,t.target);let r=lK(i,t);this.pushChange({value:r,original:i,type:v.EdgeUpdated}),e.mergeEdgeData(n,r)})})}updateComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.length)return;let{model:e}=this;e.batch(()=>{let n=[];t.forEach(t=>{let i=tl(t),r=lq(e.getNode(i));if(V(r,t))return;let a=lK(r,t);this.pushChange({value:a,original:r,type:v.ComboUpdated}),e.mergeNodeData(i,a),n.push(a)}),this.updateNodeLikeHierarchy(n)})}setParent(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t===e)return;let r=this.getNodeLikeDatum(t).combo;if(r!==e&&n===K){let n={id:t,combo:e};this.isCombo(t)?this.syncComboDatum(n):this.syncNodeDatum(n)}this.model.setParent(t,e,n),i&&n===K&&(function(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var i=0,r=t.length;i<r;i++){var a=t[i];e.has(a)||(n.push(a),e.set(a,!0))}return n})([r,e]).forEach(t=>{void 0!==t&&this.refreshComboData(t)})}refreshComboData(t){let e=this.getComboData([t])[0],n=this.getAncestorsData(t,K);e&&this.pushChange({value:e,original:e,type:v.ComboUpdated}),n.forEach(t=>{this.pushChange({value:t,original:t,type:v.ComboUpdated})})}syncComboDatum(t){let{model:e}=this,n=tl(t);if(!e.hasNode(n))return;let i=lq(e.getNode(n)),r=lK(i,t);e.mergeNodeData(n,r)}getElementPosition(t){let e=this.getElementDataById(t);return tq(e)}translateNodeLikeBy(t,e){this.isCombo(t)?this.translateComboBy(t,e):this.translateNodeBy(t,e)}translateNodeLikeTo(t,e){this.isCombo(t)?this.translateComboTo(t,e):this.translateNodeTo(t,e)}translateNodeBy(t,e){let n=this.getElementPosition(t),i=tB(n,[...e,0].slice(0,3));this.translateNodeTo(t,i)}translateNodeTo(t,e){let[n=0,i=0,r=0]=e;this.preventUpdateNodeLikeHierarchy(()=>{this.updateNodeData([{id:t,style:{x:n,y:i,z:r}}])})}translateComboBy(t,e){let[n=0,i=0,r=0]=e;if([n,i,r].some(isNaN)||[n,i,r].every(t=>0===t))return;let a=this.getComboData([t])[0];a&&ei(a,t=>{let e=tl(t),[a,o,s]=tq(t),l=lK(t,{style:{x:a+n,y:o+i,z:s+r}});this.pushChange({value:l,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,l)},t=>this.getChildrenData(tl(t)),"BT")}translateComboTo(t,e){var n;if(e.some(isNaN))return;let[i=0,r=0,a=0]=e,o=null===(n=this.getComboData([t]))||void 0===n?void 0:n[0];if(!o)return;let[s,l,h]=tq(o),c=i-s,u=r-l,d=a-h;ei(o,t=>{let e=tl(t),[n,i,r]=tq(t),a=lK(t,{style:{x:n+c,y:i+u,z:r+d}});this.pushChange({value:a,original:t,type:this.isCombo(e)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(e,a)},t=>this.getChildrenData(tl(t)),"BT")}removeData(t){let{nodes:e,edges:n,combos:i}=t;this.batch(()=>{this.removeEdgeData(n),this.removeNodeData(e),this.removeComboData(i),this.latestRemovedComboIds=new Set(i)})}removeNodeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.removeEdgeData(this.getRelatedEdgesData(t).map(tl)),this.pushChange({value:this.getNodeData([t])[0],type:v.NodeRemoved}),this.removeNodeLikeHierarchy(t)}),this.model.removeNodes(t)})}removeEdgeData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&(t.forEach(t=>this.pushChange({value:this.getEdgeData([t])[0],type:v.EdgeRemoved})),this.model.removeEdges(t))}removeComboData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length&&this.batch(()=>{t.forEach(t=>{this.pushChange({value:this.getComboData([t])[0],type:v.ComboRemoved}),this.removeNodeLikeHierarchy(t),this.comboIds.delete(t)}),this.model.removeNodes(t)})}removeNodeLikeHierarchy(t){if(this.model.hasTreeStructure(K)){let e=this.getNodeLikeDatum(t).combo;this.setParent(t,void 0,K,!1),this.model.getChildren(t,K).forEach(t=>{let n=lq(t),i=tl(n);this.setParent(tl(n),e,K,!1);let r=lK(n,{id:tl(n),combo:e});this.pushChange({value:r,original:n,type:this.isCombo(i)?v.ComboUpdated:v.NodeUpdated}),this.model.mergeNodeData(tl(n),r)}),ni(e)||this.refreshComboData(e)}}getElementType(t){if(this.model.hasNode(t))return this.isCombo(t)?"combo":"node";if(this.model.hasEdge(t))return"edge";throw Error(Q("Unknown element type of id: ".concat(t)))}destroy(){let{model:t}=this,e=t.getAllNodes(),n=t.getAllEdges();t.removeEdges(n.map(t=>t.id)),t.removeNodes(e.map(t=>t.id)),this.context={}}constructor(){this.latestRemovedComboIds=new Set,this.comboIds=new Set,this.changes=[],this.batchCount=0,this.isTraceless=!1,this.enableUpdateNodeLikeHierarchy=!0,this.model=new id.k}}class lJ{init(){if(!this.container){let{canvas:t}=this.context;this.container=t.appendChild(new I.ZA({className:"elements"}))}}emit(t,e){e.silence||lj(this.context.graph,t)}forEachElementData(t){en.forEach(e=>{let n=this.context.model.getElementsDataByType(e);t(e,n)})}getElementType(t,e){var n;let{options:i,graph:r}=this.context,a=(null===(n=i[t])||void 0===n?void 0:n.type)||e.type;return a?"string"==typeof a?a:a.call(r,e):"edge"===t?"line":"circle"}getTheme(t){return tt(this.context.options)[t]||{}}getThemeStyle(t){return this.getTheme(t).style||{}}getThemeStateStyle(t,e){let{state:n={}}=this.getTheme(t);return Object.assign({},...e.map(t=>n[t]||{}))}computePaletteStyle(){let{options:t}=this.context;this.paletteStyle={},this.forEachElementData((e,n)=>{var i,r;let a=Object.assign({},eT(null===(i=this.getTheme(e))||void 0===i?void 0:i.palette),eT(null===(r=t[e])||void 0===r?void 0:r.palette));(null==a?void 0:a.field)&&Object.assign(this.paletteStyle,function(t,e){if(!e)return{};let{type:n,color:i,field:r,invert:a}=e,o=t=>{let e="string"==typeof i?q("palette",i):i;if("function"==typeof e){let n={};return t.forEach(t=>{let[i,r]=t;n[i]=e(a?1-r:r)}),n}if(Array.isArray(e)){let n=a?[...e].reverse():e,i={};return t.forEach(t=>{let[r,a]=t;i[r]=n[a%e.length]}),i}return{}},s=(t,e)=>{var n;return"string"==typeof t?null===(n=e.data)||void 0===n?void 0:n[t]:null==t?void 0:t(e)};if("group"===n){let e=eA(t,t=>{if(!r)return"default";let e=s(r,t);return e?String(e):"default"}),n=Object.keys(e),i=o(n.map((t,e)=>[t,e])),a={};return Object.entries(e).forEach(t=>{let[e,n]=t;n.forEach(t=>{a[tl(t)]=i[e]})}),a}if("value"===n){let[e,n]=t.reduce((t,e)=>{let[n,i]=t,a=s(r,e);if("number"!=typeof a)throw Error(Q("Palette field ".concat(r," is not a number")));return[Math.min(n,a),Math.max(i,a)]},[1/0,-1/0]),i=n-e;return o(t.map(t=>[t.id,(s(r,t)-e)/i]))}}(n,a))})}getPaletteStyle(t,e){let n=this.paletteStyle[e];return n?"edge"===t?{stroke:n}:{fill:n}:{}}computeElementDefaultStyle(t,e){var n;let{options:i}=this.context,r=(null===(n=i[t])||void 0===n?void 0:n.style)||{};this.defaultStyle[tl(e.datum)]=ev(r,e)}computeElementsDefaultStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let r=i.length;for(let a=0;a<r;a++){let r=i[a];(void 0===t||t.includes(tl(r)))&&this.computeElementDefaultStyle(n,{datum:r,graph:e})}})}getDefaultStyle(t){return this.defaultStyle[t]||{}}getElementState(t){try{let{model:e}=this.context;return e.getElementState(t)}catch(t){return[]}}getElementStateStyle(t,e,n){var i,r;let{options:a}=this.context,o=(null===(i=a[t])||void 0===i?void 0:null===(r=i.state)||void 0===r?void 0:r[e])||{};return ev(o,n)}computeElementStatesStyle(t,e,n){this.stateStyle[tl(n.datum)]=Object.assign({},...e.map(e=>this.getElementStateStyle(t,e,n)))}computeElementsStatesStyle(t){let{graph:e}=this.context;this.forEachElementData((n,i)=>{let r=i.length;for(let a=0;a<r;a++){let r=i[a];if(void 0===t||t.includes(tl(r))){let t=this.getElementState(tl(r));this.computeElementStatesStyle(n,t,{datum:r,graph:e})}}})}getStateStyle(t){return this.stateStyle[t]||{}}computeStyle(t,e){t&&["translate","zIndex"].includes(t)||(this.computePaletteStyle(),this.computeElementsDefaultStyle(e),this.computeElementsStatesStyle(e))}getElement(t){return this.elementMap[t]}getElementZIndex(t){var e;let n=this.getElement(t);return n&&null!==(e=n.style.zIndex)&&void 0!==e?e:0}getNodes(){return this.context.model.getNodeData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getEdges(){return this.context.model.getEdgeData().map(t=>this.elementMap[tl(t)])}getCombos(){return this.context.model.getComboData().map(t=>{let{id:e}=t;return this.elementMap[e]})}getElementComputedStyle(t,e){let n=tl(e),i=this.getThemeStyle(t),r=this.getPaletteStyle(t,n),a=e.style||{},o=this.getDefaultStyle(n),s=this.getThemeStateStyle(t,this.getElementState(n)),l=this.getStateStyle(n),h=Object.assign({},i,r,a,o,s,l);if("combo"===t){let t=this.context.model.getChildrenData(n),e=!!h.collapsed,i=e?[]:t.map(tl).filter(t=>this.getElement(t));Object.assign(h,{childrenNode:i,childrenData:t})}return h}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{animation:!0};this.init();let e=this.computeChangesAndDrawData(t);if(!e)return null;let{dataChanges:n,drawData:i}=e;this.markDestroyElement(i),this.computeStyle(t.stage);let{add:r,update:a,remove:o}=i;this.destroyElements(o,t),this.createElements(r,t),this.updateElements(a,t);let{animation:s,silence:l}=t,{type:h="draw"}=t,c="render"===h;return this.context.animation.animate(s,l?{}:{before:()=>this.emit(new lI(M.BEFORE_DRAW,{dataChanges:n,animation:s,render:c}),t),beforeAnimate:e=>this.emit(new lB(M.BEFORE_ANIMATE,b.DRAW,e,i),t),afterAnimate:e=>this.emit(new lB(M.AFTER_ANIMATE,b.DRAW,e,i),t),after:()=>this.emit(new lI(M.AFTER_DRAW,{dataChanges:n,animation:s,render:c}),t)})}computeChangesAndDrawData(t){let{model:e}=this.context,n=e.getChanges(),i=rm(n);if(0===i.length)return null;let{NodeAdded:r=[],NodeUpdated:a=[],NodeRemoved:o=[],EdgeAdded:s=[],EdgeUpdated:l=[],EdgeRemoved:h=[],ComboAdded:c=[],ComboUpdated:u=[],ComboRemoved:d=[]}=eA(i,t=>t.type),p=t=>new Map(t.map(t=>{let e=t.value;return[tl(e),e]})),f={add:{nodes:p(r),edges:p(s),combos:p(c)},update:{nodes:p(a),edges:p(l),combos:p(u)},remove:{nodes:p(o),edges:p(h),combos:p(d)}},g=this.transformData(f,t);return e.clearChanges(),{dataChanges:n,drawData:g}}transformData(t,e){let n=this.context.transform.getTransformInstance();return Object.values(n).reduce((t,n)=>n.beforeDraw(t,e),t)}createElement(t,e,n){var i;let r=tl(e),a=this.getElement(r);if(a)return;let o=this.getElementType(t,e),s=this.getElementComputedStyle(t,e),l=q(t,o);if(!l)return J.warn("The element ".concat(o," of ").concat(t," is not registered."));this.emit(new l_(M.BEFORE_ELEMENT_CREATE,t,e),n);let h=this.container.appendChild(new l({id:r,style:{context:this.context,...s}}));this.shapeTypeMap[r]=o,this.elementMap[r]=h;let{stage:c="enter"}=n;null===(i=this.context.animation)||void 0===i||i.add({element:h,elementType:t,stage:c,originalStyle:{...h.attributes},modifiedStyle:{...h.attributes,...s}},{after:()=>{var i;this.emit(new l_(M.AFTER_ELEMENT_CREATE,t,e),n),null===(i=h.onCreate)||void 0===i||i.call(h)}})}createElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["node",n],["combo",r],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.createElement(n,t,e))})}updateElement(t,e,n){var i;let r=tl(e),a=this.getElement(r);if(!a)return()=>null;this.emit(new l_(M.BEFORE_ELEMENT_UPDATE,t,e),n);let o=this.getElementType(t,e),s=this.getElementComputedStyle(t,e);this.shapeTypeMap[r]!==o&&(a.destroy(),delete this.shapeTypeMap[r],delete this.elementMap[r],this.createElement(t,e,{animation:!1,silence:!0}));let{stage:l="update"}=n,h="visibility"!==l?l:"hidden"===s.visibility?"hide":"show";"hide"===h&&delete s.visibility,null===(i=this.context.animation)||void 0===i||i.add({element:a,elementType:t,stage:h,originalStyle:{...a.attributes},modifiedStyle:{...a.attributes,...s}},{before:()=>{let t=this.elementMap[r];"collapse"!==l&&ii(t,s),"visibility"===l&&(eS(t,"opacity")||ew(t,"opacity"),this.visibilityCache.set(t,"show"===h?"visible":"hidden"),"show"===h&&eN(t,"visible"))},after:()=>{var i;let a=this.elementMap[r];"collapse"===l&&ii(a,s),"hide"===h&&eN(a,this.visibilityCache.get(a)),this.emit(new l_(M.AFTER_ELEMENT_UPDATE,t,e),n),null===(i=a.onUpdate)||void 0===i||i.call(a)}})}updateElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["node",n],["combo",r],["edge",i]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.updateElement(n,t,e))})}markDestroyElement(t){Object.values(t.remove).forEach(t=>{t.forEach(t=>{let e=tl(t),n=this.getElement(e);n&&eu(n,"__to_be_destroyed__",!0)})})}destroyElement(t,e,n){var i;let{stage:r="exit"}=n,a=tl(e),o=this.elementMap[a];if(!o)return()=>null;this.emit(new l_(M.BEFORE_ELEMENT_DESTROY,t,e),n),null===(i=this.context.animation)||void 0===i||i.add({element:o,elementType:t,stage:r,originalStyle:{...o.attributes},modifiedStyle:{...o.attributes}},{after:()=>{var i;this.clearElement(a),o.destroy(),null===(i=o.onDestroy)||void 0===i||i.call(o),this.emit(new l_(M.AFTER_ELEMENT_DESTROY,t,e),n)}})}destroyElements(t,e){let{nodes:n,edges:i,combos:r}=t;[["combo",r],["edge",i],["node",n]].forEach(t=>{let[n,i]=t;i.forEach(t=>this.destroyElement(n,t,e))})}clearElement(t){delete this.paletteStyle[t],delete this.defaultStyle[t],delete this.stateStyle[t],delete this.elementMap[t],delete this.shapeTypeMap[t]}async collapseNode(t,e){var n;let{model:i,layout:r}=this.context,a=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.markDestroyElement(a.drawData);let o=await r.simulate();i.updateData(o);let{drawData:s}=this.computeChangesAndDrawData({stage:"collapse",animation:e}),{add:l,remove:h,update:c}=s;this.markDestroyElement(s);let u={animation:e,stage:"collapse",data:s};this.destroyElements(h,u),this.createElements(l,u),this.updateElements(c,u),await (null===(n=this.context.animation.animate(e,{beforeAnimate:t=>this.emit(new lB(M.BEFORE_ANIMATE,b.COLLAPSE,t,s),u),afterAnimate:t=>this.emit(new lB(M.AFTER_ANIMATE,b.COLLAPSE,t,s),u)},{collapse:{target:t,descendants:Array.from(h.nodes).map(t=>{let[,e]=t;return tl(e)}),position:tq(c.nodes.get(t))}}))||void 0===n?void 0:n.finished)}async expandNode(t,e){var n;let{model:i,layout:r}=this.context;if(!i.getAncestorsData(t,K).every(t=>el(t)))return;let a=tq(i.getNodeData([t])[0]),{drawData:{add:o}}=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.createElements(o,{animation:!1,stage:"expand"}),this.context.animation.clear();let s=await r.simulate();i.updateData(s),this.computeStyle("expand");let{drawData:l}=this.computeChangesAndDrawData({stage:"collapse",animation:e}),{update:h}=l,c={animation:e,stage:"expand",data:l};o.edges.forEach(t=>{let e=tl(t);h.edges.has(e)||h.edges.set(e,t)}),this.updateElements(h,c),await (null===(n=this.context.animation.animate(e,{beforeAnimate:t=>this.emit(new lB(M.BEFORE_ANIMATE,b.EXPAND,t,l),c),afterAnimate:t=>this.emit(new lB(M.AFTER_ANIMATE,b.EXPAND,t,l),c)},{expand:{target:t,descendants:Array.from(o.nodes).map(t=>{let[,e]=t;return tl(e)}),position:a}}))||void 0===n?void 0:n.finished)}async collapseCombo(t,e){var n;let{model:i,element:r}=this.context;if(i.getAncestorsData(t,K).some(t=>el(t)))return;let a=r.getElement(t),o=a.getComboPosition({...a.attributes,collapsed:!0}),{dataChanges:s,drawData:l}=this.computeChangesAndDrawData({stage:"collapse",animation:e});this.markDestroyElement(l);let{update:h,remove:c}=l,u={animation:e,stage:"collapse",data:l};this.destroyElements(c,u),this.updateElements(h,u);let d=t=>Array.from(t).map(t=>{let[,e]=t;return tl(e)});await (null===(n=this.context.animation.animate(e,{before:()=>this.emit(new lI(M.BEFORE_DRAW,{dataChanges:s,animation:e}),u),beforeAnimate:t=>this.emit(new lB(M.BEFORE_ANIMATE,b.COLLAPSE,t,l),u),afterAnimate:t=>this.emit(new lB(M.AFTER_ANIMATE,b.COLLAPSE,t,l),u),after:()=>this.emit(new lI(M.AFTER_DRAW,{dataChanges:s,animation:e}),u)},{collapse:{target:t,descendants:[...d(c.nodes),...d(c.combos)],position:o}}))||void 0===n?void 0:n.finished)}async expandCombo(t,e){var n;let{model:i}=this.context,r=tq(i.getComboData([t])[0]);this.computeStyle("expand");let{dataChanges:a,drawData:o}=this.computeChangesAndDrawData({stage:"expand",animation:e}),{add:s,update:l}=o,h={animation:e,stage:"expand",data:o};this.createElements(s,h),this.updateElements(l,h);let c=t=>Array.from(t).map(t=>{let[,e]=t;return tl(e)});await (null===(n=this.context.animation.animate(e,{before:()=>this.emit(new lI(M.BEFORE_DRAW,{dataChanges:a,animation:e}),h),beforeAnimate:t=>this.emit(new lB(M.BEFORE_ANIMATE,b.EXPAND,t,o),h),afterAnimate:t=>this.emit(new lB(M.AFTER_ANIMATE,b.EXPAND,t,o),h),after:()=>this.emit(new lI(M.AFTER_DRAW,{dataChanges:a,animation:e}),h)},{expand:{target:t,descendants:[...c(s.nodes),...c(s.combos)],position:r}}))||void 0===n?void 0:n.finished)}getFrontZIndex(t){let{model:e}=this.context,n=e.getElementType(t),i=e.getElementDataById(t),r=e.getData();if(Object.assign(r,{["".concat(n,"s")]:r["".concat(n,"s")].filter(e=>tl(e)!==t)}),"combo"===n&&!el(i)){let n=e.getAncestorsData(t,K).map(tl);r.nodes=r.nodes.filter(t=>!n.includes(tl(t))),r.combos=r.combos.filter(t=>!n.includes(tl(t))),r.edges=r.edges.filter(t=>{let{source:e,target:i}=t;return n.includes(e)&&n.includes(i)})}return Math.max(0,...Object.values(r).flat().map(t=>{let e=tl(t);return this.getElementZIndex(e)}))+1}destroy(){this.container.destroy(),this.elementMap={},this.shapeTypeMap={},this.defaultStyle={},this.stateStyle={},this.paletteStyle={},this.context={}}constructor(t){this.elementMap={},this.shapeTypeMap={},this.paletteStyle={},this.defaultStyle={},this.stateStyle={},this.visibilityCache=new WeakMap,this.context=t}}var l0=n(38027),l1=n(54375);class l2 extends ry.Z{constructor(t,e,n){super(),this.graph=t,this.layout=e,this.options=n,this.spawnWorker()}spawnWorker(){this.proxy=l1.Ud(new Worker(n.tu(new URL(n.p+n.u(1939),n.b)),{type:void 0})),this.running&&(this.running=!1,this.execute())}execute(){var t;return(0,rA.mG)(this,void 0,void 0,function*(){if(this.running)return this;this.running=!0;let e=this.layout.options,{onTick:n}=e,i=(0,rA._T)(e,["onTick"]),r={};Object.keys(i).forEach(t=>{(0,l0.Z)(i[t])||(r[t]=i[t])});let a={layout:{id:this.layout.id,options:r,iterations:null===(t=this.options)||void 0===t?void 0:t.iterations},nodes:this.graph.getAllNodes(),edges:this.graph.getAllEdges()},o=new Float32Array([0]),[s]=yield this.proxy.calculateLayout(a,[o]);return s})}stop(){return this.running=!1,this.proxy.stopLayout(),this}kill(){this.proxy[l1.Yy]()}isRunning(){return this.running}}var l3=n(10779);class l6{get presetOptions(){return{animation:!!tr(this.context.options,!0)}}get options(){let{options:t}=this.context;return t.layout}getLayoutInstance(){return this.instances}async layout(){if(!this.options)return;let t=Array.isArray(this.options)?this.options:[this.options],{graph:e}=this.context;for(let n of(lj(e,new lI(M.BEFORE_LAYOUT)),t)){let i=t.indexOf(n),r=this.getLayoutData(n),a={...this.presetOptions,...n};lj(e,new lI(M.BEFORE_STAGE_LAYOUT,{options:a,index:i}));let o=await this.stepLayout(r,a,i);lj(e,new lI(M.AFTER_STAGE_LAYOUT,{options:a,index:i})),n.animation||this.updateElementPosition(o,!1)}lj(e,new lI(M.AFTER_LAYOUT))}async simulate(){if(!this.options)return{};let t=Array.isArray(this.options)?this.options:[this.options],e={};for(let n of t){let i=t.indexOf(n),r=this.getLayoutData(n),a=await this.stepLayout(r,{...this.presetOptions,...n,animation:!1},i);e=a}return e}async stepLayout(t,e,n){return!function(t){let{type:e}=t;return["compact-box","mindmap","dendrogram","indented"].includes(e)}(e)?await this.graphLayout(t,e,n):await this.treeLayout(t,e,n)}async graphLayout(t,e,n){let{animation:i,enableWorker:r,iterations:a=300}=e,o=this.initGraphLayout(e);if(!o)return{};if(this.instances[n]=o,this.instance=o,r)return this.supervisor=new l2(o.graphData2LayoutModel(t),o.instance,{iterations:a}),ig(await this.supervisor.execute());if((0,l3.h)(o))return i?await o.execute(t,{onTick:t=>{this.updateElementPosition(t,!1)}}):(o.execute(t),o.stop(),o.tick(a));let s=await o.execute(t);return i&&this.updateElementPosition(s,i),s}async treeLayout(t,e,n){let{type:i,animation:r}=e,a=q("layout",i);if(!a)return{};let{nodes:o=[],edges:s=[]}=t,l=new id.k({nodes:o.map(t=>({id:tl(t),data:t.data||{}})),edges:s.map(t=>({id:tl(t),source:t.source,target:t.target,data:t.data||{}}))});!function(t){if(t.hasTreeStructure($))return;t.attachTreeStructure($);let e=t.getAllEdges();for(let n of e){let{source:e,target:i}=n;t.setParent(i,e,$)}}(l);let h={nodes:[],edges:[]},c={nodes:[],edges:[]},u=l.getRoots($);u.forEach(t=>{ei(t,t=>{t.children=l.getSuccessors(t.id)},t=>l.getSuccessors(t.id),"TB");let n=a(t,e),{x:i,y:r,z:o=0}=n;ei(n,t=>{let{id:e,x:n,y:a,z:s=0}=t;h.nodes.push({id:e,style:{x:i,y:r,z:o}}),c.nodes.push({id:e,style:{x:n,y:a,z:s}})},t=>t.children,"TB")});let d=this.inferTreeLayoutOffset(c);return l4(c,d),r&&(l4(h,d),this.updateElementPosition(h,!1),this.updateElementPosition(c,r)),c}inferTreeLayoutOffset(t){var e;let[n,i]=[1/0,-1/0],[r,a]=[1/0,-1/0];null===(e=t.nodes)||void 0===e||e.forEach(t=>{let{x:e=0,y:o=0}=t.style||{};n=Math.min(n,e),i=Math.max(i,e),r=Math.min(r,o),a=Math.max(a,o)});let{canvas:o}=this.context,s=o.getSize(),[l,h]=o.getCanvasByViewport([0,0]),[c,u]=o.getCanvasByViewport(s);return n>=l&&i<=c&&r>=h&&a<=u?[0,0]:[(l+c)/2-(n+i)/2,(h+u)/2-(r+a)/2]}stopLayout(){this.instance&&(0,l3.h)(this.instance)&&(this.instance.stop(),this.instance=void 0),this.supervisor&&(this.supervisor.stop(),this.supervisor=void 0),this.animationResult&&(this.animationResult.finish(),this.animationResult=void 0)}getLayoutData(t){let{nodeFilter:e=()=>!0}=t,{nodes:n,edges:i,combos:r}=this.context.model.getData(),a=t=>this.context.element.getElement(t),o=n.filter(t=>{let n=tl(t),i=a(n);return!(!i||ir(i))&&e(t)}),s=new Map(o.map(t=>[tl(t),t])),l=i.filter(t=>{let{source:e,target:n}=t;return!!(s.has(e)&&s.has(n))});return{nodes:o,edges:l,combos:r}}initGraphLayout(t){var e,n;let{element:i,viewport:r}=this.context,{type:a,enableWorker:o,animation:s,iterations:l,...h}=t,[c,u]=r.getCanvasSize(),d=[c/2,u/2],p=null!==(e=null==t?void 0:t.nodeSize)&&void 0!==e?e:t=>{let e=null==i?void 0:i.getElement(t.id),{size:n}=(null==e?void 0:e.attributes)||{};return Math.max(...em(n))},f=q("layout",a);if(!f)return J.warn("The layout of ".concat(a," is not registered."));let g=Object.getPrototypeOf(f.prototype)===ip.prototype?f:(n=this.context,class extends ip{async execute(t,e){return ig(await this.instance.execute(this.graphData2LayoutModel(t),this.transformOptions(ts({},this.options,e))))}transformOptions(t){let{onTick:e}=t;return e&&(t.onTick=t=>e(ig(t))),t}graphData2LayoutModel(t){let{nodes:e=[],edges:i=[],combos:r=[]}=t,a=e.map(t=>{let e=tl(t),{data:n,style:i,combo:r}=t,a={id:e,data:{...n,...r?{parentId:r}:{}},style:{...i}};return(null==i?void 0:i.x)&&Object.assign(a.data,{x:i.x}),(null==i?void 0:i.y)&&Object.assign(a.data,{y:i.y}),(null==i?void 0:i.z)&&Object.assign(a.data,{z:i.z}),a}),o=new Map(a.map(t=>[t.id,t])),s=i.filter(t=>{let{source:e,target:n}=t;return o.has(e)&&o.has(n)}).map(t=>{let{source:e,target:n,data:i,style:r}=t;return{id:tl(t),source:e,target:n,data:{...i},style:{...r}}}),l=r.map(t=>({id:tl(t),data:{_isCombo:!0,...t.data},style:{...t.style}})),h=new id.k({nodes:[...a,...l],edges:s});return n.model.model.hasTreeStructure(K)&&(h.attachTreeStructure(K),a.forEach(t=>{let e=n.model.model.getParent(t.id,K);e&&h.hasNode(e.id)&&h.setParent(t.id,e.id,K)})),h}constructor(t,e){if(super(t,e),this.instance=new f({}),this.id=this.instance.id,"stop"in this.instance&&"tick"in this.instance){let t=this.instance;this.stop=t.stop.bind(t),this.tick=e=>{let n=t.tick(e);return ig(n)}}}}),y=new g(this.context),m={nodeSize:p,width:c,height:u,center:d};switch(y.id){case"d3-force":case"d3-force-3d":Object.assign(m,{center:{x:c/2,y:u/2,z:0}})}return ts(y.options,m,h),y}updateElementPosition(t,e){let{model:n,element:i}=this.context;return i?(n.updateData(t),i.draw({animation:e,silence:!0})):null}destroy(){var t;this.stopLayout(),this.context={},null===(t=this.supervisor)||void 0===t||t.kill(),this.supervisor=void 0,this.instance=void 0,this.instances=[],this.animationResult=void 0}constructor(t){this.instances=[],this.context=t}}let l4=(t,e)=>{var n;let[i,r]=e;null===(n=t.nodes)||void 0===n||n.forEach(t=>{if(t.style){let{x:e=0,y:n=0}=t.style;t.style.x=e+i,t.style.y=n+r}else t.style={x:i,y:r}})};class l8 extends tm{setPlugins(t){this.setExtensions(t)}getPluginInstance(t){let e=this.extensionMap[t];if(e)return e;J.warn("Cannot find the plugin ".concat(t,", will try to find it by type."));let n=this.extensions.find(e=>e.type===t);if(n)return this.extensionMap[n.key]}constructor(t){super(t),this.category="plugin",this.setPlugins(this.context.options.plugins||[])}}let l9=["update-related-edges","collapse-expand-node","collapse-expand-combo","get-edge-actual-ends","arrange-draw-order"];class l5 extends tm{getTransforms(){}setTransforms(t){this.setExtensions([...l9.slice(0,l9.length-1),...t,l9[l9.length-1]])}getTransformInstance(t){return t?this.extensionMap[t]:this.extensionMap}constructor(t){super(t),this.category="transform",this.setTransforms(this.context.options.transforms||[])}}class l7{get padding(){return tS(this.context.options.padding)}get paddingOffset(){let[t,e,n,i]=this.padding,[r,a,o]=[(i-e)/2,(t-n)/2,0];return[r,a,o]}get camera(){let{canvas:t}=this.context;return new Proxy(t.getCamera(),{get:(e,n)=>{let i=Object.entries(t.getLayers()).filter(t=>{let[e]=t;return!["main"].includes(e)}),r=i.map(t=>{let[,e]=t;return e.getCamera()}),a=e[n];if("function"==typeof a)return function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];let s=a.apply(e,i);return r.forEach(t=>{t[n].apply(t,i)}),s}}})}createLandmark(t){return this.camera.createLandmark("landmark-".concat(this.landmarkCounter++),t)}getAnimation(t){let e=tr(this.context.options,t);return!!e&&nn({...e},["easing","duration"])}getCanvasSize(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e,n]}getCanvasCenter(){let{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e/2,n/2,0]}getViewportCenter(){let[t,e]=this.camera.getPosition();return[t,e,0]}getGraphCenter(){return this.context.graph.getViewportByCanvas(this.getCanvasCenter())}getZoom(){return this.camera.getZoom()}getRotation(){return this.camera.getRoll()}getTranslateOptions(t){let{camera:e}=this,{mode:n,translate:i=[]}=t,r=this.getZoom(),a=e.getPosition(),o=e.getFocalPoint(),[s,l]=this.getCanvasCenter(),[h=0,c=0,u=0]=i,d=tj([-h,-c,-u],r);return"relative"===n?{position:tB(a,d),focalPoint:tB(o,d)}:{position:tB([s,l,a[2]],d),focalPoint:tB([s,l,o[2]],d)}}getRotateOptions(t){let{mode:e,rotate:n=0}=t,i="relative"===e?this.camera.getRoll()+n:n;return{roll:i}}getZoomOptions(t){let{zoomRange:e}=this.context.options,n=this.camera.getZoom(),{mode:i,scale:r=1}=t;return iC("relative"===i?n*r:r,...e)}async transform(t,e){let{graph:n}=this.context,{translate:i,rotate:r,scale:a,origin:o}=t;this.cancelAnimation();let s=this.getAnimation(e);if(lj(n,new lF(M.BEFORE_TRANSFORM,t)),!r&&a&&!i&&o&&!s){this.camera.setZoomByViewportPoint(this.getZoomOptions(t),o),lj(n,new lF(M.AFTER_TRANSFORM,t));return}let l={};if(i&&Object.assign(l,this.getTranslateOptions(t)),ec(r)&&Object.assign(l,this.getRotateOptions(t)),ec(a)&&Object.assign(l,{zoom:this.getZoomOptions(t)}),s)return lj(n,new lB(M.BEFORE_ANIMATE,b.TRANSFORM,null,t)),new Promise(e=>{this.transformResolver=e,this.camera.gotoLandmark(this.createLandmark(l),{...s,onfinish:()=>{lj(n,new lB(M.AFTER_ANIMATE,b.TRANSFORM,null,t)),lj(n,new lF(M.AFTER_TRANSFORM,t)),this.transformResolver=void 0,e()}})});this.camera.gotoLandmark(this.createLandmark(l),{duration:0}),lj(n,new lF(M.AFTER_TRANSFORM,t))}async fitView(t,e){let[n,i,r,a]=this.padding,{when:o="always",direction:s="both"}=t||{},[l,h]=this.context.canvas.getSize(),c=l-a-i,u=h-n-r,d=this.context.canvas.getBounds(),p=this.getBBoxInViewport(d),[f,g]=tO(p);if("overflow"===o&&!("x"===s&&f>=c||"y"===s&&g>=u||"both"===s&&f>=c&&g>=u))return await this.fitCenter(e);let y=c/f,m=u/g,v="x"===s?y:"y"===s?m:Math.min(y,m),b=this.getAnimation(e);await this.transform({mode:"relative",scale:v,translate:tB(t_(this.getCanvasCenter(),this.getBBoxInViewport(d).center),tj(this.paddingOffset,v))},b)}async fitCenter(t){let e=this.context.canvas.getBounds();await this.focus(e,t)}async focusElements(t,e){let{element:n}=this.context;if(!n)return;let i=tk(t.map(t=>n.getElement(t).getRenderBounds()));await this.focus(i,e)}async focus(t,e){let n=this.context.graph.getViewportByCanvas(t.center),i=this.getCanvasCenter(),r=t_(i,n);await this.transform({mode:"relative",translate:tB(r,this.paddingOffset)},e)}getBBoxInViewport(t){let{min:e,max:n}=t,{graph:i}=this.context,[r,a]=i.getViewportByCanvas(e),[o,s]=i.getViewportByCanvas(n),l=new I.mN;return l.setMinMax([r,a,0],[o,s,0]),l}isInViewport(t){let{graph:e}=this.context,n=this.getCanvasSize(),[i,r]=e.getCanvasByViewport([0,0]),[a,o]=e.getCanvasByViewport(n),s=new I.mN;return s.setMinMax([i,r,0],[a,o,0]),tw(t)?tP(t,s):s.intersects(t)}cancelAnimation(){var t,e;(null===(t=this.camera.landmarks)||void 0===t?void 0:t.length)&&this.camera.cancelLandmarkAnimation(),null===(e=this.transformResolver)||void 0===e||e.call(this)}constructor(t){this.landmarkCounter=0,this.context=t;let[e,n]=this.paddingOffset,{zoom:i,rotation:r,x:a=e,y:o=n}=t.options;this.transform({mode:"absolute",scale:i,translate:[a,o],rotate:r},!1)}}class ht extends ry.Z{getOptions(){return this.options}setOptions(t){var e,n,i;let{behaviors:r,combo:a,data:o,edge:s,height:l,layout:h,node:c,plugins:u,theme:d,transforms:p,width:f,cursor:g,renderer:y}=t;if(y){let t=this.context.canvas;t&&(this.emit(M.BEFORE_RENDERER_CHANGE,{renderer:this.options.renderer}),t.setRenderer(y),this.emit(M.AFTER_RENDERER_CHANGE,{renderer:y}))}Object.assign(this.options,t),g&&(null===(e=this.context.canvas)||void 0===e||e.setCursor(g)),r&&this.setBehaviors(r),a&&this.setCombo(a),o&&this.setData(o),s&&this.setEdge(s),h&&this.setLayout(h),c&&this.setNode(c),d&&this.setTheme(d),u&&this.setPlugins(u),p&&this.setTransforms(p),(ec(f)||ec(l))&&this.setSize(null!==(n=null!=f?f:this.options.width)&&void 0!==n?n:0,null!==(i=null!=l?l:this.options.height)&&void 0!==i?i:0)}getSize(){return this.context.canvas?this.context.canvas.getSize():[this.options.width||0,this.options.height||0]}setSize(t,e){var n;Object.assign(this.options,{width:t,height:e}),null===(n=this.context.canvas)||void 0===n||n.resize(t,e)}setZoomRange(t){this.options.zoomRange=t}getZoomRange(){return this.options.zoomRange}setNode(t){this.options.node=t,this.context.model.refreshData()}setEdge(t){this.options.edge=t,this.context.model.refreshData()}setCombo(t){this.options.combo=t,this.context.model.refreshData()}getTheme(){return this.options.theme}setTheme(t){this.options.theme=tx(t)?t(this.getTheme()):t}setLayout(t){this.options.layout=tx(t)?t(this.getLayout()):t}getLayout(){return this.options.layout}setBehaviors(t){var e;this.options.behaviors=tx(t)?t(this.getBehaviors()):t,null===(e=this.context.behavior)||void 0===e||e.setBehaviors(this.options.behaviors)}updateBehavior(t){this.setBehaviors(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e))}getBehaviors(){return this.options.behaviors||[]}setPlugins(t){var e;this.options.plugins=tx(t)?t(this.getPlugins()):t,null===(e=this.context.plugin)||void 0===e||e.setPlugins(this.options.plugins)}updatePlugin(t){this.setPlugins(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e))}getPlugins(){return this.options.plugins||[]}getPluginInstance(t){return this.context.plugin.getPluginInstance(t)}setTransforms(t){var e;this.options.transforms=tx(t)?t(this.getTransforms()):t,null===(e=this.context.transform)||void 0===e||e.setTransforms(this.options.transforms)}updateTransform(t){this.setTransforms(e=>e.map(e=>"object"==typeof e&&e.key===t.key?{...e,...t}:e)),this.context.model.refreshData()}getTransforms(){return this.options.transforms||[]}getData(){return this.context.model.getData()}getElementData(t){return Array.isArray(t)?t.map(t=>this.context.model.getElementDataById(t)):this.context.model.getElementDataById(t)}getNodeData(t){var e;return void 0===t?this.context.model.getNodeData():Array.isArray(t)?this.context.model.getNodeData(t):null===(e=this.context.model.getNodeData([t]))||void 0===e?void 0:e[0]}getEdgeData(t){var e;return void 0===t?this.context.model.getEdgeData():Array.isArray(t)?this.context.model.getEdgeData(t):null===(e=this.context.model.getEdgeData([t]))||void 0===e?void 0:e[0]}getComboData(t){var e;return void 0===t?this.context.model.getComboData():Array.isArray(t)?this.context.model.getComboData(t):null===(e=this.context.model.getComboData([t]))||void 0===e?void 0:e[0]}setData(t){this.context.model.setData(tx(t)?t(this.getData()):t)}addData(t){this.context.model.addData(tx(t)?t(this.getData()):t)}addNodeData(t){this.context.model.addNodeData(tx(t)?t(this.getNodeData()):t)}addEdgeData(t){this.context.model.addEdgeData(tx(t)?t(this.getEdgeData()):t)}addComboData(t){this.context.model.addComboData(tx(t)?t(this.getComboData()):t)}addChildrenData(t,e){this.context.model.addChildrenData(t,e)}updateData(t){this.context.model.updateData(tx(t)?t(this.getData()):t)}updateNodeData(t){this.context.model.updateNodeData(tx(t)?t(this.getNodeData()):t)}updateEdgeData(t){this.context.model.updateEdgeData(tx(t)?t(this.getEdgeData()):t)}updateComboData(t){this.context.model.updateComboData(tx(t)?t(this.getComboData()):t)}removeData(t){this.context.model.removeData(tx(t)?t(this.getData()):t)}removeNodeData(t){this.context.model.removeNodeData(tx(t)?t(this.getNodeData()):t)}removeEdgeData(t){this.context.model.removeEdgeData(tx(t)?t(this.getEdgeData()):t)}removeComboData(t){this.context.model.removeComboData(tx(t)?t(this.getComboData()):t)}getElementType(t){return this.context.model.getElementType(t)}getRelatedEdgesData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return this.context.model.getRelatedEdgesData(t,e)}getNeighborNodesData(t){return this.context.model.getNeighborNodesData(t)}getAncestorsData(t,e){return this.context.model.getAncestorsData(t,e)}getParentData(t,e){return this.context.model.getParentData(t,e)}getChildrenData(t){return this.context.model.getChildrenData(t)}getElementDataByState(t,e){return this.context.model.getElementDataByState(t,e)}async initCanvas(){if(this.context.canvas)return await this.context.canvas.ready;let{container:t="container",width:e,height:n,renderer:i,cursor:r,background:a}=this.options;if(t instanceof lZ)this.context.canvas=t,r&&t.setCursor(r),await t.ready;else{let o=W(t)?document.getElementById(t):t,s=iH(o);this.emit(M.BEFORE_CANVAS_INIT,{container:o,width:e,height:n});let l=new lZ({container:o,width:e||s[0],height:n||s[1],background:a,renderer:i,cursor:r});this.context.canvas=l,await l.ready,this.emit(M.AFTER_CANVAS_INIT,{canvas:l})}}initRuntime(){this.context.options=this.options,this.context.batch||(this.context.batch=new lG(this.context)),this.context.plugin||(this.context.plugin=new l8(this.context)),this.context.viewport||(this.context.viewport=new l7(this.context)),this.context.transform||(this.context.transform=new l5(this.context)),this.context.element||(this.context.element=new lJ(this.context)),this.context.animation||(this.context.animation=new lz(this.context)),this.context.layout||(this.context.layout=new l6(this.context)),this.context.behavior||(this.context.behavior=new lH(this.context))}async prepare(){if(await Promise.resolve(),this.destroyed)throw Error(Q("The graph instance has been destroyed"));await this.initCanvas(),this.initRuntime()}async render(){await this.prepare(),lj(this,new lI(M.BEFORE_RENDER));let t=this.context.element.draw({type:"render"});await Promise.all([null==t?void 0:t.finished,this.context.layout.layout()]),await this.autoFit(),lj(this,new lI(M.AFTER_RENDER))}async draw(){var t;await this.prepare(),await (null===(t=this.context.element.draw())||void 0===t?void 0:t.finished)}async layout(){await this.context.layout.layout()}stopLayout(){this.context.layout.stopLayout()}async clear(){this.context.model.setData({}),await this.draw()}destroy(){lj(this,new lI(M.BEFORE_DESTROY));let{layout:t,animation:e,element:n,model:i,canvas:r,behavior:a,plugin:o}=this.context;null==o||o.destroy(),null==a||a.destroy(),null==t||t.destroy(),null==e||e.destroy(),null==n||n.destroy(),i.destroy(),null==r||r.destroy(),this.options={},this.context={},this.off(),window.removeEventListener("resize",this.onResize),this.destroyed=!0,lj(this,new lI(M.AFTER_DESTROY))}getCanvas(){return this.context.canvas}resize(t,e){let n=t&&e?[t,e]:iH(this.context.canvas.getContainer());V(n,this.getSize())||(lj(this,new lI(M.BEFORE_SIZE_CHANGE,{size:n})),this.context.canvas.resize(...n),lj(this,new lI(M.AFTER_SIZE_CHANGE,{size:n})))}async fitView(t,e){var n;await (null===(n=this.context.viewport)||void 0===n?void 0:n.fitView(t,e))}async fitCenter(t){var e;await (null===(e=this.context.viewport)||void 0===e?void 0:e.fitCenter(t))}async autoFit(){let{autoFit:t}=this.context.options;if(t){if(W(t))"view"===t?await this.fitView():"center"===t&&await this.fitCenter();else{let{type:e,animation:n}=t;"view"===e?await this.fitView(t.options,n):"center"===e&&await this.fitCenter(n)}}}async focusElement(t,e){var n;await (null===(n=this.context.viewport)||void 0===n?void 0:n.focusElements(Array.isArray(t)?t:[t],e))}async zoomBy(t,e,n){await this.context.viewport.transform({mode:"relative",scale:t,origin:n},e)}async zoomTo(t,e,n){this.context.viewport.transform({mode:"absolute",scale:t,origin:n},e)}getZoom(){return this.context.viewport.getZoom()}async rotateBy(t,e,n){await this.context.viewport.transform({mode:"relative",rotate:t,origin:n},e)}async rotateTo(t,e,n){await this.context.viewport.transform({mode:"absolute",rotate:t,origin:n},e)}getRotation(){return this.context.viewport.getRotation()}async translateBy(t,e){await this.context.viewport.transform({mode:"relative",translate:t},e)}async translateTo(t,e){await this.context.viewport.transform({mode:"absolute",translate:t},e)}getPosition(){return t_([0,0],this.getCanvasByViewport([0,0]))}async translateElementBy(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,a]=Z(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(r).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeBy(e,n)}),await (null===(n=this.context.element.draw({animation:a,stage:"translate"}))||void 0===n?void 0:n.finished)}async translateElementTo(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,a]=Z(t)?[t,null==e||e]:[{[t]:e},i];Object.entries(r).forEach(t=>{let[e,n]=t;return this.context.model.translateNodeLikeTo(e,n)}),await (null===(n=this.context.element.draw({animation:a,stage:"translate"}))||void 0===n?void 0:n.finished)}getElementPosition(t){return this.context.model.getElementPosition(t)}getElementRenderStyle(t){return iz(this.context.element.getElement(t).attributes,["context"])}async setElementVisibility(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,a]=Z(t)?[t,null==e||e]:[{[t]:e},i],o={nodes:[],edges:[],combos:[]};Object.entries(r).forEach(t=>{let[e,n]=t,i=this.getElementType(e);o["".concat(i,"s")].push({id:e,style:{visibility:n}})});let{model:s,element:l}=this.context;s.preventUpdateNodeLikeHierarchy(()=>{s.updateData(o)}),await (null===(n=l.draw({animation:a,stage:"visibility"}))||void 0===n?void 0:n.finished)}async showElement(t,e){let n=Array.isArray(t)?t:[t];await this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"visible"])),e)}async hideElement(t,e){let n=Array.isArray(t)?t:[t];await this.setElementVisibility(Object.fromEntries(n.map(t=>[t,"hidden"])),e)}getElementVisibility(t){var e,n;let i=this.context.element.getElement(t);return null!==(n=null==i?void 0:null===(e=i.style)||void 0===e?void 0:e.visibility)&&void 0!==n?n:"visible"}async setElementZIndex(t,e){var n;let i={nodes:[],edges:[],combos:[]},r=Z(t)?t:{[t]:e};Object.entries(r).forEach(t=>{let[e,n]=t,r=this.getElementType(e);i["".concat(r,"s")].push({id:e,style:{zIndex:n}})});let{model:a,element:o}=this.context;a.preventUpdateNodeLikeHierarchy(()=>a.updateData(i)),await (null===(n=o.draw({animation:!1,stage:"zIndex"}))||void 0===n?void 0:n.finished)}async frontElement(t){let e=Array.isArray(t)?t:[t],{model:n,element:i}=this.context,r={};e.map(t=>{let e=i.getFrontZIndex(t),a=n.getElementType(t);if("combo"===a){let a=n.getAncestorsData(t,K).at(-1)||this.getComboData(t),o=[a,...n.getDescendantsData(tl(a))],s=e-i.getElementZIndex(t);o.forEach(t=>{r[tl(t)]=this.getElementZIndex(tl(t))+s})}else r[t]=e}),await this.setElementZIndex(r)}getElementZIndex(t){var e,n,i;let{model:r,element:a}=this.context;return null!==(i=null===(e=r.getElementDataById(t))||void 0===e?void 0:null===(n=e.style)||void 0===n?void 0:n.zIndex)&&void 0!==i?i:a.getElementZIndex(t)}async setElementState(t,e){var n;let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[r,a]=Z(t)?[t,null==e||e]:[{[t]:e},i],o=t=>t?Array.isArray(t)?t:[t]:[],s={nodes:[],edges:[],combos:[]};Object.entries(r).forEach(t=>{let[e,n]=t,i=this.getElementType(e);s["".concat(i,"s")].push({id:e,states:o(n)})}),this.updateData(s),await (null===(n=this.context.element.draw({animation:a}))||void 0===n?void 0:n.finished)}getElementState(t){return this.context.model.getElementState(t)}getElementRenderBounds(t){return this.context.element.getElement(t).getRenderBounds()}async collapseElement(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(el(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;let r=n.getElementType(t);await this.frontElement(t),this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!0),"node"===r?await i.collapseNode(t,e):"combo"===r&&await i.collapseCombo(t,e),this.isCollapsingExpanding=!1}async expandElement(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{model:n,element:i}=this.context;if(!el(n.getNodeLikeData([t])[0])||this.isCollapsingExpanding)return;let r=n.getElementType(t);this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!1),"node"===r?await i.expandNode(t,e):"combo"===r&&await i.expandCombo(t,e),this.isCollapsingExpanding=!1}setElementCollapsibility(t,e){let n=this.getElementType(t);"node"===n?this.updateNodeData([{id:t,style:{collapsed:e}}]):"combo"===n&&this.updateComboData([{id:t,style:{collapsed:e}}])}async toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.context.canvas.toDataURL(t)}getCanvasByViewport(t){return this.context.canvas.getCanvasByViewport(t)}getViewportByCanvas(t){return this.context.canvas.getViewportByCanvas(t)}getClientByCanvas(t){return this.context.canvas.getClientByCanvas(t)}getCanvasByClient(t){return this.context.canvas.getCanvasByClient(t)}getViewportCenter(){return this.context.viewport.getViewportCenter()}getCanvasCenter(){return this.context.viewport.getCanvasCenter()}on(t,e,n){return super.on(t,e,n)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}constructor(t){super(),this.destroyed=!1,this.context={model:new lQ},this.isCollapsingExpanding=!1,this.onResize=ih(()=>{this.resize()},300),this.options=Object.assign({},ht.defaultOptions,t),this.setOptions(this.options),this.context.graph=this,this.options.autoResize&&window.addEventListener("resize",this.onResize)}}ht.defaultOptions={autoResize:!1,theme:"light",rotation:0,zoom:1,zoomRange:[.01,10]};let he=(t,e)=>{let{source:n,target:i}=e,r=t.getElementDataById(n),a=t.getElementDataById(i),o=nO(r,e=>t.getParentData(e,K)),s=nO(a,e=>t.getParentData(e,K)),l=tl(o),h=tl(s),c={sourceNode:l,targetNode:h};return e.style?Object.assign(e.style,c):e.style=c,e};var hn=function(t){return H(t,"Boolean")};let hi=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class hr extends lP{beforeDraw(t){let e=this.getAffectedParallelEdges(t);return 0===e.size||("bundle"===this.options.mode?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}constructor(t,e){super(t,Object.assign({},hr.defaultOptions,e)),this.cacheMergeStyle=new Map,this.getAffectedParallelEdges=t=>{let{add:{edges:e},update:{nodes:n,edges:i,combos:r},remove:{edges:a}}=t,{model:o}=this.context,s=new Map,l=(t,e)=>{let n=o.getRelatedEdgesData(e);n.forEach(t=>!s.has(tl(t))&&s.set(tl(t),t))};n.forEach(l),r.forEach(l);let h=t=>{let e=o.getEdgeData().map(t=>he(o,t)),n=ho(t,e,!0);n.forEach(t=>!s.has(tl(t))&&s.set(tl(t),t))};if(a.size&&a.forEach(h),e.size&&e.forEach(h),i.size){let t=rv(rm(o.getChanges())).update.edges;i.forEach(e=>{var n;h(e);let i=null===(n=t.find(t=>tl(t.value)===tl(e)))||void 0===n?void 0:n.original;i&&!hs(e,i)&&h(i)})}ej(this.options.edges)||s.forEach((t,e)=>!this.options.edges.includes(e)&&s.delete(e));let c=o.getEdgeData().map(tl);return new Map([...s].sort((t,e)=>c.indexOf(t[0])-c.indexOf(e[0])))},this.applyBundlingStyle=(t,e,n)=>{let{edgeMap:i,reverses:r}=ha(e);i.forEach(e=>{e.forEach((e,i,a)=>{var o;let s=Object.assign(e,{type:"quadratic",style:(()=>{let t=a.length,o={};if(e.source===e.target){let t=hi.length;o.loopPlacement=hi[i%t],o.loopDist=Math.floor(i/t)*n+50}else if(1===t)o.curveOffset=0;else{let a=(i%2==0?1:-1)*(r["".concat(e.source,"|").concat(e.target,"|").concat(i)]?-1:1);o.curveOffset=t%2==1?a*Math.ceil(i/2)*n*2:a*(Math.floor(i/2)*n*2+n)}return Object.assign({},e.style,o)})()}),l=null===(o=this.context.element)||void 0===o?void 0:o.getElement(tl(e));l?tu(t,"update","edge",s,!0):tu(t,"add","edge",s,!0)})})},this.resetEdgeStyle=t=>{let e=t.style||{},n=this.cacheMergeStyle.get(tl(t))||{};return Object.keys(n).forEach(i=>{V(e[i],n[i])&&(t[i]?e[i]=t[i]:delete e[i])}),Object.assign(t,{style:e})},this.applyMergingStyle=(t,e)=>{let{edgeMap:n,reverses:i}=ha(e);n.forEach(e=>{if(1===e.length){var n;let i=e[0],r=null===(n=this.context.element)||void 0===n?void 0:n.getElement(tl(i));tu(t,r?"update":"add","edge",this.resetEdgeStyle(i),!0);return}let r=e.map((t,e)=>{let{source:n,target:r,style:a={}}=t,{startArrow:o,endArrow:s}=a,l={},[h,c]=i["".concat(n,"|").concat(r,"|").concat(e)]?["endArrow","startArrow"]:["startArrow","endArrow"];return hn(o)&&(l[h]=o),hn(s)&&(l[c]=s),l}).reduce((t,e)=>({...t,...e}),{});e.forEach((e,n,i)=>{if(0===n){var a;let n=Object.assign({},tx(this.options.style)?this.options.style(i):this.options.style,{childrenData:i});this.cacheMergeStyle.set(tl(e),n);let o={...e,type:"line",style:{...r,...n}},s=null===(a=this.context.element)||void 0===a?void 0:a.getElement(tl(e));tu(t,s?"update":"add","edge",o,!0)}else tu(t,"remove","edge",e)})})}}}hr.defaultOptions={mode:"bundle",edges:void 0,distance:15};let ha=t=>{let e=new Map,n=new Set,i={};for(let[r,a]of t){if(n.has(r))continue;let{source:o,target:s}=a,l="".concat(o,"-").concat(s);for(let[h,c]of(e.has(l)||e.set(l,[]),e.get(l).push(a),n.add(r),t))!n.has(h)&&hs(a,c)&&(e.get(l).push(c),n.add(h),o===c.target&&s===c.source&&(i["".concat(c.source,"|").concat(c.target,"|").concat(e.get(l).length-1)]=!0))}return{edgeMap:e,reverses:i}},ho=(t,e,n)=>e.filter(e=>(n||tl(e)!==tl(t))&&hs(e,t)),hs=(t,e)=>{let{sourceNode:n,targetNode:i}=t.style||{},{sourceNode:r,targetNode:a}=e.style||{};return n===r&&i===a||n===a&&i===r},hl={animation:{"combo-collapse":tg,"combo-expand":tg,"node-collapse":tp,"node-expand":tp,"path-in":tf,"path-out":tf,fade:[{fields:["opacity"]}],translate:[{fields:["x","y"]}]},behavior:{"brush-select":et,"click-select":es,"collapse-expand":ia,"create-edge":il,"drag-canvas":ic,"drag-element-force":class extends iu{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find(t=>["d3-force","d3-force-3d"].includes(null==t?void 0:t.id))}validate(t){return!!this.context.layout&&(this.forceLayoutInstance?super.validate(t):(J.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1))}async moveElement(t,e){let n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach((i,r)=>{let{x:a=0,y:o=0}=i.style||{};n&&iy(n,"setFixedPosition",t[r],[...tB([+a,+o],e)])})}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);let e=this.forceLayoutInstance;e&&im(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach(t=>{let{x:n=0,y:i=0}=t.style||{};e&&iy(e,"setFixedPosition",tl(t),[+n,+i])})}onDrag(t){if(!this.enable)return;let e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){let t=this.forceLayoutInstance;t&&im(t,"simulation").alphaTarget(0),this.context.graph.getNodeData(this.target).forEach(e=>{t&&iy(t,"setFixedPosition",tl(e),[null,null,null])})}},"drag-element":iu,"fix-element-size":iv,"focus-element":ib,"hover-activate":ix,"lasso-select":class extends et{onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;let{canvas:e}=this.context;this.pathShape=new I.y$({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[ee(t)]}onPointerMove(t){var e;if(!this.points)return;let{immediately:n,mode:i}=this.options;this.points.push(ee(t)),null===(e=this.pathShape)||void 0===e||e.setAttribute("d",function(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=[];return t.forEach((t,e)=>{n.push([0===e?"M":"L",...t])}),e&&n.push(["Z"]),n}(this.points)),n&&"default"===i&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){if(this.points){if(this.points.length<2){this.clearLasso();return}super.updateElementsStates(this.points),this.clearLasso()}}clearLasso(){var t;null===(t=this.pathShape)||void 0===t||t.remove(),this.pathShape=void 0,this.points=void 0}},"optimize-viewport-transform":iE,"scroll-canvas":iw,"zoom-canvas":iS},combo:{circle:class extends ns{drawKeyShape(t,e){return this.upsert("key",I.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){let{collapsed:e}=t,n=super.getKeyStyle(t),[i]=this.getKeySize(t);return{...n,...e&&ef(n,"collapsed"),r:i/2}}getCollapsedKeySize(t){let[e,n]=em(t.collapsedSize),i=Math.max(e,n)/2;return[2*i,2*i,0]}getExpandedKeySize(t){let e=this.getContentBBox(t),[n,i]=tO(e),r=Math.sqrt(n**2+i**2)/2;return[2*r,2*r,0]}getIntersectPoint(t){let e=this.getShape("key").getBounds();return t6(t,e)}constructor(t){super(t)}},rect:class extends ns{drawKeyShape(t,e){return this.upsert("key",I.UL,this.getKeyStyle(t),e)}getKeyStyle(t){let e=super.getKeyStyle(t),[n,i]=this.getKeySize(t);return{...e,...t.collapsed&&ef(e,"collapsed"),width:n,height:i,x:-n/2,y:-i/2}}constructor(t){super(t)}}},edge:{cubic:n_,line:nz,polyline:nq,quadratic:nQ,"cubic-horizontal":nF,"cubic-vertical":nj},layout:{"antv-dagre":iR.b,"combo-combined":iA.u,"compact-box":iM.compactBox,"force-atlas2":iL.E,circular:iO.S,concentric:iT.W,"d3-force":ik.j,dagre:iP.V,dendrogram:iM.dendrogram,force:iD.y,fruchterman:iN.O,grid:iI.M,indented:iM.indented,mds:iB.A,mindmap:iM.mindmap,radial:i_.D,random:iF._},node:{circle:e2,diamond:class extends e3{getPoints(t){let[e,n]=this.getSize(t);return[[0,-n/2],[e/2,0],[0,n/2],[-e/2,0]]}constructor(t){super(t)}},ellipse:e7,hexagon:class extends e3{getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){var e;return[[0,e=this.getOuterR(t)],[e*Math.sqrt(3)/2,e/2],[e*Math.sqrt(3)/2,-e/2],[0,-e],[-e*Math.sqrt(3)/2,-e/2],[-e*Math.sqrt(3)/2,e/2]]}getIconStyle(t){let e=super.getIconStyle(t),n=.8*this.getOuterR(t);return!!e&&{width:n,height:n,...e}}constructor(t){super(t)}},html:nr,image:na,rect:class extends e1{getKeyStyle(t){let[e,n]=this.getSize(t);return{...super.getKeyStyle(t),width:e,height:n,x:-e/2,y:-n/2}}getIconStyle(t){let e=super.getIconStyle(t),{width:n,height:i}=this.getShape("key").attributes;return!!e&&{width:.8*n,height:.8*i,...e}}drawKeyShape(t,e){return this.upsert("key",I.UL,this.getKeyStyle(t),e)}constructor(t){super(t)}},star:class extends e3{getInnerR(t){return t.innerR||3*this.getOuterR(t)/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){var e,n;return[[0,-(e=this.getOuterR(t))],[(n=this.getInnerR(t))*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)],[e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[0,n],[-e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[-n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[-e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[-n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)]]}getIconStyle(t){let e=super.getIconStyle(t),n=2*this.getInnerR(t)*.8;return!!e&&{width:n,height:n,...e}}getPortXY(t,e){let{placement:n="top"}=e,i=this.getShape("key").getLocalBounds(),r=function(t,e){let n={};return n.top=[0,-t],n.left=[-t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n["left-bottom"]=[-t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.bottom=[0,e],n["right-bottom"]=[t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.right=n.default=[t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n}(this.getOuterR(t),this.getInnerR(t));return n3(i,n,r,!1)}constructor(t){super(t)}},donut:e6,triangle:no},palette:{spectral:["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],tableau:["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],oranges:["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],greens:["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],blues:["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"]},theme:{dark:lT,light:lk},plugin:{"bubble-sets":rl,"edge-filter-lens":rp,"grid-line":rg,background:iU,contextmenu:ru,fullscreen:rf,history:rb,hull:rO,legend:ak,minimap:ow,snapline:oR,timebar:lc,toolbar:lf,tooltip:lx,watermark:lS},transform:{"update-related-edges":class extends lP{beforeDraw(t,e){let{stage:n}=e;if("visibility"===n)return t;let{model:i}=this.context,{update:{nodes:r,edges:a,combos:o}}=t,s=(t,e)=>{let n=i.getRelatedEdgesData(e);n.forEach(t=>!a.has(tl(t))&&a.set(tl(t),t))};return r.forEach(s),o.forEach(s),t}},"arrange-draw-order":class extends lP{beforeDraw(t){let{model:e}=this.context,n=t.add.combos,i=t=>{let n=[];return t.forEach((t,i)=>{let r=e.getAncestorsData(i,"combo"),a=r.map(t=>tl(t)).reverse();n.push([i,t,a.length])}),new Map(n.sort((t,e)=>{let[,,n]=t,[,,i]=e;return i-n}).map(t=>{let[e,n]=t;return[e,n]}))};return t.add.combos=i(n),t.update.combos=i(t.update.combos),t}},"collapse-expand-combo":class extends lP{beforeDraw(t,e){if("visibility"===e.stage)return t;let{model:n}=this.context,{add:i,update:r}=t,a=[...t.update.combos.entries(),...t.add.combos.entries()];for(;a.length;){let[e,o]=a.pop();if(el(o)){let o=n.getDescendantsData(e),s=o.map(tl),{internal:l,external:h}=nR(s,t=>n.getRelatedEdgesData(t));o.forEach(e=>{let i=tl(e),r=a.findIndex(t=>{let[e]=t;return e===i});-1!==r&&a.splice(r,1);let o=n.getElementType(i);lL(t,"remove",o,e)}),l.forEach(e=>lL(t,"remove","edge",e)),h.forEach(t=>{var e;let n=tl(t),a=null===(e=this.context.element)||void 0===e?void 0:e.getElement(n);a?r.edges.set(n,t):i.edges.set(n,t)})}else{let i=n.getChildrenData(e),r=i.map(tl),{edges:o}=nR(r,t=>n.getRelatedEdgesData(t));[...i,...o].forEach(e=>{var i;let r=tl(e),o=n.getElementType(r),s=null===(i=this.context.element)||void 0===i?void 0:i.getElement(r);s?lL(t,"update",o,e):lL(t,"add",o,e),"combo"===o&&a.push([r,e])})}}return t}},"collapse-expand-node":class extends lP{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(lD(e,"add","node",t),el(t))return;let n=tl(t);lD(e,"add","node",t);let i=this.context.model.getRelatedEdgesData(n,"out");i.forEach(t=>{lL(e,"add","edge",t)});let r=this.context.model.getChildrenData(n);r.forEach(t=>{this.handleExpand(t,e)})}beforeDraw(t){let{graph:e,model:n}=this.context,{add:{nodes:i,edges:r},update:{nodes:a}}=t,o=new Map,s=new Map;i.forEach((t,e)=>{el(t)&&o.set(e,t)}),r.forEach(t=>{if("node"!==e.getElementType(t.source))return;let n=e.getNodeData(t.source);el(n)&&o.set(t.source,n)}),a.forEach((t,e)=>{let n=this.getElement(e);if(!n)return;let i=n.attributes.collapsed;el(t)?i||o.set(e,t):i&&s.set(e,t)});let l=new Set;return o.forEach((e,i)=>{let r=n.getDescendantsData(i);r.forEach(e=>{let i=tl(e);if(l.has(i))return;lL(t,"remove","node",e);let r=n.getRelatedEdgesData(i);r.forEach(e=>{lL(t,"remove","edge",e)}),l.add(i)})}),s.forEach((e,i)=>{let r=n.getAncestorsData(i,$);if(r.some(el)){lL(t,"remove","node",e);return}this.handleExpand(e,t)}),t}},"process-parallel-edges":hr,"get-edge-actual-ends":class extends lP{beforeDraw(t){let{add:e,update:n}=t,{model:i}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach(t=>{let[,e]=t;he(i,e)}),t}}},shape:{circle:I.Cd,ellipse:I.Pj,group:I.ZA,html:I.k9,image:eY,line:I.x1,path:I.y$,polygon:I.mg,polyline:I.aH,rect:I.UL,text:I.xv,label:eH,badge:eW}};I.GZ.enableCSSParsing=!1,Object.entries(hl).forEach(t=>{let[e,n]=t;Object.entries(n).forEach(t=>{let[n,i]=t;!function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=X[t][e];!i&&r?r!==n&&J.warn("The extension ".concat(e," of ").concat(t," has been registered before.")):Object.assign(X[t],{[e]:n})}(e,n,i)})})},99397:function(t,e,n){"use strict";n.d(e,{P3:function(){return u}});var i=n(67294),r=i.createContext({graph:null,isReady:!1}),a=n(58636),o=function(){return(o=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},s=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},l=function(){return(l=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},h=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)0>e.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n},c=(0,i.forwardRef)(function(t,e){var n,c,u,d,p,f,g,y,m,v,b=t.style,x=t.children,E=(c=(n=h(t,["style","children"])).onInit,u=n.onReady,d=n.onDestroy,p=n.options,g=(f=s((0,i.useState)(!1),2))[0],y=f[1],m=(0,i.useRef)(null),v=(0,i.useRef)(null),(0,i.useEffect)(function(){if(!m.current&&v.current){var t=new a.kJ(o({container:v.current},p));return m.current=t,y(!0),null==c||c(m.current),function(){var t=m.current;t&&(t.destroy(),null==d||d(),m.current=null)}}},[]),(0,i.useEffect)(function(){var t=v.current,e=m.current;p&&t&&e&&!e.destroyed&&(e.setOptions(p),e.render().then(function(){return null==u?void 0:u(e)}))},[p]),{graph:m.current,containerRef:v,isReady:g}),w=E.graph,C=E.containerRef,S=E.isReady;(0,i.useImperativeHandle)(e,function(){return w},[w]);var M=l({height:"inherit",position:"relative"},b);return x?i.createElement(r.Provider,{value:{graph:w,isReady:S}},i.createElement("div",{ref:C,style:M},S&&x)):i.createElement("div",{ref:C,style:M})}),u=(0,i.memo)(c)},54375:function(t,e,n){"use strict";n.d(e,{Ud:function(){return u},Yy:function(){return a}});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let i=Symbol("Comlink.proxy"),r=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=t=>"object"==typeof t&&null!==t||"function"==typeof t,h=new Map([["proxy",{canHandle:t=>l(t)&&t[i],serialize(t){let{port1:e,port2:n}=new MessageChannel;return function t(e,n=globalThis,r=["*"]){n.addEventListener("message",function a(l){let h;if(!l||!l.data)return;if(!function(t,e){for(let n of t)if(e===n||"*"===n||n instanceof RegExp&&n.test(e))return!0;return!1}(r,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}let{id:u,type:d,path:p}=Object.assign({path:[]},l.data),f=(l.data.argumentList||[]).map(b);try{var g;let n=p.slice(0,-1).reduce((t,e)=>t[e],e),r=p.reduce((t,e)=>t[e],e);switch(d){case"GET":h=r;break;case"SET":n[p.slice(-1)[0]]=b(l.data.value),h=!0;break;case"APPLY":h=r.apply(n,f);break;case"CONSTRUCT":{let t=new r(...f);h=Object.assign(t,{[i]:!0})}break;case"ENDPOINT":{let{port1:n,port2:i}=new MessageChannel;t(e,i),g=[n],m.set(n,g),h=n}break;case"RELEASE":h=void 0;break;default:return}}catch(t){h={value:t,[s]:0}}Promise.resolve(h).catch(t=>({value:t,[s]:0})).then(t=>{let[i,r]=v(t);n.postMessage(Object.assign(Object.assign({},i),{id:u}),r),"RELEASE"===d&&(n.removeEventListener("message",a),c(n),o in e&&"function"==typeof e[o]&&e[o]())}).catch(t=>{let[e,i]=v({value:TypeError("Unserializable return value"),[s]:0});n.postMessage(Object.assign(Object.assign({},e),{id:u}),i)})}),n.start&&n.start()}(t,e),[n,[n]]},deserialize:t=>(t.start(),u(t))}],["throw",{canHandle:t=>l(t)&&s in t,serialize:({value:t})=>[t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[]],deserialize(t){if(t.isError)throw Object.assign(Error(t.value.message),t.value);throw t.value}}]]);function c(t){"MessagePort"===t.constructor.name&&t.close()}function u(t,e){return function t(e,n=[],i=function(){}){let o=!1,s=new Proxy(i,{get(i,r){if(d(o),r===a)return()=>{g&&g.unregister(s),p(e),o=!0};if("then"===r){if(0===n.length)return{then:()=>s};let t=x(e,{type:"GET",path:n.map(t=>t.toString())}).then(b);return t.then.bind(t)}return t(e,[...n,r])},set(t,i,r){d(o);let[a,s]=v(r);return x(e,{type:"SET",path:[...n,i].map(t=>t.toString()),value:a},s).then(b)},apply(i,a,s){d(o);let l=n[n.length-1];if(l===r)return x(e,{type:"ENDPOINT"}).then(b);if("bind"===l)return t(e,n.slice(0,-1));let[h,c]=y(s);return x(e,{type:"APPLY",path:n.map(t=>t.toString()),argumentList:h},c).then(b)},construct(t,i){d(o);let[r,a]=y(i);return x(e,{type:"CONSTRUCT",path:n.map(t=>t.toString()),argumentList:r},a).then(b)}});return!function(t,e){let n=(f.get(e)||0)+1;f.set(e,n),g&&g.register(t,e,t)}(s,e),s}(t,[],e)}function d(t){if(t)throw Error("Proxy has been released and is not useable")}function p(t){return x(t,{type:"RELEASE"}).then(()=>{c(t)})}let f=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{let e=(f.get(t)||0)-1;f.set(t,e),0===e&&p(t)});function y(t){var e;let n=t.map(v);return[n.map(t=>t[0]),(e=n.map(t=>t[1]),Array.prototype.concat.apply([],e))]}let m=new WeakMap;function v(t){for(let[e,n]of h)if(n.canHandle(t)){let[i,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},r]}return[{type:"RAW",value:t},m.get(t)||[]]}function b(t){switch(t.type){case"HANDLER":return h.get(t.name).deserialize(t.value);case"RAW":return t.value}}function x(t,e,n){return new Promise(i=>{let r=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.addEventListener("message",function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),i(n.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)})}}}]);