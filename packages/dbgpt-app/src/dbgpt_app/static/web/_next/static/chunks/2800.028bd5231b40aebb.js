(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2800],{96991:function(e,l,t){"use strict";t.d(l,{Z:function(){return d}});var n=t(87462),a=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zM464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm0 400H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16z"}}]},name:"appstore",theme:"filled"},s=t(13401),d=a.forwardRef(function(e,l){return a.createElement(s.Z,(0,n.Z)({},e,{ref:l,icon:i}))})},36986:function(e,l,t){"use strict";t.d(l,{Z:function(){return d}});var n=t(87462),a=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144 144 64.5 144 144-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80 80-35.8 80-80-35.8-80-80-80z"}}]},name:"save",theme:"filled"},s=t(13401),d=a.forwardRef(function(e,l){return a.createElement(s.Z,(0,n.Z)({},e,{ref:l,icon:i}))})},49591:function(e,l,t){"use strict";t.d(l,{Z:function(){return d}});var n=t(87462),a=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h360c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H184V184h656v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V144c0-17.7-14.3-32-32-32zM653.3 599.4l52.2-52.2a8.01 8.01 0 00-4.7-13.6l-179.4-21c-5.1-.6-9.5 3.7-8.9 8.9l21 179.4c.8 6.6 8.9 9.4 13.6 4.7l52.4-52.4 256.2 256.2c3.1 3.1 8.2 3.1 11.3 0l42.4-42.4c3.1-3.1 3.1-8.2 0-11.3L653.3 599.4z"}}]},name:"select",theme:"outlined"},s=t(13401),d=a.forwardRef(function(e,l){return a.createElement(s.Z,(0,n.Z)({},e,{ref:l,icon:i}))})},88484:function(e,l,t){"use strict";t.d(l,{Z:function(){return d}});var n=t(87462),a=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=t(13401),d=a.forwardRef(function(e,l){return a.createElement(s.Z,(0,n.Z)({},e,{ref:l,icon:i}))})},96307:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return V}});var n=t(85893),a=t(30119),i=t(16165),s=t(65654),d=t(25278),o=t(39773),r=t(83062),c=t(34041),u=t(20863),v=t(14726),h=t(39332),m=t(67294),x=t(13768),f=t(34625),p=t(74434),g=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z"})})},w=function(){return(0,n.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,n.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z"})})},j=t(6171),y=t(18073),b=t(14313),_=t(36986),Z=t(93967),N=t.n(Z),C=t(91085);function k(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF"}),(0,n.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32"})]})}function S(){return(0,n.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:(0,n.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db"})})}function z(){return(0,n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,n.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93"}),(0,n.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,n.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93",fillOpacity:".5"}),(0,n.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}let{Search:H}=d.default;function M(e){let{layout:l="LR",editorValue:t,chartData:a,tableData:i,tables:s,handleChange:d}=e,r=(0,m.useMemo)(()=>a?(0,n.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,n.jsx)(x.ZP,{chartsData:[a]})}):null,[a]),{columns:c,dataSource:u}=(0,m.useMemo)(()=>{let{columns:e=[],values:l=[]}=null!=i?i:{},t=e.map(e=>({key:e,dataIndex:e,title:e})),n=l.map(l=>l.reduce((l,t,n)=>(l[e[n]]=t,l),{}));return{columns:t,dataSource:n}},[i]),v=(0,m.useMemo)(()=>{let e={},l=null==s?void 0:s.data,t=null==l?void 0:l.children;return null==t||t.forEach(l=>{e[l.title]=l.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==l?void 0:l.title)?[]:(null==t?void 0:t.map(e=>e.title))||[],getTableColumns:async l=>e[l]||[],getSchemaList:async()=>(null==l?void 0:l.title)?[null==l?void 0:l.title]:[]}},[s]);return(0,n.jsxs)("div",{className:N()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===l,"flex-row":"LR"===l}),children:[(0,n.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,n.jsx)(p.Z,{value:(null==t?void 0:t.sql)||"",language:"mysql",onChange:d,thoughts:(null==t?void 0:t.thoughts)||"",session:v})}),(0,n.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==i?void 0:i.values.length)?(0,n.jsx)(o.Z,{bordered:!0,scroll:{x:"auto"},rowKey:c[0].key,columns:c,dataSource:u}):(0,n.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,n.jsx)(C.Z,{})}),r]})]})}var V=function(){var e,l,t,d,o;let[x,p]=(0,m.useState)([]),[Z,C]=(0,m.useState)(""),[V,q]=(0,m.useState)(),[P,E]=(0,m.useState)(!0),[B,R]=(0,m.useState)(),[D,L]=(0,m.useState)(),[T,U]=(0,m.useState)(),[A,F]=(0,m.useState)(),[O,$]=(0,m.useState)(),[G,I]=(0,m.useState)(!1),[K,W]=(0,m.useState)("TB"),Y=(0,h.useSearchParams)(),J=null==Y?void 0:Y.get("id"),Q=null==Y?void 0:Y.get("scene"),{data:X}=(0,s.Z)(async()=>await (0,a.Tk)("/v1/editor/sql/rounds",{con_uid:J}),{onSuccess:e=>{var l,t;let n=null==e?void 0:null===(l=e.data)||void 0===l?void 0:l[(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.length)-1];n&&q(null==n?void 0:n.round)}}),{run:ee,loading:el}=(0,s.Z)(async()=>{var e,l;let t=null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/editor/sql/run",{db_name:t,sql:null==T?void 0:T.sql})},{manual:!0,onSuccess:e=>{var l,t;F({columns:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.colunms,values:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.values})}}),{run:et,loading:en}=(0,s.Z)(async()=>{var e,l;let t=null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name,n={db_name:t,sql:null==T?void 0:T.sql};return"chat_dashboard"===Q&&(n.chart_type=null==T?void 0:T.showcase),await (0,a.PR)("/api/v1/editor/chart/run",n)},{manual:!0,ready:!!(null==T?void 0:T.sql),onSuccess:e=>{if(null==e?void 0:e.success){var l,t,n,a,i,s,d;F({columns:(null==e?void 0:null===(l=e.data)||void 0===l?void 0:null===(t=l.sql_data)||void 0===t?void 0:t.colunms)||[],values:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(a=n.sql_data)||void 0===a?void 0:a.values)||[]}),(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values)?R({type:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.chart_type,values:null==e?void 0:null===(d=e.data)||void 0===d?void 0:d.chart_values,title:null==T?void 0:T.title,description:null==T?void 0:T.thoughts}):R(void 0)}}}),{run:ea,loading:ei}=(0,s.Z)(async()=>{var e,l,t,n,i;let s=null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/sql/editor/submit",{conv_uid:J,db_name:s,conv_round:V,old_sql:null==D?void 0:D.sql,old_speak:null==D?void 0:D.thoughts,new_sql:null==T?void 0:T.sql,new_speak:(null===(t=null==T?void 0:null===(n=T.thoughts)||void 0===n?void 0:n.match(/^\n--(.*)\n\n$/))||void 0===t?void 0:null===(i=t[1])||void 0===i?void 0:i.trim())||(null==T?void 0:T.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&ee()}}),{run:es,loading:ed}=(0,s.Z)(async()=>{var e,l,t,n,i,s;let d=null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name;return await (0,a.PR)("/api/v1/chart/editor/submit",{conv_uid:J,chart_title:null==T?void 0:T.title,db_name:d,old_sql:null==D?void 0:null===(t=D[null!=O?O:0])||void 0===t?void 0:t.sql,new_chart_type:null==T?void 0:T.showcase,new_sql:null==T?void 0:T.sql,new_comment:(null===(n=null==T?void 0:null===(i=T.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(s=n[1])||void 0===s?void 0:s.trim())||(null==T?void 0:T.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&et()}}),{data:eo}=(0,s.Z)(async()=>{var e,l;let t=null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name;return await (0,a.Tk)("/v1/editor/db/tables",{db_name:t,page_index:1,page_size:200})},{ready:!!(null===(e=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===V))||void 0===e?void 0:e.db_name),refreshDeps:[null===(t=null==X?void 0:null===(d=X.data)||void 0===d?void 0:d.find(e=>e.round===V))||void 0===t?void 0:t.db_name]}),{run:er}=(0,s.Z)(async e=>await (0,a.Tk)("/v1/editor/sql",{con_uid:J,round:e}),{manual:!0,onSuccess:e=>{let l;try{if(Array.isArray(null==e?void 0:e.data))l=null==e?void 0:e.data,$(0);else if("string"==typeof(null==e?void 0:e.data)){let t=JSON.parse(null==e?void 0:e.data);l=t}else l=null==e?void 0:e.data}catch(e){console.log(e)}finally{L(l),Array.isArray(l)?U(null==l?void 0:l[Number(O||0)]):U(l)}}}),ec=(0,m.useMemo)(()=>{let e=(l,t)=>l.map(l=>{let a=l.title,i=a.indexOf(Z),s=a.substring(0,i),d=a.slice(i+Z.length),o=e=>{switch(e){case"db":return(0,n.jsx)(k,{});case"table":return(0,n.jsx)(z,{});default:return(0,n.jsx)(S,{})}},c=i>-1?(0,n.jsx)(r.Z,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(l.type),"\xa0\xa0\xa0",s,(0,n.jsx)("span",{className:"text-[#1677ff]",children:Z}),d,"\xa0",(null==l?void 0:l.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==l?void 0:l.type})]})}):(0,n.jsx)(r.Z,{title:((null==l?void 0:l.comment)||(null==l?void 0:l.title))+((null==l?void 0:l.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,n.jsxs)("div",{className:"flex items-center",children:[o(l.type),"\xa0\xa0\xa0",a,"\xa0",(null==l?void 0:l.type)&&(0,n.jsx)("div",{className:"text-gray-400",children:null==l?void 0:l.type})]})});if(l.children){let n=t?String(t)+"_"+l.key:l.key;return{title:a,showTitle:c,key:n,children:e(l.children,n)}}return{title:a,showTitle:c,key:l.key}});return(null==eo?void 0:eo.data)?(p([null==eo?void 0:eo.data.key]),e([null==eo?void 0:eo.data])):[]},[Z,eo]),eu=(0,m.useMemo)(()=>{let e=[],l=(t,n)=>{if(t&&!((null==t?void 0:t.length)<=0))for(let a=0;a<t.length;a++){let i=t[a],{key:s,title:d}=i;e.push({key:s,title:d,parentKey:n}),i.children&&l(i.children,s)}};return ec&&l(ec),e},[ec]),ev=(e,l)=>{let t;for(let n=0;n<l.length;n++){let a=l[n];a.children&&(a.children.some(l=>l.key===e)?t=a.key:ev(e,a.children)&&(t=ev(e,a.children)))}return t};function eh(e){let l;if(!e)return{sql:"",thoughts:""};let t=e&&e.match(/(--.*)?\n?([\s\S]*)/),n="";return t&&t.length>=3&&(n=t[1],l=t[2]),{sql:l,thoughts:n}}return(0,m.useEffect)(()=>{V&&er(V)},[er,V]),(0,m.useEffect)(()=>{D&&"chat_dashboard"===Q&&O&&et()},[O,Q,D,et]),(0,m.useEffect)(()=>{D&&"chat_dashboard"!==Q&&ee()},[Q,D,ee]),(0,n.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,n.jsx)(f.Z,{}),(0,n.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,n.jsxs)("div",{className:"relative flex overflow-hidden mr-4",children:[(0,n.jsx)("div",{className:N()("h-full relative transition-[width] overflow-hidden",{"w-0":G,"w-64":!G}),children:(0,n.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,n.jsx)(c.default,{size:"middle",className:"w-full mb-2",value:V,options:null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{q(e)}}),(0,n.jsx)(H,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:l}=e.target;if(null==eo?void 0:eo.data){if(l){let e=eu.map(e=>e.title.indexOf(l)>-1?ev(e.key,ec):null).filter((e,l,t)=>e&&t.indexOf(e)===l);p(e)}else p([]);C(l),E(!0)}}}),ec&&ec.length>0&&(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)(u.Z,{onExpand:e=>{p(e),E(!1)},expandedKeys:x,autoExpandParent:P,treeData:ec,fieldNames:{title:"showTitle"}})})]})}),(0,n.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,n.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{I(!G)},children:G?(0,n.jsx)(y.Z,{}):(0,n.jsx)(j.Z,{})})})]}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,n.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,n.jsx)(b.Z,{}),loading:el||en,onClick:async()=>{"chat_dashboard"===Q?et():ee()},children:"Run"}),(0,n.jsx)(v.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:ei||ed,icon:(0,n.jsx)(_.Z,{}),onClick:async()=>{"chat_dashboard"===Q?await es():await ea()},children:"Save"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(i.Z,{className:N()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===K}),component:w,onClick:()=>{W("TB")}}),(0,n.jsx)(i.Z,{className:N()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===K}),component:g,onClick:()=>{W("LR")}})]})]}),Array.isArray(D)?(0,n.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:D.map((e,l)=>(0,n.jsx)(r.Z,{className:"inline-block",title:e.title,children:(0,n.jsx)("div",{className:N()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":O===l}),onClick:()=>{$(l),U(null==D?void 0:D[l])},children:e.title})},e.title))}),(0,n.jsx)("div",{className:"flex flex-1 overflow-hidden",children:D.map((e,l)=>(0,n.jsx)("div",{className:N()("w-full overflow-hidden",{hidden:l!==O,"block flex-1":l===O}),children:(0,n.jsx)(M,{layout:K,editorValue:e,handleChange:e=>{let{sql:l,thoughts:t}=eh(e);U(e=>Object.assign({},e,{sql:l,thoughts:t}))},tableData:A,chartData:B})},e.title))})]}):(0,n.jsx)(M,{layout:K,editorValue:D,handleChange:e=>{let{sql:l,thoughts:t}=eh(e);U(e=>Object.assign({},e,{sql:l,thoughts:t}))},tableData:A,chartData:void 0,tables:eo})]})]})]})}},34625:function(e,l,t){"use strict";t.d(l,{Z:function(){return M}});var n=t(85893),a=t(41468),i=t(81799),s=t(82353),d=t(16165),o=t(96991),r=t(78045),c=t(67294);function u(){let{isContract:e,setIsContract:l,scene:t}=(0,c.useContext)(a.p),i=t&&["chat_with_db_execute","chat_dashboard"].includes(t);return i?(0,n.jsxs)(r.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{l(!e)},children:[(0,n.jsxs)(r.ZP.Button,{value:!1,children:[(0,n.jsx)(d.Z,{component:s.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(r.ZP.Button,{value:!0,children:[(0,n.jsx)(o.Z,{className:"mr-1"}),"Editor"]})]}):null}t(23293);var v=t(76212),h=t(65654),m=t(34041),x=t(67421),f=function(){let{t:e}=(0,x.$G)(),{agent:l,setAgent:t}=(0,c.useContext)(a.p),{data:i=[]}=(0,h.Z)(async()=>{let[,e]=await (0,v.Vx)((0,v.H4)());return null!=e?e:[]});return(0,n.jsx)(m.default,{className:"w-60",value:l,placeholder:e("Select_Plugins"),options:i.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==t||t(e)}})},p=t(29158),g=t(57249),w=t(49591),j=t(88484),y=t(45360),b=t(83062),_=t(23799),Z=t(14726),N=function(e){var l;let{convUid:t,chatMode:i,onComplete:s,...d}=e,[o,r]=(0,c.useState)(!1),[u,h]=y.ZP.useMessage(),[m,x]=(0,c.useState)([]),[f,N]=(0,c.useState)(),{model:C}=(0,c.useContext)(a.p),{temperatureValue:k,maxNewTokensValue:S}=(0,c.useContext)(g.ChatContentContext),z=async e=>{var l;if(!e){y.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(l=e.file.name)&&void 0!==l?l:"")){y.ZP.error("File type must be csv, xlsx or xls");return}x([e.file])},H=async()=>{r(!0);try{let e=new FormData;e.append("doc_file",m[0]),u.open({content:"Uploading ".concat(m[0].name),type:"loading",duration:0});let[l]=await (0,v.Vx)((0,v.qn)({convUid:t,chatMode:i,data:e,model:C,temperatureValue:k,maxNewTokensValue:S,config:{timeout:36e5,onUploadProgress:e=>{let l=Math.ceil(e.loaded/(e.total||0)*100);N(l)}}}));if(l)return;y.ZP.success("success"),null==s||s()}catch(e){y.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{r(!1),u.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[h,(0,n.jsx)(b.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)(_.default,{disabled:o,className:"mr-1",beforeUpload:()=>!1,fileList:m,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:z,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...d,children:(0,n.jsx)(Z.ZP,{className:"flex justify-center items-center",type:"primary",disabled:o,icon:(0,n.jsx)(w.Z,{}),children:"Select File"})})}),(0,n.jsx)(Z.ZP,{type:"primary",loading:o,className:"flex justify-center items-center",disabled:!m.length,icon:(0,n.jsx)(j.Z,{}),onClick:H,children:o?100===f?"Analysis":"Uploading":"Upload"}),!!m.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>x([]),children:[(0,n.jsx)(p.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(l=m[0])||void 0===l?void 0:l.name})]})]})})},C=function(e){let{onComplete:l}=e,{currentDialogue:t,scene:i,chatId:s}=(0,c.useContext)(a.p);return"chat_excel"!==i?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:t?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(p.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:t.select_param})]}):(0,n.jsx)(N,{convUid:s,chatMode:i,onComplete:l})})},k=t(23430),S=t(62418),z=t(2093),H=function(){let{scene:e,dbParam:l,setDbParam:t}=(0,c.useContext)(a.p),[i,s]=(0,c.useState)([]);(0,z.Z)(async()=>{let[,l]=await (0,v.Vx)((0,v.vD)(e));s(null!=l?l:[])},[e]);let d=(0,c.useMemo)(()=>{var e;return null===(e=i.map)||void 0===e?void 0:e.call(i,e=>({name:e.param,...S.S$[e.type]}))},[i]);return((0,c.useEffect)(()=>{(null==d?void 0:d.length)&&!l&&t(d[0].name)},[d,t,l]),null==d?void 0:d.length)?(0,n.jsx)(m.default,{value:l,className:"w-36",onChange:e=>{t(e)},children:d.map(e=>(0,n.jsxs)(m.default.Option,{children:[(0,n.jsx)(k.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},M=function(e){let{refreshHistory:l,modelChange:t}=e,{scene:s,refreshDialogList:d}=(0,c.useContext)(a.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,n.jsx)(i.Z,{onChange:t}),(0,n.jsx)(H,{}),"chat_excel"===s&&(0,n.jsx)(C,{onComplete:()=>{null==d||d(),null==l||l()}}),"chat_agent"===s&&(0,n.jsx)(f,{}),(0,n.jsx)(u,{})]})}},81799:function(e,l,t){"use strict";t.d(l,{A:function(){return v}});var n=t(85893),a=t(41468),i=t(19284),s=t(34041),d=t(25675),o=t.n(d),r=t(67294),c=t(67421);let u="/models/huggingface.svg";function v(e,l){var t,a;let{width:s,height:d}=l||{};return e?(0,n.jsx)(o(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:d||24,src:(null===(t=i.Hf[e])||void 0===t?void 0:t.icon)||u,alt:"llm"},(null===(a=i.Hf[e])||void 0===a?void 0:a.icon)||u):null}l.Z=function(e){let{onChange:l}=e,{t}=(0,c.$G)(),{modelList:d,model:o}=(0,r.useContext)(a.p);return!d||d.length<=0?null:(0,n.jsx)(s.default,{value:o,placeholder:t("choose_model"),className:"w-52",onChange:e=>{null==l||l(e)},children:d.map(e=>{var l;return(0,n.jsx)(s.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[v(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(l=i.Hf[e])||void 0===l?void 0:l.label)||e})]})},e)})})}},91085:function(e,l,t){"use strict";var n=t(85893),a=t(32983),i=t(14726),s=t(93967),d=t.n(s),o=t(67421);l.Z=function(e){let{className:l,error:t,description:s,refresh:r}=e,{t:c}=(0,o.$G)();return(0,n.jsx)(a.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:d()("flex items-center justify-center flex-col h-full w-full",l),description:t?(0,n.jsx)(i.ZP,{type:"primary",onClick:r,children:c("try_again")}):null!=s?s:c("no_data")})}},23293:function(){},36459:function(e,l,t){"use strict";function n(e){if(null==e)throw TypeError("Cannot destructure "+e)}t.d(l,{Z:function(){return n}})}}]);