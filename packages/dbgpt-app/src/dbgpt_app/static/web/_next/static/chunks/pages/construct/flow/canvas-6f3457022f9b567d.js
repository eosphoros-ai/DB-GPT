(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1767],{94617:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/flow/canvas",function(){return l(66084)}])},45247:function(e,t,l){"use strict";var a=l(85893),n=l(50888);t.Z=function(e){let{visible:t}=e;return t?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(n.Z,{})}):null}},99743:function(e,t,l){"use strict";var a=l(85893);l(67294);var n=l(36851);t.Z=e=>{let{id:t,sourceX:l,sourceY:r,targetX:i,targetY:s,sourcePosition:o,targetPosition:d,style:c={},markerEnd:u}=e,[p,m,f]=(0,n.OQ)({sourceX:l,sourceY:r,sourcePosition:o,targetX:i,targetY:s,targetPosition:d}),v=(0,n._K)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.u5,{id:t,style:c,path:p,markerEnd:u}),(0,a.jsx)("foreignObject",{width:40,height:40,x:m-20,y:f-20,className:"bg-transparent w-10 h-10 relative",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,a.jsx)("button",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-stone-400 dark:bg-zinc-700 cursor-pointer text-sm",onClick:e=>{e.stopPropagation(),v.setEdges(v.getEdges().filter(e=>e.id!==t))},children:"\xd7"})})]})}},66084:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return e0}});var a=l(85893),n=l(76212),r=l(45247),i=l(41468),s=l(62418),o=l(14313),d=l(94155),c=l(25278),u=l(21612),p=l(40411),m=l(42075),f=l(72269),v=l(47221),x=l(93967),h=l.n(x),g=l(67294),j=l(67421),b=l(2487),y=l(7134),_=l(32983),w=e=>{let{nodes:t}=e,{t:l}=(0,j.$G)();return(null==t?void 0:t.length)>0?(0,a.jsx)(b.Z,{className:"overflow-hidden overflow-y-auto w-full",size:"small",itemLayout:"horizontal",dataSource:t,renderItem:e=>(0,a.jsx)(b.Z.Item,{className:"cursor-move hover:bg-[#F1F5F9] dark:hover:bg-theme-dark p-0 py-2",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow",JSON.stringify(e)),t.dataTransfer.effectAllowed="move"},children:(0,a.jsx)(b.Z.Item.Meta,{className:"flex items-center justify-center",avatar:(0,a.jsx)(y.C,{src:"/icons/node/vis.png",size:"large"}),title:(0,a.jsx)("p",{className:"line-clamp-1 font-medium",children:e.label}),description:(0,a.jsx)("p",{className:"line-clamp-2",children:e.description})})})}):(0,a.jsx)(_.Z,{className:"px-2",description:l("no_node")})};let{Search:N}=c.default,{Sider:Z}=u.default,k=JSON.stringify({order:"higher-order"}),C={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8};var P=()=>{let{t:e}=(0,j.$G)(),{mode:t}=(0,g.useContext)(i.p),[l,r]=(0,g.useState)(!1),[c,u]=(0,g.useState)(""),[x,b]=(0,g.useState)([]),[y,_]=(0,g.useState)([]),[P,I]=(0,g.useState)([]),[S,F]=(0,g.useState)([]),[E,O]=(0,g.useState)(!1);async function V(e){let[t,l]=await (0,n.Vx)((0,n.As)(e));if(l&&l.length>0){localStorage.setItem(s.zN,JSON.stringify(l));let e=l.filter(e=>"operator"===e.flow_type),t=l.filter(e=>"resource"===e.flow_type);b(e),_(t),I(D(e)),F(D(t))}}(0,g.useEffect)(()=>{V(k)},[]);let z=(0,g.useMemo)(()=>l?{...C,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...C,borderLeft:"1px solid #d6d8da"},[l]);function D(e){let t=[],l={};return e.forEach(e=>{let{category:a,category_label:n}=e;l[a]||(l[a]={category:a,categoryLabel:n,nodes:[]},t.push(l[a])),l[a].nodes.push(e)}),t}let A=(0,g.useMemo)(()=>{if(!c)return P.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(w,{nodes:n}),extra:(0,a.jsx)(p.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=x.filter(e=>e.label.toLowerCase().includes(c.toLowerCase()));return D(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(w,{nodes:n}),extra:(0,a.jsx)(p.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[P,c]),T=(0,g.useMemo)(()=>{if(!c)return S.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(w,{nodes:n}),extra:(0,a.jsx)(p.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=y.filter(e=>e.label.toLowerCase().includes(c.toLowerCase()));return D(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(w,{nodes:n}),extra:(0,a.jsx)(p.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[S,c]);return(0,a.jsx)(Z,{className:"flex justify-center items-start nodrag bg-[#ffffff80] border-r border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:t,width:280,collapsible:!0,collapsed:l,collapsedWidth:0,trigger:l?(0,a.jsx)(o.Z,{className:"text-base"}):(0,a.jsx)(d.Z,{className:"text-base"}),zeroWidthTriggerStyle:z,onCollapse:e=>r(e),children:(0,a.jsxs)(m.Z,{direction:"vertical",className:"w-[280px] pt-4 px-4 overflow-hidden overflow-y-auto scrollbar-default",children:[(0,a.jsxs)("div",{className:"flex justify-between align-middle",children:[(0,a.jsx)("p",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] line-clamp-1",children:e("add_node")}),(0,a.jsx)(f.Z,{checkedChildren:"高阶",unCheckedChildren:"全部",onClick:function(){E?V(k):V(),O(!E)},className:h()("w-20",{"bg-zinc-400":E}),defaultChecked:!0})]}),(0,a.jsx)(N,{placeholder:"Search node",onSearch:function(e){u(e)},allowClear:!0}),(0,a.jsx)("h2",{className:"font-semibold",children:e("operators")}),(0,a.jsx)(v.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:A}),(0,a.jsx)("h2",{className:"font-semibold",children:e("resource")}),(0,a.jsx)(v.Z,{size:"small",bordered:!1,className:"max-h-[calc((100vh-156px)/2)] overflow-hidden overflow-y-auto scrollbar-default",defaultActiveKey:[""],items:T})]})})},I=l(99743),S=l(67919),F=l(24969),E=l(3089),O=l(34041),V=l(99859),z=l(3303),D=l(13457),A=l(14726),T=l(85576),L=l(96486);let{Option:q}=O.default,M=["str","int","float","bool","ref"],R=e=>{let{flowInfo:t,setFlowInfo:l}=e,{t:r}=(0,j.$G)(),[i,s]=(0,g.useState)(!1),[o]=V.default.useForm(),[d,u]=(0,g.useState)(["str"]),[p,f]=(0,g.useState)([]);(0,g.useEffect)(()=>{v()},[]);let v=async()=>{let[e,t]=await (0,n.Vx)((0,n.RR)());if(e)return;let l=null==t?void 0:t.map(e=>{let{key:t,label:l,scope:a}=e;return{value:t,label:l,scope:a,isLeaf:!1}});f(l)},x=(e,t)=>{var l,a;let n=e.target.value,r=null===(l=null===(a=null==n?void 0:n.split("_"))||void 0===a?void 0:a.map(e=>e.charAt(0).toUpperCase()+e.slice(1)))||void 0===l?void 0:l.join(" ");o.setFields([{name:["parameters",t,"label"],value:r}])},h=(e,t)=>{let l=[...d];l[t]=e,u(l)},b=e=>{let t=e[e.length-1],{value:l,scope:a}=t;setTimeout(async()=>{let[e,r]=await (0,n.Vx)((0,n.gt)({key:l,scope:a}));if(e)return;if((null==r?void 0:r.total_count)===0){t.isLeaf=!0;return}let i=(0,L.uniqBy)(null==r?void 0:r.items,"name");t.children=null==i?void 0:i.map(e=>({value:null==e?void 0:e.name,label:e.label,item:e})),f([...p])},1e3)},y=(e,t,l)=>{var a,n,r;if((null==e?void 0:e.length)!==2)return;let[i,s]=t,d=null==i?void 0:null===(a=i.children)||void 0===a?void 0:a.find(e=>{let{value:t}=e;return t===(null==s?void 0:s.value)}),c=(0,S.Av)(null==d?void 0:d.item),u=o.getFieldValue("parameters"),p=null==u?void 0:u[l];p&&(p.value=c,p.category=null==d?void 0:null===(n=d.item)||void 0===n?void 0:n.category,p.value_type=null==d?void 0:null===(r=d.item)||void 0===r?void 0:r.value_type,o.setFieldsValue({parameters:[...u]}))},_=(e,t)=>{switch(e){case"ref":return(0,a.jsx)(z.Z,{placeholder:"Select Value",options:p,loadData:b,onChange:(e,l)=>y(e,l,t),changeOnSelect:!0});case"str":default:return(0,a.jsx)(c.default,{placeholder:"Parameter Value"});case"int":return(0,a.jsx)(D.Z,{step:1,placeholder:"Parameter Value",parser:e=>(null==e?void 0:e.replace(/[^\-?\d]/g,""))||0,style:{width:"100%"}});case"float":return(0,a.jsx)(D.Z,{placeholder:"Parameter Value",style:{width:"100%"}});case"bool":return(0,a.jsxs)(O.default,{placeholder:"Select Value",children:[(0,a.jsx)(q,{value:!0,children:"True"}),(0,a.jsx)(q,{value:!1,children:"False"})]})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A.ZP,{type:"primary",className:"flex items-center justify-center rounded-full left-4 top-4",style:{zIndex:1050},icon:(0,a.jsx)(F.Z,{}),onClick:()=>s(!0)}),(0,a.jsx)(T.default,{title:r("Add_Global_Variable_of_Flow"),width:1e3,open:i,styles:{body:{minHeight:"40vh",maxHeight:"65vh",overflow:"scroll",backgroundColor:"rgba(0,0,0,0.02)",padding:"0 8px",borderRadius:4}},onCancel:()=>s(!1),footer:[(0,a.jsx)(A.ZP,{onClick:()=>s(!1),children:r("cancel")},"cancel"),(0,a.jsx)(A.ZP,{type:"primary",onClick:()=>o.submit(),children:r("verify")},"submit")],children:(0,a.jsx)(V.default,{name:"dynamic_form_nest_item",onFinish:e=>{let a={...t,variables:(null==e?void 0:e.parameters)||[]};l(a),s(!1)},form:o,autoComplete:"off",layout:"vertical",className:"mt-8",initialValues:{parameters:(null==t?void 0:t.variables)||[{}]},children:(0,a.jsx)(V.default.List,{name:"parameters",children:(e,t)=>{let{add:l,remove:n}=t;return(0,a.jsxs)(a.Fragment,{children:[e.map((e,t)=>{let{key:l,name:r,...i}=e;return(0,a.jsxs)(m.Z,{className:"hover:bg-gray-100 pt-2 pl-2",children:[(0,a.jsx)(V.default.Item,{...i,name:[r,"name"],label:"参数 ".concat(t+1," 名称"),style:{width:140},rules:[{required:!0,message:"Missing parameter name"},{pattern:/^[a-zA-Z0-9]+(_[a-zA-Z0-9]+)*$/,message:"名称必须是字母、数字或下划线，并使用下划线分隔多个单词"}],children:(0,a.jsx)(c.default,{placeholder:"Parameter Name",onChange:e=>x(e,t)})}),(0,a.jsx)(V.default.Item,{...i,name:[r,"label"],label:"标题",style:{width:130},rules:[{required:!0,message:"Missing parameter label"}],children:(0,a.jsx)(c.default,{placeholder:"Parameter Label"})}),(0,a.jsx)(V.default.Item,{...i,name:[r,"value_type"],label:"类型",style:{width:100},rules:[{required:!0,message:"Missing parameter type"}],children:(0,a.jsx)(O.default,{placeholder:"Select",onChange:e=>h(e,t),children:M.map(e=>(0,a.jsx)(q,{value:e,children:e},e))})}),(0,a.jsx)(V.default.Item,{...i,name:[r,"value"],label:"值",style:{width:320},rules:[{required:!0,message:"Missing parameter value"}],children:_(d[t],t)}),(0,a.jsx)(V.default.Item,{...i,name:[r,"description"],label:"描述",style:{width:170},children:(0,a.jsx)(c.default,{placeholder:"Parameter Description"})}),(0,a.jsx)(E.Z,{onClick:()=>n(r)}),(0,a.jsx)(V.default.Item,{name:[r,"key"],hidden:!0,initialValue:"dbgpt.core.flow.params"}),(0,a.jsx)(V.default.Item,{name:[r,"scope"],hidden:!0,initialValue:"flow_priv"}),(0,a.jsx)(V.default.Item,{name:[r,"category"],hidden:!0,initialValue:"common"})]},l)}),(0,a.jsx)(V.default.Item,{children:(0,a.jsx)(A.ZP,{type:"dashed",onClick:()=>l(),block:!0,icon:(0,a.jsx)(F.Z,{}),children:r("Add_Parameter")})})]})}})})})]})};var G=l(45360),$=l(78045),J=l(83454);let B=e=>{let{reactFlow:t,flowInfo:l,isExportFlowModalOpen:n,setIsExportFlowModalOpen:r}=e,{t:i}=(0,j.$G)(),[s]=V.default.useForm(),[o,d]=G.ZP.useMessage(),u=async e=>{if("json"===e.format){let l=t.toObject(),a=new Blob([JSON.stringify(l)],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download=e.file_name||"flow.json",r.click()}else{var l;let t="".concat(null!==(l=J.env.API_BASE_URL)&&void 0!==l?l:"","/api/v2/serve/awel/flow/export/").concat(e.uid,"?export_type=").concat(e.export_type,"&format=").concat(e.format);window.open(t)}o.success(i("Export_Flow_Success")),r(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.default,{title:i("Export_Flow"),open:n,onCancel:()=>r(!1),footer:[(0,a.jsx)(A.ZP,{onClick:()=>r(!1),children:i("cancel")},"cancel"),(0,a.jsx)(A.ZP,{type:"primary",onClick:()=>s.submit(),children:i("verify")},"submit")],children:(0,a.jsxs)(V.default,{form:s,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:u,initialValues:{export_type:"json",format:"file",uid:null==l?void 0:l.uid},children:[(0,a.jsx)(V.default.Item,{label:i("Export_File_Type"),name:"export_type",children:(0,a.jsxs)($.ZP.Group,{children:[(0,a.jsx)($.ZP,{value:"json",children:"JSON"}),(0,a.jsx)($.ZP,{value:"dbgpts",children:"DBGPTS"})]})}),(0,a.jsx)(V.default.Item,{label:i("Export_File_Format"),name:"format",children:(0,a.jsxs)($.ZP.Group,{children:[(0,a.jsx)($.ZP,{value:"file",children:"File"}),(0,a.jsx)($.ZP,{value:"json",children:"JSON"})]})}),(0,a.jsx)(V.default.Item,{hidden:!0,name:"uid",children:(0,a.jsx)(c.default,{})})]})}),d]})};var H=l(39773);let U=e=>{let{isFlowTemplateModalOpen:t,setIsFlowTemplateModalOpen:l}=e,{t:r}=(0,j.$G)(),[i,s]=(0,g.useState)([]),o=e=>{(null==e?void 0:e.name)&&(localStorage.setItem("importFlowData",JSON.stringify(e)),e0(),l(!1))},d=[{title:r("Template_Name"),dataIndex:"name",key:"name",width:"30%"},{title:r("Template_Label"),dataIndex:"label",key:"label",width:"30%"},{title:r("Template_Description"),dataIndex:"description",key:"description",width:"30%"},{title:r("Template_Action"),key:"action",width:"10%",render:(e,t)=>(0,a.jsx)(m.Z,{size:"middle",children:(0,a.jsx)(A.ZP,{type:"link",onClick:()=>{o(t)},block:!0,children:r("Import_From_Template")})})}];return(0,g.useEffect)(()=>{(0,n.MJ)().then(e=>{var t,l;console.log(e),s(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(l=t.data)||void 0===l?void 0:l.items)})},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(T.default,{className:"w-[900px]",title:r("Import_From_Template"),open:t,onCancel:()=>l(!1),cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsx)(H.Z,{className:"w-full",dataSource:i,columns:d})})})};var W=l(88484),K=l(23799);let Y=e=>{let{isImportModalOpen:t,setIsImportFlowModalOpen:l}=e,{t:r}=(0,j.$G)(),[i]=V.default.useForm(),[s,o]=G.ZP.useMessage(),[d,c]=(0,g.useState)([]);(0,g.useEffect)(()=>{t&&(i.resetFields(),c([]))},[t,i]);let u=async e=>{var t;e.file=null===(t=e.file)||void 0===t?void 0:t[0];let a=new FormData;d.forEach(t=>{a.append("file",t),a.append("save_flow",e.save_flow)});let[,,i]=await (0,n.Vx)((0,n._Y)(a));(null==i?void 0:i.success)?(s.success(r("Import_Flow_Success")),localStorage.setItem("importFlowData",JSON.stringify(null==i?void 0:i.data)),e0()):(null==i?void 0:i.err_msg)&&s.error(null==i?void 0:i.err_msg),l(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.default,{title:r("Import_Flow"),open:t,onCancel:()=>l(!1),footer:[(0,a.jsx)(A.ZP,{onClick:()=>l(!1),children:r("cancel")},"cancel"),(0,a.jsx)(A.ZP,{type:"primary",onClick:()=>i.submit(),children:r("verify")},"submit")],children:(0,a.jsxs)(V.default,{form:i,className:"mt-6",labelCol:{span:6},wrapperCol:{span:16},onFinish:u,initialValues:{save_flow:!1},children:[(0,a.jsx)(V.default.Item,{name:"file",label:r("Select_File"),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0,message:"Please upload a file"}],children:(0,a.jsx)(K.default,{onRemove:e=>{let t=d.indexOf(e),l=d.slice();l.splice(t,1),c(l)},beforeUpload:e=>(c([...d,e]),!1),fileList:d,accept:".json,.zip",maxCount:1,children:(0,a.jsxs)(A.ZP,{icon:(0,a.jsx)(W.Z,{}),children:[" ",r("Upload")]})})}),(0,a.jsx)(V.default.Item,{name:"save_flow",label:r("Save_After_Import"),hidden:!0,children:(0,a.jsxs)($.ZP.Group,{children:[(0,a.jsx)($.ZP,{value:!0,children:r("Yes")}),(0,a.jsx)($.ZP,{value:!1,children:r("No")})]})})]})}),o]})};var X=l(84567),Q=l(11163);let{TextArea:ee}=c.default,et=e=>{let{reactFlow:t,isSaveFlowModalOpen:l,flowInfo:r,setIsSaveFlowModalOpen:i}=e,{t:s}=(0,j.$G)(),o=(0,Q.useRouter)(),[d]=V.default.useForm(),[u,p]=G.ZP.useMessage(),m=(null==r?void 0:r.state)==="deployed"||(null==r?void 0:r.state)==="running",[f,v]=(0,g.useState)(m),[x,h]=(0,g.useState)(o.query.id||"");async function b(){let{name:e,label:l,description:a="",editable:c=!1,state:p="deployed"}=d.getFieldsValue(),m=(0,S.Wf)(t.toObject());if(x){let[,,t]=await (0,n.Vx)((0,n.ao)(x.toString(),{name:e,label:l,description:a,editable:c,uid:x.toString(),flow_data:m,state:p,variables:null==r?void 0:r.variables}));(null==t?void 0:t.success)?u.success(s("save_flow_success")):(null==t?void 0:t.err_msg)&&u.error(null==t?void 0:t.err_msg)}else{let[t,i]=await (0,n.Vx)((0,n.zd)({name:e,label:l,description:a,editable:c,flow_data:m,state:p,variables:null==r?void 0:r.variables}));(null==i?void 0:i.uid)&&(u.success(s("save_flow_success")),o.push("/construct/flow/canvas?id=".concat(i.uid),void 0,{shallow:!0}))}i(!1)}return(0,g.useEffect)(()=>{v((null==r?void 0:r.state)==="deployed"||(null==r?void 0:r.state)==="running")},[null==r?void 0:r.state]),(0,g.useEffect)(()=>{h(o.query.id||"")},[o.query.id]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.default,{title:s("flow_modal_title"),open:l,onCancel:()=>i(!1),footer:[(0,a.jsx)(A.ZP,{onClick:()=>i(!1),children:s("cancel")},"cancel"),(0,a.jsx)(A.ZP,{type:"primary",onClick:()=>d.submit(),children:s("verify")},"submit")],children:(0,a.jsxs)(V.default,{name:"flow_form",form:d,labelCol:{span:6},wrapperCol:{span:16},className:"mt-6 max-w-2xl",initialValues:{remember:!0},onFinish:b,autoComplete:"off",children:[(0,a.jsx)(V.default.Item,{label:"Title",name:"label",initialValue:null==r?void 0:r.label,rules:[{required:!0,message:"Please input flow title!"}],children:(0,a.jsx)(c.default,{onChange:function(e){let t=e.target.value,l=t.replace(/\s+/g,"_").toLowerCase();d.setFieldsValue({name:l})}})}),(0,a.jsx)(V.default.Item,{label:"Name",name:"name",initialValue:null==r?void 0:r.name,rules:[{required:!0,message:"Please input flow name!"},()=>({validator:(e,t)=>/^[a-zA-Z0-9_\-]+$/.test(t)?Promise.resolve():Promise.reject("Can only contain numbers, letters, underscores, and dashes")})],children:(0,a.jsx)(c.default,{})}),(0,a.jsx)(V.default.Item,{label:"Description",initialValue:null==r?void 0:r.description,name:"description",children:(0,a.jsx)(ee,{rows:3})}),(0,a.jsx)(V.default.Item,{label:"Editable",name:"editable",initialValue:(null==r?void 0:r.editable)||!0,valuePropName:"checked",children:(0,a.jsx)(X.Z,{})}),(0,a.jsx)(V.default.Item,{hidden:!0,name:"state",children:(0,a.jsx)(c.default,{})}),(0,a.jsx)(V.default.Item,{label:"Deploy",children:(0,a.jsx)(X.Z,{checked:f,onChange:e=>{let t=e.target.checked;d.setFieldValue("state",t?"deployed":"developing"),v(t)}})})]})}),p]})};var el=l(57132),ea=l(48689),en=l(45605),er=l(55241),ei=l(83062),es=l(25675),eo=l.n(es),ed=l(36851),ec=e=>{let{children:t,className:l}=e;return(0,a.jsx)("div",{className:h()("flex justify-center items-center w-8 h-8 rounded-full dark:bg-zinc-700 hover:bg-stone-200 dark:hover:bg-zinc-900",l),children:t})},eu=l(45030),ep=l(86738),em=e=>{let{optional:t}=e;return t?null:(0,a.jsx)("span",{className:"text-red-600 align-middle inline-block",children:"\xa0*"})},ef=e=>{let{node:t,data:l,type:n,label:r,index:i}=e,{t:o}=(0,j.$G)(),d=(0,ed._K)(),[c,u]=g.useState([]),p=l.dynamic||!1,m=l.dynamic_minimum||0;function f(e){e.stopPropagation(),e.preventDefault();let a=localStorage.getItem(s.zN);if(!a)return;let n=JSON.parse(a),i=l.type_cls,o=[];"inputs"===r?o=n.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.outputs)||void 0===t?void 0:t.some(e=>e.type_cls===i&&e.is_list===(null==l?void 0:l.is_list))}):"parameters"===r?o=n.filter(e=>"resource"===e.flow_type).filter(e=>{var t;return null===(t=e.parent_cls)||void 0===t?void 0:t.includes(i)}):"outputs"===r&&("operator"===t.flow_type?o=n.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.inputs)||void 0===t?void 0:t.some(e=>e.type_cls===i&&e.is_list===(null==l?void 0:l.is_list))}):"resource"===t.flow_type&&(o=n.filter(e=>{var l,a;return(null===(l=e.inputs)||void 0===l?void 0:l.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))||(null===(a=e.parameters)||void 0===a?void 0:a.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))}))),u(o)}function v(e){e.stopPropagation(),e.preventDefault();let a=[...t[r]],s=a.filter(e=>e.type_cls===l.type_cls&&e.name.startsWith(l.name));if(console.log("Removing dynamic field at index ".concat(i,", total count: ").concat(s.length,", minimum: ").concat(m)),s.length<=m){console.log("Cannot remove: already at minimum (".concat(m,")")),G.ZP.warning(o("minimum_dynamic_fields_warning",{count:m}));return}let c=a.filter((e,t)=>t!==i);d.setNodes(e=>e.map(e=>e.id===t.id?{...e,data:{...e.data,[r]:c}}:e));let u="".concat(t.id,"|").concat(r,"|").concat(i);d.setEdges(e=>e.filter(e=>"source"===n&&e.sourceHandle!==u||"target"===n&&e.targetHandle!==u))}return(0,a.jsxs)("div",{className:h()("relative flex items-center",{"justify-start":"parameters"===r||"inputs"===r,"justify-end":"outputs"===r}),children:[(0,a.jsx)(ed.HH,{className:h()("w-2 h-2","source"===n?"-mr-4":"-ml-4"),type:n,position:"source"===n?ed.Ly.Right:ed.Ly.Left,id:"".concat(t.id,"|").concat(r,"|").concat(i),isValidConnection:e=>(function(e){var t,l;let{sourceHandle:a,targetHandle:n,source:r,target:i}=e,s=d.getNode(r),c=d.getNode(i),{flow_type:u}=null!==(t=null==s?void 0:s.data)&&void 0!==t?t:{},{flow_type:p}=null!==(l=null==c?void 0:c.data)&&void 0!==l?l:{},m=null==a?void 0:a.split("|")[1],f=null==n?void 0:n.split("|")[1],v=null==a?void 0:a.split("|")[2],x=null==n?void 0:n.split("|")[2],h=null==c?void 0:c.data[f][x].type_cls;if(u===p&&"operator"===u){let e=null==s?void 0:s.data[m][v].type_cls,t=null==s?void 0:s.data[m][v].is_list,l=null==c?void 0:c.data[f][x].is_list;return e===h&&t===l}if("resource"===u&&("operator"===p||"resource"===p)){let e=null==s?void 0:s.data.parent_cls;return e.includes(h)}return G.ZP.warning(o("connect_warning")),!1})(e)}),(0,a.jsxs)(eu.Z,{className:h()("bg-white dark:bg-[#232734] w-full px-2 py-1 rounded text-neutral-500",{"text-right":"outputs"===r}),children:[(0,a.jsx)(ep.Z,{placement:"left",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(w,{nodes:c})}),children:["inputs","parameters"].includes(r)&&(0,a.jsx)(F.Z,{className:"cursor-pointer mr-1",onClick:e=>{e.stopPropagation(),e.preventDefault(),f(e)}})}),["inputs","parameters"].includes(r)&&p&&i>=m&&(0,a.jsx)(E.Z,{className:"cursor-pointer text-red-500 mr-1",onClick:e=>{e.stopPropagation(),e.preventDefault(),v(e)}}),"outputs"!==r&&(0,a.jsx)(em,{optional:p?0===m:l.optional}),l.type_name,l.description&&(0,a.jsx)(ei.Z,{title:l.description,children:(0,a.jsx)(en.Z,{className:"ml-2 cursor-pointer"})}),(0,a.jsx)(ep.Z,{placement:"right",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:o("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(w,{nodes:c})}),children:["outputs"].includes(r)&&(0,a.jsx)(F.Z,{className:"ml-2 cursor-pointer",onClick:e=>{e.stopPropagation(),e.preventDefault(),f(e)}})}),["outputs"].includes(r)&&p&&i>=m&&(0,a.jsx)(E.Z,{className:"ml-2 cursor-pointer text-red-500",onClick:e=>{e.stopPropagation(),e.preventDefault(),v(e)}}),p&&(()=>{if(!p)return!1;let e=t[r],a=e.filter(e=>e.type_cls===l.type_cls&&e.name.startsWith(l.name));return i===e.indexOf(a[a.length-1])})()&&(0,a.jsx)(A.ZP,{type:"primary",size:"small",className:"ml-2",onClick:e=>{e.stopPropagation(),e.preventDefault(),function(e){console.log("addDynamicField clicked",e),e.stopPropagation(),e.preventDefault(),console.log("Adding dynamic field for node ".concat(t.id,", label=").concat(r,", current field name=").concat(l.name));let a=[...t[r]],n={...l},i=a.filter(e=>e.type_cls===l.type_cls&&e.name.startsWith(l.name)).length,s={...n,name:"".concat(l.name,"_").concat(i),value:null};a.push(s),d.setNodes(e=>e.map(e=>e.id===t.id?{...e,data:{...e.data,[r]:a}}:e))}(e)},style:{float:"outputs"===r?"left":"right"},children:"add"})]})]})};let ev=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(z.Z,{...l,options:e.options,placeholder:"please select",className:"w-full nodrag"})},ex=e=>{var t,l;let n=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(null===(l=e.options)||void 0===l?void 0:l.length)>0&&(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(X.Z.Group,{...n,options:e.options})})};var eh=l(63764);let eg=e=>{var t,l,n,r,i,s,o,d;let{t:c}=(0,j.$G)(),u=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{}),[p,m]=(0,g.useState)(!1),f=(0,g.useMemo)(()=>{var t,l,a,n;return(null==e?void 0:null===(t=e.ui)||void 0===t?void 0:null===(l=t.editor)||void 0===l?void 0:l.width)?(null==e?void 0:null===(a=e.ui)||void 0===a?void 0:null===(n=a.editor)||void 0===n?void 0:n.width)+100:"80%"},[null==e?void 0:null===(l=e.ui)||void 0===l?void 0:null===(n=l.editor)||void 0===n?void 0:n.width]);return(0,a.jsxs)("div",{className:"p-2 text-sm",children:[(0,a.jsx)(A.ZP,{type:"default",onClick:()=>{m(!0)},children:c("Open_Code_Editor")}),(0,a.jsx)(T.default,{title:c("Code_Editor"),width:f,open:p,onOk:()=>{m(!1)},onCancel:()=>{m(!1)},children:(0,a.jsx)(V.default.Item,{name:null==e?void 0:e.name,children:(0,a.jsx)(eh.ZP,{...u,width:(null==e?void 0:null===(r=e.ui)||void 0===r?void 0:null===(i=r.editor)||void 0===i?void 0:i.width)||"100%",height:(null==e?void 0:null===(s=e.ui)||void 0===s?void 0:null===(o=s.editor)||void 0===o?void 0:o.height)||200,defaultLanguage:null==e?void 0:null===(d=e.ui)||void 0===d?void 0:d.language,theme:"vs-dark",options:{minimap:{enabled:!1},wordWrap:"on"}})})})]})};var ej=l(64499);let eb=e=>{var t;let{data:l,formValuesChange:n}=e,r=(0,S.It)((null===(t=l.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(ej.default,{onChange:(e,t)=>{n({[l.name]:t})},...r,className:"w-full",placeholder:"please select a date"})};var ey=l(20588);let e_=e=>{let t=e.match(/^icon:(\w+)$/);if(t){let e=t[1],l=ey[e];return l?(0,a.jsx)(l,{}):null}return null},ew=e=>{var t,l,n;let r=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return r.prefix=e_((null===(l=e.ui)||void 0===l?void 0:null===(n=l.attr)||void 0===n?void 0:n.prefix)||""),(0,a.jsx)(c.default,{...r,className:"w-full",placeholder:"please input",allowClear:!0})},{Password:eN}=c.default,eZ=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eN,{...l,placeholder:"input password"})},ek=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)($.ZP.Group,{...l,options:e.options})})},eC=e=>{var t;let l=(0,S.It)((null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(O.default,{...l,className:"w-full nodrag",placeholder:"please select",options:e.options})};var eP=l(30568);let eI=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(a.Fragment,{children:e.is_list?(0,a.jsx)(eP.Z,{range:!0,className:"mt-8 nodrag",...l}):(0,a.jsx)(eP.Z,{className:"mt-8 nodrag",...l})})},{TextArea:eS}=c.default,eF=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eS,{className:"nowheel mb-3",...l})};var eE=l(68351);let eO=e=>{var t;let{data:l,formValuesChange:n}=e,r=(0,S.It)((null===(t=l.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eE.Z,{...r,onChange:(e,t)=>{n({time:t},{force:!0})},className:"w-full",placeholder:"please select a moment"})};var eV=l(59847);let ez=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eV.Z,{...l,className:"w-full nodrag",treeDefaultExpandAll:!0,treeData:e.options})};var eD=l(83454);let eA=e=>{var t,l,r,i,s;let{t:o}=(0,j.$G)(),d=(0,g.useRef)([]),{data:c,formValuesChange:u}=e,[p,m]=(0,g.useState)([]);(0,g.useEffect)(()=>{if(c.value){let e=[];"string"==typeof c.value?e.push(c.value):e=c.value;let t={uris:e};(0,n.Jx)(t).then(e=>{let t=[];for(let l=0;l<e.data.data.length;l++){let a=e.data.data[l];t.push({uid:a.file_id,name:a.file_name,status:"done",url:a.uri})}m(t)}).catch(e=>{console.log(e)})}},[]);let f=(0,S.It)((null===(t=c.ui)||void 0===t?void 0:t.attr)||{}),[v,x]=(0,g.useState)(!1),[h,b]=(0,g.useState)(""),y=e=>{d.current.length===c.ui.attr.max_count&&d.current.pop(),d.current.push(e),1===c.ui.attr.max_count?u({[c.name]:d.current.toString()}):u({[c.name]:d.current})},_={name:"files",action:null!==(i=eD.env.API_BASE_URL)&&void 0!==i?i:""+c.ui.action,headers:{authorization:"authorization-text"},defaultFileList:p,onChange(e){x(!0),"uploading"!==e.file.status&&x(!1),"done"===e.file.status?(x(!1),G.ZP.success("".concat(e.file.response.data[0].file_name," ").concat(o("Upload_Data_Successfully"))),y(e.file.response.data[0].uri)):"error"===e.file.status&&(x(!1),G.ZP.error("".concat(e.file.response.data[0].file_name,"  ").concat(o("Upload_Data_Failed"))))}};return!h&&(null===(l=c.ui)||void 0===l?void 0:l.file_types)&&Array.isArray(null===(r=c.ui)||void 0===r?void 0:r.file_types)&&b(null===(s=c.ui)||void 0===s?void 0:s.file_types.toString()),(0,a.jsx)("div",{className:"p-2 text-sm text-center",children:(0,a.jsx)(K.default,{onRemove:e=>{let t=d.current.indexOf(e.response.data[0].uri);-1!==t&&d.current.splice(t,1),x(!1),1===c.ui.attr.max_count?u({[c.name]:d.current.toString()}):u({[c.name]:d.current})},..._,...f,multiple:!!c.is_list,accept:h,children:(0,a.jsx)(A.ZP,{loading:v,icon:(0,a.jsx)(W.Z,{}),children:o("Upload_Data")})})})},eT=e=>{var t;let l=(0,S.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(c.default,{...l,className:"w-full",placeholder:"please input",allowClear:!0})};var eL=e=>{let{formValuesChange:t,node:l,paramData:n,label:r,index:i}=e;return"resource"===n.category?(0,a.jsx)(ef,{node:l,data:n,type:"target",label:r,index:i}):"common"===n.category?(null==n?void 0:n.ui)?function(e,t){var l;let{refresh_depends:n,ui_type:r}=e.ui,i=null!==(l=e.value)&&void 0!==l?l:e.default;return"slider"===r&&e.is_list&&(i=[0,1]),(0,a.jsx)(V.default.Item,{className:"mb-2",initialValue:i,name:e.name,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),...n&&{dependencies:n},...e.description&&{tooltip:{title:e.description,icon:(0,a.jsx)(en.Z,{})}},children:function(e,t,l){switch(e){case"select":return eC(t);case"cascader":return ev(t);case"checkbox":return ex(t);case"radio":return ek(t);case"input":return ew(t);case"text_area":return eF(t);case"slider":return eI(t);case"date_picker":return eb({data:t,formValuesChange:l});case"time_picker":return eO({data:t,formValuesChange:l});case"tree_select":return ez(t);case"password":return eZ(t);case"upload":return eA({data:t,formValuesChange:l});case"variables":return eT(t);case"code_editor":return eg(t);default:return null}}(r,e,t)})}(n,t):function(e){var t,l;let n=null!==(t=e.value)&&void 0!==t?t:e.default;switch(e.type_name){case"int":case"float":return(0,a.jsx)(V.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(en.Z,{})}:"",children:(0,a.jsx)(D.Z,{className:"w-full nodrag"})});case"str":return(0,a.jsx)(V.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(en.Z,{})}:"",children:(null===(l=e.options)||void 0===l?void 0:l.length)>0?(0,a.jsx)(O.default,{className:"w-full nodrag",options:e.options.map(e=>({label:e.label,value:e.value}))}):(0,a.jsx)(c.default,{className:"w-full"})});case"bool":return n="True"===(n="False"!==n&&n)||n,(0,a.jsx)(V.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(en.Z,{})}:"",children:(0,a.jsx)(X.Z,{className:"ml-2"})})}}(n):void 0};function eq(e){let{label:t}=e;return(0,a.jsx)("div",{className:"w-full h-8 align-middle font-semibold",children:t})}var eM=l(12906),eR=l(43008),eG=l(57546),e$=l(60219),eJ=l(58638),eB=l(26855),eH=l(96074),eU=l(39332),eW=l(24885),eK=l(59819);l(4583);let eY={customNode:e=>{var t,l,r,i;let{data:s}=e,{inputs:o,outputs:d,parameters:c,flow_type:u}=s,[p,m]=(0,g.useState)(!1),f=(0,ed._K)(),[v]=V.default.useForm();async function x(e,t){let l=c.filter(t=>{var l;let{ui:a}=t;return null==a?void 0:null===(l=a.refresh_depends)||void 0===l?void 0:l.includes(e)});(null==l?void 0:l.length)!==0&&l.forEach(async l=>{let a={id:(0,S._g)(null==s?void 0:s.id),type_name:s.type_name,type_cls:s.type_cls,flow_type:"operator",refresh:[{name:l.name,depends:[{name:e,value:t,has_value:!0}]}]},[r,i]=await (0,n.Vx)((0,n.ks)(a));i&&f.setNodes(e=>e.map(e=>e.id===s.id?{...e,data:{...e.data,parameters:i.parameters}}:e))})}function j(e){let[t,l]=Object.entries(e)[0];c.forEach(e=>{e.name===t&&(e.value=l)}),l&&x(t,l)}return(0,a.jsx)(er.Z,{placement:"rightTop",trigger:["hover"],content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec,{className:"hover:text-blue-500",children:(0,a.jsx)(el.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation();let t=f.getNodes(),l=t.find(e=>e.id===s.id);if(l){let e=(0,S.VZ)(l,t),a=(0,L.cloneDeep)(l),n={...a,id:e,position:{x:a.position.x+400,y:a.position.y},positionAbsolute:{x:a.positionAbsolute.x+400,y:a.positionAbsolute.y},data:{...a.data,id:e},selected:!1};f.setNodes(e=>[...e,n])}}})}),(0,a.jsx)(ec,{className:"mt-2 hover:text-red-500",children:(0,a.jsx)(ea.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation(),f.setNodes(e=>e.filter(e=>e.id!==s.id)),f.setEdges(e=>e.filter(e=>e.source!==s.id&&e.target!==s.id))}})}),(0,a.jsx)(ec,{className:"mt-2",children:(0,a.jsx)(ei.Z,{title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-bold",children:s.label}),(0,a.jsx)("p",{children:s.description})]}),placement:"right",children:(0,a.jsx)(en.Z,{className:"h-full text-lg cursor-pointer"})})})]}),children:(0,a.jsxs)("div",{className:h()("h-auto rounded-xl shadow-md px-2 py-4 border bg-white dark:bg-zinc-800 cursor-grab flex flex-col space-y-2 text-sm",{"w-80":(null==s?void 0:null===(t=s.tags)||void 0===t?void 0:t.ui_size)==="middle"||!(null==s?void 0:null===(l=s.tags)||void 0===l?void 0:l.ui_size),"w-[256px]":(null==s?void 0:null===(r=s.tags)||void 0===r?void 0:r.ui_size)==="small","w-[530px]":(null==s?void 0:null===(i=s.tags)||void 0===i?void 0:i.ui_size)==="large","border-blue-500":s.selected||p,"border-stone-400 dark:border-white":!s.selected&&!p,"border-dashed":"operator"!==u,"border-red-600":s.invalid}),onMouseEnter:function(){m(!0)},onMouseLeave:function(){m(!1)},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)(eo(),{src:"/icons/node/vis.png",width:24,height:24,alt:""}),(0,a.jsx)("p",{className:"ml-2 text-lg font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:s.label})]}),(null==o?void 0:o.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eq,{label:"Inputs"}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:null==o?void 0:o.map((e,t)=>(0,a.jsx)(ef,{node:s,data:e,type:"target",label:"inputs",index:t},"".concat(s.id,"_input_").concat(t)))})]}),(null==c?void 0:c.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eq,{label:"Parameters"}),(0,a.jsx)(V.default,{form:v,layout:"vertical",onValuesChange:j,className:"flex flex-col space-y-3 text-neutral-500",children:null==c?void 0:c.map((e,t)=>(0,a.jsx)(eL,{formValuesChange:j,node:s,paramData:e,label:"parameters",index:t},"".concat(s.id,"_param_").concat(t)))})]}),"operator"===u&&(null==d?void 0:d.length)>0?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eq,{label:"Outputs"}),null==d?void 0:d.map((e,t)=>(0,a.jsx)(ef,{node:s,data:e,type:"source",label:"outputs",index:t},"".concat(s.id,"_output_").concat(t)))]}):"resource"===u?(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eq,{label:"Outputs"}),(0,a.jsx)(ef,{node:s,data:s,type:"source",label:"outputs",index:0},"".concat(s.id,"_input_0"))]}):null]})})}},eX={buttonedge:I.Z},eQ=()=>{let{t:e}=(0,j.$G)(),t=(0,eU.useSearchParams)(),l=(null==t?void 0:t.get("id"))||"",i=(0,ed._K)(),[s,o]=G.ZP.useMessage(),d=(0,g.useRef)(null),[c,u,p]=(0,ed.Rr)([]),[f,v,x]=(0,ed.ll)([]),[h,b]=(0,g.useState)(),[y,_]=(0,g.useState)(!1),[w,N]=(0,g.useState)(!1),[Z,k]=(0,g.useState)(!1),[C,I]=(0,g.useState)(!1),[F,E]=(0,g.useState)(!1);if(localStorage.getItem("importFlowData")){let e=JSON.parse(localStorage.getItem("importFlowData")||"");localStorage.removeItem("importFlowData"),_(!0);let t=(0,S.z5)(e.flow_data);b(e),u(t.nodes),v(t.edges),_(!1)}async function O(){_(!0);let[e,t]=await (0,n.Vx)((0,n._d)(l));if(t){let e=(0,S.z5)(t.flow_data);b(t),u(e.nodes),v(e.edges)}_(!1)}(0,g.useEffect)(()=>{l&&O()},[l]),(0,g.useEffect)(()=>{let e=e=>{e.returnValue=G.ZP};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let V=(0,g.useCallback)(e=>{var t,l;e.preventDefault();let a=d.current.getBoundingClientRect(),n=null===(t=null===(l=document.getElementsByClassName("ant-layout-sider"))||void 0===l?void 0:l[0])||void 0===t?void 0:t.offsetWidth,r=e.dataTransfer.getData("application/reactflow");if(!r||void 0===r)return;let s=JSON.parse(r),o=i.screenToFlowPosition({x:e.clientX-a.left+n,y:e.clientY-a.top}),c=(0,S.VZ)(s,i.getNodes());s.id=c;let p={id:c,position:o,type:"customNode",data:s};u(e=>e.concat(p).map(e=>(e.id===p.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},[i]),z=(0,g.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]);function D(){let t=i.toObject(),[l,n,r]=(0,S.Rv)(t);if(!n){s.open({type:"warning",content:e("Please_Add_Nodes_First")});return}if(!l&&r)return u(e=>e.map(e=>({...e,data:{...e.data,invalid:e.id===(null==n?void 0:n.id)}}))),eB.ZP.error({message:"Error",description:r,icon:(0,a.jsx)(eM.Z,{className:"text-red-600"})});N(!0)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(P,{}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)(m.Z,{className:"my-2 mx-4 flex flex-row justify-end",children:(()=>{let t=[{title:e("template"),icon:(0,a.jsx)(eR.Z,{className:"block text-xl",onClick:()=>E(!0)})},{title:e("Import"),icon:(0,a.jsx)(eG.Z,{className:"block text-xl",onClick:()=>I(!0)})},{title:e("save"),icon:(0,a.jsx)(e$.Z,{className:"block text-xl",onClick:D})}];return""!==l&&t.unshift({title:e("Export"),icon:(0,a.jsx)(eJ.Z,{className:"block text-xl",onClick:()=>k(!0)})}),t})().map(e=>{let{title:t,icon:l}=e;return(0,a.jsx)(ei.Z,{title:t,className:"w-8 h-8 rounded-md bg-stone-300 dark:bg-zinc-700 dark:text-zinc-200 hover:text-blue-500 dark:hover:text-zinc-100",children:l},t)})}),(0,a.jsx)(eH.Z,{className:"mt-0 mb-0"}),(0,a.jsx)("div",{className:"h-[calc(100vh-48px)] w-full",ref:d,children:(0,a.jsxs)(ed.x$,{nodes:c,edges:f,nodeTypes:eY,edgeTypes:eX,onNodesChange:p,onEdgesChange:x,onNodeClick:function(e,t){i.setNodes(e=>e.map(e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},onConnect:function(e){let t={...e,type:"buttonedge",id:"".concat(e.source,"|").concat(e.target)};v(e=>(0,ed.Z_)(t,e))},onDrop:V,onDragOver:z,minZoom:.1,fitView:!0,deleteKeyCode:["Backspace","Delete"],children:[(0,a.jsx)(eW.Z,{className:"flex flex-row items-center",position:"bottom-center"}),(0,a.jsx)(eK.A,{color:"#aaa",gap:16}),(0,a.jsx)(R,{flowInfo:h,setFlowInfo:b})]})})]})]}),(0,a.jsx)(r.Z,{visible:y}),(0,a.jsx)(et,{reactFlow:i,flowInfo:h,isSaveFlowModalOpen:w,setIsSaveFlowModalOpen:N}),(0,a.jsx)(B,{reactFlow:i,flowInfo:h,isExportFlowModalOpen:Z,setIsExportFlowModalOpen:k}),(0,a.jsx)(Y,{setNodes:u,setEdges:v,isImportModalOpen:C,setIsImportFlowModalOpen:I}),(0,a.jsx)(U,{isFlowTemplateModalOpen:F,setIsFlowTemplateModalOpen:E}),o]})};function e0(){return(0,a.jsx)(ed.tV,{children:(0,a.jsx)(eQ,{})})}},67919:function(e,t,l){"use strict";l.d(t,{Av:function(){return p},It:function(){return u},Rv:function(){return c},VZ:function(){return a},Wf:function(){return r},_g:function(){return n},z5:function(){return i}});let a=(e,t)=>{let l=0;return t.forEach(t=>{t.data.name===e.name&&l++}),"".concat(e.id,"_").concat(l)},n=e=>e.replace(/_\d+$/,""),r=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{positionAbsolute:t,...l}=e;return{position_absolute:t,...l}}),r=l.map(e=>{let{sourceHandle:t,targetHandle:l,...a}=e;return{source_handle:t,target_handle:l,...a}});return{nodes:n,edges:r,...a}},i=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{position_absolute:t,...l}=e;return{positionAbsolute:t,...l}}),r=l.map(e=>{let{source_handle:t,target_handle:l,...a}=e;return{sourceHandle:t,targetHandle:l,...a}});return{nodes:n,edges:r,...a}},s=(e,t,l,a,n)=>{let r="".concat(e,"|").concat(t,"|"),i=a.filter(e=>{let l="inputs"===t?e.targetHandle:e.sourceHandle;return!!l&&l.startsWith(r)}).length;return i>=n},o=e=>{let t={};return e.forEach(e=>{if(e.dynamic){let l=e.name.replace(/_\d+$/,"");t[l]||(t[l]=[]),t[l].push(e)}}),t},d=e=>{if(!e.data.parameters||0===e.data.parameters.length)return[!0,""];let t=o(e.data.parameters);for(let[l,a]of Object.entries(t)){let t=a[0].dynamic_minimum||0;if(0===t)continue;if(a.length<t)return[!1,"The dynamic parameter ".concat(l," of node ").concat(e.data.label," requires at least ").concat(t," parameters")];let n=a.filter(e=>!e.optional);for(let t of n)if(void 0===t.value||null===t.value)return[!1,"The parameter ".concat(t.name," of node ").concat(e.data.label," is required")]}return[!0,""]},c=e=>{let{nodes:t,edges:l}=e,a=[!0,t[0],""];e:for(let e=0;e<t.length;e++){let n=t[e].data,{inputs:r=[],parameters:i=[]}=n,c=o(r);for(let[r,i]of Object.entries(c)){let o=i[0].dynamic_minimum||0;if(o>0){let i=s(t[e].id,"inputs",0,l,o);if(!i){a=[!1,t[e],"The dynamic input ".concat(r," of node ").concat(n.label," requires at least ").concat(o," connections")];break e}}}for(let i=0;i<r.length;i++){let s=r[i];if(s.dynamic)continue;let o=!s.optional;if(o&&!l.some(l=>l.targetHandle==="".concat(t[e].id,"|inputs|").concat(i))){a=[!1,t[e],"The input ".concat(r[i].type_name," of node ").concat(n.label," is required")];break e}}let[u,p]=d(t[e]);if(!u){a=[!1,t[e],p];break}let m=o(i);for(let[r,i]of Object.entries(m)){let o=i[0].dynamic_minimum||0;if(o>0&&"resource"===i[0].category){let i=s(t[e].id,"parameters",0,l,o);if(!i){a=[!1,t[e],"The dynamic parameter ".concat(r," of node ").concat(n.label," requires at least ").concat(o," connections")];break e}}}for(let r=0;r<i.length;r++){let s=i[r];if(!s.dynamic){if(s.optional||"resource"!==s.category||l.some(l=>l.targetHandle==="".concat(t[e].id,"|parameters|").concat(r))){if(!s.optional&&"common"===s.category&&(void 0===s.value||null===s.value)){a=[!1,t[e],"The parameter ".concat(s.type_name," of node ").concat(n.label," is required")];break e}}else{a=[!1,t[e],"The parameter ".concat(s.type_name," of node ").concat(n.label," is required")];break e}}}let f=o(n.outputs||[]);for(let[r,i]of Object.entries(f)){let o=i[0].dynamic_minimum||0;if(o>0){let i=s(t[e].id,"outputs",0,l,o);if(!i){a=[!1,t[e],"The dynamic output ".concat(r," of node ").concat(n.label," requires at least ").concat(o," connections")];break e}}}}return a},u=e=>(function e(t){if(Array.isArray(t))return t.map(t=>e(t));if(t&&"object"==typeof t&&!Array.isArray(t)){let l={};for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a)){let n=a.replace(/_([a-z])/g,(e,t)=>t.toUpperCase());l[n]=e(t[a])}return l}return t})(e);function p(e){let t=new Set(["@","#","%",":"]),l={key:e.key||"",name:e.name||"",scope:e.scope||"",scope_key:e.scope_key||"",sys_code:e.sys_code||"",user_name:e.user_name||""};for(let[e,a]of Object.entries(l))a&&[...t].some(e=>a.includes(e))&&(l[e]=a.replace(/@/g,"\\@").replace(/#/g,"\\#").replace(/%/g,"\\%").replace(/:/g,"\\:"));let{key:a,name:n,scope:r,scope_key:i,sys_code:s,user_name:o}=l,d="".concat(a);return n&&(d+="".concat(":").concat(n)),(r||i)&&(d+="".concat("@").concat(r),i&&(d+="".concat(":").concat(i))),s&&(d+="".concat("#").concat(s)),o&&(d+="".concat("%").concat(o)),"${".concat(d,"}")}}},function(e){e.O(0,[3662,8241,2913,3791,5278,8791,4330,7611,1049,5030,3457,2622,5914,4567,7124,9859,1300,4633,9773,3764,1278,3013,9046,9752,9774,2888,179],function(){return e(e.s=94617)}),_N_E=e.O()}]);