"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[952],{98198:function(e,a,l){l.d(a,{Z:function(){return m}});var t=l(85893),r=l(34041),s=l(25278),i=l(13457),n=l(84567),u=l(99859),d=l(67294),o=e=>{let{parentName:a,fields:l,form:o}=e,[c,m]=(0,d.useState)(null);(0,d.useEffect)(()=>{let e=o.getFieldValue(a);(null==e?void 0:e.type)&&!c&&m(e.type)},[o,a]);let p=e=>{let l;let d=e.param_type.toLowerCase(),o=[a,e.param_name];return l="str"===d||"string"===d?e.valid_values?(0,t.jsx)(r.default,{children:e.valid_values.map(e=>(0,t.jsx)(r.default.Option,{value:e,children:e},e))}):(0,t.jsx)(s.default,{}):"int"===d||"integer"===d||"number"===d||"float"===d?(0,t.jsx)(i.Z,{className:"w-full"}):"bool"===d||"boolean"===d?(0,t.jsx)(n.Z,{}):(0,t.jsx)(s.default,{}),(0,t.jsx)(u.default.Item,{label:e.label||e.param_name,name:o,valuePropName:"bool"===d||"boolean"===d?"checked":"value",tooltip:e.description,rules:c&&e.required?[{required:!0,message:"Please input ".concat(e.param_name)}]:[],children:l},e.param_name)};return(0,t.jsxs)("div",{className:"space-y-4 border rounded-md p-4",children:[(0,t.jsx)(u.default.Item,{label:"Type",name:[a,"type"],children:(0,t.jsx)(r.default,{onChange:e=>{m(e);let t=l[e]||[],r={type:e};t.forEach(e=>{r[e.param_name]=e.default_value}),o.setFieldsValue({[a]:r})},placeholder:"Select a type",children:Object.keys(l).map(e=>(0,t.jsx)(r.default.Option,{value:e,children:e},e))})}),c&&l[c]&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("h4",{className:"mb-4 text-base font-medium",children:[c," Configuration"]}),(0,t.jsx)("div",{className:"space-y-4",children:l[c].map(e=>p(e))})]})]})};let c=e=>!!Array.isArray(e)&&0!==e.length&&"object"==typeof e[0]&&null!==e[0]&&"key"in e[0]&&"label"in e[0];var m=function(e){let{params:a,form:l}=e;if((0,d.useEffect)(()=>{if(a){let e={};a.forEach(a=>{if(!a.nested_fields){let t=l.getFieldValue(a.param_name);void 0===t&&(e[a.param_name]=a.default_value)}}),l.setFieldsValue(e)}},[a,l]),!a||(null==a?void 0:a.length)<1)return null;let m=e=>{let l={...e};return null==a||a.forEach(e=>{if(e.nested_fields&&l[e.param_name]){let a=l[e.param_name];if(a.type){let t=e.nested_fields[a.type]||[],r={};t.forEach(e=>{void 0!==a[e.param_name]&&(r[e.param_name]=a[e.param_name])}),l[e.param_name]={type:a.type,...r}}}}),l},p=l.submit;return l.submit=()=>{let e=l.getFieldsValue(),a=m(e);l.setFieldsValue(a),p.call(l)},(0,t.jsx)("div",{className:"space-y-4",children:null==a?void 0:a.map(e=>(0,t.jsx)(u.default.Item,{label:(0,t.jsx)("p",{className:"whitespace-normal overflow-wrap-break-word",children:e.label||e.param_name}),name:e.param_name,initialValue:e.default_value,valuePropName:"bool"===e.param_type.toLowerCase()||"boolean"===e.param_type.toLowerCase()?"checked":"value",tooltip:e.description,rules:e.required?[{required:!0,message:"Please input ".concat(e.label||e.param_name)}]:[],children:function(e){var a,u,d,m;if(e.nested_fields)return(0,t.jsx)(o,{parentName:e.param_name,fields:e.nested_fields,form:l});let p=e.param_type.toLowerCase(),f=null===(a=e.ext_metadata)||void 0===a?void 0:null===(u=a.tags)||void 0===u?void 0:u.includes("fixed"),_=null===(d=e.ext_metadata)||void 0===d?void 0:null===(m=d.tags)||void 0===m?void 0:m.includes("privacy");return"str"===p||"string"===p?e.valid_values?c(e.valid_values)?(0,t.jsx)(r.default,{disabled:f,children:e.valid_values.map(e=>(0,t.jsx)(r.default.Option,{value:e.key,children:e.label},e.key))}):(0,t.jsx)(r.default,{disabled:f,children:e.valid_values.map(e=>(0,t.jsx)(r.default.Option,{value:e,children:e},e))}):_?(0,t.jsx)(s.default.Password,{disabled:f,autoComplete:"new-password",placeholder:"请输入密码"}):(0,t.jsx)(s.default,{disabled:f}):"int"===p||"integer"===p||"number"===p||"float"===p?(0,t.jsx)(i.Z,{className:"w-full",disabled:f}):"bool"===p||"boolean"===p?(0,t.jsx)(n.Z,{disabled:f}):(0,t.jsx)(s.default,{disabled:f})}(e)},e.param_name))})}},60952:function(e,a,l){l.r(a);var t=l(85893),r=l(76212),s=l(98198),i=l(99859),n=l(74330),u=l(34041),d=l(72269),o=l(93967),c=l.n(o),m=l(67294),p=l(67421);let f=e=>{if(!e)return{};if("string"==typeof e)try{let a=JSON.parse(e),l={};return Object.keys(a).forEach(e=>{let t=a[e];t&&"object"==typeof t&&null!==t&&"key"in t?l[e]=t.key:l[e]=t}),l}catch(e){return console.error("Failed to parse resource value:",e),{}}if("object"==typeof e){let a={};return Object.keys(e).forEach(l=>{let t=e[l];t&&"object"==typeof t&&null!==t&&"key"in t?a[l]=t.key:a[l]=t}),a}return{}};a.default=e=>{let{uid:a,initValue:l,updateData:o,classNames:_,resourceType:y,resourceTypeOptions:v,setCurIcon:h}=e,[b]=i.default.useForm(),j=i.default.useWatch("is_dynamic",b),x=i.default.useWatch("resource_type",b),{t:g}=(0,p.$G)(),[k,F]=(0,m.useState)(!1),[N,w]=(0,m.useState)(null),E=(0,m.useRef)(null),V=(0,m.useRef)(""),O=(0,m.useRef)(!1),C=v.filter(e=>"all"!==e.value),Z=e=>{e!==x&&(b.resetFields(["is_dynamic"]),h({uid:a,icon:e}),S(e),setTimeout(()=>{T(!0)},800))},S=async e=>{F(!0);try{let[a,l]=await (0,r.Vx)((0,r.i1)({type:e}));if(!a&&l){if(w(l),l.length>0){let a=b.getFieldValue("resource_type"),l=b.getFieldValue("is_dynamic");b.resetFields(),b.setFieldsValue({resource_type:a||e,is_dynamic:l||!1})}}else w(null),console.error("Failed to fetch resource params:",a)}catch(e){console.error("Error fetching resource params:",e),w(null)}finally{F(!1),e!==x&&x||setTimeout(()=>{T(!0)},500)}};(0,m.useEffect)(()=>{N&&O.current&&x&&setTimeout(()=>{T(!0)},300)},[N,x]),(0,m.useEffect)(()=>{y&&(b.setFieldsValue({resource_type:y}),S(y),h({uid:a,icon:y}))},[y,a,h]),(0,m.useEffect)(()=>{if(N&&l&&!O.current)try{let e=f(l.value);b.setFields(Object.entries({resource_type:y,is_dynamic:l.is_dynamic,...e}).map(e=>{let[a,l]=e;return{name:a,value:l,touched:!1,validating:!1}})),O.current=!0,setTimeout(()=>{T(!0)},500)}catch(e){console.error("Error setting initial values:",e)}},[N,l,b,y]);let T=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];E.current&&(clearTimeout(E.current),E.current=null),E.current=setTimeout(()=>{let t=b.getFieldsValue(),r=t.resource_type;if(!r)return;let s={...t};N&&N.forEach(e=>{if(e.valid_values&&Array.isArray(e.valid_values)&&e.valid_values.length>0&&"object"==typeof e.valid_values[0]&&s[e.param_name]){let a=s[e.param_name];"string"!=typeof a&&(s[e.param_name]=a.key||a)}});let{resource_type:i,is_dynamic:n,...u}=s,d=j?"":JSON.stringify(u),c=JSON.stringify({type:r,is_dynamic:!!j,value:d});(e||c!==V.current)&&(V.current=c,o({uid:a,type:r,is_dynamic:!!j,value:d,name:(null==l?void 0:l.name)||g("resource")}))},300)};return(0,t.jsx)("div",{className:c()("flex flex-1",_),children:(0,t.jsx)(n.Z,{spinning:k,children:(0,t.jsxs)(i.default,{style:{width:"100%"},form:b,labelCol:{span:7},initialValues:{resource_type:y,is_dynamic:(null==l?void 0:l.is_dynamic)||!1},onValuesChange:e=>{if("resource_type"in e){Z(e.resource_type);return}if("is_dynamic"in e){T(!0);return}let a=Object.keys(e);a.length>0?b.validateFields(a).then(()=>{console.log("Field validation success"),T()}).catch(e=>{console.log("Field validation error, but still updating:",e),T()}):T()},children:[(0,t.jsx)(i.default.Item,{label:g("resource_type"),name:"resource_type",rules:[{required:!0,message:g("please_select_resource_type")}],children:(0,t.jsx)(u.default,{options:C,placeholder:g("please_select_resource_type")})}),(0,t.jsx)(i.default.Item,{label:g("resource_dynamic"),name:"is_dynamic",valuePropName:"checked",children:(0,t.jsx)(d.Z,{style:{background:j?"#1677ff":"#ccc"}})}),!j&&N&&(0,t.jsx)(s.Z,{params:N,form:b})]})})})}}}]);