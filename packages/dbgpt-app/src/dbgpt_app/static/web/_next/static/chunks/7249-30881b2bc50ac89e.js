(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7249],{23430:function(e,t,r){"use strict";var n=r(85893),l=r(25675),a=r.n(l);t.Z=function(e){let{src:t,label:r,width:l,height:o,className:s}=e;return(0,n.jsx)(a(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(s),width:l||44,height:o||44,src:t,alt:r||"db-icon"})}},86600:function(e,t,r){"use strict";var n=r(85893),l=r(30119),a=r(65654),o=r(2487),s=r(83062),i=r(45360),c=r(28459),d=r(55241),u=r(99859),m=r(34041),p=r(12652),h=r(67294),x=r(67421);let f=e=>{let{data:t,loading:r,submit:l,close:a}=e,{t:i}=(0,x.$G)(),c=e=>()=>{l(e),a()};return(0,n.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,n.jsx)(o.Z,{dataSource:null==t?void 0:t.data,loading:r,rowKey:e=>e.prompt_name,renderItem:e=>(0,n.jsx)(o.Z.Item,{onClick:c(e),children:(0,n.jsx)(s.Z,{title:e.content,children:(0,n.jsx)(o.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:i("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+i("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};t.Z=e=>{let{submit:t,chat_scene:r}=e,{t:o}=(0,x.$G)(),[g,v]=(0,h.useState)(!1),[_,b]=(0,h.useState)("common"),{data:j,loading:y,run:w}=(0,a.Z)(()=>{let e={};return"common"!==_&&(e.prompt_type=_),r&&(e.chat_scene=r),(0,l.PR)("/prompt/list",e)},{refreshDeps:[_,r],onError:e=>{i.ZP.error(null==e?void 0:e.message)},manual:!0});return(0,h.useEffect)(()=>{g&&w()},[g,_,r,w]),(0,n.jsx)(c.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,n.jsx)(d.Z,{title:(0,n.jsx)(u.default.Item,{label:"Prompt "+o("Type"),children:(0,n.jsx)(m.default,{style:{width:150},value:_,onChange:e=>{b(e)},options:[{label:o("Public")+" Prompts",value:"common"},{label:o("Private")+" Prompts",value:"private"}]})}),content:(0,n.jsx)(f,{data:j,loading:y,submit:t,close:()=>{v(!1)}}),placement:"topRight",trigger:"click",open:g,onOpenChange:e=>{v(e)},children:(0,n.jsx)(s.Z,{title:o("Click_Select")+" Prompt",children:(0,n.jsx)(p.Z,{className:"bottom-[30%]"})})})})}},43446:function(e,t,r){"use strict";var n=r(41468),l=r(64371),a=r(62418),o=r(25519),s=r(1375),i=r(45360),c=r(67294),d=r(83454);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions",app_code:r}=e,[u,m]=(0,c.useState)({}),{scene:p}=(0,c.useContext)(n.p),h=(0,c.useCallback)(async e=>{let{data:n,chatId:c,onMessage:u,onClose:h,onDone:x,onError:f,ctrl:g}=e;if(g&&m(g),!(null==n?void 0:n.user_input)&&!(null==n?void 0:n.doc_id)){i.ZP.warning(l.Z.t("no_context_tip"));return}let v={conv_uid:c,app_code:r};n&&Object.keys(n).forEach(e=>{v[e]=n[e]}),console.log("DEBUG - API request params:",v),console.log("DEBUG - prompt_code in params:",v.prompt_code),console.log("DEBUG - data object received:",n);try{var _,b;let e=JSON.stringify(v);console.log("DEBUG - API request body:",e),await (0,s.L)("".concat(null!==(_=d.env.API_BASE_URL)&&void 0!==_?_:"").concat(t),{method:"POST",headers:{"Content-Type":"application/json",[o.gp]:null!==(b=(0,a.n5)())&&void 0!==b?b:""},body:e,signal:g?g.signal:null,openWhenHidden:!0,async onopen(e){e.ok&&e.headers.get("content-type")===s.a||"application/json"!==e.headers.get("content-type")||e.json().then(e=>{null==u||u(e),null==x||x(),g&&g.abort()})},onclose(){g&&g.abort(),null==h||h()},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t="chat_agent"===p?JSON.parse(t).vis:JSON.parse(t)}catch(e){t.replaceAll("\\n","\n")}"string"==typeof t?"[DONE]"===t?null==x||x():(null==t?void 0:t.startsWith("[ERROR]"))?null==f||f(null==t?void 0:t.replace("[ERROR]","")):null==u||u(t):(null==u||u(t),null==x||x())}})}catch(e){g&&g.abort(),null==f||f("Sorry, We meet some error, please try agin later.",e)}},[t,r,p]);return{chat:h,ctrl:u}}},48218:function(e,t,r){"use strict";var n=r(85893),l=r(82353),a=r(16165),o=r(67294);t.Z=e=>{let{width:t,height:r,scene:s}=e,i=(0,o.useCallback)(()=>{switch(s){case"chat_knowledge":return l.je;case"chat_with_db_execute":return l.zM;case"chat_excel":return l.DL;case"chat_with_db_qa":case"chat_dba":return l.RD;case"chat_dashboard":return l.In;case"chat_agent":return l.si;case"chat_normal":return l.O7;default:return}},[s]);return(0,n.jsx)(a.Z,{className:"w-".concat(t||7," h-").concat(r||7),component:i()})}},70065:function(e,t,r){"use strict";var n=r(91321);let l=(0,n.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});t.Z=l},91467:function(e,t,r){"use strict";r.d(t,{TH:function(){return x},ZS:function(){return f}});var n=r(85893),l=r(89705),a=r(83062),o=r(96074),s=r(45030),i=r(85418),c=r(93967),d=r.n(c),u=r(36609),m=r(25675),p=r.n(m);r(67294);var h=r(48218);r(11873);let x=e=>{let{onClick:t,Icon:r="/pictures/card_chat.png",text:l=(0,u.t)("start_chat")}=e;return"string"==typeof r&&(r=(0,n.jsx)(p(),{src:r,alt:r,width:17,height:15})),(0,n.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[r,(0,n.jsx)("span",{children:l})]})},f=e=>{let{menu:t}=e;return(0,n.jsx)(i.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,n.jsx)(l.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:r,LeftBottom:l,RightBottom:i,onClick:c,rightTopHover:u=!0,logo:m,name:x,description:f,className:g,scene:v,code:_}=e;return"string"==typeof f&&(f=(0,n.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:f})),(0,n.jsx)("div",{className:d()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",g),children:(0,n.jsxs)("div",{onClick:c,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,n.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,n.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:v?(0,n.jsx)(h.Z,{scene:v,width:14,height:14}):m&&(0,n.jsx)(p(),{src:m,width:44,height:44,alt:x,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,n.jsx)("div",{className:"flex-1",children:x.length>6?(0,n.jsx)(a.Z,{title:x,children:(0,n.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})}):(0,n.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})})]}),(0,n.jsx)("span",{className:d()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),f,(0,n.jsx)("div",{className:"relative bottom-2",children:r}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("div",{children:l}),(0,n.jsx)("div",{children:i})]}),_&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{className:"my-3"}),(0,n.jsx)(s.Z.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:_})]})]})})}},57249:function(e,t,r){"use strict";r.r(t),r.d(t,{ChatContentContext:function(){return eO},default:function(){return eM}});var n=r(85893),l=r(41468),a=r(76212),o=r(86600),s=r(43446),i=r(50888),c=r(90598),d=r(75750),u=r(58638),m=r(45360),p=r(66309),h=r(45030),x=r(74330),f=r(20640),g=r.n(f),v=r(67294),_=r(67421),b=r(65654),j=r(48218);let y=["magenta","orange","geekblue","purple","cyan","green"];var w=e=>{var t,r,l,o,s,f;let{isScrollToTop:w}=e,{appInfo:C,refreshAppInfo:N,handleChat:k,scrollRef:Z,temperatureValue:S,resourceValue:P,currentDialogue:R}=(0,v.useContext)(eO),{t:E}=(0,_.$G)(),O=(0,v.useMemo)(()=>{var e;return(null==C?void 0:null===(e=C.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent"},[C]),M=(0,v.useMemo)(()=>(null==C?void 0:C.is_collected)==="true",[C]),{run:T,loading:I}=(0,b.Z)(async()=>{let[e]=await (0,a.Vx)(M?(0,a.gD)({app_code:C.app_code}):(0,a.mo)({app_code:C.app_code}));if(!e)return await N()},{manual:!0}),V=(0,v.useMemo)(()=>{var e;return(null===(e=C.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[C.param_need]);if(!Object.keys(C).length)return null;let L=async()=>{let e=g()(location.href);m.ZP[e?"success":"error"](e?E("copy_success"):E("copy_failed"))};return(0,n.jsx)("div",{className:"h-20 mt-6 ".concat((null==C?void 0:C.recommend_questions)&&(null==C?void 0:null===(t=C.recommend_questions)||void 0===t?void 0:t.length)>0?"mb-6":""," sticky top-0 bg-transparent z-30 transition-all duration-400 ease-in-out"),children:w?(0,n.jsxs)("header",{className:"flex items-center justify-between w-full h-14 bg-[#ffffffb7] dark:bg-[rgba(41,63,89,0.4)]  px-8 transition-all duration-500 ease-in-out",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-2 bg-white",children:(0,n.jsx)(j.Z,{scene:O})}),(0,n.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,n.jsx)("span",{children:null==C?void 0:C.app_name}),(0,n.jsxs)("div",{className:"flex gap-1",children:[(null==C?void 0:C.team_mode)&&(0,n.jsx)(p.Z,{color:"green",children:null==C?void 0:C.team_mode}),(null==C?void 0:null===(r=C.team_context)||void 0===r?void 0:r.chat_scene)&&(0,n.jsx)(p.Z,{color:"cyan",children:null==C?void 0:null===(l=C.team_context)||void 0===l?void 0:l.chat_scene})]})]})]}),(0,n.jsxs)("div",{className:"flex gap-8",onClick:async()=>{await T()},children:[I?(0,n.jsx)(x.Z,{spinning:I,indicator:(0,n.jsx)(i.Z,{style:{fontSize:24},spin:!0})}):(0,n.jsx)(n.Fragment,{children:M?(0,n.jsx)(c.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,n.jsx)(d.Z,{style:{fontSize:18,cursor:"pointer"}})}),(0,n.jsx)(u.Z,{className:"text-lg",onClick:e=>{e.stopPropagation(),L()}})]})]}):(0,n.jsxs)("header",{className:"flex items-center justify-between w-5/6 h-full px-6  bg-[#ffffff99] border dark:bg-[rgba(255,255,255,0.1)] dark:border-[rgba(255,255,255,0.1)] rounded-2xl mx-auto transition-all duration-400 ease-in-out relative",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex w-12 h-12 justify-center items-center rounded-xl mr-4 bg-white",children:(0,n.jsx)(j.Z,{scene:O,width:16,height:16})}),(0,n.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,n.jsx)("span",{children:null==C?void 0:C.app_name}),(0,n.jsxs)("div",{className:"flex gap-1",children:[(null==C?void 0:C.team_mode)&&(0,n.jsx)(p.Z,{color:"green",children:null==C?void 0:C.team_mode}),(null==C?void 0:null===(o=C.team_context)||void 0===o?void 0:o.chat_scene)&&(0,n.jsx)(p.Z,{color:"cyan",children:null==C?void 0:null===(s=C.team_context)||void 0===s?void 0:s.chat_scene})]})]}),(0,n.jsx)(h.Z.Text,{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",ellipsis:{tooltip:!0},children:null==C?void 0:C.app_describe})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{onClick:async()=>{await T()},className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:I?(0,n.jsx)(x.Z,{spinning:I,indicator:(0,n.jsx)(i.Z,{style:{fontSize:24},spin:!0})}):(0,n.jsx)(n.Fragment,{children:M?(0,n.jsx)(c.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,n.jsx)(d.Z,{style:{fontSize:18,cursor:"pointer"}})})}),(0,n.jsx)("div",{onClick:L,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,n.jsx)(u.Z,{className:"text-lg"})})]}),!!(null==C?void 0:null===(f=C.recommend_questions)||void 0===f?void 0:f.length)&&(0,n.jsxs)("div",{className:"absolute  bottom-[-40px] left-0",children:[(0,n.jsx)("span",{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",children:"或许你想问："}),C.recommend_questions.map((e,t)=>(0,n.jsx)(p.Z,{color:y[t],className:"text-xs p-1 px-2 cursor-pointer",onClick:async()=>{k((null==e?void 0:e.question)||"",{app_code:C.app_code,...V.includes("temperature")&&{temperature:S},...V.includes("resource")&&{select_param:"string"==typeof P?P:JSON.stringify(P)||R.select_param}}),setTimeout(()=>{var e,t;null===(e=Z.current)||void 0===e||e.scrollTo({top:null===(t=Z.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"})},0)},children:e.question},e.id))]})]})})},C=r(62635),N=r(66017),k=r(5152),Z=r.n(k);let S=Z()(()=>Promise.all([r.e(7034),r.e(6106),r.e(8674),r.e(3166),r.e(2837),r.e(2168),r.e(8163),r.e(1265),r.e(7728),r.e(4567),r.e(2398),r.e(9773),r.e(4035),r.e(1154),r.e(2510),r.e(3345),r.e(9202),r.e(5265),r.e(2640),r.e(3764),r.e(5e3),r.e(3768),r.e(5789),r.e(3913),r.e(4434),r.e(3013)]).then(r.bind(r,88331)),{loadableGenerated:{webpack:()=>[88331]},ssr:!1});var P=(0,v.forwardRef)((e,t)=>{let{}=e,r=(0,v.useRef)(null),[l,a]=(0,v.useState)(!1),[o,s]=(0,v.useState)(!1),[i,c]=(0,v.useState)(!0),[d,u]=(0,v.useState)(!1),{history:m}=(0,v.useContext)(eO),p=(0,v.useRef)(!0);(0,v.useImperativeHandle)(t,()=>r.current),(0,v.useEffect)(()=>{if(r.current){let e=r.current.scrollHeight>r.current.clientHeight;s(e)}},[]);let h=(0,v.useRef)(0),x=(0,v.useRef)(!1),f=(0,v.useRef)(0),g=(0,v.useRef)(!1),_=(0,v.useRef)(null),b=(0,v.useRef)(null),j=(0,v.useRef)(null);(0,v.useEffect)(()=>{console.log("ChatContentContainer initializing with history length:",m.length),h.current=m.length},[]);let y=(0,v.useCallback)(()=>{if(!r.current)return;let e=r.current,{scrollTop:t,scrollHeight:n,clientHeight:l}=e,o=t+l>=n-5;p.current=o,c(t<=20),u(t+l>=n-20),t>=74?a(!0):a(!1);let i=n>l;if(s(i),g.current)console.log("ChatContentContainer: Ignoring scroll event during streaming");else{let e=t+l>=n-5,r=x.current;x.current=!e,r!==x.current&&console.log("ChatContentContainer: User scroll state changed:",{isAtBottom:e,isUserScrolling:x.current,scrollTop:t,scrollHeight:n,clientHeight:l})}},[]),k=(0,v.useCallback)(()=>{if(!r.current)return;let e=r.current;console.log("ChatContentContainer: Scrolling to bottom"),e.scrollTo({top:e.scrollHeight,behavior:"instant"})},[]),Z=(0,v.useCallback)(()=>{if(r.current&&g.current)try{let e=r.current,t=e.scrollHeight;if(console.log("ChatContentContainer streaming height check:",{currentHeight:t,lastHeight:f.current,heightDiff:t-f.current,isStreaming:g.current}),0===f.current){console.log("ChatContentContainer: Setting initial baseline height:",t),f.current=t;return}let n=t-f.current;if(n>0){console.log("ChatContentContainer: Content height increased by",n,"px, scrolling");let{scrollTop:r,clientHeight:l}=e;if(t-(r+l)>100){console.log("ChatContentContainer: User scrolled away during streaming, not forcing scroll");return}k(),f.current=t,_.current&&(clearTimeout(_.current),_.current=null),_.current=setTimeout(()=>{console.log("ChatContentContainer: Exiting streaming mode after content timeout"),g.current=!1,b.current&&(b.current.disconnect(),b.current=null,console.log("ChatContentContainer: MutationObserver stopped on timeout"))},1e4)}}catch(e){console.error("ChatContentContainer: Error in checkContentHeight:",e)}},[k]),P=(0,v.useCallback)(()=>{if(r.current&&g.current)try{let e=r.current,{scrollTop:t,scrollHeight:n,clientHeight:l}=e,a=t+l>=n-5;console.log("ChatContentContainer force scroll check:",{scrollTop:t,scrollHeight:n,clientHeight:l,isAtBottom:a,distanceFromBottom:n-(t+l)}),!a&&n-(t+l)<=100&&(console.log("ChatContentContainer: Forcing scroll to bottom during streaming"),k()),f.current=e.scrollHeight,_.current&&(clearTimeout(_.current),_.current=null),_.current=setTimeout(()=>{console.log("ChatContentContainer: Exiting streaming mode after content timeout"),g.current=!1,b.current&&(b.current.disconnect(),b.current=null,console.log("ChatContentContainer: MutationObserver stopped on timeout"))},1e4)}catch(e){console.error("ChatContentContainer: Error in forceScrollCheck:",e)}},[k]),R=(0,v.useCallback)(()=>{if(console.log("ChatContentContainer: Cleaning up streaming mode"),g.current=!1,_.current&&(clearTimeout(_.current),_.current=null),j.current&&(clearInterval(j.current),j.current=null,console.log("ChatContentContainer: Backup interval cleared")),b.current)try{b.current.disconnect(),b.current=null,console.log("ChatContentContainer: MutationObserver cleaned up")}catch(e){console.error("ChatContentContainer: Error disconnecting MutationObserver:",e)}},[]),E=(0,v.useCallback)(()=>{if(console.log("ChatContentContainer: Starting streaming mode"),R(),g.current=!0,x.current=!1,k(),f.current=0,r.current)try{b.current=new MutationObserver(e=>{g.current&&(console.log("ChatContentContainer: MutationObserver detected changes:",e.length),setTimeout(()=>{Z(),P()},5))}),b.current.observe(r.current,{childList:!0,subtree:!0,characterData:!0,attributes:!0,attributeOldValue:!0,characterDataOldValue:!0}),console.log("ChatContentContainer: Enhanced MutationObserver started")}catch(e){console.error("ChatContentContainer: Error creating MutationObserver:",e)}j.current=setInterval(()=>{if(!g.current){j.current&&(clearInterval(j.current),j.current=null);return}console.log("ChatContentContainer: Backup scroll check"),P()},500),_.current=setTimeout(()=>{console.log("ChatContentContainer: Exiting streaming mode after timeout"),R()},1e4)},[k,Z,P,R]);return(0,v.useEffect)(()=>{if(!r.current)return;let e=m.length,t=e>h.current;if(console.log("ChatContentContainer message count check:",{currentMessageCount:e,prevCount:h.current,isNewMessage:t,isStreaming:g.current}),t)console.log("ChatContentContainer: New message detected, starting streaming mode"),h.current=e,E();else if(!g.current){let e=r.current;if(e&&!x.current){let t=e.scrollHeight,r=t-f.current;r>0&&(console.log("ChatContentContainer: Non-streaming content change, scrolling"),k(),f.current=t)}}},[m.length,E,k]),(0,v.useEffect)(()=>{let e=r.current;if(e)return e.addEventListener("scroll",y),()=>{e.removeEventListener("scroll",y),R()}},[y,R]),(0,n.jsxs)("div",{className:"flex flex-1 relative",children:[(0,n.jsxs)("div",{ref:r,className:"h-full w-full mx-auto overflow-y-auto",style:{scrollBehavior:"smooth"},children:[(0,n.jsx)(w,{isScrollToTop:l}),(0,n.jsx)(S,{})]}),o&&(0,n.jsxs)("div",{className:"absolute right-6 bottom-24 flex flex-col gap-2",children:[!i&&(0,n.jsx)("button",{onClick:()=>{r.current&&r.current.scrollTo({top:0,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to top",children:(0,n.jsx)(C.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})}),!d&&(0,n.jsx)("button",{onClick:()=>{r.current&&r.current.scrollTo({top:r.current.scrollHeight,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to bottom",children:(0,n.jsx)(N.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})})]})]})}),R=r(89546),E=r(91467),O=r(7134),M=r(32983),T=r(25675),I=r.n(T),V=r(11163),L=r(70065),D=e=>{let{apps:t,refresh:r,loading:o,type:s}=e,i=async e=>{let[t]=await (0,a.Vx)("true"===e.is_collected?(0,a.gD)({app_code:e.app_code}):(0,a.mo)({app_code:e.app_code}));t||r()},{setAgent:u,model:m,setCurrentDialogInfo:p}=(0,v.useContext)(l.p),h=(0,V.useRouter)(),f=async e=>{if("native_app"===e.team_mode){let{chat_scene:t=""}=e.team_context,[,r]=await (0,a.Vx)((0,a.sW)({chat_mode:t}));r&&(null==p||p({chat_scene:r.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:r.chat_mode,app_code:e.app_code})),h.push("/chat?scene=".concat(t,"&id=").concat(r.conv_uid).concat(m?"&model=".concat(m):"")))}else{let[,t]=await (0,a.Vx)((0,a.sW)({chat_mode:"chat_agent"}));t&&(null==p||p({chat_scene:t.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:e.app_code})),null==u||u(e.app_code),h.push("/chat/?scene=chat_agent&id=".concat(t.conv_uid).concat(m?"&model=".concat(m):"")))}};return o?(0,n.jsx)(x.Z,{size:"large",className:"flex items-center justify-center h-full",spinning:o}):(0,n.jsx)("div",{className:"flex flex-wrap mt-4 w-full overflow-y-auto ",children:(null==t?void 0:t.length)>0?t.map(e=>{var t;return(0,n.jsx)(E.ZP,{name:e.app_name,description:e.app_describe,onClick:()=>f(e),RightTop:"true"===e.is_collected?(0,n.jsx)(c.Z,{onClick:t=>{t.stopPropagation(),i(e)},style:{height:"21px",cursor:"pointer",color:"#f9c533"}}):(0,n.jsx)(d.Z,{onClick:t=>{t.stopPropagation(),i(e)},style:{height:"21px",cursor:"pointer"}}),LeftBottom:(0,n.jsxs)("div",{className:"flex gap-8 items-center text-gray-500 text-sm",children:[e.owner_name&&(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,n.jsx)(O.C,{src:null==e?void 0:e.owner_avatar_url,className:"bg-gradient-to-tr from-[#31afff] to-[#1677ff] cursor-pointer",children:e.owner_name}),(0,n.jsx)("span",{children:e.owner_name})]}),"used"!==s&&(0,n.jsxs)("div",{className:"flex items-start gap-1",children:[(0,n.jsx)(L.Z,{type:"icon-hot",className:"text-lg"}),(0,n.jsx)("span",{className:"text-[#878c93]",children:e.hot_value})]})]}),scene:(null==e?void 0:null===(t=e.team_context)||void 0===t?void 0:t.chat_scene)||"chat_agent"},e.app_code)}):(0,n.jsx)(M.Z,{image:(0,n.jsx)(I(),{src:"/pictures/empty.png",alt:"empty",width:142,height:133,className:"w-[142px] h-[133px]"}),className:"flex justify-center items-center w-full h-full min-h-[200px]"})})},z=r(62418),H=r(25278),G=r(14726),A=r(93967),U=r.n(A),B=function(){let{setCurrentDialogInfo:e}=(0,v.useContext)(l.p),{t}=(0,_.$G)(),r=(0,V.useRouter)(),[o,s]=(0,v.useState)(""),[i,c]=(0,v.useState)(!1),[d,u]=(0,v.useState)(!1),m=async()=>{let[,t]=await (0,a.Vx)((0,a.sW)({chat_mode:"chat_normal"}));t&&(null==e||e({chat_scene:t.chat_mode,app_code:t.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:t.chat_mode})),localStorage.setItem(z.rU,JSON.stringify({id:t.conv_uid,message:o})),r.push("/chat/?scene=chat_normal&id=".concat(t.conv_uid))),s("")};return(0,n.jsxs)("div",{className:"flex flex-1 h-12 p-2 pl-4 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl  border-t border-b border-l border-r ".concat(i?"border-[#0c75fc]":""),children:[(0,n.jsx)(H.default.TextArea,{placeholder:t("input_tips"),className:"w-full resize-none border-0 p-0 focus:shadow-none",value:o,autoSize:{minRows:1},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!d&&(e.preventDefault(),o.trim()&&m())},onChange:e=>{s(e.target.value)},onFocus:()=>{c(!0)},onBlur:()=>c(!1),onCompositionStart:()=>u(!0),onCompositionEnd:()=>u(!1)}),(0,n.jsx)(G.ZP,{type:"primary",className:U()("flex items-center justify-center w-14 h-8 rounded-lg text-sm  bg-button-gradient border-0",{"opacity-40 cursor-not-allowed":!o.trim()}),onClick:()=>{o.trim()&&m()},children:t("sent")})]})},J=r(28459),W=r(92783),$=r(36609),q=function(){let{setCurrentDialogInfo:e,model:t}=(0,v.useContext)(l.p),r=(0,V.useRouter)(),[o,s]=(0,v.useState)({app_list:[],total_count:0}),[i,c]=(0,v.useState)("recommend"),d=e=>(0,a.Vx)((0,a.yk)({...e,page_no:"1",page_size:"6"})),u=e=>(0,a.Vx)((0,a.mW)({page_no:"1",page_size:"6",...e})),{run:m,loading:p,refresh:h}=(0,b.Z)(async e=>{switch(i){case"recommend":return await u({});case"used":return await d({is_recent_used:"true",need_owner_info:"true",...e&&{app_name:e}});default:return[]}},{manual:!0,onSuccess:e=>{let[t,r]=e;if("recommend"===i)return s({app_list:r,total_count:(null==r?void 0:r.length)||0});s(r||{})},debounceWait:500});(0,v.useEffect)(()=>{m()},[i,m]);let x=[{value:"recommend",label:(0,$.t)("recommend_apps")},{value:"used",label:(0,$.t)("used_apps")}],{data:f}=(0,b.Z)(async()=>{let[,e]=await (0,a.Vx)((0,R.A)({is_hot_question:"true"}));return null!=e?e:[]});return(0,n.jsx)(J.ZP,{theme:{components:{Button:{defaultBorderColor:"white"},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,n.jsxs)("div",{className:"px-28 py-10 h-full flex flex-col justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)(W.Z,{className:"backdrop-filter h-10 backdrop-blur-lg bg-white bg-opacity-30 border border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:x,value:i,onChange:e=>{c(e)}}),(0,n.jsxs)("span",{className:"flex items-center text-gray-500 gap-1 dark:text-slate-300",children:[(0,n.jsx)("span",{children:(0,$.t)("app_in_mind")}),(0,n.jsxs)("span",{className:"flex items-center cursor-pointer",onClick:()=>{r.push("/")},children:[(0,n.jsx)(I(),{src:"/pictures/explore_active.png",alt:"construct_image",width:24,height:24},"image_explore"),(0,n.jsx)("span",{className:"text-default",children:(0,$.t)("explore")})]}),(0,n.jsx)("span",{children:(0,$.t)("Discover_more")})]})]}),(0,n.jsx)(D,{apps:(null==o?void 0:o.app_list)||[],loading:p,refresh:h,type:i}),f&&f.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"font-medium text-xl my-4",children:(0,$.t)("help")}),(0,n.jsx)("div",{className:"flex justify-start gap-4",children:f.map(l=>(0,n.jsxs)("span",{className:"flex gap-4 items-center backdrop-filter backdrop-blur-lg cursor-pointer bg-white bg-opacity-70 border-0 rounded-lg shadow p-2 relative dark:bg-[#6f7f95] dark:bg-opacity-60",onClick:async()=>{let[,n]=await (0,a.Vx)((0,a.sW)({chat_mode:"chat_knowledge",model:t}));n&&(null==e||e({chat_scene:n.chat_mode,app_code:l.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:n.chat_mode,app_code:l.app_code})),localStorage.setItem(z.rU,JSON.stringify({id:n.conv_uid,message:l.question})),r.push("/chat/?scene=".concat(n.chat_mode,"&id=").concat(null==n?void 0:n.conv_uid)))},children:[(0,n.jsx)("span",{children:l.question}),(0,n.jsx)(I(),{src:"/icons/send.png",alt:"construct_image",width:20,height:20},"image_explore")]},l.id))})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)(B,{})})]})})},F=r(39332),K=r(30159),X=r(87740),Y=r(52645),Q=r(83062),ee=r(11186),et=r(55241),er=r(30568),en=r(13457),el=(0,v.memo)(e=>{let{maxNewTokensValue:t,setMaxNewTokensValue:r}=e,{appInfo:l}=(0,v.useContext)(eO),{t:a}=(0,_.$G)(),o=(0,v.useMemo)(()=>{var e;return(null===(e=l.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[l.param_need]);if(!o.includes("max_new_tokens"))return(0,n.jsx)(Q.Z,{title:a("max_new_tokens_tip"),children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,n.jsx)(ee.Z,{className:"text-xl cursor-not-allowed opacity-30"})})});let s=e=>{null===e||isNaN(e)||r(e)},i=e=>{r(e)};return(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(et.Z,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(er.Z,{className:"w-32",min:1,max:20480,step:1,onChange:i,value:"number"==typeof t?t:4e3}),(0,n.jsx)(en.Z,{size:"small",className:"w-20",min:1,max:20480,step:1,onChange:s,value:t})]}),children:(0,n.jsx)(Q.Z,{title:a("max_new_tokens"),placement:"bottom",arrow:!1,children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,n.jsx)(ee.Z,{})})})}),(0,n.jsx)("span",{className:"text-sm ml-2",children:t})]})}),ea=r(42952),eo=r(34041),es=r(39718),ei=(0,v.memo)(()=>{let{modelList:e}=(0,v.useContext)(l.p),{appInfo:t,modelValue:r,setModelValue:a}=(0,v.useContext)(eO),{t:o}=(0,_.$G)(),s=(0,v.useMemo)(()=>{var e;return(null===(e=t.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[t.param_need]);return s.includes("model")?(0,n.jsx)(eo.default,{value:r,placeholder:o("choose_model"),className:"h-8 rounded-3xl",onChange:e=>{a(e)},popupMatchSelectWidth:300,children:e.map(e=>(0,n.jsx)(eo.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(es.Z,{model:e}),(0,n.jsx)("span",{className:"ml-2",children:e})]})},e))}):(0,n.jsx)(Q.Z,{title:o("model_tip"),children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,n.jsx)(ea.Z,{className:"text-xl cursor-not-allowed opacity-30"})})})}),ec=r(23430),ed=r(90725),eu=r(83266),em=r(2093),ep=r(23799),eh=(0,v.memo)(e=>{var t,r,l,o;let{fileList:s,setFileList:i,setLoading:c,fileName:d}=e,{setResourceValue:u,appInfo:m,refreshHistory:p,refreshDialogList:h,modelValue:x,resourceValue:f}=(0,v.useContext)(eO),{temperatureValue:g,maxNewTokensValue:j}=(0,v.useContext)(eO),y=(0,F.useSearchParams)(),w=null!==(t=null==y?void 0:y.get("scene"))&&void 0!==t?t:"",C=null!==(r=null==y?void 0:y.get("id"))&&void 0!==r?r:"",{t:N}=(0,_.$G)(),[k,Z]=(0,v.useState)([]),S=(0,v.useMemo)(()=>{var e;return(null===(e=m.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[m.param_need]),P=(0,v.useMemo)(()=>{var e,t;return S.includes("resource")&&(null===(e=null===(t=m.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="database"},[m.param_need,S]),R=(0,v.useMemo)(()=>{var e,t;return S.includes("resource")&&(null===(e=null===(t=m.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="knowledge"},[m.param_need,S]),E=(0,v.useMemo)(()=>{var e;return null===(e=m.param_need)||void 0===e?void 0:e.find(e=>"resource"===e.type)},[m.param_need]),{run:O,loading:M}=(0,b.Z)(async()=>await (0,a.Vx)((0,a.vD)(w)),{manual:!0,onSuccess:e=>{let[,t]=e;Z(null!=t?t:[])}});(0,em.Z)(async()=>{(P||R)&&!(null==E?void 0:E.bind_value)&&await O()},[P,R,E]);let T=(0,v.useMemo)(()=>{var e;return null===(e=k.map)||void 0===e?void 0:e.call(k,e=>({label:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec.Z,{width:24,height:24,src:z.S$[e.type].icon,label:z.S$[e.type].label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.param]}),value:e.param}))},[k]),I=(0,v.useCallback)(async()=>{let e=new FormData;e.append("doc_files",null==s?void 0:s[0]),c(!0);let[t,r]=await (0,a.Vx)((0,a.qn)({convUid:C,chatMode:w,data:e,model:x,temperatureValue:g,maxNewTokensValue:j,config:{timeout:36e5}})).finally(()=>{c(!1)});r&&(u(r),await p(),await h())},[C,s,x,h,p,w,c,u]);if(!S.includes("resource"))return(0,n.jsx)(Q.Z,{title:N("extend_tip"),children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,n.jsx)(ed.Z,{className:"text-lg cursor-not-allowed opacity-30"})})});switch(null==E?void 0:E.value){case"excel_file":case"text_file":case"image_file":case"audio_file":case"video_file":{let e="chat_excel"===w&&(!!d||!!(null===(l=s[0])||void 0===l?void 0:l.name)),t=N("chat_excel"===w?"file_tip":"file_upload_tip");return(0,n.jsx)(ep.default,{name:"file",accept:(()=>{switch(null==E?void 0:E.value){case"excel_file":return".csv,.xlsx,.xls";case"text_file":return".txt,.doc,.docx,.pdf,.md";case"image_file":return".jpg,.jpeg,.png,.gif,.bmp,.webp";case"audio_file":return".mp3,.wav,.ogg,.aac";case"video_file":return".mp4,.wav,.wav";default:return""}})(),fileList:s,showUploadList:!1,beforeUpload:(e,t)=>{null==i||i(t)},customRequest:I,disabled:e,children:(0,n.jsx)(Q.Z,{title:t,arrow:!1,placement:"bottom",children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,n.jsx)(eu.Z,{className:U()("text-xl",{"cursor-pointer":!e})})})})})}case"database":case"knowledge":case"plugin":case"awel_flow":return f||u(null==T?void 0:null===(o=T[0])||void 0===o?void 0:o.value),(0,n.jsx)(eo.default,{value:f,className:"w-52 h-8 rounded-3xl",onChange:e=>{u(e)},disabled:!!(null==E?void 0:E.bind_value),loading:M,options:T})}}),ex=(0,v.memo)(e=>{let{temperatureValue:t,setTemperatureValue:r}=e,{appInfo:l}=(0,v.useContext)(eO),{t:a}=(0,_.$G)(),o=(0,v.useMemo)(()=>{var e;return(null===(e=l.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[l.param_need]);if(!o.includes("temperature"))return(0,n.jsx)(Q.Z,{title:a("temperature_tip"),children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,n.jsx)(ee.Z,{className:"text-xl cursor-not-allowed opacity-30"})})});let s=e=>{isNaN(e)||r(e)};return(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(et.Z,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(er.Z,{className:"w-20",min:0,max:1,step:.1,onChange:s,value:"number"==typeof t?t:0}),(0,n.jsx)(en.Z,{size:"small",className:"w-14",min:0,max:1,step:.1,onChange:s,value:t})]}),children:(0,n.jsx)(Q.Z,{title:a("temperature"),placement:"bottom",arrow:!1,children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,n.jsx)(ee.Z,{})})})}),(0,n.jsx)("span",{className:"text-sm ml-2",children:t})]})}),ef=e=>{let{ctrl:t}=e,{t:r}=(0,_.$G)(),{history:l,scrollRef:o,canAbort:s,replyLoading:c,currentDialogue:d,appInfo:u,temperatureValue:m,maxNewTokensValue:p,resourceValue:h,setTemperatureValue:f,setMaxNewTokensValue:g,refreshHistory:b,setCanAbort:j,setReplyLoading:y,handleChat:w}=(0,v.useContext)(eO),[C,N]=(0,v.useState)([]),[k,Z]=(0,v.useState)(!1),[S,P]=(0,v.useState)(!1),R=(0,v.useMemo)(()=>{var e;return(null===(e=u.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[u.param_need]),E=(0,v.useMemo)(()=>[{tip:r("stop_replying"),icon:(0,n.jsx)(K.Z,{className:U()({"text-[#0c75fc]":s})}),can_use:s,key:"abort",onClick:()=>{s&&(t.abort(),setTimeout(()=>{j(!1),y(!1)},100))}},{tip:r("answer_again"),icon:(0,n.jsx)(X.Z,{}),can_use:!c&&l.length>0,key:"redo",onClick:async()=>{var e,t;let r=null===(e=null===(t=l.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];w((null==r?void 0:r.context)||"",{app_code:u.app_code,...R.includes("temperature")&&{temperature:m},...R.includes("max_new_tokens")&&{max_new_tokens:p},...R.includes("resource")&&{select_param:"string"==typeof h?h:JSON.stringify(h)||d.select_param}}),setTimeout(()=>{var e,t;null===(e=o.current)||void 0===e||e.scrollTo({top:null===(t=o.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"})},0)}},{tip:r("erase_memory"),icon:S?(0,n.jsx)(x.Z,{spinning:S,indicator:(0,n.jsx)(i.Z,{style:{fontSize:20}})}):(0,n.jsx)(Y.Z,{}),can_use:l.length>0,key:"clear",onClick:async()=>{S||(P(!0),await (0,a.Vx)((0,a.zR)(d.conv_uid)).finally(async()=>{await b(),P(!1)}))}}],[r,s,c,l,S,t,j,y,w,u.app_code,R,m,h,d.select_param,d.conv_uid,o,b]),O=(0,v.useMemo)(()=>{try{if(h){if("string"==typeof h)return JSON.parse(h).file_name||"";return h.file_name||""}return JSON.parse(d.select_param).file_name||""}catch(e){return""}},[h,d.select_param]);return(0,n.jsxs)("div",{className:"flex flex-col  mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between h-full w-full",children:[(0,n.jsxs)("div",{className:"flex gap-3 text-lg",children:[(0,n.jsx)(ei,{}),(0,n.jsx)(eh,{fileList:C,setFileList:N,setLoading:Z,fileName:O}),(0,n.jsx)(ex,{temperatureValue:m,setTemperatureValue:f}),(0,n.jsx)(el,{maxNewTokensValue:p,setMaxNewTokensValue:g})]}),(0,n.jsx)("div",{className:"flex gap-1",children:(0,n.jsx)(n.Fragment,{children:E.map(e=>(0,n.jsx)(Q.Z,{title:e.tip,arrow:!1,placement:"bottom",children:(0,n.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] text-lg ".concat(e.can_use?"cursor-pointer":"opacity-30 cursor-not-allowed"),onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)},children:e.icon})},e.key))})})]}),(0,n.jsx)(()=>{let e=(0,z.Ev)(h)||(0,z.Ev)(d.select_param)||[];return 0===e.length?null:(0,n.jsx)("div",{className:"group/item flex flex-wrap gap-2 mt-2",children:e.map((e,t)=>{var r,l;if("image_url"===e.type&&(null===(r=e.image_url)||void 0===r?void 0:r.url)){let r=e.image_url.fileName,l=(0,z.Hb)(e.image_url.url);return(0,n.jsxs)("div",{className:"flex flex-col border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:[(0,n.jsx)("div",{className:"w-32 h-32 mb-2 overflow-hidden flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded",children:(0,n.jsx)("img",{src:l,alt:r||"Preview",className:"max-w-full max-h-full object-contain"})}),(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:r})})]},"img-".concat(t))}if("file_url"===e.type&&(null===(l=e.file_url)||void 0===l?void 0:l.url)){let r=e.file_url.file_name;return(0,n.jsx)("div",{className:"flex items-center justify-between border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(I(),{src:"/icons/chat/excel.png",width:20,height:20,alt:"file-icon",className:"mr-2"}),(0,n.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:r})]})},"file-".concat(t))}return null})})},{}),(0,n.jsx)(x.Z,{spinning:k,indicator:(0,n.jsx)(i.Z,{style:{fontSize:24},spin:!0})})]})},eg=(0,v.forwardRef)((e,t)=>{var r,l;let{ctrl:a}=e,{t:o}=(0,_.$G)(),{scrollRef:s,replyLoading:c,handleChat:d,appInfo:u,currentDialogue:m,temperatureValue:p,maxNewTokensValue:h,resourceValue:f,setResourceValue:g,refreshDialogList:b}=(0,v.useContext)(eO),j=(0,F.useSearchParams)(),y=null!==(r=null==j?void 0:j.get("scene"))&&void 0!==r?r:"",w=null!==(l=null==j?void 0:j.get("select_param"))&&void 0!==l?l:"",[C,N]=(0,v.useState)(""),[k,Z]=(0,v.useState)(!1),[S,P]=(0,v.useState)(!1),R=(0,v.useRef)(0),E=(0,v.useMemo)(()=>{var e;return(null===(e=u.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[u.param_need]),O=async()=>{let e;R.current++,setTimeout(()=>{var e,t;null===(e=s.current)||void 0===e||e.scrollTo({top:null===(t=s.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"}),N("")},0);let t=(0,z.Ev)(f);if(t.length>0){"chat_excel"!==y&&g(null);let r=[...t];r.push({type:"text",text:C}),e={role:"user",content:r}}else e=C;let r={app_code:u.app_code||"",...E.includes("temperature")&&{temperature:p},...E.includes("max_new_tokens")&&{max_new_tokens:h},select_param:w,...E.includes("resource")&&{select_param:"string"==typeof f?f:JSON.stringify(f)||m.select_param}};await d(e,r),1===R.current&&await b()};return(0,v.useImperativeHandle)(t,()=>({setUserInput:N})),(0,n.jsx)("div",{className:"flex flex-col w-5/6 mx-auto pt-4 pb-6 bg-transparent",children:(0,n.jsxs)("div",{className:"flex flex-1 flex-col bg-white dark:bg-[rgba(255,255,255,0.16)] px-5 py-4 pt-2 rounded-xl relative border-t border-b border-l border-r dark:border-[rgba(255,255,255,0.6)] ".concat(k?"border-[#0c75fc]":""),id:"input-panel",children:[(0,n.jsx)(ef,{ctrl:a}),(0,n.jsx)(H.default.TextArea,{placeholder:o("input_tips"),className:"w-full h-20 resize-none border-0 p-0 focus:shadow-none dark:bg-transparent",value:C,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!S&&(e.preventDefault(),C.trim()&&!c&&O())},onChange:e=>{N(e.target.value)},onFocus:()=>{Z(!0)},onBlur:()=>Z(!1),onCompositionStart:()=>P(!0),onCompositionEnd:()=>P(!1)}),(0,n.jsx)(G.ZP,{type:"primary",className:U()("flex items-center justify-center w-14 h-8 rounded-lg text-sm absolute right-4 bottom-3 bg-button-gradient border-0",{"cursor-not-allowed":!C.trim()}),onClick:()=>{!c&&C.trim()&&O()},children:c?(0,n.jsx)(x.Z,{spinning:c,indicator:(0,n.jsx)(i.Z,{className:"text-white"})}):o("sent")})]})})}),ev=r(20046),e_=r(48689),eb=r(14313),ej=r(94155),ey=r(21612),ew=r(85576),eC=r(86250);let{Sider:eN}=ey.default,ek={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8},eZ=e=>{var t,r;let{item:o,refresh:s,historyLoading:i}=e,{t:c}=(0,_.$G)(),d=(0,F.useRouter)(),u=(0,F.useSearchParams)(),p=null!==(t=null==u?void 0:u.get("id"))&&void 0!==t?t:"",x=null!==(r=null==u?void 0:u.get("scene"))&&void 0!==r?r:"",{setCurrentDialogInfo:f}=(0,v.useContext)(l.p),b=(0,v.useMemo)(()=>o.default?o.default&&!p&&!x:o.conv_uid===p&&o.chat_mode===x,[p,x,o]),j=()=>{ew.default.confirm({title:c("delete_chat"),content:c("delete_chat_confirm"),centered:!0,onOk:async()=>{let[e]=await (0,a.Vx)((0,a.MX)(o.conv_uid));e||(await (null==s?void 0:s()),o.conv_uid===p&&d.push("/chat"))}})};return(0,n.jsxs)(eC.Z,{align:"center",className:"group/item w-full h-12 p-3 rounded-lg  hover:bg-white dark:hover:bg-theme-dark cursor-pointer mb-2 relative ".concat(b?"bg-white dark:bg-theme-dark bg-opacity-100":""),onClick:()=>{i||(o.default||null==f||f({chat_scene:o.chat_mode,app_code:o.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:o.chat_mode,app_code:o.app_code})),d.push(o.default?"/chat":"?scene=".concat(o.chat_mode,"&id=").concat(o.conv_uid)))},children:[(0,n.jsx)(Q.Z,{title:o.chat_mode,children:(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-3 bg-white",children:o.icon})}),(0,n.jsx)("div",{className:"flex flex-1 line-clamp-1",children:(0,n.jsx)(h.Z.Text,{ellipsis:{tooltip:!0},children:o.label})}),!o.default&&(0,n.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,n.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation()},children:(0,n.jsx)(ev.Z,{style:{fontSize:16},onClick:()=>{let e=g()("".concat(location.origin,"/chat?scene=").concat(o.chat_mode,"&id=").concat(o.conv_uid));m.ZP[e?"success":"error"](e?c("copy_success"):c("copy_failed"))}})}),(0,n.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation(),j()},children:(0,n.jsx)(e_.Z,{style:{fontSize:16}})})]}),(0,n.jsx)("div",{className:" w-1 rounded-sm bg-[#0c75fc] absolute top-1/2 left-0 -translate-y-1/2 transition-all duration-500 ease-in-out ".concat(b?"h-5":"w-0 h-0")})]})};var eS=e=>{var t;let{dialogueList:r=[],refresh:a,historyLoading:o,listLoading:s,order:i}=e,c=(0,F.useSearchParams)(),d=null!==(t=null==c?void 0:c.get("scene"))&&void 0!==t?t:"",{t:u}=(0,_.$G)(),{mode:m}=(0,v.useContext)(l.p),[p,h]=(0,v.useState)("chat_dashboard"===d),f=(0,v.useMemo)(()=>p?{...ek,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...ek,borderLeft:"1px solid #d6d8da"},[p]),g=(0,v.useMemo)(()=>{let e=r[1]||[];return(null==e?void 0:e.length)>0?e.map(e=>({...e,label:e.user_input||e.select_param,key:e.conv_uid,icon:(0,n.jsx)(j.Z,{scene:e.chat_mode}),default:!1})):[]},[r]);return(0,n.jsx)(eN,{className:"bg-[#ffffff80]  border-r  border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:m,width:280,collapsible:!0,collapsed:p,collapsedWidth:0,trigger:p?(0,n.jsx)(eb.Z,{className:"text-base"}):(0,n.jsx)(ej.Z,{className:"text-base"}),zeroWidthTriggerStyle:f,onCollapse:e=>h(e),children:(0,n.jsxs)("div",{className:"flex flex-col h-full w-full bg-transparent px-4 pt-6  ",children:[(0,n.jsx)("div",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] mb-4 line-clamp-1",children:u("dialog_list")}),(0,n.jsxs)(eC.Z,{flex:1,vertical:!0,className:"overflow-y-auto",children:[(0,n.jsx)(eZ,{item:{label:u("assistant"),key:"default",icon:(0,n.jsx)(I(),{src:"/LOGO_SMALL.png",alt:"default",width:24,height:24,className:"flex-1"}),default:!0},order:i}),(0,n.jsx)(x.Z,{spinning:s,className:"mt-2",children:!!(null==g?void 0:g.length)&&g.map(e=>(0,n.jsx)(eZ,{item:e,refresh:a,historyLoading:o,order:i},null==e?void 0:e.key))})]})]})})};let eP=Z()(()=>Promise.all([r.e(7034),r.e(6106),r.e(8674),r.e(3166),r.e(2837),r.e(2168),r.e(8163),r.e(4567),r.e(9773),r.e(4035),r.e(1154),r.e(3764),r.e(5e3),r.e(3768),r.e(4434),r.e(2800)]).then(r.bind(r,96307)),{loadableGenerated:{webpack:()=>[96307]},ssr:!1}),eR=Z()(()=>Promise.all([r.e(7034),r.e(6106),r.e(8674),r.e(3166),r.e(2837),r.e(2168),r.e(8163),r.e(1265),r.e(7728),r.e(4567),r.e(2398),r.e(9773),r.e(4035),r.e(1154),r.e(2510),r.e(3345),r.e(9202),r.e(5265),r.e(2640),r.e(3764),r.e(5e3),r.e(4019),r.e(3768),r.e(5789),r.e(3913),r.e(4434),r.e(8624)]).then(r.bind(r,8334)),{loadableGenerated:{webpack:()=>[8334]},ssr:!1}),{Content:eE}=ey.default,eO=(0,v.createContext)({history:[],replyLoading:!1,scrollRef:{current:null},canAbort:!1,chartsData:[],agent:"",currentDialogue:{},appInfo:{},temperatureValue:.5,maxNewTokensValue:1024,resourceValue:{},modelValue:"",setModelValue:()=>{},setResourceValue:()=>{},setTemperatureValue:()=>{},setMaxNewTokensValue:()=>{},setAppInfo:()=>{},setAgent:()=>{},setCanAbort:()=>{},setReplyLoading:()=>{},refreshDialogList:()=>{},refreshHistory:()=>{},refreshAppInfo:()=>{},setHistory:()=>{},handleChat:()=>Promise.resolve()});var eM=()=>{var e,t,r,i;let{model:c,currentDialogInfo:d}=(0,v.useContext)(l.p),{isContract:u,setIsContract:m,setIsMenuExpand:p}=(0,v.useContext)(l.p),{chat:h,ctrl:f}=(0,s.Z)({app_code:d.app_code||""}),g=(0,F.useSearchParams)(),_=null!==(e=null==g?void 0:g.get("id"))&&void 0!==e?e:"",j=null!==(t=null==g?void 0:g.get("scene"))&&void 0!==t?t:"",y=null!==(r=null==g?void 0:g.get("knowledge_id"))&&void 0!==r?r:"",w=null!==(i=null==g?void 0:g.get("db_name"))&&void 0!==i?i:"",C=(0,v.useRef)(null),N=(0,v.useRef)(1),k=(0,v.useRef)(null),Z=(0,v.useRef)(void 0),[S,R]=(0,v.useState)([]),[E]=(0,v.useState)(),[O,M]=(0,v.useState)(!1),[T,I]=(0,v.useState)(!1),[V,L]=(0,v.useState)(""),[D,H]=(0,v.useState)({}),[G,A]=(0,v.useState)(),[U,B]=(0,v.useState)(),[J,W]=(0,v.useState)(),[$,K]=(0,v.useState)("");(0,v.useEffect)(()=>{var e,t,r,n,l,a,o,s;A((null===(e=null==D?void 0:null===(t=D.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type)[0])||void 0===e?void 0:e.value)||.6),B((null===(r=null==D?void 0:null===(n=D.param_need)||void 0===n?void 0:n.filter(e=>"max_new_tokens"===e.type)[0])||void 0===r?void 0:r.value)||4e3),K((null===(l=null==D?void 0:null===(a=D.param_need)||void 0===a?void 0:a.filter(e=>"model"===e.type)[0])||void 0===l?void 0:l.value)||c),W(y||w||(null===(o=null==D?void 0:null===(s=D.param_need)||void 0===s?void 0:s.filter(e=>"resource"===e.type)[0])||void 0===o?void 0:o.bind_value))},[D,w,y,c]),(0,v.useEffect)(()=>{p("chat_dashboard"!==j),_&&j&&m(!1)},[_,j,m,p]);let X=(0,v.useMemo)(()=>!_&&!j,[_,j]),{data:Y=[],refresh:Q,loading:ee}=(0,b.Z)(async()=>await (0,a.Vx)((0,a.iP)())),{run:et,refresh:er}=(0,b.Z)(async()=>await (0,a.Vx)((0,a.BN)({...d})),{manual:!0,onSuccess:e=>{let[,t]=e;H(t||{})}}),en=(0,v.useMemo)(()=>{let[,e]=Y;return(null==e?void 0:e.find(e=>e.conv_uid===_))||{}},[_,Y]);(0,v.useEffect)(()=>{let e=(0,z.a_)();d.chat_scene!==j||X||e&&e.message||et()},[_,d,X,et,j]);let{run:el,loading:ea,refresh:eo}=(0,b.Z)(async()=>await (0,a.Vx)((0,a.$i)(_)),{manual:!0,onSuccess:e=>{let[,t]=e,r=null==t?void 0:t.filter(e=>"view"===e.role);r&&r.length>0&&(N.current=r[r.length-1].order+1),R(t||[])}}),es=(0,v.useCallback)((e,t)=>new Promise(r=>{let n=(0,z.a_)(),l=new AbortController;if(M(!0),S&&S.length>0){var a,o;let e=null==S?void 0:S.filter(e=>"view"===e.role),t=null==S?void 0:S.filter(e=>"human"===e.role);N.current=((null===(a=e[e.length-1])||void 0===a?void 0:a.order)||(null===(o=t[t.length-1])||void 0===o?void 0:o.order))+1}let s="";if("string"==typeof e)s=e;else{let t=e.content||[],r=t.filter(e=>"text"===e.type),n=t.filter(e=>"text"!==e.type);r.length>0&&(s=r.map(e=>e.text).join(" "));let l=n.map(e=>{if("image_url"===e.type){var t,r;let n=(null===(t=e.image_url)||void 0===t?void 0:t.url)||"",l=(0,z.Hb)(n),a=(null===(r=e.image_url)||void 0===r?void 0:r.fileName)||"image";return"\n![".concat(a,"](").concat(l,")")}if("video"!==e.type)return"\n[".concat(e.type," attachment]");{let t=e.video||"",r=(0,z.Hb)(t);return"\n[Video](".concat(r,")")}}).join("\n");l&&(s=s+"\n"+l)}let i=[...n&&n.id===_?[]:S,{role:"human",context:s,model_name:(null==t?void 0:t.model_name)||$,order:N.current,time_stamp:0},{role:"view",context:"",model_name:(null==t?void 0:t.model_name)||$,order:N.current,time_stamp:0,thinking:!0}],c=i.length-1;R([...i]);let d={chat_mode:j,model_name:$,user_input:e};if(t&&Object.assign(d,t),"chat_dashboard"!==j){let e=Z.current||localStorage.getItem("dbgpt_prompt_code_".concat(_));e&&(d.prompt_code=e,localStorage.removeItem("dbgpt_prompt_code_".concat(_)))}h({data:d,ctrl:l,chatId:_,onMessage:e=>{I(!0),(null==t?void 0:t.incremental)?(i[c].context+=e,i[c].thinking=!1):(i[c].context=e,i[c].thinking=!1),R([...i])},onDone:()=>{M(!1),I(!1),r()},onClose:()=>{M(!1),I(!1),r()},onError:e=>{M(!1),I(!1),i[c].context=e,i[c].thinking=!1,R([...i]),r()}})}),[_,S,$,h,j]);return(0,em.Z)(async()=>{if(X)return;let e=(0,z.a_)();e&&e.id===_||await el()},[_,j,el]),(0,v.useEffect)(()=>{X&&(N.current=1,R([]))},[X]),(0,n.jsx)(eO.Provider,{value:{history:S,replyLoading:O,scrollRef:C,canAbort:T,chartsData:E||[],agent:V,currentDialogue:en,appInfo:D,temperatureValue:G,maxNewTokensValue:U,resourceValue:J,modelValue:$,setModelValue:K,setResourceValue:W,setTemperatureValue:A,setMaxNewTokensValue:B,setAppInfo:H,setAgent:L,setCanAbort:I,setReplyLoading:M,handleChat:es,refreshDialogList:Q,refreshHistory:eo,refreshAppInfo:er,setHistory:R},children:(0,n.jsx)(eC.Z,{flex:1,children:(0,n.jsxs)(ey.default,{className:"bg-gradient-light bg-cover bg-center dark:bg-gradient-dark",children:[(0,n.jsx)(eS,{refresh:Q,dialogueList:Y,listLoading:ee,historyLoading:ea,order:N}),(0,n.jsxs)(ey.default,{className:"bg-transparent",children:["chat_dashboard"===j?u?(0,n.jsx)(eP,{}):(0,n.jsx)(eR,{}):X?(0,n.jsx)(eE,{children:(0,n.jsx)(q,{})}):(0,n.jsx)(x.Z,{spinning:ea,className:"w-full h-full m-auto",children:(0,n.jsxs)(eE,{className:"flex flex-col h-screen",children:[(0,n.jsx)(P,{ref:C}),(0,n.jsx)(eg,{ref:k,ctrl:f})]})}),(0,n.jsx)(o.Z,{submit:e=>{if(console.log("Selected prompt:",e),"chat_dashboard"===j)localStorage.setItem("dbgpt_prompt_code_".concat(_),e.prompt_code),console.log("Stored prompt_code for chat_dashboard:",e.prompt_code);else{var t,r;null===(t=k.current)||void 0===t||null===(r=t.setUserInput)||void 0===r||r.call(t,e.content),Z.current=e.prompt_code,localStorage.setItem("dbgpt_prompt_code_".concat(_),e.prompt_code),console.log("Filled input and stored prompt_code:",e.prompt_code)}},chat_scene:j})]})]})})})}},30119:function(e,t,r){"use strict";r.d(t,{Tk:function(){return d},PR:function(){return u}});var n,l=r(62418),a=r(45360);r(96486);var o=r(87066),s=r(83454);let i=o.default.create({baseURL:null!==(n=s.env.API_BASE_URL)&&void 0!==n?n:""});i.defaults.timeout=1e4,i.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let c={"content-type":"application/json","User-Id":(0,l.n5)()},d=(e,t)=>{if(t){let r=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");r&&(e+="?".concat(r))}return i.get("/api"+e,{headers:c}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},u=(e,t)=>i.post(e,t,{headers:c}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},11873:function(){}}]);