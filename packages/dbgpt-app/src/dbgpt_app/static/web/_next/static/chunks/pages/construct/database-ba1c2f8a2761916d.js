(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{25606:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return t(65064)}])},45247:function(e,a,t){"use strict";var l=t(85893),s=t(50888);a.Z=function(e){let{visible:a}=e;return a?(0,l.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,l.jsx)(s.Z,{})}):null}},1771:function(e,a,t){"use strict";var l=t(85893),s=t(82353),n=t(41156),r=t(9641),i=t(16165),d=t(9020),c=t(92962),o=t(38545),m=t(50067),u=t(28459),x=t(92398),p=t(36609),b=t(11163);t(67294),t(53878),a.Z=function(e){let{children:a}=e,t=[{key:"app",name:(0,p.t)("App"),path:"/app",icon:(0,l.jsx)(n.Z,{})},{key:"flow",name:(0,p.t)("awel_flow"),icon:(0,l.jsx)(r.Z,{}),path:"/flow"},{key:"models",name:(0,p.t)("model_manage"),path:"/models",icon:(0,l.jsx)(i.Z,{component:s.IN})},{key:"database",name:(0,p.t)("Database"),icon:(0,l.jsx)(d.Z,{}),path:"/database"},{key:"knowledge",name:(0,p.t)("Knowledge_Space"),icon:(0,l.jsx)(c.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,p.t)("Prompt"),icon:(0,l.jsx)(o.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,p.t)("dbgpts_community"),path:"/dbgpts",icon:(0,l.jsx)(m.Z,{})}],h=(0,b.useRouter)(),f=h.pathname.split("/")[2];return(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsx)(u.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)(x.Z,{activeKey:f,items:t.map(e=>({key:e.key,label:e.name,children:a,icon:e.icon})),onTabClick:e=>{h.push("/construct/".concat(e))}})})})}},65064:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return M},isFileDb:function(){return B}});var l=t(85893),s=t(76212),n=t(66309),r=t(55241),i=t(83062),d=t(93967),c=t.n(d),o=t(25675),m=t.n(o),u=t(67294),x=(0,u.memo)(function(e){let{icon:a,iconBorder:t=!0,title:s,desc:d,tags:o,children:x,disabled:p,operations:b,className:h,extraContent:f,...j}=e,y=(0,u.useMemo)(()=>a?"string"==typeof a?(0,l.jsx)(m(),{className:c()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":t}),width:48,height:48,src:a,alt:s}):a:null,[a]),_=(0,u.useMemo)(()=>o&&o.length?(0,l.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:o.map((e,a)=>{var t;return"string"==typeof e?(0,l.jsx)(n.Z,{className:"text-xs",bordered:!1,color:"default",children:e},a):(0,l.jsx)(n.Z,{className:"text-xs",bordered:null!==(t=e.border)&&void 0!==t&&t,color:e.color,children:e.text},a)})}):null,[o]);return(0,l.jsxs)("div",{className:c()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":p,"cursor-pointer":!p&&!!j.onClick},h),...j,children:[(0,l.jsxs)("div",{className:"p-4 0",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[y,(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)(r.Z,{title:s,children:(0,l.jsx)("h2",{className:"text-sm font-semibold line-clamp-1 pr-8",children:s})}),_]})]}),d&&(0,l.jsx)(i.Z,{title:d,children:(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:d})})]}),(0,l.jsxs)("div",{children:[x,b&&!!b.length&&(0,l.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:b.map((e,a)=>(0,l.jsx)(i.Z,{title:e.label,children:(0,l.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:a=>{var t;a.stopPropagation(),null===(t=e.onClick)||void 0===t||t.call(e)},children:[e.children,a<b.length-1&&(0,l.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(a)))})]}),(0,l.jsx)("div",{className:"absolute top-2 right-4 ",children:f})]})}),p=t(45247),b=t(85980),h=t(99859),f=t(45360),j=t(85576),y=t(34041),_=t(74330),g=t(25278),v=t(13457),N=t(14726),w=t(67421),Z=function(e){let{open:a,choiceDBType:t,dbTypeList:n,editValue:r,dbNames:d,onClose:c,onSuccess:o}=e,[m,x]=(0,u.useState)(!1),{t:p}=(0,w.$G)(),[Z]=h.default.useForm(),k=h.default.useWatch("db_type",Z),[P,S]=(0,u.useState)([]),[C,F]=(0,u.useState)(!1),V=(0,u.useMemo)(()=>B(n,k),[n,k]);(0,u.useEffect)(()=>{t&&Z.setFieldValue("db_type",t)},[t]),(0,u.useEffect)(()=>{r&&(Z.setFieldsValue({...r}),"omc"===r.db_type&&Z.setFieldValue("db_arn",r.db_path))},[r]),(0,u.useEffect)(()=>{a||Z.resetFields()},[a]);let E=async e=>{let{db_host:a,db_path:t,db_port:l,db_type:n,...i}=e;if(x(!0),"omc"===n){let a=null==P?void 0:P.find(a=>a.arn===e.db_name);try{let[t]=await (0,s.Vx)((0,s.Jm)({db_type:"omc",file_path:e.db_arn||"",comment:e.comment,db_name:(null==a?void 0:a.dbName)||e.db_name}));if(t){f.ZP.error(t.message);return}f.ZP.success("success"),null==o||o()}catch(e){f.ZP.error(e.message)}finally{x(!1)}}if(!r&&d.some(e=>e===i.db_name)){f.ZP.error("The database already exists!");return}let c={db_host:V?void 0:a,db_port:V?void 0:l,db_type:n,file_path:V?t:void 0,...i};try{let[e]=await (0,s.Vx)((0,s.KS)(c));if(e)return;let[a]=await (0,s.Vx)((r?s.mR:s.b_)(c));if(a){f.ZP.error(a.message);return}f.ZP.success("success"),null==o||o()}catch(e){f.ZP.error(e.message)}finally{x(!1)}},{run:T}=(0,b.Z)(async e=>{F(!0);let[a,t=[]]=await (0,s.Vx)((0,s.bf)(e));F(!1),S(t.map(e=>({...e,label:e.dbName,value:e.arn})))},{wait:500}),I=(0,u.useMemo)(()=>!!r||!!t,[r,t]);return(0,l.jsx)(j.default,{open:a,width:800,title:p(r?"Edit":"create_database"),maskClosable:!1,footer:null,onCancel:c,children:(0,l.jsxs)(h.default,{form:Z,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:E,children:[(0,l.jsx)(h.default.Item,{name:"db_type",label:"DB Type",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(y.default,{"aria-readonly":I,disabled:I,options:n})}),"omc"===Z.getFieldValue("db_type")?(0,l.jsx)(h.default.Item,{name:"db_name",label:"DB Name",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(y.default,{optionRender:(e,a)=>{let{index:t}=a,s=P[t];return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"text-[18px]",children:null==s?void 0:s.dbName}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"env: "}),(0,l.jsx)("span",{className:"text-gray-500",children:s.env})]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"account: "}),(0,l.jsx)("span",{className:"text-gray-500",children:s.account})]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{children:"searchName: "}),(0,l.jsx)(i.Z,{title:s.searchName,children:(0,l.jsx)("span",{className:"text-gray-500",children:s.searchName})})]})]},e.value)},notFoundContent:C?(0,l.jsx)(_.Z,{size:"small"}):null,showSearch:!0,options:P,onSearch:T,onSelect:e=>{let a=null==P?void 0:P.find(a=>a.value===e);Z.setFieldsValue({db_arn:null==a?void 0:a.arn})}})}):(0,l.jsx)(h.default.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,l.jsx)(g.default,{readOnly:!!r,disabled:!!r})}),!0===V&&(0,l.jsx)(h.default.Item,{name:"db_path",label:"Path",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(g.default,{})}),!1===V&&"omc"!==Z.getFieldValue("db_type")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.default.Item,{name:"db_user",label:"Username",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(g.default,{})}),(0,l.jsx)(h.default.Item,{name:"db_pwd",label:"Password",className:"mb-6",rules:[{required:!1}],children:(0,l.jsx)(g.default,{type:"password"})}),(0,l.jsx)(h.default.Item,{name:"db_host",label:"Host",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(g.default,{})}),(0,l.jsx)(h.default.Item,{name:"db_port",label:"Port",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(v.Z,{min:1,step:1,max:65535})})]}),"omc"===Z.getFieldValue("db_type")&&(0,l.jsx)(h.default.Item,{name:"db_arn",label:"Arn",className:"mb-6",rules:[{required:!0}],children:(0,l.jsx)(g.default,{})}),(0,l.jsx)(h.default.Item,{name:"comment",label:"Remark",className:"mb-6",children:(0,l.jsx)(g.default,{})}),(0,l.jsxs)(h.default.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,l.jsx)(N.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:m,children:"Save"}),(0,l.jsx)(N.ZP,{size:"middle",onClick:c,children:"Cancel"})]})]})})},k=t(1771),P=t(62418),S=t(24969),C=t(87740),F=t(36531),V=t(27704),E=t(2093),T=t(40411),I=t(85265),D=t(4393),q=t(32983);function B(e,a){var t;return null===(t=e.find(e=>e.value===a))||void 0===t?void 0:t.isFileDb}var M=function(){let{t:e}=(0,w.$G)(),[a,t]=(0,u.useState)([]),[n,r]=(0,u.useState)([]),[i,d]=(0,u.useState)(!1),[c,o]=(0,u.useState)({open:!1}),[m,b]=(0,u.useState)({open:!1}),[h,y]=(0,u.useState)(!1),g=async()=>{let[,e]=await (0,s.Vx)((0,s.t$)());r(null!=e?e:[])},v=async()=>{d(!0);let[,e]=await (0,s.Vx)((0,s.Bw)());t(null!=e?e:[]),d(!1)},B=(0,u.useMemo)(()=>{let e=n.map(e=>{let{db_type:a,is_file_db:t}=e;return{...P.S$[a],value:a,isFileDb:t}}),a=Object.keys(P.S$).filter(a=>!e.some(e=>e.value===a)).map(e=>({...P.S$[e],value:P.S$[e].label,disabled:!0}));return[...e,...a]},[n]),M=e=>{o({open:!0,info:e})},$=e=>{j.default.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise((a,t)=>{A(e.db_name,a,t)})})},A=async(e,a,t)=>{try{let[l]=await (0,s.Vx)((0,s.J5)(e));if(l){f.ZP.error(l.message),t();return}f.ZP.success("success"),v(),a()}catch(e){t()}},O=(0,u.useMemo)(()=>{let e=B.reduce((e,t)=>(e[t.value]=a.filter(e=>e.db_type===t.value),e),{});return e},[a,B]);(0,E.Z)(async()=>{await v(),await g()},[]);let R=e=>{let t=a.filter(a=>a.db_type===e.value);b({open:!0,dbList:t,name:e.label,type:e.value})},z=async a=>{y(!0);let[,t]=await (0,s.Vx)((0,s.yx)({db_name:a.db_name,db_type:a.db_type}));t&&f.ZP.success(e("refreshSuccess")),y(!1)};return(0,l.jsx)(k.Z,{children:(0,l.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,l.jsx)(p.Z,{visible:i}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("div",{className:"flex items-center gap-4"}),(0,l.jsx)("div",{className:"flex items-center gap-4",children:(0,l.jsx)(N.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{o({open:!0})},children:e("Add_Datasource")})})]}),(0,l.jsx)("div",{className:"flex flex-wrap mx-[-8px] gap-2 md:gap-4",children:B.map(e=>{var a,t;return(0,l.jsx)(T.Z,{count:null===(a=O[e.value])||void 0===a?void 0:a.length,className:"min-h-fit",children:(0,l.jsx)(x,{className:"h-full",title:e.label,desc:null!==(t=e.desc)&&void 0!==t?t:"",disabled:e.disabled,icon:e.icon,onClick:()=>{e.disabled||R(e)}})},e.value)})}),(0,l.jsx)(Z,{open:c.open,dbTypeList:B,choiceDBType:c.dbType,editValue:c.info,dbNames:a.map(e=>e.db_name),onSuccess:()=>{o({open:!1}),v()},onClose:()=>{o({open:!1})}}),(0,l.jsx)(I.Z,{title:m.name,placement:"right",onClose:()=>{b({open:!1})},open:m.open,children:m.type&&O[m.type]&&O[m.type].length?(0,l.jsxs)(_.Z,{spinning:h,children:[(0,l.jsx)(N.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{o({open:!0,dbType:m.type})},children:"Create"}),O[m.type].map(e=>(0,l.jsxs)(D.Z,{title:e.db_name,extra:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.Z,{className:"mr-2",style:{color:"gray"},onClick:()=>{z(e)}}),(0,l.jsx)(F.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{M(e)}}),(0,l.jsx)(V.Z,{style:{color:"#ff1b2e"},onClick:()=>{$(e)}})]}),className:"mb-4",children:[e.db_path?(0,l.jsxs)("p",{children:["path: ",e.db_path]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["host: ",e.db_host]}),(0,l.jsxs)("p",{children:["username: ",e.db_user]}),(0,l.jsxs)("p",{children:["port: ",e.db_port]})]}),(0,l.jsxs)("p",{children:["remark: ",e.comment]})]},e.db_name))]}):(0,l.jsx)(q.Z,{image:q.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(N.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(S.Z,{}),onClick:()=>{o({open:!0,dbType:m.type})},children:"Create Now"})})})]})})}},53878:function(){}},function(e){e.O(0,[2913,3791,5278,8791,4330,4041,2398,9859,3457,5717,4393,1730,9774,2888,179],function(){return e(e.s=25606)}),_N_E=e.O()}]);