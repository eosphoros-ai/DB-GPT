(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{27704:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var l=t(87462),s=t(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"},r=t(13401),i=s.forwardRef(function(e,a){return s.createElement(r.Z,(0,l.Z)({},e,{ref:a,icon:n}))})},36531:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var l=t(87462),s=t(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},r=t(13401),i=s.forwardRef(function(e,a){return s.createElement(r.Z,(0,l.Z)({},e,{ref:a,icon:n}))})},87740:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var l=t(87462),s=t(67294),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},r=t(13401),i=s.forwardRef(function(e,a){return s.createElement(r.Z,(0,l.Z)({},e,{ref:a,icon:n}))})},2093:function(e,a,t){"use strict";var l=t(97582),s=t(67294),n=t(92770);a.Z=function(e,a){(0,s.useEffect)(function(){var a=e(),t=!1;return!function(){(0,l.mG)(this,void 0,void 0,function(){return(0,l.Jh)(this,function(e){switch(e.label){case 0:if(!(0,n.mf)(a[Symbol.asyncIterator]))return[3,4];e.label=1;case 1:return[4,a.next()];case 2:if(e.sent().done||t)return[3,3];return[3,1];case 3:return[3,6];case 4:return[4,a];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(),function(){t=!0}},a)}},25606:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return t(22314)}])},98198:function(e,a,t){"use strict";t.d(a,{Z:function(){return u}});var l=t(85893),s=t(34041),n=t(25278),r=t(13457),i=t(84567),o=t(99859),c=t(67294),d=e=>{let{parentName:a,fields:t,form:d}=e,[u,m]=(0,c.useState)(null);(0,c.useEffect)(()=>{let e=d.getFieldValue(a);(null==e?void 0:e.type)&&!u&&m(e.type)},[d,a]);let p=e=>{let t;let c=e.param_type.toLowerCase(),d=[a,e.param_name];return t="str"===c||"string"===c?e.valid_values?(0,l.jsx)(s.default,{children:e.valid_values.map(e=>(0,l.jsx)(s.default.Option,{value:e,children:e},e))}):(0,l.jsx)(n.default,{}):"int"===c||"integer"===c||"number"===c||"float"===c?(0,l.jsx)(r.Z,{className:"w-full"}):"bool"===c||"boolean"===c?(0,l.jsx)(i.Z,{}):(0,l.jsx)(n.default,{}),(0,l.jsx)(o.default.Item,{label:e.label||e.param_name,name:d,valuePropName:"bool"===c||"boolean"===c?"checked":"value",tooltip:e.description,rules:u&&e.required?[{required:!0,message:"Please input ".concat(e.param_name)}]:[],children:t},e.param_name)};return(0,l.jsxs)("div",{className:"space-y-4 border rounded-md p-4",children:[(0,l.jsx)(o.default.Item,{label:"Type",name:[a,"type"],children:(0,l.jsx)(s.default,{onChange:e=>{m(e);let l=t[e]||[],s={type:e};l.forEach(e=>{s[e.param_name]=e.default_value}),d.setFieldsValue({[a]:s})},placeholder:"Select a type",children:Object.keys(t).map(e=>(0,l.jsx)(s.default.Option,{value:e,children:e},e))})}),u&&t[u]&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("h4",{className:"mb-4 text-base font-medium",children:[u," Configuration"]}),(0,l.jsx)("div",{className:"space-y-4",children:t[u].map(e=>p(e))})]})]})},u=function(e){let{params:a,form:t}=e;if((0,c.useEffect)(()=>{if(a){let e={};a.forEach(a=>{if(!a.nested_fields){let l=t.getFieldValue(a.param_name);void 0===l&&(e[a.param_name]=a.default_value)}}),t.setFieldsValue(e)}},[a,t]),!a||(null==a?void 0:a.length)<1)return null;let u=e=>{let t={...e};return null==a||a.forEach(e=>{if(e.nested_fields&&t[e.param_name]){let a=t[e.param_name];if(a.type){let l=e.nested_fields[a.type]||[],s={};l.forEach(e=>{void 0!==a[e.param_name]&&(s[e.param_name]=a[e.param_name])}),t[e.param_name]={type:a.type,...s}}}}),t},m=t.submit;return t.submit=()=>{let e=t.getFieldsValue(),a=u(e);t.setFieldsValue(a),m.call(t)},(0,l.jsx)("div",{className:"space-y-4",children:null==a?void 0:a.map(e=>(0,l.jsx)(o.default.Item,{label:(0,l.jsx)("p",{className:"whitespace-normal overflow-wrap-break-word",children:e.label||e.param_name}),name:e.param_name,initialValue:e.default_value,valuePropName:"bool"===e.param_type.toLowerCase()||"boolean"===e.param_type.toLowerCase()?"checked":"value",tooltip:e.description,rules:e.required?[{required:!0,message:"Please input ".concat(e.param_name)}]:[],children:function(e){var a,o,c,u;if(e.nested_fields)return(0,l.jsx)(d,{parentName:e.param_name,fields:e.nested_fields,form:t});let m=e.param_type.toLowerCase(),p=null===(a=e.ext_metadata)||void 0===a?void 0:null===(o=a.tags)||void 0===o?void 0:o.includes("fixed"),f=null===(c=e.ext_metadata)||void 0===c?void 0:null===(u=c.tags)||void 0===u?void 0:u.includes("privacy");return"str"===m||"string"===m?e.valid_values?(0,l.jsx)(s.default,{disabled:p,children:e.valid_values.map(e=>(0,l.jsx)(s.default.Option,{value:e,children:e},e))}):f?(0,l.jsx)(n.default.Password,{disabled:p,autoComplete:"new-password",placeholder:"请输入密码"}):(0,l.jsx)(n.default,{disabled:p}):"int"===m||"integer"===m||"number"===m||"float"===m?(0,l.jsx)(r.Z,{className:"w-full",disabled:p}):"bool"===m||"boolean"===m?(0,l.jsx)(i.Z,{disabled:p}):(0,l.jsx)(n.default,{disabled:p})}(e)},e.param_name))})}},45247:function(e,a,t){"use strict";var l=t(85893),s=t(50888);a.Z=function(e){let{visible:a}=e;return a?(0,l.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,l.jsx)(s.Z,{})}):null}},1771:function(e,a,t){"use strict";var l=t(85893),s=t(82353),n=t(41156),r=t(9641),i=t(16165),o=t(9020),c=t(92962),d=t(38545),u=t(50067),m=t(28459),p=t(92398),f=t(36609),h=t(11163);t(67294),t(53878),a.Z=function(e){let{children:a}=e,t=[{key:"app",name:(0,f.t)("App"),path:"/app",icon:(0,l.jsx)(n.Z,{})},{key:"flow",name:(0,f.t)("awel_flow"),icon:(0,l.jsx)(r.Z,{}),path:"/flow"},{key:"models",name:(0,f.t)("model_manage"),path:"/models",icon:(0,l.jsx)(i.Z,{component:s.IN})},{key:"database",name:(0,f.t)("Database"),icon:(0,l.jsx)(o.Z,{}),path:"/database"},{key:"knowledge",name:(0,f.t)("Knowledge_Space"),icon:(0,l.jsx)(c.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,f.t)("Prompt"),icon:(0,l.jsx)(d.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,f.t)("dbgpts_community"),path:"/dbgpts",icon:(0,l.jsx)(u.Z,{})}],x=(0,h.useRouter)(),b=x.pathname.split("/")[2];return(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsx)(m.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)(p.Z,{activeKey:b,items:t.map(e=>({key:e.key,label:e.name,children:a,icon:e.icon})),onTabClick:e=>{x.push("/construct/".concat(e))}})})})}},22314:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return I},isFileDb:function(){return R}});var l=t(85893),s=t(76212),n=t(66309),r=t(55241),i=t(83062),o=t(93967),c=t.n(o),d=t(25675),u=t.n(d),m=t(67294),p=(0,m.memo)(function(e){let{icon:a,iconBorder:t=!0,title:s,desc:o,tags:d,children:p,disabled:f,operations:h,className:x,extraContent:b,...v}=e,y=(0,m.useMemo)(()=>a?"string"==typeof a?(0,l.jsx)(u(),{className:c()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":t}),width:48,height:48,src:a,alt:s}):a:null,[a]),j=(0,m.useMemo)(()=>d&&d.length?(0,l.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:d.map((e,a)=>{var t;return"string"==typeof e?(0,l.jsx)(n.Z,{className:"text-xs",bordered:!1,color:"default",children:e},a):(0,l.jsx)(n.Z,{className:"text-xs",bordered:null!==(t=e.border)&&void 0!==t&&t,color:e.color,children:e.text},a)})}):null,[d]);return(0,l.jsxs)("div",{className:c()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":f,"cursor-pointer":!f&&!!v.onClick},x),...v,children:[(0,l.jsxs)("div",{className:"p-4 0",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[y,(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)(r.Z,{title:s,children:(0,l.jsx)("h2",{className:"text-sm font-semibold line-clamp-1 pr-8",children:s})}),j]})]}),o&&(0,l.jsx)(i.Z,{title:o,children:(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:o})})]}),(0,l.jsxs)("div",{children:[p,h&&!!h.length&&(0,l.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:h.map((e,a)=>(0,l.jsx)(i.Z,{title:e.label,children:(0,l.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:a=>{var t;a.stopPropagation(),null===(t=e.onClick)||void 0===t||t.call(e)},children:[e.children,a<h.length-1&&(0,l.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(a)))})]}),(0,l.jsx)("div",{className:"absolute top-2 right-4 ",children:b})]})}),f=t(45247),h=t(85576),x=t(67421),b=t(34041),v=t(99859),y=t(45360),j=t(25278),g=t(14726),_=t(98198);let{Option:w}=b.default,Z=v.default.Item;var N=function(e){let{onCancel:a,onSuccess:t,dbTypeList:n,editValue:r,choiceDBType:i,getFromRenderData:o,dbNames:c=[],description:d=""}=e,{t:u}=(0,x.$G)(),[p]=v.default.useForm(),[f,h]=(0,m.useState)(!1),[N,k]=(0,m.useState)(i),[C,S]=(0,m.useState)(o||null);console.log("dbTypeList",n),console.log("editValue",r),console.log("choiceDBType",i),(0,m.useEffect)(()=>{i&&k(i)},[i]),(0,m.useEffect)(()=>{r&&o&&(S(o),p.setFieldValue("description",d))},[r,o,d,p]);let P=async e=>{try{h(!0),console.log("dbNames:",c);let{description:a,type:l,...n}=e,i={type:N,params:n,description:a||""};r&&(i.id=r),console.log("Form submitted:",i);let[o]=await (0,s.Vx)((0,s.KS)(i));if(o)return;let[d]=await (0,s.Vx)((r?s.mR:s.b_)(i));if(d){y.ZP.error(d.message);return}y.ZP.success(u(r?"update_success":"create_success")),null==t||t()}catch(e){console.error("Failed to submit form:",e),y.ZP.error(u(r?"update_failed":"create_failed"))}finally{h(!1)}};return(0,l.jsxs)(v.default,{form:p,layout:"vertical",onFinish:P,initialValues:{type:N},children:[(0,l.jsx)(Z,{label:u("database_type"),name:"type",rules:[{required:!0,message:u("please_select_database_type")}],children:(0,l.jsx)(b.default,{placeholder:u("select_database_type"),onChange:e=>{k(e),p.resetFields(["params"]);let a=n.find(a=>a.value===e);(null==a?void 0:a.parameters)&&S(a.parameters)},disabled:!!r,children:n.map(e=>(0,l.jsx)(w,{value:e.value,disabled:e.disabled,children:e.label},e.value))})}),C&&(0,l.jsx)(_.Z,{params:C,form:p}),(0,l.jsx)(Z,{label:u("description"),name:"description",children:(0,l.jsx)(j.default.TextArea,{rows:2,placeholder:u("input_description")})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,l.jsx)(g.ZP,{onClick:a,children:u("cancel")}),(0,l.jsx)(g.ZP,{type:"primary",htmlType:"submit",loading:f,children:u("submit")})]})]})},k=function(e){let{open:a,onClose:t,onSuccess:s,dbTypeList:n,editValue:r,choiceDBType:i,getFromRenderData:o,dbNames:c,description:d}=e,{t:u}=(0,x.$G)();return(0,l.jsx)(h.default,{title:u(r?"edit_database":"add_database"),open:a,onCancel:t,footer:null,width:800,destroyOnClose:!0,children:(0,l.jsx)(N,{onCancel:t,onSuccess:s,dbTypeList:n,editValue:r,choiceDBType:i,getFromRenderData:o,dbNames:c,description:d})})},C=t(1771),S=t(62418),P=t(24969),E=t(87740),T=t(36531),F=t(27704),V=t(2093),D=t(40411),L=t(85265),O=t(74330),B=t(4393),M=t(32983);function R(e,a){var t;return null===(t=e.find(e=>e.value===a))||void 0===t?void 0:t.isFileDb}let $=[];var I=function(){let{t:e}=(0,x.$G)(),[a,t]=(0,m.useState)([]),[n,r]=(0,m.useState)([]),[i,o]=(0,m.useState)(!1),[c,d]=(0,m.useState)({open:!1}),[u,b]=(0,m.useState)({open:!1}),[v,j]=(0,m.useState)(!1),_=async()=>{var e;let[,a]=await (0,s.Vx)((0,s.t$)());r(null!==(e=null==a?void 0:a.types)&&void 0!==e?e:[])},w=async()=>{o(!0);let[,e]=await (0,s.Vx)((0,s.Bw)());t(null!=e?e:[]),o(!1)},Z=(0,m.useMemo)(()=>{let e=n.map(e=>{let a=null==e?void 0:e.name;return{...S.S$[a],value:a,isFileDb:!0,parameters:e.parameters}}),a=Object.keys(S.S$).filter(a=>!e.some(e=>e.value===a)).map(e=>({...S.S$[e],value:S.S$[e].label,disabled:!0}));return[...e,...a]},[n]),N=e=>{for(let a=0;a<$.length;a++){let t=$[a];e.params[t.param_name]&&(t.default_value=e.params[t.param_name])}d({open:!0,info:e.id,dbType:e.type,description:e.description})},R=e=>{h.default.confirm({title:"Tips",content:"Do you Want to delete the database connection?",onOk:()=>new Promise((a,t)=>{I(e.id,a,t)})})},I=async(e,a,t)=>{try{let[l]=await (0,s.Vx)((0,s.J5)(e));if(l){y.ZP.error(l.message),t();return}y.ZP.success("success"),w(),a()}catch(e){t()}},z=(0,m.useMemo)(()=>{let e=Z.reduce((e,t)=>(e[t.value]=a.filter(e=>(null==e?void 0:e.type.toLowerCase())===t.value.toLowerCase()),e),{});return e},[a,Z]);(0,V.Z)(async()=>{await w(),await _()},[]);let H=e=>{let t=a.filter(a=>a.type===e.value);$=null==e?void 0:e.parameters,b({open:!0,dbList:t,name:e.label,type:e.value})},q=async a=>{j(!0);let[,t]=await (0,s.Vx)((0,s.yx)({id:a.id}));t&&y.ZP.success(e("refreshSuccess")),j(!1)},A=e=>{if(!e)return"";let a=e.split(/[/\\]/);return a[a.length-1]};return(0,l.jsx)(C.Z,{children:(0,l.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,l.jsx)(f.Z,{visible:i}),(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("div",{className:"flex items-center gap-4"}),(0,l.jsx)("div",{className:"flex items-center gap-4",children:(0,l.jsx)(g.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,l.jsx)(P.Z,{}),onClick:()=>{console.log(a),console.log(Z),d({open:!0,dbTypeData:Z})},children:e("Add_Datasource")})})]}),(0,l.jsx)("div",{className:"flex flex-wrap mx-[-8px] gap-2 md:gap-4",children:Z.map(e=>{var a,t;return(0,l.jsx)(D.Z,{count:null===(a=z[e.value])||void 0===a?void 0:a.length,className:"min-h-fit",children:(0,l.jsx)(p,{className:"h-full",title:e.label,desc:null!==(t=e.desc)&&void 0!==t?t:"",disabled:e.disabled,icon:e.icon,onClick:()=>{e.disabled||H(e)}})},e.value)})}),(0,l.jsx)(k,{open:c.open,dbTypeList:Z,getFromRenderData:$,description:c.description,choiceDBType:c.dbType,editValue:c.info,dbTypeData:c.dbTypeData,dbNames:a.map(e=>e.params.database),onSuccess:()=>{d({open:!1}),w()},onClose:()=>{d({open:!1})}}),(0,l.jsx)(L.Z,{title:u.name,placement:"right",onClose:()=>{b({open:!1})},open:u.open,children:u.type&&z[u.type]&&z[u.type].length?(0,l.jsxs)(O.Z,{spinning:v,children:[(0,l.jsx)(g.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,l.jsx)(P.Z,{}),onClick:()=>{d({open:!0,dbType:u.type})},children:"Create"}),z[u.type].map(a=>{var t,s,n,r;return(0,l.jsxs)(B.Z,{title:(null===(t=a.params)||void 0===t?void 0:t.database)||A(null===(s=a.params)||void 0===s?void 0:s.path)||"",extra:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.Z,{className:"mr-2",style:{color:"gray"},onClick:()=>{q(a)}}),(0,l.jsx)(T.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{N(a)}}),(0,l.jsx)(F.Z,{style:{color:"#ff1b2e"},onClick:()=>{R(a)}})]}),className:"mb-4",children:[(0,l.jsx)(l.Fragment,{children:["host","port","path","user","database","schema"].filter(e=>Object.prototype.hasOwnProperty.call(a.params,e)).map(e=>(0,l.jsxs)("p",{children:[e,": ","path"===e?A(a.params[e]):a.params[e]]},e))}),(0,l.jsxs)("p",{children:[e("description"),": ",a.description]})]},(null===(n=a.params)||void 0===n?void 0:n.database)||(null===(r=a.params)||void 0===r?void 0:r.path)||"")})]}):(0,l.jsx)(M.Z,{image:M.Z.PRESENTED_IMAGE_DEFAULT,children:(0,l.jsx)(g.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,l.jsx)(P.Z,{}),onClick:()=>{d({open:!0,dbType:u.type})},children:"Create Now"})})})]})})}},53878:function(){}},function(e){e.O(0,[2913,3791,5278,8791,4330,7611,2398,3457,9859,5265,5993,4393,9774,2888,179],function(){return e(e.s=25606)}),_N_E=e.O()}]);