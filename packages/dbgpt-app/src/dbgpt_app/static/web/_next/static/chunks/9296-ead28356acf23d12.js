"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9296],{49296:function(e,t,a){a.d(t,{_z:function(){return V},ZP:function(){return B},aG:function(){return z}});var n=a(85893),l=a(41118),i=a(30208),r=a(40911),s=a(67294),c=a(41468),o=a(94666);function d(e){let{chart:t}=e,{mode:a}=(0,s.useContext)(c.p),l=(0,s.useMemo)(()=>{let e=t.values.map(e=>({...e,value:"string"==typeof e.value?parseFloat(e.value)||0:e.value})).sort((e,t)=>t.value-e.value);return{...t,values:e}},[t]),i=e=>{let t=Number(e);return Number.isInteger(t)?t.toString():t.toFixed(2)};return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(o.k,{style:{height:"100%"},options:{autoFit:!0,theme:a,type:"interval",data:l.values,encode:{x:"name",y:"value",color:"type"},axis:{x:{title:!1},y:{labelFormatter:i,title:!1}},tooltip:{items:[{field:"name",name:"名称"},{field:"value",name:"数值",valueFormatter:i}]},scale:{value:{type:"linear"}}}})})]})})}function u(e){let{chart:t}=e,{mode:a}=(0,s.useContext)(c.p),l=(0,s.useMemo)(()=>{let e=t.values.map(e=>({...e,value:"string"==typeof e.value?parseFloat(e.value)||0:e.value}));return{...t,values:e}},[t]);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(o.k,{style:{height:"100%"},options:{autoFit:!0,theme:a,type:"view",data:l.values,children:[{type:"line",encode:{x:"name",y:"value",color:"type",shape:"smooth"}},{type:"area",encode:{x:"name",y:"value",color:"type",shape:"smooth"},legend:!1,style:{fillOpacity:.15}}],axis:{x:{labelAutoRotate:!1,title:!1},y:{title:!1}},scale:{value:{type:"linear"}}}})})]})})}function m(e){let{chart:t}=e,{mode:a}=(0,s.useContext)(c.p),l=(0,s.useMemo)(()=>t.values&&Array.isArray(t.values)?t.values.map(e=>({name:e.name,value:Number(e.value)||0})):[],[t.values]);if(!l.length)return null;let i=l.reduce((e,t)=>e+t.value,0);return(0,n.jsx)("div",{className:"flex-1 min-w-[300px] p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"h-[300px]",children:(0,n.jsx)(o.k,{style:{height:"100%"},options:{autoFit:!0,data:l,theme:a,animate:{enter:{type:"waveIn",duration:500}},children:[{type:"interval",encode:{y:"value",color:"name"},transform:[{type:"stackY"}],coordinate:{type:"theta",outerRadius:.8},style:{lineWidth:1,stroke:"#fff"},state:{active:{style:{lineWidth:2,stroke:"#fff",fillOpacity:.9}}},interaction:{elementHighlightByColor:!0}}],legend:{color:{position:"right",title:!1,itemName:{style:{fill:"dark"===a?"#fff":"#333"}},itemValue:{formatter:e=>{let t=(e/i*100).toFixed(1);return"".concat(t,"%")}}}},tooltip:{format:{value:e=>"".concat(e)}}}})})]})})}var h=a(61685);function p(e){let{chart:t,columnNameMap:a,renderCell:l}=e,{columns:i,dataSource:r}=(0,s.useMemo)(()=>{if(!t.values||0===t.values.length)return{columns:[],dataSource:[]};let e=t.values[0];if("type"in e&&"value"in e&&"name"in e){let e=new Map;t.values.forEach(t=>{e.has(t.name)||e.set(t.name,{name:t.name});let a=e.get(t.name);a[t.type]=t.value});let a=[...new Set(t.values.map(e=>e.type))];return{columns:["name",...a],dataSource:Array.from(e.values())}}return{columns:Object.keys(t.values[0]),dataSource:t.values}},[t]),c=e=>(null==a?void 0:a[e])||e.replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b\w/g,e=>e.toUpperCase()),o=e=>null==e?"-":"number"==typeof e?e>=0&&e<=100?e.toFixed(2):e>=1e3?e.toLocaleString():Number.isInteger(e)?e.toString():e.toFixed(2):String(e);return(0,n.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,n.jsxs)("div",{className:"h-full",children:[(0,n.jsx)("div",{className:"mb-2",children:t.chart_name}),(0,n.jsx)("div",{className:"opacity-80 text-sm mb-2",children:t.chart_desc}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsxs)(h.Z,{"aria-label":"dashboard table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:i.map(e=>(0,n.jsx)("th",{children:c(e)},e))})}),(0,n.jsx)("tbody",{children:r.map((e,t)=>(0,n.jsx)("tr",{children:i.map(t=>(0,n.jsx)("td",{children:l?l(e[t],e,t):o(e[t])},t))},t))})]})})]})})}var v=a(64371),f=a(51046),y=a(34041),x=a(71230),_=a(15746),g=a(42075),j=a(83062),w=a(14726),b=a(32983),C=a(96486);let N=e=>{if(!e)return;let t=e.getContainer(),a=t.getElementsByTagName("canvas")[0];return a};var k=a(64352),S=a(8625);let E=e=>{let{charts:t,scopeOfCharts:a,ruleConfig:n}=e,l={};if(null==t||t.forEach(e=>{if(e.chartKnowledge.toSpec){let t=e.chartKnowledge.toSpec;e.chartKnowledge.toSpec=(e,a)=>({...t(e,a),dataProps:a})}else e.chartKnowledge.toSpec=(e,t)=>({dataProps:t});l[e.chartType]=e.chartKnowledge}),(null==a?void 0:a.exclude)&&a.exclude.forEach(e=>{Object.keys(l).includes(e)&&delete l[e]}),null==a?void 0:a.include){let e=a.include;Object.keys(l).forEach(t=>{e.includes(t)||delete l[t]})}let i={...a,custom:l},r={...n},s=new k.w({ckbCfg:i,ruleCfg:r});return s},O=e=>{var t;let{data:a,dataMetaMap:n,myChartAdvisor:l}=e,i=n?Object.keys(n).map(e=>({name:e,...n[e]})):null,r=new S.Z(a).info(),s=(0,C.size)(r)>2?null==r?void 0:r.filter(e=>"string"!==e.recommendation&&"date"!==e.recommendation||e.distinct&&e.distinct>1):r,c=null==l?void 0:l.adviseWithLog({data:a,dataProps:i,fields:null==s?void 0:s.map(e=>e.name)});return null!==(t=null==c?void 0:c.advices)&&void 0!==t?t:[]};function Z(e,t){return t.every(t=>e.includes(t))}function M(e,t){let a=t.find(t=>t.name===e);return(null==a?void 0:a.recommendation)==="date"?t=>new Date(t[e]):e}function P(e){return e.find(e=>{var t;return e.levelOfMeasurements&&(t=e.levelOfMeasurements,["Time","Ordinal"].some(e=>t.includes(e)))})}function T(e){return e.find(e=>e.levelOfMeasurements&&Z(e.levelOfMeasurements,["Nominal"]))}let F=e=>{let{data:t,xField:a}=e,n=(0,C.uniq)(t.map(e=>e[a]));return n.length<=1},I=(e,t,a)=>{let{field4Split:n,field4X:l}=a;if((null==n?void 0:n.name)&&(null==l?void 0:l.name)){let a=e[n.name],i=t.filter(e=>n.name&&e[n.name]===a);return F({data:i,xField:l.name})?5:void 0}return(null==l?void 0:l.name)&&F({data:t,xField:l.name})?5:void 0},D=e=>{let{data:t,chartType:a,xField:n}=e,l=(0,C.cloneDeep)(t);try{if(a.includes("line")&&(null==n?void 0:n.name)&&"date"===n.recommendation)return l.sort((e,t)=>new Date(e[n.name]).getTime()-new Date(t[n.name]).getTime()),l;a.includes("line")&&(null==n?void 0:n.name)&&["float","integer"].includes(n.recommendation)&&l.sort((e,t)=>e[n.name]-t[n.name])}catch(e){console.error(e)}return l},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.map(e=>{let a={};return Object.keys(e).forEach(n=>{a[n]=e[n]===t?null:e[n]}),a})},R="multi_line_chart",L="multi_measure_line_chart",A=[{chartType:"multi_line_chart",chartKnowledge:{id:R,name:"multi_line_chart",alias:["multi_line_chart"],family:["LineCharts"],def:"multi_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Trend"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:1,fieldConditions:["Time","Ordinal"]},{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:0,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{var a,n;let l=P(t),i=T(t),r=null!==(a=null!=l?l:i)&&void 0!==a?a:t[0],s=t.filter(e=>e.name!==(null==r?void 0:r.name)),c=null!==(n=s.filter(e=>e.levelOfMeasurements&&Z(e.levelOfMeasurements,["Interval"])))&&void 0!==n?n:[s[0]],o=s.filter(e=>!c.find(t=>t.name===e.name)).find(e=>e.levelOfMeasurements&&Z(e.levelOfMeasurements,["Nominal"]));if(!r||!c)return null;let d={type:"view",autoFit:!0,data:D({data:e,chartType:R,xField:r}),children:[]};return c.forEach(a=>{let n={type:"line",encode:{x:M(r.name,t),y:a.name,size:t=>I(t,e,{field4Split:o,field4X:r})},legend:{size:!1}};o&&(n.encode.color=o.name),d.children.push(n)}),d}},chineseName:"折线图"},{chartType:"multi_measure_column_chart",chartKnowledge:{id:"multi_measure_column_chart",name:"multi_measure_column_chart",alias:["multi_measure_column_chart"],family:["ColumnCharts"],def:"multi_measure_column_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{let a=null==t?void 0:t.filter(e=>Z(e.levelOfMeasurements,["Interval"])),n=T(t),l=P(t),i=null!=n?n:l;if(!i||!a)return null;let r={type:"view",data:e,children:[]};return null==a||a.forEach(e=>{let t={type:"interval",encode:{x:i.name,y:e.name,color:()=>e.name,series:()=>e.name}};r.children.push(t)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"},{chartType:"multi_measure_line_chart",chartKnowledge:{id:L,name:"multi_measure_line_chart",alias:["multi_measure_line_chart"],family:["LineCharts"],def:"multi_measure_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,t)=>{try{var a,n;let l=null!==(n=null!==(a=T(t))&&void 0!==a?a:P(t))&&void 0!==n?n:t[0],i=null==t?void 0:t.filter(e=>e.name!==(null==l?void 0:l.name)&&Z(e.levelOfMeasurements,["Interval"]));if(!l||!i)return null;let r={type:"view",data:D({data:e,chartType:L,xField:l}),children:[]};return null==i||i.forEach(a=>{let n={type:"line",encode:{x:M(l.name,t),y:a.name,color:()=>a.name,series:()=>a.name,size:t=>I(t,e,{field4X:l})},legend:{size:!1}};r.children.push(n)}),r}catch(e){return console.log(e),null}}},chineseName:"折线图"}],z=e=>"response_line_chart"===e?["multi_line_chart","multi_measure_line_chart"]:"response_bar_chart"===e?["multi_measure_column_chart"]:"response_pie_chart"===e?["pie_chart"]:"response_scatter_chart"===e?["scatter_plot"]:"response_area_chart"===e?["area_chart"]:"response_heatmap_chart"===e?["heatmap"]:[],{Option:K}=y.default,V=e=>{let{data:t,chartType:a,scopeOfCharts:l,ruleConfig:i}=e,r=Q(t),{mode:d}=(0,s.useContext)(c.p),[u,m]=(0,s.useState)(),[h,p]=(0,s.useState)([]),[k,S]=(0,s.useState)(),Z=(0,s.useRef)();(0,s.useEffect)(()=>{m(E({charts:A,scopeOfCharts:{exclude:["area_chart","stacked_area_chart","percent_stacked_area_chart"]},ruleConfig:i}))},[i,l]);let M=e=>{if(!u)return[];let t=function(e){let{advices:t}=e;return t}({advices:e}),n=(0,C.uniq)((0,C.compact)((0,C.concat)(a,e.map(e=>e.type)))),l=n.map(e=>{let a=t.find(t=>t.type===e);if(a)return a;let n=u.dataAnalyzer.execute({data:r});if("data"in n){var l;let t=u.specGenerator.execute({data:n.data,dataProps:n.dataProps,chartTypeRecommendations:[{chartType:e,score:1}]});if("advices"in t)return null===(l=t.advices)||void 0===l?void 0:l[0]}}).filter(e=>null==e?void 0:e.spec);return l};(0,s.useEffect)(()=>{if(r&&u){var e;let t=O({data:r,myChartAdvisor:u}),a=M(t);p(a),S(null===(e=a[0])||void 0===e?void 0:e.type)}},[JSON.stringify(r),u,a]);let P=(0,s.useMemo)(()=>{if((null==h?void 0:h.length)>0){var e,t,a,l;let i=null!=k?k:h[0].type,s=null!==(t=null===(e=null==h?void 0:h.find(e=>e.type===i))||void 0===e?void 0:e.spec)&&void 0!==t?t:void 0;if(s){if(s.data&&["line_chart","step_line_chart"].includes(i)){let e=null==u?void 0:u.dataAnalyzer.execute({data:r});e&&"dataProps"in e&&(s.data=D({data:s.data,xField:null===(l=e.dataProps)||void 0===l?void 0:l.find(e=>"date"===e.recommendation),chartType:i}))}return"pie_chart"===i&&(null==s?void 0:null===(a=s.encode)||void 0===a?void 0:a.color)&&(s.tooltip={title:{field:s.encode.color}}),(0,n.jsx)(o.k,{options:{...s,autoFit:!0,theme:d,height:300},ref:Z},i)}}},[h,d,k]);return k?(0,n.jsxs)("div",{children:[(0,n.jsxs)(x.Z,{justify:"space-between",className:"mb-2",children:[(0,n.jsx)(_.Z,{children:(0,n.jsxs)(g.Z,{children:[(0,n.jsx)("span",{children:v.Z.t("Advices")}),(0,n.jsx)(y.default,{className:"w-52",value:k,placeholder:"Chart Switcher",onChange:e=>S(e),size:"small",children:null==h?void 0:h.map(e=>{let t=v.Z.t(e.type);return(0,n.jsx)(K,{value:e.type,children:(0,n.jsx)(j.Z,{title:t,placement:"right",children:(0,n.jsx)("div",{children:t})})},e.type)})})]})}),(0,n.jsx)(_.Z,{children:(0,n.jsx)(j.Z,{title:v.Z.t("Download"),children:(0,n.jsx)(w.ZP,{onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart",a=document.createElement("a"),n="".concat(t,".png");setTimeout(()=>{let t=function(e){let t=N(e);if(t){let e=t.toDataURL("image/png");return e}}(e);if(t){a.addEventListener("click",()=>{a.download=n,a.href=t});let e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),a.dispatchEvent(e)}},16)})(Z.current,v.Z.t(k)),icon:(0,n.jsx)(f.Z,{}),type:"text"})})})]}),(0,n.jsx)("div",{className:"flex",children:P})]}):(0,n.jsx)(b.Z,{image:b.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无合适的可视化视图"})};var B=function(e){let{chartsData:t}=e,a=(0,s.useMemo)(()=>{if(t){let e=[],a=null==t?void 0:t.filter(e=>"IndicatorValue"===e.chart_type);a.length>0&&e.push({charts:a,type:"IndicatorValue"});let n=null==t?void 0:t.filter(e=>"IndicatorValue"!==e.chart_type),l=n.length,i=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][l].forEach(t=>{if(t>0){let a=n.slice(i,i+t);i+=t,e.push({charts:a})}}),e}},[t]);return(0,n.jsx)("div",{className:"flex flex-col gap-3",children:null==a?void 0:a.map((e,t)=>(0,n.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex gap-3":""),children:e.charts.map(e=>"IndicatorValue"===e.chart_type||"IndicatorValue"===e.type?(0,n.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(l.Z,{sx:{background:"transparent"},children:(0,n.jsxs)(i.Z,{className:"justify-around",children:[(0,n.jsx)(r.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,n.jsx)(r.ZP,{children:e.value})]})})},e.name))},e.chart_uid):"LineChart"===e.chart_type||"LineChart"===e.type?(0,n.jsx)(u,{chart:e},e.chart_uid):"BarChart"===e.chart_type||"BarChart"===e.type?(0,n.jsx)(d,{chart:e},e.chart_uid):"Table"===e.chart_type||"TableChartData"===e.type?(0,n.jsx)(p,{chart:e},e.chart_uid):"PieChart"===e.chart_type||"PieChart"===e.type?(0,n.jsx)(m,{chart:e},e.chart_uid):void 0)},"chart_row_".concat(t)))})}}}]);