(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[504],{57905:function(e,s,t){Promise.resolve().then(t.bind(t,4121))},4121:function(e,s,t){"use strict";t.r(s),t.d(s,{dbOptions:function(){return k},default:function(){return C},isFileDb:function(){return q}});var a=t(9268),r=t(86006),l=t(87726),n=t(91321),i=t(32226),c=t(89081),d=t(89749),o=t(53113),m=t(90022),u=t(35891),x=t(8997),b=t(76394),h=t.n(b),p=t(67713),f=t(21628),j=t(87451),Z=t(50148),y=t(3097),v=t(56959),N=t(44244),_=t(50946),w=t(53534),P=function(e){let{open:s,editValue:t,dbNames:l,onClose:n,onSuccess:i}=e,[c,d]=(0,r.useState)(!1),[o]=Z.Z.useForm(),m=Z.Z.useWatch("db_type",o);(0,r.useEffect)(()=>{t&&o.setFieldsValue({...t})},[t]),(0,r.useEffect)(()=>{s||o.resetFields()},[s]);let u=async e=>{let{db_host:s,db_path:a,db_port:r,...n}=e;if(!t&&l.some(e=>e===n.db_name)){f.ZP.error("The database already exists!");return}let c=q(m),o={db_host:c?void 0:s,db_port:c?void 0:r,file_path:c?a:void 0,...n};d(!0);try{let e;if(!(e=t?await w.Z.post("/api/v1/chat/db/edit",o):await w.Z.post("/api/v1/chat/db/add",o)).success){f.ZP.error(e.err_msg);return}f.ZP.success("success"),null==i||i()}catch(e){f.ZP.error(e.message)}finally{d(!1)}};return(0,a.jsx)(p.Z,{open:s,width:400,title:t?"Edit DB Connect":"Create DB Connenct",maskClosable:!1,footer:null,onCancel:n,children:(0,a.jsxs)(Z.Z,{form:o,className:"pt-2",labelCol:{span:6},labelAlign:"left",onFinish:u,children:[(0,a.jsx)(Z.Z.Item,{name:"db_type",label:"SQL Type",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(y.Z,{options:k})}),(0,a.jsx)(Z.Z.Item,{name:"db_name",label:"DB Name",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(v.Z,{readOnly:!!t,disabled:!!t})}),(0,a.jsx)(Z.Z.Item,{name:"db_user",label:"Username",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(v.Z,{})}),(0,a.jsx)(Z.Z.Item,{name:"db_pwd",label:"Password",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(v.Z,{type:"password"})}),q(m)?(0,a.jsx)(Z.Z.Item,{name:"db_path",label:"Path",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(v.Z,{})}):(0,a.jsx)(Z.Z.Item,{name:"db_host",label:"Host",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(v.Z,{})}),!q(m)&&(0,a.jsx)(Z.Z.Item,{name:"db_port",label:"Port",className:"mb-3",rules:[{required:!0}],children:(0,a.jsx)(N.Z,{min:1,step:1,max:65535})}),(0,a.jsx)(Z.Z.Item,{name:"comment",label:"Remark",className:"mb-3",children:(0,a.jsx)(v.Z,{})}),(0,a.jsxs)(Z.Z.Item,{className:"flex flex-row-reverse pt-1 mb-0",children:[(0,a.jsx)(_.ZP,{htmlType:"submit",type:"primary",size:"middle",className:"mr-1",loading:c,children:"Save"}),(0,a.jsx)(_.ZP,{size:"middle",onClick:n,children:"Cancel"})]})]})})};let g={mysql:"/icons/mysql.png",mssql:"/icons/mssql.png",duckdb:"/icons/sql.png"},k=[{label:"Mysql",value:"mysql"},{label:"Mssql",value:"mssql"},{label:"Duckdb",value:"duckdb",isFileDb:!0}];function q(e){var s;return null===(s=k.find(s=>s.value===e))||void 0===s?void 0:s.isFileDb}var C=function(){let[e,s]=(0,r.useState)(!1),[t,b]=(0,r.useState)({open:!1}),{data:{data:Z}={data:[]},run:y}=(0,c.Z)(async()=>{try{return s(!0),await (0,d.Tk)("/v1/chat/db/list")}finally{s(!1)}}),v=e=>{b({open:!0,info:e})},N=e=>{p.Z.confirm({title:"Tips",content:"Do you Want to delete the ".concat(e.db_name,"?"),onOk:()=>new Promise(async(s,t)=>{try{let{success:a,err_msg:r}=await w.Z.post("/api/v1/chat/db/delete?db_name=".concat(e.db_name));a||(f.ZP.error(r),t()),f.ZP.success("success"),y(),s()}catch(e){f.ZP.error(e.message),t()}})})};return(0,a.jsxs)("div",{className:"relative p-4 bg-slate-50 dark:bg-transparent min-h-full overflow-y-auto",children:[(0,a.jsxs)(j.Z,{spinning:e,className:"dark:bg-black dark:bg-opacity-5",children:[(0,a.jsx)("div",{className:"px-1 mb-4",children:(0,a.jsxs)(o.Z,{type:"primary",size:"sm",onClick:()=>{b({open:!0})},children:[(0,a.jsx)(l.Z,{fontSize:"small"}),"Create"]})}),(0,a.jsx)("div",{className:"flex flex-wrap",children:Z.map(e=>{var s;let t=q(e.db_type);return(0,a.jsx)("div",{className:"px-1 w-full mb-2 sm:w-1/2 md:w-1/2 lg:w-1/3 xl:w-1/4 2xl:w-1/5",children:(0,a.jsxs)(m.Z,{variant:"outlined",sx:{boxShadow:"unset",transition:"box-shadow .3s ease",":hover":{boxShadow:"0 10px 16px -6px rgba(0,0,0,0.08)"}},children:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center flex-wrap",children:[(0,a.jsx)(h(),{className:"rounded-full border border-gray-200 mr-3",src:null!==(s=g[e.db_type])&&void 0!==s?s:"/icons/sql.png",alt:e.db_type,width:44,height:44,unoptimized:!0}),(0,a.jsx)(u.Z,{title:e.db_name,children:(0,a.jsxs)("div",{className:"flex flex-col flex-1 ",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500 font-normal",children:["[",e.db_type,"]"]}),(0,a.jsx)("div",{className:"font-bold text-base line-clamp-1 break-all",children:e.db_name})]})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"mr-1 cursor-pointer",onClick:()=>{v(e)},children:(0,a.jsx)(n.Z,{color:"primary"})}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>{N(e)},children:(0,a.jsx)(i.Z,{className:"text-red-500"})})]})]}),(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-start text-sm text-gray-500",children:[(0,a.jsx)("label",{className:"w-20",children:"Username:"}),(0,a.jsx)("span",{children:e.db_user})]}),(0,a.jsxs)("div",{className:"flex items-center justify-start text-sm text-gray-500",children:[(0,a.jsxs)("label",{className:"w-20",children:[t?"Path":"Host",":"]}),(0,a.jsx)("span",{children:t?e.db_path:e.db_host})]}),(0,a.jsxs)("div",{className:"flex items-center justify-start text-sm text-gray-500",children:[(0,a.jsx)("label",{className:"w-20",children:"Port:"}),(0,a.jsx)("span",{children:t?"-":e.db_port})]}),(0,a.jsxs)("div",{className:"flex items-center justify-start text-sm text-gray-500",children:[(0,a.jsx)("label",{className:"w-20",children:"Remark:"}),(0,a.jsx)("span",{children:e.comment})]})]})]})},e.db_name)})})]}),(0,a.jsx)(P,{open:t.open,editValue:t.info,dbNames:Z.map(e=>e.db_name),onSuccess:()=>{b({open:!1,info:void 0}),y()},onClose:()=>{b({open:!1,info:void 0})}})]})}},53534:function(e,s,t){"use strict";var a=t(24214),r=t(52040);let l=a.Z.create({baseURL:r.env.API_BASE_URL});l.defaults.timeout=1e4,l.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),s.Z=l},89749:function(e,s,t){"use strict";t.d(s,{Ej:function(){return m},Kw:function(){return d},PR:function(){return o},Tk:function(){return c}});var a=t(21628),r=t(53534),l=t(84835);let n={"content-type":"application/json"},i=e=>{if(!(0,l.isPlainObject)(e))return JSON.stringify(e);let s={...e};for(let e in s){let t=s[e];"string"==typeof t&&(s[e]=t.trim())}return JSON.stringify(s)},c=(e,s)=>{if(s){let t=Object.keys(s).filter(e=>void 0!==s[e]&&""!==s[e]).map(e=>"".concat(e,"=").concat(s[e])).join("&");t&&(e+="?".concat(t))}return r.Z.get("/api"+e,{headers:n}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},d=(e,s)=>{let t=i(s);return r.Z.post("/api"+e,{body:t,headers:n}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},o=(e,s)=>(i(s),r.Z.post(e,s,{headers:n}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})),m=(e,s)=>r.Z.post(e,s).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[180,662,487,358,344,81,715,273,394,477,393,713,317,253,769,744],function(){return e(e.s=57905)}),_N_E=e.O()}]);